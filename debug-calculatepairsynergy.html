<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>calculatePairSynergy ãƒ‡ãƒãƒƒã‚°</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
            line-height: 1.6;
        }
        .test-result { 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 8px; 
            background: rgba(0,0,0,0.3);
        }
        .success { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
        button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ calculatePairSynergy ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</h1>
    <p>NaNå•é¡Œã®æ ¹æœ¬åŸå› ã‚’ç‰¹å®šã—ã¾ã™</p>
    
    <button onclick="runDebugTest()">ğŸ¯ ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    
    <div id="results"></div>

    <script src="./public/assets/H384H64database.js"></script>
    <script src="./public/js/core/TripleOSInteractionAnalyzer.js"></script>
    <script>
        function runDebugTest() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="test-result">ğŸ”„ ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</div>';
            
            try {
                const analyzer = new TripleOSInteractionAnalyzer();
                
                // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: æŠœãæ‰“ã¡ãƒã‚§ãƒƒã‚¯ã§å•é¡Œã®ã‚ã£ãŸãƒ‘ã‚¿ãƒ¼ãƒ³
                const testCases = [
                    { e: 1, iface: 1, s: 1, name: "ä¹¾ç‚ºå¤© åŒä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³" },
                    { e: 2, iface: 2, s: 2, name: "å¤ç‚ºåœ° åŒä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³" },
                    { e: 1, iface: 2, s: 3, name: "ç•°ãªã‚‹å¦ã®çµ„ã¿åˆã‚ã›" },
                    { e: 29, iface: 30, s: 51, name: "åç‚ºæ°´Ã—é›¢ç‚ºç«Ã—éœ‡ç‚ºé›·" },
                    { e: 63, iface: 64, s: 1, name: "æ—¢æ¸ˆÃ—æœªæ¸ˆÃ—ä¹¾" }
                ];
                
                let html = '<h2>ğŸ” è©³ç´°ãƒ‡ãƒãƒƒã‚°çµæœ</h2>';
                
                testCases.forEach((testCase, index) => {
                    try {
                        const engineOS = { hexagramId: testCase.e, name: `ç¬¬${testCase.e}å¦`, score: 0.5 };
                        const interfaceOS = { hexagramId: testCase.iface, name: `ç¬¬${testCase.iface}å¦`, score: 0.5 };
                        const safeModeOS = { hexagramId: testCase.s, name: `ç¬¬${testCase.s}å¦`, score: 0.5 };
                        
                        console.log(`ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ ${index + 1}: ${testCase.name}`);
                        console.log('Engine OS:', engineOS);
                        console.log('Interface OS:', interfaceOS);
                        console.log('SafeMode OS:', safeModeOS);
                        
                        // å€‹åˆ¥è¨ˆç®—ã‚’ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§ç¢ºèª
                        console.log('=== calculatePairSynergy å‘¼ã³å‡ºã—é–‹å§‹ ===');
                        
                        const engineInterfaceSynergy = analyzer.calculatePairSynergy(engineOS, interfaceOS, 'engine-interface');
                        console.log('engineInterfaceSynergy:', engineInterfaceSynergy, typeof engineInterfaceSynergy);
                        
                        const engineSafeSynergy = analyzer.calculatePairSynergy(engineOS, safeModeOS, 'engine-safe');
                        console.log('engineSafeSynergy:', engineSafeSynergy, typeof engineSafeSynergy);
                        
                        const interfaceSafeSynergy = analyzer.calculatePairSynergy(interfaceOS, safeModeOS, 'interface-safe');
                        console.log('interfaceSafeSynergy:', interfaceSafeSynergy, typeof interfaceSafeSynergy);
                        
                        // ç·åˆè¨ˆç®—
                        const totalSynergy = (engineInterfaceSynergy + engineSafeSynergy + interfaceSafeSynergy) / 3;
                        console.log('totalSynergyè¨ˆç®—:', `(${engineInterfaceSynergy} + ${engineSafeSynergy} + ${interfaceSafeSynergy}) / 3 = ${totalSynergy}`);
                        
                        // analyzePair ãƒ¡ã‚½ãƒƒãƒ‰ã‚‚ç¢ºèª
                        const eiAnalysis = analyzer.analyzePair('engine-interface', engineOS, interfaceOS);
                        const esAnalysis = analyzer.analyzePair('engine-safe', engineOS, safeModeOS);
                        const isAnalysis = analyzer.analyzePair('interface-safe', interfaceOS, safeModeOS);
                        
                        console.log('analyzePairçµæœ:');
                        console.log('EI Analysis:', eiAnalysis);
                        console.log('ES Analysis:', esAnalysis);
                        console.log('IS Analysis:', isAnalysis);
                        
                        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª
                        console.log('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª:');
                        const char1 = analyzer.getHexagramCharacteristics(testCase.e);
                        const char2 = analyzer.getHexagramCharacteristics(testCase.iface);
                        const char3 = analyzer.getHexagramCharacteristics(testCase.s);
                        console.log('Engineç‰¹å¾´:', char1);
                        console.log('Interfaceç‰¹å¾´:', char2);
                        console.log('SafeModeç‰¹å¾´:', char3);
                        
                        let resultClass = 'success';
                        let diagnostics = '';
                        
                        if (isNaN(totalSynergy) || totalSynergy === undefined || totalSynergy === null) {
                            resultClass = 'error';
                            diagnostics = `âŒ ç·åˆã‚·ãƒŠã‚¸ãƒ¼è¨ˆç®—ã‚¨ãƒ©ãƒ¼: ${totalSynergy} (${typeof totalSynergy})`;
                        } else if (typeof totalSynergy !== 'number') {
                            resultClass = 'error';
                            diagnostics = `âš ï¸ å‹ã‚¨ãƒ©ãƒ¼: ${typeof totalSynergy}, å€¤: ${totalSynergy}`;
                        } else if (totalSynergy < -3.0 || totalSynergy > 3.0) {
                            resultClass = 'error';
                            diagnostics = `âš ï¸ ç¯„å›²å¤–: ${totalSynergy}`;
                        } else {
                            diagnostics = `âœ… æ­£å¸¸: ${totalSynergy.toFixed(3)}`;
                        }
                        
                        html += `
                            <div class="test-result ${resultClass}">
                                <h4>ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ ${index + 1}: ${testCase.name}</h4>
                                <p><strong>çµ„ã¿åˆã‚ã›:</strong> Engine(${testCase.e}) Ã— Interface(${testCase.iface}) Ã— SafeMode(${testCase.s})</p>
                                
                                <p><strong>å€‹åˆ¥ã‚·ãƒŠã‚¸ãƒ¼å€¤:</strong></p>
                                <ul>
                                    <li>Engine-Interface: ${engineInterfaceSynergy} (${typeof engineInterfaceSynergy})</li>
                                    <li>Engine-Safe: ${engineSafeSynergy} (${typeof engineSafeSynergy})</li>
                                    <li>Interface-Safe: ${interfaceSafeSynergy} (${typeof interfaceSafeSynergy})</li>
                                </ul>
                                
                                <p><strong>ç·åˆã‚·ãƒŠã‚¸ãƒ¼:</strong> ${totalSynergy} (${typeof totalSynergy})</p>
                                
                                <p><strong>analyzePairçµæœ:</strong></p>
                                <ul>
                                    <li>EI: ${eiAnalysis.category} (score: ${eiAnalysis.score}, synergy: ${eiAnalysis.synergy})</li>
                                    <li>ES: ${esAnalysis.category} (score: ${esAnalysis.score}, synergy: ${esAnalysis.synergy})</li>
                                    <li>IS: ${isAnalysis.category} (score: ${isAnalysis.score}, synergy: ${isAnalysis.synergy})</li>
                                </ul>
                                
                                <p><strong>è¨ºæ–­:</strong> ${diagnostics}</p>
                            </div>
                        `;
                        
                    } catch (error) {
                        console.error(`ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ ${index + 1} ã§ã‚¨ãƒ©ãƒ¼:`, error);
                        html += `
                            <div class="test-result error">
                                <h4>ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ ${index + 1}: ${testCase.name}</h4>
                                <p>âŒ å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}</p>
                                <p>ã‚¹ã‚¿ãƒƒã‚¯: ${error.stack}</p>
                            </div>
                        `;
                    }
                });
                
                results.innerHTML = html;
                
            } catch (error) {
                results.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼</h4>
                        <p>${error.message}</p>
                    </div>
                `;
                console.error('ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
    </script>
</body>
</html>