<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Test CriticalCSSAnalyzer Class</title>
</head>
<body>
    <h1>Test CriticalCSSAnalyzer Instantiation</h1>
    
    <div id="test-results">
        <p>Testing class instantiation...</p>
    </div>
    
    <!-- Minimal required elements for testing -->
    <div id="start-btn" style="padding: 10px; background: #ccc; cursor: pointer;">Test Start Button</div>
    <div id="question-screen" class="screen">Question Screen</div>
    
    <script>
        // Copy the minimal class definition and test it
        console.log('Starting class instantiation test');
        
        // Simple state class
        class HAQEIState {
            constructor() {
                this.currentQuestion = 0;
                this.answers = [];
                this.isAnalyzing = false;
                this.tripleOSResults = null;
            }
            
            getAnswer(index) {
                return this.answers[index] || null;
            }
        }
        
        // Simple TripleOSEngine class
        class TripleOSEngine {
            constructor() {
                console.log('TripleOSEngine created');
            }
        }
        
        // Test CriticalCSSAnalyzer class
        class CriticalCSSAnalyzer {
            constructor() {
                console.log('CriticalCSSAnalyzer constructor called');
                this.state = new HAQEIState();
                this.tripleOSEngine = new TripleOSEngine();
                this.trigramScores = {};
                
                console.log('Initializing trigram scores');
                this.initializeTrigramScores();
                
                console.log('Binding events');
                this.bindEvents();
                
                console.log('CriticalCSSAnalyzer constructor completed');
            }
            
            initializeTrigramScores() {
                for (let i = 1; i <= 8; i++) {
                    this.trigramScores[i] = 0;
                }
                console.log('Trigram scores initialized');
            }
            
            bindEvents() {
                console.log('bindEvents called');
                
                const startBtn = document.getElementById('start-btn');
                if (startBtn) {
                    console.log('Start button found, binding click event');
                    startBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('Start button clicked!');
                        this.startAnalysis();
                    });
                } else {
                    console.error('Start button not found');
                }
            }
            
            startAnalysis() {
                console.log('startAnalysis called');
                const questionScreen = document.getElementById('question-screen');
                if (questionScreen) {
                    questionScreen.classList.add('active');
                    console.log('Question screen activated');
                } else {
                    console.error('Question screen not found');
                }
            }
        }
        
        // Test instantiation
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, attempting to create CriticalCSSAnalyzer');
            
            try {
                window.testAnalyzer = new CriticalCSSAnalyzer();
                console.log('✅ SUCCESS: CriticalCSSAnalyzer created successfully');
                document.getElementById('test-results').innerHTML = `
                    <p style="color: green;">✅ SUCCESS: Class instantiated successfully!</p>
                    <p>Check console for detailed logs.</p>
                    <button onclick="window.testAnalyzer.startAnalysis()" style="padding: 10px;">Test startAnalysis</button>
                `;
            } catch (error) {
                console.error('❌ FAILED: Error creating CriticalCSSAnalyzer:', error);
                document.getElementById('test-results').innerHTML = `
                    <p style="color: red;">❌ FAILED: ${error.message}</p>
                    <p>Check console for detailed error.</p>
                `;
            }
        });
    </script>
    
    <style>
        body { font-family: system-ui; padding: 2rem; max-width: 800px; margin: 0 auto; }
        .screen { padding: 1rem; margin: 1rem 0; border: 1px solid #ccc; }
        .screen.active { background: #e7f5e7; border-color: #4a90e2; }
        button { padding: 0.5rem 1rem; margin: 0.5rem; }
    </style>
</body>
</html>