<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°ä¿®æ­£ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
            line-height: 1.6;
        }
        .test-result { 
            margin: 15px 0; 
            padding: 15px; 
            border: 1px solid #444; 
            border-radius: 8px; 
            background: rgba(0,0,0,0.3);
        }
        .pattern-header { 
            font-weight: bold; 
            color: #22d3ee; 
            margin-bottom: 10px; 
        }
        .conflict-detected { 
            color: #10b981; 
            font-weight: bold; 
        }
        .no-conflict { 
            color: #6b7280; 
        }
        .special-expression {
            background: rgba(16, 185, 129, 0.1);
            padding: 5px;
            border-left: 3px solid #10b981;
            margin: 5px 0;
        }
        .generic-expression {
            background: rgba(239, 68, 68, 0.1);
            padding: 5px;
            border-left: 3px solid #ef4444;
            margin: 5px 0;
        }
        button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°ä¿®æ­£ãƒ†ã‚¹ãƒˆ</h1>
    <p>æ›´æ–°ã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é…åˆ—ã§ç‰¹æ®Šè¡¨ç¾ãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã‚‹ã‹ãƒ†ã‚¹ãƒˆ</p>
    
    <button onclick="testKeywordFix()">ğŸ¯ ä¿®æ­£å¾Œãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    
    <div id="results"></div>

    <script src="./public/assets/H384H64database.js"></script>
    <script src="./public/js/core/TripleOSInteractionAnalyzer.js"></script>
    <script>
        function testKeywordFix() {
            const results = document.getElementById('results');
            results.innerHTML = '<div>ğŸ”„ ä¿®æ­£å¾Œãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</div>';
            
            try {
                const analyzer = new TripleOSInteractionAnalyzer();
                
                // ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆä»Šã¾ã§genericã ã£ãŸã‚‚ã®ãŒç‰¹æ®Šè¡¨ç¾ã«ãªã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼‰
                const testPatterns = [
                    { name: 'Pattern 1', pattern: [51, 59, 53] },  // éœ‡ç‚ºé›·Ã—é¢¨æ°´æ¸™Ã—é¢¨å±±æ¼¸
                    { name: 'Pattern 2', pattern: [56, 9, 59] },   // ç«å±±æ—…Ã—é¢¨å¤©å°ç•œÃ—é¢¨æ°´æ¸™
                    { name: 'Pattern 3', pattern: [43, 38, 61] },  // æ²¢å¤©å¤¬Ã—ç«æ²¢ç½Ã—é¢¨æ²¢ä¸­å­š
                    { name: 'Pattern 4', pattern: [11, 36, 27] },  // åœ°å¤©æ³°Ã—åœ°ç«æ˜å¤·Ã—å±±é›·é ¤
                    { name: 'Pattern 5', pattern: [25, 20, 8] },   // å¤©é›·æ— å¦„Ã—é¢¨åœ°è¦³Ã—æ°´åœ°æ¯”
                    { name: 'å‚è€ƒï¼šPattern 27', pattern: [45, 62, 53] }, // æ²¢åœ°èƒÃ—é›·å±±å°éÃ—é¢¨å±±æ¼¸
                ];
                
                let html = '<h2>ğŸ” ä¿®æ­£å¾Œã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°çµæœ</h2>';
                let specialCount = 0;
                let genericCount = 0;
                
                testPatterns.forEach(({ name, pattern: [e, iface, s] }) => {
                    try {
                        const engineOS = { hexagramId: e, name: `ç¬¬${e}å¦`, score: 0.5 };
                        const interfaceOS = { hexagramId: iface, name: `ç¬¬${iface}å¦`, score: 0.5 };
                        const safeModeOS = { hexagramId: s, name: `ç¬¬${s}å¦`, score: 0.5 };
                        
                        // å¦ã®ç‰¹å¾´å–å¾—
                        const char1 = analyzer.getHexagramCharacteristics(e);
                        const char2 = analyzer.getHexagramCharacteristics(iface);
                        const char3 = analyzer.getHexagramCharacteristics(s);
                        
                        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰çµ„ã¿åˆã‚ã›åˆ†æ
                        const eiCombinations = analyzer.analyzeKeywordCombination(char1, char2);
                        
                        // Engine-Interfaceåˆ†æ
                        const eiAnalysis = analyzer.analyzePair('engine-interface', engineOS, interfaceOS);
                        
                        // ç‰¹æ®Šè¡¨ç¾ã‹åˆ¤å®š
                        const hasSpecialConflict = eiCombinations.speedConflict || 
                                                  eiCombinations.valueConflict || 
                                                  eiCombinations.timeConflict || 
                                                  eiCombinations.directionConflict;
                        
                        const isGeneric = eiAnalysis.summary.includes('ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®é•ã„ã§è¿·ã„ãŒç”Ÿã˜ã‚„ã™ã„');
                        
                        if (hasSpecialConflict && !isGeneric) {
                            specialCount++;
                        } else if (isGeneric) {
                            genericCount++;
                        }
                        
                        html += `
                            <div class="test-result">
                                <div class="pattern-header">
                                    ${name}: Engine(${e}: ${char1.name}) Ã— Interface(${iface}: ${char2.name})
                                </div>
                                
                                <div><strong>Engine ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</strong> [${char1.keywords.join(', ')}]</div>
                                <div><strong>Interface ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</strong> [${char2.keywords.join(', ')}]</div>
                                
                                <div style="margin: 10px 0;">
                                    <strong>è¡çªæ¤œå‡º:</strong>
                                    Speed: <span class="${eiCombinations.speedConflict ? 'conflict-detected' : 'no-conflict'}">${eiCombinations.speedConflict}</span> | 
                                    Value: <span class="${eiCombinations.valueConflict ? 'conflict-detected' : 'no-conflict'}">${eiCombinations.valueConflict}</span> | 
                                    Time: <span class="${eiCombinations.timeConflict ? 'conflict-detected' : 'no-conflict'}">${eiCombinations.timeConflict}</span> | 
                                    Direction: <span class="${eiCombinations.directionConflict ? 'conflict-detected' : 'no-conflict'}">${eiCombinations.directionConflict}</span>
                                </div>
                                
                                <div class="${hasSpecialConflict && !isGeneric ? 'special-expression' : 'generic-expression'}">
                                    <strong>ç”Ÿæˆè¡¨ç¾:</strong> ã€Œ${eiAnalysis.summary}ã€
                                    ${hasSpecialConflict && !isGeneric ? ' âœ… ç‰¹æ®Šè¡¨ç¾' : ' âš ï¸ æ±ç”¨è¡¨ç¾'}
                                </div>
                            </div>
                        `;
                        
                    } catch (error) {
                        html += `
                            <div class="test-result">
                                <div class="pattern-header">${name}: ã‚¨ãƒ©ãƒ¼</div>
                                <div style="color: #ef4444;">âŒ ${error.message}</div>
                            </div>
                        `;
                    }
                });
                
                // çµæœã‚µãƒãƒªãƒ¼
                html += `
                    <div class="test-result" style="border-color: #22d3ee;">
                        <h3>ğŸ“Š ä¿®æ­£çµæœã‚µãƒãƒªãƒ¼</h3>
                        <p><strong>ç‰¹æ®Šè¡¨ç¾ç”Ÿæˆ:</strong> ${specialCount}/${testPatterns.length} ãƒ‘ã‚¿ãƒ¼ãƒ³</p>
                        <p><strong>æ±ç”¨è¡¨ç¾æ®‹å­˜:</strong> ${genericCount}/${testPatterns.length} ãƒ‘ã‚¿ãƒ¼ãƒ³</p>
                        <p><strong>æ”¹å–„ç‡:</strong> ${((specialCount / testPatterns.length) * 100).toFixed(1)}%</p>
                        
                        ${specialCount > 1 ? 
                            '<p style="color: #10b981;">âœ… ä¿®æ­£æˆåŠŸï¼è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ç‰¹æ®Šè¡¨ç¾ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ</p>' : 
                            '<p style="color: #f59e0b;">âš ï¸ ã•ã‚‰ãªã‚‹èª¿æ•´ãŒå¿…è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“</p>'
                        }
                    </div>
                `;
                
                results.innerHTML = html;
                
            } catch (error) {
                results.innerHTML = `
                    <div style="color: #ef4444; padding: 20px;">
                        âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}
                        <br>ã‚¹ã‚¿ãƒƒã‚¯: ${error.stack}
                    </div>
                `;
                console.error('ä¿®æ­£ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }
    </script>
</body>
</html>