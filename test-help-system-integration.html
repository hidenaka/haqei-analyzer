<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI Help System Integration Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }
        .demo-elements {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .demo-card {
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
        }
        .demo-card h4 {
            margin-top: 0;
            color: #495057;
        }
        #console-output {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
            border: 2px solid #444;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🆘 HAQEI Help System Integration Test</h1>
        <p>HAQEIヘルプシステムの統合状況をテストし、すべての機能が正常に動作することを確認します。</p>
        
        <div id="test-results"></div>
        
        <div class="test-section">
            <h3>🧪 ヘルプシステムテスト</h3>
            <button onclick="testHelpSystemIntegration()">統合テスト実行</button>
            <button onclick="testHelpSystemFiles()">ファイル存在確認</button>
            <button onclick="testHelpButtonFunctionality()">ヘルプボタンテスト</button>
            <button onclick="testTooltipSystem()">ツールチップテスト</button>
            <button onclick="testModalSystem()">モーダルテスト</button>
            <button onclick="clearResults()">結果クリア</button>
        </div>
        
        <div class="test-section">
            <h3>🎯 デモ要素</h3>
            <p>以下の要素はヘルプシステムによって自動強化されます：</p>
            <div class="demo-elements">
                <div class="demo-card">
                    <h4 data-help-key="bunenjin">分人 (Bunenjin)</h4>
                    <p>一人ひとりの人間が持つ、複数の「人格」や「側面」の概念です。</p>
                </div>
                
                <div class="demo-card">
                    <h4 data-help-key="triple-os">Triple OS</h4>
                    <p>Engine OS、Interface OS、SafeMode OSの3つのオペレーティングシステム。</p>
                </div>
                
                <div class="demo-card">
                    <h4 data-help-key="iching">易経 (I Ching)</h4>
                    <p>古代中国の占術・哲学体系。64卦と386爻から構成されます。</p>
                </div>
                
                <div class="demo-card">
                    <h4 data-help-key="hexagram">卦 (Hexagram)</h4>
                    <p>易経の基本単位。6つの爻（線）から構成される64通りのパターン。</p>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>🎮 手動テスト</h3>
            <button onclick="showManualTestInstructions()">手動テスト手順表示</button>
            <button onclick="openOriginalPage()">元のos_analyzer.htmlを開く</button>
        </div>
        
        <div id="console-output"></div>
    </div>

    <script>
        let consoleOutput = '';
        
        // Console capture
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function logToDisplay(level, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleOutput += `[${timestamp}] ${level.toUpperCase()}: ${message}\n`;
            updateConsoleDisplay();
        }
        
        console.log = (...args) => {
            originalLog(...args);
            logToDisplay('log', ...args);
        };
        
        console.error = (...args) => {
            originalError(...args);
            logToDisplay('error', ...args);
        };
        
        console.warn = (...args) => {
            originalWarn(...args);
            logToDisplay('warn', ...args);
        };
        
        function updateConsoleDisplay() {
            const consoleDiv = document.getElementById('console-output');
            consoleDiv.textContent = consoleOutput;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function addResult(type, title, message) {
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `
                <span class="status-indicator status-${type}"></span>
                <div>
                    <strong>${title}</strong><br>
                    ${message}
                </div>
            `;
            document.getElementById('test-results').appendChild(resultDiv);
            console.log(`[${type.toUpperCase()}] ${title}: ${message}`);
        }
        
        async function testHelpSystemIntegration() {
            console.log('🧪 Testing HAQEI Help System Integration...');
            addResult('info', 'テスト開始', 'ヘルプシステム統合テストを開始します');
            
            // Test 1: Check if CSS files are loaded
            const cssFiles = ['help-system.css', 'help-animations.css'];
            let cssLoaded = 0;
            
            for (const cssFile of cssFiles) {
                const links = document.querySelectorAll('link[rel="stylesheet"]');
                const found = Array.from(links).some(link => link.href.includes(cssFile));
                if (found) {
                    addResult('success', `CSS確認`, `${cssFile} が正常に読み込まれています`);
                    cssLoaded++;
                } else {
                    addResult('warning', `CSS警告`, `${cssFile} が見つかりません`);
                }
            }
            
            // Test 2: Check JavaScript dependencies
            const jsComponents = [
                { name: 'HelpSystemCore', obj: window.HelpSystemCore },
                { name: 'HelpSystemUI', obj: window.HelpSystemUI },
                { name: 'HelpButton', obj: window.HelpButton },
                { name: 'HelpModal', obj: window.HelpModal },
                { name: 'TooltipManager', obj: window.TooltipManager }
            ];
            
            let jsLoaded = 0;
            for (const component of jsComponents) {
                if (component.obj && typeof component.obj === 'function') {
                    addResult('success', `JS確認`, `${component.name} クラスが利用可能です`);
                    jsLoaded++;
                } else {
                    addResult('warning', `JS警告`, `${component.name} クラスが見つかりません`);
                }
            }
            
            // Test 3: Check global help system instance
            if (window.haqeiHelpSystem) {
                addResult('success', 'システム確認', 'グローバルヘルプシステムインスタンスが存在します');
            } else {
                addResult('warning', 'システム警告', 'グローバルヘルプシステムインスタンスが見つかりません');
            }
            
            // Summary
            const totalComponents = cssFiles.length + jsComponents.length + 1;
            const loadedComponents = cssLoaded + jsLoaded + (window.haqeiHelpSystem ? 1 : 0);
            
            if (loadedComponents === totalComponents) {
                addResult('success', '統合テスト完了', `すべてのコンポーネント (${loadedComponents}/${totalComponents}) が正常に統合されています`);
            } else {
                addResult('warning', '統合テスト完了', `一部のコンポーネントに問題があります (${loadedComponents}/${totalComponents})`);
            }
        }
        
        async function testHelpSystemFiles() {
            console.log('📁 Testing help system file structure...');
            
            const filesToTest = [
                '/js/help-system/core/HelpSystemCore.js',
                '/js/help-system/ui/HelpSystemUI.js',
                '/js/help-system/ui/HelpButton.js',
                '/js/help-system/ui/HelpModal.js',
                '/js/help-system/ui/TooltipManager.js',
                '/css/help-system.css',
                '/css/help-animations.css'
            ];
            
            for (const file of filesToTest) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        addResult('success', 'ファイル確認', `${file} が存在します`);
                    } else {
                        addResult('error', 'ファイルエラー', `${file} が見つかりません (${response.status})`);
                    }
                } catch (error) {
                    addResult('error', 'ファイルエラー', `${file} の確認中にエラー: ${error.message}`);
                }
            }
        }
        
        function testHelpButtonFunctionality() {
            console.log('🔘 Testing help button functionality...');
            
            if (typeof showHaqeiHelp === 'function') {
                addResult('success', 'ヘルプボタン', 'showHaqeiHelp関数が利用可能です');
                
                // Test help button call
                try {
                    showHaqeiHelp('bunenjin', 'concept');
                    addResult('success', 'ヘルプ表示', 'ヘルプの表示テストが成功しました');
                } catch (error) {
                    addResult('error', 'ヘルプ表示エラー', `ヘルプ表示でエラー: ${error.message}`);
                }
            } else {
                addResult('warning', 'ヘルプボタン', 'showHaqeiHelp関数が見つかりません');
            }
        }
        
        function testTooltipSystem() {
            console.log('💬 Testing tooltip system...');
            
            if (typeof addHaqeiTooltip === 'function') {
                addResult('success', 'ツールチップ', 'addHaqeiTooltip関数が利用可能です');
                
                // Test tooltip on demo elements
                const demoElements = document.querySelectorAll('[data-help-key]');
                if (demoElements.length > 0) {
                    addResult('success', 'ツールチップ要素', `${demoElements.length}個のヘルプ対象要素が見つかりました`);
                    
                    // Test tooltip addition
                    try {
                        demoElements.forEach(element => {
                            const helpKey = element.getAttribute('data-help-key');
                            addHaqeiTooltip(element, helpKey, 'concept');
                        });
                        addResult('success', 'ツールチップ追加', 'デモ要素にツールチップが追加されました');
                    } catch (error) {
                        addResult('error', 'ツールチップエラー', `ツールチップ追加でエラー: ${error.message}`);
                    }
                } else {
                    addResult('warning', 'ツールチップ要素', 'ヘルプ対象要素が見つかりません');
                }
            } else {
                addResult('warning', 'ツールチップ', 'addHaqeiTooltip関数が見つかりません');
            }
        }
        
        function testModalSystem() {
            console.log('🗂️ Testing modal system...');
            
            if (window.haqeiHelpSystem && window.haqeiHelpSystem.showModal) {
                addResult('success', 'モーダル', 'ヘルプモーダル機能が利用可能です');
                
                try {
                    // Test modal display
                    window.haqeiHelpSystem.showModal('test', {
                        title: 'テストモーダル',
                        content: 'これはヘルプシステムのテストモーダルです。'
                    });
                    addResult('success', 'モーダル表示', 'テストモーダルが正常に表示されました');
                } catch (error) {
                    addResult('error', 'モーダルエラー', `モーダル表示でエラー: ${error.message}`);
                }
            } else {
                addResult('warning', 'モーダル', 'ヘルプモーダル機能が見つかりません');
            }
        }
        
        function showManualTestInstructions() {
            const instructions = `
📋 手動テスト手順：

1. 右下のヘルプボタンを探してください
2. ヘルプボタンをクリックしてモーダルが開くか確認
3. デモ要素（分人、Triple OS等）にマウスオーバーしてツールチップを確認
4. キーボードナビゲーション（Tab、Enter、Escape）をテスト
5. レスポンシブデザインの確認（ブラウザサイズ変更）

期待される動作：
- スムーズなアニメーション
- 適切なコンテンツ表示
- アクセシビリティ機能の動作
- エラーが発生しないこと
            `;
            
            addResult('info', '手動テスト手順', instructions);
            console.log(instructions);
        }
        
        function openOriginalPage() {
            window.open('/os_analyzer.html', '_blank');
            addResult('info', 'ページオープン', 'os_analyzer.htmlを新しいタブで開きました');
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            consoleOutput = '';
            document.getElementById('console-output').textContent = '';
            addResult('info', '結果クリア', 'テスト結果がクリアされました');
        }
        
        // Initialize
        window.addEventListener('load', () => {
            console.log('🆘 HAQEI Help System Integration Test initialized');
            addResult('info', 'テスト開始', 'HAQEIヘルプシステム統合テストが開始されました');
        });
    </script>
</body>
</html>