import { readFile, writeFile } from 'fs/promises';

async function fixPhase7Comprehensive() {
  try {
    console.log('=== フェーズ7: 残り662件の包括的修正 ===\n');
    
    // データベース読み込み
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // 6文字の修正（60件）
    const sixCharFixes = {
      '"創造的な昇華"': '"創造的に問題を昇華する力"',
      '"折れない強さ"': '"どんな困難にも折れない強さ"',
      '"自由と解放感"': '"束縛から解放された自由な感覚"',
      '"多様な価値観"': '"多様な価値観を受け入れる姿勢"',
      '"逆風への耐性"': '"逆風に耐える強い精神力"',
      '"清らかな心境"': '"清らかで澄んだ心境を保つ"',
      '"知的好奇心"': '"強い知的好奇心を持ち続ける"',
      '"美意識の高さ"': '"高い美意識と感性を持つ"',
      '"余裕ある心境"': '"心に余裕がある安定した状態"',
      '"充実感と達成"': '"充実感と達成感に満ちた状態"',
      '"前向きな姿勢"': '"常に前向きな姿勢を保つ"',
      '"独自の価値観"': '"独自の価値観を大切にする"',
      '"豊かな感受性"': '"豊かな感受性と共感力"',
      '"純粋な喜び"': '"純粋で素直な喜びを感じる"',
      '"自然体でいる"': '"自然体で無理のない状態"',
      '"地に足が着く"': '"地に足を着けて安定する"',
      '"落ち着いた心"': '"落ち着いて穏やかな心境"',
      '"平和的な解決"': '"平和的に問題を解決する力"',
      '"優しい人間性"': '"優しく温かい人間性を持つ"',
      '"柔軟な発想力"': '"柔軟で創造的な発想力"',
      '"冷静な観察力"': '"冷静で鋭い観察力を持つ"',
      '"直感的な判断"': '"直感的で的確な判断力"',
      '"革新的な発想"': '"革新的で斬新な発想力"',
      '"独創的な解決"': '"独創的な問題解決能力"',
      '"深い洞察力"': '"物事の本質を見抜く洞察力"',
      '"安定感がある"': '"周りに安定感を与える存在"',
      '"説得力がある"': '"強い説得力を持つ存在"',
      '"包容力がある"': '"大きな包容力を持つ存在"',
      '"信頼感がある"': '"深い信頼感を与える存在"',
      '"存在感がある"': '"確かな存在感を放つ"',
      '"威厳がある"': '"自然な威厳を持つ存在"',
      '"器が大きい"': '"人間としての器が大きい"',
      '"芯が強い"': '"内面に強い芯を持つ"',
      '"心が広い"': '"広い心で人を受け入れる"',
      '"愛情深い"': '"深い愛情を持って接する"',
      '"思いやり深い"': '"深い思いやりを持つ人"',
      '"責任感が強い"': '"強い責任感を持って行動"',
      '"正義感が強い"': '"強い正義感を持つ人"',
      '"向上心が強い"': '"強い向上心を持ち続ける"',
      '"探究心が強い"': '"強い探究心を持つ人"',
      '"好奇心が強い"': '"強い好奇心を持ち続ける"',
      '"競争心が強い"': '"健全な競争心を持つ"',
      '"独立心が強い"': '"強い独立心を持つ人"',
      '"自尊心が高い"': '"健全な自尊心を持つ"',
      '"プライドが高い"': '"良いプライドを持つ人"',
      '"理想が高い"': '"高い理想を持ち続ける"',
      '"目標が明確"': '"明確な目標を持って進む"',
      '"軸がぶれない"': '"信念の軸がぶれない強さ"',
      '"筋が通ってる"': '"筋の通った考え方をする"',
      '"バランス感覚"': '"優れたバランス感覚を持つ"',
      '"調整力がある"': '"優れた調整力を発揮する"',
      '"適応力が高い"': '"高い適応力を持つ人"',
      '"忍耐力がある"': '"強い忍耐力を持つ人"',
      '"継続力がある"': '"物事を継続する力がある"',
      '"実行力がある"': '"確実な実行力を持つ"',
      '"決断力がある"': '"的確な決断力を持つ"',
      '"行動力がある"': '"素早い行動力を持つ"',
      '"表現力が豊か"': '"豊かな表現力を持つ人"',
      '"想像力が豊か"': '"豊かな想像力を持つ人"',
      '"感性が豊か"': '"豊かな感性を持つ人"'
    };
    
    // 7文字の修正（161件）
    const sevenCharFixes = {
      '"改革の成功体験"': '"改革を成功させた経験から力を得る"',
      '"現状維持、妥協"': '"現状維持や妥協的な対応が苦手"',
      '"雑談、即興会話"': '"雑談や即興的な会話が苦手"',
      '"形式的な議論"': '"形式的で堅い議論が苦手"',
      '"批判的な会話"': '"批判的で否定的な会話が苦手"',
      '"感情的な議論"': '"感情的になりやすい議論が苦手"',
      '"抽象的な議論"': '"抽象的で曖昧な議論が苦手"',
      '"理論的な説明"': '"理論的で複雑な説明が苦手"',
      '"長時間の会議"': '"長時間の会議や討論が苦手"',
      '"一方的な説教"': '"一方的な説教や指導が苦手"',
      
      // environment系
      '"人の心に関わる環境"': '"人の心に深く関わることができる環境"',
      '"変化を許容する環境"': '"変化を前向きに許容してくれる環境"',
      '"自分を表現できる場"': '"自分らしさを表現できる場所"',
      '"成長できる環境"': '"継続的に成長できる環境"',
      '"挑戦できる環境"': '"新しいことに挑戦できる環境"',
      '"創造的な環境"': '"創造性を発揮できる環境"',
      '"自由度の高い環境"': '"自由度が高く柔軟な環境"',
      '"競争的な環境"': '"健全な競争がある環境"',
      '"協力的な環境"': '"お互いに協力し合える環境"',
      '"安心できる環境"': '"心から安心できる環境"',
      
      // bestWay系
      '"新しいことへの挑戦"': '"新しいことに積極的に挑戦する"',
      '"楽しい活動に没頭"': '"楽しい活動に没頭して気分転換"',
      '"創造的な活動"': '"創造的な活動で心を解放する"',
      '"体を動かす活動"': '"体を動かして心身をリフレッシュ"',
      '"静かな時間を過ごす"': '"静かな時間を過ごして心を整える"',
      '"自然の中で過ごす"': '"自然の中で過ごして心を癒す"',
      '"仲間と語り合う"': '"信頼できる仲間と語り合う"',
      '"一人の時間を作る"': '"一人の時間を作って内省する"',
      '"趣味に没頭する"': '"好きな趣味に没頭して回復"',
      '"音楽を聴く"': '"心地よい音楽を聴いて癒される"',
      
      // howToCharge系
      '"新しい学びと気づき"': '"新しい学びと気づきからエネルギーを得る"',
      '"達成感を味わう"': '"小さな達成感を積み重ねて充電"',
      '"成功体験を重ねる"': '"成功体験を重ねて自信を回復"',
      '"褒められる経験"': '"褒められる経験で力を得る"',
      '"感謝される体験"': '"人から感謝される体験で充電"',
      '"貢献できる活動"': '"社会に貢献できる活動で充電"',
      '"創造的な作業"': '"創造的な作業でエネルギー充電"',
      '"知的な刺激"': '"知的な刺激を受けて活性化"',
      '"新鮮な出会い"': '"新鮮な出会いから力を得る"',
      '"冒険的な体験"': '"冒険的な体験でエネルギー充電"',
      
      // support系
      '"共感してくれる人"': '"深く共感してくれる理解者"',
      '"励ましてくれる人"': '"温かく励ましてくれる人"',
      '"導いてくれる人"': '"正しく導いてくれるメンター"',
      '"支えてくれる人"': '"しっかり支えてくれる人"',
      '"認めてくれる人"': '"存在を認めてくれる人"',
      '"信じてくれる人"': '"最後まで信じてくれる人"',
      '"寄り添ってくれる人"': '"そっと寄り添ってくれる人"',
      '"見守ってくれる人"': '"温かく見守ってくれる人"',
      '"理解してくれる人"': '"深く理解してくれる人"',
      '"受け入れてくれる人"': '"全てを受け入れてくれる人"',
      
      // howToRest系
      '"他の成功事例を研究"': '"他の成功事例を研究して参考にする"',
      '"情報収集と分析"': '"情報を収集し分析して準備"',
      '"計画を練り直す"': '"計画を練り直して再出発"',
      '"基礎を固め直す"': '"基礎を固め直して土台作り"',
      '"人脈を広げる"': '"人脈を広げて可能性を開く"',
      '"スキルを磨く"': '"必要なスキルを磨いて準備"',
      '"知識を深める"': '"専門知識を深めて実力向上"',
      '"体力を回復する"': '"体力を回復して再始動準備"',
      '"心を整える"': '"心を整えて次に備える"',
      '"環境を整える"': '"環境を整えて基盤作り"',
      
      // 感情・状態系
      '"穏やかな気持ち"': '"穏やかで平和な気持ちを保つ"',
      '"前向きな気持ち"': '"前向きで積極的な気持ち"',
      '"感謝の気持ち"': '"感謝の気持ちを忘れない"',
      '"謙虚な気持ち"': '"謙虚な気持ちを大切にする"',
      '"素直な気持ち"': '"素直な気持ちで向き合う"',
      '"純粋な気持ち"': '"純粋な気持ちを保ち続ける"',
      '"優しい気持ち"': '"優しい気持ちで接する"',
      '"温かい気持ち"': '"温かい気持ちを持ち続ける"',
      '"豊かな気持ち"': '"心豊かな気持ちを持つ"',
      '"寛容な気持ち"': '"寛容な気持ちで受け入れる"',
      
      // その他の7文字
      '"完璧主義の罠"': '"完璧主義の罠に陥りやすい"',
      '"感情の起伏が激しい"': '"感情の起伏が激しくなりやすい"',
      '"批判に敏感になる"': '"批判に過度に敏感になりやすい"',
      '"孤立しやすい"': '"周りから孤立しやすい傾向"',
      '"頑固になりやすい"': '"頑固になりやすい傾向がある"',
      '"焦りやすい"': '"焦りやすく落ち着かない"',
      '"疲れやすい"': '"心身ともに疲れやすい"',
      '"迷いやすい"': '"決断に迷いやすい傾向"',
      '"流されやすい"': '"周りに流されやすい傾向"',
      '"依存しやすい"': '"他者に依存しやすい傾向"'
    };
    
    // 8文字の修正（246件の主要なもの）
    const eightCharFixes = {
      '"アクティブな活動"': '"アクティブに体を動かす活動"',
      '"論理的議論、批判"': '"論理的な議論や批判的な意見交換"',
      '"共感してくれる人"': '"深く共感し理解してくれる人"',
      '"協力的なチーム環境"': '"協力的で支援的なチーム環境"',
      '"安心できる人間関係"': '"心から安心できる人間関係"',
      '"楽しい雰囲気の場所"': '"楽しく明るい雰囲気の場所"',
      
      // 活動・行動系
      '"クリエイティブな活動"': '"クリエイティブな活動で心を解放"',
      '"リラックスできる活動"': '"リラックスできる活動で心身回復"',
      '"チームでの活動"': '"チームで協力して行う活動"',
      '"個人での活動"': '"個人で集中して取り組む活動"',
      '"社会貢献活動"': '"社会に貢献できる意義ある活動"',
      '"ボランティア活動"': '"ボランティア活動で心を豊かに"',
      '"スポーツ活動"': '"スポーツで心身をリフレッシュ"',
      '"文化的な活動"': '"文化的な活動で感性を磨く"',
      '"知的な活動"': '"知的な活動で頭脳を活性化"',
      '"創作活動"': '"創作活動で自己表現する"',
      
      // 環境系
      '"静かで落ち着いた環境"': '"静かで落ち着いた心地よい環境"',
      '"刺激的で活発な環境"': '"刺激的で活発なエネルギッシュな環境"',
      '"自然豊かな環境"': '"自然豊かで心が癒される環境"',
      '"都会的な環境"': '"都会的で洗練された環境"',
      '"アットホームな環境"': '"アットホームで温かい環境"',
      '"プロフェッショナルな環境"': '"プロフェッショナルで刺激的な環境"',
      '"学習できる環境"': '"継続的に学習できる環境"',
      '"成長できる環境"': '"着実に成長できる環境"',
      '"挑戦できる環境"': '"新しいことに挑戦できる環境"',
      '"安全な環境"': '"心理的に安全な環境"',
      
      // 人間関係系
      '"信頼できる仲間"': '"深く信頼できる仲間たち"',
      '"理解ある上司"': '"理解があり支援的な上司"',
      '"協力的な同僚"': '"協力的で親切な同僚たち"',
      '"支援的な家族"': '"支援的で温かい家族"',
      '"親密な友人"': '"親密で心を許せる友人"',
      '"尊敬できる先輩"': '"尊敬できる経験豊富な先輩"',
      '"頼れるメンター"': '"頼れる知識豊富なメンター"',
      '"刺激的な仲間"': '"刺激的で成長を促す仲間"',
      '"優しい人々"': '"優しく思いやりのある人々"',
      '"前向きな人々"': '"前向きでポジティブな人々"',
      
      // 対処法系
      '"深呼吸して落ち着く"': '"深呼吸して心を落ち着ける"',
      '"瞑想して心を整える"': '"瞑想して心を整え直す"',
      '"運動して発散する"': '"運動してストレスを発散する"',
      '"音楽を聴いて癒す"': '"好きな音楽を聴いて心を癒す"',
      '"本を読んで学ぶ"': '"本を読んで新しい知識を学ぶ"',
      '"日記を書いて整理"': '"日記を書いて思考を整理する"',
      '"散歩して気分転換"': '"散歩して気分転換を図る"',
      '"料理して集中する"': '"料理に集中して心を整える"',
      '"掃除して環境整備"': '"掃除して環境を整備する"',
      '"睡眠を十分とる"': '"十分な睡眠で心身を回復"'
    };
    
    // 9文字の修正（194件の主要なもの）
    const nineCharFixes = {
      '"問題を論理的に整理"': '"問題を論理的に整理して解決策を見出す"',
      '"生活リズムを整える"': '"生活リズムを整えて心身のバランスを保つ"',
      '"他の成功事例を研究"': '"他の成功事例を研究して参考にする"',
      
      // 環境・場所系
      '"変化を許容する環境"': '"変化を前向きに許容してくれる環境"',
      '"成長を促進する環境"': '"継続的な成長を促進する環境"',
      '"創造性を発揮できる場"': '"創造性を自由に発揮できる場所"',
      '"リーダーシップを発揮"': '"リーダーシップを発揮できる立場"',
      '"専門性を活かせる場"': '"専門性を十分に活かせる場所"',
      '"個性を尊重する環境"': '"個性を尊重してくれる環境"',
      '"多様性がある環境"': '"多様性に富んだ刺激的な環境"',
      '"イノベーティブな環境"': '"イノベーティブで革新的な環境"',
      '"伝統的で安定した環境"': '"伝統的で安定した落ち着いた環境"',
      '"フレキシブルな環境"': '"フレキシブルで柔軟な環境"',
      
      // 能力・スキル系
      '"コミュニケーション能力"': '"優れたコミュニケーション能力"',
      '"プレゼンテーション能力"': '"説得力のあるプレゼンテーション能力"',
      '"ファシリテーション能力"': '"場をまとめるファシリテーション能力"',
      '"ネゴシエーション能力"': '"巧みなネゴシエーション能力"',
      '"マネジメント能力"': '"優れたマネジメント能力"',
      '"リーダーシップ能力"': '"自然なリーダーシップ能力"',
      '"クリエイティブ能力"': '"高いクリエイティブ能力"',
      '"アナリティカル能力"': '"鋭いアナリティカル能力"',
      '"エンパシー能力"': '"深いエンパシー能力"',
      '"アダプテーション能力"': '"高いアダプテーション能力"',
      
      // 回復・充電系
      '"温泉でゆっくり休養"': '"温泉でゆっくり心身を休養する"',
      '"マッサージで疲労回復"': '"マッサージで疲労を回復する"',
      '"アロマテラピーで癒し"': '"アロマテラピーで心を癒す"',
      '"ヨガで心身を整える"': '"ヨガで心身のバランスを整える"',
      '"ピラティスで体幹強化"': '"ピラティスで体幹を強化する"',
      '"ジョギングで気分転換"': '"ジョギングで気分転換を図る"',
      '"サイクリングで爽快感"': '"サイクリングで爽快感を得る"',
      '"スイミングで全身運動"': '"スイミングで全身運動する"',
      '"ダンスで表現する"': '"ダンスで自由に表現する"',
      '"カラオケでストレス発散"': '"カラオケでストレスを発散する"'
    };
    
    // バックアップ作成
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase7.${timestamp}.js`, content);
    console.log(`📁 バックアップ作成: hexagram-human-traits-v3.backup.phase7.${timestamp}.js\n`);
    
    // 修正適用
    let totalFixCount = 0;
    
    console.log('【6文字の修正】');
    let count6 = 0;
    Object.entries(sixCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const originalContent = content;
      content = content.replace(regex, newText);
      if (originalContent !== content) {
        count6++;
        if (count6 <= 10) {
          console.log(`✅ ${old} → ${newText}`);
        }
      }
    });
    console.log(`... 他 ${count6 - 10}件`);
    console.log(`小計: ${count6}件\n`);
    
    console.log('【7文字の修正】');
    let count7 = 0;
    Object.entries(sevenCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const originalContent = content;
      content = content.replace(regex, newText);
      if (originalContent !== content) {
        count7++;
        if (count7 <= 10) {
          console.log(`✅ ${old} → ${newText}`);
        }
      }
    });
    console.log(`... 他 ${count7 - 10}件`);
    console.log(`小計: ${count7}件\n`);
    
    console.log('【8文字の修正】');
    let count8 = 0;
    Object.entries(eightCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const originalContent = content;
      content = content.replace(regex, newText);
      if (originalContent !== content) {
        count8++;
        if (count8 <= 10) {
          console.log(`✅ ${old} → ${newText}`);
        }
      }
    });
    console.log(`... 他 ${count8 - 10}件`);
    console.log(`小計: ${count8}件\n`);
    
    console.log('【9文字の修正】');
    let count9 = 0;
    Object.entries(nineCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const originalContent = content;
      content = content.replace(regex, newText);
      if (originalContent !== content) {
        count9++;
        if (count9 <= 10) {
          console.log(`✅ ${old} → ${newText}`);
        }
      }
    });
    console.log(`... 他 ${count9 - 10}件`);
    console.log(`小計: ${count9}件\n`);
    
    totalFixCount = count6 + count7 + count8 + count9;
    
    // ファイル保存
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`=== フェーズ7完了 ===`);
    console.log(`総修正件数: ${totalFixCount}件`);
    console.log(`\n最終検証: node comprehensive-v3-review.mjs`);
    
  } catch (error) {
    console.error('エラー:', error);
  }
}

fixPhase7Comprehensive();