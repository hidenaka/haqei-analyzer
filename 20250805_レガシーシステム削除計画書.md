# レガシーシステム削除計画書

作成日: 2025年08月05日  
作成者: HAQEI CTO Agent  
プロジェクト: Future Simulator 正統易経統合  
フェーズ: 3.2

## 1. 削除対象概要

### 1.1 主要削除対象
- **ProbabilisticSituationModeler.js**: 941行の機械的確率モデリングシステム
- **関連テストコード**: integrated-test-system.js内の参照
- **オプション統合コード**: SituationalHexagramTester.js内の参照

### 1.2 削除理由
1. 正統易経8変化パターンシステムへの完全移行完了
2. D級（19/100）の低品質な機械的分析
3. HaQei哲学との不整合
4. メンテナンスコストの削減

## 2. 削除実施計画

### 2.1 Phase 1: バックアップ作成（P3.1.3）
```bash
# バックアップディレクトリ作成
mkdir -p backup/20250805_legacy_system

# ファイルバックアップ
cp public/js/pages/future-simulator/ProbabilisticSituationModeler.js backup/20250805_legacy_system/
cp tests/integrated-test-system.js backup/20250805_legacy_system/
cp public/js/pages/future-simulator/SituationalHexagramTester.js backup/20250805_legacy_system/
```

### 2.2 Phase 2: 参照削除（P3.2.1）

#### 2.2.1 integrated-test-system.js修正
```javascript
// 削除対象行:
// 行53: 'ProbabilisticSituationModeler',
// 行130: this.testProbabilisticSituationModeler(),
// 行724-776: testProbabilisticSituationModeler()メソッド全体

// 修正後:
const engineNames = [
  'SymbolicReasoningEngine',
  'BayesianInferenceEngine',
  'EnvironmentalFactorAnalyzer',
  'SituationalContextEngine',
  'DeepPsychologicalAnalyzer',
  // 'ProbabilisticSituationModeler', // REMOVED: 正統易経システムに移行
  'HexagramMappingEngine',
  'MetaphorGenerationEngine',
  // ... 以下続く
];
```

#### 2.2.2 SituationalHexagramTester.js修正
```javascript
// 削除対象:
// 行51: probabilisticModeler: null
// 行150-153: ProbabilisticSituationModeler初期化ブロック
// 行222-227: 確率的モデリング実行ブロック
// 行440-447: runProbabilisticModelingメソッド
// 行658: probabilisticModeler: '4.0.0'

// 修正後のengines定義:
this.engines = {
  situationalEngine: null,
  hexagramMapper: null,
  psychologicalAnalyzer: null
  // probabilisticModeler削除
};
```

### 2.3 Phase 3: ファイル削除（P3.2.2）
```bash
# レガシーモジュール削除
rm public/js/pages/future-simulator/ProbabilisticSituationModeler.js

# Git管理から削除
git rm public/js/pages/future-simulator/ProbabilisticSituationModeler.js
```

## 3. 削除後の検証計画

### 3.1 機能テスト
1. **future_simulator.html動作確認**
   - 30質問フロー完走テスト
   - 正統易経8変化パターン表示確認
   - エラーハンドリング確認

2. **統合テスト実行**
   ```bash
   npm test
   # integrated-test-system.jsが正常動作することを確認
   ```

### 3.2 パフォーマンステスト
- レスポンスタイム測定（目標: 2秒以内）
- メモリ使用量確認（削減効果測定）

### 3.3 ユーザー体験確認
- UIの正常表示
- 選択肢の適切な動作
- 結果表示の品質確認

## 4. ロールバック計画

### 4.1 緊急時対応
```bash
# バックアップからの復元
cp backup/20250805_legacy_system/* [元の場所]

# Git履歴からの復元
git checkout HEAD~1 -- public/js/pages/future-simulator/ProbabilisticSituationModeler.js
```

### 4.2 ロールバック判断基準
- 重大な機能欠損の発見
- パフォーマンス劣化（3秒以上のレスポンス）
- 予期しない依存関係の発覚

## 5. スケジュール

| タスク | 所要時間 | 担当 |
|--------|----------|------|
| バックアップ作成 | 10分 | haqei-programmer |
| 参照削除実装 | 30分 | haqei-programmer |
| ファイル削除 | 5分 | haqei-programmer |
| 機能検証 | 45分 | haqei-qa-tester |
| 完了報告 | 15分 | haqei-reporter |

**合計所要時間**: 約1時間45分

## 6. 成功基準

1. **技術的成功**
   - [ ] すべてのテストがPASS
   - [ ] エラーログなし
   - [ ] レスポンスタイム2秒以内

2. **品質的成功**
   - [ ] 正統易経度85%以上維持
   - [ ] HaQei哲学整合性確保
   - [ ] ユーザー体験向上確認

## 7. 承認

本削除計画は、正統易経統合プロジェクトの重要マイルストーンです。
機械的システムから哲学的システムへの完全移行を実現します。

**次のアクション**: P3.1.3 バックアップ作成の実施