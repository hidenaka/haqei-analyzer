import { readFile, writeFile } from 'fs/promises';

async function fixPhase20RemainingSeven() {
  try {
    console.log('=== ãƒ•ã‚§ãƒ¼ã‚º20: æ®‹ã‚Š7æ–‡å­—46ä»¶ã‚’ç²¾å¯†ä¿®æ­£ ===\n');
    
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èª­ã¿è¾¼ã¿
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // remaining-short-descriptions.jsonã‹ã‚‰æŠ½å‡ºã—ãŸ7æ–‡å­—ã®èª¬æ˜ï¼ˆ46ä»¶ï¼‰
    const sevenCharFixes = {
      // éœ‡ç‚ºé›·
      '"æ¬¡ã®é›·ã«å‚™ãˆã‚‹"': '"æ¬¡ã®é›·ã«å‚™ãˆã¦æº–å‚™ã™ã‚‹"',
      
      // è‰®ç‚ºå±±
      '"è½ã¡ç€ã„ãŸäººã€…"': '"è½ã¡ç€ã„ãŸå¿ƒã‚’æŒã¤äººã€…"',
      '"çµ¶å¯¾çš„ãªå®‰å¿ƒæ„Ÿ"': '"çµ¶å¯¾çš„ãªå®‰å¿ƒæ„Ÿã‚’ä¸ãˆã‚‹"',
      
      // ãã®ä»–ã®7æ–‡å­—ï¼ˆremaining-short-descriptions.jsonã«ã¯3ä»¶ã®ã¿è¨˜è¼‰ï¼‰
      // è¿½åŠ ã§æ¤œç´¢ã—ã¦è¦‹ã¤ã‹ã£ãŸ7æ–‡å­—ã‚’ä¿®æ­£
      '"é™ã‹ãªå……é›»æ™‚é–“"': '"é™ã‹ãªå……é›»æ™‚é–“ã‚’éã”ã™"',
      '"æ·±ã„ç†è§£ã¨å…±æ„Ÿ"': '"æ·±ã„ç†è§£ã¨å…±æ„Ÿã‚’ç¤ºã™"',
      '"å®Œå…¨ãªè‡ªç”±çŠ¶æ…‹"': '"å®Œå…¨ãªè‡ªç”±çŠ¶æ…‹ã‚’å®Ÿç¾"',
      '"å¼·åŠ›ãªæ¨é€²åŠ›"': '"å¼·åŠ›ãªæ¨é€²åŠ›ã‚’ç™ºæ®ã™ã‚‹"',
      '"ç¢ºå®ŸãªåŸºç›¤ä½œã‚Š"': '"ç¢ºå®ŸãªåŸºç›¤ä½œã‚Šã‚’é€²ã‚ã‚‹"',
      '"æŸ”è»Ÿãªå¯¾å¿œåŠ›"': '"æŸ”è»Ÿãªå¯¾å¿œåŠ›ã‚’ç™ºæ®ã™ã‚‹"',
      '"ç‹¬è‡ªã®ä¾¡å€¤è¦³"': '"ç‹¬è‡ªã®ä¾¡å€¤è¦³ã‚’å¤§åˆ‡ã«ã™ã‚‹"',
      '"å‰µé€ çš„ãªç™ºæƒ³"': '"å‰µé€ çš„ãªç™ºæƒ³ã‚’ç”Ÿã¿å‡ºã™"',
      '"ç¶™ç¶šçš„ãªåŠªåŠ›"': '"ç¶™ç¶šçš„ãªåŠªåŠ›ã‚’ç¶šã‘ã‚‹"',
      '"æ®µéšçš„ãªæˆé•·"': '"æ®µéšçš„ãªæˆé•·ã‚’é‚ã’ã‚‹"',
      '"èª¿å’Œçš„ãªé–¢ä¿‚"': '"èª¿å’Œçš„ãªé–¢ä¿‚ã‚’ç¯‰ã"',
      '"è±Šã‹ãªè¡¨ç¾åŠ›"': '"è±Šã‹ãªè¡¨ç¾åŠ›ã‚’ç™ºæ®ã™ã‚‹"',
      '"æ–°ãŸãªå¯èƒ½æ€§"': '"æ–°ãŸãªå¯èƒ½æ€§ã‚’æ¢æ±‚ã™ã‚‹"',
      '"è‡ªç”±ãªç™ºæƒ³åŠ›"': '"è‡ªç”±ãªç™ºæƒ³åŠ›ã‚’æ´»ã‹ã™"',
      '"ç¢ºã‹ãªå®Ÿè¡ŒåŠ›"': '"ç¢ºã‹ãªå®Ÿè¡ŒåŠ›ã‚’ç™ºæ®ã™ã‚‹"',
      '"æ·±ã„æ´å¯ŸåŠ›"': '"æ·±ã„æ´å¯ŸåŠ›ã‚’æŒã£ã¦è¦‹ã‚‹"',
      '"å¼·ã„æ„å¿—åŠ›"': '"å¼·ã„æ„å¿—åŠ›ã‚’æŒã£ã¦é€²ã‚€"',
      '"è±Šå¯ŒãªçµŒé¨“å€¤"': '"è±Šå¯ŒãªçµŒé¨“å€¤ã‚’æ´»ã‹ã™"',
      '"å®‰å®šã—ãŸåŸºç›¤"': '"å®‰å®šã—ãŸåŸºç›¤ã‚’æ§‹ç¯‰ã™ã‚‹"',
      '"æ˜ç¢ºãªæ–¹å‘æ€§"': '"æ˜ç¢ºãªæ–¹å‘æ€§ã‚’ç¤ºã™"',
      '"ç´”ç²‹ãªå‹•æ©Ÿ"': '"ç´”ç²‹ãªå‹•æ©Ÿã‹ã‚‰è¡Œå‹•ã™ã‚‹"',
      '"èª å®Ÿãªæ…‹åº¦"': '"èª å®Ÿãªæ…‹åº¦ã§æ¥ã™ã‚‹"',
      '"æ¸©ã‹ã„äººé–“æ€§"': '"æ¸©ã‹ã„äººé–“æ€§ã‚’ç™ºæ®ã™ã‚‹"',
      '"é‹­ã„è¦³å¯ŸåŠ›"': '"é‹­ã„è¦³å¯ŸåŠ›ã‚’ç™ºæ®ã™ã‚‹"',
      '"è±Šã‹ãªæ„Ÿæ€§"': '"è±Šã‹ãªæ„Ÿæ€§ã‚’å¤§åˆ‡ã«ã™ã‚‹"',
      '"å¼·å›ºãªä¿¡å¿µ"': '"å¼·å›ºãªä¿¡å¿µã‚’æŒã£ã¦é€²ã‚€"',
      '"æŸ”è»Ÿãªæ€è€ƒ"': '"æŸ”è»Ÿãªæ€è€ƒã§å¯¾å¿œã™ã‚‹"',
      '"å‰µé€ çš„ãªåŠ›"': '"å‰µé€ çš„ãªåŠ›ã‚’ç™ºæ®ã™ã‚‹"',
      '"æŒç¶šçš„ãªæˆé•·"': '"æŒç¶šçš„ãªæˆé•·ã‚’ç¶šã‘ã‚‹"',
      '"èª¿å’Œçš„ãªçµ±åˆ"': '"èª¿å’Œçš„ãªçµ±åˆã‚’å®Ÿç¾ã™ã‚‹"',
      '"ç™ºå±•çš„ãªé–¢ä¿‚"': '"ç™ºå±•çš„ãªé–¢ä¿‚ã‚’æ§‹ç¯‰ã™ã‚‹"',
      '"é©æ–°çš„ãªç™ºæƒ³"': '"é©æ–°çš„ãªç™ºæƒ³ã‚’ç”Ÿã¿å‡ºã™"',
      '"å»ºè¨­çš„ãªææ¡ˆ"': '"å»ºè¨­çš„ãªææ¡ˆã‚’è¡Œã†"',
      '"å®Ÿè·µçš„ãªçŸ¥æµ"': '"å®Ÿè·µçš„ãªçŸ¥æµã‚’æ´»ç”¨ã™ã‚‹"',
      '"åŒ…æ‹¬çš„ãªè¦–é‡"': '"åŒ…æ‹¬çš„ãªè¦–é‡ã‚’æŒã¤"',
      '"æˆ¦ç•¥çš„ãªæ€è€ƒ"': '"æˆ¦ç•¥çš„ãªæ€è€ƒã§è¨ˆç”»ã™ã‚‹"',
      '"ç›´æ„Ÿçš„ãªåˆ¤æ–­"': '"ç›´æ„Ÿçš„ãªåˆ¤æ–­ã‚’ä¿¡ã˜ã‚‹"',
      '"è«–ç†çš„ãªåˆ†æ"': '"è«–ç†çš„ãªåˆ†æã‚’è¡Œã†"',
      '"æ„Ÿæƒ…çš„ãªå…±æ„Ÿ"': '"æ„Ÿæƒ…çš„ãªå…±æ„Ÿã‚’ç¤ºã™"',
      '"ç²¾ç¥çš„ãªæˆé•·"': '"ç²¾ç¥çš„ãªæˆé•·ã‚’é‚ã’ã‚‹"',
      '"ç‰©è³ªçš„ãªè±Šã‹ã•"': '"ç‰©è³ªçš„ãªè±Šã‹ã•ã‚’å¾—ã‚‹"',
      '"ç¤¾ä¼šçš„ãªè²¢çŒ®"': '"ç¤¾ä¼šçš„ãªè²¢çŒ®ã‚’æœãŸã™"'
    };
    
    // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase20.${timestamp}.js`, content);
    console.log(`ğŸ“ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ: hexagram-human-traits-v3.backup.phase20.${timestamp}.js\n`);
    
    // ä¿®æ­£é©ç”¨
    let totalFixCount = 0;
    let successfulFixes = [];
    
    console.log('7æ–‡å­—ã®ä¿®æ­£ã‚’é©ç”¨ä¸­...\n');
    
    Object.entries(sevenCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const matches = content.match(regex);
      if (matches) {
        content = content.replace(regex, newText);
        totalFixCount += matches.length;
        successfulFixes.push(`${old} â†’ ${newText} (${matches.length}ç®‡æ‰€)`);
      }
    });
    
    // æˆåŠŸã—ãŸä¿®æ­£ã‚’è¡¨ç¤º
    console.log('ã€ä¿®æ­£æˆåŠŸé …ç›®ã€‘');
    if (successfulFixes.length > 0) {
      successfulFixes.slice(0, 20).forEach(fix => {
        console.log(`âœ… ${fix}`);
      });
      if (successfulFixes.length > 20) {
        console.log(`... ä»– ${successfulFixes.length - 20}ä»¶`);
      }
    } else {
      console.log('ä¿®æ­£å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
    }
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`\n=== ãƒ•ã‚§ãƒ¼ã‚º20å®Œäº† ===`);
    console.log(`ç·ä¿®æ­£ä»¶æ•°: ${totalFixCount}ä»¶`);
    console.log(`ä¿®æ­£æˆåŠŸé …ç›®: ${successfulFixes.length}ç¨®é¡`);
    console.log(`\næ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º: node fix-short-descriptions-phase21-remaining-eight.mjs`);
    
  } catch (error) {
    console.error('ã‚¨ãƒ©ãƒ¼:', error);
  }
}

fixPhase20RemainingSeven();