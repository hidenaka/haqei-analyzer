<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>体系的パターン検証</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
        }
        .validation-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #444; 
            border-radius: 8px;
        }
        .valid { background-color: rgba(16, 185, 129, 0.1); }
        .invalid { background-color: rgba(239, 68, 68, 0.1); }
        .progress { 
            margin: 10px 0;
            padding: 5px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { opacity: 0.9; }
        #results {
            max-height: 600px;
            overflow-y: auto;
            font-size: 12px;
        }
        .hexagram-result {
            margin: 2px 0;
            padding: 3px 5px;
            border-radius: 3px;
        }
        .role-section {
            margin: 15px 0;
            padding: 10px;
            border-left: 4px solid #3b82f6;
        }
    </style>
</head>
<body>
    <h1>🔍 体系的パターン検証システム</h1>
    <p>全64卦×3役割 = 192パターンの包括的正常性確認</p>

    <div class="validation-section">
        <h2>検証制御</h2>
        <button onclick="validateBasicEight()">基本8卦 (1-8) 検証</button>
        <button onclick="validateSpecificRange(9, 16)">第9-16卦検証</button>
        <button onclick="validateSpecificRange(17, 32)">第17-32卦検証</button>
        <button onclick="validateSpecificRange(33, 48)">第33-48卦検証</button>
        <button onclick="validateSpecificRange(49, 64)">第49-64卦検証</button>
        <button onclick="validateAllPatterns()">🎯 全192パターン検証</button>
    </div>

    <div class="validation-section">
        <h2>進捗状況</h2>
        <div id="progress"></div>
    </div>

    <div class="validation-section">
        <h2>検証結果</h2>
        <div id="results"></div>
    </div>

    <div class="validation-section">
        <h2>統計サマリー</h2>
        <div id="summary"></div>
    </div>

    <script src="./public/assets/H384H64database.js"></script>
    <script src="./public/js/core/TripleOSInteractionAnalyzer.js"></script>
    <script src="./systematic-validation-framework.js"></script>
    <script>
        let validator = new SystematicValidationFramework();
        
        function updateProgress(message) {
            document.getElementById('progress').innerHTML = `<div class="progress">${message}</div>`;
        }
        
        function updateResults(html, append = false) {
            const resultsDiv = document.getElementById('results');
            if (append) {
                resultsDiv.innerHTML += html;
            } else {
                resultsDiv.innerHTML = html;
            }
        }
        
        function updateSummary(html) {
            document.getElementById('summary').innerHTML = html;
        }
        
        function validateBasicEight() {
            updateProgress('基本8卦の検証を開始...');
            updateResults('');
            
            const basicEight = [1, 2, 3, 4, 5, 6, 7, 8];
            const roles = ['engine-interface', 'engine-safe', 'interface-safe'];
            const results = {};
            
            let html = '<h3>基本8卦検証結果</h3>';
            
            basicEight.forEach(hexagramId => {
                html += `<div class="hexagram-section">`;
                html += `<h4>${hexagramId}. ${getHexagramName(hexagramId)}</h4>`;
                
                roles.forEach(role => {
                    const result = validator.validatePattern(hexagramId, role);
                    const className = result.isValid ? 'valid' : 'invalid';
                    const status = result.isValid ? '✅' : '❌';
                    
                    html += `<div class="hexagram-result ${className}">`;
                    html += `${status} ${role}: ${result.category} (${result.synergy?.toFixed(3) || 'ERROR'})`;
                    if (!result.isValid) {
                        html += ` - ${result.error || '論理チェック失敗'}`;
                    }
                    html += `</div>`;
                });
                
                html += `</div>`;
            });
            
            updateResults(html);
            updateProgress(`基本8卦検証完了 - 正常: ${validator.validatedPatterns.size}/${basicEight.length * 3}`);
            generatePartialSummary();
        }
        
        function validateSpecificRange(start, end) {
            updateProgress(`第${start}-${end}卦の検証を開始...`);
            updateResults('');
            
            const roles = ['engine-interface', 'engine-safe', 'interface-safe'];
            let html = `<h3>第${start}-${end}卦検証結果</h3>`;
            
            for (let hexagramId = start; hexagramId <= end; hexagramId++) {
                html += `<div class="hexagram-section">`;
                html += `<h4>${hexagramId}. ${getHexagramName(hexagramId)}</h4>`;
                
                roles.forEach(role => {
                    const result = validator.validatePattern(hexagramId, role);
                    const className = result.isValid ? 'valid' : 'invalid';
                    const status = result.isValid ? '✅' : '❌';
                    
                    html += `<div class="hexagram-result ${className}">`;
                    html += `${status} ${role}: ${result.category} (${result.synergy?.toFixed(3) || 'ERROR'})`;
                    if (!result.isValid) {
                        html += ` - ${result.error || '論理チェック失敗'}`;
                    }
                    html += `</div>`;
                });
                
                html += `</div>`;
            }
            
            updateResults(html);
            const total = (end - start + 1) * 3;
            updateProgress(`第${start}-${end}卦検証完了`);
            generatePartialSummary();
        }
        
        function validateAllPatterns() {
            updateProgress('全192パターンの包括的検証を開始...');
            updateResults('<h3>全パターン検証実行中...</h3>');
            
            setTimeout(() => {
                const allResults = validator.validateAllPatterns();
                displayComprehensiveResults(allResults);
            }, 100);
        }
        
        function displayComprehensiveResults(allResults) {
            let html = '<h3>全192パターン検証結果</h3>';
            
            Object.entries(allResults).forEach(([role, results]) => {
                html += `<div class="role-section">`;
                html += `<h4>${role} (64パターン)</h4>`;
                
                const validCount = results.filter(r => r.isValid).length;
                const validPercentage = (validCount / 64 * 100).toFixed(1);
                
                html += `<p>正常: ${validCount}/64 (${validPercentage}%)</p>`;
                
                // 問題のあるパターンをハイライト
                const problematic = results.filter(r => !r.isValid);
                if (problematic.length > 0) {
                    html += `<p style="color: #ef4444">問題: ${problematic.length}件</p>`;
                    problematic.forEach(p => {
                        html += `<div class="hexagram-result invalid">`;
                        html += `❌ 第${p.hexagramId}卦: ${p.error || 'チェック失敗'}`;
                        html += `</div>`;
                    });
                }
                
                html += `</div>`;
            });
            
            updateResults(html);
            generateFinalSummary(allResults);
        }
        
        function generatePartialSummary() {
            const validCount = validator.validatedPatterns.size;
            const problematicCount = validator.problematicPatterns.length;
            const total = validCount + problematicCount;
            
            let html = `<h3>部分検証統計</h3>`;
            html += `<p>検証済み: ${total}パターン</p>`;
            html += `<p>✅ 正常: ${validCount} (${(validCount/total*100).toFixed(1)}%)</p>`;
            html += `<p>❌ 問題: ${problematicCount} (${(problematicCount/total*100).toFixed(1)}%)</p>`;
            
            updateSummary(html);
        }
        
        function generateFinalSummary(allResults) {
            let totalValid = 0;
            let totalProblematic = 0;
            
            Object.values(allResults).forEach(results => {
                totalValid += results.filter(r => r.isValid).length;
                totalProblematic += results.filter(r => !r.isValid).length;
            });
            
            let html = `<h3>最終検証統計</h3>`;
            html += `<p><strong>全体統計 (192パターン)</strong></p>`;
            html += `<p>✅ 正常: ${totalValid}/192 (${(totalValid/192*100).toFixed(1)}%)</p>`;
            html += `<p>❌ 問題: ${totalProblematic}/192 (${(totalProblematic/192*100).toFixed(1)}%)</p>`;
            
            if (totalValid === 192) {
                html += `<p style="color: #10b981; font-weight: bold">🎉 全パターン正常動作確認完了！</p>`;
            } else {
                html += `<p style="color: #f59e0b; font-weight: bold">⚠️ ${totalProblematic}件の問題が要修正</p>`;
            }
            
            updateSummary(html);
        }
        
        function getHexagramName(id) {
            const names = {
                1: '乾為天', 2: '坤為地', 3: '水雷屯', 4: '山水蒙', 5: '水天需',
                6: '天水訟', 7: '地水師', 8: '水地比', 9: '風天小畜', 10: '天沢履',
                11: '地天泰', 12: '天地否', 13: '天火同人', 14: '火天大有', 15: '地山謙',
                16: '雷地豫', 17: '沢雷随', 18: '山風蠱', 19: '地沢臨', 20: '風地観'
            };
            return names[id] || `第${id}卦`;
        }
    </script>
</body>
</html>