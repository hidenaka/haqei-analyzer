<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ä½“ç³»çš„ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œè¨¼</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
        }
        .validation-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #444; 
            border-radius: 8px;
        }
        .valid { background-color: rgba(16, 185, 129, 0.1); }
        .invalid { background-color: rgba(239, 68, 68, 0.1); }
        .progress { 
            margin: 10px 0;
            padding: 5px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { opacity: 0.9; }
        #results {
            max-height: 600px;
            overflow-y: auto;
            font-size: 12px;
        }
        .hexagram-result {
            margin: 2px 0;
            padding: 3px 5px;
            border-radius: 3px;
        }
        .role-section {
            margin: 15px 0;
            padding: 10px;
            border-left: 4px solid #3b82f6;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ä½“ç³»çš„ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </h1>
    <p>å…¨64å¦Ã—3å½¹å‰² = 192ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åŒ…æ‹¬çš„æ­£å¸¸æ€§ç¢ºèª</p>

    <div class="validation-section">
        <h2>æ¤œè¨¼åˆ¶å¾¡</h2>
        <button onclick="validateBasicEight()">åŸºæœ¬8å¦ (1-8) æ¤œè¨¼</button>
        <button onclick="validateSpecificRange(9, 16)">ç¬¬9-16å¦æ¤œè¨¼</button>
        <button onclick="validateSpecificRange(17, 32)">ç¬¬17-32å¦æ¤œè¨¼</button>
        <button onclick="validateSpecificRange(33, 48)">ç¬¬33-48å¦æ¤œè¨¼</button>
        <button onclick="validateSpecificRange(49, 64)">ç¬¬49-64å¦æ¤œè¨¼</button>
        <button onclick="validateAllPatterns()">ğŸ¯ å…¨192ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œè¨¼</button>
    </div>

    <div class="validation-section">
        <h2>é€²æ—çŠ¶æ³</h2>
        <div id="progress"></div>
    </div>

    <div class="validation-section">
        <h2>æ¤œè¨¼çµæœ</h2>
        <div id="results"></div>
    </div>

    <div class="validation-section">
        <h2>çµ±è¨ˆã‚µãƒãƒªãƒ¼</h2>
        <div id="summary"></div>
    </div>

    <script src="./public/assets/H384H64database.js"></script>
    <script src="./public/js/core/TripleOSInteractionAnalyzer.js"></script>
    <script src="./systematic-validation-framework.js"></script>
    <script>
        let validator = new SystematicValidationFramework();
        
        function updateProgress(message) {
            document.getElementById('progress').innerHTML = `<div class="progress">${message}</div>`;
        }
        
        function updateResults(html, append = false) {
            const resultsDiv = document.getElementById('results');
            if (append) {
                resultsDiv.innerHTML += html;
            } else {
                resultsDiv.innerHTML = html;
            }
        }
        
        function updateSummary(html) {
            document.getElementById('summary').innerHTML = html;
        }
        
        function validateBasicEight() {
            updateProgress('åŸºæœ¬8å¦ã®æ¤œè¨¼ã‚’é–‹å§‹...');
            updateResults('');
            
            const basicEight = [1, 2, 3, 4, 5, 6, 7, 8];
            const roles = ['engine-interface', 'engine-safe', 'interface-safe'];
            const results = {};
            
            let html = '<h3>åŸºæœ¬8å¦æ¤œè¨¼çµæœ</h3>';
            
            basicEight.forEach(hexagramId => {
                html += `<div class="hexagram-section">`;
                html += `<h4>${hexagramId}. ${getHexagramName(hexagramId)}</h4>`;
                
                roles.forEach(role => {
                    const result = validator.validatePattern(hexagramId, role);
                    const className = result.isValid ? 'valid' : 'invalid';
                    const status = result.isValid ? 'âœ…' : 'âŒ';
                    
                    html += `<div class="hexagram-result ${className}">`;
                    html += `${status} ${role}: ${result.category} (${result.synergy?.toFixed(3) || 'ERROR'})`;
                    if (!result.isValid) {
                        html += ` - ${result.error || 'è«–ç†ãƒã‚§ãƒƒã‚¯å¤±æ•—'}`;
                    }
                    html += `</div>`;
                });
                
                html += `</div>`;
            });
            
            updateResults(html);
            updateProgress(`åŸºæœ¬8å¦æ¤œè¨¼å®Œäº† - æ­£å¸¸: ${validator.validatedPatterns.size}/${basicEight.length * 3}`);
            generatePartialSummary();
        }
        
        function validateSpecificRange(start, end) {
            updateProgress(`ç¬¬${start}-${end}å¦ã®æ¤œè¨¼ã‚’é–‹å§‹...`);
            updateResults('');
            
            const roles = ['engine-interface', 'engine-safe', 'interface-safe'];
            let html = `<h3>ç¬¬${start}-${end}å¦æ¤œè¨¼çµæœ</h3>`;
            
            for (let hexagramId = start; hexagramId <= end; hexagramId++) {
                html += `<div class="hexagram-section">`;
                html += `<h4>${hexagramId}. ${getHexagramName(hexagramId)}</h4>`;
                
                roles.forEach(role => {
                    const result = validator.validatePattern(hexagramId, role);
                    const className = result.isValid ? 'valid' : 'invalid';
                    const status = result.isValid ? 'âœ…' : 'âŒ';
                    
                    html += `<div class="hexagram-result ${className}">`;
                    html += `${status} ${role}: ${result.category} (${result.synergy?.toFixed(3) || 'ERROR'})`;
                    if (!result.isValid) {
                        html += ` - ${result.error || 'è«–ç†ãƒã‚§ãƒƒã‚¯å¤±æ•—'}`;
                    }
                    html += `</div>`;
                });
                
                html += `</div>`;
            }
            
            updateResults(html);
            const total = (end - start + 1) * 3;
            updateProgress(`ç¬¬${start}-${end}å¦æ¤œè¨¼å®Œäº†`);
            generatePartialSummary();
        }
        
        function validateAllPatterns() {
            updateProgress('å…¨192ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åŒ…æ‹¬çš„æ¤œè¨¼ã‚’é–‹å§‹...');
            updateResults('<h3>å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œè¨¼å®Ÿè¡Œä¸­...</h3>');
            
            setTimeout(() => {
                const allResults = validator.validateAllPatterns();
                displayComprehensiveResults(allResults);
            }, 100);
        }
        
        function displayComprehensiveResults(allResults) {
            let html = '<h3>å…¨192ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œè¨¼çµæœ</h3>';
            
            Object.entries(allResults).forEach(([role, results]) => {
                html += `<div class="role-section">`;
                html += `<h4>${role} (64ãƒ‘ã‚¿ãƒ¼ãƒ³)</h4>`;
                
                const validCount = results.filter(r => r.isValid).length;
                const validPercentage = (validCount / 64 * 100).toFixed(1);
                
                html += `<p>æ­£å¸¸: ${validCount}/64 (${validPercentage}%)</p>`;
                
                // å•é¡Œã®ã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                const problematic = results.filter(r => !r.isValid);
                if (problematic.length > 0) {
                    html += `<p style="color: #ef4444">å•é¡Œ: ${problematic.length}ä»¶</p>`;
                    problematic.forEach(p => {
                        html += `<div class="hexagram-result invalid">`;
                        html += `âŒ ç¬¬${p.hexagramId}å¦: ${p.error || 'ãƒã‚§ãƒƒã‚¯å¤±æ•—'}`;
                        html += `</div>`;
                    });
                }
                
                html += `</div>`;
            });
            
            updateResults(html);
            generateFinalSummary(allResults);
        }
        
        function generatePartialSummary() {
            const validCount = validator.validatedPatterns.size;
            const problematicCount = validator.problematicPatterns.length;
            const total = validCount + problematicCount;
            
            let html = `<h3>éƒ¨åˆ†æ¤œè¨¼çµ±è¨ˆ</h3>`;
            html += `<p>æ¤œè¨¼æ¸ˆã¿: ${total}ãƒ‘ã‚¿ãƒ¼ãƒ³</p>`;
            html += `<p>âœ… æ­£å¸¸: ${validCount} (${(validCount/total*100).toFixed(1)}%)</p>`;
            html += `<p>âŒ å•é¡Œ: ${problematicCount} (${(problematicCount/total*100).toFixed(1)}%)</p>`;
            
            updateSummary(html);
        }
        
        function generateFinalSummary(allResults) {
            let totalValid = 0;
            let totalProblematic = 0;
            
            Object.values(allResults).forEach(results => {
                totalValid += results.filter(r => r.isValid).length;
                totalProblematic += results.filter(r => !r.isValid).length;
            });
            
            let html = `<h3>æœ€çµ‚æ¤œè¨¼çµ±è¨ˆ</h3>`;
            html += `<p><strong>å…¨ä½“çµ±è¨ˆ (192ãƒ‘ã‚¿ãƒ¼ãƒ³)</strong></p>`;
            html += `<p>âœ… æ­£å¸¸: ${totalValid}/192 (${(totalValid/192*100).toFixed(1)}%)</p>`;
            html += `<p>âŒ å•é¡Œ: ${totalProblematic}/192 (${(totalProblematic/192*100).toFixed(1)}%)</p>`;
            
            if (totalValid === 192) {
                html += `<p style="color: #10b981; font-weight: bold">ğŸ‰ å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³æ­£å¸¸å‹•ä½œç¢ºèªå®Œäº†ï¼</p>`;
            } else {
                html += `<p style="color: #f59e0b; font-weight: bold">âš ï¸ ${totalProblematic}ä»¶ã®å•é¡ŒãŒè¦ä¿®æ­£</p>`;
            }
            
            updateSummary(html);
        }
        
        function getHexagramName(id) {
            const names = {
                1: 'ä¹¾ç‚ºå¤©', 2: 'å¤ç‚ºåœ°', 3: 'æ°´é›·å±¯', 4: 'å±±æ°´è’™', 5: 'æ°´å¤©éœ€',
                6: 'å¤©æ°´è¨Ÿ', 7: 'åœ°æ°´å¸«', 8: 'æ°´åœ°æ¯”', 9: 'é¢¨å¤©å°ç•œ', 10: 'å¤©æ²¢å±¥',
                11: 'åœ°å¤©æ³°', 12: 'å¤©åœ°å¦', 13: 'å¤©ç«åŒäºº', 14: 'ç«å¤©å¤§æœ‰', 15: 'åœ°å±±è¬™',
                16: 'é›·åœ°è±«', 17: 'æ²¢é›·éš', 18: 'å±±é¢¨è ±', 19: 'åœ°æ²¢è‡¨', 20: 'é¢¨åœ°è¦³'
            };
            return names[id] || `ç¬¬${id}å¦`;
        }
    </script>
</body>
</html>