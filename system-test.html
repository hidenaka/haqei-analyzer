<\!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI システムテスト結果</title>
    <style>
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: #fff; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: #2a2a2a; padding: 30px; border-radius: 10px; }
        .section { background: #3a3a3a; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .success { border-left: 4px solid #10b981; }
        .warning { border-left: 4px solid #f59e0b; }
        .error { border-left: 4px solid #ef4444; }
        .test-button { background: #6366f1; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .result { background: #1f1f1f; padding: 15px; border-radius: 5px; font-family: monospace; margin: 10px 0; }
        iframe { width: 100%; height: 600px; border: 2px solid #6366f1; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 HAQEI OS Analyzer システムテスト</h1>
        
        <div class="section success">
            <h2>✅ 基本システム状況</h2>
            <ul>
                <li>✅ サーバー稼働中: localhost:8000</li>
                <li>✅ os_analyzer.html アクセス可能</li>
                <li>✅ 主要JavaScriptファイル存在確認済み</li>
                <li>✅ CSSファイル読み込み設定完了</li>
            </ul>
        </div>

        <div class="section">
            <h2>🚀 リアルタイムテスト</h2>
            <button class="test-button" onclick="runQuickTest()">クイックテスト実行</button>
            <button class="test-button" onclick="checkConsoleErrors()">コンソールエラー確認</button>
            <button class="test-button" onclick="testQuestionFlow()">質問フロー確認</button>
            <div id="testResults" class="result">テスト結果がここに表示されます...</div>
        </div>

        <div class="section">
            <h2>📱 OS Analyzer 実機テスト</h2>
            <iframe src="http://localhost:8000/public/os_analyzer.html" id="testFrame"></iframe>
        </div>
    </div>

    <script>
        function log(message) {
            const testResults = document.getElementById("testResults");
            const timestamp = new Date().toLocaleTimeString();
            testResults.innerHTML += "[" + timestamp + "] " + message + "<br>";
            testResults.scrollTop = testResults.scrollHeight;
        }
        
        function runQuickTest() {
            log("🎯 クイックテスト開始");
            
            const iframe = document.getElementById("testFrame");
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            setTimeout(() => {
                log("iframe読み込み待機中...");
                
                setTimeout(() => {
                    const iframeWindow = iframe.contentWindow;
                    
                    // 基本オブジェクト確認
                    if (iframeWindow.CacheManager) {
                        log("✅ CacheManager 利用可能");
                    } else {
                        log("⚠️ CacheManager 未読み込み");
                    }
                    
                    if (iframeWindow.VirtualQuestionFlow) {
                        log("✅ VirtualQuestionFlow 利用可能");
                    } else {
                        log("⚠️ VirtualQuestionFlow 未読み込み");
                    }
                    
                    if (iframeWindow.WORLDVIEW_QUESTIONS) {
                        log("✅ WORLDVIEW_QUESTIONS: " + iframeWindow.WORLDVIEW_QUESTIONS.length + "問");
                    } else {
                        log("⚠️ WORLDVIEW_QUESTIONS 未読み込み");
                    }
                    
                    if (iframeWindow.SCENARIO_QUESTIONS) {
                        log("✅ SCENARIO_QUESTIONS: " + iframeWindow.SCENARIO_QUESTIONS.length + "問");
                    } else {
                        log("⚠️ SCENARIO_QUESTIONS 未読み込み");
                    }
                    
                    if (iframeWindow.app) {
                        log("✅ app オブジェクト初期化済み");
                    } else {
                        log("⚠️ app オブジェクト未初期化");
                    }
                    
                    log("🏁 クイックテスト完了");
                }, 3000);
            }, 1000);
        }
        
        function checkConsoleErrors() {
            log("🛡️ コンソールエラー監視開始");
            
            const iframe = document.getElementById("testFrame");
            setTimeout(() => {
                const iframeWindow = iframe.contentWindow;
                let errorCount = 0;
                
                // エラー監視
                const originalError = iframeWindow.console.error;
                iframeWindow.console.error = function(...args) {
                    errorCount++;
                    log("❌ エラー検出: " + args.join(" "));
                    originalError.apply(console, args);
                };
                
                const originalWarn = iframeWindow.console.warn;
                iframeWindow.console.warn = function(...args) {
                    log("⚠️ 警告: " + args.join(" "));
                    originalWarn.apply(console, args);
                };
                
                setTimeout(() => {
                    log("📊 監視結果 - エラー数: " + errorCount);
                }, 5000);
                
            }, 2000);
        }
        
        function testQuestionFlow() {
            log("📝 質問フロー詳細テスト開始");
            
            const iframe = document.getElementById("testFrame");
            setTimeout(() => {
                const iframeWindow = iframe.contentWindow;
                
                if (iframeWindow.app && iframeWindow.app.questionFlow) {
                    const qf = iframeWindow.app.questionFlow;
                    log("📋 質問フロー発見 - 現在のインデックス: " + qf.currentQuestionIndex);
                    
                    if (qf.questions) {
                        log("📚 総質問数: " + qf.questions.length);
                    }
                    
                    if (qf.answers) {
                        log("📝 現在の回答数: " + qf.answers.length);
                    }
                    
                    // 全質問表示テスト
                    if (typeof qf.testAllQuestionsDisplay === "function") {
                        log("🧪 全質問表示テスト実行中...");
                        qf.testAllQuestionsDisplay().then(results => {
                            log("✅ 表示テスト完了 - 成功: " + results.passed + "/" + results.total);
                            if (results.evenQuestions) {
                                log("📊 偶数番設問成功率: " + (results.evenQuestions.passed / results.evenQuestions.total * 100).toFixed(1) + "%");
                            }
                        }).catch(error => {
                            log("❌ 表示テストエラー: " + error.message);
                        });
                    }
                } else {
                    log("❌ 質問フローが初期化されていません");
                }
            }, 3000);
        }
        
        // 初期化
        log("🚀 HAQEI システムテストツール準備完了");
        
        // iframe読み込み監視
        document.getElementById("testFrame").onload = function() {
            log("✅ OS Analyzer iframe 読み込み完了");
        };
    </script>
</body>
</html>
