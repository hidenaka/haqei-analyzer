<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>HAQEI Visual Test</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            padding: 20px;
            margin: 0;
            background: #f8f9fa;
        }
        .test-header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            margin: 0;
            color: #1e293b;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .status-item {
            padding: 10px;
            background: #f0f9ff;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        .status-item.success {
            border-left-color: #10b981;
            background: #d1fae5;
        }
        .status-item.error {
            border-left-color: #ef4444;
            background: #fee2e2;
        }
        .test-button {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>ğŸ” HAQEI Results Page ãƒ†ã‚¹ãƒˆ</h1>
        <div id="status-grid" class="status-grid"></div>
    </div>
    
    <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
        <h2>ãƒ†ã‚¹ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
        <button class="test-button" onclick="testInitialization()">åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="generateTestData()">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ</button>
        <button class="test-button" onclick="clearErrors()">ã‚¨ãƒ©ãƒ¼ã‚¯ãƒªã‚¢</button>
        <button class="test-button" onclick="forceDisplay()">å¼·åˆ¶è¡¨ç¤º</button>
        <button class="test-button" onclick="openResultsPage()">Results.html ã‚’é–‹ã</button>
    </div>
    
    <div style="background: white; padding: 20px; border-radius: 12px;">
        <h2>ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</h2>
        <pre id="console-output" style="background: #1e293b; color: #e2e8f0; padding: 15px; border-radius: 8px; overflow-x: auto; min-height: 200px;"></pre>
    </div>

    <script>
        const output = document.getElementById('console-output');
        const statusGrid = document.getElementById('status-grid');
        
        function log(message) {
            output.textContent += message + '\n';
            console.log(message);
        }
        
        function updateStatus(label, value, success = true) {
            let item = document.getElementById(`status-${label}`);
            if (!item) {
                item = document.createElement('div');
                item.id = `status-${label}`;
                item.className = 'status-item';
                statusGrid.appendChild(item);
            }
            item.className = `status-item ${success ? 'success' : 'error'}`;
            item.innerHTML = `<strong>${label}:</strong> ${value}`;
        }
        
        async function testInitialization() {
            log('ğŸ“ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            // localStorageãƒã‚§ãƒƒã‚¯
            const hasData = localStorage.getItem('haqei_analysis_result');
            updateStatus('LocalStorage', hasData ? 'ãƒ‡ãƒ¼ã‚¿ã‚ã‚Š' : 'ãƒ‡ãƒ¼ã‚¿ãªã—', !!hasData);
            
            // ãƒšãƒ¼ã‚¸çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
            const response = await fetch('http://localhost:8012/public/results.html');
            const html = await response.text();
            updateStatus('HTMLå–å¾—', response.ok ? 'OK' : 'ã‚¨ãƒ©ãƒ¼', response.ok);
            
            // å¿…è¦ãªJSãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
            const jsFiles = [
                'js/shared/core/StorageManager.js',
                'js/components/TabNavigator.js',
                'js/components/tabs/BasicResultsTab.js'
            ];
            
            for (const file of jsFiles) {
                const res = await fetch(`http://localhost:8012/public/${file}`);
                updateStatus(file.split('/').pop(), res.ok ? 'OK' : '404', res.ok);
            }
            
            log('âœ… åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆå®Œäº†');
        }
        
        function generateTestData() {
            log('ğŸ“ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆä¸­...');
            
            const testData = {
                engineOS: {
                    name: 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ»ã‚¨ãƒ³ã‚¸ãƒ³',
                    score: 85,
                    hexagram: { symbol: 'â˜°', name: 'ä¹¾ä¸ºå¤©', number: 1 },
                    traits: ['å‰µé€ çš„', 'ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—', 'é©æ–°çš„', 'ç‹¬ç«‹å¿ƒ', 'å…ˆè¦‹æ€§'],
                    description: 'å¼·ã„å‰µé€ æ€§ã¨ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—'
                },
                interfaceOS: {
                    name: 'ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹',
                    score: 78,
                    hexagram: { symbol: 'â˜±', name: 'å…Œä¸ºæ³½', number: 58 },
                    traits: ['å”èª¿çš„', 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³', 'æ¥½è¦³çš„', 'æŸ”è»Ÿæ€§'],
                    description: 'äººã¨ã®èª¿å’Œã‚’é‡è¦–'
                },
                safeModeOS: {
                    name: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ã‚¬ãƒ¼ãƒ‡ã‚£ã‚¢ãƒ³',
                    score: 72,
                    hexagram: { symbol: 'â˜·', name: 'å¤ä¸ºåœ°', number: 2 },
                    traits: ['å®‰å®šå¿—å‘', 'æ…é‡', 'ä¿å®ˆçš„', 'æ”¯æ´çš„'],
                    description: 'å¿ƒã®å®‰å…¨ã‚’å®ˆã‚‹'
                }
            };
            
            const dataToSave = {
                result: testData,
                timestamp: Date.now(),
                version: '2025.08.19'
            };
            
            localStorage.setItem('haqei_analysis_result', JSON.stringify(dataToSave));
            localStorage.setItem('haqei_analyzer_analysis_result', JSON.stringify(testData));
            
            updateStatus('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿', 'ç”Ÿæˆå®Œäº†', true);
            log('âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        }
        
        function clearErrors() {
            log('ğŸ§¹ ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ä¸­...');
            
            // localStorageã«å¼·åˆ¶çš„ã«ã‚¨ãƒ©ãƒ¼ãƒ•ãƒ©ã‚°ã‚’ã‚¯ãƒªã‚¢
            localStorage.setItem('haqei_error_cleared', 'true');
            
            updateStatus('ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹', 'ã‚¯ãƒªã‚¢æ¸ˆã¿', true);
            log('âœ… ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }
        
        function forceDisplay() {
            log('ğŸ’ª å¼·åˆ¶è¡¨ç¤ºå®Ÿè¡Œä¸­...');
            
            // æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹ã„ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
            const win = window.open('http://localhost:8012/public/results.html', '_blank');
            
            setTimeout(() => {
                log('âš¡ 5ç§’å¾Œã«å¼·åˆ¶è¡¨ç¤ºã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:');
                log('document.getElementById("loading-overlay").style.display = "none";');
                log('document.getElementById("error-container").style.display = "none";');
            }, 1000);
        }
        
        function openResultsPage() {
            window.open('http://localhost:8012/public/results.html', '_blank');
            log('ğŸŒ Results.htmlã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã¾ã—ãŸ');
        }
        
        // åˆæœŸãƒã‚§ãƒƒã‚¯
        testInitialization();
    </script>
</body>
</html>