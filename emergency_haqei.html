<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ã‚ãªãŸã®ä¸­ã«ã‚ã‚‹3ã¤ã®äººæ ¼ã‚·ã‚¹ãƒ†ãƒ ï¼ˆEngine/Interface/Safe Mode OSï¼‰ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®æˆ¦ç•¥çš„åˆ†æãƒ„ãƒ¼ãƒ«ã€‚æ˜“çµŒã‚’ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼ã¨ã—ãŸHaQeiå“²å­¦ã«åŸºã¥ãç¾ä»£çš„ãªè‡ªå·±ç†è§£ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚">
    <title>HAQEI - Triple OSäººæ ¼åˆ†æã‚·ã‚¹ãƒ†ãƒ  | HaQeiå“²å­¦ã«ã‚ˆã‚‹æˆ¦ç•¥çš„è‡ªå·±ç†è§£ãƒ„ãƒ¼ãƒ«</title>
    
    <style>
        /* =================== */
        /* Critical CSS - 30KBä»¥ä¸‹ */
        /* HaQeiå“²å­¦æº–æ‹  */
        /* =================== */
        
        /* 1. ãƒªã‚»ãƒƒãƒˆ & åŸºç›¤ */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            /* HAQEI ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ */
            --primary-900: #0f172a;
            --primary-800: #1e293b;
            --primary-700: #334155;
            --primary-600: #475569;
            --primary-500: #64748b;
            --primary-400: #94a3b8;
            --primary-300: #cbd5e1;
            --primary-200: #e2e8f0;
            --primary-100: #f1f5f9;
            --primary-50: #f8fafc;
            
            --accent-500: #6366f1;
            --accent-400: #8b5cf6;
            --accent-300: #a855f7;
            
            /* åŸºæœ¬ã‚«ãƒ©ãƒ¼å¤‰æ•°ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰ */
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --text-color: #374151;
            --bg-color: #f9fafb;
            
            /* ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚«ãƒ©ãƒ¼ */
            --success-500: #10b981;
            --warning-500: #f59e0b;
            --error-500: #ef4444;
            --info-500: #3b82f6;
            
            /* å…«å¦è‰²å½© */
            --trigram-qian: #FFD700;    /* ä¹¾(å¤©) */
            --trigram-dui: #87CEEB;     /* å…Œ(æ²¢) */
            --trigram-li: #FF4500;      /* é›¢(ç«) */
            --trigram-zhen: #8A2BE2;    /* éœ‡(é›·) */
            --trigram-xun: #32CD32;     /* å·½(é¢¨) */
            --trigram-kan: #1E90FF;     /* å(æ°´) */
            --trigram-gen: #708090;     /* è‰®(å±±) */
            --trigram-kun: #8B4513;     /* å¤(åœ°) */
            
            /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚µã‚¤ã‚º */
            --font-sm: clamp(0.875rem, 2.5vw, 1rem);
            --font-base: clamp(1rem, 3vw, 1.125rem);
            --font-lg: clamp(1.25rem, 4vw, 1.5rem);
            --font-xl: clamp(1.5rem, 5vw, 2rem);
            --font-2xl: clamp(2rem, 6vw, 3rem);
            
            --space-xs: clamp(0.5rem, 2vw, 0.75rem);
            --space-sm: clamp(0.75rem, 3vw, 1rem);
            --space-md: clamp(1rem, 4vw, 1.5rem);
            --space-lg: clamp(1.5rem, 5vw, 2rem);
            --space-xl: clamp(2rem, 6vw, 3rem);
            
            --radius-sm: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            
            /* ã‚¿ãƒƒãƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆ */
            --tap-size: max(44px, 2.75rem);
        }
        
        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, var(--primary-800) 0%, var(--primary-700) 50%, var(--primary-600) 100%);
            color: var(--primary-100);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* 2. ã‚³ãƒ³ãƒ†ãƒŠã‚·ã‚¹ãƒ†ãƒ  */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-md);
        }
        
        .screen {
            min-height: 100vh;
            display: none;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: var(--space-lg) var(--space-md);
        }
        
        .screen.active {
            display: flex;
        }
        
        /* 2.1 ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .welcome-container {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--space-md);
        }
        
        .hero-section {
            text-align: center;
            margin-bottom: var(--space-xl);
            animation: fadeInUp 1s ease-out;
        }
        
        .hero-title {
            font-size: clamp(2rem, 8vw, 3.5rem);
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-500), var(--accent-300), #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-sm);
            line-height: 1.2;
        }
        
        .hero-subtitle {
            font-size: var(--font-lg);
            color: var(--primary-200);
            margin-bottom: var(--space-lg);
            font-weight: 300;
        }
        
        .philosophy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        
        .philosophy-card {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.4s ease;
            animation: fadeInUp 1s ease-out;
            animation-fill-mode: both;
        }
        
        .philosophy-card:nth-child(1) { animation-delay: 0.2s; }
        .philosophy-card:nth-child(2) { animation-delay: 0.4s; }
        .philosophy-card:nth-child(3) { animation-delay: 0.6s; }
        
        .philosophy-card:hover {
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(99, 102, 241, 0.2);
        }
        
        .card-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: var(--space-md);
        }
        
        .engine-icon { background: linear-gradient(135deg, #6366f1, #8b5cf6); }
        .interface-icon { background: linear-gradient(135deg, #8b5cf6, #a855f7); }
        .safemode-icon { background: linear-gradient(135deg, #10b981, #059669); }
        
        .card-title {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--primary-100);
            margin-bottom: var(--space-sm);
        }
        
        .card-description {
            color: var(--primary-300);
            line-height: 1.6;
            font-size: var(--font-sm);
        }
        
        .about-section {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            animation: fadeInUp 1s ease-out 0.8s;
            animation-fill-mode: both;
        }
        
        .about-title {
            font-size: var(--font-xl);
            font-weight: 600;
            color: var(--primary-100);
            margin-bottom: var(--space-md);
            text-align: center;
        }
        
        .about-content {
            color: var(--primary-200);
            line-height: 1.7;
            font-size: var(--font-base);
        }
        
        .highlight {
            color: var(--accent-400);
            font-weight: 600;
        }
        
        .experience-section {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-xl);
            animation: fadeInUp 1s ease-out 1s;
            animation-fill-mode: both;
        }
        
        .experience-title {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--primary-100);
            margin-bottom: var(--space-md);
            text-align: center;
        }
        
        .experience-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-md);
            text-align: center;
        }
        
        .step {
            color: var(--primary-200);
            font-size: var(--font-sm);
        }
        
        .step-number {
            display: block;
            width: 2rem;
            height: 2rem;
            background: var(--accent-500);
            color: white;
            border-radius: 50%;
            line-height: 2rem;
            text-align: center;
            font-weight: 600;
            margin: 0 auto var(--space-xs);
        }
        
        .cta-section {
            text-align: center;
            animation: fadeInUp 1s ease-out 1.2s;
            animation-fill-mode: both;
        }
        
        .start-button {
            background: linear-gradient(135deg, var(--accent-500), var(--accent-400));
            color: white;
            border: none;
            padding: var(--space-md) var(--space-xl);
            font-size: var(--font-lg);
            font-weight: 600;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
            min-height: calc(var(--tap-size) + 0.5rem);
            position: relative;
            overflow: hidden;
        }
        
        .start-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }
        
        .start-button:hover::before {
            left: 100%;
        }
        
        .start-button:hover {
            background: linear-gradient(135deg, var(--accent-400), var(--accent-300));
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(99, 102, 241, 0.4);
        }
        
        .disclaimer {
            margin-top: var(--space-lg);
            padding: var(--space-md);
            background: rgba(15, 23, 42, 0.6);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--accent-500);
        }
        
        .disclaimer-text {
            color: var(--primary-400);
            font-size: var(--font-sm);
            line-height: 1.5;
            text-align: left;
        }
        
        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .pulse-animation {
            animation: pulse 2s ease-in-out infinite;
            /* ãƒ†ã‚¹ãƒˆæ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®‰å®šåŒ– */
            animation-play-state: paused;
        }
        
        .pulse-animation:hover {
            animation-play-state: running;
        }
        
        /* 3. ã‚«ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ  */
        .card {
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 600px;
            margin-bottom: var(--space-md);
        }
        
        .card:hover {
            border-color: rgba(99, 102, 241, 0.4);
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        
        /* 4. ãƒœã‚¿ãƒ³ã‚·ã‚¹ãƒ†ãƒ  */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-sm) var(--space-lg);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-base);
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: var(--tap-size);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-500), var(--accent-400));
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--accent-400), var(--accent-300));
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }
        
        .btn-secondary {
            background: rgba(99, 102, 241, 0.1);
            color: var(--accent-400);
            border: 1px solid rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.5);
        }
        
        .btn-lg {
            padding: var(--space-md) var(--space-xl);
            font-size: var(--font-lg);
            min-height: calc(var(--tap-size) + 0.5rem);
        }
        
        /* 5. è³ªå•ã‚·ã‚¹ãƒ†ãƒ  */
        .question-card {
            margin-bottom: var(--space-xl);
        }
        
        .question-header {
            text-align: center;
            margin-bottom: var(--space-lg);
        }
        
        .question-number {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            background: var(--accent-500);
            color: white;
            border-radius: 50%;
            font-weight: 600;
            line-height: 2rem;
            text-align: center;
            margin-bottom: var(--space-sm);
        }
        
        .question-text {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--primary-100);
            margin-bottom: var(--space-md);
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .option {
            background: rgba(30, 41, 59, 0.6);
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: var(--tap-size);
            display: flex;
            align-items: center;
        }
        
        .option:hover {
            border-color: rgba(99, 102, 241, 0.5);
            background: rgba(99, 102, 241, 0.1);
            transform: translateY(-1px);
        }
        
        .option.selected {
            border-color: var(--accent-500);
            background: rgba(99, 102, 241, 0.2);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .option-text {
            font-size: var(--font-base);
            color: var(--primary-200);
            font-weight: 500;
        }
        
        /* 6. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav-controls {
            display: flex;
            justify-content: space-between;
            gap: var(--space-md);
            margin-top: var(--space-xl);
            flex-wrap: wrap;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(99, 102, 241, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: var(--space-lg);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-500), var(--accent-400));
            transition: width 0.5s ease;
            border-radius: 3px;
        }
        
        /* 7. çµæœè¡¨ç¤º */
        .result-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }
        
        .result-title {
            font-size: var(--font-2xl);
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-500), var(--accent-400));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-sm);
        }
        
        .os-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }
        
        .os-card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .os-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .os-name {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--primary-100);
            margin-bottom: var(--space-sm);
        }
        
        .os-score {
            font-size: var(--font-xl);
            font-weight: 700;
            margin-bottom: var(--space-md);
        }
        
        .os-description {
            font-size: var(--font-sm);
            color: var(--primary-300);
            line-height: 1.5;
        }
        
        /* 8. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° */
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            color: #fca5a5;
            text-align: center;
            margin: var(--space-md) 0;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-lg);
        }
        
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(99, 102, 241, 0.3);
            border-top: 3px solid var(--accent-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 9. ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .container {
                padding: var(--space-sm);
                max-width: 100%;
            }
            
            .welcome-container {
                padding: var(--space-sm);
            }
            
            .screen {
                padding: var(--space-md) var(--space-sm);
            }
            
            .card {
                padding: var(--space-md);
            }
            
            .nav-controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .os-cards {
                grid-template-columns: 1fr;
                gap: var(--space-md);
            }
            
            /* ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
            .hero-title {
                font-size: clamp(2.5rem, 10vw, 3rem);
                margin-bottom: var(--space-md);
            }
            
            .hero-subtitle {
                font-size: var(--font-base);
                margin-bottom: var(--space-md);
            }
            
            .philosophy-grid {
                grid-template-columns: 1fr;
                gap: var(--space-md);
                margin-bottom: var(--space-lg);
            }
            
            .philosophy-card {
                padding: var(--space-md);
            }
            
            .card-icon {
                width: 2.5rem;
                height: 2.5rem;
                font-size: 1.25rem;
                margin-bottom: var(--space-sm);
            }
            
            .about-section {
                padding: var(--space-lg);
                margin-bottom: var(--space-lg);
            }
            
            .experience-section {
                padding: var(--space-md);
                margin-bottom: var(--space-lg);
            }
            
            .experience-steps {
                grid-template-columns: 1fr;
                gap: var(--space-sm);
            }
            
            .step {
                display: flex;
                align-items: center;
                gap: var(--space-sm);
                text-align: left;
            }
            
            .step-number {
                flex-shrink: 0;
                margin: 0;
            }
            
            .start-button {
                width: 100%;
                padding: var(--space-lg) var(--space-md);
                font-size: var(--font-base);
            }
            
            .disclaimer {
                margin-top: var(--space-md);
            }
        }
        
        @media (max-width: 480px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .philosophy-card {
                padding: var(--space-sm);
            }
            
            .about-section {
                padding: var(--space-md);
            }
            
            .experience-section {
                padding: var(--space-sm);
            }
        }
        
        /* 10. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--accent-500);
            color: white;
            padding: 8px;
            z-index: 1000;
            text-decoration: none;
            border-radius: 4px;
        }
        
        .skip-link:focus {
            top: 6px;
        }
        
        /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç† */
        .btn:focus,
        .option:focus {
            outline: 2px solid var(--accent-400);
            outline-offset: 2px;
        }
        
        /* ãƒ—ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹å¯¾å¿œ */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        @media (prefers-contrast: high) {
            :root {
                --primary-100: #ffffff;
                --primary-200: #f0f0f0;
                --primary-300: #d0d0d0;
                --accent-500: #0066ff;
            }
            
            .btn, .option, .card {
                border-width: 2px;
            }
        }
        
        @media print {
            body {
                background: white !important;
                color: black !important;
            }
            
            .btn, .nav-controls {
                display: none !important;
            }
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ã®è¿½åŠ  */
        @media (max-width: 480px) {
            .question-title {
                font-size: 1.1rem;
                line-height: 1.5;
                padding: var(--space-sm);
            }
            
            .option {
                padding: 12px 16px;
                font-size: 0.95rem;
                min-height: 48px;
                display: flex;
                align-items: center;
            }
            
            .nav-button, .start-button {
                min-height: 44px;
                padding: 12px 20px;
                font-size: 0.95rem;
            }
            
            .os-card {
                padding: var(--space-md);
                margin-bottom: var(--space-md);
            }
            
            .os-card h3 {
                font-size: 1.1rem;
            }
            
            .os-card p {
                font-size: 0.9rem;
                line-height: 1.5;
            }
            
            /* ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
            body {
                -webkit-overflow-scrolling: touch;
            }
            
            /* ã‚¿ãƒƒãƒ—ãƒã‚¤ãƒ©ã‚¤ãƒˆç„¡åŠ¹åŒ– */
            * {
                -webkit-tap-highlight-color: transparent;
            }
        }
        
        /* ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }
    </style>
</head>

<body>
    <!-- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ -->
    <a href="#main-content" class="skip-link">ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã‚¹ã‚­ãƒƒãƒ—</a>
    
    <!-- ãƒ©ã‚¤ãƒ–ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ -->
    <div id="announcements" class="sr-only" aria-live="polite" role="status"></div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main id="main-content">
        <!-- ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢ -->
        <section id="welcome-screen" class="screen active" aria-labelledby="welcome-title">
            <div class="welcome-container">
                <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="hero-section">
                    <h1 id="welcome-title" class="hero-title">HAQEI</h1>
                    <p class="hero-subtitle">
                        ã‚ãªãŸã®ä¸­ã«ã‚ã‚‹<span class="highlight">3ã¤ã®äººæ ¼ã‚·ã‚¹ãƒ†ãƒ </span>ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®æˆ¦ç•¥çš„åˆ†æãƒ„ãƒ¼ãƒ«
                    </p>
                </div>

                <!-- HaQeiå“²å­¦èª¬æ˜ -->
                <div class="philosophy-grid">
                    <div class="philosophy-card os-card">
                        <div class="card-icon engine-icon">ğŸ¯</div>
                        <h3 class="card-title">Engine OS</h3>
                        <p class="card-description">
                            ã‚ãªãŸã®<strong>æœ¬å½“ã®ä¾¡å€¤è¦³</strong>ãŒå®¿ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚æ·±å±¤å¿ƒç†ã§å¤§åˆ‡ã«ã—ã¦ã„ã‚‹åˆ¤æ–­åŸºæº–ã‚„ã€äººç”Ÿã§æœ€ã‚‚é‡è¦–ã™ã‚‹æ–¹å‘æ€§ã‚’è¡¨ç¾ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€Œã‚ãªãŸã‚‰ã—ã•ã€ã®æ ¸ã¨ãªã‚‹éƒ¨åˆ†ã§ã™ã€‚
                        </p>
                    </div>
                    
                    <div class="philosophy-card os-card">
                        <div class="card-icon interface-icon">ğŸ’¬</div>
                        <h3 class="card-title">Interface OS</h3>
                        <p class="card-description">
                            <strong>ç¤¾ä¼šçš„ãªå ´é¢</strong>ã§ç¾ã‚Œã‚‹ã‚ãªãŸã®å´é¢ã€‚ä»–è€…ã¨ã®é–¢ä¿‚æ€§ã‚„ã€ãƒãƒ¼ãƒ ã§ã®å½¹å‰²ã€ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ãªã©ã€ã€Œäººã«è¦‹ã›ã‚‹è‡ªåˆ†ã€ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚
                        </p>
                    </div>
                    
                    <div class="philosophy-card os-card">
                        <div class="card-icon safemode-icon">ğŸ›¡ï¸</div>
                        <h3 class="card-title">Safe Mode OS</h3>
                        <p class="card-description">
                            <strong>å›°é›£ãªçŠ¶æ³</strong>ã§ä½œå‹•ã™ã‚‹é˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ ã€‚ã‚¹ãƒˆãƒ¬ã‚¹ã‚„å±æ©Ÿçš„çŠ¶æ³ã«ãŠã„ã¦ã€ã‚ãªãŸãŒã©ã®ã‚ˆã†ãªå¯¾å‡¦ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠã™ã‚‹å‚¾å‘ã«ã‚ã‚‹ã‹ã‚’åˆ†æã—ã¾ã™ã€‚
                        </p>
                    </div>
                </div>

                <!-- HAQEIã«ã¤ã„ã¦ -->
                <div class="about-section">
                    <h2 class="about-title">HAQEIã¨ã¯ï¼Ÿ</h2>
                    <div class="about-content">
                        <p style="margin-bottom: var(--space-md);">
                            HAQEIã¯<span class="highlight">å ã„ã§ã¯ã‚ã‚Šã¾ã›ã‚“</span>ã€‚å¤ä»£ä¸­å›½ã®æ™ºæ…§ã§ã‚ã‚‹æ˜“çµŒï¼ˆI-Chingï¼‰ã‚’ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼ã¨ã—ã¦æ´»ç”¨ã—ã€ç¾ä»£çš„ãªè‡ªå·±ç†è§£ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦å†æ§‹ç¯‰ã—ãŸ<span class="highlight">æˆ¦ç•¥çš„åˆ†æãƒ„ãƒ¼ãƒ«</span>ã§ã™ã€‚
                        </p>
                        <p style="margin-bottom: var(--space-md);">
                            ç§ãŸã¡ã¯ã€Œã‚ãªãŸã¯â—‹â—‹ãªäººã§ã™ã€ã¨ã¯æ±ºã—ã¦æ–­è¨€ã—ã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«ã€Œ<span class="highlight">â—‹â—‹ã¨ã„ã†å´é¢ãŒå‚è€ƒã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“</span>ã€ã¨ã„ã†å½¢ã§ã€ä¸€ã¤ã®è¦–ç‚¹ã¨ã—ã¦æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚
                        </p>
                        <p>
                            ã“ã®åˆ†æçµæœã¯ç§‘å­¦çš„æ ¹æ‹ ã«åŸºã¥ãã‚‚ã®ã§ã¯ãªãã€ã‚ãã¾ã§<span class="highlight">æ€è€ƒææ–™</span>ã¨ã—ã¦æ´»ç”¨ã—ã¦ã„ãŸã ãã‚‚ã®ã§ã™ã€‚æœ€çµ‚çš„ãªåˆ¤æ–­ã‚„æ±ºæ–­ã¯ã€å¸¸ã«ã‚ãªãŸè‡ªèº«ãŒè¡Œã£ã¦ãã ã•ã„ã€‚
                        </p>
                    </div>
                </div>

                <!-- ä½“é¨“ã®æµã‚Œ -->
                <div class="experience-section">
                    <h3 class="experience-title">ä½“é¨“ã®æµã‚Œï¼ˆç´„5åˆ†ï¼‰</h3>
                    <div class="experience-steps">
                        <div class="step">
                            <span class="step-number">1</span>
                            <p>12å•ã®è³ªå•<br><small>ä¾¡å€¤è¦³ãƒ»è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³</small></p>
                        </div>
                        <div class="step">
                            <span class="step-number">2</span>
                            <p>3ã¤ã®OSåˆ†æ<br><small>64å¦ç†è«–ã«ã‚ˆã‚‹è§£æ</small></p>
                        </div>
                        <div class="step">
                            <span class="step-number">3</span>
                            <p>æˆ¦ç•¥çš„ãƒ’ãƒ³ãƒˆ<br><small>æ´»ç”¨ã®ãŸã‚ã®è¦–ç‚¹</small></p>
                        </div>
                    </div>
                </div>

                <!-- é–‹å§‹ãƒœã‚¿ãƒ³ -->
                <div class="cta-section">
                    <button id="start-btn" class="start-button pulse-animation">
                        âœ¨ Triple OS åˆ†æã‚’é–‹å§‹ã™ã‚‹
                    </button>
                    
                    <div class="disclaimer">
                        <p class="disclaimer-text">
                            <strong>é‡è¦ãªæ³¨æ„äº‹é …ï¼š</strong> ã“ã®åˆ†æã¯ã€ã‚ãªãŸã®äººæ ¼ã‚’æ±ºå®šã¥ã‘ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸€ã¤ã®å‚è€ƒè¦–ç‚¹ã¨ã—ã¦ã€è‡ªå·±ç†è§£ã‚„æˆ¦ç•¥çš„æ€è€ƒã®ææ–™ã¨ã—ã¦ã”æ´»ç”¨ãã ã•ã„ã€‚åˆ†æçµæœã«ä¾å­˜ã™ã‚‹ã“ã¨ãªãã€å¸¸ã«ã”è‡ªèº«ã®åˆ¤æ–­ã‚’æœ€å„ªå…ˆã—ã¦ãã ã•ã„ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- è³ªå•ç”»é¢ -->
        <section id="question-screen" class="screen" aria-labelledby="question-title">
            <div class="container">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                </div>
                
                <div class="card question-card">
                    <div class="question-header">
                        <span id="question-number" class="question-number">1</span>
                        <h2 id="question-title" class="question-text"></h2>
                    </div>
                    
                    <div id="options-container" class="options" role="radiogroup" aria-labelledby="question-title">
                        <!-- å‹•çš„ã«è³ªå•ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæŒ¿å…¥ã•ã‚Œã‚‹ -->
                    </div>
                </div>
                
                <div class="nav-controls">
                    <button id="prev-btn" class="btn btn-secondary" disabled>å‰ã®è³ªå•</button>
                    <button id="next-btn" class="btn btn-primary" disabled>æ¬¡ã®è³ªå•</button>
                </div>
            </div>
        </section>
        
        <!-- åˆ†æä¸­ç”»é¢ -->
        <section id="analysis-screen" class="screen" aria-labelledby="analysis-title">
            <div class="container">
                <div class="card">
                    <h2 id="analysis-title" class="result-title">åˆ†æä¸­...</h2>
                    <div class="loading">
                        <div class="spinner"></div>
                        <span>Triple OSã‚·ã‚¹ãƒ†ãƒ ã‚’åˆ†æã—ã¦ã„ã¾ã™</span>
                    </div>
                    <p style="text-align: center; color: var(--primary-300); margin-top: var(--space-lg);">
                        HaQeiå“²å­¦ã«åŸºã¥ãTriple OSåˆ†æã‚’å®Ÿè¡Œä¸­ã§ã™<br>
                        <small>64å¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»8æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«ã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆ</small>
                    </p>
                </div>
            </div>
        </section>
        
        <!-- çµæœç”»é¢ -->
        <section id="results-screen" class="screen" aria-labelledby="results-title">
            <div class="container">
                <div class="result-header">
                    <h2 id="results-title" class="result-title">Triple OSåˆ†æçµæœ</h2>
                    <p style="color: var(--primary-200);">ã‚ãªãŸã®ä¸‰é‡äººæ ¼ã‚·ã‚¹ãƒ†ãƒ </p>
                </div>
                
                <div id="os-cards-container" class="os-cards">
                    <!-- å‹•çš„ã«çµæœãŒæŒ¿å…¥ã•ã‚Œã‚‹ -->
                </div>
                
                <div class="card">
                    <h3 style="color: var(--primary-100); margin-bottom: var(--space-md);">åˆ†æçµæœã‚µãƒãƒªãƒ¼</h3>
                    <div id="result-summary" style="color: var(--primary-200);">
                        <!-- å‹•çš„ã«ã‚µãƒãƒªãƒ¼ãŒæŒ¿å…¥ã•ã‚Œã‚‹ -->
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: var(--space-xl);">
                    <button id="restart-btn" class="btn btn-secondary">
                        ã‚‚ã†ä¸€åº¦åˆ†æã™ã‚‹
                    </button>
                </div>
            </div>
        </section>
        
        <!-- ã‚¨ãƒ©ãƒ¼ç”»é¢ -->
        <section id="error-screen" class="screen" aria-labelledby="error-title">
            <div class="container">
                <div class="card">
                    <h2 id="error-title" class="result-title" style="color: var(--error-500);">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>
                    <div id="error-message" class="error-message">
                        <!-- å‹•çš„ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæŒ¿å…¥ã•ã‚Œã‚‹ -->
                    </div>
                    <div style="text-align: center; margin-top: var(--space-lg);">
                        <button id="retry-btn" class="btn btn-primary">
                            å†è©¦è¡Œ
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // ==========================================
        // HAQEI Emergency Analyzer - Vanilla JS
        // HaQeiå“²å­¦æº–æ‹ ã®ç·Šæ€¥ç°¡æ˜“åˆ†æã‚·ã‚¹ãƒ†ãƒ 
        // ==========================================
        
        'use strict';
        
        // 1. 30å•è³ªå•ãƒ‡ãƒ¼ã‚¿ï¼ˆä¾¡å€¤è¦³24å•ï¼‹ã‚·ãƒŠãƒªã‚ª6å•ï¼‰
        const QUESTIONS = [
            // Q1-Q24: ä¾¡å€¤è¦³è¨­å•ï¼ˆEngine OSç‰¹å®šç”¨ï¼‰
            {
                id: "q1",
                text: "æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚„å–ã‚Šçµ„ã¿ã‚’å§‹ã‚ã‚‹ã¨ãã€ã‚ãªãŸãŒæœ€ã‚‚é‡è¦–ã™ã‚‹ã“ã¨ã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "èª°ã‚‚ã‚„ã£ãŸã“ã¨ã®ãªã„é©æ–°çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’è©¦ã™", scoring: { "ä¹¾_å‰µé€ æ€§": 3.0, "é›¢_è¡¨ç¾æ€§": 1.5, "è‰®_å®‰å®šæ€§": -1.0 } },
                    { value: "B", text: "æ—¢å­˜ã®æ–¹æ³•ã‚’æ”¹è‰¯ã—ã¦ã‚ˆã‚Šè‰¯ã„ã‚‚ã®ã«ã™ã‚‹", scoring: { "ä¹¾_å‰µé€ æ€§": 1.5, "å_æ¢æ±‚æ€§": 1.5, "å·½_é©å¿œæ€§": 1.0 } },
                    { value: "C", text: "ã¿ã‚“ãªã§è©±ã—åˆã£ã¦æœ€é©ãªæ–¹æ³•ã‚’è¦‹ã¤ã‘ã‚‹", scoring: { "å…Œ_èª¿å’Œæ€§": 2.5, "å¤_å—å®¹æ€§": 1.5, "ä¹¾_å‰µé€ æ€§": -0.5 } },
                    { value: "D", text: "éå»ã®æˆåŠŸä¾‹ã‚’å‚è€ƒã«ã—ã¦ç¢ºå®Ÿã«é€²ã‚ã‚‹", scoring: { "è‰®_å®‰å®šæ€§": 2.5, "å_æ¢æ±‚æ€§": 1.0, "ä¹¾_å‰µé€ æ€§": -1.0 } },
                    { value: "E", text: "çŠ¶æ³ã«å¿œã˜ã¦æŸ”è»Ÿã«æ–¹æ³•ã‚’èª¿æ•´ã™ã‚‹", scoring: { "å·½_é©å¿œæ€§": 2.5, "å…Œ_èª¿å’Œæ€§": 1.0, "è‰®_å®‰å®šæ€§": -0.5 } }
                ]
            },
            {
                id: "q2",
                text: "ã‚¢ã‚¤ãƒ‡ã‚¢ãŒæµ®ã‹ã‚“ã ã¨ãã€ã‚ãªãŸã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "ã™ãã«æ–°ã—ã„å½¢ã¨ã—ã¦å…·ç¾åŒ–ã—ã¦ã¿ãŸããªã‚‹", scoring: { "ä¹¾_å‰µé€ æ€§": 3.0, "éœ‡_è¡Œå‹•æ€§": 2.0, "è‰®_å®‰å®šæ€§": -1.0 } },
                    { value: "B", text: "ã¾ãšè©³ã—ãèª¿ã¹ã¦ã‹ã‚‰å®Ÿè¡Œã«ç§»ã™", scoring: { "å_æ¢æ±‚æ€§": 2.5, "è‰®_å®‰å®šæ€§": 2.0, "éœ‡_è¡Œå‹•æ€§": -1.0 } },
                    { value: "C", text: "å‘¨ã‚Šã®äººã¨ç›¸è«‡ã—ã¦æ„è¦‹ã‚’èã", scoring: { "å…Œ_èª¿å’Œæ€§": 2.5, "å¤_å—å®¹æ€§": 1.5, "ä¹¾_å‰µé€ æ€§": 0.5 } },
                    { value: "D", text: "å®Ÿç¾å¯èƒ½æ€§ã‚’æ…é‡ã«æ¤œè¨ã™ã‚‹", scoring: { "è‰®_å®‰å®šæ€§": 2.5, "å_æ¢æ±‚æ€§": 1.5, "ä¹¾_å‰µé€ æ€§": -0.5 } },
                    { value: "E", text: "ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¦‹è¨ˆã‚‰ã£ã¦æœ€é©ãªæ™‚ã«å®Ÿè¡Œã™ã‚‹", scoring: { "å·½_é©å¿œæ€§": 2.5, "å_æ¢æ±‚æ€§": 1.0, "éœ‡_è¡Œå‹•æ€§": -0.5 } }
                ]
            },
            {
                id: "q3",
                text: "ã€Œå‰µé€ ã™ã‚‹ã€ã¨ã„ã†ã“ã¨ã«ã¤ã„ã¦ã€ã‚ãªãŸã®è€ƒãˆã«æœ€ã‚‚è¿‘ã„ã®ã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "ä½•ã‚‚ãªã„ã¨ã“ã‚ã‹ã‚‰å…¨ãæ–°ã—ã„ã‚‚ã®ã‚’ç”Ÿã¿å‡ºã™ã“ã¨", scoring: { "ä¹¾_å‰µé€ æ€§": 3.0, "é›¢_è¡¨ç¾æ€§": 1.5, "å¤_å—å®¹æ€§": -1.0 } },
                    { value: "B", text: "ã¿ã‚“ãªã§å”åŠ›ã—ã¦ç´ æ™´ã‚‰ã—ã„ã‚‚ã®ã‚’ä½œã‚Šä¸Šã’ã‚‹ã“ã¨", scoring: { "å…Œ_èª¿å’Œæ€§": 2.5, "å¤_å—å®¹æ€§": 2.0, "ä¹¾_å‰µé€ æ€§": 1.0 } },
                    { value: "C", text: "æ·±ãç ”ç©¶ã—ã¦æ–°ã—ã„ç™ºè¦‹ã‚’ã™ã‚‹ã“ã¨", scoring: { "å_æ¢æ±‚æ€§": 2.5, "ä¹¾_å‰µé€ æ€§": 1.5, "å…Œ_èª¿å’Œæ€§": -0.5 } },
                    { value: "D", text: "ç€å®Ÿã«ç©ã¿é‡ã­ã¦ä¾¡å€¤ã‚ã‚‹ã‚‚ã®ã‚’ç¯‰ãã“ã¨", scoring: { "è‰®_å®‰å®šæ€§": 2.5, "å¤_å—å®¹æ€§": 1.5, "ä¹¾_å‰µé€ æ€§": 0.5 } },
                    { value: "E", text: "çŠ¶æ³ã«åˆã‚ã›ã¦æœ€é©ãªè§£æ±ºç­–ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨", scoring: { "å·½_é©å¿œæ€§": 2.5, "å_æ¢æ±‚æ€§": 1.0, "ä¹¾_å‰µé€ æ€§": 1.0 } }
                ]
            },
            {
                id: "q4",
                text: "ã‚„ã‚‰ãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ãŒã‚ã‚‹ã¨ãã€ã‚ãªãŸã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "ã™ãã«è¡Œå‹•ã‚’èµ·ã“ã—ã¦å‹¢ã„ã§é€²ã‚ã‚‹", scoring: { "éœ‡_è¡Œå‹•æ€§": 3.0, "ä¹¾_å‰µé€ æ€§": 1.0, "è‰®_å®‰å®šæ€§": -1.5 } },
                    { value: "B", text: "è¨ˆç”»ã‚’ç«‹ã¦ã¦ã‹ã‚‰ç€å®Ÿã«å®Ÿè¡Œã™ã‚‹", scoring: { "è‰®_å®‰å®šæ€§": 2.5, "å_æ¢æ±‚æ€§": 1.5, "éœ‡_è¡Œå‹•æ€§": -0.5 } },
                    { value: "C", text: "å‘¨ã‚Šã¨å”åŠ›ã—ã¦ãƒãƒ¼ãƒ ã§é€²ã‚ã‚‹", scoring: { "å…Œ_èª¿å’Œæ€§": 2.5, "å¤_å—å®¹æ€§": 1.5, "éœ‡_è¡Œå‹•æ€§": 1.0 } },
                    { value: "D", text: "çŠ¶æ³ã‚’è¦‹æ¥µã‚ã¦ã‹ã‚‰æœ€é©ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å‹•ã", scoring: { "å·½_é©å¿œæ€§": 2.5, "å_æ¢æ±‚æ€§": 1.5, "éœ‡_è¡Œå‹•æ€§": 0.5 } },
                    { value: "E", text: "è‡ªåˆ†ã®æ„Ÿè¦šã‚’ä¿¡ã˜ã¦ç›´æ„Ÿçš„ã«é€²ã‚ã‚‹", scoring: { "é›¢_è¡¨ç¾æ€§": 2.0, "éœ‡_è¡Œå‹•æ€§": 2.0, "è‰®_å®‰å®šæ€§": -1.0 } }
                ]
            },
            {
                id: "q5",
                text: "ã‚¹ãƒˆãƒ¬ã‚¹ã‚„å›°é›£ãªçŠ¶æ³ã«ç›´é¢ã—ãŸã¨ãã€ã‚ãªãŸã®ç¬¬ä¸€åå¿œã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "å³åº§ã«å•é¡Œè§£æ±ºã«å‘ã‘ã¦å‹•ãå‡ºã™", scoring: { "éœ‡_è¡Œå‹•æ€§": 3.0, "ä¹¾_å‰µé€ æ€§": 1.5, "å¤_å—å®¹æ€§": -1.0 } },
                    { value: "B", text: "å†·é™ã«çŠ¶æ³ã‚’åˆ†æã—ã¦åŸå› ã‚’æ¢ã‚‹", scoring: { "å_æ¢æ±‚æ€§": 3.0, "è‰®_å®‰å®šæ€§": 1.5, "éœ‡_è¡Œå‹•æ€§": -0.5 } },
                    { value: "C", text: "ä¿¡é ¼ã§ãã‚‹äººã«ç›¸è«‡ã—ã¦æ”¯ãˆã‚’æ±‚ã‚ã‚‹", scoring: { "å…Œ_èª¿å’Œæ€§": 2.5, "å¤_å—å®¹æ€§": 2.0, "éœ‡_è¡Œå‹•æ€§": 0.0 } },
                    { value: "D", text: "è½ã¡ç€ã„ã¦çŠ¶æ³ãŒå¥½è»¢ã™ã‚‹ã®ã‚’å¾…ã¤", scoring: { "è‰®_å®‰å®šæ€§": 2.5, "å¤_å—å®¹æ€§": 1.5, "éœ‡_è¡Œå‹•æ€§": -1.5 } },
                    { value: "E", text: "æŸ”è»Ÿã«å¯¾å¿œã—ãªãŒã‚‰æœ€å–„ã®é“ã‚’æ¢ã‚‹", scoring: { "å·½_é©å¿œæ€§": 3.0, "å_æ¢æ±‚æ€§": 1.0, "éœ‡_è¡Œå‹•æ€§": 0.5 } }
                ]
            },
            // Q6-Q24: ä¾¡å€¤è¦³è³ªå•ç¶šã
            {
                id: "q6",
                text: "ã‚ãªãŸãŒæœ€ã‚‚å¤§åˆ‡ã«ã—ã¦ã„ã‚‹ä¾¡å€¤è¦³ã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "è‡ªç”±ã¨å‰µé€ æ€§", scoring: { "ä¹¾_å‰µé€ æ€§": 3.0, "é›¢_è¡¨ç¾æ€§": 2.0 } },
                    { value: "B", text: "å®‰å®šã¨ä¿¡é ¼æ€§", scoring: { "è‰®_å®‰å®šæ€§": 3.0, "å¤_å—å®¹æ€§": 1.5 } },
                    { value: "C", text: "èª¿å’Œã¨å”åŠ›", scoring: { "å…Œ_èª¿å’Œæ€§": 3.0, "å¤_å—å®¹æ€§": 2.0 } },
                    { value: "D", text: "æ¢æ±‚ã¨æˆé•·", scoring: { "å_æ¢æ±‚æ€§": 3.0, "å·½_é©å¿œæ€§": 1.5 } },
                    { value: "E", text: "è¡Œå‹•ã¨å¤‰é©", scoring: { "éœ‡_è¡Œå‹•æ€§": 3.0, "ä¹¾_å‰µé€ æ€§": 1.5 } }
                ]
            },
            {
                id: "q7",
                text: "äººç”Ÿã®é‡è¦ãªæ±ºæ–­ã‚’ã™ã‚‹ã¨ãã€ã‚ãªãŸãŒæœ€ã‚‚é‡è¦–ã™ã‚‹ã®ã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "ç›´æ„Ÿã¨æƒ…ç†±", scoring: { "é›¢_è¡¨ç¾æ€§": 2.5, "éœ‡_è¡Œå‹•æ€§": 2.0 } },
                    { value: "B", text: "è«–ç†çš„åˆ†æ", scoring: { "å_æ¢æ±‚æ€§": 3.0, "è‰®_å®‰å®šæ€§": 1.5 } },
                    { value: "C", text: "å‘¨å›²ã¸ã®å½±éŸ¿", scoring: { "å…Œ_èª¿å’Œæ€§": 2.5, "å¤_å—å®¹æ€§": 2.0 } },
                    { value: "D", text: "å°†æ¥ã®å¯èƒ½æ€§", scoring: { "ä¹¾_å‰µé€ æ€§": 2.5, "å·½_é©å¿œæ€§": 2.0 } },
                    { value: "E", text: "å®‰å…¨æ€§ã¨ç¢ºå®Ÿæ€§", scoring: { "è‰®_å®‰å®šæ€§": 3.0, "å¤_å—å®¹æ€§": 1.5 } }
                ]
            },
            {
                id: "q8",
                text: "ãƒãƒ¼ãƒ ã§ã®å½¹å‰²ã¨ã—ã¦æœ€ã‚‚è‡ªç„¶ã«æ„Ÿã˜ã‚‹ã®ã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "ãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦æ–¹å‘æ€§ã‚’ç¤ºã™", scoring: { "ä¹¾_å‰µé€ æ€§": 3.0, "éœ‡_è¡Œå‹•æ€§": 2.0 } },
                    { value: "B", text: "èª¿æ•´å½¹ã¨ã—ã¦æ„è¦‹ã‚’ã¾ã¨ã‚ã‚‹", scoring: { "å…Œ_èª¿å’Œæ€§": 3.0, "å·½_é©å¿œæ€§": 2.0 } },
                    { value: "C", text: "å°‚é–€å®¶ã¨ã—ã¦æ·±ãåˆ†æã™ã‚‹", scoring: { "å_æ¢æ±‚æ€§": 3.0, "è‰®_å®‰å®šæ€§": 1.5 } },
                    { value: "D", text: "ã‚µãƒãƒ¼ãƒˆå½¹ã¨ã—ã¦å…¨ä½“ã‚’æ”¯ãˆã‚‹", scoring: { "å¤_å—å®¹æ€§": 3.0, "å…Œ_èª¿å’Œæ€§": 1.5 } },
                    { value: "E", text: "å®Ÿè¡Œå½¹ã¨ã—ã¦ç©æ¥µçš„ã«å‹•ã", scoring: { "éœ‡_è¡Œå‹•æ€§": 3.0, "é›¢_è¡¨ç¾æ€§": 1.5 } }
                ]
            },
            {
                id: "q9",
                text: "ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆæ³•ã¨ã—ã¦æœ€ã‚‚åŠ¹æœçš„ãªã®ã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã™ã‚‹", scoring: { "ä¹¾_å‰µé€ æ€§": 2.5, "éœ‡_è¡Œå‹•æ€§": 2.0 } },
                    { value: "B", text: "é™ã‹ã«ä¸€äººã§è€ƒãˆã‚‹", scoring: { "è‰®_å®‰å®šæ€§": 2.5, "å_æ¢æ±‚æ€§": 2.0 } },
                    { value: "C", text: "äººã¨è©±ã‚’ã™ã‚‹", scoring: { "å…Œ_èª¿å’Œæ€§": 3.0, "é›¢_è¡¨ç¾æ€§": 1.5 } },
                    { value: "D", text: "è‡ªç„¶ã®ä¸­ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹", scoring: { "å¤_å—å®¹æ€§": 2.5, "å·½_é©å¿œæ€§": 2.0 } },
                    { value: "E", text: "ä½“ã‚’å‹•ã‹ã—ã¦ç™ºæ•£", scoring: { "éœ‡_è¡Œå‹•æ€§": 3.0, "é›¢_è¡¨ç¾æ€§": 1.5 } }
                ]
            },
            {
                id: "q10",
                text: "ä»•äº‹ã§æœ€ã‚‚ã‚„ã‚ŠãŒã„ã‚’æ„Ÿã˜ã‚‹ã®ã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "é©æ–°çš„ãªã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å½¢ã«ã™ã‚‹ã“ã¨", scoring: { "ä¹¾_å‰µé€ æ€§": 3.0, "é›¢_è¡¨ç¾æ€§": 2.0 } },
                    { value: "B", text: "è¤‡é›‘ãªå•é¡Œã‚’è§£æ±ºã™ã‚‹ã“ã¨", scoring: { "å_æ¢æ±‚æ€§": 3.0, "è‰®_å®‰å®šæ€§": 1.5 } },
                    { value: "C", text: "ãƒãƒ¼ãƒ ã®æˆåŠŸã«è²¢çŒ®ã™ã‚‹ã“ã¨", scoring: { "å…Œ_èª¿å’Œæ€§": 2.5, "å¤_å—å®¹æ€§": 2.0 } },
                    { value: "D", text: "ç€å®Ÿã«æˆæœã‚’ç©ã¿ä¸Šã’ã‚‹ã“ã¨", scoring: { "è‰®_å®‰å®šæ€§": 3.0, "å¤_å—å®¹æ€§": 1.5 } },
                    { value: "E", text: "è¿…é€Ÿã«å®Ÿè¡Œã—ã¦çµæœã‚’å‡ºã™ã“ã¨", scoring: { "éœ‡_è¡Œå‹•æ€§": 3.0, "å·½_é©å¿œæ€§": 1.5 } }
                ]
            },
            // Q11-Q24 (ç°¡ç•¥ç‰ˆã€å®Ÿç”¨çš„ãªé•·ã•ã«èª¿æ•´)
            {
                id: "q11",
                text: "ç†æƒ³çš„ãªä¼‘æ—¥ã®éã”ã—æ–¹ã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "æ–°ã—ã„å ´æ‰€ã‚’æ¢ç´¢ã™ã‚‹", scoring: { "ä¹¾_å‰µé€ æ€§": 2.0, "éœ‡_è¡Œå‹•æ€§": 2.5 } },
                    { value: "B", text: "å®¶ã§ã‚†ã£ãã‚Šèª­æ›¸", scoring: { "è‰®_å®‰å®šæ€§": 2.5, "å_æ¢æ±‚æ€§": 2.0 } },
                    { value: "C", text: "å‹äººã‚„å®¶æ—ã¨éã”ã™", scoring: { "å…Œ_èª¿å’Œæ€§": 3.0, "å¤_å—å®¹æ€§": 2.0 } },
                    { value: "D", text: "è¶£å‘³ã«æ²¡é ­ã™ã‚‹", scoring: { "é›¢_è¡¨ç¾æ€§": 2.5, "å·½_é©å¿œæ€§": 2.0 } },
                    { value: "E", text: "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ä½“ã‚’å‹•ã‹ã™", scoring: { "éœ‡_è¡Œå‹•æ€§": 3.0, "é›¢_è¡¨ç¾æ€§": 1.5 } }
                ]
            },
            {
                id: "q12",
                text: "å­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«ã¨ã—ã¦æœ€ã‚‚åˆã£ã¦ã„ã‚‹ã®ã¯ï¼Ÿ",
                options: [
                    { value: "A", text: "å®Ÿè·µã—ãªãŒã‚‰è¦šãˆã‚‹", scoring: { "éœ‡_è¡Œå‹•æ€§": 2.5, "å·½_é©å¿œæ€§": 2.0 } },
                    { value: "B", text: "ç†è«–ã‚’æ·±ãç†è§£ã™ã‚‹", scoring: { "å_æ¢æ±‚æ€§": 3.0, "è‰®_å®‰å®šæ€§": 1.5 } },
                    { value: "C", text: "ä»–äººã¨è­°è«–ã—ã¦å­¦ã¶", scoring: { "å…Œ_èª¿å’Œæ€§": 2.5, "é›¢_è¡¨ç¾æ€§": 2.0 } },
                    { value: "D", text: "ä½“ç³»çš„ã«é †åºç«‹ã¦ã¦å­¦ã¶", scoring: { "è‰®_å®‰å®šæ€§": 3.0, "å¤_å—å®¹æ€§": 1.5 } },
                    { value: "E", text: "ç›´æ„Ÿçš„ã«å…¨ä½“ã‚’æŠŠæ¡ã™ã‚‹", scoring: { "ä¹¾_å‰µé€ æ€§": 2.5, "é›¢_è¡¨ç¾æ€§": 2.0 } }
                ]
            }
            // 12å•ç‰ˆã¨ã—ã¦å®Ÿç”¨çš„ãªé•·ã•ã«èª¿æ•´ï¼ˆå®Œå…¨30å•ç‰ˆã¯å¾Œæ—¥å®Ÿè£…ï¼‰
        ];
        
        // 2. 64å¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆhexagrams.jsonçµ±åˆï¼‰
        const HEXAGRAMS = [
            { hexagram_id: 1, name_jp: "ä¹¾ç‚ºå¤©", reading: "ã‘ã‚“ã„ã¦ã‚“", catchphrase: "å¤©ç¿”ã‘ã‚‹é¾ã®ã‚ˆã†ãªã€å¤©æ€§ã®ãƒªãƒ¼ãƒ€ãƒ¼", upper_trigram_id: 1, lower_trigram_id: 1, description: "ã‚ãªãŸã®å¿ƒã®å¥¥åº•ã«ã¯ã€å¤©ã‚’ç¿”ã‘ã‚‹é¾ã®ã‚ˆã†ãªå£®å¤§ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå®¿ã£ã¦ã„ã¾ã™ã€‚æ–°ã—ã„é“ã‚’åˆ‡ã‚Šé–‹ãã€äººã€…ã‚’å°ãã“ã¨ã«æœ€ã‚‚ä¾¡å€¤ã‚’è¦‹å‡ºã™ã‚ãªãŸã¯ã€ç”Ÿã¾ã‚ŒãªãŒã‚‰ã®ãƒªãƒ¼ãƒ€ãƒ¼ã§ã™ã€‚", keywords: "å‰µé€ ,ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—,åŠ›" },
            { hexagram_id: 2, name_jp: "å¤ç‚ºåœ°", reading: "ã“ã‚“ã„ã¡", catchphrase: "å¤§åœ°ã®æ¯ã®ã‚ˆã†ã«ã€ã™ã¹ã¦ã‚’å—ã‘å…¥ã‚Œã‚‹äºº", upper_trigram_id: 8, lower_trigram_id: 8, description: "ã‚ãªãŸã®å¿ƒã«ã¯ã€å¤§åœ°ã®ã‚ˆã†ãªåºƒå¤§ã§æ·±ã„åŒ…å®¹åŠ›ãŒå‚™ã‚ã£ã¦ã„ã¾ã™ã€‚äººã‚„ç‰©äº‹ã‚’è‚²ã¿ã€æ”¯ãˆã‚‹ã“ã¨ã«æœ€ã‚‚å–œã³ã‚’æ„Ÿã˜ã‚‹ã‚ãªãŸã¯ã€å‘¨å›²ã«ã¨ã£ã¦æ¬ ã‹ã›ãªã„å­˜åœ¨ã§ã™ã€‚", keywords: "å—å®¹,è‚²æˆ,ã‚µãƒãƒ¼ãƒˆ" },
            { hexagram_id: 3, name_jp: "æ°´é›·å±¯", reading: "ã™ã„ã‚‰ã„ã¡ã‚…ã‚“", catchphrase: "å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹åŠ›å¼·ã„æ„å¿—", description: "æ–°ã—ã„å§‹ã¾ã‚Šã«ã¯å›°é›£ãŒä¼´ã„ã¾ã™ãŒã€ã‚ãªãŸã«ã¯ ãã‚Œã‚’ä¹—ã‚Šè¶Šãˆã‚‹å¼·ã„æ„å¿—ãŒã‚ã‚Šã¾ã™ã€‚", keywords: "å§‹ã¾ã‚Š,å›°é›£,æˆé•·" },
            { hexagram_id: 4, name_jp: "å±±æ°´è’™", reading: "ã•ã‚“ã™ã„ã‚‚ã†", catchphrase: "å­¦ã³ã¨æˆé•·ã®æ¢æ±‚è€…", description: "çŸ¥è­˜ã‚’æ±‚ã‚ã€æˆé•·ã—ç¶šã‘ã‚‹ã“ã¨ãŒã‚ãªãŸã®æœ¬è³ªã§ã™ã€‚", keywords: "å­¦ç¿’,æˆé•·,æ¢æ±‚" },
            { hexagram_id: 5, name_jp: "æ°´å¤©éœ€", reading: "ã™ã„ã¦ã‚“ã˜ã‚…", catchphrase: "å¿è€å¼·ãæ©Ÿä¼šã‚’å¾…ã¤äºº", description: "é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¦‹æ¥µã‚ã‚‹æ™ºæ…§ãŒã‚ã‚Šã¾ã™ã€‚", keywords: "å¿è€,ã‚¿ã‚¤ãƒŸãƒ³ã‚°,æº–å‚™" },
            { hexagram_id: 6, name_jp: "å¤©æ°´è¨Ÿ", reading: "ã¦ã‚“ã™ã„ã—ã‚‡ã†", catchphrase: "æ­£ç¾©ã‚’æ±‚ã‚ã‚‹å‹‡æ°—ã‚ã‚‹äºº", description: "æ­£ã—ã„ã“ã¨ã®ãŸã‚ã«ç«‹ã¡ä¸ŠãŒã‚‹å‹‡æ°—ãŒã‚ã‚Šã¾ã™ã€‚", keywords: "æ­£ç¾©,å¯¾ç«‹,è§£æ±º" },
            { hexagram_id: 7, name_jp: "åœ°æ°´å¸«", reading: "ã¡ã™ã„ã—", catchphrase: "çµ„ç¹”ã‚’ç‡ã„ã‚‹ãƒªãƒ¼ãƒ€ãƒ¼", description: "ãƒãƒ¼ãƒ ã‚’çµ±ç‡ã—ç›®æ¨™é”æˆã«å°ãåŠ›ãŒã‚ã‚Šã¾ã™ã€‚", keywords: "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—,çµ„ç¹”,çµ±ç‡" },
            { hexagram_id: 8, name_jp: "æ°´åœ°æ¯”", reading: "ã™ã„ã¡ã²", catchphrase: "èª¿å’Œã¨å”åŠ›ã‚’é‡è¦–ã™ã‚‹äºº", description: "ä»–è€…ã¨ã®èª¿å’Œã‚’å¤§åˆ‡ã«ã—ã€å”åŠ›é–¢ä¿‚ã‚’ç¯‰ãã®ãŒå¾—æ„ã§ã™ã€‚", keywords: "èª¿å’Œ,å”åŠ›,çµæŸ" },
            { hexagram_id: 9, name_jp: "é¢¨å¤©å°ç•œ", reading: "ãµã†ã¦ã‚“ã—ã‚‡ã†ã¡ã", catchphrase: "ç´°ã‚„ã‹ãªé…æ…®ã§æˆæœã‚’ç©ã¿é‡ã­ã‚‹äºº", description: "å°ã•ãªåŠªåŠ›ã‚’ç©ã¿é‡ã­ã¦å¤§ããªæˆæœã‚’ç”Ÿã¿å‡ºã—ã¾ã™ã€‚", keywords: "è“„ç©,é…æ…®,ç€å®Ÿ" },
            { hexagram_id: 10, name_jp: "å¤©æ²¢å±¥", reading: "ã¦ã‚“ãŸãã‚Š", catchphrase: "ç¤¼å„€ã¨å“æ ¼ã‚’é‡ã‚“ã˜ã‚‹äºº", description: "æ­£ã—ã„é“ã‚’æ­©ã¿ã€å“æ ¼ã‚’ä¿ã¤ã“ã¨ã‚’å¤§åˆ‡ã«ã—ã¾ã™ã€‚", keywords: "ç¤¼å„€,å“æ ¼,æ­£é“" },
            { hexagram_id: 11, name_jp: "åœ°å¤©æ³°", reading: "ã¡ã¦ã‚“ãŸã„", catchphrase: "å¹³å’Œã¨ç¹æ „ã‚’ã‚‚ãŸã‚‰ã™äºº", description: "èª¿å’Œã¨ãƒãƒ©ãƒ³ã‚¹ã«ã‚ˆã‚Šå¹³å’Œã¨ç¹æ „ã‚’å®Ÿç¾ã—ã¾ã™ã€‚", keywords: "å¹³å’Œ,ç¹æ „,èª¿å’Œ" },
            { hexagram_id: 12, name_jp: "å¤©åœ°å¦", reading: "ã¦ã‚“ã¡ã²", catchphrase: "å›°é›£ãªæ™‚æœŸã‚’ä¹—ã‚Šè¶Šãˆã‚‹å¿è€åŠ›", description: "é€†å¢ƒã«å±ˆã›ãšã€æ™‚æœŸã‚’å¾…ã¤æ™ºæ…§ãŒã‚ã‚Šã¾ã™ã€‚", keywords: "é€†å¢ƒ,å¿è€,è»¢æ›" }
        ];
        
        // 3. å…«å¦ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆvectors.jsçµ±åˆï¼‰
        const H64_8D_VECTORS = {
            1: {
                ä¹¾_å‰µé€ æ€§: 9, éœ‡_è¡Œå‹•æ€§: 7, å_æ¢æ±‚æ€§: 5, è‰®_å®‰å®šæ€§: 6,
                å¤_å—å®¹æ€§: 1, å·½_é©å¿œæ€§: 3, é›¢_è¡¨ç¾æ€§: 8, å…Œ_èª¿å’Œæ€§: 4
            },
            2: {
                ä¹¾_å‰µé€ æ€§: 2, éœ‡_è¡Œå‹•æ€§: 3, å_æ¢æ±‚æ€§: 4, è‰®_å®‰å®šæ€§: 8,
                å¤_å—å®¹æ€§: 9, å·½_é©å¿œæ€§: 7, é›¢_è¡¨ç¾æ€§: 2, å…Œ_èª¿å’Œæ€§: 6
            }
            // ä»–ã®62å¦ã®ãƒ™ã‚¯ãƒˆãƒ«ã‚‚åŒæ§˜ã«å®Ÿè£…...
        };
        
        // 4. æ­£çµ±å…«å¦å®šç¾©ï¼ˆæ˜“çµŒæº–æ‹ ï¼‰
        const AUTHENTIC_TRIGRAMS = {
            1: { name: 'ä¹¾', symbol: 'â˜°', meaning: 'å¤©ãƒ»å‰µé€ ãƒ»çˆ¶', element: 'metal', nature: 'å‰›å¥', description: 'ç´”ç²‹å‰µé€ åŠ›ã€å¤©æ€§ã®ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã€å¼·å›ºãªæ„å¿—' },
            2: { name: 'å…Œ', symbol: 'â˜±', meaning: 'æ²¢ãƒ»å–œãƒ»å°‘å¥³', element: 'metal', nature: 'æ‚¦æ¥½', description: 'å–œæ‚¦èª¿å’Œã€ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ç¤¾äº¤çš„é­…åŠ›' },
            3: { name: 'é›¢', symbol: 'â˜²', meaning: 'ç«ãƒ»å…‰ãƒ»ä¸­å¥³', element: 'fire', nature: 'å…‰æ˜', description: 'å…‰æ˜è¡¨ç¾ã€çŸ¥æ€§ã¨æƒ…ç†±ã€æ˜æ™°ãªåˆ¤æ–­' },
            4: { name: 'éœ‡', symbol: 'â˜³', meaning: 'é›·ãƒ»å‹•ãƒ»é•·ç”·', element: 'wood', nature: 'ç™ºå‹•', description: 'é›·é³´è¡Œå‹•ã€ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥ãªå®Ÿè¡ŒåŠ›ã€é©æ–°åŠ›' },
            5: { name: 'å·½', symbol: 'â˜´', meaning: 'é¢¨ãƒ»å…¥ãƒ»é•·å¥³', element: 'wood', nature: 'é †å…¥', description: 'é¢¨ã®æµ¸é€ã€æŸ”è»Ÿé©å¿œã€ç´°ã‚„ã‹ãªé…æ…®' },
            6: { name: 'å', symbol: 'â˜µ', meaning: 'æ°´ãƒ»é™ºãƒ»ä¸­ç”·', element: 'water', nature: 'é™·é™º', description: 'æ°´ã®æ¢æ±‚ã€æ·±æ·µæ´å¯Ÿã€å›°é›£çªç ´' },
            7: { name: 'è‰®', symbol: 'â˜¶', meaning: 'å±±ãƒ»æ­¢ãƒ»å°‘ç”·', element: 'earth', nature: 'é™æ­¢', description: 'å±±ã®å®‰å®šã€ç¶™ç¶šåŠ›ã€ä¸å‹•ã®æ„å¿—' },
            8: { name: 'å¤', symbol: 'â˜·', meaning: 'åœ°ãƒ»é †ãƒ»æ¯', element: 'earth', nature: 'æŸ”é †', description: 'å¤§åœ°å—å®¹ã€è‚²æˆåŠ›ã€ç„¡é™ã®åŒ…å®¹' }
        };
        
        // æ­£çµ±å…«å¦ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆå…ˆå¤©å…«å¦é…åˆ—æº–æ‹ ï¼‰
        const AUTHENTIC_TRIGRAM_MAPPING = {
            "ä¹¾_å‰µé€ æ€§": 1,  // ä¹¾â˜° - ç´”ç²‹å‰µé€ ï¼ˆå¤©ãƒ»çˆ¶ãƒ»å‰›å¥ï¼‰
            "å…Œ_èª¿å’Œæ€§": 2,  // å…Œâ˜± - å–œæ‚¦èª¿å’Œï¼ˆæ²¢ãƒ»å°‘å¥³ãƒ»æ‚¦æ¥½ï¼‰
            "é›¢_è¡¨ç¾æ€§": 3,  // é›¢â˜² - å…‰æ˜è¡¨ç¾ï¼ˆç«ãƒ»ä¸­å¥³ãƒ»å…‰æ˜ï¼‰
            "éœ‡_è¡Œå‹•æ€§": 4,  // éœ‡â˜³ - ç™ºå‹•è¡Œå‹•ï¼ˆé›·ãƒ»é•·ç”·ãƒ»å‹•ï¼‰
            "å·½_é©å¿œæ€§": 5,  // å·½â˜´ - é †å¿œæµ¸é€ï¼ˆé¢¨ãƒ»é•·å¥³ãƒ»å…¥ï¼‰
            "å_æ¢æ±‚æ€§": 6,  // åâ˜µ - æ·±æ·µæ¢æ±‚ï¼ˆæ°´ãƒ»ä¸­ç”·ãƒ»é™ºï¼‰
            "è‰®_å®‰å®šæ€§": 7,  // è‰®â˜¶ - é™æ­¢å®‰å®šï¼ˆå±±ãƒ»å°‘ç”·ãƒ»æ­¢ï¼‰
            "å¤_å—å®¹æ€§": 8   // å¤â˜· - å—å®¹è‚²æˆï¼ˆåœ°ãƒ»æ¯ãƒ»é †ï¼‰
        };
        
        // 5. Triple OSå®šç¾©
        const TRIPLE_OS = {
            'Engine OS': {
                name: 'Engine OS',
                description: 'è«–ç†çš„æ€è€ƒã¨å®Ÿè¡ŒåŠ›ã®ä¸­æ ¸ã‚·ã‚¹ãƒ†ãƒ ',
                color: '#6366f1',
                trigrams: [1, 4, 6, 7], // ä¹¾ã€éœ‡ã€åã€è‰®
                keywords: ['å‰µé€ æ€§', 'ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—', 'è¡Œå‹•åŠ›', 'æ¢æ±‚å¿ƒ', 'å®‰å®šæ€§']
            },
            'Interface OS': {
                name: 'Interface OS', 
                description: 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨è¡¨ç¾ã®å¯¾äººã‚·ã‚¹ãƒ†ãƒ ',
                color: '#8b5cf6',
                trigrams: [2, 3, 5, 8], // å…Œã€é›¢ã€å·½ã€å¤
                keywords: ['èª¿å’Œæ€§', 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³', 'è¡¨ç¾åŠ›', 'é©å¿œæ€§', 'å—å®¹æ€§']
            },
            'Safe Mode OS': {
                name: 'Safe Mode OS',
                description: 'å®‰å®šã¨èª¿å’Œã‚’é‡è¦–ã™ã‚‹ä¿è­·ã‚·ã‚¹ãƒ†ãƒ ',
                color: '#10b981',
                trigrams: [7, 8, 5, 6], // è‰®ã€å¤ã€å·½ã€å
                keywords: ['å®‰å®šæ€§', 'å—å®¹æ€§', 'é©å¿œæ€§', 'æ…é‡ã•', 'åˆ†æåŠ›']
            }
        };
        
        // 6. TripleOSã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆTypeScriptã‹ã‚‰ç§»æ¤ï¼‰
        class TripleOSEngine {
            constructor() {
                this.trigramMapping = this.initializeTrigramMapping();
                this.interfaceKeywords = new Map();
                this.safeModeKeywords = new Map();
                this.initializeKeywordMaps();
            }
            
            initializeTrigramMapping() {
                // æ˜“çµŒæº–æ‹ ã®æ­£çµ±ä¸‰çˆ»ãƒãƒƒãƒ”ãƒ³ã‚°
                return {
                    "ä¹¾": { id: 1, symbol: "â˜°", name: "å¤©", nature: "å‰›å¥", trait: "ç´”ç²‹å‰µé€ ãƒ»å¤©æ€§ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—" },
                    "å…Œ": { id: 2, symbol: "â˜±", name: "æ²¢", nature: "æ‚¦æ¥½", trait: "å–œæ‚¦èª¿å’Œãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³" },
                    "é›¢": { id: 3, symbol: "â˜²", name: "ç«", nature: "å…‰æ˜", trait: "å…‰æ˜è¡¨ç¾ãƒ»çŸ¥æ€§æƒ…ç†±" },
                    "éœ‡": { id: 4, symbol: "â˜³", name: "é›·", nature: "ç™ºå‹•", trait: "é›·é³´è¡Œå‹•ãƒ»é©æ–°å®Ÿè¡Œ" },
                    "å·½": { id: 5, symbol: "â˜´", name: "é¢¨", nature: "é †å…¥", trait: "é¢¨æµæµ¸é€ãƒ»æŸ”è»Ÿé©å¿œ" },
                    "å": { id: 6, symbol: "â˜µ", name: "æ°´", nature: "é™·é™º", trait: "æ·±æ·µæ¢æ±‚ãƒ»æ´å¯Ÿçªç ´" },
                    "è‰®": { id: 7, symbol: "â˜¶", name: "å±±", nature: "é™æ­¢", trait: "å±±å²³å®‰å®šãƒ»ä¸å‹•ç¶™ç¶š" },
                    "å¤": { id: 8, symbol: "â˜·", name: "åœ°", nature: "æŸ”é †", trait: "å¤§åœ°å—å®¹ãƒ»è‚²æˆåŒ…å®¹" }
                };
            }
            
            initializeKeywordMaps() {
                // Interface OS keywords
                this.interfaceKeywords.set("ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—", ["1", "13", "43", "14"]);
                this.interfaceKeywords.set("å”èª¿æ€§", ["2", "15", "45", "8"]);
                this.interfaceKeywords.set("å‰µé€ æ€§", ["1", "43", "34", "14"]);
                
                // SafeMode OS keywords  
                this.safeModeKeywords.set("æ…é‡", ["2", "52", "39", "15"]);
                this.safeModeKeywords.set("åˆ†æçš„", ["29", "48", "47", "6"]);
                this.safeModeKeywords.set("æ’¤é€€", ["33", "12", "45", "35"]);
            }
            
            // Triple OSåˆ†æã®ãƒ¡ã‚¤ãƒ³å‡¦ç†
            async analyzeTripleOS(allAnswers) {
                console.log("ğŸ”¯ Starting Triple OS Analysis");
                
                try {
                    // 1. å›ç­”ã‚’ä¾¡å€¤è¦³è³ªå•ã¨ã‚·ãƒŠãƒªã‚ªè³ªå•ã«åˆ†é›¢
                    const { worldviewAnswers, scenarioAnswers } = this.separateAnswers(allAnswers);
                    
                    // 2. Engine OSï¼ˆä¾¡å€¤è¦³ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã®åˆ†æ
                    const engineOS = await this.analyzeEngineOS(worldviewAnswers);
                    
                    // 3. Interface OSï¼ˆç¤¾ä¼šçš„ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã®åˆ†æ
                    const interfaceOS = await this.analyzeInterfaceOS(scenarioAnswers, engineOS);
                    
                    // 4. SafeMode OSï¼ˆé˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã®åˆ†æ
                    const safeModeOS = await this.analyzeSafeModeOS(scenarioAnswers, engineOS);
                    
                    // 5. å…¨OSãŒæ­£å¸¸ã«è¨ˆç®—ã•ã‚ŒãŸã‹ç¢ºèª
                    this.validateTripleOSResults(engineOS, interfaceOS, safeModeOS);
                    
                    // 6. Triple OSçµ±åˆåˆ†æã®å®Ÿè¡Œ
                    const tripleOSIntegration = await this.calculateTripleOSInteraction(engineOS, interfaceOS, safeModeOS);
                    
                    console.log("âœ… Triple OS Analysis Completed Successfully");
                    
                    return {
                        engineOS,
                        interfaceOS,
                        safeModeOS,
                        integration: tripleOSIntegration,
                        consistencyScore: tripleOSIntegration.consistency,
                        balanceScore: tripleOSIntegration.balance,
                        HaQeiIntegration: tripleOSIntegration.integration,
                        recommendations: tripleOSIntegration.recommendations,
                        validationStatus: "completed",
                        timestamp: Date.now()
                    };
                    
                } catch (error) {
                    console.error("âŒ Triple OS Analysis Error:", error);
                    
                    // çµ±åˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Triple OSçµæœã‚’è¿”ã™
                    return this.getDefaultTripleOSResults();
                }
            }
            
            separateAnswers(allAnswers) {
                const worldviewAnswers = [];
                const scenarioAnswers = [];
                
                allAnswers.forEach(answer => {
                    const questionNum = parseInt(answer.questionId.replace('q', ''));
                    if (questionNum >= 1 && questionNum <= 24) {
                        worldviewAnswers.push(answer);
                    } else if (questionNum >= 25 && questionNum <= 30) {
                        scenarioAnswers.push(answer);
                    }
                });
                
                return { worldviewAnswers, scenarioAnswers };
            }
            
            async analyzeEngineOS(worldviewAnswers) {
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ™ã‚¯ãƒˆãƒ«ã®æ§‹ç¯‰
                const userVector = this.buildUserVector(worldviewAnswers);
                
                // ä¸‰çˆ»ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®è¨ˆç®—
                const trigramEnergies = this.calculateTrigramEnergies(userVector);
                
                // æœ€ã‚‚å¼·ã„2ã¤ã®ä¸‰çˆ»ã‚’ç‰¹å®š
                const sortedTrigrams = Object.entries(trigramEnergies)
                    .sort(([, a], [, b]) => b - a);
                
                const upperTrigram = sortedTrigrams[0][0];
                const lowerTrigram = sortedTrigrams[1][0];
                
                // ãƒ˜ã‚­ã‚µã‚°ãƒ©ãƒ ã«ãƒãƒƒãƒ”ãƒ³ã‚°
                const hexagramId = this.mapTrigramsToHexagram(upperTrigram, lowerTrigram);
                const hexagram = HEXAGRAMS.find(h => h.hexagram_id === hexagramId) || HEXAGRAMS[0];
                
                return {
                    hexagramId,
                    hexagramName: hexagram.name_jp,
                    description: hexagram.description,
                    catchphrase: hexagram.catchphrase,
                    primaryTrigram: upperTrigram,
                    secondaryTrigram: lowerTrigram,
                    trigramEnergies
                };
            }
            
            buildUserVector(answers) {
                const vector = {
                    ä¹¾_å‰µé€ æ€§: 0, éœ‡_è¡Œå‹•æ€§: 0, å_æ¢æ±‚æ€§: 0, è‰®_å®‰å®šæ€§: 0,
                    å¤_å—å®¹æ€§: 0, å·½_é©å¿œæ€§: 0, é›¢_è¡¨ç¾æ€§: 0, å…Œ_èª¿å’Œæ€§: 0
                };
                
                answers.forEach(answer => {
                    const option = answer.selectedOption;
                    if (option && option.scoring) {
                        Object.entries(option.scoring).forEach(([dimension, score]) => {
                            if (vector.hasOwnProperty(dimension)) {
                                vector[dimension] += score;
                            }
                        });
                    }
                });
                
                return vector;
            }
            
            calculateTrigramEnergies(userVector) {
                // æ˜“çµŒæº–æ‹ ã®æ­£çµ±ä¸‰çˆ»ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—
                const rawEnergies = {};
                
                // 8æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«ã‹ã‚‰8ä¸‰çˆ»ã¸ã®æ­£çµ±å¤‰æ›
                Object.entries(AUTHENTIC_TRIGRAM_MAPPING).forEach(([dimension, trigramId]) => {
                    const trigramName = this.getTrigramName(trigramId);
                    rawEnergies[trigramName] = userVector[dimension] || 0;
                });
                
                // HaQeiå‹•çš„æ­£è¦åŒ–ï¼ˆæœ€é«˜å€¤ã‚’100ã¨ã—ã€ç›¸å¯¾çš„ãƒãƒ©ãƒ³ã‚¹ç¶­æŒï¼‰
                const maxEnergy = Math.max(...Object.values(rawEnergies));
                const normalizedEnergies = {};
                
                if (maxEnergy > 0) {
                    Object.entries(rawEnergies).forEach(([trigram, energy]) => {
                        // æ­£è¦åŒ– + é™°é™½ãƒãƒ©ãƒ³ã‚¹èª¿æ•´
                        const normalized = (energy / maxEnergy) * 100;
                        normalizedEnergies[trigram] = Math.max(0, Math.min(100, normalized));
                    });
                } else {
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆå‡ç­‰åˆ†æ•£ï¼‰
                    Object.keys(rawEnergies).forEach(trigram => {
                        normalizedEnergies[trigram] = 12.5; // 100/8
                    });
                }
                
                return normalizedEnergies;
            }
            
            getTrigramName(trigramId) {
                const trigramNames = ["ä¹¾", "å…Œ", "é›¢", "éœ‡", "å·½", "å", "è‰®", "å¤"];
                return trigramNames[trigramId - 1] || "ä¹¾";
            }
            
            mapTrigramsToHexagram(upperTrigram, lowerTrigram) {
                // æ˜“çµŒæº–æ‹ ã®æ­£ç¢ºãª64å¦è¨ˆç®—ï¼ˆå…ˆå¤©å…«å¦é…åˆ—åŸºæº–ï¼‰
                const trigramToNumber = {
                    "ä¹¾": 1, "å…Œ": 2, "é›¢": 3, "éœ‡": 4,
                    "å·½": 5, "å": 6, "è‰®": 7, "å¤": 8
                };
                
                const upper = trigramToNumber[upperTrigram] || 1;
                const lower = trigramToNumber[lowerTrigram] || 1;
                
                // æ­£çµ±çš„64å¦ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ï¼ˆå…ˆå¤©å…«å¦é †åºï¼‰
                const authenticHexagramMatrix = [
                    [1, 43, 14, 34, 9, 5, 26, 11],   // ä¹¾ä¸Š (å¤©)
                    [58, 60, 38, 54, 61, 59, 28, 19], // å…Œä¸Š (æ²¢)
                    [50, 64, 56, 62, 55, 63, 35, 8],  // é›¢ä¸Š (ç«)
                    [51, 16, 40, 32, 46, 48, 18, 7],  // éœ‡ä¸Š (é›·)
                    [57, 20, 53, 42, 37, 45, 22, 36], // å·½ä¸Š (é¢¨)
                    [6, 29, 4, 7, 59, 60, 3, 2],      // åä¸Š (æ°´)
                    [33, 52, 39, 15, 53, 56, 31, 12], // è‰®ä¸Š (å±±)
                    [2, 47, 4, 7, 46, 29, 27, 24]     // å¤ä¸Š (åœ°)
                ];
                
                // æ˜“çµŒæ­£çµ±è¨ˆç®—
                const hexagramId = authenticHexagramMatrix[upper - 1][lower - 1];
                
                console.log(`ğŸ”¯ Authentic I-Ching Mapping: ${upperTrigram}(${upper}) over ${lowerTrigram}(${lower}) = Hexagram ${hexagramId}`);
                
                return hexagramId;
            }
            
            async analyzeInterfaceOS(scenarioAnswers, engineOS) {
                console.log("ğŸŒ Interface OS Analysis: Social Pattern Mapping");
                
                try {
                    // 1. ã‚·ãƒŠãƒªã‚ªè³ªå•ã‹ã‚‰ç¤¾ä¼šçš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æ
                    const socialPatterns = this.analyzeSocialPatterns(scenarioAnswers);
                    console.log("ğŸ“Š Social Patterns:", socialPatterns);
                    
                    // 2. Interface OSå°‚ç”¨ã®8æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«æ§‹ç¯‰
                    const interfaceVector = this.buildInterfaceVector(socialPatterns);
                    console.log("ğŸ¯ Interface Vector:", interfaceVector);
                    
                    // 3. ç¤¾ä¼šçš„ä¸‰çˆ»ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—
                    const socialTrigramEnergies = this.calculateSocialTrigramEnergies(interfaceVector);
                    console.log("âš¡ Social Trigram Energies:", socialTrigramEnergies);
                    
                    // 4. Engine OSã¨ã®ç›¸äº’ä½œç”¨è£œæ­£
                    const adjustedEnergies = this.adjustForEngineOS(socialTrigramEnergies, engineOS);
                    console.log("ğŸ”„ Adjusted for Engine OS:", adjustedEnergies);
                    
                    // 5. Interface OSç”¨ã®æœ€é©ä¸‰çˆ»é¸æŠ
                    const { upperTrigram, lowerTrigram } = this.selectInterfaceTrigrams(adjustedEnergies);
                    console.log("ğŸ”¼ Selected Trigrams:", { upper: upperTrigram, lower: lowerTrigram });
                    
                    // 6. 64å¦ã¸ãƒãƒƒãƒ”ãƒ³ã‚°
                    const hexagramId = this.mapTrigramsToHexagram(upperTrigram, lowerTrigram);
                    const hexagramData = this.getHexagramData(hexagramId);
                    
                    // 7. Interface OSå°‚ç”¨è§£é‡ˆç”Ÿæˆ
                    const interfaceInterpretation = this.generateInterfaceInterpretation(
                        hexagramId, upperTrigram, lowerTrigram, socialPatterns, engineOS
                    );
                    
                    console.log(`ğŸŒŸ Interface OS Result: Hexagram ${hexagramId} (${hexagramData.name_jp})`);
                    
                    return {
                        hexagramId,
                        hexagramName: hexagramData.name_jp,
                        upperTrigram,
                        lowerTrigram,
                        socialPatterns,
                        interfaceVector,
                        socialStyle: this.determineSocialStyle(socialPatterns),
                        description: interfaceInterpretation.description,
                        leadership: interfaceInterpretation.leadership,
                        communication: interfaceInterpretation.communication,
                        conflictResolution: interfaceInterpretation.conflictResolution,
                        adaptability: interfaceInterpretation.adaptability,
                        engineOSInfluence: interfaceInterpretation.engineOSInfluence,
                        type: "Interface OS"
                    };
                    
                } catch (error) {
                    console.error("âŒ Interface OS Analysis Error:", error);
                    return this.getDefaultInterfaceOS();
                }
            }
            
            async analyzeSafeModeOS(scenarioAnswers, engineOS) {
                console.log("ğŸ›¡ï¸ SafeMode OS Analysis: Defensive Pattern Extraction");
                
                try {
                    // 1. ã‚·ãƒŠãƒªã‚ªã‹ã‚‰é˜²å¾¡ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠ½å‡º
                    const defensivePatterns = this.extractDefensivePatterns(scenarioAnswers);
                    console.log("âš¡ Defensive Patterns:", defensivePatterns);
                    
                    // 2. ã‚¹ãƒˆãƒ¬ã‚¹åå¿œãƒ™ã‚¯ãƒˆãƒ«æ§‹ç¯‰
                    const stressVector = this.buildStressResponseVector(defensivePatterns);
                    console.log("ğŸŒªï¸ Stress Response Vector:", stressVector);
                    
                    // 3. é˜²å¾¡çš„ä¸‰çˆ»ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—
                    const defensiveTrigramEnergies = this.calculateDefensiveTrigramEnergies(stressVector);
                    console.log("âš”ï¸ Defensive Trigram Energies:", defensiveTrigramEnergies);
                    
                    // 4. Engine OSã«ã‚ˆã‚‹åŸºç¤çš„å½±éŸ¿ï¼ˆ40%ï¼‰
                    const adjustedEnergies = this.adjustForCorePersonality(defensiveTrigramEnergies, engineOS);
                    console.log("ğŸ”§ Core-Adjusted Energies:", adjustedEnergies);
                    
                    // 5. æœ€ã‚‚å¼·ã„é˜²å¾¡ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸‰çˆ»ã‚’ç‰¹å®š
                    const [primaryDefense, secondaryDefense] = this.selectDefensiveTrigrams(adjustedEnergies);
                    console.log(`ğŸ¯ Selected Defense Trigrams: ${primaryDefense} over ${secondaryDefense}`);
                    
                    // 6. 64å¦ã¸ãƒãƒƒãƒ”ãƒ³ã‚°
                    const hexagramId = this.mapTrigramsToHexagram(primaryDefense, secondaryDefense);
                    const hexagramData = this.getHexagramData(hexagramId);
                    
                    // 7. SafeMode OSå°‚ç”¨è§£é‡ˆç”Ÿæˆ
                    const safeModeInterpretation = this.generateSafeModeInterpretation(
                        hexagramId, primaryDefense, secondaryDefense, defensivePatterns, engineOS
                    );
                    
                    console.log(`ğŸ”¯ SafeMode OS Result: Hexagram ${hexagramId} (${hexagramData.name_jp})`);
                    
                    return {
                        hexagramId,
                        hexagramName: hexagramData.name_jp,
                        description: safeModeInterpretation.description,
                        catchphrase: safeModeInterpretation.catchphrase,
                        primaryDefense: primaryDefense,
                        secondaryDefense: secondaryDefense,
                        defensiveType: safeModeInterpretation.defensiveType,
                        stressResponse: safeModeInterpretation.stressResponse,
                        activationTrigger: safeModeInterpretation.activationTrigger,
                        defensiveStrength: this.calculateDefensiveStrength(defensivePatterns),
                        trigramEnergies: adjustedEnergies,
                        type: "Safe Mode OS"
                    };
                    
                } catch (error) {
                    console.error("âŒ SafeMode OS Analysis Error:", error);
                    return this.getDefaultSafeModeOS();
                }
            }

            extractDefensivePatterns(scenarioAnswers) {
                const patterns = {
                    leadershipStress: 0,    // Q25: è²¬ä»»ã®é‡åœ§ã¸ã®é˜²å¾¡
                    interpersonalStress: 0, // Q26: äººé–“é–¢ä¿‚ã‚¹ãƒˆãƒ¬ã‚¹ã¸ã®é˜²å¾¡
                    familyStress: 0,        // Q27: è¦ªå¯†é–¢ä¿‚ã®è² è·ã¸ã®é˜²å¾¡
                    emergencyStress: 0,     // Q28: å±æ©Ÿçš„çŠ¶æ³ã¸ã®é˜²å¾¡
                    competitionStress: 0,   // Q29: ç«¶äº‰åœ§åŠ›ã¸ã®é˜²å¾¡
                    collaborationStress: 0  // Q30: å”èª¿ã®è² æ‹…ã¸ã®é˜²å¾¡
                };
                
                // å„ã‚·ãƒŠãƒªã‚ªå›ç­”ã‹ã‚‰é˜²å¾¡çš„åå¿œãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠ½å‡º
                scenarioAnswers.forEach((answer, index) => {
                    const questionNum = 25 + index;
                    const stressResponse = this.analyzeStressResponse(answer, questionNum);
                    
                    switch(questionNum) {
                        case 25: patterns.leadershipStress = stressResponse; break;
                        case 26: patterns.interpersonalStress = stressResponse; break;
                        case 27: patterns.familyStress = stressResponse; break;
                        case 28: patterns.emergencyStress = stressResponse; break;
                        case 29: patterns.competitionStress = stressResponse; break;
                        case 30: patterns.collaborationStress = stressResponse; break;
                    }
                });
                
                return patterns;
            }

            analyzeStressResponse(answer, questionNum) {
                // å›ç­”ã‹ã‚‰é˜²å¾¡çš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ•°å€¤åŒ–
                const responseIntensity = this.calculateResponseIntensity(answer);
                const defensiveType = this.identifyDefensiveType(answer, questionNum);
                
                return {
                    intensity: responseIntensity,
                    type: defensiveType,
                    pattern: this.mapToDefensivePattern(defensiveType)
                };
            }

            calculateResponseIntensity(answer) {
                // å›ç­”ã®å¼·åº¦ã‚’0-1ã§æ¸¬å®š
                if (!answer || !answer.text) return 0.5;
                
                const text = answer.text.toLowerCase();
                const intensityKeywords = {
                    high: ['çµ¶å¯¾', 'å¿…ãš', 'å®Œå…¨', 'å¾¹åº•', 'æ–­å›º', 'æ–­ç„¶', 'å³åº§', 'ç·Šæ€¥'],
                    medium: ['ã§ãã‚‹ã ã‘', 'ãªã‚‹ã¹ã', 'åŠªåŠ›', 'æ¤œè¨', 'ç›¸è«‡', 'èª¿æ•´'],
                    low: ['æ§˜å­è¦‹', 'ä¿ç•™', 'å»¶æœŸ', 'å›é¿', 'ç„¡è¦–', 'æ”¾ç½®']
                };
                
                let score = 0.5; // baseline
                
                intensityKeywords.high.forEach(keyword => {
                    if (text.includes(keyword)) score += 0.15;
                });
                intensityKeywords.medium.forEach(keyword => {
                    if (text.includes(keyword)) score += 0.05;
                });
                intensityKeywords.low.forEach(keyword => {
                    if (text.includes(keyword)) score -= 0.1;
                });
                
                return Math.max(0, Math.min(1, score));
            }

            identifyDefensiveType(answer, questionNum) {
                if (!answer || !answer.text) return 'neutral';
                
                const text = answer.text.toLowerCase();
                
                // é˜²å¾¡ã‚¿ã‚¤ãƒ—ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åˆ†æ
                const defensiveKeywords = {
                    retreat: ['æ’¤é€€', 'è·é›¢', 'é¿ã‘ã‚‹', 'é›¢ã‚Œã‚‹', 'é€€ã', 'é€ƒã’'],
                    confront: ['å¯¾æŠ—', 'ç«‹ã¡å‘ã‹ã†', 'æˆ¦ã†', 'æŒ‘æˆ¦', 'åæ’ƒ', 'æŠµæŠ—'],
                    avoid: ['å›é¿', 'å·§ã¿', 'è¿‚å›', 'åˆ¥ã®é“', 'æŸ”è»Ÿ', 'é©å¿œ'],
                    endure: ['è€ãˆã‚‹', 'æˆ‘æ…¢', 'å¿ã¶', 'æŒä¹…', 'ç¶™ç¶š', 'å …æŒ'],
                    transform: ['å¤‰åŒ–', 'é©å¿œ', 'å¤‰å®¹', 'èª¿æ•´', 'ä¿®æ­£', 'é€²åŒ–'],
                    boundary: ['å¢ƒç•Œ', 'ç·šå¼•ã', 'åˆ¶é™', 'åŒºåˆ¥', 'åˆ†é›¢', 'é˜²å£'],
                    harmonize: ['èª¿å’Œ', 'åŒåŒ–', 'æº¶ã‘è¾¼ã‚€', 'å”èª¿', 'åˆã‚ã›ã‚‹', 'èåˆ'],
                    fortify: ['å¼·åŒ–', 'å›ºã‚ã‚‹', 'å®ˆã‚‹', 'é˜²å¾¡', 'å®‰å®š', 'å …å›º']
                };
                
                let maxScore = 0;
                let dominantType = 'neutral';
                
                Object.entries(defensiveKeywords).forEach(([type, keywords]) => {
                    let score = 0;
                    keywords.forEach(keyword => {
                        if (text.includes(keyword)) score++;
                    });
                    if (score > maxScore) {
                        maxScore = score;
                        dominantType = type;
                    }
                });
                
                return dominantType;
            }

            mapToDefensivePattern(defensiveType) {
                const patternMap = {
                    retreat: 'æ’¤é€€',     // å¤ãƒ»è‰®
                    confront: 'å¯¾æŠ—',    // ä¹¾ãƒ»éœ‡
                    avoid: 'å›é¿',       // å·½ãƒ»å…Œ
                    endure: 'è€å¿',      // åãƒ»è‰®
                    transform: 'å¤‰å®¹',   // é›¢ãƒ»å·½
                    boundary: 'çµç•Œ',    // è‰®ãƒ»å¤
                    harmonize: 'åŒåŒ–',   // å¤ãƒ»å·½
                    fortify: 'ç¡¬åŒ–',     // ä¹¾ãƒ»è‰®
                    neutral: 'ä¸­ç«‹'
                };
                
                return patternMap[defensiveType] || 'ä¸­ç«‹';
            }

            buildStressResponseVector(defensivePatterns) {
                // é˜²å¾¡çš„8æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«æ§‹ç¯‰
                const vector = {
                    é˜²å¾¡_æ’¤é€€æ€§: 0,    // å¤ - å—å‹•çš„æ’¤é€€
                    é˜²å¾¡_å¯¾æŠ—æ€§: 0,    // ä¹¾ - ç©æ¥µçš„å¯¾æŠ—
                    é˜²å¾¡_å›é¿æ€§: 0,    // å·½ - æŸ”è»Ÿãªå›é¿
                    é˜²å¾¡_æŒä¹…æ€§: 0,    // å - å¿è€ã¨æŒä¹…
                    é˜²å¾¡_å¤‰å®¹æ€§: 0,    // é›¢ - å¤‰åŒ–ã¨é©å¿œ
                    é˜²å¾¡_å¢ƒç•Œæ€§: 0,    // è‰® - å¢ƒç•Œè¨­å®š
                    é˜²å¾¡_èª¿å’Œæ€§: 0,    // å…Œ - èª¿å’Œçš„è§£æ±º
                    é˜²å¾¡_å …å›ºæ€§: 0     // éœ‡ - ç¬ç™ºçš„é˜²å¾¡
                };
                
                // å„ã‚¹ãƒˆãƒ¬ã‚¹åå¿œã‚’å¯¾å¿œã™ã‚‹é˜²å¾¡æ¬¡å…ƒã«ãƒãƒƒãƒ”ãƒ³ã‚°
                Object.entries(defensivePatterns).forEach(([stressType, response]) => {
                    const intensity = response.intensity || 0;
                    const pattern = response.pattern || 'ä¸­ç«‹';
                    
                    switch(pattern) {
                        case 'æ’¤é€€':
                            vector.é˜²å¾¡_æ’¤é€€æ€§ += intensity * 0.8;
                            vector.é˜²å¾¡_èª¿å’Œæ€§ += intensity * 0.3;
                            break;
                        case 'å¯¾æŠ—':
                            vector.é˜²å¾¡_å¯¾æŠ—æ€§ += intensity * 0.8;
                            vector.é˜²å¾¡_å …å›ºæ€§ += intensity * 0.4;
                            break;
                        case 'å›é¿':
                            vector.é˜²å¾¡_å›é¿æ€§ += intensity * 0.8;
                            vector.é˜²å¾¡_å¤‰å®¹æ€§ += intensity * 0.3;
                            break;
                        case 'è€å¿':
                            vector.é˜²å¾¡_æŒä¹…æ€§ += intensity * 0.8;
                            vector.é˜²å¾¡_å¢ƒç•Œæ€§ += intensity * 0.4;
                            break;
                        case 'å¤‰å®¹':
                            vector.é˜²å¾¡_å¤‰å®¹æ€§ += intensity * 0.8;
                            vector.é˜²å¾¡_å›é¿æ€§ += intensity * 0.3;
                            break;
                        case 'çµç•Œ':
                            vector.é˜²å¾¡_å¢ƒç•Œæ€§ += intensity * 0.8;
                            vector.é˜²å¾¡_æŒä¹…æ€§ += intensity * 0.3;
                            break;
                        case 'åŒåŒ–':
                            vector.é˜²å¾¡_èª¿å’Œæ€§ += intensity * 0.8;
                            vector.é˜²å¾¡_æ’¤é€€æ€§ += intensity * 0.3;
                            break;
                        case 'ç¡¬åŒ–':
                            vector.é˜²å¾¡_å …å›ºæ€§ += intensity * 0.8;
                            vector.é˜²å¾¡_å¯¾æŠ—æ€§ += intensity * 0.3;
                            break;
                    }
                });
                
                // æ­£è¦åŒ–
                const maxValue = Math.max(...Object.values(vector));
                if (maxValue > 0) {
                    Object.keys(vector).forEach(key => {
                        vector[key] = vector[key] / maxValue;
                    });
                }
                
                return vector;
            }

            calculateDefensiveTrigramEnergies(stressVector) {
                // é˜²å¾¡çš„8æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«ã‹ã‚‰ä¸‰çˆ»ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’è¨ˆç®—
                return {
                    ä¹¾: stressVector.é˜²å¾¡_å¯¾æŠ—æ€§ * 0.7 + stressVector.é˜²å¾¡_å …å›ºæ€§ * 0.3,
                    å…Œ: stressVector.é˜²å¾¡_èª¿å’Œæ€§ * 0.8 + stressVector.é˜²å¾¡_å›é¿æ€§ * 0.2,
                    é›¢: stressVector.é˜²å¾¡_å¤‰å®¹æ€§ * 0.8 + stressVector.é˜²å¾¡_å¯¾æŠ—æ€§ * 0.2,
                    éœ‡: stressVector.é˜²å¾¡_å …å›ºæ€§ * 0.6 + stressVector.é˜²å¾¡_å¯¾æŠ—æ€§ * 0.4,
                    å·½: stressVector.é˜²å¾¡_å›é¿æ€§ * 0.7 + stressVector.é˜²å¾¡_å¤‰å®¹æ€§ * 0.3,
                    å: stressVector.é˜²å¾¡_æŒä¹…æ€§ * 0.8 + stressVector.é˜²å¾¡_å¢ƒç•Œæ€§ * 0.2,
                    è‰®: stressVector.é˜²å¾¡_å¢ƒç•Œæ€§ * 0.7 + stressVector.é˜²å¾¡_æ’¤é€€æ€§ * 0.3,
                    å¤: stressVector.é˜²å¾¡_æ’¤é€€æ€§ * 0.7 + stressVector.é˜²å¾¡_èª¿å’Œæ€§ * 0.3
                };
            }

            adjustForCorePersonality(defensiveEnergies, engineOS) {
                // Engine OSã®åŸºç¤äººæ ¼ãŒé˜²å¾¡ãƒ‘ã‚¿ãƒ¼ãƒ³ã«40%ã®å½±éŸ¿ã‚’ä¸ãˆã‚‹
                const coreInfluence = 0.4;
                const defensiveBase = 0.6;
                
                if (!engineOS || !engineOS.trigramEnergies) return defensiveEnergies;
                
                const adjusted = {};
                Object.keys(defensiveEnergies).forEach(trigram => {
                    const coreEnergy = engineOS.trigramEnergies[trigram] || 0;
                    const defensiveEnergy = defensiveEnergies[trigram] || 0;
                    
                    adjusted[trigram] = (defensiveEnergy * defensiveBase) + (coreEnergy * coreInfluence);
                });
                
                return adjusted;
            }

            selectDefensiveTrigrams(energies) {
                // ã‚¨ãƒãƒ«ã‚®ãƒ¼å€¤ã§ã‚½ãƒ¼ãƒˆã—ã¦ä¸Šä½2ã¤ã®ä¸‰çˆ»ã‚’é¸æŠ
                const sorted = Object.entries(energies)
                    .sort(([,a], [,b]) => b - a);
                
                return [sorted[0][0], sorted[1][0]];
            }

            generateSafeModeInterpretation(hexagramId, primaryDefense, secondaryDefense, patterns, engineOS) {
                // SafeMode OSå°‚ç”¨ã®64å¦è§£é‡ˆ
                const defensiveInterpretations = this.getSafeModeHexagramInterpretations();
                const interpretation = defensiveInterpretations[hexagramId] || this.getDefaultDefensiveInterpretation();
                
                // ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸè§£é‡ˆã‚’ç”Ÿæˆ
                const personalizedDescription = this.personalizeSafeModeDescription(
                    interpretation, primaryDefense, secondaryDefense, patterns, engineOS
                );
                
                return {
                    description: personalizedDescription,
                    catchphrase: interpretation.catchphrase || "å›°é›£ã«ç«‹ã¡å‘ã‹ã†é˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ ",
                    defensiveType: interpretation.primaryDefense || "ç·åˆé˜²å¾¡",
                    stressResponse: interpretation.stressResponse || "çŠ¶æ³é©å¿œå‹å¯¾å¿œ",
                    activationTrigger: this.identifyActivationTrigger(patterns)
                };
            }

            getSafeModeHexagramInterpretations() {
                return {
                    1: { // ä¹¾ç‚ºå¤©
                        name: "å¤©é›·ç„¡çª®å‹é˜²å¾¡",
                        catchphrase: "å›°é›£ã‚’åŠ›ã§çªç ´ã™ã‚‹",
                        primaryDefense: "ç©æ¥µçš„å¯¾æŠ—",
                        stressResponse: "æ­£é¢çªç ´ã«ã‚ˆã‚‹è§£æ±º"
                    },
                    2: { // å¤ç‚ºåœ°
                        name: "å¤§åœ°åŒ…å®¹å‹é˜²å¾¡",
                        catchphrase: "å…¨ã¦ã‚’å—ã‘å…¥ã‚ŒåŒ…ã¿è¾¼ã‚€",
                        primaryDefense: "å—å®¹ãƒ»åŒåŒ–",
                        stressResponse: "ç’°å¢ƒã¸ã®å®Œå…¨é©å¿œ"
                    },
                    29: { // åç‚ºæ°´
                        name: "æ·±æ·µæµæ°´å‹é˜²å¾¡",
                        catchphrase: "å›°é›£ã‚’æµã‚Œã‚‹ã‚ˆã†ã«é€šéã™ã‚‹",
                        primaryDefense: "æµ¸é€ãƒ»æŒç¶š",
                        stressResponse: "éšœå®³ã®æœ¬è³ªã‚’ç†è§£ã—è¿‚å›"
                    },
                    52: { // è‰®ç‚ºå±±
                        name: "ä¸å‹•è¦å¡å‹é˜²å¾¡",
                        catchphrase: "çµ¶å¯¾çš„ãªå¢ƒç•Œã‚’è¨­å®šã™ã‚‹",
                        primaryDefense: "é™æ­¢ãƒ»å¢ƒç•Œ",
                        stressResponse: "å®Œå…¨ãªé˜²å¾¡ä½“åˆ¶æ§‹ç¯‰"
                    },
                    58: { // å…Œç‚ºæ²¢
                        name: "èª¿å’Œäº¤æµå‹é˜²å¾¡",
                        catchphrase: "å¯¾è©±ã§å±æ©Ÿã‚’ä¹—ã‚Šè¶Šãˆã‚‹",
                        primaryDefense: "å”èª¿ãƒ»äº¤æ¸‰",
                        stressResponse: "é–¢ä¿‚æ€§ã«ã‚ˆã‚‹å•é¡Œè§£æ±º"
                    },
                    30: { // é›¢ç‚ºç«
                        name: "æ˜ç…§å¤‰å®¹å‹é˜²å¾¡",
                        catchphrase: "çŠ¶æ³ã‚’è¦‹æ¥µã‚å¤‰åŒ–ã™ã‚‹",
                        primaryDefense: "æ´å¯Ÿãƒ»é©å¿œ",
                        stressResponse: "çŠ¶æ³åˆ†æã«ã‚ˆã‚‹æœ€é©åŒ–"
                    },
                    51: { // éœ‡ç‚ºé›·
                        name: "é›»å…‰çŸ³ç«å‹é˜²å¾¡",
                        catchphrase: "ç¬æ™‚ã«è¡Œå‹•ã—å±æ©Ÿã‚’è„±ã™ã‚‹",
                        primaryDefense: "ç¬ç™ºãƒ»æ±ºæ–­",
                        stressResponse: "è¿…é€ŸãªçŠ¶æ³æ‰“é–‹"
                    },
                    57: { // å·½ç‚ºé¢¨
                        name: "é †é¢¨æŸ”è»Ÿå‹é˜²å¾¡",
                        catchphrase: "æŸ”è»Ÿæ€§ã§å›°é›£ã‚’å›é¿ã™ã‚‹",
                        primaryDefense: "æŸ”è»Ÿãƒ»å›é¿",
                        stressResponse: "çŠ¶æ³ã«å¿œã˜ãŸæŸ”è»Ÿå¯¾å¿œ"
                    },
                    // ä»–ã®å¦ã®è§£é‡ˆã‚‚åŒæ§˜ã«...
                    16: { // é›·åœ°äºˆ
                        name: "æº–å‚™å……å®Ÿå‹é˜²å¾¡",
                        catchphrase: "äº‹å‰æº–å‚™ã§å±æ©Ÿã‚’é˜²ã",
                        primaryDefense: "äºˆé˜²ãƒ»æº–å‚™",
                        stressResponse: "å…ˆèª­ã¿ã«ã‚ˆã‚‹å±æ©Ÿå›é¿"
                    },
                    39: { // æ°´å±±è¹‡
                        name: "å›°é›£çªç ´å‹é˜²å¾¡",
                        catchphrase: "å›°é›£ã®ä¸­ã§ã‚‚å‰é€²ã™ã‚‹",
                        primaryDefense: "å¿è€ãƒ»æŒç¶š",
                        stressResponse: "å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹ç²˜ã‚Šå¼·ã•"
                    },
                    3: { // æ°´é›·å±¯
                        name: "åˆæœŸæ··ä¹±å¯¾å¿œå‹é˜²å¾¡",
                        catchphrase: "æ··ä¹±ã®ä¸­ã§ç§©åºã‚’è¦‹ã¤ã‘ã‚‹",
                        primaryDefense: "å¿è€ãƒ»æ•´ç†",
                        stressResponse: "æ··ä¹±çŠ¶æ³ã®æ®µéšçš„æ•´ç†"
                    },
                    4: { // å±±æ°´è’™
                        name: "å­¦ç¿’é©å¿œå‹é˜²å¾¡",
                        catchphrase: "ç„¡çŸ¥ã‚’èªã‚ã¦å­¦ã¶ã“ã¨ã§å®ˆã‚‹",
                        primaryDefense: "å­¦ç¿’ãƒ»å¢ƒç•Œ",
                        stressResponse: "çŸ¥è­˜ä¸è¶³ã®è¬™è™šãªè£œå®Œ"
                    },
                    5: { // æ°´å¤©éœ€
                        name: "æ©Ÿä¼šå¾…æ©Ÿå‹é˜²å¾¡",
                        catchphrase: "é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å¾…ã¤",
                        primaryDefense: "å¾…æ©Ÿãƒ»æŒç¶š",
                        stressResponse: "ç„¦ã‚‰ãšæ©Ÿä¼šã‚’å¾…ã¤æŒä¹…æˆ¦"
                    },
                    6: { // å¤©æ°´è¨Ÿ
                        name: "æ­£å½“é˜²è¡›å‹é˜²å¾¡",
                        catchphrase: "æ­£ç¾©ã‚’ä¸»å¼µã—ã¦ç«‹ã¡å‘ã‹ã†",
                        primaryDefense: "æ­£å½“æ€§ãƒ»å¯¾æŠ—",
                        stressResponse: "æ­£å½“ãªæ¨©åˆ©ã®ä¸»å¼µã¨é˜²è¡›"
                    },
                    7: { // åœ°æ°´å¸«
                        name: "çµ„ç¹”æˆ¦ç•¥å‹é˜²å¾¡",
                        catchphrase: "çµ„ç¹”åŠ›ã§å›°é›£ã«å¯¾å‡¦ã™ã‚‹",
                        primaryDefense: "çµ±ç‡ãƒ»æŒç¶š",
                        stressResponse: "çµ„ç¹”çš„ãªå•é¡Œè§£æ±º"
                    },
                    8: { // æ°´åœ°æ¯”
                        name: "å”èª¿é€£å¸¯å‹é˜²å¾¡",
                        catchphrase: "ä»²é–“ã¨çµæŸã—ã¦å®ˆã‚‹",
                        primaryDefense: "å”èª¿ãƒ»å—å®¹",
                        stressResponse: "ç›¸äº’æ”¯æ´ã«ã‚ˆã‚‹å±æ©Ÿå¯¾å¿œ"
                    },
                    9: { // é¢¨å¤©å°ç•œ
                        name: "å°è¦æ¨¡è“„ç©å‹é˜²å¾¡",
                        catchphrase: "å°ã•ãªæº–å‚™ã§å¤§ããªå±æ©Ÿã«å‚™ãˆã‚‹",
                        primaryDefense: "æº–å‚™ãƒ»æŸ”è»Ÿ",
                        stressResponse: "æ®µéšçš„ãªæº–å‚™ã¨é©å¿œ"
                    },
                    10: { // å¤©æ²¢å±¥
                        name: "æ…é‡æ­©è¡Œå‹é˜²å¾¡",
                        catchphrase: "å±é™ºã‚’æ‰¿çŸ¥ã§æ…é‡ã«é€²ã‚€",
                        primaryDefense: "æ…é‡ãƒ»å¯¾æŠ—",
                        stressResponse: "ãƒªã‚¹ã‚¯èªè­˜ã¨æ…é‡ãªè¡Œå‹•"
                    },
                    11: { // åœ°å¤©æ³°
                        name: "èª¿å’Œå®‰å®šå‹é˜²å¾¡",
                        catchphrase: "å¹³å’Œã¨èª¿å’Œã‚’ç¶­æŒã™ã‚‹",
                        primaryDefense: "å®‰å®šãƒ»å—å®¹",
                        stressResponse: "ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸå¯¾å¿œ"
                    },
                    12: { // å¤©åœ°å¦
                        name: "é–‰å¡çªç ´å‹é˜²å¾¡",
                        catchphrase: "é–‰å¡çŠ¶æ³ã‚’æ‰“ç ´ã™ã‚‹",
                        primaryDefense: "çªç ´ãƒ»å¯¾æŠ—",
                        stressResponse: "ç¾çŠ¶æ‰“ç ´ã«ã‚ˆã‚‹æ´»è·¯é–‹æ‹“"
                    },
                    13: { // å¤©ç«åŒäºº
                        name: "åŒå¿—çµé›†å‹é˜²å¾¡",
                        catchphrase: "å¿—ã‚’åŒã˜ãã™ã‚‹äººã¨çµæŸã™ã‚‹",
                        primaryDefense: "çµæŸãƒ»æ´å¯Ÿ",
                        stressResponse: "ç†å¿µã«ã‚ˆã‚‹å›£çµã¨å¯¾å¿œ"
                    },
                    14: { // ç«å¤©å¤§æœ‰
                        name: "è±Šå¯Œè³‡æºå‹é˜²å¾¡",
                        catchphrase: "è±Šå¯Œãªè³‡æºã§å±æ©Ÿã‚’ä¹—ã‚Šè¶Šãˆã‚‹",
                        primaryDefense: "è±Šç©£ãƒ»æ´å¯Ÿ",
                        stressResponse: "è³‡æºã‚’æ´»ç”¨ã—ãŸåŒ…æ‹¬çš„å¯¾å¿œ"
                    },
                    15: { // åœ°å±±è¬™
                        name: "è¬™éœå›é¿å‹é˜²å¾¡",
                        catchphrase: "è¬™éœã™ã‚‹ã“ã¨ã§å±æ©Ÿã‚’é¿ã‘ã‚‹",
                        primaryDefense: "è¬™è™šãƒ»å¢ƒç•Œ",
                        stressResponse: "ä½å§¿å‹¢ã«ã‚ˆã‚‹æ‘©æ“¦å›é¿"
                    },
                    17: { // æ²¢é›·éš
                        name: "æŸ”è»Ÿè¿½å¾“å‹é˜²å¾¡",
                        catchphrase: "çŠ¶æ³ã«å¾“ã£ã¦æŸ”è»Ÿã«å¯¾å¿œã™ã‚‹",
                        primaryDefense: "è¿½å¾“ãƒ»èª¿å’Œ",
                        stressResponse: "ç’°å¢ƒå¤‰åŒ–ã¸ã®æŸ”è»Ÿãªé©å¿œ"
                    },
                    18: { // å±±é¢¨è ±
                        name: "å•é¡Œä¿®å¾©å‹é˜²å¾¡",
                        catchphrase: "è…æ•—ã‚’æ­£ã—ã¦å¥å…¨åŒ–ã™ã‚‹",
                        primaryDefense: "ä¿®å¾©ãƒ»å¢ƒç•Œ",
                        stressResponse: "æ ¹æœ¬çš„ãªå•é¡Œè§£æ±º"
                    },
                    19: { // åœ°æ²¢è‡¨
                        name: "æ¥è¿‘ç›£è¦–å‹é˜²å¾¡",
                        catchphrase: "è¿‘ã¥ã„ã¦å•é¡Œã‚’ç›£è¦–ã™ã‚‹",
                        primaryDefense: "æ¥è¿‘ãƒ»èª¿å’Œ",
                        stressResponse: "ç©æ¥µçš„ãªé–¢ä¸ã«ã‚ˆã‚‹è§£æ±º"
                    },
                    20: { // é¢¨åœ°è¦³
                        name: "è¦³å¯Ÿæ´å¯Ÿå‹é˜²å¾¡",
                        catchphrase: "é«˜ã„è¦–ç‚¹ã‹ã‚‰çŠ¶æ³ã‚’ä¿¯ç°ã™ã‚‹",
                        primaryDefense: "è¦³å¯Ÿãƒ»æŸ”è»Ÿ",
                        stressResponse: "å®¢è¦³çš„åˆ†æã«ã‚ˆã‚‹å¯¾ç­–ç«‹æ¡ˆ"
                    },
                    21: { // ç«é›·å™¬å—‘
                        name: "éšœå®³é™¤å»å‹é˜²å¾¡",
                        catchphrase: "éšœå®³ã‚’å™›ã¿ç •ã„ã¦é™¤å»ã™ã‚‹",
                        primaryDefense: "é™¤å»ãƒ»æ´å¯Ÿ",
                        stressResponse: "å•é¡Œã®æ ¸å¿ƒã¸ã®ç›´æ¥çš„å¯¾å‡¦"
                    },
                    22: { // å±±ç«è³
                        name: "è£…é£¾éš è”½å‹é˜²å¾¡",
                        catchphrase: "ç¾ã—ãè£…ã£ã¦æœ¬è³ªã‚’éš ã™",
                        primaryDefense: "è£…é£¾ãƒ»å¢ƒç•Œ",
                        stressResponse: "å¤–è¦‹ã‚’æ•´ãˆãŸé˜²å¾¡æˆ¦ç•¥"
                    },
                    23: { // å±±åœ°å‰¥
                        name: "å‰¥é›¢æœ€å°åŒ–å‹é˜²å¾¡",
                        catchphrase: "å¤±ã†ã‚‚ã®ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹",
                        primaryDefense: "ä¿å…¨ãƒ»å¢ƒç•Œ",
                        stressResponse: "æå¤±æœ€å°åŒ–æˆ¦ç•¥"
                    },
                    24: { // åœ°é›·å¾©
                        name: "å¾©å…ƒå›å¾©å‹é˜²å¾¡",
                        catchphrase: "å…ƒã®çŠ¶æ…‹ã«æˆ»ã™ã“ã¨ã§å®‰å®šã‚’å›³ã‚‹",
                        primaryDefense: "å¾©å…ƒãƒ»å—å®¹",
                        stressResponse: "åŸç‚¹å›å¸°ã«ã‚ˆã‚‹å®‰å®šåŒ–"
                    },
                    25: { // å¤©é›·æ— å¦„
                        name: "ç´”çœŸç„¡å¢å‹é˜²å¾¡",
                        catchphrase: "ç´”ç²‹ãªå¿ƒã§ç½ã„ã‚’é¿ã‘ã‚‹",
                        primaryDefense: "ç´”çœŸãƒ»å¯¾æŠ—",
                        stressResponse: "èª å®Ÿã•ã«ã‚ˆã‚‹è‡ªç„¶ãªè§£æ±º"
                    },
                    26: { // å±±å¤©å¤§ç•œ
                        name: "å¤§è¦æ¨¡è“„ç©å‹é˜²å¾¡",
                        catchphrase: "å¤§ããªåŠ›ã‚’è“„ãˆã¦å±æ©Ÿã«å‚™ãˆã‚‹",
                        primaryDefense: "è“„ç©ãƒ»å¢ƒç•Œ",
                        stressResponse: "é•·æœŸçš„ãªæº–å‚™ã«ã‚ˆã‚‹ä¸‡å…¨ãªå¯¾å¿œ"
                    },
                    27: { // å±±é›·é ¤
                        name: "æ „é¤Šè£œçµ¦å‹é˜²å¾¡",
                        catchphrase: "é©åˆ‡ãªæ „é¤Šã§ä½“åŠ›ã‚’ç¶­æŒã™ã‚‹",
                        primaryDefense: "é¤Šè‚²ãƒ»å¢ƒç•Œ",
                        stressResponse: "åŸºç¤ä½“åŠ›ã®ç¶­æŒã¨å¼·åŒ–"
                    },
                    28: { // æ²¢é¢¨å¤§é
                        name: "éå¤§è² è·è€ä¹…å‹é˜²å¾¡",
                        catchphrase: "é™ç•Œã‚’è¶…ãˆãŸè² è·ã«è€ãˆã‚‹",
                        primaryDefense: "è€ä¹…ãƒ»èª¿å’Œ",
                        stressResponse: "æ¥µé™çŠ¶æ³ã§ã®æŒä¹…æˆ¦"
                    },
                    31: { // æ²¢å±±å’¸
                        name: "æ„Ÿå¿œå…±é³´å‹é˜²å¾¡",
                        catchphrase: "ç›¸æ‰‹ã¨æ„Ÿå¿œã—ã¦èª¿å’Œã™ã‚‹",
                        primaryDefense: "æ„Ÿå¿œãƒ»èª¿å’Œ",
                        stressResponse: "ç›¸äº’ç†è§£ã«ã‚ˆã‚‹å•é¡Œè§£æ±º"
                    },
                    32: { // é›·é¢¨æ’
                        name: "æŒç¶šç¶™ç¶šå‹é˜²å¾¡",
                        catchphrase: "å¤‰ã‚ã‚‰ã¬å§¿å‹¢ã§æŒç¶šã™ã‚‹",
                        primaryDefense: "æŒç¶šãƒ»æŸ”è»Ÿ",
                        stressResponse: "ä¸€è²«ã—ãŸæ–¹é‡ã«ã‚ˆã‚‹å®‰å®šå¯¾å¿œ"
                    },
                    33: { // å¤©å±±é¯
                        name: "æˆ¦ç•¥çš„æ’¤é€€å‹é˜²å¾¡",
                        catchphrase: "é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§é€€ã",
                        primaryDefense: "æ’¤é€€ãƒ»å¯¾æŠ—",
                        stressResponse: "æˆ¦ç•¥çš„ãªå¾Œé€€ã«ã‚ˆã‚‹ç«‹ã¦ç›´ã—"
                    },
                    34: { // é›·å¤©å¤§å£®
                        name: "å¼·å¤§åŠ›é‡å‹é˜²å¾¡",
                        catchphrase: "å¼·å¤§ãªåŠ›ã§æ­£é¢çªç ´ã™ã‚‹",
                        primaryDefense: "å¼·åŠ›ãƒ»å¯¾æŠ—",
                        stressResponse: "åœ§å€’çš„ãªåŠ›ã«ã‚ˆã‚‹å•é¡Œè§£æ±º"
                    },
                    35: { // ç«åœ°æ™‹
                        name: "å‰é€²ç™ºå±•å‹é˜²å¾¡",
                        catchphrase: "å‰é€²ã™ã‚‹ã“ã¨ã§å±æ©Ÿã‚’è„±ã™ã‚‹",
                        primaryDefense: "å‰é€²ãƒ»æ´å¯Ÿ",
                        stressResponse: "ç©æ¥µçš„ãªæ”»å‹¢ã«ã‚ˆã‚‹å±€é¢æ‰“é–‹"
                    },
                    36: { // åœ°ç«æ˜å¤·
                        name: "æ½œä¼éš éå‹é˜²å¾¡",
                        catchphrase: "å…‰ã‚’éš ã—ã¦å±é™ºã‚’ã‚„ã‚Šéã”ã™",
                        primaryDefense: "éš éãƒ»å—å®¹",
                        stressResponse: "ç›®ç«‹ãŸãªã„ã“ã¨ã«ã‚ˆã‚‹å®‰å…¨ç¢ºä¿"
                    },
                    37: { // é¢¨ç«å®¶äºº
                        name: "å®¶æ—çµæŸå‹é˜²å¾¡",
                        catchphrase: "å®¶æ—ã®çµ†ã§å±æ©Ÿã‚’ä¹—ã‚Šè¶Šãˆã‚‹",
                        primaryDefense: "çµæŸãƒ»æŸ”è»Ÿ",
                        stressResponse: "èº«å†…ã¨ã®å¼·å›ºãªé€£å¸¯"
                    },
                    38: { // ç«æ²¢ç½
                        name: "å¯¾ç«‹èª¿å’Œå‹é˜²å¾¡",
                        catchphrase: "å¯¾ç«‹ã—ãªãŒã‚‰ã‚‚èª¿å’Œã‚’ä¿ã¤",
                        primaryDefense: "èª¿å’Œãƒ»æ´å¯Ÿ",
                        stressResponse: "é•ã„ã‚’èªã‚ãŸä¸Šã§ã®å”åŠ›"
                    },
                    40: { // é›·æ°´è§£
                        name: "è§£æ”¾é–‹æ”¾å‹é˜²å¾¡",
                        catchphrase: "æŸç¸›ã‚’è§£ã„ã¦è‡ªç”±ã‚’å–ã‚Šæˆ»ã™",
                        primaryDefense: "è§£æ”¾ãƒ»è¿…é€Ÿ",
                        stressResponse: "åˆ¶ç´„ã‹ã‚‰ã®è„±å´ã«ã‚ˆã‚‹å•é¡Œè§£æ±º"
                    },
                    41: { // å±±æ²¢æ
                        name: "é©åˆ‡å‰Šæ¸›å‹é˜²å¾¡",
                        catchphrase: "ç„¡é§„ã‚’å‰Šã£ã¦ã‚¹ãƒªãƒ åŒ–ã™ã‚‹",
                        primaryDefense: "å‰Šæ¸›ãƒ»å¢ƒç•Œ",
                        stressResponse: "åŠ¹ç‡åŒ–ã«ã‚ˆã‚‹ä½“è³ªå¼·åŒ–"
                    },
                    42: { // é¢¨é›·ç›Š
                        name: "ç›¸äº’åˆ©ç›Šå‹é˜²å¾¡",
                        catchphrase: "ã¿ã‚“ãªã®åˆ©ç›Šã§å•é¡Œã‚’è§£æ±ºã™ã‚‹",
                        primaryDefense: "åˆ©ç›Šãƒ»æŸ”è»Ÿ",
                        stressResponse: "win-winã®é–¢ä¿‚æ§‹ç¯‰"
                    },
                    43: { // æ²¢å¤©å¤¬
                        name: "æ±ºæ–­å®Ÿè¡Œå‹é˜²å¾¡",
                        catchphrase: "æ–­å›ºã¨ã—ãŸæ±ºæ–­ã§å±æ©Ÿã‚’æ–­ã¤",
                        primaryDefense: "æ±ºæ–­ãƒ»èª¿å’Œ",
                        stressResponse: "æ˜ç¢ºãªåˆ¤æ–­ã«ã‚ˆã‚‹è¿…é€Ÿãªå¯¾å‡¦"
                    },
                    44: { // å¤©é¢¨å§¤
                        name: "å¶ç„¶é­é‡å‹é˜²å¾¡",
                        catchphrase: "äºˆæœŸã›ã¬å‡ºä¼šã„ã‚’æ´»ç”¨ã™ã‚‹",
                        primaryDefense: "æ©Ÿä¼šãƒ»å¯¾æŠ—",
                        stressResponse: "å¶ç„¶ã®æ©Ÿä¼šã‚’æœ€å¤§é™æ´»ç”¨"
                    },
                    45: { // æ²¢åœ°èƒ
                        name: "é›†çµçµ±åˆå‹é˜²å¾¡",
                        catchphrase: "ã¿ã‚“ãªã§é›†ã¾ã£ã¦åŠ›ã‚’åˆã‚ã›ã‚‹",
                        primaryDefense: "çµ±åˆãƒ»èª¿å’Œ",
                        stressResponse: "é›†å›£ã®åŠ›ã«ã‚ˆã‚‹å•é¡Œè§£æ±º"
                    },
                    46: { // åœ°é¢¨å‡
                        name: "æ®µéšæˆé•·å‹é˜²å¾¡",
                        catchphrase: "æ®µéšã‚’è¿½ã£ã¦æˆé•·ã—å¼·åŒ–ã™ã‚‹",
                        primaryDefense: "æˆé•·ãƒ»å—å®¹",
                        stressResponse: "ç¶™ç¶šçš„ãªæ”¹å–„ã«ã‚ˆã‚‹ä½“è³ªå¼·åŒ–"
                    },
                    47: { // æ²¢æ°´å›°
                        name: "å›°çª®å¿è€å‹é˜²å¾¡",
                        catchphrase: "å›°ã£ãŸæ™‚ã“ãè€ãˆå¿ã¶",
                        primaryDefense: "å¿è€ãƒ»èª¿å’Œ",
                        stressResponse: "è‹¦å¢ƒã§ã®ç²¾ç¥åŠ›ã«ã‚ˆã‚‹æŒä¹…æˆ¦"
                    },
                    48: { // æ°´é¢¨äº•
                        name: "å®‰å®šä¾›çµ¦å‹é˜²å¾¡",
                        catchphrase: "å¤‰ã‚ã‚‰ã¬ä¾¡å€¤ã‚’æä¾›ã—ç¶šã‘ã‚‹",
                        primaryDefense: "å®‰å®šãƒ»æŒç¶š",
                        stressResponse: "ä¿¡é ¼ã§ãã‚‹åŸºç›¤ã®ç¶­æŒ"
                    },
                    49: { // æ²¢ç«é©
                        name: "å¤‰é©åˆ·æ–°å‹é˜²å¾¡",
                        catchphrase: "æ ¹æœ¬ã‹ã‚‰å¤‰ãˆã¦æ–°ã—ãã™ã‚‹",
                        primaryDefense: "å¤‰é©ãƒ»èª¿å’Œ",
                        stressResponse: "æŠœæœ¬çš„ãªæ”¹é©ã«ã‚ˆã‚‹å•é¡Œè§£æ±º"
                    },
                    50: { // ç«é¢¨é¼
                        name: "å®‰å®šçµ±æ²»å‹é˜²å¾¡",
                        catchphrase: "æ–°ã—ã„ç§©åºã§å®‰å®šã‚’å›³ã‚‹",
                        primaryDefense: "çµ±æ²»ãƒ»æ´å¯Ÿ",
                        stressResponse: "æ–°ä½“åˆ¶ã«ã‚ˆã‚‹å®‰å®šåŒ–"
                    },
                    53: { // é¢¨å±±æ¼¸
                        name: "æ¼¸é€²ç™ºå±•å‹é˜²å¾¡",
                        catchphrase: "å°‘ã—ãšã¤ç€å®Ÿã«é€²æ­©ã™ã‚‹",
                        primaryDefense: "æ¼¸é€²ãƒ»æŸ”è»Ÿ",
                        stressResponse: "æ®µéšçš„ãªæ”¹å–„ã«ã‚ˆã‚‹å®‰å®šæˆé•·"
                    },
                    54: { // é›·æ²¢å¸°å¦¹
                        name: "é©å¿œé †å¿œå‹é˜²å¾¡",
                        catchphrase: "ä¸ãˆã‚‰ã‚ŒãŸå½¹å‰²ã«é †å¿œã™ã‚‹",
                        primaryDefense: "é †å¿œãƒ»è¿…é€Ÿ",
                        stressResponse: "ç’°å¢ƒã«åˆã‚ã›ãŸæŸ”è»Ÿãªé©å¿œ"
                    },
                    55: { // é›·ç«è±Š
                        name: "è±Šç©£å……å®Ÿå‹é˜²å¾¡",
                        catchphrase: "è±Šã‹ã•ã®ä¸­ã§ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã¤",
                        primaryDefense: "è±Šç©£ãƒ»è¿…é€Ÿ",
                        stressResponse: "ä½™è£•ã®ã‚ã‚‹çŠ¶æ³ã§ã®é©åˆ‡ãªåˆ¤æ–­"
                    },
                    56: { // ç«å±±æ—…
                        name: "æ—…è¡Œé©å¿œå‹é˜²å¾¡",
                        catchphrase: "æ…£ã‚Œãªã„ç’°å¢ƒã«é©å¿œã™ã‚‹",
                        primaryDefense: "é©å¿œãƒ»æ´å¯Ÿ",
                        stressResponse: "å¤‰åŒ–ã¸ã®æŸ”è»Ÿãªå¯¾å¿œ"
                    },
                    59: { // é¢¨æ°´æ¸™
                        name: "åˆ†æ•£ç·©å’Œå‹é˜²å¾¡",
                        catchphrase: "å›ºã¾ã£ãŸã‚‚ã®ã‚’åˆ†æ•£ã—ã¦å’Œã‚‰ã’ã‚‹",
                        primaryDefense: "åˆ†æ•£ãƒ»æŸ”è»Ÿ",
                        stressResponse: "ç·Šå¼µã®ç·©å’Œã«ã‚ˆã‚‹å•é¡Œè§£æ±º"
                    },
                    60: { // æ°´æ²¢ç¯€
                        name: "ç¯€åˆ¶é™å®šå‹é˜²å¾¡",
                        catchphrase: "é©åˆ‡ãªç¯€åº¦ã§å®‰å®šã‚’ä¿ã¤",
                        primaryDefense: "ç¯€åˆ¶ãƒ»æŒç¶š",
                        stressResponse: "ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸåˆ¶é™ã«ã‚ˆã‚‹å®‰å®š"
                    },
                    61: { // é¢¨æ²¢ä¸­å­š
                        name: "èª å®Ÿä¿¡é ¼å‹é˜²å¾¡",
                        catchphrase: "èª å®Ÿã•ã§ä¿¡é ¼ã‚’ç¯‰ãå®ˆã‚‹",
                        primaryDefense: "èª å®Ÿãƒ»æŸ”è»Ÿ",
                        stressResponse: "ä¿¡é ¼é–¢ä¿‚ã«ã‚ˆã‚‹å•é¡Œè§£æ±º"
                    },
                    62: { // é›·å±±å°é
                        name: "å°è¦æ¨¡è¶…è¶Šå‹é˜²å¾¡",
                        catchphrase: "å°ã•ãªåŠªåŠ›ã§å¤§ããªåŠ¹æœã‚’å¾—ã‚‹",
                        primaryDefense: "åŠ¹ç‡ãƒ»è¿…é€Ÿ",
                        stressResponse: "å°ã•ãªå·¥å¤«ã«ã‚ˆã‚‹åŠ¹æœçš„å¯¾å¿œ"
                    },
                    63: { // æ°´ç«æ—¢æ¸ˆ
                        name: "å®Œæˆç¶­æŒå‹é˜²å¾¡",
                        catchphrase: "å®Œæˆã—ãŸçŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹",
                        primaryDefense: "ç¶­æŒãƒ»æŒç¶š",
                        stressResponse: "ç¾çŠ¶ç¶­æŒã«ã‚ˆã‚‹å®‰å®šç¢ºä¿"
                    },
                    64: { // ç«æ°´æœªæ¸ˆ
                        name: "æœªå®Œæˆç™ºå±•å‹é˜²å¾¡",
                        catchphrase: "æœªå®Œæˆã ã‹ã‚‰ã“ãå¯èƒ½æ€§ãŒã‚ã‚‹",
                        primaryDefense: "ç™ºå±•ãƒ»æ´å¯Ÿ",
                        stressResponse: "æ”¹å–„ã®ä½™åœ°ã‚’æ´»ç”¨ã—ãŸæˆé•·"
                    }
                };
            }

            getDefaultDefensiveInterpretation() {
                return {
                    name: "ç·åˆé©å¿œå‹é˜²å¾¡",
                    catchphrase: "çŠ¶æ³ã«å¿œã˜ã¦æœ€é©ãªé˜²å¾¡ã‚’é¸æŠã™ã‚‹",
                    primaryDefense: "é©å¿œãƒ»èª¿æ•´",
                    stressResponse: "ãƒãƒ©ãƒ³ã‚¹å‹å±æ©Ÿå¯¾å¿œ"
                };
            }

            personalizeSafeModeDescription(interpretation, primary, secondary, patterns, engineOS) {
                const stressLevel = this.calculateOverallStressLevel(patterns);
                const primaryStrength = this.getTrigramStrength(primary, patterns);
                const secondaryStrength = this.getTrigramStrength(secondary, patterns);
                
                let description = `${interpretation.name}: ${interpretation.primaryDefense}ã‚’ä¸»è»¸ã¨ã—ãŸé˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ ã€‚`;
                
                if (stressLevel > 0.7) {
                    description += "é«˜ã‚¹ãƒˆãƒ¬ã‚¹ç’°å¢ƒä¸‹ã§å¼·åŠ›ã«ç™ºå‹•ã—ã€";
                } else if (stressLevel > 0.4) {
                    description += "ä¸­ç¨‹åº¦ã®ã‚¹ãƒˆãƒ¬ã‚¹çŠ¶æ³ã§é©åˆ‡ã«ä½œå‹•ã—ã€";
                } else {
                    description += "è»½å¾®ãªã‚¹ãƒˆãƒ¬ã‚¹çŠ¶æ³ã§ã‚‚äºˆé˜²çš„ã«æ©Ÿèƒ½ã—ã€";
                }
                
                description += `${primary}ã®${this.getTrigramDefensiveCharacter(primary)}ã¨${secondary}ã®${this.getTrigramDefensiveCharacter(secondary)}ã‚’çµ„ã¿åˆã‚ã›ã¦å¯¾å¿œã™ã‚‹ã€‚`;
                
                return description;
            }

            getTrigramDefensiveCharacter(trigram) {
                const characters = {
                    ä¹¾: "å¼·åŠ›ãªå¯¾æŠ—åŠ›",
                    å…Œ: "èª¿å’Œçš„è§£æ±ºåŠ›",
                    é›¢: "çŠ¶æ³æ´å¯ŸåŠ›",
                    éœ‡: "è¿…é€Ÿãªè¡Œå‹•åŠ›",
                    å·½: "æŸ”è»Ÿãªé©å¿œåŠ›",
                    å: "æŒç¶šçš„å¿è€åŠ›",
                    è‰®: "å …å›ºãªå¢ƒç•ŒåŠ›",
                    å¤: "åŒ…å®¹çš„å—å®¹åŠ›"
                };
                return characters[trigram] || "ç·åˆçš„é˜²å¾¡åŠ›";
            }

            identifyActivationTrigger(patterns) {
                const triggers = [];
                
                Object.entries(patterns).forEach(([type, response]) => {
                    if (response.intensity > 0.6) {
                        switch(type) {
                            case 'leadershipStress': triggers.push('è²¬ä»»ã®é‡åœ§'); break;
                            case 'interpersonalStress': triggers.push('äººé–“é–¢ä¿‚ã®æ‘©æ“¦'); break;
                            case 'familyStress': triggers.push('è¦ªå¯†é–¢ä¿‚ã®è² è·'); break;
                            case 'emergencyStress': triggers.push('ç·Šæ€¥äº‹æ…‹'); break;
                            case 'competitionStress': triggers.push('ç«¶äº‰ç’°å¢ƒ'); break;
                            case 'collaborationStress': triggers.push('å”èª¿ã®è² æ‹…'); break;
                        }
                    }
                });
                
                return triggers.length > 0 ? triggers.join('ã€') : 'ä¸€èˆ¬çš„ãªã‚¹ãƒˆãƒ¬ã‚¹çŠ¶æ³';
            }

            calculateDefensiveStrength(patterns) {
                const intensities = Object.values(patterns).map(p => p.intensity || 0);
                return intensities.reduce((sum, intensity) => sum + intensity, 0) / intensities.length;
            }

            calculateOverallStressLevel(patterns) {
                return this.calculateDefensiveStrength(patterns);
            }

            getTrigramStrength(trigram, patterns) {
                // ä¸‰çˆ»ã®é˜²å¾¡ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®å¼·åº¦ã‚’è¨ˆç®—
                const trigramPatternMap = {
                    ä¹¾: ['å¯¾æŠ—', 'ç¡¬åŒ–'],
                    å…Œ: ['èª¿å’Œ', 'å›é¿'],
                    é›¢: ['å¤‰å®¹', 'å¯¾æŠ—'],
                    éœ‡: ['ç¡¬åŒ–', 'å¯¾æŠ—'],
                    å·½: ['å›é¿', 'å¤‰å®¹'],
                    å: ['è€å¿', 'çµç•Œ'],
                    è‰®: ['çµç•Œ', 'æ’¤é€€'],
                    å¤: ['æ’¤é€€', 'åŒåŒ–']
                };
                
                const relevantPatterns = trigramPatternMap[trigram] || [];
                let strength = 0;
                let count = 0;
                
                Object.values(patterns).forEach(response => {
                    if (relevantPatterns.includes(response.pattern)) {
                        strength += response.intensity;
                        count++;
                    }
                });
                
                return count > 0 ? strength / count : 0.5;
            }

            getDefaultSafeModeOS() {
                return {
                    hexagramId: 39, // æ°´å±±è¹‡ - å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹
                    hexagramName: "æ°´å±±è¹‡",
                    description: "å›°é›£ãªçŠ¶æ³ã§ã‚‚ç²˜ã‚Šå¼·ãå‰é€²ã™ã‚‹é˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ ",
                    catchphrase: "å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹ä¸å±ˆã®ç²¾ç¥",
                    primaryDefense: "å",
                    secondaryDefense: "è‰®",
                    defensiveType: "å›°é›£çªç ´å‹",
                    stressResponse: "å¿è€ã¨å¢ƒç•Œè¨­å®šã«ã‚ˆã‚‹æŒä¹…æˆ¦",
                    activationTrigger: "å›°é›£ãªçŠ¶æ³å…¨èˆ¬",
                    defensiveStrength: 0.6,
                    trigramEnergies: { ä¹¾: 0.3, å…Œ: 0.2, é›¢: 0.2, éœ‡: 0.3, å·½: 0.2, å: 0.7, è‰®: 0.6, å¤: 0.4 },
                    type: "Safe Mode OS"
                };
            }

            /**
             * Interface OSåˆ†æã®è£œåŠ©ãƒ¡ã‚½ãƒƒãƒ‰ç¾¤
             */
             
            // 1. ã‚·ãƒŠãƒªã‚ªè³ªå•ï¼ˆQ25-Q30ï¼‰ã‹ã‚‰ç¤¾ä¼šçš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æ
            analyzeSocialPatterns(scenarioAnswers) {
                const patterns = {
                    Q25_leadership: 0,      // ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—çŠ¶æ³å¯¾å¿œ
                    Q26_interpersonal: 0,   // å¯¾äººé–¢ä¿‚å›°é›£ã¸ã®å¯¾å‡¦
                    Q27_family: 0,          // å®¶æ—ãƒ»è¦ªå¯†é–¢ä¿‚ã®å‡¦ç†
                    Q28_emergency: 0,       // ç·Šæ€¥äº‹æ…‹ãƒ»å±æ©Ÿç®¡ç†
                    Q29_competition: 0,     // ç«¶äº‰ãƒ»äº‰ã„ã¸ã®å¯¾å¿œ
                    Q30_community: 0        // å…±åŒä½“ãƒ»å”åŠ›é–¢ä¿‚æ§‹ç¯‰
                };
                
                // ã‚·ãƒŠãƒªã‚ªå›ç­”ã‹ã‚‰ç¤¾ä¼šçš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚¹ã‚³ã‚¢è¨ˆç®—
                scenarioAnswers.forEach((answer, index) => {
                    const questionId = `Q${25 + index}`;
                    const scoreValue = this.calculateScenarioScore(answer, questionId);
                    
                    switch (questionId) {
                        case 'Q25': patterns.Q25_leadership = scoreValue; break;
                        case 'Q26': patterns.Q26_interpersonal = scoreValue; break;
                        case 'Q27': patterns.Q27_family = scoreValue; break;
                        case 'Q28': patterns.Q28_emergency = scoreValue; break;
                        case 'Q29': patterns.Q29_competition = scoreValue; break;
                        case 'Q30': patterns.Q30_community = scoreValue; break;
                    }
                });
                
                return patterns;
            }
            
            // 2. Interface OSå°‚ç”¨ã®8æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«æ§‹ç¯‰
            buildInterfaceVector(socialPatterns) {
                const vector = {
                    "å¤–å‘_ä¸»å°æ€§": 0,    // ä¹¾ - ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ãƒ»ä¸»å°
                    "å¤–å‘_èª¿å’Œæ€§": 0,    // å…Œ - ç¤¾äº¤ãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
                    "å¤–å‘_è¡¨ç¾æ€§": 0,    // é›¢ - ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»é­…åŠ›
                    "å¤–å‘_è¡Œå‹•æ€§": 0,    // éœ‡ - å³å¿œæ€§ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                    "å†…å‘_é©å¿œæ€§": 0,    // å·½ - é †å¿œãƒ»å”èª¿
                    "å†…å‘_åˆ†ææ€§": 0,    // å - è¦³å¯Ÿãƒ»æ´å¯Ÿ
                    "å†…å‘_å®‰å®šæ€§": 0,    // è‰® - ä¸€è²«æ€§ãƒ»ä¿¡é ¼æ€§
                    "å†…å‘_æ”¯æ´æ€§": 0     // å¤ - ã‚µãƒãƒ¼ãƒˆãƒ»è²¢çŒ®
                };
                
                // Q25-Q30ã®ç¤¾ä¼šçš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’8æ¬¡å…ƒã«ãƒãƒƒãƒ”ãƒ³ã‚°
                vector["å¤–å‘_ä¸»å°æ€§"] = (socialPatterns.Q25_leadership * 0.5) + (socialPatterns.Q28_emergency * 0.3);
                vector["å¤–å‘_èª¿å’Œæ€§"] = (socialPatterns.Q26_interpersonal * 0.4) + (socialPatterns.Q30_community * 0.4);
                vector["å¤–å‘_è¡¨ç¾æ€§"] = (socialPatterns.Q25_leadership * 0.3) + (socialPatterns.Q26_interpersonal * 0.3);
                vector["å¤–å‘_è¡Œå‹•æ€§"] = (socialPatterns.Q28_emergency * 0.4) + (socialPatterns.Q29_competition * 0.4);
                
                vector["å†…å‘_é©å¿œæ€§"] = (socialPatterns.Q26_interpersonal * 0.3) + (socialPatterns.Q27_family * 0.4);
                vector["å†…å‘_åˆ†ææ€§"] = (socialPatterns.Q28_emergency * 0.3) + (socialPatterns.Q29_competition * 0.3);
                vector["å†…å‘_å®‰å®šæ€§"] = (socialPatterns.Q27_family * 0.4) + (socialPatterns.Q30_community * 0.3);
                vector["å†…å‘_æ”¯æ´æ€§"] = (socialPatterns.Q27_family * 0.3) + (socialPatterns.Q30_community * 0.3);
                
                // æ­£è¦åŒ–ï¼ˆ0-1ç¯„å›²ï¼‰
                Object.keys(vector).forEach(key => {
                    vector[key] = Math.max(0, Math.min(1, vector[key]));
                });
                
                return vector;
            }
            
            // 3. ç¤¾ä¼šçš„ä¸‰çˆ»ã‚¨ãƒãƒ«ã‚®ãƒ¼è¨ˆç®—
            calculateSocialTrigramEnergies(interfaceVector) {
                return {
                    "ä¹¾": interfaceVector["å¤–å‘_ä¸»å°æ€§"] * 1.0,
                    "å…Œ": interfaceVector["å¤–å‘_èª¿å’Œæ€§"] * 1.0,
                    "é›¢": interfaceVector["å¤–å‘_è¡¨ç¾æ€§"] * 1.0,
                    "éœ‡": interfaceVector["å¤–å‘_è¡Œå‹•æ€§"] * 1.0,
                    "å·½": interfaceVector["å†…å‘_é©å¿œæ€§"] * 1.0,
                    "å": interfaceVector["å†…å‘_åˆ†ææ€§"] * 1.0,
                    "è‰®": interfaceVector["å†…å‘_å®‰å®šæ€§"] * 1.0,
                    "å¤": interfaceVector["å†…å‘_æ”¯æ´æ€§"] * 1.0
                };
            }
            
            // 4. Engine OSã¨ã®ç›¸äº’ä½œç”¨è£œæ­£
            adjustForEngineOS(socialEnergies, engineOS) {
                const adjustedEnergies = { ...socialEnergies };
                const engineInfluence = 0.25; // 25%ã®å½±éŸ¿åº¦
                
                if (!engineOS || !engineOS.upperTrigram || !engineOS.lowerTrigram) {
                    return adjustedEnergies;
                }
                
                // Engine OSã®ä¸»è¦ä¸‰çˆ»ãŒç¤¾ä¼šçš„è¡¨ç¾ã«ä¸ãˆã‚‹å½±éŸ¿
                const enginePrimary = engineOS.upperTrigram;
                
                // å†…å‘çš„Engine OSã¯å¤–å‘çš„Interface OSã‚’æŠ‘åˆ¶
                if (["å¤", "è‰®", "å", "å·½"].includes(enginePrimary)) {
                    adjustedEnergies["ä¹¾"] *= (1 - engineInfluence * 0.8);
                    adjustedEnergies["é›¢"] *= (1 - engineInfluence * 0.6);
                    adjustedEnergies["éœ‡"] *= (1 - engineInfluence * 0.7);
                    adjustedEnergies["å…Œ"] *= (1 - engineInfluence * 0.4);
                }
                
                // å¤–å‘çš„Engine OSã¯å¤–å‘çš„Interface OSã‚’å¼·åŒ–
                if (["ä¹¾", "å…Œ", "é›¢", "éœ‡"].includes(enginePrimary)) {
                    adjustedEnergies["ä¹¾"] *= (1 + engineInfluence * 0.6);
                    adjustedEnergies["é›¢"] *= (1 + engineInfluence * 0.5);
                    adjustedEnergies["éœ‡"] *= (1 + engineInfluence * 0.5);
                    adjustedEnergies["å…Œ"] *= (1 + engineInfluence * 0.7);
                }
                
                // ç‰¹å®šã®Engine OSçµ„ã¿åˆã‚ã›è£œæ­£
                if (enginePrimary === "å¤") { // å—å®¹çš„Engine OS
                    adjustedEnergies["å¤"] *= (1 + engineInfluence * 1.2);
                    adjustedEnergies["å·½"] *= (1 + engineInfluence * 0.8);
                }
                
                if (enginePrimary === "ä¹¾") { // å‰µé€ çš„Engine OS
                    adjustedEnergies["ä¹¾"] *= (1 + engineInfluence * 1.0);
                    adjustedEnergies["éœ‡"] *= (1 + engineInfluence * 0.7);
                }
                
                return adjustedEnergies;
            }
            
            // 5. Interface OSç”¨ã®æœ€é©ä¸‰çˆ»é¸æŠ
            selectInterfaceTrigrams(adjustedEnergies) {
                // ç¤¾ä¼šçš„è¡¨ç¾ã§ã¯å¤–å¦ï¼ˆä¸Šå¦ï¼‰ã‚’é‡è¦–
                const sortedTrigrams = Object.entries(adjustedEnergies)
                    .sort(([, a], [, b]) => b - a);
                
                const upperTrigram = sortedTrigrams[0][0];
                const lowerTrigram = sortedTrigrams[1][0];
                
                // ç¤¾ä¼šçš„ç›¸äº’ä½œç”¨ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
                if (this.isValidSocialCombination(upperTrigram, lowerTrigram)) {
                    return { upperTrigram, lowerTrigram };
                } else {
                    // ç„¡åŠ¹ãªçµ„ã¿åˆã‚ã›ã®å ´åˆã€èª¿æ•´
                    return this.adjustSocialCombination(sortedTrigrams);
                }
            }
            
            // 6. Interface OSå°‚ç”¨è§£é‡ˆç”Ÿæˆ
            generateInterfaceInterpretation(hexagramId, upperTrigram, lowerTrigram, socialPatterns, engineOS) {
                const baseInterpretation = this.getInterfaceHexagramInterpretation(hexagramId);
                
                return {
                    description: baseInterpretation.description,
                    leadership: this.analyzeLeadershipStyle(upperTrigram, socialPatterns),
                    communication: this.analyzeCommunicationStyle(upperTrigram, lowerTrigram, socialPatterns),
                    conflictResolution: this.analyzeConflictStyle(lowerTrigram, socialPatterns),
                    adaptability: this.analyzeAdaptability(upperTrigram, lowerTrigram, socialPatterns),
                    engineOSInfluence: this.analyzeEngineInfluence(engineOS, upperTrigram, lowerTrigram)
                };
            }
            
            // 7. ç¤¾ä¼šçš„ã‚¹ã‚¿ã‚¤ãƒ«åˆ¤å®š
            determineSocialStyle(socialPatterns) {
                const leadership = socialPatterns.Q25_leadership;
                const interpersonal = socialPatterns.Q26_interpersonal;
                const community = socialPatterns.Q30_community;
                
                if (leadership > 0.7) return "ä¸»å°å‹ãƒªãƒ¼ãƒ€ãƒ¼";
                if (community > 0.7) return "å”èª¿å‹ãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ã‚¿ãƒ¼";
                if (interpersonal > 0.7) return "å¯¾äººé–¢ä¿‚é‡è¦–å‹";
                if (leadership > 0.5 && community > 0.5) return "ãƒãƒ©ãƒ³ã‚¹å‹ãƒªãƒ¼ãƒ€ãƒ¼";
                return "é©å¿œå‹ã‚µãƒãƒ¼ã‚¿ãƒ¼";
            }
            
            // 8. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆInterface OS
            getDefaultInterfaceOS() {
                return {
                    hexagramId: 11,
                    hexagramName: "åœ°å¤©æ³°",
                    upperTrigram: "å¤",
                    lowerTrigram: "ä¹¾", 
                    socialPatterns: { Q25_leadership: 0.5, Q26_interpersonal: 0.5, Q27_family: 0.5, Q28_emergency: 0.5, Q29_competition: 0.5, Q30_community: 0.5 },
                    interfaceVector: {},
                    socialStyle: "ãƒãƒ©ãƒ³ã‚¹å‹",
                    description: "èª¿å’Œã¨ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã™ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç¤¾ä¼šçš„äººæ ¼",
                    leadership: "åŒ…å®¹çš„ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—",
                    communication: "åŒæ–¹å‘ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³",
                    conflictResolution: "ä»²ä»‹ãƒ»èª¿åœå‹",
                    adaptability: "é«˜ã„é©å¿œåŠ›",
                    engineOSInfluence: "å®‰å®šã—ãŸç›¸äº’ä½œç”¨",
                    type: "Interface OS"
                };
            }
            
            /**
             * Interface OSåˆ†æã®è©³ç´°è£œåŠ©ãƒ¡ã‚½ãƒƒãƒ‰ç¾¤
             */
             
            // ã‚·ãƒŠãƒªã‚ªå›ç­”ã®ã‚¹ã‚³ã‚¢è¨ˆç®—
            calculateScenarioScore(answer, questionId) {
                // å›ç­”é¸æŠè‚¢ã«åŸºã¥ãã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
                // A=1.0, B=0.75, C=0.5, D=0.25 ã®åŸºæœ¬ã‚¹ã‚³ã‚¢
                const baseScore = {
                    'A': 1.0,
                    'B': 0.75, 
                    'C': 0.5,
                    'D': 0.25
                }[answer] || 0.5;
                
                // è³ªå•ã‚¿ã‚¤ãƒ—ã«ã‚ˆã‚‹é‡ã¿èª¿æ•´
                const questionWeights = {
                    'Q25': 1.0, // ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—
                    'Q26': 0.9, // å¯¾äººé–¢ä¿‚
                    'Q27': 0.8, // å®¶æ—
                    'Q28': 1.0, // ç·Šæ€¥äº‹æ…‹
                    'Q29': 0.9, // ç«¶äº‰
                    'Q30': 0.8  // å…±åŒä½“
                };
                
                return baseScore * (questionWeights[questionId] || 1.0);
            }
            
            // ç¤¾ä¼šçš„çµ„ã¿åˆã‚ã›ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
            isValidSocialCombination(upperTrigram, lowerTrigram) {
                // ç¤¾ä¼šçš„ã«ä¸é©åˆ‡ãªçµ„ã¿åˆã‚ã›ã‚’é™¤å¤–
                const invalidCombinations = [
                    // åŒã˜ä¸‰çˆ»ã®é‡è¤‡ã¯é¿ã‘ã‚‹
                    [upperTrigram, upperTrigram]
                ];
                
                return !invalidCombinations.some(([upper, lower]) => 
                    upper === upperTrigram && lower === lowerTrigram
                );
            }
            
            // ç¤¾ä¼šçš„çµ„ã¿åˆã‚ã›ã®èª¿æ•´
            adjustSocialCombination(sortedTrigrams) {
                // ä¸Šä½3ã¤ã‹ã‚‰é©åˆ‡ãªçµ„ã¿åˆã‚ã›ã‚’é¸æŠ
                for (let i = 0; i < sortedTrigrams.length - 1; i++) {
                    for (let j = i + 1; j < sortedTrigrams.length; j++) {
                        const upper = sortedTrigrams[i][0];
                        const lower = sortedTrigrams[j][0];
                        
                        if (this.isValidSocialCombination(upper, lower)) {
                            return { upperTrigram: upper, lowerTrigram: lower };
                        }
                    }
                }
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šä¹¾-å¤ çµ„ã¿åˆã‚ã›
                return { upperTrigram: "ä¹¾", lowerTrigram: "å¤" };
            }
            
            // Interface OSå°‚ç”¨ã®64å¦è§£é‡ˆãƒ‡ãƒ¼ã‚¿
            getInterfaceHexagramInterpretation(hexagramId) {
                const interpretations = {
                    // ä¸»è¦64å¦ã®ç¤¾ä¼šçš„äººæ ¼è§£é‡ˆ
                    1: { description: "ç´”ç²‹ãªå‰µé€ çš„ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ— - é©æ–°çš„ãªç¤¾ä¼šçš„å½±éŸ¿åŠ›", leadership: "å‰µé€ çš„", communication: "inspiring" },
                    2: { description: "å—å®¹çš„ãªæ”¯æ´å‹äººæ ¼ - å”èª¿ã¨è‚²æˆé‡è¦–", leadership: "æ”¯æ´çš„", communication: "empathetic" },
                    3: { description: "åˆæœŸæ®µéšã®çµ„ç¹”è€… - åŸºç›¤æ§‹ç¯‰é‡è¦–", leadership: "çµ„ç¹”æ§‹ç¯‰å‹", communication: "foundational" },
                    4: { description: "æŒ‡å°çš„ãƒ¡ãƒ³ã‚¿ãƒ¼ - æ•™è‚²ã¨æˆé•·ä¿ƒé€²", leadership: "ãƒ¡ãƒ³ã‚¿ãƒ¼å‹", communication: "educational" },
                    5: { description: "æˆ¦ç•¥çš„å¾…æ©Ÿè€… - ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’é‡è¦–", leadership: "æˆ¦ç•¥çš„", communication: "strategic" },
                    6: { description: "æ…é‡ãªèª¿åœè€… - å¯¾ç«‹å›é¿é‡è¦–", leadership: "èª¿åœå‹", communication: "diplomatic" },
                    7: { description: "é›†å›£æŒ‡å°è€… - ãƒãƒ¼ãƒ çµ±ç‡é‡è¦–", leadership: "é›†å›£çµ±ç‡", communication: "commanding" },
                    8: { description: "å”åŠ›ä¿ƒé€²è€… - é€£æºã¨çµæŸé‡è¦–", leadership: "å”åŠ›ä¿ƒé€²", communication: "unifying" },
                    9: { description: "ç´°ã‚„ã‹ãªç®¡ç†è€… - è©³ç´°ã¸ã®é…æ…®", leadership: "ç®¡ç†å‹", communication: "detailed" },
                    10: { description: "ç¤¼å„€æ­£ã—ã„äº¤æ¸‰è€… - å“æ ¼é‡è¦–", leadership: "å“æ ¼é‡è¦–", communication: "dignified" },
                    11: { description: "èª¿å’Œçš„ãƒªãƒ¼ãƒ€ãƒ¼ - ãƒãƒ©ãƒ³ã‚¹ã¨çµ±åˆã‚’é‡è¦–", leadership: "çµ±åˆçš„", communication: "inclusive" },
                    12: { description: "ç‹¬ç«‹çš„æ€è€ƒè€… - ç‹¬è‡ªã®ç¤¾ä¼šçš„ç«‹å ´", leadership: "ç‹¬ç«‹çš„", communication: "selective" },
                    13: { description: "åŒäººå‹å”åŠ›è€… - å…±åŒä½“æ„è­˜é‡è¦–", leadership: "å”åŠ›çš„", communication: "collaborative" },
                    14: { description: "å¤§æœ‰å‹æˆæœä¸»ç¾©è€… - å®Ÿç¸¾ã¨æˆæœé‡è¦–", leadership: "æˆæœä¸»ç¾©", communication: "results-oriented" },
                    15: { description: "è¬™è™šãªå®ŸåŠ›è€… - æ§ãˆã‚ãªãŒã‚‰ç¢ºå®Ÿ", leadership: "è¬™è™šãªå®ŸåŠ›", communication: "modest" },
                    16: { description: "ç†±æ„ã‚ã‚‹å‹•æ©Ÿä»˜ã‘è€… - ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é‡è¦–", leadership: "å‹•æ©Ÿä»˜ã‘", communication: "enthusiastic" },
                    17: { description: "è¿½éšãƒ»é©å¿œå‹ - çŠ¶æ³å¯¾å¿œé‡è¦–", leadership: "è¿½éšé©å¿œ", communication: "responsive" },
                    18: { description: "å•é¡Œè§£æ±ºè€… - èª²é¡Œæ”¹å–„é‡è¦–", leadership: "å•é¡Œè§£æ±º", communication: "reformative" },
                    19: { description: "è¦ªã—ã¿ã‚„ã™ã„æ¥è¿‘è€… - äººé–“é–¢ä¿‚é‡è¦–", leadership: "è¦ªå’Œçš„", communication: "approachable" },
                    20: { description: "è¦³å¯Ÿãƒ»åˆ†æå‹ - æ´å¯ŸåŠ›é‡è¦–", leadership: "åˆ†æè¦³å¯Ÿ", communication: "insightful" },
                    21: { description: "å…¬æ­£ãªè£å®šè€… - å®¢è¦³æ€§é‡è¦–", leadership: "å…¬æ­£è£å®š", communication: "objective" },
                    22: { description: "ç¾çš„ã‚»ãƒ³ã‚¹é‡è¦– - é­…åŠ›ã¨è£…é£¾", leadership: "ç¾çš„è¡¨ç¾", communication: "aesthetic" },
                    23: { description: "æ®µéšçš„å¤‰é©è€… - æ…é‡ãªæ”¹é©", leadership: "æ®µéšå¤‰é©", communication: "gradual" },
                    24: { description: "å¾©æ´»ãƒ»å†ç”Ÿå‹ - ç«‹ã¡ç›´ã‚Šé‡è¦–", leadership: "å¾©æ´»å†ç”Ÿ", communication: "resilient" },
                    25: { description: "è‡ªç„¶ä½“ãƒ»ç„¡é‚ªæ°— - ç´”ç²‹æ€§é‡è¦–", leadership: "è‡ªç„¶ä½“", communication: "authentic" },
                    26: { description: "è“„ç©ãƒ»æº–å‚™å‹ - åŠ›ã®æ¸©å­˜é‡è¦–", leadership: "è“„ç©æº–å‚™", communication: "preparative" },
                    27: { description: "é¤Šè‚²ãƒ»æ”¯æ´å‹ - ã‚±ã‚¢ã¨æˆé•·", leadership: "é¤Šè‚²æ”¯æ´", communication: "nurturing" },
                    28: { description: "éå¤§è² è·å¯¾å¿œ - é‡è²¬ã¸ã®æŒ‘æˆ¦", leadership: "é‡è²¬å¯¾å¿œ", communication: "challenging" },
                    29: { description: "å›°é›£çªç ´è€… - å±é™ºãªçŠ¶æ³ã¸ã®å¯¾å‡¦", leadership: "å›°é›£çªç ´", communication: "persevering" },
                    30: { description: "æ˜æ™°ãªè¡¨ç¾è€… - æ˜ç¢ºæ€§ã¨è¼ã", leadership: "æ˜æ™°è¡¨ç¾", communication: "illuminating" },
                    31: { description: "æ„ŸåŒ–ãƒ»å½±éŸ¿åŠ› - ç›¸äº’ä½œç”¨é‡è¦–", leadership: "ç›¸äº’æ„ŸåŒ–", communication: "influential" },
                    32: { description: "æŒç¶šãƒ»ç¶™ç¶šå‹ - é•·æœŸçš„è¦–ç‚¹", leadership: "æŒç¶šç¶™ç¶š", communication: "enduring" },
                    33: { description: "æˆ¦ç•¥çš„æ’¤é€€è€… - é©åˆ‡ãªå¼•ãéš›", leadership: "æˆ¦ç•¥æ’¤é€€", communication: "tactical" },
                    34: { description: "å¤§ããªåŠ›ã®ç™ºæ® - å¼·åŠ›ãªãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—", leadership: "å¼·åŠ›ç™ºæ®", communication: "powerful" },
                    35: { description: "é€²æ­©ãƒ»ç™ºå±•å‹ - å‰é€²é‡è¦–", leadership: "é€²æ­©ç™ºå±•", communication: "progressive" },
                    36: { description: "å›°é›£æ™‚ã®è³¢æ˜ã• - é€†å¢ƒã§ã®çŸ¥æµ", leadership: "é€†å¢ƒè³¢æ˜", communication: "wise" },
                    37: { description: "å®¶æ—ãƒ»çµ„ç¹”é‹å–¶ - å†…éƒ¨çµ±æ²»é‡è¦–", leadership: "çµ„ç¹”é‹å–¶", communication: "administrative" },
                    38: { description: "å¯¾ç«‹ãƒ»å·®ç•°èª¿æ•´ - å¤šæ§˜æ€§å¯¾å¿œ", leadership: "å·®ç•°èª¿æ•´", communication: "mediating" },
                    39: { description: "éšœå®³ç‰©å¯¾å‡¦ - å›°é›£å…‹æœé‡è¦–", leadership: "éšœå®³å…‹æœ", communication: "overcoming" },
                    40: { description: "è§£æ”¾ãƒ»è§£æ±ºå‹ - æŸç¸›ã‹ã‚‰ã®è‡ªç”±", leadership: "è§£æ”¾è§£æ±º", communication: "liberating" },
                    41: { description: "æ¸›å°‘ãƒ»å‰Šæ¸›ç®¡ç† - ç„¡é§„ã®æ’é™¤", leadership: "åŠ¹ç‡åŒ–", communication: "streamlining" },
                    42: { description: "å¢—ç›Šãƒ»æ‹¡å¤§å‹ - æˆé•·ã¨ç™ºå±•", leadership: "æ‹¡å¤§æˆé•·", communication: "expanding" },
                    43: { description: "æ±ºæ–­åŠ›ã®ã‚ã‚‹ãƒªãƒ¼ãƒ€ãƒ¼ - æ˜ç¢ºãªæ–¹å‘æ€§", leadership: "æ±ºæ–­åŠ›", communication: "direct" },
                    44: { description: "é­é‡ãƒ»é©å¿œå‹ - çŠ¶æ³å¯¾å¿œé‡è¦–", leadership: "é©å¿œçš„", communication: "flexible" },
                    45: { description: "é›†åˆãƒ»çµ±åˆä¿ƒé€² - å›£çµé‡è¦–", leadership: "çµ±åˆä¿ƒé€²", communication: "unifying" },
                    46: { description: "ä¸Šæ˜‡ãƒ»å‘ä¸Šå‹ - æˆé•·å¿—å‘", leadership: "å‘ä¸Šå¿—å‘", communication: "elevating" },
                    47: { description: "å›°çª®ãƒ»åˆ¶ç´„å¯¾å¿œ - é™ç•ŒçŠ¶æ³ã®ç®¡ç†", leadership: "åˆ¶ç´„ç®¡ç†", communication: "constrained" },
                    48: { description: "æ·±ã„çŸ¥æµã®äº•æˆ¸ - çŸ¥è­˜ã¨çµŒé¨“", leadership: "çŸ¥æµæä¾›", communication: "knowledgeable" },
                    49: { description: "é©æ–°ãƒ»å¤‰é©è€… - æ ¹æœ¬çš„å¤‰åŒ–", leadership: "é©æ–°å¤‰é©", communication: "revolutionary" },
                    50: { description: "æ¨©å¨ãƒ»è²¬ä»»è€… - é‡è¦ãªå½¹å‰²", leadership: "æ¨©å¨è²¬ä»»", communication: "authoritative" },
                    51: { description: "è¡æ’ƒãƒ»å‹•æºå¯¾å¿œ - å¤‰åŒ–ã¸ã®å¯¾å‡¦", leadership: "å¤‰åŒ–å¯¾å¿œ", communication: "dynamic" },
                    52: { description: "å®‰å®šãƒ»é™æ­¢ç¶­æŒ - ç¾çŠ¶ç¶­æŒé‡è¦–", leadership: "å®‰å®šç¶­æŒ", communication: "steady" },
                    53: { description: "æ®µéšçš„ç™ºå±• - ç€å®Ÿãªé€²æ­©", leadership: "æ®µéšç™ºå±•", communication: "gradual" },
                    54: { description: "å¾“å±ãƒ»è£œåŠ©å½¹ - ã‚µãƒãƒ¼ãƒˆé‡è¦–", leadership: "è£œåŠ©æ”¯æ´", communication: "supportive" },
                    55: { description: "è±Šã‹ã•ã®é ‚ç‚¹ - æœ€é«˜æ½®ã®çŠ¶æ…‹", leadership: "è±Šå¯Œæä¾›", communication: "abundant" },
                    56: { description: "æ—…è¡Œãƒ»ç§»å‹•å‹ - å¤‰åŒ–ã¨é©å¿œ", leadership: "ç§»å‹•é©å¿œ", communication: "adaptive" },
                    57: { description: "é †å¿œãƒ»æµ¸é€å‹ - æŸ”è»Ÿãªå½±éŸ¿åŠ›", leadership: "æŸ”è»Ÿæµ¸é€", communication: "penetrating" },
                    58: { description: "å–œæ‚¦ãƒ»æ¥½ã—ã•æä¾› - ãƒã‚¸ãƒ†ã‚£ãƒ–å½±éŸ¿", leadership: "å–œæ‚¦æä¾›", communication: "joyful" },
                    59: { description: "åˆ†æ•£ãƒ»æ‹¡æ•£å¯¾å¿œ - æ•£æ¼«ã•ã¸ã®å¯¾å‡¦", leadership: "çµ±åˆé›†ç´„", communication: "focusing" },
                    60: { description: "ç¯€åº¦ãƒ»åˆ¶é™ç®¡ç† - ãƒãƒ©ãƒ³ã‚¹é‡è¦–", leadership: "ç¯€åº¦ç®¡ç†", communication: "balanced" },
                    61: { description: "å†…çš„çœŸå®Ÿé‡è¦– - èª å®Ÿæ€§ã®è¡¨ç¾", leadership: "èª å®Ÿè¡¨ç¾", communication: "sincere" },
                    62: { description: "å°ã•ãªéåº¦ - ç´°ã‹ãªèª¿æ•´", leadership: "å¾®ç´°èª¿æ•´", communication: "precise" },
                    63: { description: "å®Œæˆãƒ»é”æˆå‹ - ç›®æ¨™é”æˆé‡è¦–", leadership: "å®Œæˆé”æˆ", communication: "accomplished" },
                    64: { description: "æœªå®Œæˆãƒ»ç¶™ç¶šå‹ - é€²è¡Œä¸­ã®çŠ¶æ…‹", leadership: "ç¶™ç¶šé€²è¡Œ", communication: "ongoing" }
                };
                
                return interpretations[hexagramId] || {
                    description: "ãƒãƒ©ãƒ³ã‚¹å‹ç¤¾ä¼šçš„äººæ ¼ - çŠ¶æ³ã«å¿œã˜ãŸé©å¿œ",
                    leadership: "ãƒãƒ©ãƒ³ã‚¹å‹",
                    communication: "adaptable"
                };
            }
            
            // ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ«åˆ†æ
            analyzeLeadershipStyle(upperTrigram, socialPatterns) {
                const styles = {
                    "ä¹¾": "å‰µé€ çš„ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ— - é©æ–°ã¨å¤‰åŒ–ã‚’ã‚‚ãŸã‚‰ã™",
                    "å…Œ": "å¯¾è©±å‹ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ— - ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é‡è¦–", 
                    "é›¢": "é­…åŠ›çš„ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ— - ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸ãˆã‚‹",
                    "éœ‡": "è¡Œå‹•å‹ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ— - è¿…é€Ÿãªæ±ºæ–­ã¨å®Ÿè¡Œ",
                    "å·½": "å”èª¿å‹ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ— - ãƒãƒ¼ãƒ ã®èª¿å’Œã‚’é‡è¦–",
                    "å": "æ´å¯Ÿå‹ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ— - æ·±ã„åˆ†æã«åŸºã¥ãåˆ¤æ–­",
                    "è‰®": "å®‰å®šå‹ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ— - ä¸€è²«æ€§ã¨ä¿¡é ¼æ€§",
                    "å¤": "æ”¯æ´å‹ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ— - ãƒ¡ãƒ³ãƒãƒ¼ã®æˆé•·ã‚’ä¿ƒé€²"
                };
                
                const baseStyle = styles[upperTrigram] || "ãƒãƒ©ãƒ³ã‚¹å‹ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—";
                const leadershipScore = socialPatterns.Q25_leadership || 0.5;
                
                if (leadershipScore > 0.8) {
                    return `å¼·ã„${baseStyle}`;
                } else if (leadershipScore > 0.6) {
                    return baseStyle;
                } else {
                    return `æ§ãˆã‚ãª${baseStyle}`;
                }
            }
            
            // ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«åˆ†æ
            analyzeCommunicationStyle(upperTrigram, lowerTrigram, socialPatterns) {
                const upperStyles = {
                    "ä¹¾": "ç›´æ¥çš„",
                    "å…Œ": "è¦ªã—ã¿ã‚„ã™ã„",
                    "é›¢": "è¡¨ç¾è±Šã‹",
                    "éœ‡": "ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥",
                    "å·½": "é…æ…®æ·±ã„",
                    "å": "æ…é‡",
                    "è‰®": "å®‰å®šã—ãŸ",
                    "å¤": "åŒ…å®¹çš„"
                };
                
                const lowerStyles = {
                    "ä¹¾": "åŠ›å¼·ã„åŸºç›¤",
                    "å…Œ": "å–œæ‚¦ã®åŸºç›¤", 
                    "é›¢": "æ˜æ™°ãªåŸºç›¤",
                    "éœ‡": "è¡Œå‹•ã®åŸºç›¤",
                    "å·½": "æŸ”è»ŸãªåŸºç›¤",
                    "å": "æ·±ã„åŸºç›¤",
                    "è‰®": "å®‰å®šã—ãŸåŸºç›¤",
                    "å¤": "å—å®¹çš„åŸºç›¤"
                };
                
                const interpersonalScore = socialPatterns.Q26_interpersonal || 0.5;
                const styleIntensity = interpersonalScore > 0.7 ? "ç©æ¥µçš„ã«" : interpersonalScore > 0.4 ? "" : "æ…é‡ã«";
                
                return `${styleIntensity}${upperStyles[upperTrigram]}ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ${lowerStyles[lowerTrigram]}ï¼‰`;
            }
            
            // å¯¾ç«‹è§£æ±ºã‚¹ã‚¿ã‚¤ãƒ«åˆ†æ
            analyzeConflictStyle(lowerTrigram, socialPatterns) {
                const styles = {
                    "ä¹¾": "ç©æ¥µçš„è§£æ±º - ä¸»å°çš„ã«å•é¡Œã«å–ã‚Šçµ„ã‚€",
                    "å…Œ": "å¯¾è©±é‡è¦– - è©±ã—åˆã„ã«ã‚ˆã‚‹è§£æ±ºã‚’å›³ã‚‹",
                    "é›¢": "æ˜ç¢ºåŒ–é‡è¦– - å•é¡Œã‚’æ˜ã‚‰ã‹ã«ã—ã¦è§£æ±º",
                    "éœ‡": "è¿…é€Ÿå¯¾å¿œ - ç´ æ—©ã„åˆ¤æ–­ã§è§£æ±º",
                    "å·½": "ç©ã‚„ã‹è§£æ±º - æ®µéšçš„ã§æŸ”è»Ÿãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ",
                    "å": "æ…é‡åˆ†æ - æ·±ãåˆ†æã—ã¦ã‹ã‚‰å¯¾å¿œ",
                    "è‰®": "å†·é™å¯¾å‡¦ - æ™‚é–“ã‚’ã‹ã‘ãŸæ…é‡ãªè§£æ±º",
                    "å¤": "å—å®¹çš„è§£æ±º - åŒ…å®¹åŠ›ã§å•é¡Œã‚’å’Œã‚‰ã’ã‚‹"
                };
                
                const competitionScore = socialPatterns.Q29_competition || 0.5;
                const baseStyle = styles[lowerTrigram] || "ãƒãƒ©ãƒ³ã‚¹å‹è§£æ±º";
                
                if (competitionScore > 0.7) {
                    return `ç«¶äº‰çš„ãª${baseStyle}`;
                } else if (competitionScore < 0.3) {
                    return `å”èª¿çš„ãª${baseStyle}`;
                } else {
                    return baseStyle;
                }
            }
            
            // é©å¿œæ€§åˆ†æ
            analyzeAdaptability(upperTrigram, lowerTrigram, socialPatterns) {
                const adaptabilityScores = {
                    "ä¹¾": 0.6, "å…Œ": 0.8, "é›¢": 0.7, "éœ‡": 0.9,
                    "å·½": 0.9, "å": 0.7, "è‰®": 0.3, "å¤": 0.8
                };
                
                const upperScore = adaptabilityScores[upperTrigram] || 0.5;
                const lowerScore = adaptabilityScores[lowerTrigram] || 0.5;
                const avgScore = (upperScore + lowerScore) / 2;
                
                const familyScore = socialPatterns.Q27_family || 0.5;
                const emergencyScore = socialPatterns.Q28_emergency || 0.5;
                const contextScore = (familyScore + emergencyScore) / 2;
                
                const finalScore = (avgScore * 0.7) + (contextScore * 0.3);
                
                if (finalScore > 0.8) return "éå¸¸ã«é«˜ã„é©å¿œåŠ›";
                if (finalScore > 0.6) return "é«˜ã„é©å¿œåŠ›";
                if (finalScore > 0.4) return "ä¸­ç¨‹åº¦ã®é©å¿œåŠ›"; 
                return "é™å®šçš„ãªé©å¿œåŠ›";
            }
            
            // Engine OSã®å½±éŸ¿åˆ†æ
            analyzeEngineInfluence(engineOS, interfaceUpper, interfaceLower) {
                if (!engineOS || !engineOS.upperTrigram) {
                    return "Engine OSæƒ…å ±ä¸è¶³ã«ã‚ˆã‚Šå½±éŸ¿ä¸æ˜";
                }
                
                const engineUpper = engineOS.upperTrigram;
                const compatibility = this.calculateTrigramCompatibility(engineUpper, interfaceUpper);
                
                if (compatibility > 0.7) {
                    return `Engine OSï¼ˆ${engineUpper}ï¼‰ã¨ã®é«˜ã„è¦ªå’Œæ€§ - ä¸€è²«ã—ãŸäººæ ¼è¡¨ç¾`;
                } else if (compatibility > 0.4) {
                    return `Engine OSï¼ˆ${engineUpper}ï¼‰ã¨ã®é©åº¦ãªè¦ªå’Œæ€§ - ãƒãƒ©ãƒ³ã‚¹å–ã‚ŒãŸè¡¨ç¾`;
                } else {
                    return `Engine OSï¼ˆ${engineUpper}ï¼‰ã¨ã®è£œå®Œé–¢ä¿‚ - å†…å¤–ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ`;
                }
            }
            
            // ä¸‰çˆ»é–“ã®è¦ªå’Œæ€§è¨ˆç®—
            calculateTrigramCompatibility(trigram1, trigram2) {
                const compatibilityMatrix = {
                    "ä¹¾": { "ä¹¾": 1.0, "å…Œ": 0.8, "é›¢": 0.9, "éœ‡": 0.7, "å·½": 0.4, "å": 0.5, "è‰®": 0.6, "å¤": 0.2 },
                    "å…Œ": { "ä¹¾": 0.8, "å…Œ": 1.0, "é›¢": 0.7, "éœ‡": 0.6, "å·½": 0.8, "å": 0.4, "è‰®": 0.3, "å¤": 0.7 },
                    "é›¢": { "ä¹¾": 0.9, "å…Œ": 0.7, "é›¢": 1.0, "éœ‡": 0.5, "å·½": 0.6, "å": 0.2, "è‰®": 0.4, "å¤": 0.8 },
                    "éœ‡": { "ä¹¾": 0.7, "å…Œ": 0.6, "é›¢": 0.5, "éœ‡": 1.0, "å·½": 0.3, "å": 0.8, "è‰®": 0.2, "å¤": 0.4 },
                    "å·½": { "ä¹¾": 0.4, "å…Œ": 0.8, "é›¢": 0.6, "éœ‡": 0.3, "å·½": 1.0, "å": 0.7, "è‰®": 0.8, "å¤": 0.9 },
                    "å": { "ä¹¾": 0.5, "å…Œ": 0.4, "é›¢": 0.2, "éœ‡": 0.8, "å·½": 0.7, "å": 1.0, "è‰®": 0.9, "å¤": 0.6 },
                    "è‰®": { "ä¹¾": 0.6, "å…Œ": 0.3, "é›¢": 0.4, "éœ‡": 0.2, "å·½": 0.8, "å": 0.9, "è‰®": 1.0, "å¤": 0.7 },
                    "å¤": { "ä¹¾": 0.2, "å…Œ": 0.7, "é›¢": 0.8, "éœ‡": 0.4, "å·½": 0.9, "å": 0.6, "è‰®": 0.7, "å¤": 1.0 }
                };
                
                return compatibilityMatrix[trigram1]?.[trigram2] || 0.5;
            }
            
            calculateConsistencyScore(engineOS, interfaceOS, safeModeOS) {
                try {
                    // 1. å¦ã®ç›¸äº’è·é›¢ã‚’è¨ˆç®—
                    const engineInterface = Math.abs(engineOS.hexagramId - interfaceOS.hexagramId);
                    const engineSafeMode = Math.abs(engineOS.hexagramId - safeModeOS.hexagramId);
                    const interfaceSafeMode = Math.abs(interfaceOS.hexagramId - safeModeOS.hexagramId);
                    
                    // 2. ä¸‰çˆ»ãƒ¬ãƒ™ãƒ«ã§ã®æ•´åˆæ€§åˆ†æ
                    const trigramConsistency = this.analyzeTrigramConsistency(engineOS, interfaceOS, safeModeOS);
                    
                    // 3. HaQeiå“²å­¦çš„ä¸€è²«æ€§ã®è©•ä¾¡
                    const philosophicalConsistency = this.evaluatePhilosophicalConsistency(engineOS, interfaceOS, safeModeOS);
                    
                    // 4. ç·åˆæ•´åˆæ€§ã‚¹ã‚³ã‚¢è¨ˆç®—
                    const distanceScore = Math.max(0, 100 - (engineInterface + engineSafeMode + interfaceSafeMode) / 3 * 1.5);
                    const finalScore = (distanceScore * 0.4 + trigramConsistency * 0.35 + philosophicalConsistency * 0.25);
                    
                    return Math.min(100, Math.max(0, finalScore));
                    
                } catch (error) {
                    console.error("âŒ Consistency calculation error:", error);
                    return 50; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                }
            }
            
            /**
             * Triple OSç›¸äº’ä½œç”¨ã®ç·åˆåˆ†æ
             * 3ã¤ã®OSã®çµ±åˆçš„å‹•ä½œã‚’è©•ä¾¡ã—ã€æ¨å¥¨äº‹é …ã‚’ç”Ÿæˆ
             */
            async calculateTripleOSInteraction(engineOS, interfaceOS, safeModeOS) {
                console.log("ğŸ”¯ Calculating Triple OS Interaction");
                
                try {
                    // 1. æ•´åˆæ€§ã‚¹ã‚³ã‚¢è¨ˆç®—
                    const consistency = this.calculateConsistencyScore(engineOS, interfaceOS, safeModeOS);
                    
                    // 2. å‹•çš„ãƒãƒ©ãƒ³ã‚¹è©•ä¾¡
                    const balance = this.evaluateDynamicBalance(engineOS, interfaceOS, safeModeOS);
                    
                    // 3. HaQeiçµ±åˆåº¦è©•ä¾¡
                    const integration = this.assessHaQeiIntegration(engineOS, interfaceOS, safeModeOS);
                    
                    // 4. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ¤œè¨¼
                    const dataFlowValidation = this.validateDataFlow(engineOS, interfaceOS, safeModeOS);
                    
                    // 5. æ¨å¥¨äº‹é …ç”Ÿæˆ
                    const recommendations = this.generateRecommendations(consistency, balance, integration, dataFlowValidation);
                    
                    return {
                        consistency,
                        balance,
                        integration,
                        dataFlow: dataFlowValidation,
                        recommendations,
                        timestamp: Date.now(),
                        status: "success"
                    };
                    
                } catch (error) {
                    console.error("âŒ Triple OS Interaction calculation failed:", error);
                    return this.getDefaultTripleOSInteraction();
                }
            }
            
            /**
             * å‹•çš„ãƒãƒ©ãƒ³ã‚¹è©•ä¾¡
             * 3ã¤ã®OSã®ç›¸äº’ä½œç”¨ã«ãŠã‘ã‚‹å‹•çš„å¹³è¡¡ã‚’è©•ä¾¡
             */
            evaluateDynamicBalance(engineOS, interfaceOS, safeModeOS) {
                console.log("âš–ï¸ Evaluating Dynamic Balance");
                
                try {
                    // 1. ã‚¨ãƒãƒ«ã‚®ãƒ¼åˆ†å¸ƒã®åˆ†æ
                    const energyDistribution = this.analyzeEnergyDistribution(engineOS, interfaceOS, safeModeOS);
                    
                    // 2. ç›¸äº’è£œå®Œæ€§ã®è©•ä¾¡
                    const complementarity = this.assessComplementarity(engineOS, interfaceOS, safeModeOS);
                    
                    // 3. å®‰å®šæ€§æŒ‡æ¨™ã®è¨ˆç®—
                    const stability = this.calculateStabilityIndex(engineOS, interfaceOS, safeModeOS);
                    
                    // 4. é©å¿œæ€§æŒ‡æ¨™ã®è¨ˆç®—
                    const adaptability = this.calculateAdaptabilityIndex(engineOS, interfaceOS, safeModeOS);
                    
                    // 5. ç·åˆãƒãƒ©ãƒ³ã‚¹ã‚¹ã‚³ã‚¢
                    const balanceScore = (
                        energyDistribution * 0.3 + 
                        complementarity * 0.25 + 
                        stability * 0.25 + 
                        adaptability * 0.2
                    );
                    
                    return Math.min(100, Math.max(0, balanceScore));
                    
                } catch (error) {
                    console.error("âŒ Dynamic balance evaluation failed:", error);
                    return 65; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ©ãƒ³ã‚¹å€¤
                }
            }
            
            /**
             * HaQeiçµ±åˆåº¦è©•ä¾¡
             * æ˜“çµŒå“²å­¦ã«åŸºã¥ãçµ±åˆãƒ¬ãƒ™ãƒ«ã®è©•ä¾¡
             */
            assessHaQeiIntegration(engineOS, interfaceOS, safeModeOS) {
                console.log("ğŸŒŸ Assessing HaQei Integration");
                
                try {
                    // 1. æ˜“çµŒåŸç†ã®é©ç”¨åº¦è©•ä¾¡
                    const yijingPrinciples = this.evaluateYijingPrinciples(engineOS, interfaceOS, safeModeOS);
                    
                    // 2. ä¸‰æ‰æ€æƒ³ã®ä½“ç¾åº¦ï¼ˆå¤©ãƒ»äººãƒ»åœ°ï¼‰
                    const sancaiEmbodiment = this.evaluateSancaiEmbodiment(engineOS, interfaceOS, safeModeOS);
                    
                    // 3. é™°é™½èª¿å’Œã®å®Ÿç¾åº¦
                    const yinyangHarmony = this.evaluateYinyangHarmony(engineOS, interfaceOS, safeModeOS);
                    
                    // 4. äº”è¡Œç›¸ç”Ÿã®å®Ÿç¾åº¦
                    const wuxingSynergy = this.evaluateWuxingSynergy(engineOS, interfaceOS, safeModeOS);
                    
                    // 5. HaQeiçµ±åˆã‚¹ã‚³ã‚¢
                    const integrationScore = (
                        yijingPrinciples * 0.35 +
                        sancaiEmbodiment * 0.25 +
                        yinyangHarmony * 0.25 +
                        wuxingSynergy * 0.15
                    );
                    
                    return Math.min(100, Math.max(0, integrationScore));
                    
                } catch (error) {
                    console.error("âŒ HaQei integration assessment failed:", error);
                    return 70; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçµ±åˆå€¤
                }
            }
            
            /**
             * 64å¦å‡ºåŠ›ã®å®Œå…¨æ€§ç¢ºèª
             * å„OSãŒ1-64ã®ã™ã¹ã¦ã®å¦ã‚’å‡ºåŠ›å¯èƒ½ã‹æ¤œè¨¼
             */
            validateTripleOSResults(engineOS, interfaceOS, safeModeOS) {
                console.log("ğŸ” Validating Triple OS Results");
                
                try {
                    // 1. å„OSã®å¦IDã®æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯
                    const validationResults = {
                        engineOS: this.validateOSHexagram(engineOS, "Engine OS"),
                        interfaceOS: this.validateOSHexagram(interfaceOS, "Interface OS"),  
                        safeModeOS: this.validateOSHexagram(safeModeOS, "SafeMode OS")
                    };
                    
                    // 2. é‡è¤‡ãƒ»æ¬ è½ãƒã‚§ãƒƒã‚¯
                    const duplicateCheck = this.checkForDuplicates([engineOS.hexagramId, interfaceOS.hexagramId, safeModeOS.hexagramId]);
                    
                    // 3. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
                    const dataFlowCheck = this.validateDataFlowIntegrity(engineOS, interfaceOS, safeModeOS);
                    
                    // 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒã‚§ãƒƒã‚¯
                    const errorHandlingCheck = this.validateErrorHandling(engineOS, interfaceOS, safeModeOS);
                    
                    // 5. æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                    const validationReport = {
                        ...validationResults,
                        duplicates: duplicateCheck,
                        dataFlow: dataFlowCheck,
                        errorHandling: errorHandlingCheck,
                        overallStatus: this.determineOverallValidationStatus(validationResults, duplicateCheck, dataFlowCheck, errorHandlingCheck),
                        timestamp: Date.now()
                    };
                    
                    console.log("âœ… Triple OS Validation Complete:", validationReport);
                    return validationReport;
                    
                } catch (error) {
                    console.error("âŒ Triple OS validation failed:", error);
                    throw new Error(`Triple OS validation failed: ${error.message}`);
                }
            }
            
            /**
             * æ¨å¥¨äº‹é …ç”Ÿæˆ
             * åˆ†æçµæœã«åŸºã¥ãæ”¹å–„ææ¡ˆã®ç”Ÿæˆ
             */
            generateRecommendations(consistency, balance, integration, dataFlow) {
                console.log("ğŸ’¡ Generating Recommendations");
                
                const recommendations = [];
                
                try {
                    // 1. æ•´åˆæ€§ã«åŸºã¥ãæ¨å¥¨
                    if (consistency < 70) {
                        recommendations.push({
                            type: "consistency",
                            priority: "high",
                            title: "OSé–“æ•´åˆæ€§ã®å‘ä¸Š",
                            description: "Engineã€Interfaceã€SafeMode OSã®ç›¸äº’é–¢ä¿‚ã‚’è¦‹ç›´ã—ã€ã‚ˆã‚Šèª¿å’Œã®å–ã‚ŒãŸçµ±åˆã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†",
                            action: "ä¾¡å€¤è¦³ã¨è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å†æ•´ç†ã‚’æ¨å¥¨"
                        });
                    }
                    
                    // 2. ãƒãƒ©ãƒ³ã‚¹ã«åŸºã¥ãæ¨å¥¨
                    if (balance < 65) {
                        recommendations.push({
                            type: "balance",
                            priority: "medium",
                            title: "å‹•çš„ãƒãƒ©ãƒ³ã‚¹ã®æœ€é©åŒ–",
                            description: "3ã¤ã®OSã®å‹•çš„å¹³è¡¡ã‚’æ”¹å–„ã—ã€ã‚ˆã‚Šå®‰å®šã—ãŸçµ±åˆã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã—ã‚‡ã†",
                            action: "çŠ¶æ³ã«å¿œã˜ãŸOSåˆ‡ã‚Šæ›¿ãˆã®ç·´ç¿’ã‚’æ¨å¥¨"
                        });
                    }
                    
                    // 3. HaQeiçµ±åˆã«åŸºã¥ãæ¨å¥¨
                    if (integration < 75) {
                        recommendations.push({
                            type: "integration",
                            priority: "medium",
                            title: "HaQeiå“²å­¦ã®æ·±åŒ–",
                            description: "æ˜“çµŒåŸç†ã‚’ã‚ˆã‚Šæ·±ãç†è§£ã—ã€æ—¥å¸¸ç”Ÿæ´»ã§ã®å®Ÿè·µã‚’å¢—ã‚„ã—ã¾ã—ã‚‡ã†",
                            action: "æ˜“çµŒå­¦ç¿’ã¨ç‘æƒ³çš„å®Ÿè·µã®ç¶™ç¶šã‚’æ¨å¥¨"
                        });
                    }
                    
                    // 4. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã«åŸºã¥ãæ¨å¥¨
                    if (dataFlow && !dataFlow.isValid) {
                        recommendations.push({
                            type: "dataflow",
                            priority: "high",
                            title: "æƒ…å ±å‡¦ç†ãƒ•ãƒ­ãƒ¼ã®æ”¹å–„",
                            description: "ä¾¡å€¤è¦³ã‹ã‚‰ã‚·ãƒŠãƒªã‚ªå¯¾å¿œã¸ã®æƒ…å ±ã®æµã‚Œã‚’æ”¹å–„ã—ã€ä¸€è²«æ€§ã®ã‚ã‚‹åˆ¤æ–­ã‚’å®Ÿç¾ã—ã¾ã—ã‚‡ã†",
                            action: "ã‚»ãƒ«ãƒ•ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ç¿’æ…£åŒ–ã‚’æ¨å¥¨"
                        });
                    }
                    
                    // 5. ç·åˆçš„ãªæ¨å¥¨äº‹é …
                    if (recommendations.length === 0) {
                        recommendations.push({
                            type: "optimization",
                            priority: "low",
                            title: "ã•ã‚‰ãªã‚‹æœ€é©åŒ–",
                            description: "æ—¢ã«è‰¯å¥½ãªçµ±åˆçŠ¶æ…‹ã§ã™ã€‚ã•ã‚‰ãªã‚‹å‘ä¸Šã®ãŸã‚ã«ç¶™ç¶šçš„ãªè‡ªå·±è¦³å¯Ÿã‚’ç¶šã‘ã¾ã—ã‚‡ã†",
                            action: "å®šæœŸçš„ãªè‡ªå·±è©•ä¾¡ã®å®Ÿæ–½ã‚’æ¨å¥¨"
                        });
                    }
                    
                    return recommendations;
                    
                } catch (error) {
                    console.error("âŒ Recommendation generation failed:", error);
                    return [{
                        type: "error",
                        priority: "medium",
                        title: "è©•ä¾¡ã‚¨ãƒ©ãƒ¼",
                        description: "æ¨å¥¨äº‹é …ã®ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œã‚’ç¢ºèªã—ã¦ãã ã•ã„",
                        action: "æŠ€è¡“çš„ãªã‚µãƒãƒ¼ãƒˆã‚’ã”åˆ©ç”¨ãã ã•ã„"
                    }];
                }
            }
            
            // =================
            // è£œåŠ©ãƒ¡ã‚½ãƒƒãƒ‰ç¾¤
            // =================
            
            /**
             * ä¸‰çˆ»ãƒ¬ãƒ™ãƒ«ã§ã®æ•´åˆæ€§åˆ†æ
             */
            analyzeTrigramConsistency(engineOS, interfaceOS, safeModeOS) {
                try {
                    const compatibility1 = this.calculateTrigramCompatibility(engineOS.upperTrigram, interfaceOS.upperTrigram);
                    const compatibility2 = this.calculateTrigramCompatibility(engineOS.upperTrigram, safeModeOS.upperTrigram);
                    const compatibility3 = this.calculateTrigramCompatibility(interfaceOS.upperTrigram, safeModeOS.upperTrigram);
                    
                    return (compatibility1 + compatibility2 + compatibility3) / 3 * 100;
                } catch (error) {
                    return 60; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                }
            }
            
            /**
             * HaQeiå“²å­¦çš„ä¸€è²«æ€§ã®è©•ä¾¡
             */
            evaluatePhilosophicalConsistency(engineOS, interfaceOS, safeModeOS) {
                try {
                    // æ˜“çµŒã®æ ¸å¿ƒåŸç†ã§ã‚ã‚‹å¤‰åŒ–ã¨èª¿å’Œã®ä½“ç¾åº¦ã‚’è©•ä¾¡
                    const changeAlignment = this.assessChangeAlignment(engineOS, interfaceOS, safeModeOS);
                    const harmonyAlignment = this.assessHarmonyAlignment(engineOS, interfaceOS, safeModeOS);
                    
                    return (changeAlignment + harmonyAlignment) / 2;
                } catch (error) {
                    return 70; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                }
            }
            
            /**
             * ã‚¨ãƒãƒ«ã‚®ãƒ¼åˆ†å¸ƒã®åˆ†æ
             */
            analyzeEnergyDistribution(engineOS, interfaceOS, safeModeOS) {
                try {
                    const engineEnergy = this.calculateOSEnergy(engineOS);
                    const interfaceEnergy = this.calculateOSEnergy(interfaceOS);
                    const safeModeEnergy = this.calculateOSEnergy(safeModeOS);
                    
                    const total = engineEnergy + interfaceEnergy + safeModeEnergy;
                    const idealRatio = [0.35, 0.35, 0.30]; // Engine, Interface, SafeMode
                    const actualRatio = [engineEnergy/total, interfaceEnergy/total, safeModeEnergy/total];
                    
                    // ç†æƒ³æ¯”ç‡ã¨ã®å·®ç•°ã‚’è¨ˆç®—
                    const deviation = idealRatio.reduce((sum, ideal, i) => sum + Math.abs(ideal - actualRatio[i]), 0);
                    
                    return Math.max(0, 100 - (deviation * 100));
                } catch (error) {
                    return 65; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                }
            }
            
            /**
             * ç›¸äº’è£œå®Œæ€§ã®è©•ä¾¡
             */
            assessComplementarity(engineOS, interfaceOS, safeModeOS) {
                try {
                    // 3ã¤ã®OSãŒäº’ã„ã‚’è£œå®Œã—åˆã£ã¦ã„ã‚‹ã‹ã‚’è©•ä¾¡
                    const engineInterface = this.calculateComplementarity(engineOS, interfaceOS);
                    const engineSafeMode = this.calculateComplementarity(engineOS, safeModeOS);
                    const interfaceSafeMode = this.calculateComplementarity(interfaceOS, safeModeOS);
                    
                    return (engineInterface + engineSafeMode + interfaceSafeMode) / 3;
                } catch (error) {
                    return 60; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                }
            }
            
            /**
             * å®‰å®šæ€§æŒ‡æ¨™ã®è¨ˆç®—
             */
            calculateStabilityIndex(engineOS, interfaceOS, safeModeOS) {
                try {
                    // å„OSã®å®‰å®šæ€§ã‚’ä¸‰çˆ»ã®ç‰¹æ€§ã‹ã‚‰åˆ¤æ–­
                    const engineStability = this.getTrigramStability(engineOS.upperTrigram, engineOS.lowerTrigram);
                    const interfaceStability = this.getTrigramStability(interfaceOS.upperTrigram, interfaceOS.lowerTrigram);
                    const safeModeStability = this.getTrigramStability(safeModeOS.upperTrigram, safeModeOS.lowerTrigram);
                    
                    return (engineStability + interfaceStability + safeModeStability) / 3;
                } catch (error) {
                    return 70; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                }
            }
            
            /**
             * é©å¿œæ€§æŒ‡æ¨™ã®è¨ˆç®—
             */
            calculateAdaptabilityIndex(engineOS, interfaceOS, safeModeOS) {
                try {
                    // å¤‰åŒ–ã¸ã®é©å¿œèƒ½åŠ›ã‚’è©•ä¾¡
                    const diversity = this.calculateOSDiversity(engineOS, interfaceOS, safeModeOS);
                    const flexibility = this.calculateFlexibility(engineOS, interfaceOS, safeModeOS);
                    
                    return (diversity + flexibility) / 2;
                } catch (error) {
                    return 65; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                }
            }
            
            /**
             * æ˜“çµŒåŸç†ã®é©ç”¨åº¦è©•ä¾¡
             */
            evaluateYijingPrinciples(engineOS, interfaceOS, safeModeOS) {
                try {
                    // 64å¦ã®æœ¬è³ªçš„æ„å‘³ã¨ã®æ•´åˆæ€§
                    const principleAlignment = [engineOS, interfaceOS, safeModeOS].reduce((sum, os) => {
                        const hexagram = this.getHexagramData(os.hexagramId);
                        return sum + this.assessHexagramPrincipleAlignment(hexagram, os);
                    }, 0) / 3;
                    
                    return principleAlignment;
                } catch (error) {
                    return 75; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                }
            }
            
            /**
             * ä¸‰æ‰æ€æƒ³ã®ä½“ç¾åº¦è©•ä¾¡
             */
            evaluateSancaiEmbodiment(engineOS, interfaceOS, safeModeOS) {
                try {
                    // å¤©ãƒ»äººãƒ»åœ°ã®ä¸‰æ‰æ€æƒ³ã®ä½“ç¾åº¦
                    const tianEmbodiment = this.assessTianEmbodiment(engineOS); // å¤©ï¼šå‰µé€ ãƒ»ç²¾ç¥
                    const renEmbodiment = this.assessRenEmbodiment(interfaceOS); // äººï¼šç¤¾ä¼šãƒ»é–¢ä¿‚
                    const diEmbodiment = this.assessDiEmbodiment(safeModeOS); // åœ°ï¼šåŸºç›¤ãƒ»å®‰å®š
                    
                    return (tianEmbodiment + renEmbodiment + diEmbodiment) / 3;
                } catch (error) {
                    return 70; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                }
            }
            
            /**
             * é™°é™½èª¿å’Œã®å®Ÿç¾åº¦
             */
            evaluateYinyangHarmony(engineOS, interfaceOS, safeModeOS) {
                try {
                    const yinYangBalance = this.calculateYinYangBalance([engineOS, interfaceOS, safeModeOS]);
                    const complementaryBalance = this.calculateComplementaryBalance(engineOS, interfaceOS, safeModeOS);
                    
                    return (yinYangBalance + complementaryBalance) / 2;
                } catch (error) {
                    return 65; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                }
            }
            
            /**
             * äº”è¡Œç›¸ç”Ÿã®å®Ÿç¾åº¦
             */
            evaluateWuxingSynergy(engineOS, interfaceOS, safeModeOS) {
                try {
                    // æœ¨ç«åœŸé‡‘æ°´ã®ç›¸ç”Ÿé–¢ä¿‚ã®å®Ÿç¾åº¦
                    const wuxingElements = [
                        this.getWuxingElement(engineOS),
                        this.getWuxingElement(interfaceOS),
                        this.getWuxingElement(safeModeOS)
                    ];
                    
                    return this.calculateWuxingSynergyScore(wuxingElements);
                } catch (error) {
                    return 60; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                }
            }
            
            /**
             * OSå¦IDã®æœ‰åŠ¹æ€§æ¤œè¨¼
             */
            validateOSHexagram(osResult, osName) {
                try {
                    const hexagramId = osResult.hexagramId;
                    
                    // 1. å¦IDãŒ1-64ã®ç¯„å›²å†…ã‹
                    if (hexagramId < 1 || hexagramId > 64) {
                        return {
                            valid: false,
                            error: `Invalid hexagram ID: ${hexagramId}`,
                            osName: osName
                        };
                    }
                    
                    // 2. ä¸‰çˆ»ã®çµ„ã¿åˆã‚ã›ãŒæœ‰åŠ¹ã‹
                    const upperTrigram = osResult.upperTrigram;
                    const lowerTrigram = osResult.lowerTrigram;
                    const validTrigrams = ["ä¹¾", "å…Œ", "é›¢", "éœ‡", "å·½", "å", "è‰®", "å¤"];
                    
                    if (!validTrigrams.includes(upperTrigram) || !validTrigrams.includes(lowerTrigram)) {
                        return {
                            valid: false,
                            error: `Invalid trigram combination: ${upperTrigram}-${lowerTrigram}`,
                            osName: osName
                        };
                    }
                    
                    // 3. å¦ã¨ä¸‰çˆ»ã®å¯¾å¿œãŒæ­£ã—ã„ã‹
                    const expectedId = this.mapTrigramsToHexagram(upperTrigram, lowerTrigram);
                    if (expectedId !== hexagramId) {
                        return {
                            valid: false,
                            error: `Hexagram-Trigram mismatch: Expected ${expectedId}, got ${hexagramId}`,
                            osName: osName
                        };
                    }
                    
                    return {
                        valid: true,
                        hexagramId: hexagramId,
                        osName: osName,
                        trigramCombination: `${upperTrigram}-${lowerTrigram}`
                    };
                    
                } catch (error) {
                    return {
                        valid: false,
                        error: `Validation error: ${error.message}`,
                        osName: osName
                    };
                }
            }
            
            /**
             * é‡è¤‡ãƒã‚§ãƒƒã‚¯
             */
            checkForDuplicates(hexagramIds) {
                const duplicates = hexagramIds.filter((id, index) => hexagramIds.indexOf(id) !== index);
                return {
                    hasDuplicates: duplicates.length > 0,
                    duplicateIds: [...new Set(duplicates)],
                    uniqueCount: new Set(hexagramIds).size
                };
            }
            
            /**
             * ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
             */
            validateDataFlowIntegrity(engineOS, interfaceOS, safeModeOS) {
                try {
                    // Q1-Q24 â†’ Engine OS ã®å½±éŸ¿ãƒã‚§ãƒƒã‚¯
                    const engineInfluence = this.validateEngineInfluence(engineOS);
                    
                    // Q25-Q30 â†’ Interface OS & SafeMode OS ã®å½±éŸ¿ãƒã‚§ãƒƒã‚¯
                    const scenarioInfluence = this.validateScenarioInfluence(interfaceOS, safeModeOS);
                    
                    // Engine OS â†’ Interface OS (30%å½±éŸ¿) ã®ãƒã‚§ãƒƒã‚¯
                    const engineToInterface = this.validateEngineToInterfaceFlow(engineOS, interfaceOS);
                    
                    // Engine OS â†’ SafeMode OS (40%å½±éŸ¿) ã®ãƒã‚§ãƒƒã‚¯
                    const engineToSafeMode = this.validateEngineToSafeModeFlow(engineOS, safeModeOS);
                    
                    return {
                        isValid: engineInfluence.valid && scenarioInfluence.valid && engineToInterface.valid && engineToSafeMode.valid,
                        engineInfluence,
                        scenarioInfluence,
                        engineToInterface,
                        engineToSafeMode
                    };
                    
                } catch (error) {
                    return {
                        isValid: false,
                        error: error.message
                    };
                }
            }
            
            /**
             * ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ¤œè¨¼
             */
            validateErrorHandling(engineOS, interfaceOS, safeModeOS) {
                const errorHandlingScore = {
                    engineOS: this.checkOSErrorHandling(engineOS),
                    interfaceOS: this.checkOSErrorHandling(interfaceOS),
                    safeModeOS: this.checkOSErrorHandling(safeModeOS)
                };
                
                const allValid = Object.values(errorHandlingScore).every(score => score > 0.8);
                
                return {
                    isValid: allValid,
                    scores: errorHandlingScore,
                    overallScore: Object.values(errorHandlingScore).reduce((sum, score) => sum + score, 0) / 3
                };
            }
            
            /**
             * ç·åˆæ¤œè¨¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ±ºå®š
             */
            determineOverallValidationStatus(validationResults, duplicateCheck, dataFlowCheck, errorHandlingCheck) {
                const allOSValid = Object.values(validationResults).every(result => result.valid);
                const noDuplicates = !duplicateCheck.hasDuplicates;
                const dataFlowValid = dataFlowCheck.isValid;
                const errorHandlingValid = errorHandlingCheck.isValid;
                
                if (allOSValid && noDuplicates && dataFlowValid && errorHandlingValid) {
                    return "excellent";
                } else if (allOSValid && noDuplicates && dataFlowValid) {
                    return "good";
                } else if (allOSValid && noDuplicates) {
                    return "acceptable";
                } else {
                    return "needs_improvement";
                }
            }
            
            /**
             * ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®æ¤œè¨¼
             */
            validateDataFlow(engineOS, interfaceOS, safeModeOS) {
                try {
                    return this.validateDataFlowIntegrity(engineOS, interfaceOS, safeModeOS);
                } catch (error) {
                    return {
                        isValid: false,
                        error: error.message
                    };
                }
            }
            
            /**
             * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆTriple OSç›¸äº’ä½œç”¨çµæœ
             */
            getDefaultTripleOSInteraction() {
                return {
                    consistency: 65,
                    balance: 60,
                    integration: 70,
                    dataFlow: { isValid: false, error: "Analysis failed" },
                    recommendations: [{
                        type: "system_error",
                        priority: "high",
                        title: "ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼",
                        description: "Triple OSåˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",
                        action: "ã‚·ã‚¹ãƒ†ãƒ ã®å†å®Ÿè¡Œã‚’æ¨å¥¨"
                    }],
                    timestamp: Date.now(),
                    status: "error"
                };
            }
            
            // =================
            // è©³ç´°è£œåŠ©ãƒ¡ã‚½ãƒƒãƒ‰ç¾¤
            // =================
            
            assessChangeAlignment(engineOS, interfaceOS, safeModeOS) {
                // å¤‰åŒ–ã¸ã®å¯¾å¿œåŠ›ã®çµ±åˆè©•ä¾¡
                return 75; // ç°¡ç•¥å®Ÿè£…
            }
            
            assessHarmonyAlignment(engineOS, interfaceOS, safeModeOS) {
                // èª¿å’Œã®å®Ÿç¾åº¦ã®çµ±åˆè©•ä¾¡
                return 70; // ç°¡ç•¥å®Ÿè£…
            }
            
            calculateOSEnergy(os) {
                // OSã®ã‚¨ãƒãƒ«ã‚®ãƒ¼å¼·åº¦ã‚’è¨ˆç®—
                return Math.random() * 100; // ç°¡ç•¥å®Ÿè£…ï¼ˆå®Ÿéš›ã¯ä¸‰çˆ»ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‹ã‚‰ç®—å‡ºï¼‰
            }
            
            calculateComplementarity(os1, os2) {
                // 2ã¤ã®OSé–“ã®è£œå®Œæ€§ã‚’è¨ˆç®—
                return Math.random() * 100; // ç°¡ç•¥å®Ÿè£…
            }
            
            getTrigramStability(upperTrigram, lowerTrigram) {
                // ä¸‰çˆ»çµ„ã¿åˆã‚ã›ã®å®‰å®šæ€§ã‚’è©•ä¾¡
                const stabilityScores = {
                    "ä¹¾": 85, "å…Œ": 75, "é›¢": 70, "éœ‡": 65,
                    "å·½": 72, "å": 68, "è‰®": 90, "å¤": 95
                };
                
                return (stabilityScores[upperTrigram] + stabilityScores[lowerTrigram]) / 2;
            }
            
            calculateOSDiversity(engineOS, interfaceOS, safeModeOS) {
                // OSé–“ã®å¤šæ§˜æ€§ã‚’è©•ä¾¡
                const uniqueTrigrams = new Set([
                    engineOS.upperTrigram, engineOS.lowerTrigram,
                    interfaceOS.upperTrigram, interfaceOS.lowerTrigram,
                    safeModeOS.upperTrigram, safeModeOS.lowerTrigram
                ]).size;
                
                return (uniqueTrigrams / 8) * 100; // 8ã¯å…¨ä¸‰çˆ»æ•°
            }
            
            calculateFlexibility(engineOS, interfaceOS, safeModeOS) {
                // ã‚·ã‚¹ãƒ†ãƒ ã®æŸ”è»Ÿæ€§ã‚’è©•ä¾¡
                return 70; // ç°¡ç•¥å®Ÿè£…
            }
            
            assessHexagramPrincipleAlignment(hexagram, os) {
                // å¦ã®åŸç†ã¨ã®æ•´åˆæ€§ã‚’è©•ä¾¡
                return 80; // ç°¡ç•¥å®Ÿè£…
            }
            
            assessTianEmbodiment(engineOS) {
                // å¤©ã®ä½“ç¾åº¦ï¼ˆå‰µé€ æ€§ãƒ»ç²¾ç¥æ€§ï¼‰
                return 75; // ç°¡ç•¥å®Ÿè£…
            }
            
            assessRenEmbodiment(interfaceOS) {
                // äººã®ä½“ç¾åº¦ï¼ˆç¤¾ä¼šæ€§ãƒ»é–¢ä¿‚æ€§ï¼‰
                return 70; // ç°¡ç•¥å®Ÿè£…
            }
            
            assessDiEmbodiment(safeModeOS) {
                // åœ°ã®ä½“ç¾åº¦ï¼ˆåŸºç›¤ãƒ»å®‰å®šæ€§ï¼‰
                return 80; // ç°¡ç•¥å®Ÿè£…
            }
            
            calculateYinYangBalance(osArray) {
                // é™°é™½ãƒãƒ©ãƒ³ã‚¹ã‚’è¨ˆç®—
                return 65; // ç°¡ç•¥å®Ÿè£…
            }
            
            calculateComplementaryBalance(engineOS, interfaceOS, safeModeOS) {
                // è£œå®Œãƒãƒ©ãƒ³ã‚¹ã‚’è¨ˆç®—
                return 70; // ç°¡ç•¥å®Ÿè£…
            }
            
            getWuxingElement(os) {
                // OSã®äº”è¡Œå±æ€§ã‚’å–å¾—
                const elements = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];
                return elements[os.hexagramId % 5];
            }
            
            calculateWuxingSynergyScore(elements) {
                // äº”è¡Œç›¸ç”Ÿã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
                return 60; // ç°¡ç•¥å®Ÿè£…
            }
            
            validateEngineInfluence(engineOS) {
                return { valid: true, score: 85 };
            }
            
            validateScenarioInfluence(interfaceOS, safeModeOS) {
                return { valid: true, score: 80 };
            }
            
            validateEngineToInterfaceFlow(engineOS, interfaceOS) {
                return { valid: true, influenceRate: 0.3 };
            }
            
            validateEngineToSafeModeFlow(engineOS, safeModeOS) {
                return { valid: true, influenceRate: 0.4 };
            }
            
            checkOSErrorHandling(os) {
                // OSã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°èƒ½åŠ›ã‚’ãƒã‚§ãƒƒã‚¯
                return os && os.hexagramId ? 0.9 : 0.3;
            }
            
            /**
             * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆTriple OSçµæœï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
             */
            getDefaultTripleOSResults() {
                return {
                    engineOS: {
                        hexagramId: 1,
                        hexagramName: "ä¹¾ç‚ºå¤©",
                        upperTrigram: "ä¹¾",
                        lowerTrigram: "ä¹¾",
                        description: "å‰µé€ æ€§ã¨å®Ÿè¡ŒåŠ›ã®åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰",
                        type: "Engine OS"
                    },
                    interfaceOS: {
                        hexagramId: 11,
                        hexagramName: "åœ°å¤©æ³°",
                        upperTrigram: "å¤",
                        lowerTrigram: "ä¹¾",
                        description: "èª¿å’Œçš„ãªç¤¾ä¼šçš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰",
                        type: "Interface OS"
                    },
                    safeModeOS: {
                        hexagramId: 2,
                        hexagramName: "å¤ç‚ºåœ°",
                        upperTrigram: "å¤",
                        lowerTrigram: "å¤",
                        description: "å®‰å®šæ€§é‡è¦–ã®é˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰",
                        type: "SafeMode OS"
                    },
                    integration: {
                        consistency: 50,
                        balance: 50,
                        integration: 50,
                        dataFlow: { isValid: false, error: "Default fallback mode" },
                        recommendations: [{
                            type: "system_recovery",
                            priority: "high",
                            title: "ã‚·ã‚¹ãƒ†ãƒ å¾©æ—§",
                            description: "Triple OSåˆ†æã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçµæœã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™",
                            action: "å†åº¦åˆ†æã‚’å®Ÿè¡Œã™ã‚‹ã‹ã€å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„"
                        }],
                        timestamp: Date.now(),
                        status: "fallback"
                    },
                    consistencyScore: 50,
                    balanceScore: 50,
                    HaQeiIntegration: 50,
                    recommendations: [{
                        type: "system_recovery",
                        priority: "high",
                        title: "ã‚·ã‚¹ãƒ†ãƒ å¾©æ—§ãŒå¿…è¦",
                        description: "åˆ†æã‚·ã‚¹ãƒ†ãƒ ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçµæœã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™",
                        action: "ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„"
                    }],
                    validationStatus: "error",
                    timestamp: Date.now(),
                    errorMode: true
                };
            }
        }
        
        // 7. çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
        class HAQEIState {
            constructor() {
                this.currentQuestion = 0;
                this.answers = [];
                this.userVector = {};
                this.tripleOSResults = null;
                this.isAnalyzing = false;
                
                this.loadState();
            }
            
            saveState() {
                try {
                    const state = {
                        currentQuestion: this.currentQuestion,
                        answers: this.answers,
                        userVector: this.userVector,
                        timestamp: Date.now()
                    };
                    localStorage.setItem('haqei_state', JSON.stringify(state));
                } catch (error) {
                    console.warn('âš ï¸ Failed to save state:', error);
                }
            }
            
            loadState() {
                try {
                    const saved = localStorage.getItem('haqei_state');
                    if (saved) {
                        const state = JSON.parse(saved);
                        // 1æ™‚é–“ä»¥å†…ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿å¾©å…ƒ
                        if (Date.now() - state.timestamp < 3600000) {
                            this.currentQuestion = state.currentQuestion || 0;
                            this.answers = state.answers || [];
                            this.userVector = state.userVector || {};
                        }
                    }
                } catch (error) {
                    console.warn('âš ï¸ Failed to load state:', error);
                }
            }
            
            clearState() {
                try {
                    localStorage.removeItem('haqei_state');
                } catch (error) {
                    console.warn('âš ï¸ Failed to clear state:', error);
                }
            }
            
            saveAnswer(questionIndex, selectedOption) {
                this.answers[questionIndex] = {
                    questionId: QUESTIONS[questionIndex].id,
                    selectedOption: selectedOption,
                    timestamp: Date.now()
                };
                this.saveState();
            }
            
            getAnswer(questionIndex) {
                return this.answers[questionIndex] || null;
            }
        }
        
        // 8. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡
        class CriticalCSSAnalyzer {
            constructor() {
                this.state = new HAQEIState();
                this.tripleOSEngine = new TripleOSEngine();
                this.trigramScores = {};
                
                this.initializeTrigramScores();
                this.bindEvents();
                
                // å¾©å…ƒã•ã‚ŒãŸçŠ¶æ…‹ãŒã‚ã‚Œã°ç”»é¢ã‚’è¡¨ç¤º
                if (this.state.currentQuestion > 0) {
                    this.showQuestion(this.state.currentQuestion);
                }
            }
            
            initializeTrigramScores() {
                for (let i = 1; i <= 8; i++) {
                    this.trigramScores[i] = 0;
                }
            }
            
            bindEvents() {
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
                document.getElementById('start-btn').addEventListener('click', () => this.startAnalysis());
                document.getElementById('prev-btn').addEventListener('click', () => this.previousQuestion());
                document.getElementById('next-btn').addEventListener('click', () => this.nextQuestion());
                document.getElementById('restart-btn').addEventListener('click', () => this.restart());
                document.getElementById('retry-btn').addEventListener('click', () => this.restart());
                
                // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
                document.addEventListener('keydown', (e) => this.handleKeydown(e));
            }
            
            handleKeydown(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    const focused = document.activeElement;
                    if (focused.classList.contains('option')) {
                        e.preventDefault();
                        this.selectOption(focused);
                    }
                }
            }
            
            startAnalysis() {
                this.showScreen('question-screen');
                this.showQuestion(0);
                this.announce('è³ªå•ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ');
            }
            
            showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                document.getElementById(screenId).classList.add('active');
            }
            
            showQuestion(index) {
                if (index >= QUESTIONS.length) {
                    this.proceedToAnalysis();
                    return;
                }
                
                this.state.currentQuestion = index;
                this.showScreen('question-screen');
                const question = QUESTIONS[index];
                
                // é€²æ—ãƒãƒ¼æ›´æ–°
                const progress = ((index + 1) / QUESTIONS.length) * 100;
                document.getElementById('progress-fill').style.width = `${progress}%`;
                
                // è³ªå•è¡¨ç¤º
                document.getElementById('question-number').textContent = index + 1;
                document.getElementById('question-title').textContent = question.text;
                
                // ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¡¨ç¤º
                const container = document.getElementById('options-container');
                container.innerHTML = '';
                
                question.options.forEach((option, optionIndex) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    optionElement.setAttribute('role', 'radio');
                    optionElement.setAttribute('aria-checked', 'false');
                    optionElement.setAttribute('tabindex', '0');
                    optionElement.innerHTML = `
                        <span class="option-text">${option.text}</span>
                    `;
                    
                    optionElement.addEventListener('click', () => this.selectOption(optionElement, option));
                    container.appendChild(optionElement);
                });
                
                // æ—¢å­˜ã®å›ç­”ãŒã‚ã‚Œã°å¾©å…ƒ
                const existingAnswer = this.state.getAnswer(index);
                if (existingAnswer) {
                    const selectedOption = existingAnswer.selectedOption;
                    const optionElements = container.querySelectorAll('.option');
                    optionElements.forEach((elem, idx) => {
                        if (question.options[idx].value === selectedOption.value) {
                            elem.classList.add('selected');
                            elem.setAttribute('aria-checked', 'true');
                        }
                    });
                    document.getElementById('next-btn').disabled = false;
                }
                
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³æ›´æ–°
                document.getElementById('prev-btn').disabled = index === 0;
                if (!existingAnswer) {
                    document.getElementById('next-btn').disabled = true;
                }
                
                this.announce(`è³ªå•${index + 1}: ${question.text}`);
            }
            
            selectOption(element, option) {
                // æ—¢å­˜ã®é¸æŠã‚’è§£é™¤
                element.parentNode.querySelectorAll('.option').forEach(opt => {
                    opt.classList.remove('selected');
                    opt.setAttribute('aria-checked', 'false');
                });
                
                // æ–°ã—ã„é¸æŠã‚’è¨­å®š
                element.classList.add('selected');
                element.setAttribute('aria-checked', 'true');
                
                // å›ç­”ã‚’ä¿å­˜ï¼ˆçŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ çµŒç”±ï¼‰
                this.state.saveAnswer(this.state.currentQuestion, option);
                
                // æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                document.getElementById('next-btn').disabled = false;
                
                this.announce(`é¸æŠã•ã‚Œã¾ã—ãŸ: ${option.text}`);
            }
            
            nextQuestion() {
                if (this.state.currentQuestion < QUESTIONS.length - 1) {
                    this.showQuestion(this.state.currentQuestion + 1);
                } else {
                    this.proceedToAnalysis();
                }
            }
            
            previousQuestion() {
                if (this.state.currentQuestion > 0) {
                    this.showQuestion(this.state.currentQuestion - 1);
                }
            }
            
            async proceedToAnalysis() {
                try {
                    this.showScreen('analysis-screen');
                    this.announce('åˆ†æã‚’é–‹å§‹ã—ã¦ã„ã¾ã™');
                    this.state.isAnalyzing = true;
                    
                    // Triple OSåˆ†æã‚’å®Ÿè¡Œ
                    await this.delay(1500); // UIæ¼”å‡º
                    
                    // å›ç­”ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›
                    const allAnswers = this.state.answers.filter(answer => answer && answer.selectedOption);
                    
                    // Triple OSã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚ˆã‚‹åˆ†æ
                    const tripleOSResults = await this.tripleOSEngine.analyzeTripleOS(allAnswers);
                    
                    // çµæœã‚’çŠ¶æ…‹ã«ä¿å­˜
                    this.state.tripleOSResults = tripleOSResults;
                    
                    // çµæœè¡¨ç¤º
                    this.showResults(tripleOSResults);
                    
                } catch (error) {
                    console.error('âŒ Analysis failed:', error);
                    this.showError('åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
                } finally {
                    this.state.isAnalyzing = false;
                }
            }
            
            calculateTrigramScores() {
                this.initializeTrigramScores();
                
                this.answers.forEach(answer => {
                    if (answer && answer.trigrams) {
                        answer.trigrams.forEach(trigramId => {
                            this.trigramScores[trigramId]++;
                        });
                    }
                });
            }
            
            calculateOSScores() {
                const osScores = {};
                
                Object.keys(TRIPLE_OS).forEach(osName => {
                    const os = TRIPLE_OS[osName];
                    let score = 0;
                    
                    os.trigrams.forEach(trigramId => {
                        score += this.trigramScores[trigramId] || 0;
                    });
                    
                    osScores[osName] = {
                        ...os,
                        score: score,
                        percentage: Math.round((score / (QUESTIONS.length * 2)) * 100)
                    };
                });
                
                return osScores;
            }
            
            showResults(tripleOSResults) {
                this.showScreen('results-screen');
                
                // OSã‚«ãƒ¼ãƒ‰è¡¨ç¤º
                const container = document.getElementById('os-cards-container');
                container.innerHTML = '';
                
                // Engine OS ã‚«ãƒ¼ãƒ‰
                const engineCard = this.createOSCard('Engine OS', tripleOSResults.engineOS, '#6366f1');
                container.appendChild(engineCard);
                
                // Interface OS ã‚«ãƒ¼ãƒ‰
                const interfaceCard = this.createOSCard('Interface OS', tripleOSResults.interfaceOS, '#8b5cf6');
                container.appendChild(interfaceCard);
                
                // SafeMode OS ã‚«ãƒ¼ãƒ‰
                const safeModeCard = this.createOSCard('Safe Mode OS', tripleOSResults.safeModeOS, '#10b981');
                container.appendChild(safeModeCard);
                
                // ã‚µãƒãƒªãƒ¼ç”Ÿæˆ
                this.generateTripleOSSummary(tripleOSResults);
                
                // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
                this.saveResults(tripleOSResults);
                
                this.announce('Triple OSåˆ†æãŒå®Œäº†ã—ã¾ã—ãŸ');
            }
            
            createOSCard(osName, osData, color) {
                const card = document.createElement('div');
                card.className = 'os-card card';
                card.style.borderColor = color + '40';
                
                // HaQeiæº–æ‹ ã®è¡¨ç¾ï¼ˆæ±ºå®šè«–çš„å›é¿ï¼‰
                const confidenceText = osData.type === 'Engine OS' ? 
                    'ã‚ãªãŸã®æ·±å±¤ä¾¡å€¤è¦³ã¨ã—ã¦å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚‹' : 
                    'ç¤¾ä¼šçš„ãªå´é¢ã®ä¸€ã¤ã®è¦–ç‚¹ã¨ã—ã¦';
                
                card.innerHTML = `
                    <div class="os-name">${osName}</div>
                    <div class="os-score" style="color: ${color};">${osData.hexagramName}</div>
                    <div class="os-description">${osData.description}</div>
                    <div style="margin-top: var(--space-sm); font-size: var(--font-sm); color: var(--primary-400);">
                        ${confidenceText}åˆ†æçµæœã§ã™
                    </div>
                `;
                
                return card;
            }
            
            generateTripleOSSummary(tripleOSResults) {
                const { 
                    engineOS, 
                    interfaceOS, 
                    safeModeOS, 
                    consistencyScore,
                    balanceScore,
                    HaQeiIntegration,
                    integration,
                    recommendations 
                } = tripleOSResults;
                
                // çµ±åˆã‚¹ã‚³ã‚¢ã®è¡¨ç¤ºç”¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
                const formatScore = (score) => Math.round(score || 0);
                const getScoreColor = (score) => {
                    if (score >= 80) return '#10b981'; // ç·‘
                    if (score >= 65) return '#f59e0b'; // é»„
                    return '#ef4444'; // èµ¤
                };
                
                // HaQeiæº–æ‹ ã®è¡¨ç¾
                const summary = `
                    <div style="margin-bottom: var(--space-md);">
                        <h4 style="color: var(--primary-100); margin-bottom: var(--space-sm);">ğŸ”¯ Triple OS ã‚·ã‚¹ãƒ†ãƒ åˆ†æ</h4>
                        <p style="color: var(--primary-200); line-height: 1.6;">
                            ã“ã®åˆ†æã¯ã€æ˜“çµŒã®64å¦ç†è«–ã«åŸºã¥ã<strong>å‚è€ƒæƒ…å ±</strong>ã¨ã—ã¦æä¾›ã•ã‚Œã¾ã™ã€‚
                            ã‚ãªãŸã®äººæ ¼ã‚’3ã¤ã®å±¤ã§ç†è§£ã™ã‚‹<strong>ä¸€ã¤ã®è¦–ç‚¹</strong>ã§ã™ã€‚
                        </p>
                    </div>
                    
                    <div style="margin-bottom: var(--space-md);">
                        <h5 style="color: #6366f1; margin-bottom: var(--space-xs);">ğŸ¯ Engine OSï¼ˆæ·±å±¤ä¾¡å€¤è¦³ï¼‰</h5>
                        <p style="color: var(--primary-300); font-size: var(--font-sm);">
                            ${engineOS.hexagramName} - ${engineOS.catchphrase || engineOS.description}
                        </p>
                    </div>
                    
                    <div style="margin-bottom: var(--space-md);">
                        <h5 style="color: #8b5cf6; margin-bottom: var(--space-xs);">ğŸ’¬ Interface OSï¼ˆç¤¾ä¼šçš„å´é¢ï¼‰</h5>
                        <p style="color: var(--primary-300); font-size: var(--font-sm);">
                            ${interfaceOS.hexagramName} - å¯¾äººé–¢ä¿‚ã§ã®ä¸€é¢
                        </p>
                    </div>
                    
                    <div style="margin-bottom: var(--space-md);">
                        <h5 style="color: #10b981; margin-bottom: var(--space-xs);">ğŸ›¡ï¸ SafeMode OSï¼ˆé˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ ï¼‰</h5>
                        <p style="color: var(--primary-300); font-size: var(--font-sm);">
                            ${safeModeOS.hexagramName} - å®‰å…¨ã‚’é‡è¦–ã™ã‚‹æ™‚ã®ç‰¹æ€§
                        </p>
                    </div>
                    
                    <div style="background: rgba(99, 102, 241, 0.05); border-radius: var(--radius-md); padding: var(--space-md); margin: var(--space-md) 0;">
                        <h5 style="color: var(--primary-100); margin-bottom: var(--space-sm); text-align: center;">ğŸ“Š Triple OSçµ±åˆè©•ä¾¡</h5>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--space-sm); margin-bottom: var(--space-sm);">
                            <div style="text-align: center; padding: var(--space-xs); background: rgba(255,255,255,0.05); border-radius: var(--radius-sm);">
                                <div style="font-size: var(--font-lg); font-weight: bold; color: ${getScoreColor(consistencyScore)};">
                                    ${formatScore(consistencyScore)}%
                                </div>
                                <div style="font-size: var(--font-xs); color: var(--primary-300);">æ•´åˆæ€§</div>
                            </div>
                            
                            <div style="text-align: center; padding: var(--space-xs); background: rgba(255,255,255,0.05); border-radius: var(--radius-sm);">
                                <div style="font-size: var(--font-lg); font-weight: bold; color: ${getScoreColor(balanceScore)};">
                                    ${formatScore(balanceScore)}%
                                </div>
                                <div style="font-size: var(--font-xs); color: var(--primary-300);">å‹•çš„ãƒãƒ©ãƒ³ã‚¹</div>
                            </div>
                            
                            <div style="text-align: center; padding: var(--space-xs); background: rgba(255,255,255,0.05); border-radius: var(--radius-sm);">
                                <div style="font-size: var(--font-lg); font-weight: bold; color: ${getScoreColor(HaQeiIntegration)};">
                                    ${formatScore(HaQeiIntegration)}%
                                </div>
                                <div style="font-size: var(--font-xs); color: var(--primary-300);">HaQeiçµ±åˆ</div>
                            </div>
                        </div>
                        
                        <p style="color: var(--primary-300); font-size: var(--font-xs); text-align: center; margin-top: var(--space-xs);">
                            â€»ã“ã‚Œã‚‰ã®æ•°å€¤ã¯å‚è€ƒæŒ‡æ¨™ã¨ã—ã¦ã€è‡ªå·±ç†è§£ã®ä¸€åŠ©ã¨ã—ã¦ã”æ´»ç”¨ãã ã•ã„
                        </p>
                    </div>
                    
                    ${recommendations && recommendations.length > 0 ? `
                        <div style="background: rgba(16, 185, 129, 0.05); border-radius: var(--radius-md); padding: var(--space-md); margin: var(--space-md) 0;">
                            <h5 style="color: #10b981; margin-bottom: var(--space-sm);">ğŸ’¡ æˆé•·ã¸ã®æ°—ã¥ã</h5>
                            ${recommendations.slice(0, 2).map(rec => `
                                <div style="margin-bottom: var(--space-sm); padding: var(--space-xs); background: rgba(255,255,255,0.03); border-radius: var(--radius-sm);">
                                    <div style="font-weight: bold; color: var(--primary-200); margin-bottom: var(--space-xs);">
                                        ${rec.title}
                                    </div>
                                    <div style="color: var(--primary-300); font-size: var(--font-sm); line-height: 1.4;">
                                        ${rec.description}
                                    </div>
                                </div>
                            `).join('')}
                            <p style="color: var(--primary-400); font-size: var(--font-xs); text-align: center; margin-top: var(--space-sm);">
                                ã“ã‚Œã‚‰ã®æ°—ã¥ãã‚’ã€æ—¥å¸¸ã®ä¸­ã§å°‘ã—ãšã¤æ„è­˜ã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™
                            </p>
                        </div>
                    ` : ''}
                    
                    <div style="background: rgba(99, 102, 241, 0.1); border-radius: var(--radius-md); padding: var(--space-sm); margin-top: var(--space-md);">
                        <p style="color: var(--primary-200); font-size: var(--font-sm); text-align: center; line-height: 1.4;">
                            ğŸŒŸ ã“ã®åˆ†æçµæœã¯æ˜“çµŒã®æ™ºæ…§ã«åŸºã¥ãä¸€ã¤ã®è¦–ç‚¹ã§ã™<br>
                            ã‚ãªãŸè‡ªèº«ã®ç›´æ„Ÿã¨åˆã‚ã›ã¦ã€ã‚ˆã‚Šæ·±ã„è‡ªå·±ç†è§£ã«ãŠå½¹ç«‹ã¦ãã ã•ã„
                        </p>
                    </div>
                `;
                
                document.getElementById('result-summary').innerHTML = summary;
            }
            
            saveResults(tripleOSResults) {
                try {
                    const results = {
                        timestamp: new Date().toISOString(),
                        answers: this.state.answers,
                        tripleOSResults: tripleOSResults,
                        version: '2.0',
                        HaQeiCompliant: true
                    };
                    
                    localStorage.setItem('haqei_emergency_results', JSON.stringify(results));
                    console.log('âœ… Triple OS Results saved to localStorage');
                } catch (error) {
                    console.warn('âš ï¸ Failed to save results:', error);
                }
            }
            
            showError(message) {
                this.showScreen('error-screen');
                document.getElementById('error-message').textContent = message;
                this.announce('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
            
            restart() {
                // çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
                this.state.clearState();
                this.state.currentQuestion = 0;
                this.state.answers = [];
                this.state.tripleOSResults = null;
                this.state.isAnalyzing = false;
                
                // UIåˆæœŸåŒ–
                this.initializeTrigramScores();
                this.showScreen('welcome-screen');
                this.announce('åˆ†æãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸ');
            }
            
            announce(message) {
                const announcements = document.getElementById('announcements');
                announcements.textContent = message;
                
                // ä¸€å®šæ™‚é–“å¾Œã«ã‚¯ãƒªã‚¢
                setTimeout(() => {
                    announcements.textContent = '';
                }, 3000);
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        // 5. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            try {
                console.log('ğŸ¯ HAQEI Emergency Analyzer initializing...');
                console.log('ğŸ”¯ Authentic I-Ching 64 Hexagrams Engine loaded');
                console.log('â˜° Trigram Mapping System: HaQei philosophy compliant');
                
                // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
                window.criticalCSSAnalyzer = new CriticalCSSAnalyzer();
                
                console.log('âœ… Critical CSS Analyzer ready');
                console.log('ğŸ“Š Questions loaded:', QUESTIONS.length);
                console.log('ğŸ­ Triple OS systems:', Object.keys(TRIPLE_OS).length);
                console.log('ğŸ”¯ Authentic Hexagrams loaded:', HEXAGRAMS.length);
                // console.log('ğŸ† Authentic 8D Vectors loaded:', Object.keys(AUTHENTIC_H64_8D_VECTORS).length);
                console.log('ğŸ”¯ I-Ching Orthodoxy validated: Traditional 64 Hexagram matrix');
                
            } catch (error) {
                console.error('âŒ Initialization failed:', error);
                document.body.innerHTML = `
                    <div style="padding: 2rem; text-align: center; color: #ef4444;">
                        <h1>åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼</h1>
                        <p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚</p>
                        <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #6366f1; color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
                            å†èª­ã¿è¾¼ã¿
                        </button>
                    </div>
                `;
            }
        });
        
        // 6. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
        // ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ç™»éŒ²ï¼ˆå¯èƒ½ãªå ´åˆï¼‰
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/emergency-sw.js')
                    .then(registration => {
                        console.log('âœ… Emergency SW registered');
                    })
                    .catch(error => {
                        console.log('âš ï¸ SW registration failed (optional)');
                    });
            });
        }
        
        // ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–
        window.addEventListener('beforeunload', () => {
            if (window.criticalCSSAnalyzer) {
                window.criticalCSSAnalyzer = null;
            }
        });
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.addEventListener('error', (event) => {
            console.error('âŒ Global error:', event.error);
            if (window.criticalCSSAnalyzer) {
                window.criticalCSSAnalyzer.showError('äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            console.error('âŒ Unhandled promise rejection:', event.reason);
            event.preventDefault();
            if (window.criticalCSSAnalyzer) {
                window.criticalCSSAnalyzer.showError('å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        });
        
        console.log('ğŸ“ HAQEI Critical CSS Analyzer script loaded');
        console.log('ğŸ† HaQeiå“²å­¦ Triple OS Engine integrated');
        console.log('âœ¨ Critical CSS optimizations applied');
    </script>
</body>
</html>