import { readFile, writeFile } from 'fs/promises';

async function fixPhase1() {
  try {
    console.log('=== フェーズ1: 5文字以下の緊急修正 開始 ===\n');
    
    // データベース読み込み
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // フェーズ1の修正マッピング（94件）
    const phase1Fixes = {
      // 4文字の最短説明
      '"岩になる"': '"岩のように動かず身を守る姿勢"',
      '"笑顔の泉"': '"尽きることのない笑顔と喜びの源"',
      '"石化する"': '"完全に動きを止めて防御態勢に入る"',
      '"確認地獄"': '"何度も確認を繰り返してしまう状態"',
      '"原点回帰"': '"基本に立ち返って問題を解決する"',
      '"そのまま"': '"現状をそのまま維持し続ける"',
      '"旅の感動"': '"旅で得られる新鮮な感動と発見"',
      '"旅の仲間"': '"旅路で出会う大切な仲間たち"',
      '"人の笑顔"': '"人々の笑顔を生み出す力"',
      '"集団の力"': '"集団の力を結集して問題解決する"',
      
      // 5文字の説明
      '"静かに観察"': '"静かに状況を観察して理解を深める"',
      '"エネルギーを蓄積"': '"次の活動に向けてエネルギーを蓄積する"',
      '"完全に静止"': '"完全に活動を停止して休息する"',
      '"静かに留まる"': '"静かにその場に留まって様子を見る"',
      '"次の燃料を探す"': '"次の情熱の対象となる燃料を探している"',
      '"感覚を遮断"': '"外部からの感覚を遮断して守る"',
      '"力を蓄える"': '"次の行動のために力を蓄えている"',
      '"次の上昇を準備"': '"次の上昇機会に向けて準備している"',
      '"完全に内に籠る"': '"完全に内面世界に籠って充電する"',
      '"家族との団らん"': '"家族との団らんで心を癒している"',
      '"自由を満喫"': '"獲得した自由を満喫している"',
      '"次の増幅対象を探す"': '"次に価値を増幅する対象を探している"',
      '"既存の縁を深める"': '"既存の人間関係の縁を深めている"',
      '"集めたものを整理"': '"これまで集めたものを整理している"',
      '"根を張る時間"': '"しっかりと根を張る時間を過ごす"',
      '"次の困難に備える"': '"次の困難に向けて準備を整える"',
      '"源泉を補充"': '"エネルギーの源泉を補充している"',
      '"素材を集める"': '"創造に必要な素材を集めている"',
      '"もともと動かない"': '"元々動かない性質なので休息も同じ"',
      '"現在の段階を固める"': '"現在の段階をしっかりと固めている"',
      '"自分の関係を見直す"': '"自分の人間関係を見直している"',
      '"次の豊作の準備"': '"次の豊作に向けて準備している"',
      '"一時的な滞在"': '"一時的にその場に滞在している"',
      '"自分も溶ける"': '"自分自身も溶けて流動的になる"',
      '"エネルギーを節約"': '"無駄を省いてエネルギーを節約する"',
      '"信頼関係を深める"': '"既存の信頼関係をさらに深める"',
      '"完成の満足感に浸る"': '"完成させた満足感に浸っている"',
      '"次の旅の準備"': '"次の旅に向けて準備を進める"',
      
      // その他の短い説明
      '"急激な変化は苦手"': '"急激な変化に対応するのが苦手な傾向"',
      '"守りを固めて耐える"': '"守りの姿勢を固めて困難に耐える"',
      '"極端な状況は苦手"': '"極端な状況での対応が苦手な傾向"',
      '"感情のデトックス"': '"溜まった感情をデトックスする時間"',
      '"感情的に疲れやすい"': '"感情面で疲れやすい傾向がある"',
      '"次の統合機会を探る"': '"次の統合の機会を探っている状態"',
      '"常に学ぶ姿勢を持つ"': '"常に謙虚に学ぶ姿勢を持ち続ける"',
      '"ひたすら耐える"': '"どんな困難もひたすら耐え抜く"',
      '"楽しいことを考える"': '"楽しいことを考えて気分を上げる"',
      '"抵抗せず流れに乗る"': '"無理に抵抗せず自然の流れに乗る"',
      '"環境に完全に同化"': '"環境に完全に同化して溶け込む"',
      '"次の改善対象を探す"': '"次に改善すべき対象を探している"',
      '"緊急修復モード起動"': '"緊急修復モードを起動して対処する"',
      '"行動が遅れがち"': '"慎重すぎて行動が遅れがちになる"',
      '"完全に引きこもる"': '"外界から完全に引きこもって守る"',
      '"常に全体像を把握"': '"常に状況の全体像を把握している"',
      '"視点を変えて観察"': '"視点を変えて物事を観察する"',
      '"細部を見落としがち"': '"全体を見て細部を見落としがちになる"',
      '"距離を置いて客観視"': '"問題から距離を置いて客観視する"',
      '"完全に離れて観察"': '"完全に離れた位置から観察する"',
      '"次の決断に備える"': '"次の重要な決断に備えている"',
      '"性急な判断のリスク"': '"性急な判断によるリスクがある"',
      '"即座に判断して行動"': '"即座に判断して行動に移す"',
      '"超高速決断モード"': '"超高速で決断するモードに入る"',
      '"物事を美しく整える"': '"物事を美しく整えることを重視する"',
      '"常に美しさを追求"': '"常に美しさを追求し続ける"',
      '"美しいものに触れる"': '"美しいものに触れて心を癒す"',
      '"美しいものに没頭"': '"美しいものに没頭して現実を忘れる"',
      '"美の世界に逃げ込む"': '"美の世界に逃げ込んで守る"',
      '"徹底的に削ぎ落とす"': '"不要なものを徹底的に削ぎ落とす"',
      '"何もしない時間"': '"何もしない時間を大切にする"',
      '"エネルギーを蓄積"': '"次の活動のためにエネルギーを蓄積"',
      '"七転び八起きの精神"': '"七転び八起きの不屈の精神を持つ"',
      '"迷いなく本能に従う"': '"迷いなく自分の本能に従って動く"',
      '"無心になる"': '"無心になって心を空にする"',
      '"裏表のない正直者"': '"裏表のない正直な性格の持ち主"',
      '"素直に助けを求める"': '"困った時は素直に助けを求める"',
      '"子供のように泣く"': '"子供のように素直に感情を出す"',
      '"知識の整理と体系化"': '"蓄積した知識を整理して体系化する"',
      '"知識の陳腐化に注意"': '"知識が陳腐化しないよう注意する"',
      '"全知識を総動員"': '"持てる全ての知識を総動員する"',
      '"徹底的な健康管理"': '"徹底的に健康管理を行う"',
      '"完全なリラックス"': '"完全にリラックスした状態になる"',
      '"まず体調を整える"': '"何よりもまず体調を整える"',
      '"健康第一で撤退"': '"健康を第一に考えて撤退する"',
      '"体調不良なら即休む"': '"体調不良を感じたら即座に休む"'
    };
    
    // バックアップ作成
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase1.${timestamp}.js`, content);
    console.log(`📁 バックアップ作成: hexagram-human-traits-v3.backup.phase1.${timestamp}.js`);
    
    // 修正適用
    let fixCount = 0;
    Object.entries(phase1Fixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const originalContent = content;
      content = content.replace(regex, newText);
      if (originalContent !== content) {
        fixCount++;
        console.log(`✅ 修正: ${old} → ${newText}`);
      }
    });
    
    // ファイル保存
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`\n=== フェーズ1完了 ===`);
    console.log(`修正件数: ${fixCount}件`);
    console.log(`\n次のステップ:`);
    console.log(`1. node comprehensive-v3-review.mjs で確認`);
    console.log(`2. node fix-short-descriptions-phase2.mjs でフェーズ2実行`);
    
  } catch (error) {
    console.error('エラー:', error);
  }
}

fixPhase1();