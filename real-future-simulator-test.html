<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future Simulator å®Ÿå‹•ä½œæ¤œè¨¼</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #0f172a;
            color: #e2e8f0;
        }
        .test-section {
            background: #1e293b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        .test-case {
            background: #334155;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .test-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 6px;
            color: #e2e8f0;
            font-size: 16px;
            min-height: 80px;
            resize: vertical;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px 4px;
            font-size: 14px;
            font-weight: 500;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .test-button:disabled {
            background: #64748b;
            cursor: not-allowed;
        }
        .result-display {
            background: #0f172a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #475569;
            min-height: 100px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        .success { color: #22c55e; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-loading { background: #f59e0b; animation: pulse 1s infinite; }
        .status-success { background: #22c55e; }
        .status-error { background: #ef4444; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .log-display {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }
        
        .test-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #1e293b;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #3b82f6;
        }
        .stat-label {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¬ Future Simulator å®Ÿå‹•ä½œæ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </h1>
    <p>Future Simulatorã®å®Ÿéš›ã®å‹•ä½œã‚’æ¤œè¨¼ã—ã€æ–‡ç« â†’çŠ¶æ³å¦ç‰¹å®šã®ç²¾åº¦ã‚’æ¸¬å®šã—ã¾ã™ã€‚</p>

    <!-- çµ±è¨ˆè¡¨ç¤º -->
    <div class="test-stats">
        <div class="stat-card">
            <div class="stat-value" id="tests-run">0</div>
            <div class="stat-label">å®Ÿè¡Œãƒ†ã‚¹ãƒˆ</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="success-count">0</div>
            <div class="stat-label">æˆåŠŸ</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="error-count">0</div>
            <div class="stat-label">ã‚¨ãƒ©ãƒ¼</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="avg-time">0ms</div>
            <div class="stat-label">å¹³å‡æ™‚é–“</div>
        </div>
    </div>

    <!-- kuromoji.jsåˆæœŸåŒ–ç¢ºèª -->
    <div class="test-section">
        <h2><span class="status-indicator" id="kuromoji-status"></span>kuromoji.js åˆæœŸåŒ–çŠ¶æ³ç¢ºèª</h2>
        <button class="test-button" onclick="checkKuromojiStatus()">åˆæœŸåŒ–çŠ¶æ³ç¢ºèª</button>
        <div class="result-display" id="kuromoji-result">æœªå®Ÿè¡Œ</div>
    </div>

    <!-- åŸºæœ¬å‹•ä½œãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <h2>ğŸ“ åŸºæœ¬å‹•ä½œãƒ†ã‚¹ãƒˆ</h2>
        <p>å®Ÿéš›ã®ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã«ã‚ˆã‚‹å‹•ä½œç¢ºèª</p>
        
        <div class="test-case">
            <h3>ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: å€‹äººçš„æ‚©ã¿</h3>
            <textarea class="test-input" id="personal-test">ç§ã¯æœ€è¿‘ã¨ã¦ã‚‚ä¸å®‰ã«æ„Ÿã˜ã¦ã„ã¾ã™ã€‚å°†æ¥ã®ã“ã¨ã‚’è€ƒãˆã‚‹ã¨å¤œã‚‚çœ ã‚Œãšã€è‡ªåˆ†ã«è‡ªä¿¡ãŒæŒã¦ã¾ã›ã‚“ã€‚</textarea>
            <button class="test-button" onclick="runActualTest('personal-test', 'personal-result', 'personal')">å®Ÿéš›ã®åˆ†æå®Ÿè¡Œ</button>
            <div class="result-display" id="personal-result">æœªå®Ÿè¡Œ</div>
        </div>

        <div class="test-case">
            <h3>ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: äººé–“é–¢ä¿‚ã®æ‚©ã¿</h3>
            <textarea class="test-input" id="relationship-test">è·å ´ã®ä¸Šå¸ã¨ã®é–¢ä¿‚ã«æ‚©ã‚“ã§ã„ã¾ã™ã€‚ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã†ã¾ãã„ã‹ãšã€æ¯æ—¥ãŒã‚¹ãƒˆãƒ¬ã‚¹ã§ã™ã€‚</textarea>
            <button class="test-button" onclick="runActualTest('relationship-test', 'relationship-result', 'relationship')">å®Ÿéš›ã®åˆ†æå®Ÿè¡Œ</button>
            <div class="result-display" id="relationship-result">æœªå®Ÿè¡Œ</div>
        </div>

        <div class="test-case">
            <h3>ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: è¤‡åˆçš„ãªæ‚©ã¿</h3>
            <textarea class="test-input" id="hybrid-test">è»¢è·ã‚’è€ƒãˆã¦ã„ã‚‹ãŒã€å®¶æ—ã®ã“ã¨ã‚‚å¿ƒé…ã§æ±ºæ–­ã§ããªã„ã€‚çµŒæ¸ˆçš„ãªä¸å®‰ã‚‚ã‚ã‚Šã€ã©ã†ã™ã‚Œã°ã„ã„ã‹ã‚ã‹ã‚‰ãªã„ã€‚</textarea>
            <button class="test-button" onclick="runActualTest('hybrid-test', 'hybrid-result', 'hybrid')">å®Ÿéš›ã®åˆ†æå®Ÿè¡Œ</button>
            <div class="result-display" id="hybrid-result">æœªå®Ÿè¡Œ</div>
        </div>
    </div>

    <!-- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <h2>âš ï¸ ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ</h2>
        
        <div class="test-case">
            <h3>çŸ­æ–‡ãƒ†ã‚¹ãƒˆ</h3>
            <textarea class="test-input" id="short-test">å›°ã£ãŸ</textarea>
            <button class="test-button" onclick="runActualTest('short-test', 'short-result', 'edge')">çŸ­æ–‡åˆ†æå®Ÿè¡Œ</button>
            <div class="result-display" id="short-result">æœªå®Ÿè¡Œ</div>
        </div>

        <div class="test-case">
            <h3>æ„Ÿæƒ…çš„è¡¨ç¾ãƒ†ã‚¹ãƒˆ</h3>
            <textarea class="test-input" id="emotional-test">ã‚‚ã†æœ¬å½“ã«å«Œã ï¼ï¼ï¼çµ¶å¯¾ã«ç„¡ç†ï¼ï¼æ­»ã«ãŸã„ï¼ï¼ï¼</textarea>
            <button class="test-button" onclick="runActualTest('emotional-test', 'emotional-result', 'edge')">æ„Ÿæƒ…çš„è¡¨ç¾åˆ†æå®Ÿè¡Œ</button>
            <div class="result-display" id="emotional-result">æœªå®Ÿè¡Œ</div>
        </div>

        <div class="test-case">
            <h3>å°‚é–€ç”¨èªãƒ†ã‚¹ãƒˆ</h3>
            <textarea class="test-input" id="technical-test">APIã®è¨­è¨ˆã§æ‚©ã‚“ã§ã„ã¾ã™ã€‚RESTã¨GraphQLã©ã¡ã‚‰ã‚’é¸ã¶ã¹ãã‹ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ±ºå®šã«è¿·ã£ã¦ã„ã¾ã™ã€‚</textarea>
            <button class="test-button" onclick="runActualTest('technical-test', 'technical-result', 'technical')">å°‚é–€ç”¨èªåˆ†æå®Ÿè¡Œ</button>
            <div class="result-display" id="technical-result">æœªå®Ÿè¡Œ</div>
        </div>
    </div>

    <!-- ä¸€æ‹¬ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <h2>ğŸš€ ä¸€æ‹¬å®Ÿè¡Œ</h2>
        <button class="test-button" onclick="runAllTests()" id="run-all-btn">å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button class="test-button" onclick="clearAllResults()">çµæœã‚¯ãƒªã‚¢</button>
    </div>

    <!-- ãƒ­ã‚°è¡¨ç¤º -->
    <div class="test-section">
        <h2>ğŸ“‹ å®Ÿè¡Œãƒ­ã‚°</h2>
        <div class="log-display" id="execution-log"></div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let testStats = {
            run: 0,
            success: 0,
            error: 0,
            times: []
        };

        function log(message, type = 'info') {
            const logDiv = document.getElementById('execution-log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#3b82f6',
                success: '#22c55e', 
                error: '#ef4444',
                warning: '#f59e0b'
            };
            
            logDiv.innerHTML += `<div style="color: ${colors[type]}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStats() {
            document.getElementById('tests-run').textContent = testStats.run;
            document.getElementById('success-count').textContent = testStats.success;
            document.getElementById('error-count').textContent = testStats.error;
            
            if (testStats.times.length > 0) {
                const avgTime = testStats.times.reduce((a, b) => a + b, 0) / testStats.times.length;
                document.getElementById('avg-time').textContent = Math.round(avgTime) + 'ms';
            }
        }

        // kuromoji.jsåˆæœŸåŒ–çŠ¶æ³ç¢ºèª
        async function checkKuromojiStatus() {
            const statusIndicator = document.getElementById('kuromoji-status');
            const resultDiv = document.getElementById('kuromoji-result');
            
            statusIndicator.className = 'status-indicator status-loading';
            resultDiv.textContent = 'ç¢ºèªä¸­...';
            log('kuromoji.jsåˆæœŸåŒ–çŠ¶æ³ç¢ºèªé–‹å§‹');

            try {
                // iframeå†…ã§Future Simulatorã‚’èª­ã¿è¾¼ã‚“ã§ç¢ºèª
                const iframe = document.createElement('iframe');
                iframe.src = '/future_simulator.html';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
                
                await new Promise(resolve => {
                    iframe.onload = () => {
                        setTimeout(() => {
                            try {
                                const iframeWindow = iframe.contentWindow;
                                const kuromojiStatus = iframeWindow.kuromojiTokenizer ? 'initialized' : 'not_initialized';
                                const aiAssistantExists = typeof iframeWindow.callAIAssistant === 'function';
                                const contextAnalyzeExists = typeof iframeWindow.analyzeContextType === 'function';
                                
                                let statusText = `kuromoji Tokenizer: ${kuromojiStatus}\n`;
                                statusText += `callAIAssistanté–¢æ•°: ${aiAssistantExists ? 'å­˜åœ¨' : 'æœªå®šç¾©'}\n`;
                                statusText += `analyzeContextTypeé–¢æ•°: ${contextAnalyzeExists ? 'å­˜åœ¨' : 'æœªå®šç¾©'}\n`;
                                
                                if (kuromojiStatus === 'initialized' && aiAssistantExists) {
                                    statusIndicator.className = 'status-indicator status-success';
                                    statusText += '\nâœ… ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†';
                                    log('kuromoji.jsåˆæœŸåŒ–æˆåŠŸ', 'success');
                                } else {
                                    statusIndicator.className = 'status-indicator status-error';
                                    statusText += '\nâŒ åˆæœŸåŒ–ã«å•é¡Œã‚ã‚Š';
                                    log('kuromoji.jsåˆæœŸåŒ–ã«å•é¡Œ', 'error');
                                }
                                
                                resultDiv.textContent = statusText;
                                document.body.removeChild(iframe);
                                resolve();
                                
                            } catch (error) {
                                statusIndicator.className = 'status-indicator status-error';
                                resultDiv.textContent = `ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                                log(`åˆæœŸåŒ–ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                                document.body.removeChild(iframe);
                                resolve();
                            }
                        }, 3000); // åˆæœŸåŒ–ã‚’å¾…ã¤
                    };
                });
                
            } catch (error) {
                statusIndicator.className = 'status-indicator status-error';
                resultDiv.textContent = `ç¢ºèªå¤±æ•—: ${error.message}`;
                log(`kuromojiç¢ºèªå¤±æ•—: ${error.message}`, 'error');
            }
        }

        // å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runActualTest(inputId, resultId, expectedType) {
            const startTime = performance.now();
            const inputText = document.getElementById(inputId).value;
            const resultDiv = document.getElementById(resultId);
            const button = event.target;
            
            if (!inputText.trim()) {
                resultDiv.textContent = 'ã‚¨ãƒ©ãƒ¼: å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆãŒç©ºã§ã™';
                return;
            }
            
            button.disabled = true;
            button.textContent = 'åˆ†æä¸­...';
            resultDiv.textContent = 'å®Ÿéš›ã®åˆ†æã‚’å®Ÿè¡Œä¸­...';
            
            testStats.run++;
            updateStats();
            
            log(`å®Ÿå‹•ä½œãƒ†ã‚¹ãƒˆé–‹å§‹: "${inputText.substring(0, 30)}..." (æœŸå¾…: ${expectedType})`);
            
            try {
                // å®Ÿéš›ã®Future Simulatorã®åˆ†ææ©Ÿèƒ½ã‚’å‘¼ã³å‡ºã—
                const iframe = document.createElement('iframe');
                iframe.src = '/future_simulator.html';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
                
                const result = await new Promise((resolve, reject) => {
                    iframe.onload = async () => {
                        try {
                            const iframeWindow = iframe.contentWindow;
                            
                            // åˆæœŸåŒ–ã‚’å¾…ã¤
                            let retries = 0;
                            const maxRetries = 10;
                            
                            const waitForInit = () => {
                                if (iframeWindow.kuromojiTokenizer && typeof iframeWindow.callAIAssistant === 'function') {
                                    return true;
                                }
                                if (retries++ < maxRetries) {
                                    setTimeout(waitForInit, 500);
                                    return false;
                                }
                                throw new Error('åˆæœŸåŒ–ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ');
                            };
                            
                            if (waitForInit()) {
                                // å®Ÿéš›ã®åˆ†æå®Ÿè¡Œ
                                const analysisResult = await iframeWindow.callAIAssistant(
                                    inputText,
                                    iframeWindow.H384_DATA || [],
                                    iframeWindow.futureThemeMap || new Map(),
                                    expectedType
                                );
                                
                                resolve(analysisResult);
                            }
                            
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    iframe.onerror = () => reject(new Error('iframeèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼'));
                });
                
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                testStats.times.push(responseTime);
                
                document.body.removeChild(iframe);
                
                if (result) {
                    testStats.success++;
                    
                    let resultText = `âœ… åˆ†ææˆåŠŸ (${Math.round(responseTime)}ms)\n\n`;
                    resultText += `é¸å‡ºã•ã‚ŒãŸå¦: ${result.å¦ç•ªå·}å¦ ${result.çˆ»ç•ªå·}çˆ»\n`;
                    resultText += `ä¿¡é ¼åº¦: ${Math.round(result.ä¿¡é ¼åº¦ * 100)}%\n`;
                    resultText += `æ ¹æ‹ : ${result.æ ¹æ‹ }\n`;
                    resultText += `è§£èª¬: ${result.è§£èª¬}\n`;
                    
                    if (result.analysisResult) {
                        resultText += `\n--- è©³ç´°åˆ†æçµæœ ---\n`;
                        resultText += `ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ: ${result.analysisResult.contextType || 'ä¸æ˜'}\n`;
                        resultText += `åˆ†ææ‰‹æ³•: ${result.analysisResult.method || 'ä¸æ˜'}\n`;
                        
                        if (result.analysisResult.alternatives && result.analysisResult.alternatives.length > 0) {
                            resultText += `ä»£æ›¿å€™è£œ: ${result.analysisResult.alternatives.length}ä»¶\n`;
                        }
                    }
                    
                    resultDiv.textContent = resultText;
                    log(`åˆ†ææˆåŠŸ: ${result.å¦ç•ªå·}å¦${result.çˆ»ç•ªå·}çˆ» (${Math.round(responseTime)}ms)`, 'success');
                    
                } else {
                    testStats.error++;
                    resultDiv.textContent = `âŒ åˆ†æçµæœãªã— (${Math.round(responseTime)}ms)`;
                    log(`åˆ†æçµæœãªã— (${Math.round(responseTime)}ms)`, 'error');
                }
                
            } catch (error) {
                testStats.error++;
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                
                resultDiv.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message} (${Math.round(responseTime)}ms)`;
                log(`åˆ†æã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
            
            button.disabled = false;
            button.textContent = 'å®Ÿéš›ã®åˆ†æå®Ÿè¡Œ';
            updateStats();
        }

        // å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runAllTests() {
            const button = document.getElementById('run-all-btn');
            button.disabled = true;
            button.textContent = 'å®Ÿè¡Œä¸­...';
            
            log('=== å…¨å®Ÿå‹•ä½œãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'info');
            
            // kuromojiåˆæœŸåŒ–ç¢ºèª
            await checkKuromojiStatus();
            
            // å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’é †æ¬¡å®Ÿè¡Œ
            const testCases = [
                { inputId: 'personal-test', resultId: 'personal-result', expected: 'personal' },
                { inputId: 'relationship-test', resultId: 'relationship-result', expected: 'relationship' },
                { inputId: 'hybrid-test', resultId: 'hybrid-result', expected: 'hybrid' },
                { inputId: 'short-test', resultId: 'short-result', expected: 'edge' },
                { inputId: 'emotional-test', resultId: 'emotional-result', expected: 'edge' },
                { inputId: 'technical-test', resultId: 'technical-result', expected: 'technical' }
            ];
            
            for (const testCase of testCases) {
                await new Promise(resolve => {
                    // å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                    const inputElement = document.getElementById(testCase.inputId);
                    if (inputElement) {
                        runActualTest(testCase.inputId, testCase.resultId, testCase.expected);
                        setTimeout(resolve, 2000); // 2ç§’é–“éš”
                    } else {
                        resolve();
                    }
                });
            }
            
            log('=== å…¨å®Ÿå‹•ä½œãƒ†ã‚¹ãƒˆå®Œäº† ===', 'success');
            
            button.disabled = false;
            button.textContent = 'å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ';
        }

        function clearAllResults() {
            const resultDivs = document.querySelectorAll('.result-display');
            resultDivs.forEach(div => {
                if (div.id !== 'execution-log') {
                    div.textContent = 'æœªå®Ÿè¡Œ';
                }
            });
            
            testStats = { run: 0, success: 0, error: 0, times: [] };
            updateStats();
            
            document.getElementById('execution-log').innerHTML = '';
            document.getElementById('kuromoji-status').className = 'status-indicator';
            
            log('ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('Future Simulator å®Ÿå‹•ä½œæ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†', 'success');
            updateStats();
        });
    </script>
</body>
</html>