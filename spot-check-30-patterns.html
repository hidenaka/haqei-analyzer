<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æŠœãæ‰“ã¡30ãƒ‘ã‚¿ãƒ¼ãƒ³æ–‡è„ˆãƒã‚§ãƒƒã‚¯</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
            line-height: 1.6;
        }
        .pattern-check {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
        }
        .pattern-header {
            font-weight: bold;
            color: #22d3ee;
            margin-bottom: 10px;
        }
        .synergy-info {
            background: rgba(59, 130, 246, 0.1);
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }
        .pair-analysis {
            margin: 8px 0;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-left: 3px solid #666;
        }
        .logical { border-left-color: #10b981; }
        .suspicious { 
            border-left-color: #f59e0b; 
            background: rgba(245, 158, 11, 0.1);
        }
        .problematic { 
            border-left-color: #ef4444; 
            background: rgba(239, 68, 68, 0.1);
        }
        button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
        }
        .summary {
            margin-top: 30px;
            padding: 20px;
            border: 2px solid #22d3ee;
            border-radius: 10px;
            background: rgba(34, 211, 238, 0.05);
        }
    </style>
</head>
<body>
    <h1>ğŸ” æŠœãæ‰“ã¡30ãƒ‘ã‚¿ãƒ¼ãƒ³æ–‡è„ˆãƒã‚§ãƒƒã‚¯</h1>
    <p>ãƒ©ãƒ³ãƒ€ãƒ é¸æŠã—ãŸ30ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿéš›ã®å‡ºåŠ›å†…å®¹ã¨è«–ç†çš„ä¸€è²«æ€§ã‚’ãƒã‚§ãƒƒã‚¯</p>
    
    <button onclick="runSpotCheck()">ğŸ¯ 30ãƒ‘ã‚¿ãƒ¼ãƒ³æŠœãæ‰“ã¡ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ</button>
    
    <div id="results"></div>
    <div id="summary"></div>

    <script src="./public/assets/H384H64database.js"></script>
    <script src="./public/js/core/TripleOSInteractionAnalyzer.js"></script>
    <script>
        function runSpotCheck() {
            const results = document.getElementById('results');
            const summary = document.getElementById('summary');
            
            results.innerHTML = '<div>ğŸ”„ 30ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­...</div>';
            summary.innerHTML = '';
            
            try {
                const analyzer = new TripleOSInteractionAnalyzer();
                
                // ãƒ©ãƒ³ãƒ€ãƒ ã«30ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠ
                const spotCheckPatterns = [];
                const usedCombinations = new Set();
                
                while (spotCheckPatterns.length < 30) {
                    const e = Math.floor(Math.random() * 64) + 1;
                    const iface = Math.floor(Math.random() * 64) + 1;
                    const s = Math.floor(Math.random() * 64) + 1;
                    const key = `${e}-${iface}-${s}`;
                    
                    if (!usedCombinations.has(key)) {
                        usedCombinations.add(key);
                        spotCheckPatterns.push([e, iface, s]);
                    }
                }
                
                console.log('30ãƒ‘ã‚¿ãƒ¼ãƒ³æŠœãæ‰“ã¡ãƒã‚§ãƒƒã‚¯é–‹å§‹');
                
                let logicalCount = 0;
                let suspiciousCount = 0;
                let problematicCount = 0;
                const issues = [];
                
                let html = '<h2>ğŸ” è©³ç´°ãƒã‚§ãƒƒã‚¯çµæœ</h2>';
                
                spotCheckPatterns.forEach(([e, iface, s], index) => {
                    try {
                        const engineOS = { hexagramId: e, name: `ç¬¬${e}å¦`, score: 0.5 };
                        const interfaceOS = { hexagramId: iface, name: `ç¬¬${iface}å¦`, score: 0.5 };
                        const safeModeOS = { hexagramId: s, name: `ç¬¬${s}å¦`, score: 0.5 };
                        
                        // å€‹åˆ¥ãƒšã‚¢åˆ†æ
                        const engineInterfaceAnalysis = analyzer.analyzePair('engine-interface', engineOS, interfaceOS);
                        const engineSafeAnalysis = analyzer.analyzePair('engine-safe', engineOS, safeModeOS);
                        const interfaceSafeAnalysis = analyzer.analyzePair('interface-safe', interfaceOS, safeModeOS);
                        
                        // ç·åˆã‚·ãƒŠã‚¸ãƒ¼
                        const totalSynergy = (engineInterfaceAnalysis.synergy + engineSafeAnalysis.synergy + interfaceSafeAnalysis.synergy) / 3;
                        const overallCategory = getSynergyCategory(totalSynergy);
                        
                        // æ–‡è„ˆãƒã‚§ãƒƒã‚¯
                        const contextCheck = checkContextualLogic(
                            e, iface, s,
                            engineInterfaceAnalysis,
                            engineSafeAnalysis, 
                            interfaceSafeAnalysis,
                            totalSynergy,
                            overallCategory
                        );
                        
                        // çµæœåˆ†é¡
                        let cssClass = 'logical';
                        if (contextCheck.issues.length > 0) {
                            if (contextCheck.severity === 'problematic') {
                                cssClass = 'problematic';
                                problematicCount++;
                                issues.push(...contextCheck.issues);
                            } else {
                                cssClass = 'suspicious';
                                suspiciousCount++;
                            }
                        } else {
                            logicalCount++;
                        }
                        
                        html += `
                            <div class="pattern-check">
                                <div class="pattern-header">
                                    ãƒ‘ã‚¿ãƒ¼ãƒ³ ${index + 1}: Engine(${e}) Ã— Interface(${iface}) Ã— SafeMode(${s})
                                </div>
                                
                                <div class="synergy-info">
                                    ç·åˆã‚·ãƒŠã‚¸ãƒ¼: ${totalSynergy.toFixed(3)} â†’ ${overallCategory}
                                </div>
                                
                                <div class="pair-analysis ${cssClass}">
                                    <strong>Engine-Interface:</strong> ${engineInterfaceAnalysis.category} (${engineInterfaceAnalysis.synergy?.toFixed(3)})<br>
                                    ã€Œ${engineInterfaceAnalysis.summary}ã€
                                </div>
                                
                                <div class="pair-analysis ${cssClass}">
                                    <strong>Engine-Safe:</strong> ${engineSafeAnalysis.category} (${engineSafeAnalysis.synergy?.toFixed(3)})<br>
                                    ã€Œ${engineSafeAnalysis.summary}ã€
                                </div>
                                
                                <div class="pair-analysis ${cssClass}">
                                    <strong>Interface-Safe:</strong> ${interfaceSafeAnalysis.category} (${interfaceSafeAnalysis.synergy?.toFixed(3)})<br>
                                    ã€Œ${interfaceSafeAnalysis.summary}ã€
                                </div>
                                
                                ${contextCheck.issues.length > 0 ? 
                                    `<div style="color: #f59e0b; margin-top: 10px;">
                                        <strong>âš ï¸ æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ:</strong><br>
                                        ${contextCheck.issues.map(issue => `â€¢ ${issue}`).join('<br>')}
                                    </div>` : 
                                    `<div style="color: #10b981;">âœ… æ–‡è„ˆçš„ã«è«–ç†çš„</div>`
                                }
                            </div>
                        `;
                        
                    } catch (error) {
                        problematicCount++;
                        issues.push(`ãƒ‘ã‚¿ãƒ¼ãƒ³${e}-${iface}-${s}: å®Ÿè¡Œã‚¨ãƒ©ãƒ¼ - ${error.message}`);
                        
                        html += `
                            <div class="pattern-check">
                                <div class="pattern-header">
                                    ãƒ‘ã‚¿ãƒ¼ãƒ³ ${index + 1}: Engine(${e}) Ã— Interface(${iface}) Ã— SafeMode(${s})
                                </div>
                                <div style="color: #ef4444;">
                                    âŒ å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}
                                </div>
                            </div>
                        `;
                    }
                });
                
                results.innerHTML = html;
                
                // ã‚µãƒãƒªãƒ¼ç”Ÿæˆ
                summary.innerHTML = `
                    <div class="summary">
                        <h3>ğŸ“Š 30ãƒ‘ã‚¿ãƒ¼ãƒ³æŠœãæ‰“ã¡ãƒã‚§ãƒƒã‚¯çµæœ</h3>
                        <p><strong>âœ… è«–ç†çš„ã«æ­£å¸¸:</strong> ${logicalCount}/30 (${(logicalCount/30*100).toFixed(1)}%)</p>
                        <p><strong>âš ï¸ ç–‘ã‚ã—ã„:</strong> ${suspiciousCount}/30 (${(suspiciousCount/30*100).toFixed(1)}%)</p>
                        <p><strong>âŒ å•é¡Œã‚ã‚Š:</strong> ${problematicCount}/30 (${(problematicCount/30*100).toFixed(1)}%)</p>
                        
                        ${issues.length > 0 ? `
                            <h4>ğŸš¨ æ¤œå‡ºã•ã‚ŒãŸä¸»ãªå•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³</h4>
                            ${issues.slice(0, 10).map(issue => `<p>â€¢ ${issue}</p>`).join('')}
                            ${issues.length > 10 ? `<p>...ä»– ${issues.length - 10} ä»¶</p>` : ''}
                            
                            <h4>ğŸ”§ æ¨å¥¨ä¿®æ­£å¯¾å¿œ</h4>
                            <p>é¡ä¼¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚ä»¥ä¸‹ã®è¦³ç‚¹ã§ç¢ºèªã—ã¦ãã ã•ã„:</p>
                            <ul>
                                <li>åŒä¸€å¦ãƒšã‚¢ã®è¡¨ç¾ä¸€è²«æ€§</li>
                                <li>ã‚«ãƒ†ã‚´ãƒªã¨è¨˜è¿°æ–‡ã®è«–ç†çš„æ•´åˆæ€§</li>
                                <li>å¦ã®ç‰¹æ€§ã¨è¡¨ç¾å†…å®¹ã®é©åˆæ€§</li>
                            </ul>
                        ` : `
                            <h4>ğŸ‰ çµæœ</h4>
                            <p style="color: #10b981; font-weight: bold;">
                                å…¨30ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ–‡è„ˆçš„ã«è«–ç†çš„ã§ã™ï¼ã‚·ã‚¹ãƒ†ãƒ å“è³ªã¯å„ªç§€ã§ã™ã€‚
                            </p>
                        `}
                    </div>
                `;
                
            } catch (error) {
                results.innerHTML = `
                    <div style="color: #ef4444; padding: 20px;">
                        âŒ ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}
                    </div>
                `;
            }
        }
        
        function getSynergyCategory(synergy) {
            if (synergy >= 0.6) return 'SYNERGY';
            if (synergy >= 0.2) return 'HARMONY';
            if (synergy >= -0.2) return 'TENSION';
            return 'CONFLICT';
        }
        
        function checkContextualLogic(engineId, interfaceId, safeModeId, eiAnalysis, esAnalysis, isAnalysis, totalSynergy, overallCategory) {
            const issues = [];
            let severity = 'normal';
            
            // ãƒã‚§ãƒƒã‚¯1: åŒä¸€å¦ãƒšã‚¢ã®è«–ç†æ€§
            if (engineId === interfaceId) {
                if (eiAnalysis.category === 'TENSION' && eiAnalysis.summary.includes('ç«¶åˆ')) {
                    // åŒä¸€å¦ãŒç«¶åˆã¨ã„ã†ã®ã¯è«–ç†çš„ã«ãŠã‹ã—ã„
                    if (getHexagramCharacteristics(engineId).keywords.some(k => ['èª¿å’Œ', 'å”èª¿', 'å®‰å®š', 'å¹³å’Œ', 'å—å®¹æ€§', 'åŒ…å®¹åŠ›', 'æŸ”è»Ÿæ€§'].includes(k))) {
                        issues.push(`åŒä¸€å¦${getHexagramName(engineId)}ãŒã€Œç«¶åˆã€ã€Œç·Šå¼µã€è¡¨ç¾ - èª¿å’Œç³»ã®å¦ãªã®ã«çŸ›ç›¾`);
                        severity = 'problematic';
                    }
                }
            }
            
            if (engineId === safeModeId) {
                if (esAnalysis.category === 'TENSION' && esAnalysis.summary.includes('ç«¶åˆ')) {
                    if (getHexagramCharacteristics(engineId).keywords.some(k => ['èª¿å’Œ', 'å”èª¿', 'å®‰å®š', 'å¹³å’Œ', 'å—å®¹æ€§', 'åŒ…å®¹åŠ›', 'æŸ”è»Ÿæ€§'].includes(k))) {
                        issues.push(`Engine-SafeåŒä¸€å¦${getHexagramName(engineId)}ãŒã€Œç«¶åˆã€è¡¨ç¾ - æœ¬æ¥ã¯å®‰å®šã™ã¹ã`);
                        severity = 'problematic';
                    }
                }
            }
            
            if (interfaceId === safeModeId) {
                if (isAnalysis.category === 'TENSION' && isAnalysis.summary.includes('ç«¶åˆ')) {
                    if (getHexagramCharacteristics(interfaceId).keywords.some(k => ['èª¿å’Œ', 'å”èª¿', 'å®‰å®š', 'å¹³å’Œ', 'å—å®¹æ€§', 'åŒ…å®¹åŠ›', 'æŸ”è»Ÿæ€§'].includes(k))) {
                        issues.push(`Interface-SafeåŒä¸€å¦${getHexagramName(interfaceId)}ãŒã€Œç«¶åˆã€è¡¨ç¾ - è«–ç†çš„ã«çŸ›ç›¾`);
                        severity = 'problematic';
                    }
                }
            }
            
            // ãƒã‚§ãƒƒã‚¯2: ã‚«ãƒ†ã‚´ãƒªã¨è¨˜è¿°ã®æ•´åˆæ€§
            [eiAnalysis, esAnalysis, isAnalysis].forEach((analysis, idx) => {
                const pairNames = ['Engine-Interface', 'Engine-Safe', 'Interface-Safe'];
                const pairName = pairNames[idx];
                
                if (analysis.category === 'HARMONY' && analysis.summary.includes('è¡çª')) {
                    issues.push(`${pairName}: HARMONYåˆ¤å®šãªã®ã«ã€Œè¡çªã€è¡¨ç¾`);
                    severity = 'suspicious';
                }
                
                if (analysis.category === 'SYNERGY' && analysis.summary.includes('ç·Šå¼µ')) {
                    issues.push(`${pairName}: SYNERGYåˆ¤å®šãªã®ã«ã€Œç·Šå¼µã€è¡¨ç¾`);
                    severity = 'suspicious';
                }
                
                if (analysis.category === 'CONFLICT' && analysis.summary.includes('èª¿å’Œ')) {
                    issues.push(`${pairName}: CONFLICTåˆ¤å®šãªã®ã«ã€Œèª¿å’Œã€è¡¨ç¾`);
                    severity = 'suspicious';
                }
            });
            
            // ãƒã‚§ãƒƒã‚¯3: undefinedå€¤ãƒã‚§ãƒƒã‚¯
            if (eiAnalysis.summary.includes('undefined') || esAnalysis.summary.includes('undefined') || isAnalysis.summary.includes('undefined')) {
                issues.push('summaryæ–‡ã«undefinedå€¤ãŒå«ã¾ã‚Œã¦ã„ã‚‹');
                severity = 'problematic';
            }
            
            return { issues, severity };
        }
        
        function getHexagramName(id) {
            const names = {
                1: 'ä¹¾ç‚ºå¤©', 2: 'å¤ç‚ºåœ°', 3: 'æ°´é›·å±¯', 4: 'å±±æ°´è’™', 5: 'æ°´å¤©éœ€',
                6: 'å¤©æ°´è¨Ÿ', 7: 'åœ°æ°´å¸«', 8: 'æ°´åœ°æ¯”', 9: 'é¢¨å¤©å°ç•œ', 10: 'å¤©æ²¢å±¥',
                11: 'åœ°å¤©æ³°', 12: 'å¤©åœ°å¦', 13: 'å¤©ç«åŒäºº', 14: 'ç«å¤©å¤§æœ‰', 15: 'åœ°å±±è¬™',
                16: 'é›·åœ°è±«', 17: 'æ²¢é›·éš', 18: 'å±±é¢¨è ±', 19: 'åœ°æ²¢è‡¨', 20: 'é¢¨åœ°è¦³'
            };
            return names[id] || `ç¬¬${id}å¦`;
        }
        
        function getHexagramCharacteristics(id) {
            // ç°¡æ˜“ç‰ˆ - å®Ÿéš›ã®H64_DATAã‹ã‚‰å–å¾—
            try {
                return window.H64_DATA[id] || { keywords: [], strength: '', weakness: '' };
            } catch {
                return { keywords: [], strength: '', weakness: '' };
            }
        }
    </script>
</body>
</html>