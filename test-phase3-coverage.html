<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>D-3-9/10: Phase 3ã‚«ãƒãƒ¼ç‡æ¤œè¨¼ï¼ˆ300ã‚µãƒ³ãƒ—ãƒ«ï¼‰</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .success { color: #4ec9b0; }
        .warning { color: #dcdcaa; }
        .error { color: #f48771; }
        .info { color: #9cdcfe; }
        .result-box {
            background: #252526;
            border: 1px solid #3e3e42;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .metric-card {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .metric-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }
        .coverage-chart {
            display: grid;
            grid-template-columns: repeat(16, 1fr);
            gap: 2px;
            margin: 20px 0;
        }
        .line-cell {
            width: 100%;
            height: 20px;
            background: #2d2d30;
            border: 1px solid #3e3e42;
            cursor: pointer;
            position: relative;
        }
        .line-cell.used {
            background: #4ec9b0;
        }
        .line-cell:hover::after {
            content: attr(data-info);
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: #3e3e42;
            padding: 5px 10px;
            border-radius: 3px;
            white-space: nowrap;
            z-index: 10;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¬ D-3-9/10: Phase 3 ã‚«ãƒãƒ¼ç‡æ¤œè¨¼ï¼ˆ300ã‚µãƒ³ãƒ—ãƒ«ï¼‰</h1>
    <div id="status">ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...</div>
    <div id="progress-container" style="display: none;">
        <div style="width: 100%; height: 20px; background: #2d2d30; border-radius: 10px; overflow: hidden;">
            <div id="progress-fill" style="height: 100%; background: linear-gradient(90deg, #4ec9b0, #569cd6); width: 0%; transition: width 0.3s;"></div>
        </div>
        <span id="progress-text">0/300</span>
    </div>
    <div id="results"></div>

    <script type="module">
        import { TextTo384LinesBridge } from './public/js/ai/TextTo384LinesBridge.js';
        
        // Phase 3ç”¨ã®å¤šæ§˜ãªãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«ç”Ÿæˆ
        function generatePhase3Samples() {
            const samples = [];
            
            // ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«å¤šæ§˜ãªãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆ
            const categories = {
                // ãƒ“ã‚¸ãƒã‚¹ï¼ˆ50å€‹ï¼‰
                business: [
                    "æ–°è¦äº‹æ¥­ã®ç«‹ã¡ä¸Šã’", "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥", "è²¡å‹™åˆ†æ", "äººäº‹è©•ä¾¡",
                    "è£½å“é–‹ç™º", "å“è³ªç®¡ç†", "å–¶æ¥­æ´»å‹•", "é¡§å®¢å¯¾å¿œ", "ç«¶åˆåˆ†æ", "å¸‚å ´èª¿æŸ»",
                    "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†", "ãƒªã‚¹ã‚¯ç®¡ç†", "æŠ•è³‡åˆ¤æ–­", "äº‹æ¥­è¨ˆç”»", "çµ„ç¹”æ”¹é©",
                    "æ¥­å‹™æ”¹å–„", "ã‚³ã‚¹ãƒˆå‰Šæ¸›", "å£²ä¸Šæ‹¡å¤§", "åˆ©ç›Šæœ€é©åŒ–", "è³‡é‡‘èª¿é”",
                    "M&Aæˆ¦ç•¥", "ã‚°ãƒ­ãƒ¼ãƒãƒ«å±•é–‹", "ãƒ‡ã‚¸ã‚¿ãƒ«å¤‰é©", "ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³", "èµ·æ¥­æº–å‚™",
                    "äº‹æ¥­æ‰¿ç¶™", "IPOæº–å‚™", "ã‚¢ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹", "ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°", "CSRæ´»å‹•",
                    "ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³", "åœ¨åº«ç®¡ç†", "ç”Ÿç”£ç®¡ç†", "ç‰©æµæœ€é©åŒ–", "å“è³ªä¿è¨¼",
                    "ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆ", "ãƒãƒ¼ã‚±ãƒƒãƒˆãƒªã‚µãƒ¼ãƒ", "å•†å“ä¼ç”»", "ä¾¡æ ¼æˆ¦ç•¥", "è²©ä¿ƒæ´»å‹•",
                    "åºƒå‘Šæˆ¦ç•¥", "PRæ´»å‹•", "SNSãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°", "ãƒ‡ãƒ¼ã‚¿åˆ†æ", "KPIç®¡ç†",
                    "äºˆç®—ç·¨æˆ", "æ±ºç®—å‡¦ç†", "ç›£æŸ»å¯¾å¿œ", "ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹", "å†…éƒ¨çµ±åˆ¶"
                ],
                // äººç”Ÿãƒ»ã‚­ãƒ£ãƒªã‚¢ï¼ˆ50å€‹ï¼‰
                life: [
                    "è»¢è·ã‚’è€ƒãˆã‚‹", "ã‚­ãƒ£ãƒªã‚¢ãƒã‚§ãƒ³ã‚¸", "ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—", "è³‡æ ¼å–å¾—", "ç•™å­¦æº–å‚™",
                    "ç‹¬ç«‹é–‹æ¥­", "ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹", "å‰¯æ¥­é–‹å§‹", "å®šå¹´å¾Œã®ç”Ÿæ´»", "ã‚»ã‚«ãƒ³ãƒ‰ã‚­ãƒ£ãƒªã‚¢",
                    "çµå©šæº–å‚™", "å­è‚²ã¦", "æ•™è‚²æ–¹é‡", "å®¶æ—é–¢ä¿‚", "ä»‹è­·å•é¡Œ",
                    "å¥åº·ç®¡ç†", "ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ", "é‹å‹•ç¿’æ…£", "ãƒ¡ãƒ³ã‚¿ãƒ«ã‚±ã‚¢", "ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆ",
                    "è¶£å‘³æ¢ã—", "ç¿’ã„äº‹", "ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢", "ç¤¾ä¼šè²¢çŒ®", "ç”ŸããŒã„æ¢ã—",
                    "äººé–“é–¢ä¿‚", "å‹äººé–¢ä¿‚", "æ‹æ„›ç›¸è«‡", "ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³",
                    "è‡ªå·±å•“ç™º", "è‡ªå·±åˆ†æ", "ç›®æ¨™è¨­å®š", "ç¿’æ…£å½¢æˆ", "æ™‚é–“ç®¡ç†",
                    "è³‡ç”£å½¢æˆ", "æŠ•è³‡è¨ˆç”»", "è²¯è“„è¨ˆç”»", "ä¿é™ºè¦‹ç›´ã—", "ç›¸ç¶šå¯¾ç­–",
                    "ä½å®…è³¼å…¥", "å¼•ã£è¶Šã—", "ãƒªãƒ•ã‚©ãƒ¼ãƒ ", "è€å¾Œæº–å‚™", "çµ‚æ´»",
                    "å­¦ã³ç›´ã—", "å¤§å­¦é™¢é€²å­¦", "ç ”ç©¶æ´»å‹•", "è«–æ–‡åŸ·ç­†", "å­¦ä¼šç™ºè¡¨"
                ],
                // æ„Ÿæƒ…ãƒ»å¿ƒç†ï¼ˆ50å€‹ï¼‰
                emotion: [
                    "ä¸å®‰ã‚’æ„Ÿã˜ã‚‹", "å¿ƒé…äº‹ãŒã‚ã‚‹", "ã‚¹ãƒˆãƒ¬ã‚¹ãŒæºœã¾ã‚‹", "ã‚¤ãƒ©ã‚¤ãƒ©ã™ã‚‹", "è½ã¡è¾¼ã‚€",
                    "æ‚²ã—ã¿ã«æš®ã‚Œã‚‹", "æ€’ã‚Šã‚’è¦šãˆã‚‹", "å«‰å¦¬ã™ã‚‹", "ç„¦ã‚Šã‚’æ„Ÿã˜ã‚‹", "ç·Šå¼µã™ã‚‹",
                    "å–œã³ã«æº€ã¡ã‚‹", "å¹¸ã›ã‚’æ„Ÿã˜ã‚‹", "æ„Ÿè¬ã®æ°—æŒã¡", "å¸Œæœ›ã‚’æŒã¤", "æ¥½ã—ã¿ã«ã™ã‚‹",
                    "å®‰å¿ƒã™ã‚‹", "æº€è¶³ã™ã‚‹", "å……å®Ÿæ„Ÿ", "é”æˆæ„Ÿ", "è§£æ”¾æ„Ÿ",
                    "å¾Œæ‚”ã™ã‚‹", "åçœã™ã‚‹", "ç”³ã—è¨³ãªã„", "æ¥ãšã‹ã—ã„", "å›°æƒ‘ã™ã‚‹",
                    "é©šã", "æ„Ÿå‹•ã™ã‚‹", "èˆˆå¥®ã™ã‚‹", "æœŸå¾…ã™ã‚‹", "æ†§ã‚Œã‚‹",
                    "å¯‚ã—ã•ã‚’æ„Ÿã˜ã‚‹", "å­¤ç‹¬æ„Ÿ", "ç–å¤–æ„Ÿ", "ç„¡åŠ›æ„Ÿ", "çµ¶æœ›æ„Ÿ",
                    "è‡ªä¿¡ã‚’æŒã¤", "èª‡ã‚Šã«æ€ã†", "å‹‡æ°—ãŒå‡ºã‚‹", "ã‚„ã‚‹æ°—ã«ãªã‚‹", "å‰å‘ãã«ãªã‚‹",
                    "å†·é™ã«ãªã‚‹", "è½ã¡ç€ã", "ãƒªãƒ©ãƒƒã‚¯ã‚¹", "ç©ã‚„ã‹ãªæ°—æŒã¡", "å¹³å’Œãªå¿ƒ",
                    "è¤‡é›‘ãªæ°—æŒã¡", "è‘›è—¤ã™ã‚‹", "è¿·ã†", "æ‚©ã‚€", "è€ƒãˆè¾¼ã‚€"
                ],
                // æ—¥å¸¸ç”Ÿæ´»ï¼ˆ50å€‹ï¼‰
                daily: [
                    "æœã®æº–å‚™", "é€šå‹¤æ™‚é–“", "ä»•äº‹é–‹å§‹", "ä¼šè­°å‚åŠ ", "ãƒ©ãƒ³ãƒã‚¿ã‚¤ãƒ ",
                    "åˆå¾Œã®ä½œæ¥­", "æ®‹æ¥­", "é€€ç¤¾æ™‚åˆ»", "å¸°å®…", "å¤•é£Ÿæº–å‚™",
                    "å®¶äº‹å…¨èˆ¬", "æƒé™¤", "æ´—æ¿¯", "è²·ã„ç‰©", "æ–™ç†",
                    "å…¥æµ´", "å°±å¯å‰", "é€±æœ«ã®éã”ã—æ–¹", "ä¼‘æ—¥ã®è¨ˆç”»", "å¤–å‡ºæº–å‚™",
                    "å‹äººã¨ã®ç´„æŸ", "å®¶æ—ã¨ã®æ™‚é–“", "ä¸€äººã®æ™‚é–“", "è¶£å‘³ã®æ™‚é–“", "é‹å‹•ã®æ™‚é–“",
                    "èª­æ›¸", "æ˜ ç”»é‘‘è³", "éŸ³æ¥½é‘‘è³", "ã‚²ãƒ¼ãƒ ", "SNS",
                    "ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒã‚§ãƒƒã‚¯", "ãƒ¡ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯", "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª", "ToDoãƒªã‚¹ãƒˆ", "æ—¥è¨˜",
                    "å‹‰å¼·æ™‚é–“", "ä»•äº‹ã®æº–å‚™", "è³‡æ–™ä½œæˆ", "ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ", "ãƒ—ãƒ¬ã‚¼ãƒ³æº–å‚™",
                    "é›»è©±å¯¾å¿œ", "æ¥å®¢å¯¾å¿œ", "å¤–å‡º", "å‡ºå¼µ", "ä¼šé£Ÿ",
                    "å¥åº·ãƒã‚§ãƒƒã‚¯", "è–¬ã®æœç”¨", "é€šé™¢", "æ¤œæŸ»", "ãƒªãƒãƒ“ãƒª"
                ],
                // å“²å­¦ãƒ»æ€è€ƒï¼ˆ50å€‹ï¼‰
                philosophy: [
                    "äººç”Ÿã®æ„å‘³", "å­˜åœ¨æ„ç¾©", "è‡ªå·±å®Ÿç¾", "å¹¸ç¦ã¨ã¯", "æˆåŠŸã®å®šç¾©",
                    "æ­£ç¾©ã«ã¤ã„ã¦", "å–„æ‚ªã®åŸºæº–", "é“å¾³è¦³", "å€«ç†è¦³", "ä¾¡å€¤è¦³",
                    "çœŸç†ã®æ¢æ±‚", "çŸ¥è­˜ã¨æ™ºæ…§", "ç†æ€§ã¨æ„Ÿæƒ…", "æ„è­˜ã¨ç„¡æ„è­˜", "è‡ªç”±æ„å¿—",
                    "é‹å‘½è«–", "å› æœé–¢ä¿‚", "å¶ç„¶ã¨å¿…ç„¶", "æ™‚é–“ã®æ¦‚å¿µ", "ç©ºé–“èªè­˜",
                    "ç¾ã®æœ¬è³ª", "èŠ¸è¡“ã®ä¾¡å€¤", "å‰µé€ æ€§", "æƒ³åƒåŠ›", "ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",
                    "æ„›ã®å½¢", "å‹æƒ…ã®æ„å‘³", "ä¿¡é ¼é–¢ä¿‚", "å…±æ„Ÿèƒ½åŠ›", "åˆ©ä»–ä¸»ç¾©",
                    "æ­»ç”Ÿè¦³", "ç”Ÿãã‚‹æ„å‘³", "æ­»ã®ææ€–", "æ°¸é æ€§", "è¼ªå»»è»¢ç”Ÿ",
                    "å®—æ•™è¦³", "ä¿¡ä»°å¿ƒ", "ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«", "ç‘æƒ³", "æ‚Ÿã‚Š",
                    "ç§‘å­¦ã¨å“²å­¦", "è«–ç†ã¨ç›´æ„Ÿ", "åˆ†æã¨çµ±åˆ", "éƒ¨åˆ†ã¨å…¨ä½“", "ãƒŸã‚¯ãƒ­ã¨ãƒã‚¯ãƒ­",
                    "å¤‰åŒ–ã¨ä¸å¤‰", "æµå‹•æ€§", "ç›¸å¯¾æ€§", "çµ¶å¯¾æ€§", "ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹"
                ],
                // è‡ªç„¶ãƒ»ç’°å¢ƒï¼ˆ50å€‹ï¼‰
                nature: [
                    "æ˜¥ã®è¨ªã‚Œ", "å¤ã®æš‘ã•", "ç§‹ã®ç´…è‘‰", "å†¬ã®å¯’ã•", "å­£ç¯€ã®å¤‰ã‚ã‚Šç›®",
                    "æœæ—¥ã‚’æµ´ã³ã‚‹", "å¤•æ—¥ã‚’è¦‹ã‚‹", "æœˆæ˜ã‹ã‚Š", "æ˜Ÿç©ºã‚’çœºã‚ã‚‹", "è™¹ã‚’è¦‹ã‚‹",
                    "é›¨ã®æ—¥", "æ™´ã‚Œã®æ—¥", "æ›‡ã‚Šç©º", "é›ªã®æ—¥", "å°é¢¨æ¥è¿‘",
                    "æµ·ã‚’è¦‹ã‚‹", "å±±ã«ç™»ã‚‹", "æ£®ã‚’æ­©ã", "å·ã®ã›ã›ã‚‰ã", "æ¹–ç•”ã§",
                    "èŠ±ã‚’æ„›ã§ã‚‹", "é³¥ã®å£°", "è™«ã®éŸ³", "é¢¨ã®éŸ³", "æ³¢ã®éŸ³",
                    "æ–°ç·‘ã®å­£ç¯€", "ç´…è‘‰ç‹©ã‚Š", "æ¡œã®é–‹èŠ±", "æ¢…é›¨å…¥ã‚Š", "åˆé›ª",
                    "ç’°å¢ƒå•é¡Œ", "åœ°çƒæ¸©æš–åŒ–", "ã‚¨ã‚³æ´»å‹•", "ãƒªã‚µã‚¤ã‚¯ãƒ«", "çœã‚¨ãƒ",
                    "è‡ªç„¶ç½å®³", "é˜²ç½å¯¾ç­–", "é¿é›£æº–å‚™", "å¾©èˆˆæ”¯æ´", "ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢",
                    "ã‚¬ãƒ¼ãƒ‡ãƒ‹ãƒ³ã‚°", "å®¶åº­èœåœ’", "åç©«", "ç¨®ã¾ã", "æ°´ã‚„ã‚Š",
                    "ãƒšãƒƒãƒˆã®ä¸–è©±", "å‹•ç‰©æ„›è­·", "é‡ç”Ÿå‹•ç‰©", "ç”Ÿæ…‹ç³»", "biodiversity"
                ]
            };
            
            // å„ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰50å€‹ãšã¤ã€è¨ˆ300å€‹ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½œæˆ
            Object.entries(categories).forEach(([category, texts]) => {
                texts.forEach(text => {
                    samples.push(text);
                });
            });
            
            return samples;
        }
        
        async function runPhase3Test() {
            const statusEl = document.getElementById('status');
            const progressContainer = document.getElementById('progress-container');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const resultsEl = document.getElementById('results');
            
            try {
                statusEl.innerHTML = '<span class="warning">TextTo384LinesBridgeåˆæœŸåŒ–ä¸­...</span>';
                const bridge = new TextTo384LinesBridge();
                await bridge.initialize();
                
                // lineUsageCountã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆå…¬å¹³ãªãƒ†ã‚¹ãƒˆã®ãŸã‚ï¼‰
                bridge.lineUsageCount = {};
                
                statusEl.innerHTML = '<span class="info">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ï¼ˆ300ã‚µãƒ³ãƒ—ãƒ«ï¼‰...</span>';
                progressContainer.style.display = 'block';
                
                const samples = generatePhase3Samples();
                const results = {
                    lineUsage: new Map(),
                    determinismCheck: new Map(),
                    processingTimes: [],
                    totalSamples: samples.length
                };
                
                // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                for (let i = 0; i < samples.length; i++) {
                    const text = samples[i];
                    const startTime = performance.now();
                    
                    // ç¬¬1å›å®Ÿè¡Œ
                    const result1 = await bridge.analyzeText(text);
                    const processingTime = performance.now() - startTime;
                    results.processingTimes.push(processingTime);
                    
                    // ä½¿ç”¨ã•ã‚ŒãŸçˆ»ã‚’è¨˜éŒ²
                    const lineId = result1.line_384_id;
                    results.lineUsage.set(lineId, (results.lineUsage.get(lineId) || 0) + 1);
                    
                    // D-3-10: æ±ºå®šè«–æ€§ã®ç¶­æŒç¢ºèªï¼ˆåŒã˜ãƒ†ã‚­ã‚¹ãƒˆã§2å›å®Ÿè¡Œï¼‰
                    if (i < 10) { // æœ€åˆã®10å€‹ã ã‘æ±ºå®šè«–æ€§ãƒã‚§ãƒƒã‚¯
                        const result2 = await bridge.analyzeText(text);
                        results.determinismCheck.set(text, result1.line_384_id === result2.line_384_id);
                    }
                    
                    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
                    if ((i + 1) % 10 === 0) {
                        const progress = ((i + 1) / samples.length * 100);
                        progressFill.style.width = `${progress}%`;
                        progressText.textContent = `${i + 1}/${samples.length}`;
                    }
                }
                
                // çµæœè¨ˆç®—
                const uniqueLines = results.lineUsage.size;
                const coverageRate = (uniqueLines / 384) * 100;
                const maxUsage = Math.max(...results.lineUsage.values());
                const avgTime = results.processingTimes.reduce((a, b) => a + b, 0) / results.processingTimes.length;
                
                // æ±ºå®šè«–æ€§ãƒã‚§ãƒƒã‚¯çµæœ
                let determinismPass = true;
                results.determinismCheck.forEach((isSame, text) => {
                    if (!isSame) determinismPass = false;
                });
                
                // çµæœè¡¨ç¤º
                let html = '';
                
                // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰
                html += '<div class="metric-grid">';
                
                // ã‚«ãƒãƒ¼ç‡ï¼ˆD-3-9ï¼‰
                const coverageSuccess = coverageRate >= 8;
                html += `<div class="metric-card">
                    <div class="info">ã‚«ãƒãƒ¼ç‡</div>
                    <div class="metric-value ${coverageSuccess ? 'success' : 'error'}">${coverageRate.toFixed(1)}%</div>
                    <div>${coverageSuccess ? 'âœ… ç›®æ¨™é”æˆ (â‰¥8%)' : 'âŒ æœªé”æˆ (<8%)'}</div>
                </div>`;
                
                // ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°
                html += `<div class="metric-card">
                    <div class="info">ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°</div>
                    <div class="metric-value ${uniqueLines >= 31 ? 'success' : 'warning'}">${uniqueLines}/384</div>
                    <div>${uniqueLines >= 31 ? 'âœ… è‰¯å¥½' : 'âš ï¸ è¦æ”¹å–„'}</div>
                </div>`;
                
                // æœ€å¤§ä½¿ç”¨é »åº¦
                const maxUsageSuccess = maxUsage <= 10;
                html += `<div class="metric-card">
                    <div class="info">æœ€å¤§ä½¿ç”¨é »åº¦</div>
                    <div class="metric-value ${maxUsageSuccess ? 'success' : 'warning'}">${maxUsage}å›</div>
                    <div>${maxUsageSuccess ? 'âœ… é©åˆ‡' : 'âš ï¸ åã‚Šã‚ã‚Š'}</div>
                </div>`;
                
                // æ±ºå®šè«–æ€§ï¼ˆD-3-10ï¼‰
                html += `<div class="metric-card">
                    <div class="info">æ±ºå®šè«–æ€§</div>
                    <div class="metric-value ${determinismPass ? 'success' : 'error'}">${determinismPass ? 'âœ…' : 'âŒ'}</div>
                    <div>${determinismPass ? 'ç¶­æŒã•ã‚Œã¦ã„ã‚‹' : 'ç ´å£Šã•ã‚Œã¦ã„ã‚‹'}</div>
                </div>`;
                
                html += '</div>';
                
                // ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒãƒƒãƒ—ï¼ˆã©ã®çˆ»ãŒä½¿ã‚ã‚ŒãŸã‹è¦–è¦šåŒ–ï¼‰
                html += '<div class="result-box">';
                html += '<h3>ğŸ“Š çˆ»ä½¿ç”¨ãƒãƒƒãƒ—ï¼ˆç·‘=ä½¿ç”¨æ¸ˆã¿ã€ã‚°ãƒ¬ãƒ¼=æœªä½¿ç”¨ï¼‰</h3>';
                html += '<div class="coverage-chart">';
                for (let i = 1; i <= 384; i++) {
                    const used = results.lineUsage.has(i);
                    const usageCount = results.lineUsage.get(i) || 0;
                    const hexagramId = Math.ceil(i / 6);
                    const position = ((i - 1) % 6) + 1;
                    html += `<div class="line-cell ${used ? 'used' : ''}" 
                             data-info="çˆ»${i} (${hexagramId}å¦${position}çˆ») ä½¿ç”¨:${usageCount}å›"></div>`;
                }
                html += '</div>';
                html += '</div>';
                
                // Phase 3ã‚¿ã‚¹ã‚¯é”æˆçŠ¶æ³
                html += '<div class="result-box">';
                html += '<h3>âœ… D-3ã‚¿ã‚¹ã‚¯é”æˆçŠ¶æ³</h3>';
                html += '<pre>';
                
                const tasks = [
                    { id: 'D-3-1', desc: 'calculateLineScoreä¿®æ­£é–‹å§‹', done: true },
                    { id: 'D-3-2', desc: 'æ¢ç´¢ãƒã‚¤ã‚ºæ©Ÿèƒ½è¨­è¨ˆ', done: true },
                    { id: 'D-3-3', desc: 'ãƒã‚¤ã‚ºç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…', done: true },
                    { id: 'D-3-4', desc: 'lineUsageCountè¿½è·¡å®Ÿè£…', done: true },
                    { id: 'D-3-5', desc: 'ä½¿ç”¨é »åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£å®Ÿè£…', done: true },
                    { id: 'D-3-6', desc: 'ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ™ã‚¯ãƒˆãƒ«æ”¹å–„', done: true },
                    { id: 'D-3-7', desc: 'çˆ»å›ºæœ‰ãƒ‘ã‚¿ãƒ¼ãƒ³å¼·åŒ–', done: true },
                    { id: 'D-3-8', desc: 'æ¬¡å…ƒåˆ¥é‡ã¿ä»˜ã‘å®Ÿè£…', done: true },
                    { id: 'D-3-9', desc: `ã‚«ãƒãƒ¼ç‡æ¸¬å®šï¼ˆç›®æ¨™8%ï¼‰`, done: coverageSuccess },
                    { id: 'D-3-10', desc: `æ±ºå®šè«–æ€§ã®ç¶­æŒç¢ºèª`, done: determinismPass }
                ];
                
                tasks.forEach(task => {
                    const status = task.done ? 'âœ…' : 'âŒ';
                    const color = task.done ? 'success' : 'error';
                    html += `<span class="${color}">${status} ${task.id}: ${task.desc}</span>\n`;
                });
                
                html += '\n<span class="info">ç·åˆåˆ¤å®š: ';
                if (coverageSuccess && determinismPass) {
                    html += '<span class="success">Phase 3å®Œäº† - ã‚«ãƒãƒ¼ç‡å‘ä¸ŠæˆåŠŸï¼</span>';
                } else {
                    html += '<span class="warning">è¿½åŠ èª¿æ•´ãŒå¿…è¦</span>';
                }
                html += '</span>';
                
                html += '</pre></div>';
                
                // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
                html += `<div class="result-box">
                    <h3>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h3>
                    <pre>å¹³å‡å‡¦ç†æ™‚é–“: <span class="${avgTime < 20 ? 'success' : 'warning'}">${avgTime.toFixed(2)}ms</span>
ç·å‡¦ç†æ™‚é–“: ${(results.processingTimes.reduce((a, b) => a + b, 0) / 1000).toFixed(2)}ç§’</pre>
                </div>`;
                
                resultsEl.innerHTML = html;
                statusEl.innerHTML = '<span class="success">âœ… ãƒ†ã‚¹ãƒˆå®Œäº†</span>';
                progressContainer.style.display = 'none';
                
            } catch (error) {
                statusEl.innerHTML = `<span class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                console.error(error);
            }
        }
        
        runPhase3Test();
    </script>
</body>
</html>