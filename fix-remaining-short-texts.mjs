import { readFile, writeFile } from 'fs/promises';

async function fixRemainingShortTexts() {
  try {
    console.log('=== 残りの短い説明文を修正 ===\n');
    
    // データベース読み込み
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // バックアップ作成
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.remaining.${timestamp}.js`, content);
    console.log(`📁 バックアップ作成: hexagram-human-traits-v3.backup.remaining.${timestamp}.js\n`);
    
    // 64卦の名前（これらは絶対に変更しない）
    const hexagramNames = new Set([
      '乾為天', '坤為地', '水雷屯', '山水蒙', '水天需', '天水訟', '地水師', '水地比',
      '風天小畜', '天澤履', '地天泰', '天地否', '天火同人', '火天大有', '地山謙', '雷地豫',
      '澤雷随', '山風蠱', '地澤臨', '風地観', '火雷噬嗑', '山火賁', '山地剥', '地雷復',
      '天雷無妄', '山天大畜', '山雷頤', '澤風大過', '坎為水', '離為火', '澤山咸', '雷風恒',
      '天山遯', '雷天大壮', '火地晋', '地火明夷', '風火家人', '火澤睽', '水山蹇', '雷水解',
      '山澤損', '風雷益', '澤天夬', '天風姤', '澤地萃', '地風升', '澤水困', '水風井',
      '澤火革', '火風鼎', '震為雷', '艮為山', '風山漸', '雷澤帰妹', '雷火豊', '火山旅',
      '巽為風', '兌為澤', '風水渙', '水澤節', '風澤中孚', '雷山小過', '水火既済', '火水未済'
    ]);
    
    // 残りの修正リスト
    const fixes = [
      // 追加の2文字
      { old: '"天火"', new: '"天と火が結ぶ仲間の絆"' },
      { old: '"火天"', new: '"火と天が示す大いなる有"' },
      { old: '"地山"', new: '"地と山が導く謙虚の道"' },
      { old: '"雷地"', new: '"雷と地が生む豫楽の時"' },
      { old: '"澤雷"', new: '"澤と雷が示す随従の道"' },
      { old: '"山風"', new: '"山と風が教える蠱の戒め"' },
      { old: '"地澤"', new: '"地と澤が臨む接近の時"' },
      { old: '"風地"', new: '"風と地が示す観察の智慧"' },
      { old: '"火雷"', new: '"火と雷が噛み合う断罪"' },
      { old: '"山火"', new: '"山と火が飾る賁の美"' },
      { old: '"山地"', new: '"山と地が示す剥落の時"' },
      { old: '"地雷"', new: '"地と雷が示す復帰の道"' },
      { old: '"天雷"', new: '"天と雷が導く無妄の真"' },
      { old: '"山天"', new: '"山と天が蓄える大畜の力"' },
      { old: '"山雷"', new: '"山と雷が養う頤の恵み"' },
      { old: '"澤風"', new: '"澤と風が超える大過の時"' },
      { old: '"澤山"', new: '"澤と山が生む咸の感応"' },
      { old: '"雷風"', new: '"雷と風が恒久に続く道"' },
      { old: '"天山"', new: '"天と山が示す遯の退避"' },
      { old: '"雷天"', new: '"雷と天が示す大壮の力"' },
      { old: '"火地"', new: '"火と地が晋む前進の道"' },
      { old: '"風火"', new: '"風と火が結ぶ家人の和"' },
      { old: '"火澤"', new: '"火と澤が睽く対立の時"' },
      { old: '"水山"', new: '"水と山が示す蹇の困難"' },
      { old: '"雷水"', new: '"雷と水が解く解放の時"' },
      { old: '"山澤"', new: '"山と澤が損して益を得る"' },
      { old: '"風雷"', new: '"風と雷が益する発展"' },
      { old: '"澤天"', new: '"澤と天が決する夬の時"' },
      { old: '"天風"', new: '"天と風が姤う出会いの時"' },
      { old: '"澤地"', new: '"澤と地が萃める集合"' },
      { old: '"地風"', new: '"地と風が升る上昇の道"' },
      { old: '"澤水"', new: '"澤と水が困る困窮の時"' },
      { old: '"水風"', new: '"水と風が井となり恵む"' },
      { old: '"澤火"', new: '"澤と火が革める変革"' },
      { old: '"火風"', new: '"火と風が鼎立する調和"' },
      { old: '"風山"', new: '"風と山が漸進する道"' },
      { old: '"雷澤"', new: '"雷と澤が結ぶ帰妹の縁"' },
      { old: '"雷火"', new: '"雷と火が豊かに満ちる"' },
      { old: '"火山"', new: '"火と山が旅する遊歴"' },
      { old: '"風水"', new: '"風と水が渙散する形"' },
      { old: '"水澤"', new: '"水と澤が節制する道"' },
      { old: '"雷山"', new: '"雷と山が小過する時"' },
      { old: '"水火"', new: '"水と火が既済する完成"' },
      { old: '"火水"', new: '"火と水が未済のまま続く"' },
      
      // 追加の3文字役割名
      { old: '"促進者"', new: '"物事を促進する推進者"' },
      { old: '"謙虚者"', new: '"謙虚さを持つ成長者"' },
      { old: '"楽観者"', new: '"前向きな姿勢の楽観者"' },
      { old: '"随従者"', new: '"柔軟に従う協調者"' },
      { old: '"改革者"', new: '"問題を改革する実行者"' },
      { old: '"観察者"', new: '"深く見抜く鋭い観察者"' },
      { old: '"装飾者"', new: '"美しく飾る創造者"' },
      { old: '"復活者"', new: '"再生の力を持つ復活者"' },
      { old: '"養育者"', new: '"愛情深く育てる養育者"' },
      { old: '"漸進者"', new: '"着実に進む前進者"' },
      { old: '"結縁者"', new: '"縁を結ぶ仲介者"' },
      { old: '"豊穣者"', new: '"豊かさを生む創造者"' },
      { old: '"旅行者"', new: '"新天地を求める旅行者"' },
      { old: '"信頼者"', new: '"信頼を築く誠実な人"' },
      { old: '"超越者"', new: '"限界を超える挑戦者"' },
      { old: '"不動者"', new: '"動じない強い精神の持ち主"' },
      
      // 追加の4-5文字タイプ名
      { old: '"励まし型"', new: '"仲間を励ます支援型"' },
      { old: '"一貫性型"', new: '"一貫性を保つ安定型"' },
      { old: '"辛抱強型"', new: '"辛抱強く待つ忍耐型"' },
      { old: '"大蓄積者"', new: '"大きく蓄積する資産家"' },
      { old: '"大挑戦者"', new: '"大きな挑戦をする冒険者"' },
      { old: '"感情理解型"', new: '"感情を深く理解する共感型"' },
      { old: '"感情包容型"', new: '"感情を包容する受容型"' },
      { old: '"協力要請型"', new: '"協力を要請する連携型"' },
      { old: '"継続努力型"', new: '"継続的に努力する堅実型"' },
      { old: '"分析評価型"', new: '"詳細に分析評価する知性型"' },
      { old: '"成果重視型"', new: '"成果を重視する実践型"' },
      { old: '"原因究明型"', new: '"原因を究明する分析型"' },
      { old: '"説得交渉型"', new: '"説得力のある交渉型"' },
      { old: '"実績証明型"', new: '"実績で証明する実力型"' },
      { old: '"段階構築型"', new: '"段階的に構築する計画型"' },
      { old: '"人脈構築型"', new: '"人脈を構築する社交型"' },
      { old: '"信頼依存型"', new: '"信頼関係に依存する協調型"' },
      { old: '"体調優先型"', new: '"体調を優先する健康型"' },
      { old: '"仕上げ型"', new: '"完璧に仕上げる完成型"' },
      { old: '"仲介調停型"', new: '"仲介と調停を行う調整型"' },
      { old: '"供給停止型"', new: '"供給を停止する防御型"' },
      { old: '"価値拡大型"', new: '"価値を拡大する成長型"' },
      { old: '"修復対処型"', new: '"問題を修復する対処型"' },
      
      // 6-7文字の追加修正
      { old: '"コネクター型"', new: '"人と人を繋ぐコネクター型"' },
      { old: '"カメレオン型"', new: '"環境に適応するカメレオン型"' },
      { old: '"低姿勢回避型"', new: '"低姿勢で回避する慎重型"' },
      { old: '"密着型の組織"', new: '"密着した関係の濃い組織"' },
      { old: '"力押し突破型"', new: '"力で押し切る突破型"' },
      { old: '"控えめ実力型"', new: '"控えめだが実力のある型"' },
      { old: '"ファミリー型"', new: '"家族的な絆を重視する型"' },
      { old: '"ドライな環境"', new: '"感情を排したドライな環境"' },
      { old: '"利己的な環境"', new: '"自己利益優先の利己的な環境"' },
      { old: '"停滞的な環境"', new: '"成長が止まった停滞的な環境"' },
      { old: '"閉鎖的な環境"', new: '"外部を拒む閉鎖的な環境"' },
      { old: '"インパクト型"', new: '"強い印象を与えるインパクト型"' },
      { old: '"瞬発的対応型"', new: '"瞬発的に対応する機敏型"' },
      { old: '"先駆者ガイド型"', new: '"先駆者として導くガイド型"' },
      { old: '"ディベーター型"', new: '"議論を展開するディベーター型"' },
      { old: '"堅実サポート型"', new: '"堅実に支援するサポート型"' },
      { old: '"理論重視の環境"', new: '"理論を重視する知的な環境"' },
      { old: '"極端な競争環境"', new: '"極端に競争的な厳しい環境"' },
      { old: '"包括リーダー型"', new: '"全体を包括するリーダー型"' },
      { old: '"ビジョン提示型"', new: '"ビジョンを提示する先見型"' },
      { old: '"ミニマリスト型"', new: '"最小限を追求するミニマリスト型"' },
      { old: '"安全第一の環境"', new: '"安全を最優先する慎重な環境"' },
      { old: '"家族愛エンジン"', new: '"家族愛が原動力となるエンジン"' },
      { old: '"縁結びエンジン"', new: '"縁を結ぶ力となるエンジン"' },
      { old: '"コミュニティ型"', new: '"コミュニティを重視する協調型"' },
      { old: '"個人主義的環境"', new: '"個人を重視する個人主義的環境"' },
      { old: '"クリエイター型"', new: '"創造力豊かなクリエイター型"' }
    ];
    
    // 修正を適用
    let totalFixCount = 0;
    const appliedFixes = [];
    
    console.log('残りの修正を適用中...\n');
    
    for (const fix of fixes) {
      // 卦名と完全一致する場合はスキップ
      const cleanText = fix.old.replace(/"/g, '');
      if (hexagramNames.has(cleanText)) {
        console.log(`⏭️ スキップ（卦名）: ${fix.old}`);
        continue;
      }
      
      const regex = new RegExp(fix.old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const matches = content.match(regex);
      if (matches) {
        content = content.replace(regex, fix.new);
        totalFixCount += matches.length;
        appliedFixes.push({
          old: fix.old,
          new: fix.new,
          count: matches.length
        });
        console.log(`✅ ${fix.old} → ${fix.new} (${matches.length}箇所)`);
      }
    }
    
    // ファイル保存
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`\n=== 修正完了 ===`);
    console.log(`総修正件数: ${totalFixCount}件`);
    console.log(`修正項目数: ${appliedFixes.length}種類`);
    
    console.log('\n📝 修正済みファイル: ./public/js/data/hexagram-human-traits-v3.js');
    console.log(`📁 バックアップ: hexagram-human-traits-v3.backup.remaining.${timestamp}.js`);
    
  } catch (error) {
    console.error('エラー:', error);
  }
}

fixRemainingShortTexts();