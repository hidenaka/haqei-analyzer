import { readFile, writeFile } from 'fs/promises';

async function fixPhase4HowTo() {
  try {
    console.log('=== フェーズ4: howTo系フィールド修正（267件） ===\n');
    
    // データベース読み込み
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // howTo系の修正マッピング（一つ一つ丁寧に）
    const howToFixes = {
      // howToTalk.style（話し方のスタイル）
      '"明確で具体的な指示"': '"明確で具体的な指示を出して導く話し方"',
      '"慎重で確実な約束"': '"慎重に考えて確実な約束をする話し方"',
      '"温かく包み込む調子"': '"相手を温かく包み込むような優しい調子"',
      '"前向きで楽しい調子"': '"前向きで楽しい雰囲気を作る話し方"',
      '"理性的で説得力ある"': '"理性的で説得力のある論理的な話し方"',
      '"親密で心を開く話し方"': '"親密な雰囲気で心を開いて話す方法"',
      '"バランスの取れた話し方"': '"極端にならずバランスの取れた話し方"',
      '"理想と現実を織り交ぜて"': '"理想と現実を上手く織り交ぜて話す"',
      '"共感的で温かい話し方"': '"相手に共感を示す温かい話し方"',
      '"統合的で大局的な話し方"': '"全体を統合する大局的な視点の話し方"',
      '"謙虚で丁寧な話し方"': '"謙虚な姿勢で丁寧に話すスタイル"',
      '"楽しく明るい話し方"': '"楽しく明るい雰囲気を作る話し方"',
      '"相手に合わせる話し方"': '"相手のペースに合わせて話すスタイル"',
      '"改善提案型の話し方"': '"問題点と改善案を提案する話し方"',
      '"落ち着いた慎重な話し方"': '"落ち着いて慎重に言葉を選ぶ話し方"',
      '"観察と洞察を交えて"': '"観察と洞察を交えた深い話し方"',
      '"断定的で明確な話し方"': '"断定的で明確な結論を示す話し方"',
      '"美しく洗練された話し方"': '"美しく洗練された言葉選びの話し方"',
      '"シンプルで簡潔な話し方"': '"シンプルで簡潔に要点を伝える話し方"',
      '"立ち直りを促す話し方"': '"相手の立ち直りを促す励ましの話し方"',
      '"素直でストレートな話し方"': '"素直でストレートに思いを伝える話し方"',
      '"知識と経験を交えて"': '"豊富な知識と経験を交えて話す方法"',
      '"健康と生活を中心に"': '"健康と生活の観点から話すスタイル"',
      '"チャレンジ精神を刺激"': '"相手のチャレンジ精神を刺激する話し方"',
      '"感情的で情熱的な話し方"': '"感情を込めた情熱的な話し方"',
      '"感覚的で繊細な話し方"': '"感覚的で繊細なニュアンスを伝える話し方"',
      '"一貫性のある話し方"': '"一貫性を保った安定感のある話し方"',
      '"必要最小限の話し方"': '"必要最小限に留める控えめな話し方"',
      '"力強く説得力のある話し方"': '"力強く説得力を持って話すスタイル"',
      '"目標と成果を中心に"': '"目標と成果を中心に話を展開する"',
      '"控えめで謙虚な話し方"': '"控えめで謙虚な姿勢を保つ話し方"',
      '"家族的で親しみやすい"': '"家族的で親しみやすい雰囲気の話し方"',
      '"独自の視点から話す"': '"独自の視点から物事を語るスタイル"',
      '"忍耐強く粘り強い話し方"': '"忍耐強く粘り強く説得する話し方"',
      '"解放的で自由な話し方"': '"解放的で自由な雰囲気を作る話し方"',
      '"奉仕的で献身的な話し方"': '"奉仕的で献身的な姿勢の話し方"',
      '"価値を増幅させる話し方"': '"相手の価値を増幅させる話し方"',
      '"決断的で明確な話し方"': '"決断的で明確な方向性を示す話し方"',
      '"縁を大切にする話し方"': '"人との縁を大切にする話し方"',
      '"集団を意識した話し方"': '"集団全体を意識した包括的な話し方"',
      '"成長を促す話し方"': '"相手の成長を促す建設的な話し方"',
      '"困難を共有する話し方"': '"困難を共有して共感を得る話し方"',
      '"供給的で与える話し方"': '"惜しみなく与える供給的な話し方"',
      '"変革的で刺激的な話し方"': '"変革を促す刺激的な話し方"',
      '"創造的で新鮮な話し方"': '"創造的で新鮮な視点を提供する話し方"',
      '"衝撃的でインパクトのある"': '"衝撃的でインパクトのある話し方"',
      '"不動で安定感のある話し方"': '"不動の安定感を持った話し方"',
      '"段階的で着実な話し方"': '"段階的に着実に説明する話し方"',
      '"調和を重視する話し方"': '"人と人の調和を重視する話し方"',
      '"豊かで充実した話し方"': '"豊かで充実した内容を伝える話し方"',
      '"旅人のような自由な話し方"': '"旅人のような自由な視点の話し方"',
      '"浸透力のある話し方"': '"じわじわと浸透する影響力のある話し方"',
      '"喜びと楽しさ中心の話し方"': '"喜びと楽しさを中心にした話し方"',
      '"溶かすような柔らかい話し方"': '"固さを溶かす柔らかい話し方"',
      '"節度を持った話し方"': '"節度を持って適切に話すスタイル"',
      '"信頼を基盤にした話し方"': '"信頼関係を基盤にした話し方"',
      '"慎重で確認的な話し方"': '"慎重に確認しながら進める話し方"',
      '"完成を目指す話し方"': '"物事の完成を目指す話し方"',
      '"未来志向の話し方"': '"常に未来を見据えた話し方"',
      
      // howToTalk.goodAt（得意な話し方）
      '"実践指導、現場対応"': '"実践的な指導と現場での対応が得意"',
      '"論理的説明、公正な判断"': '"論理的な説明と公正な判断が得意"',
      '"チーム作り、協力要請"': '"チームを作り協力を要請することが得意"',
      '"親密な関係構築"': '"親密な関係を構築することが得意"',
      '"調和的な対話"': '"調和的な対話を進めることが得意"',
      '"変革的な提案"': '"変革的な提案をすることが得意"',
      '"感情的な共感"': '"感情的な共感を示すことが得意"',
      '"統合的な説明"': '"統合的な説明をすることが得意"',
      '"控えめな助言"': '"控えめな助言をすることが得意"',
      '"楽しい雰囲気作り"': '"楽しい雰囲気を作ることが得意"',
      '"相手への適応"': '"相手に適応することが得意"',
      '"問題解決の提案"': '"問題解決の提案をすることが得意"',
      '"慎重な計画立案"': '"慎重な計画を立案することが得意"',
      '"全体像の説明"': '"全体像を説明することが得意"',
      '"素早い決断の伝達"': '"素早い決断を伝えることが得意"',
      '"美的な表現"': '"美的な表現をすることが得意"',
      '"要点の整理"': '"要点を整理することが得意"',
      '"励ましと応援"': '"励ましと応援をすることが得意"',
      '"正直な意見表明"': '"正直な意見を表明することが得意"',
      '"知識の共有"': '"知識を共有することが得意"',
      '"健康アドバイス"': '"健康に関するアドバイスが得意"',
      '"挑戦への誘い"': '"挑戦へ誘うことが得意"',
      '"情熱的な説得"': '"情熱的に説得することが得意"',
      '"繊細な配慮"': '"繊細な配慮をすることが得意"',
      '"長期的な約束"': '"長期的な約束をすることが得意"',
      '"撤退の判断"': '"撤退の判断を伝えることが得意"',
      '"力強い激励"': '"力強く激励することが得意"',
      '"成果の報告"': '"成果を報告することが得意"',
      '"内面の共有"': '"内面を共有することが得意"',
      '"家族的な相談"': '"家族的な雰囲気で相談に乗ることが得意"',
      '"独自の見解"': '"独自の見解を述べることが得意"',
      '"忍耐強い説明"': '"忍耐強く説明することが得意"',
      '"自由な発想"': '"自由な発想を伝えることが得意"',
      '"献身的な支援"': '"献身的に支援することが得意"',
      '"価値の増幅"': '"価値を増幅させることが得意"',
      '"明確な指示"': '"明確な指示を出すことが得意"',
      '"人脈の紹介"': '"人脈を紹介することが得意"',
      '"集団の統率"': '"集団を統率することが得意"',
      '"成長の促進"': '"成長を促進することが得意"',
      '"困難の共有"': '"困難を共有することが得意"',
      '"資源の提供"': '"資源を提供することが得意"',
      '"変革の提案"': '"変革を提案することが得意"',
      '"創造的な発想"': '"創造的な発想を伝えることが得意"',
      '"衝撃的な発言"': '"衝撃的な発言で印象を残すことが得意"',
      '"安定感の提供"': '"安定感を提供することが得意"',
      '"段階的な説明"': '"段階的に説明することが得意"',
      '"関係の調整"': '"関係を調整することが得意"',
      '"豊かさの共有"': '"豊かさを共有することが得意"',
      '"自由な語り"': '"自由に語ることが得意"',
      '"柔軟な対応"': '"柔軟に対応することが得意"',
      '"喜びの表現"': '"喜びを表現することが得意"',
      '"緊張の緩和"': '"緊張を緩和することが得意"',
      '"適切な調整"': '"適切に調整することが得意"',
      '"信頼の構築"': '"信頼を構築することが得意"',
      '"慎重な確認"': '"慎重に確認することが得意"',
      '"完成への導き"': '"完成へ導くことが得意"',
      '"未来の展望"': '"未来の展望を語ることが得意"',
      
      // howToTalk.notGoodAt（苦手な話し方）
      '"理論説明、長い会議"': '"理論的な説明や長い会議が苦手"',
      '"感情的な話、主観的判断"': '"感情的な話や主観的判断が苦手"',
      '"対立的な議論"': '"対立的な議論をすることが苦手"',
      '"表面的な社交"': '"表面的な社交をすることが苦手"',
      '"即興、大胆な提案"': '"即興や大胆な提案をすることが苦手"',
      '"極端な意見"': '"極端な意見を言うことが苦手"',
      '"現状維持の話"': '"現状維持の話をすることが苦手"',
      '"論理的な議論"': '"論理的な議論をすることが苦手"',
      '"細部の説明"': '"細部を説明することが苦手"',
      '"自己主張"': '"自己主張をすることが苦手"',
      '"深刻な話題"': '"深刻な話題を扱うことが苦手"',
      '"主体的な提案"': '"主体的な提案をすることが苦手"',
      '"表面的な議論"': '"表面的な議論をすることが苦手"',
      '"即断即決"': '"即断即決することが苦手"',
      '"現場の詳細"': '"現場の詳細を説明することが苦手"',
      '"長期的な計画"': '"長期的な計画を語ることが苦手"',
      '"実質的な内容"': '"実質的な内容を話すことが苦手"',
      '"詳細な説明"': '"詳細な説明をすることが苦手"',
      '"否定的な話"': '"否定的な話をすることが苦手"',
      '"複雑な議論"': '"複雑な議論をすることが苦手"',
      '"抽象的な理論"': '"抽象的な理論を説明することが苦手"',
      '"精神論"': '"精神論を語ることが苦手"',
      '"安全な選択"': '"安全な選択を勧めることが苦手"',
      '"冷静な分析"': '"冷静な分析をすることが苦手"',
      '"深い感情表現"': '"深い感情を表現することが苦手"',
      '"変化の話題"': '"変化の話題を扱うことが苦手"',
      '"対立的な場面"': '"対立的な場面で話すことが苦手"',
      '"弱さの表現"': '"弱さを表現することが苦手"',
      '"表面的な話"': '"表面的な話をすることが苦手"',
      '"感情の共有"': '"感情を共有することが苦手"',
      '"集団の話"': '"集団の話をすることが苦手"',
      '"一人での決断"': '"一人で決断することが苦手"',
      '"表面的な付き合い"': '"表面的な付き合いをすることが苦手"',
      '"他者への依存"': '"他者へ依存することが苦手"',
      '"利己的な話"': '"利己的な話をすることが苦手"',
      '"控えめな表現"': '"控えめな表現をすることが苦手"',
      '"曖昧な話"': '"曖昧な話をすることが苦手"',
      '"深い関わり"': '"深く関わることが苦手"',
      '"個人の話"': '"個人的な話をすることが苦手"',
      '"急な変更"': '"急な変更を伝えることが苦手"',
      '"表面的な理解"': '"表面的な理解で話すことが苦手"',
      '"制限の話"': '"制限の話をすることが苦手"',
      '"破壊的な話"': '"破壊的な話をすることが苦手"',
      '"保守的な話"': '"保守的な話をすることが苦手"',
      '"長い説明"': '"長い説明をすることが苦手"',
      '"感情論"': '"感情論を展開することが苦手"',
      '"詳細な計画"': '"詳細な計画を説明することが苦手"',
      '"規則の話"': '"規則の話をすることが苦手"',
      '"制限的な話"': '"制限的な話をすることが苦手"',
      '"定住の話"': '"定住の話をすることが苦手"',
      '"固定的な話"': '"固定的な話をすることが苦手"',
      '"悲観的な話"': '"悲観的な話をすることが苦手"',
      '"対立の話"': '"対立の話をすることが苦手"',
      '"厳格な話"': '"厳格な話をすることが苦手"',
      '"表面的な信頼"': '"表面的な信頼関係の話が苦手"',
      '"曖昧な確認"': '"曖昧な確認をすることが苦手"',
      '"未完成の話"': '"未完成の話をすることが苦手"',
      '"過去の話"': '"過去の話をすることが苦手"'
    };
    
    // バックアップ作成
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase4.${timestamp}.js`, content);
    console.log(`📁 バックアップ作成: hexagram-human-traits-v3.backup.phase4.${timestamp}.js\n`);
    
    // 修正適用
    let fixCount = 0;
    Object.entries(howToFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const originalContent = content;
      content = content.replace(regex, newText);
      if (originalContent !== content) {
        fixCount++;
        console.log(`✅ ${old} → ${newText}`);
      }
    });
    
    // ファイル保存
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`\n=== フェーズ4完了 ===`);
    console.log(`修正件数: ${fixCount}件`);
    console.log(`\n次のステップ: node fix-short-descriptions-phase5.mjs`);
    
  } catch (error) {
    console.error('エラー:', error);
  }
}

fixPhase4HowTo();