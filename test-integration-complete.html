<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEIçµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ - å®Œå…¨ç‰ˆ</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid #4CAF50;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
        }
        .btn-primary { background: #2196F3; color: white; }
        .btn-success { background: #4CAF50; color: white; }
        .btn-warning { background: #FF9800; color: white; }
        .btn-danger { background: #f44336; color: white; }
        .btn-info { background: #00BCD4; color: white; }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            border-left: 4px solid #2196F3;
        }
        .success { color: #4CAF50; font-weight: bold; }
        .warning { color: #FF9800; font-weight: bold; }
        .error { color: #f44336; font-weight: bold; }
        .info { color: #00BCD4; }
        
        .status-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .status-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ HAQEIçµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h1>
            <p>SimpleStorageManager + DataFlowMonitor + SimpleHooks å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆ</p>
        </div>

        <div class="test-section">
            <h2>ğŸ“¦ 1. ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</h2>
            <div class="button-group">
                <button class="btn-primary" onclick="initializeAllSystems()">å…¨ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–</button>
                <button class="btn-info" onclick="checkSystemStatus()">ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª</button>
                <button class="btn-warning" onclick="clearAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ’¾ 2. ãƒ‡ãƒ¼ã‚¿æ“ä½œãƒ†ã‚¹ãƒˆ</h2>
            <div class="button-group">
                <button class="btn-success" onclick="testDataSaveLoad()">ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn-success" onclick="testTripleOSData()">Triple OSãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn-warning" onclick="simulateDataCorruption()">ãƒ‡ãƒ¼ã‚¿ç ´æã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
                <button class="btn-info" onclick="testDataRecovery()">è‡ªå‹•å¾©æ—§ãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ” 3. ç›£è¦–ãƒ»Hooksãƒ†ã‚¹ãƒˆ</h2>
            <div class="button-group">
                <button class="btn-primary" onclick="startMonitoring()">ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹</button>
                <button class="btn-danger" onclick="stopMonitoring()">ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ åœæ­¢</button>
                <button class="btn-info" onclick="testHooksSystem()">Hooksã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn-warning" onclick="triggerPerformanceTest()">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª 4. E2Eçµ±åˆãƒ†ã‚¹ãƒˆ</h2>
            <div class="button-group">
                <button class="btn-success" onclick="runFullIntegrationTest()">å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆ</button>
                <button class="btn-info" onclick="generateTestReport()">ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
                <button class="btn-primary" onclick="simulateUserFlow()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
            </div>
        </div>

        <div class="status-panel">
            <div class="status-card">
                <h3>ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</h3>
                <div class="status-value" id="system-status">ğŸŸ¡ åˆæœŸåŒ–ä¸­</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="system-progress" style="width: 0%"></div>
                </div>
            </div>
            <div class="status-card">
                <h3>ãƒ‡ãƒ¼ã‚¿æ“ä½œ</h3>
                <div class="status-value" id="data-operations">0</div>
                <p>å®Ÿè¡Œã•ã‚ŒãŸæ“ä½œæ•°</p>
            </div>
            <div class="status-card">
                <h3>ã‚¨ãƒ©ãƒ¼æ¤œå‡º</h3>
                <div class="status-value" id="errors-detected">0</div>
                <p>æ¤œå‡ºãƒ»ä¿®å¾©ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼æ•°</p>
            </div>
            <div class="status-card">
                <h3>ç›£è¦–æ™‚é–“</h3>
                <div class="status-value" id="monitoring-time">0ç§’</div>
                <p>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç›£è¦–æ™‚é–“</p>
            </div>
        </div>

        <div id="output" class="log"></div>
    </div>

    <!-- å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ -->
    <script src="./js/shared/core/SimpleStorageManager.js"></script>
    <script src="./js/shared/utils/DataFlowMonitor.js"></script>
    <script src="./js/shared/utils/SimpleHooks.js"></script>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let simpleStorage = null;
        let dataMonitor = null;
        let hooksSystem = null;
        let testStartTime = Date.now();
        let statistics = {
            dataOperations: 0,
            errorsDetected: 0,
            testsRun: 0,
            successRate: 0
        };

        // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            
            div.className = `log-entry ${type}`;
            div.innerHTML = `<span style="opacity: 0.7">[${timestamp}]</span> ${message}`;
            
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
            
            // çµ±è¨ˆæ›´æ–°
            updateStatistics();
        }

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStatistics() {
            document.getElementById('data-operations').textContent = statistics.dataOperations;
            document.getElementById('errors-detected').textContent = statistics.errorsDetected;
            
            const monitoringTime = Math.floor((Date.now() - testStartTime) / 1000);
            document.getElementById('monitoring-time').textContent = `${monitoringTime}ç§’`;
        }

        // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        async function initializeAllSystems() {
            log('ğŸš€ çµ±åˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹...', 'info');
            
            try {
                // SimpleStorageManageråˆæœŸåŒ–
                simpleStorage = new SimpleStorageManager();
                log('âœ… SimpleStorageManageråˆæœŸåŒ–å®Œäº†', 'success');

                // DataFlowMonitoråˆæœŸåŒ–
                dataMonitor = new DataFlowMonitor({
                    monitorInterval: 1000,
                    enableAutoFix: true,
                    enableConsoleLog: false // ãƒšãƒ¼ã‚¸å†…ãƒ­ã‚°ã‚’ä½¿ç”¨
                });
                log('âœ… DataFlowMonitoråˆæœŸåŒ–å®Œäº†', 'success');

                // SimpleHooksåˆæœŸåŒ–
                hooksSystem = new SimpleHooks({
                    enableDataFlowHooks: true,
                    enablePerformanceHooks: true,
                    enableErrorHooks: true,
                    enableAutoRecovery: true,
                    logLevel: 'info'
                });
                
                // æ¨™æº–ãƒ•ãƒƒã‚¯ã®è¨­å®š
                hooksSystem.setupStandardHooks();
                log('âœ… SimpleHooksåˆæœŸåŒ–ãƒ»æ¨™æº–ãƒ•ãƒƒã‚¯è¨­å®šå®Œäº†', 'success');

                // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹æ›´æ–°
                document.getElementById('system-status').textContent = 'ğŸŸ¢ æ­£å¸¸ç¨¼åƒ';
                document.getElementById('system-progress').style.width = '100%';

                log('ğŸ‰ å…¨ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†ï¼', 'success');
                
            } catch (error) {
                log(`âŒ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                document.getElementById('system-status').textContent = 'ğŸ”´ ã‚¨ãƒ©ãƒ¼';
                statistics.errorsDetected++;
            }
        }

        // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª
        function checkSystemStatus() {
            log('ğŸ” ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèªä¸­...', 'info');
            
            const status = {
                simpleStorage: !!simpleStorage,
                dataMonitor: !!dataMonitor,
                hooksSystem: !!hooksSystem,
                localStorage: typeof(Storage) !== 'undefined'
            };

            log(`ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹:`, 'info');
            Object.entries(status).forEach(([key, value]) => {
                log(`  - ${key}: ${value ? 'âœ… OK' : 'âŒ NG'}`, value ? 'success' : 'error');
            });

            if (hooksSystem) {
                const hookStats = hooksSystem.getStatistics();
                log(`ğŸ“ˆ Hooksçµ±è¨ˆ: å®Ÿè¡Œ${hookStats.hookExecutions}å›, ã‚¨ãƒ©ãƒ¼${hookStats.errorsHandled}å›`, 'info');
            }

            if (dataMonitor && dataMonitor.lastSnapshot) {
                const snapshot = dataMonitor.lastSnapshot;
                log(`ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ç›£è¦–: ã‚­ãƒ¼${Object.keys(snapshot.keys).length}å€‹, ã‚µã‚¤ã‚º${snapshot.totalSize}ãƒã‚¤ãƒˆ`, 'info');
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        async function testDataSaveLoad() {
            if (!simpleStorage) {
                log('âŒ SimpleStorageManagerãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }

            log('ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆé–‹å§‹...', 'info');

            const testData = {
                engineOS: {
                    name: "ä¾¡å€¤è¦³ã‚·ã‚¹ãƒ†ãƒ ",
                    hexagram: { id: 1, name: "ä¹¾", symbol: "â˜°" },
                    score: 85,
                    confidence: 0.92
                },
                interfaceOS: {
                    name: "ç¤¾ä¼šçš„ã‚·ã‚¹ãƒ†ãƒ ",
                    hexagram: { id: 14, name: "å¤§æœ‰", symbol: "â˜²" },
                    score: 72,
                    confidence: 0.88
                },
                safeModeOS: {
                    name: "é˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ ",
                    hexagram: { id: 23, name: "å‰¥", symbol: "â˜¶" },
                    score: 68,
                    confidence: 0.85
                },
                timestamp: Date.now(),
                testFlag: true
            };

            try {
                // ä¿å­˜ãƒ†ã‚¹ãƒˆ
                const saveResult = simpleStorage.saveAnalysisResult(testData);
                statistics.dataOperations++;
                
                if (saveResult) {
                    log('âœ… ãƒ‡ãƒ¼ã‚¿ä¿å­˜æˆåŠŸ', 'success');
                } else {
                    log('âŒ ãƒ‡ãƒ¼ã‚¿ä¿å­˜å¤±æ•—', 'error');
                    statistics.errorsDetected++;
                    return;
                }

                // èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
                const loadedData = simpleStorage.getAnalysisResult();
                statistics.dataOperations++;

                if (loadedData && loadedData.testFlag) {
                    log('âœ… ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ', 'success');
                    log(`ğŸ“Š èª­ã¿è¾¼ã¿ãƒ‡ãƒ¼ã‚¿: engineOS="${loadedData.engineOS?.name}", interfaceOS="${loadedData.interfaceOS?.name}", safeModeOS="${loadedData.safeModeOS?.name}"`, 'info');
                } else {
                    log('âŒ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—ã¾ãŸã¯ä¸å®Œå…¨', 'error');
                    statistics.errorsDetected++;
                }

                // Triple OSæ§‹é€ æ¤œè¨¼
                if (loadedData && loadedData.engineOS && loadedData.interfaceOS && loadedData.safeModeOS) {
                    log('âœ… Triple OSæ§‹é€ ç¢ºèªOK', 'success');
                } else {
                    log('âš ï¸ Triple OSæ§‹é€ ä¸å®Œå…¨', 'warning');
                }

            } catch (error) {
                log(`âŒ ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                statistics.errorsDetected++;
            }
        }

        // Triple OSãƒ‡ãƒ¼ã‚¿ç‰¹åŒ–ãƒ†ã‚¹ãƒˆ
        async function testTripleOSData() {
            log('ğŸ§  Triple OSãƒ‡ãƒ¼ã‚¿ç‰¹åŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹...', 'info');

            const tripleOSTestCases = [
                {
                    name: "å®Œå…¨ãªTriple OSãƒ‡ãƒ¼ã‚¿",
                    data: {
                        engineOS: { name: "Engine", score: 90 },
                        interfaceOS: { name: "Interface", score: 80 },
                        safeModeOS: { name: "SafeMode", score: 70 }
                    }
                },
                {
                    name: "ä¸å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ï¼ˆSafeModeOSæ¬ å¦‚ï¼‰",
                    data: {
                        engineOS: { name: "Engine", score: 90 },
                        interfaceOS: { name: "Interface", score: 80 }
                    }
                },
                {
                    name: "ç©ºã®ãƒ‡ãƒ¼ã‚¿",
                    data: {}
                }
            ];

            for (const testCase of tripleOSTestCases) {
                log(`ğŸ§ª ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: ${testCase.name}`, 'info');
                
                const saveResult = simpleStorage.saveAnalysisResult(testCase.data);
                const loadResult = simpleStorage.getAnalysisResult();
                
                const isValidTripleOS = loadResult && 
                    loadResult.engineOS && 
                    loadResult.interfaceOS && 
                    loadResult.safeModeOS;

                if (isValidTripleOS) {
                    log(`âœ… ${testCase.name}: Triple OSæ§‹é€ æ­£å¸¸`, 'success');
                } else {
                    log(`âš ï¸ ${testCase.name}: Triple OSæ§‹é€ ç•°å¸¸ï¼ˆæœŸå¾…é€šã‚Šï¼‰`, 'warning');
                }

                statistics.dataOperations += 2;
            }
        }

        // ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹
        function startMonitoring() {
            if (!dataMonitor) {
                log('âŒ DataFlowMonitorãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }

            log('ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ç›£è¦–é–‹å§‹...', 'info');
            
            const result = dataMonitor.startMonitoring();
            if (result) {
                log('âœ… ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹æˆåŠŸ', 'success');
                
                // å®šæœŸçš„ãªç›£è¦–çŠ¶æ…‹æ›´æ–°
                setInterval(() => {
                    if (dataMonitor.isMonitoring) {
                        const snapshot = dataMonitor.takeSnapshot();
                        log(`ğŸ“Š ç›£è¦–ä¸­: ${Object.keys(snapshot.keys).length}ã‚­ãƒ¼, ${snapshot.totalSize}ãƒã‚¤ãƒˆ`, 'info');
                    }
                }, 5000);
            } else {
                log('âŒ ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹å¤±æ•—', 'error');
                statistics.errorsDetected++;
            }
        }

        // ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ åœæ­¢
        function stopMonitoring() {
            if (!dataMonitor || !dataMonitor.isMonitoring) {
                log('âš ï¸ ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã¯ç¨¼åƒã—ã¦ã„ã¾ã›ã‚“', 'warning');
                return;
            }

            log('ğŸ›‘ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ç›£è¦–åœæ­¢...', 'info');
            dataMonitor.stopMonitoring();
            log('âœ… ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ åœæ­¢å®Œäº†', 'success');
        }

        // Hooksã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
        async function testHooksSystem() {
            if (!hooksSystem) {
                log('âŒ SimpleHooksãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }

            log('ğŸ”— Hooksã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...', 'info');

            // ãƒ†ã‚¹ãƒˆç”¨ãƒ•ãƒƒã‚¯ã®è¿½åŠ 
            hooksSystem.addHook('beforeDataSave', async (context) => {
                log(`ğŸ”— ãƒ•ãƒƒã‚¯å®Ÿè¡Œ: ãƒ‡ãƒ¼ã‚¿ä¿å­˜å‰ (${context.method})`, 'info');
                return { hookExecuted: true };
            }, 50);

            hooksSystem.addHook('afterDataSave', async (context) => {
                log(`ğŸ”— ãƒ•ãƒƒã‚¯å®Ÿè¡Œ: ãƒ‡ãƒ¼ã‚¿ä¿å­˜å¾Œ (çµæœ: ${context.result})`, 'info');
                return { hookExecuted: true };
            }, 50);

            // StorageManagerã«ãƒ•ãƒƒã‚¯ã‚’é©ç”¨
            const instrumentedStorage = hooksSystem.instrumentStorageManager(simpleStorage);

            // ãƒ•ãƒƒã‚¯ä»˜ãã§ãƒ‡ãƒ¼ã‚¿æ“ä½œ
            const testData = {
                engineOS: { name: "Hooks Test Engine", score: 95 },
                interfaceOS: { name: "Hooks Test Interface", score: 85 },
                safeModeOS: { name: "Hooks Test SafeMode", score: 75 },
                hooksTest: true
            };

            try {
                await instrumentedStorage.saveAnalysisResult(testData);
                const result = await instrumentedStorage.getAnalysisResult();
                
                if (result && result.hooksTest) {
                    log('âœ… Hooksã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆæˆåŠŸ', 'success');
                } else {
                    log('âŒ Hooksã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå¤±æ•—', 'error');
                    statistics.errorsDetected++;
                }

                // çµ±è¨ˆç¢ºèª
                const hookStats = hooksSystem.getStatistics();
                log(`ğŸ“ˆ Hooksçµ±è¨ˆ: å®Ÿè¡Œ${hookStats.hookExecutions}å›, ã‚¨ãƒ©ãƒ¼ç‡${hookStats.errorRate}%`, 'info');

            } catch (error) {
                log(`âŒ Hooksãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                statistics.errorsDetected++;
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ç ´æã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        function simulateDataCorruption() {
            log('ğŸ’¥ ãƒ‡ãƒ¼ã‚¿ç ´æã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆå®Ÿè¡Œ...', 'warning');

            // ä¸æ­£ãªJSONãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥localStorageæ³¨å…¥
            localStorage.setItem('haqei_analysis_result', '{"invalid": json data}');
            localStorage.setItem('haqei_emergency_result', 'completely broken data');

            log('ğŸ’¥ ä¸æ­£ãƒ‡ãƒ¼ã‚¿æ³¨å…¥å®Œäº†', 'warning');
            log('ğŸ”§ è‡ªå‹•å¾©æ—§æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„', 'info');
            
            statistics.errorsDetected++;
        }

        // è‡ªå‹•å¾©æ—§ãƒ†ã‚¹ãƒˆ
        async function testDataRecovery() {
            log('ğŸš‘ è‡ªå‹•å¾©æ—§ãƒ†ã‚¹ãƒˆé–‹å§‹...', 'info');

            try {
                if (!simpleStorage) {
                    throw new Error('SimpleStorageManagerãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }

                // æ­£å¸¸ãªãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ—¦ä¿å­˜
                const backupData = {
                    engineOS: { name: "Recovery Test Engine", score: 88 },
                    interfaceOS: { name: "Recovery Test Interface", score: 78 },
                    safeModeOS: { name: "Recovery Test SafeMode", score: 68 },
                    recoveryTest: true
                };

                simpleStorage.saveAnalysisResult(backupData);
                log('ğŸ“¦ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ä¿å­˜å®Œäº†', 'info');

                // ãƒ‡ãƒ¼ã‚¿ã‚’æ„å›³çš„ã«ç ´æ
                localStorage.setItem('haqei_analysis_result', 'corrupted');
                log('ğŸ’¥ ãƒ‡ãƒ¼ã‚¿ç ´æã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆå®Œäº†', 'warning');

                // å¾©æ—§è©¦è¡Œ
                const recoveredData = simpleStorage.getAnalysisResult();

                if (recoveredData && recoveredData.recoveryTest) {
                    log('âœ… è‡ªå‹•å¾©æ—§æˆåŠŸï¼', 'success');
                    log(`ğŸ“Š å¾©æ—§ãƒ‡ãƒ¼ã‚¿: ${recoveredData.engineOS?.name}`, 'info');
                } else {
                    log('âŒ è‡ªå‹•å¾©æ—§å¤±æ•—', 'error');
                    statistics.errorsDetected++;
                }

            } catch (error) {
                log(`âŒ å¾©æ—§ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                statistics.errorsDetected++;
            }
        }

        // å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆ
        async function runFullIntegrationTest() {
            log('ğŸ§ª å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹...', 'info');
            statistics.testsRun++;

            const testSequence = [
                { name: 'åˆæœŸåŒ–', func: initializeAllSystems },
                { name: 'ãƒ‡ãƒ¼ã‚¿æ“ä½œ', func: testDataSaveLoad },
                { name: 'Triple OS', func: testTripleOSData },
                { name: 'Hooks', func: testHooksSystem },
                { name: 'å¾©æ—§', func: testDataRecovery }
            ];

            let passed = 0;
            const startTime = Date.now();

            for (const test of testSequence) {
                try {
                    log(`ğŸ¯ å®Ÿè¡Œä¸­: ${test.name}ãƒ†ã‚¹ãƒˆ`, 'info');
                    await test.func();
                    passed++;
                    log(`âœ… ${test.name}ãƒ†ã‚¹ãƒˆå®Œäº†`, 'success');
                } catch (error) {
                    log(`âŒ ${test.name}ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    statistics.errorsDetected++;
                }

                // å°‘ã—å¾…æ©Ÿ
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            const duration = Date.now() - startTime;
            const successRate = Math.round((passed / testSequence.length) * 100);
            statistics.successRate = successRate;

            log(`ğŸ‰ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†ï¼`, 'success');
            log(`ğŸ“Š çµæœ: ${passed}/${testSequence.length}æˆåŠŸ (${successRate}%), å®Ÿè¡Œæ™‚é–“: ${duration}ms`, 'info');

            if (successRate >= 80) {
                document.getElementById('system-status').textContent = 'ğŸŸ¢ çµ±åˆãƒ†ã‚¹ãƒˆåˆæ ¼';
            } else {
                document.getElementById('system-status').textContent = 'ğŸŸ¡ éƒ¨åˆ†çš„æˆåŠŸ';
            }
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        function clearAllData() {
            log('ğŸ§¹ å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢å®Ÿè¡Œ...', 'warning');
            
            if (simpleStorage) {
                simpleStorage.clearAll();
                log('âœ… SimpleStorageManager ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢å®Œäº†', 'success');
            }

            // æ‰‹å‹•ã§ã‚‚å¿µã®ãŸã‚ã‚¯ãƒªã‚¢
            const keysToRemove = Object.keys(localStorage).filter(key => 
                key.includes('haqei') || key.includes('simple_storage')
            );
            
            keysToRemove.forEach(key => localStorage.removeItem(key));
            
            log(`ğŸ§¹ ${keysToRemove.length}å€‹ã®localStorageã‚­ãƒ¼ã‚’å‰Šé™¤`, 'info');
            log('âœ… å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢å®Œäº†', 'success');
        }

        // ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        function generateTestReport() {
            log('ğŸ“‹ ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­...', 'info');

            const report = {
                timestamp: new Date().toISOString(),
                testDuration: Date.now() - testStartTime,
                statistics: statistics,
                systemStatus: {
                    simpleStorage: !!simpleStorage,
                    dataMonitor: !!dataMonitor,
                    hooksSystem: !!hooksSystem
                }
            };

            if (hooksSystem) {
                report.hooksStatistics = hooksSystem.getStatistics();
            }

            if (dataMonitor) {
                report.dataIntegrity = dataMonitor.checkDataIntegrity();
            }

            log('ğŸ“‹ === HAQEIçµ±åˆã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ ===', 'info');
            log(`â±ï¸ ãƒ†ã‚¹ãƒˆæœŸé–“: ${Math.round(report.testDuration / 1000)}ç§’`, 'info');
            log(`ğŸ”¢ ãƒ‡ãƒ¼ã‚¿æ“ä½œ: ${report.statistics.dataOperations}å›`, 'info');
            log(`âŒ ã‚¨ãƒ©ãƒ¼æ¤œå‡º: ${report.statistics.errorsDetected}å›`, 'info');
            log(`ğŸ§ª å®Ÿè¡Œãƒ†ã‚¹ãƒˆ: ${report.statistics.testsRun}å›`, 'info');
            log(`ğŸ“ˆ æˆåŠŸç‡: ${report.statistics.successRate}%`, report.statistics.successRate >= 80 ? 'success' : 'warning');

            if (report.hooksStatistics) {
                log(`ğŸ”— Hookså®Ÿè¡Œ: ${report.hooksStatistics.hookExecutions}å›`, 'info');
                log(`ğŸ”— å¾©æ—§ç‡: ${report.hooksStatistics.recoveryRate}%`, 'info');
            }

            log('ğŸ“‹ === ãƒ¬ãƒãƒ¼ãƒˆçµ‚äº† ===', 'info');

            // JSONã¨ã—ã¦ä¿å­˜ã‚‚å¯èƒ½
            console.log('ğŸ“‹ è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ:', report);
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        async function simulateUserFlow() {
            log('ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆé–‹å§‹...', 'info');

            const userActions = [
                'è¨ºæ–­é–‹å§‹',
                'è¨­å•å›ç­” (1/30)',
                'è¨­å•å›ç­” (15/30)',
                'è¨­å•å›ç­” (30/30)',
                'åˆ†æå®Ÿè¡Œ',
                'çµæœè¡¨ç¤º',
                'ãƒ‡ãƒ¼ã‚¿ä¿å­˜',
                'çµæœãƒšãƒ¼ã‚¸é·ç§»',
                'ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿',
                'è¡¨ç¤ºå®Œäº†'
            ];

            for (let i = 0; i < userActions.length; i++) {
                const action = userActions[i];
                log(`ğŸ‘¤ ${action}...`, 'info');

                // é€²æ—æ›´æ–°
                const progress = Math.round(((i + 1) / userActions.length) * 100);
                document.getElementById('system-progress').style.width = `${progress}%`;

                // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å¿œã˜ãŸå‡¦ç†
                if (action.includes('ãƒ‡ãƒ¼ã‚¿ä¿å­˜')) {
                    await testDataSaveLoad();
                } else if (action.includes('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿')) {
                    const result = simpleStorage?.getAnalysisResult();
                    if (result) {
                        log('âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ', 'success');
                    } else {
                        log('âš ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'warning');
                    }
                }

                await new Promise(resolve => setTimeout(resolve, 800));
            }

            log('ğŸ‰ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆå®Œäº†ï¼', 'success');
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®è‡ªå‹•åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ HAQEIçµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†', 'success');
            log('ğŸ’¡ "å…¨ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–"ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‹å§‹ã—ã¦ãã ã•ã„', 'info');
            
            // å®šæœŸçš„ãªçµ±è¨ˆæ›´æ–°
            setInterval(updateStatistics, 1000);
        });

    </script>
</body>
</html>