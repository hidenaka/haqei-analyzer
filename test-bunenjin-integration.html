<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bunenjinå“²å­¦çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: "Arial", sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .score {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        .score.high { color: #4CAF50; }
        .score.medium { color: #FF9800; }
        .score.low { color: #f44336; }
        .details {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .log {
            background: #e8e8e8;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #1976D2;
        }
        .progress {
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ­ bunenjinå“²å­¦çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
        <p>æ”¹å–„ã•ã‚ŒãŸbunenjinå“²å­¦æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>

        <div class="test-section">
            <h2>1. ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</h2>
            <button onclick="initializeTest()">ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–</button>
            <div id="init-results"></div>
        </div>

        <div class="test-section">
            <h2>2. Triple OSã‚¨ãƒ³ã‚¸ãƒ³æ¤œè¨¼</h2>
            <button onclick="testTripleOSEngine()">Triple OSã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆ</button>
            <div id="triple-os-results"></div>
        </div>

        <div class="test-section">
            <h2>3. bunenjinå“²å­¦æ•´åˆæ€§æ¤œè¨¼</h2>
            <button onclick="runBunenjinValidation()">bunenjinæ¤œè¨¼å®Ÿè¡Œ</button>
            <div id="bunenjin-results"></div>
        </div>

        <div class="test-section">
            <h2>4. çµ±åˆæ˜“çµŒæ­£çµ±æ€§æ¤œè¨¼</h2>
            <button onclick="runFullValidation()">å®Œå…¨æ¤œè¨¼å®Ÿè¡Œ</button>
            <div id="full-validation-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š å®Ÿè¡Œãƒ­ã‚°</h2>
            <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
            <div id="log" class="log"></div>
        </div>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ -->
    <script src="public/js/shared/data/DataManager.js"></script>
    <script src="public/js/os-analyzer/core/Calculator.js"></script>
    <script src="public/js/os-analyzer/core/IChingUltraSyncLogic.js"></script>
    <script src="public/js/os-analyzer/core/TripleOSEngine.js"></script>
    <script src="public/js/os-analyzer/validation/ClassicalIChingStandards.js"></script>
    <script src="public/js/os-analyzer/validation/IChingOrthodoxyValidator.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let dataManager = null;
        let tripleOSEngine = null;
        let validator = null;
        let testResults = {};

        // ãƒ­ã‚°æ©Ÿèƒ½
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log');
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logEntry.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚å‡ºåŠ›
            console.log(`[bunenjin-test] ${message}`);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
        async function initializeTest() {
            const resultsDiv = document.getElementById('init-results');
            resultsDiv.innerHTML = '<div class="progress">ğŸ”„ åˆæœŸåŒ–ä¸­...</div>';

            try {
                log('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚’é–‹å§‹...');

                // DataManageråˆæœŸåŒ–
                if (typeof DataManager !== 'undefined') {
                    dataManager = new DataManager();
                    await dataManager.initialize();
                    window.dataManager = dataManager;
                    log('âœ… DataManageråˆæœŸåŒ–å®Œäº†', 'success');
                } else {
                    throw new Error('DataManagerãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }

                // Triple OSEngineåˆæœŸåŒ–
                if (typeof TripleOSEngine !== 'undefined') {
                    tripleOSEngine = new TripleOSEngine(dataManager);
                    window.tripleOSEngine = tripleOSEngine;
                    log('âœ… TripleOSEngineåˆæœŸåŒ–å®Œäº†', 'success');
                } else {
                    throw new Error('TripleOSEngineãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }

                // ValidatoråˆæœŸåŒ–
                if (typeof IChingOrthodoxyValidator !== 'undefined') {
                    validator = new IChingOrthodoxyValidator();
                    window.validator = validator;
                    log('âœ… IChingOrthodoxyValidatoråˆæœŸåŒ–å®Œäº†', 'success');
                } else {
                    throw new Error('IChingOrthodoxyValidatorãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }

                resultsDiv.innerHTML = `
                    <div class="details">
                        <div class="score high">âœ… åˆæœŸåŒ–æˆåŠŸ</div>
                        <p>â€¢ DataManager: åˆæœŸåŒ–å®Œäº†</p>
                        <p>â€¢ TripleOSEngine: åˆæœŸåŒ–å®Œäº†</p>
                        <p>â€¢ IChingOrthodoxyValidator: åˆæœŸåŒ–å®Œäº†</p>
                    </div>
                `;

                testResults.initialization = true;
                log('ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');

            } catch (error) {
                log(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                resultsDiv.innerHTML = `
                    <div class="details">
                        <div class="score low">âŒ åˆæœŸåŒ–å¤±æ•—</div>
                        <p>ã‚¨ãƒ©ãƒ¼: ${error.message}</p>
                    </div>
                `;
                testResults.initialization = false;
            }
        }

        // Triple OSã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆ
        async function testTripleOSEngine() {
            const resultsDiv = document.getElementById('triple-os-results');
            resultsDiv.innerHTML = '<div class="progress">ğŸ”„ Triple OSã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆä¸­...</div>';

            try {
                if (!tripleOSEngine) {
                    throw new Error('TripleOSEngineãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }

                log('Triple OSã‚¨ãƒ³ã‚¸ãƒ³æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');

                // bunenjinå®Ÿè£…ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ
                const bunenjinData = tripleOSEngine.getBunenjinImplementationData();
                log(`bunenjinå®Ÿè£…ãƒ‡ãƒ¼ã‚¿å–å¾—: ${Object.keys(bunenjinData).length}é …ç›®`);

                // å®Ÿè£…å®Œäº†åº¦è¨ˆç®—ãƒ†ã‚¹ãƒˆ
                const completeness = tripleOSEngine.calculateBunenjinImplementationCompleteness();
                log(`å®Ÿè£…å®Œäº†åº¦: ${completeness.completenessPercentage}%`);

                const tripleOSScore = completeness.overallScore;
                const scoreClass = tripleOSScore >= 0.8 ? 'high' : tripleOSScore >= 0.6 ? 'medium' : 'low';

                resultsDiv.innerHTML = `
                    <div class="details">
                        <div class="score ${scoreClass}">ğŸ“Š Triple OSå®Ÿè£…ã‚¹ã‚³ã‚¢: ${Math.round(tripleOSScore * 100)}%</div>
                        <h4>ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚¹ã‚³ã‚¢:</h4>
                        ${Object.entries(completeness.categoryScores).map(([category, score]) => 
                            `<p>â€¢ ${category}: ${Math.round(score * 100)}%</p>`
                        ).join('')}
                        <h4>å®Ÿè£…çŠ¶æ³:</h4>
                        <p>â€¢ å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½: ${completeness.implementedFeatures}/${completeness.totalFeatures}</p>
                        <p>â€¢ Triple OSæ§‹é€ : ${bunenjinData.tripleOSStructure.hasEngineOS && bunenjinData.tripleOSStructure.hasInterfaceOS && bunenjinData.tripleOSStructure.hasSafeModeOS ? 'âœ…' : 'âŒ'}</p>
                        <p>â€¢ bunenjinå“²å­¦ã‚µãƒãƒ¼ãƒˆ: ${bunenjinData.bunenjinPhilosophy ? 'âœ…' : 'âŒ'}</p>
                        <p>â€¢ äººæ ¼åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½: ${bunenjinData.tripleOSStructure.allowsPersonalitySwitching ? 'âœ…' : 'âŒ'}</p>
                    </div>
                `;

                testResults.tripleOS = tripleOSScore;
                log(`ğŸ¯ Triple OSã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆå®Œäº†: ${Math.round(tripleOSScore * 100)}%`, 'success');

            } catch (error) {
                log(`âŒ Triple OSã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                resultsDiv.innerHTML = `
                    <div class="details">
                        <div class="score low">âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—</div>
                        <p>ã‚¨ãƒ©ãƒ¼: ${error.message}</p>
                    </div>
                `;
                testResults.tripleOS = 0;
            }
        }

        // bunenjinå“²å­¦æ•´åˆæ€§æ¤œè¨¼
        async function runBunenjinValidation() {
            const resultsDiv = document.getElementById('bunenjin-results');
            resultsDiv.innerHTML = '<div class="progress">ğŸ”„ bunenjinå“²å­¦æ¤œè¨¼ä¸­...</div>';

            try {
                if (!validator) {
                    throw new Error('IChingOrthodoxyValidatorãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }

                log('bunenjinå“²å­¦æ•´åˆæ€§æ¤œè¨¼ã‚’é–‹å§‹...');

                // å®Ÿè£…ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
                const implementationData = await validator.gatherImplementationData();
                log(`å®Ÿè£…ãƒ‡ãƒ¼ã‚¿åé›†å®Œäº†: ${Object.keys(implementationData).length}é …ç›®`);

                // bunenjinå“²å­¦æ¤œè¨¼ã®ã¿å®Ÿè¡Œ
                const bunenjinValidation = await validator.validateBunenjinPhilosophyAlignment();
                
                const bunenjinScore = bunenjinValidation.overallScore;
                const scoreClass = bunenjinScore >= 0.8 ? 'high' : bunenjinScore >= 0.6 ? 'medium' : 'low';

                resultsDiv.innerHTML = `
                    <div class="details">
                        <div class="score ${scoreClass}">ğŸ­ bunenjinå“²å­¦æ•´åˆæ€§: ${Math.round(bunenjinScore * 100)}%</div>
                        <h4>æ¤œè¨¼è©³ç´°:</h4>
                        <p>â€¢ åˆ†äººæ€æƒ³ã‚µãƒãƒ¼ãƒˆ: ${bunenjinValidation.dividedPerformanceSupport?.score ? Math.round(bunenjinValidation.dividedPerformanceSupport.score * 100) : 0}%</p>
                        <p>â€¢ çŠ¶æ³é©å¿œæ©Ÿèƒ½: ${bunenjinValidation.situationalAdaptation?.score ? Math.round(bunenjinValidation.situationalAdaptation.score * 100) : 0}%</p>
                        <p>â€¢ çœŸæ­£ãªå¤šé¢æ€§: ${bunenjinValidation.authenticMultiplicity?.score ? Math.round(bunenjinValidation.authenticMultiplicity.score * 100) : 0}%</p>
                        <p>â€¢ èª¿å’Œçš„çµ±åˆ: ${bunenjinValidation.harmoniousIntegration?.score ? Math.round(bunenjinValidation.harmoniousIntegration.score * 100) : 0}%</p>
                        
                        ${bunenjinValidation.issues && bunenjinValidation.issues.length > 0 ? `
                            <h4>ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ:</h4>
                            ${bunenjinValidation.issues.map(issue => `<p>âš ï¸ ${issue.criterion}: ${issue.error}</p>`).join('')}
                        ` : '<p>âœ… é‡è¦ãªå•é¡Œã¯ç™ºè¦‹ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</p>'}
                    </div>
                `;

                testResults.bunenjinValidation = bunenjinScore;
                log(`ğŸ¯ bunenjinå“²å­¦æ¤œè¨¼å®Œäº†: ${Math.round(bunenjinScore * 100)}%`, 'success');

            } catch (error) {
                log(`âŒ bunenjinå“²å­¦æ¤œè¨¼ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                resultsDiv.innerHTML = `
                    <div class="details">
                        <div class="score low">âŒ æ¤œè¨¼å¤±æ•—</div>
                        <p>ã‚¨ãƒ©ãƒ¼: ${error.message}</p>
                    </div>
                `;
                testResults.bunenjinValidation = 0;
            }
        }

        // å®Œå…¨æ˜“çµŒæ­£çµ±æ€§æ¤œè¨¼
        async function runFullValidation() {
            const resultsDiv = document.getElementById('full-validation-results');
            resultsDiv.innerHTML = '<div class="progress">ğŸ”„ å®Œå…¨æ¤œè¨¼å®Ÿè¡Œä¸­...</div>';

            try {
                if (!validator) {
                    throw new Error('IChingOrthodoxyValidatorãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }

                log('å®Œå…¨æ˜“çµŒæ­£çµ±æ€§æ¤œè¨¼ã‚’é–‹å§‹...');

                // å®Œå…¨æ¤œè¨¼å®Ÿè¡Œ
                const fullValidation = await validator.validateImplementation();
                
                const overallScore = fullValidation.overallAssessment?.overallScore || 0;
                const bunenjinScore = fullValidation.bunenjinAlignment?.overallScore || 0;
                
                const scoreClass = overallScore >= 0.8 ? 'high' : overallScore >= 0.6 ? 'medium' : 'low';
                const bunenjinClass = bunenjinScore >= 0.8 ? 'high' : bunenjinScore >= 0.6 ? 'medium' : 'low';

                // ã‚¹ã‚³ã‚¢æ”¹å–„ã®è¨ˆç®—
                const previousBunenjinScore = 0.6; // ä»¥å‰ã®60%
                const improvement = Math.round((bunenjinScore - previousBunenjinScore) * 100);

                resultsDiv.innerHTML = `
                    <div class="details">
                        <div class="score ${scoreClass}">ğŸ”¯ ç·åˆæ˜“çµŒæ­£çµ±æ€§ã‚¹ã‚³ã‚¢: ${Math.round(overallScore * 100)}%</div>
                        <div class="score ${bunenjinClass}">ğŸ­ bunenjinå“²å­¦æ•´åˆæ€§: ${Math.round(bunenjinScore * 100)}%</div>
                        
                        ${improvement > 0 ? `<div style="color: green; font-weight: bold; margin: 10px 0;">
                            ğŸ“ˆ æ”¹å–„: +${improvement}ãƒã‚¤ãƒ³ãƒˆå‘ä¸Šï¼
                        </div>` : ''}
                        
                        <h4>é ˜åŸŸåˆ¥ã‚¹ã‚³ã‚¢:</h4>
                        <p>â€¢ å…«å¦ç›¸äº’é–¢ä¿‚æ€§: ${fullValidation.trigramRelationships?.overallScore ? Math.round(fullValidation.trigramRelationships.overallScore * 100) : 0}%</p>
                        <p>â€¢ 64å¦é™°é™½ãƒãƒ©ãƒ³ã‚¹: ${fullValidation.hexagramBalance?.overallScore ? Math.round(fullValidation.hexagramBalance.overallScore * 100) : 0}%</p>
                        <p>â€¢ ã‚¦ãƒ«ãƒˆãƒ©ã‚·ãƒ³ã‚¯ãƒ­ã‚¸ãƒƒã‚¯: ${fullValidation.ultraSyncLogic?.overallScore ? Math.round(fullValidation.ultraSyncLogic.overallScore * 100) : 0}%</p>
                        <p>â€¢ bunenjinå“²å­¦æ•´åˆæ€§: ${Math.round(bunenjinScore * 100)}%</p>
                        <p>â€¢ çˆ»è¾ãƒ¬ãƒ™ãƒ«é©ç”¨: ${fullValidation.lineApplication?.overallScore ? Math.round(fullValidation.lineApplication.overallScore * 100) : 0}%</p>
                        
                        <h4>è©•ä¾¡ãƒ¬ãƒ™ãƒ«:</h4>
                        <p>${fullValidation.overallAssessment?.assessmentLevel || 'åˆ†æä¸­'}</p>
                        
                        <h4>ç›®æ¨™é”æˆçŠ¶æ³:</h4>
                        <p>ç›®æ¨™ã‚¹ã‚³ã‚¢: 90%</p>
                        <p>ç¾åœ¨ã®ã‚¹ã‚³ã‚¢: ${Math.round(bunenjinScore * 100)}%</p>
                        <p>é”æˆç‡: ${Math.round((bunenjinScore / 0.9) * 100)}%</p>
                    </div>
                `;

                testResults.fullValidation = {
                    overall: overallScore,
                    bunenjin: bunenjinScore,
                    improvement: improvement
                };

                log(`ğŸ¯ å®Œå…¨æ¤œè¨¼å®Œäº† - ç·åˆ: ${Math.round(overallScore * 100)}%, bunenjin: ${Math.round(bunenjinScore * 100)}%`, 'success');

                // 90%é”æˆç¢ºèª
                if (bunenjinScore >= 0.9) {
                    log('ğŸ‰ ç›®æ¨™é”æˆï¼bunenjinå“²å­¦æ•´åˆæ€§90%ä»¥ä¸Šã‚’é”æˆã—ã¾ã—ãŸï¼', 'success');
                } else if (bunenjinScore >= 0.8) {
                    log('ğŸ”¥ å¤§å¹…æ”¹å–„ï¼bunenjinå“²å­¦æ•´åˆæ€§ãŒ80%ä»¥ä¸Šã«å‘ä¸Šã—ã¾ã—ãŸ', 'success');
                } else if (improvement > 0) {
                    log(`ğŸ“ˆ æ”¹å–„ç¢ºèªï¼bunenjinå“²å­¦æ•´åˆæ€§ãŒ${improvement}ãƒã‚¤ãƒ³ãƒˆå‘ä¸Šã—ã¾ã—ãŸ`, 'success');
                }

            } catch (error) {
                log(`âŒ å®Œå…¨æ¤œè¨¼ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                resultsDiv.innerHTML = `
                    <div class="details">
                        <div class="score low">âŒ æ¤œè¨¼å¤±æ•—</div>
                        <p>ã‚¨ãƒ©ãƒ¼: ${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
                testResults.fullValidation = {
                    overall: 0,
                    bunenjin: 0,
                    improvement: 0
                };
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('bunenjinå“²å­¦çµ±åˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            log('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‹ã‚‰é–‹å§‹ã—ã¦ãã ã•ã„');
        });
    </script>
</body>
</html>