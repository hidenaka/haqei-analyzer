# HAQEIプロジェクト エージェントオーケストレーション運用ガイド

## 📋 現在利用可能なシステム

### 1. MCPツール群
- **Claude Flow**: AI協調オーケストレーション（87専門ツール）
- **Ruv Swarm**: 分散エージェント協調システム
- **IDE**: 開発環境統合

### 2. エージェントカテゴリー（61種類）

#### 🛠️ Core Development Agents
- `coder` - 実装専門
- `reviewer` - コードレビュー
- `tester` - テスト作成・実行
- `planner` - 戦略計画
- `researcher` - 情報収集

#### 🤝 Swarm Coordination Agents
- `hierarchical-coordinator` - 階層型調整
- `mesh-coordinator` - P2Pネットワーク
- `adaptive-coordinator` - 動的トポロジー
- `task-orchestrator` - タスク調整
- `swarm-memory-manager` - 分散メモリ管理

#### 🎯 HAQEI専門エージェント
- `haqei-cto` - プロジェクト意思決定
- `haqei-programmer` - bunenjin準拠コーディング
- `haqei-requirements-analyst` - 易経認識仕様分析
- `haqei-qa-tester` - 哲学整合性テスト
- `haqei-reporter` - 進捗報告
- `haqei-iching-expert` - 易経検証
- `bunenjin-strategy-navigator` - 哲学フレームワーク実装

## 🚀 並列実行パターン

### 基本ルール
```javascript
// ✅ 正しい使い方：1メッセージで全て実行
[Single Message]:
  - TodoWrite { todos: [10+ todos] }
  - Task("設計", "詳細指示", "system-architect")
  - Task("実装", "詳細指示", "coder")
  - Task("テスト", "詳細指示", "tester")
  - mcp__claude-flow__swarm_init { topology: "hierarchical" }
  - mcp__claude-flow__task_orchestrate { task: "main task" }
```

### タスクに応じた構成例

#### 1. 新機能開発（標準構成）
```javascript
// 5-6エージェントの並列起動
- Task("要件分析", "...", "haqei-requirements-analyst")
- Task("設計", "...", "system-architect")
- Task("実装1", "...", "coder")
- Task("実装2", "...", "coder")
- Task("テスト", "...", "tester")
- Task("調整", "...", "task-orchestrator")
```

#### 2. バグ修正（軽量構成）
```javascript
// 3-4エージェントで素早く対応
- Task("問題分析", "...", "researcher")
- Task("修正", "...", "coder")
- Task("検証", "...", "tester")
```

#### 3. 大規模リファクタリング（フル構成）
```javascript
// 8-10エージェントで包括的対応
- Task("現状分析", "...", "code-analyzer")
- Task("アーキテクチャ", "...", "system-architect")
- Task("実装1", "...", "coder")
- Task("実装2", "...", "coder")
- Task("実装3", "...", "coder")
- Task("性能", "...", "performance-benchmarker")
- Task("テスト", "...", "tester")
- Task("品質", "...", "reviewer")
- Task("統合", "...", "task-orchestrator")
```

## 📊 MCPツール活用

### swarm初期化
```javascript
mcp__claude-flow__swarm_init {
  topology: "hierarchical", // or "mesh", "ring", "star"
  maxAgents: 8,
  strategy: "balanced"
}
```

### タスク調整
```javascript
mcp__claude-flow__task_orchestrate {
  task: "メインタスクの説明",
  strategy: "parallel", // or "sequential", "adaptive"
  priority: "high"
}
```

### メモリ管理
```javascript
mcp__claude-flow__memory_usage {
  action: "store",
  key: "project/phase/data",
  value: "重要な情報"
}
```

## 🔄 協調プロトコル

### エージェント間の連携
1. **開始時**: `pre-task` hookで前回の状態を確認
2. **作業中**: `post-edit` hookで進捗を共有
3. **完了時**: `post-task` hookで結果を保存

### 品質チェックポイント
- コード変更後は必ず`tester`が検証
- 大きな変更は`reviewer`がレビュー
- パフォーマンスは`performance-benchmarker`が測定

## 📝 使い分けガイドライン

### HAQEIドメイン特化タスク
- bunenjin哲学関連 → `haqei-*`エージェント
- 易経解釈 → `haqei-iching-expert`
- Triple OS設計 → `bunenjin-strategy-navigator`

### 一般開発タスク
- REST API → `backend-dev`
- UI実装 → `coder` + `mobile-dev`
- テスト → `tester` + `tdd-london-swarm`

### システム最適化
- パフォーマンス → `perf-analyzer`
- アーキテクチャ → `system-architect`
- 統合 → `task-orchestrator`

## ⚡ 効率化のコツ

1. **タスクの粒度**
   - 1エージェント = 1つの明確な責任
   - 依存関係が少ないタスクは並列化

2. **メモリ活用**
   - 重要な決定は必ず保存
   - 次回セッションで自動復元

3. **エラー対応**
   - 失敗時は別エージェントで再試行
   - ログから学習してパターン化

## 🎯 実行例

```javascript
// 実際の使用例
[Single Message]:
  // Todoリスト一括更新
  TodoWrite { todos: [
    {id: "1", content: "要件分析", status: "in_progress", priority: "high"},
    {id: "2", content: "設計", status: "pending", priority: "high"},
    {id: "3", content: "実装", status: "pending", priority: "medium"},
    {id: "4", content: "テスト", status: "pending", priority: "medium"}
  ]}
  
  // MCPでswarm初期化
  mcp__claude-flow__swarm_init { topology: "hierarchical", maxAgents: 6 }
  
  // エージェント並列起動
  Task("要件を分析して設計書を作成", "...", "haqei-requirements-analyst")
  Task("テスト計画を立案", "...", "tester")
  Task("技術調査を実施", "...", "researcher")
  
  // ファイル操作も並列
  Read("existing-code.js")
  Read("requirements.md")
  
  // 開発開始
  mcp__claude-flow__task_orchestrate { 
    task: "HAQEIシステムの新機能実装",
    strategy: "parallel"
  }
```

---

このガイドに従って、効率的な並列開発を実現します。