# データスキーマ定義書 (Data Schema for HaQei Analyzer)

このドキュメントは、「HaQei アナライザー」プロジェクトで利用する主要な JavaScript データの構造を定義します。

---

## 1. データフローの概要

このプロジェクトのデータは、以下の流れで管理されています。

**元データ(CSV)** → `[Pythonスクリプト]` → **本番データ(JavaScript)**

日々の開発で主に参照・利用するのは、最終的に生成される **本番データ(JavaScript)** です。

---

## 2. 主要 JavaScript データ構造 (`assets/haqei_main_database.js`)

メインのデータファイルには、`HAQEI_DATA`という一つの大きなオブジェクトが含まれています。

### `HAQEI_DATA.trigrams_master`

八卦の基本情報を格納する配列です。

| キー (Key)   | データ型 | 説明                    |
| :----------- | :------- | :---------------------- |
| `trigram_id` | 数値     | 八卦の ID (1-8)         |
| `name_jp`    | 文字列   | 日本語名 (例: "乾")     |
| `name_en`    | 文字列   | 象徴名 (例: "天")       |
| `element`    | 文字列   | 対応する五行 (例: "金") |

### `HAQEI_DATA.element_relationships`

五行の相生・相剋関係を定義する配列です。

| キー (Key)          | データ型 | 説明                            |
| :------------------ | :------- | :------------------------------ |
| `source_element`    | 文字列   | 関係の起点となる五行            |
| `target_element`    | 文字列   | 関係の対象となる五行            |
| `relationship_type` | 文字列   | 関係性の種類 ("相生" or "相剋") |
| `metaphor_text`     | 文字列   | 関係性を説明するテキスト        |

### `HAQEI_DATA.hexagrams_master`

全 64 卦の基本情報を格納する配列です。

| キー (Key)         | データ型 | 説明                                  |
| :----------------- | :------- | :------------------------------------ |
| `hexagram_id`      | 数値     | 卦の通し番号 (1-64)                   |
| `name_jp`          | 文字列   | 卦の日本語名 (例: "乾為天")           |
| `upper_trigram_id` | 数値     | 上卦の ID                             |
| `lower_trigram_id` | 数値     | 下卦の ID                             |
| `description`      | 文字列   | 卦が示す人格の簡潔な説明              |
| `keywords`         | 文字列   | 卦を象徴するキーワード (カンマ区切り) |

### `HAQEI_DATA.mbti_map`, `enneagram_map`, `strengthsfinder_map`

各種性格分析と八卦のスコアを関連付ける配列です。（構造は同様）

| キー (Key)     | データ型           | 説明                                                                                        |
| :------------- | :----------------- | :------------------------------------------------------------------------------------------ |
| `mbti_type` 等 | 文字列             | 分析タイプの名前 (例: "INTJ", "1", "達成欲")                                                |
| `nickname` 等  | 文字列             | タイプのニックネーム (存在する場合)                                                         |
| `scores`       | オブジェクトの配列 | 八卦との関連スコア。各要素は以下のキーを持つ：<br> - `trigram_id`: 数値<br> - `score`: 数値 |

### `HAQEI_DATA.keyword_map`, `HAQEI_DATA.line_keyword_map`

卦や爻、性格タイプと、人格キーワードを関連付けるオブジェクト（連想配列）です。

| キー (Key)              | 値 (Value)                  | 説明                             |
| :---------------------- | :-------------------------- | :------------------------------- |
| 卦名やタイプ名 (文字列) | 文字列の配列                | キーに対応するキーワードのリスト |
| (例: "乾為天", "INTJ")  | (例: `["創造・革新", ...]`) |                                  |

### `HAQEI_DATA.h384`

全 384 爻の詳細データを格納する配列です。

| キー (Key)         | データ型 | 説明                             |
| :----------------- | :------- | :------------------------------- |
| `爻名`             | 文字列   | 卦と爻の名前 (例: "乾為天 初九") |
| `通し番号`         | 数値     | 爻の通し番号 (1-386)             |
| `S1_基本スコア` 等 | 数値     | 各種分析スコア                   |
| `S5_主体性`        | 文字列   | "能動" or "受動" or "中立"       |

### `HAQEI_DATA.TRIGRAM_INTERACTIONS`

八卦同士の相互作用（シナジーと葛藤）を定義するオブジェクトです。

| キー (Key)                  | データ型     | 説明                                                                                                                                             |
| :-------------------------- | :----------- | :----------------------------------------------------------------------------------------------------------------------------------------------- |
| `[trigram_id]`              | オブジェクト | ベースとなる八卦の ID (1-8)。値は、組み合わせる八卦 ID をキーとするオブジェクト。                                                                |
| `[trigram_id].[trigram_id]` | オブジェクト | 組み合わせる八卦の ID (1-8)。値は以下のキーを持つオブジェクト：<br> - `synergy`: 文字列（シナジーの説明）<br> - `conflict`: 文字列（葛藤の説明） |

---

## 3. 行動指針データ (`assets/koudo_shishin_database.js`)

### `koudoShishinData`

全 384 爻+α の行動指針テキストデータを格納する配列です。

| キー (Key) | データ型 | 説明                             |
| :--------- | :------- | :------------------------------- |
| `id`       | 数値     | 爻の通し番号 (1-386)             |
| `name`     | 文字列   | 卦と爻の名前 (例: "乾為天 初九") |
| `shin`     | 文字列   | 「進」の場合の行動指針テキスト   |
| `hen`      | 文字列   | 「変」の場合の行動指針テキスト   |

---
