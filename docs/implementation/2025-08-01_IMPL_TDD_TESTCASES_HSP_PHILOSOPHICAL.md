# TDDテストケース: HSP的・哲学的ユーザー入力の高精度分析

## 問題分析サマリー

### 現在のシステムのキーワード設定
- **emotion_management.hsp_specific**: ['世の中イライラ', '敏感に感じ', '対応しちゃう', '浮き沈みが影響', 'オーバーロード']
- **philosophical.primary**: ['人生', '生きる', '存在', '意味', '価値']
- **philosophical.abstract**: ['本質', '理念', '思想', '哲学', '宗教']

### 問題点
1. **部分マッチング不足**: '世の中イライラしてる人敏感に感じやすく' が '世の中イライラ' + '敏感に感じ' として認識されない
2. **哲学的要素の不備**: '志の本質', '人と地球の調和', '創造' が philosophical キーワードに含まれていない
3. **口語表現対応不足**: '〜しちゃう', '〜だろうって', '〜なんですが' の処理

## テストケース群

### TC-001: 実際の問題入力
```javascript
const testCase001 = {
  id: 'TC-001',
  name: '実際のユーザー入力（HSP + 哲学的要素）',
  input: '世の中イライラしてる人敏感に感じやすく対応しちゃう。自分の気持ちが浮き沈みが影響受けやすい。そういう自分の性格をもっとニュートラルを保てるようにするにはどうしたらいいんだろうって言う。元の部分が志の本質をバランスよく整えて、人と地球の調和の取れた充実した世界を創造するって言うことを、自分の人生の心志として生きているんですが',
  expected: {
    contextType: 'emotion_management', // または 'philosophical'
    confidence: 0.7, // 最低70%
    extractedKeywords: [
      '敏感', '感じやすく', '対応', 'イライラ', '浮き沈み', '影響', 
      'ニュートラル', 'バランス', '志', '本質', '調和', '地球', '創造', '人生'
    ],
    hexagramCandidates: [31, 58, 29, 1, 50], // 沢山咸、兌為沢、坎為水、乾為天、火風鼎
    shouldNotFallback: true
  }
};
```

### TC-002: HSP特性のバリエーション
```javascript
const testCase002 = {
  id: 'TC-002',
  name: 'HSP特性のバリエーション表現',
  inputs: [
    '他人の感情に敏感で影響を受けてしまいます',
    '人混みや騒音が苦手で疲れやすいです',
    '世の中の雰囲気に左右されて気持ちが不安定になる',
    '敏感すぎる性格で日常生活が辛い',
    '感受性が強くて疲れやすい体質なんです'
  ],
  expected: {
    contextType: 'emotion_management',
    confidence: 0.75,
    keywordMatches: ['敏感', '影響', '疲れやすい', '感受性', '不安定']
  }
};
```

### TC-003: 哲学的表現のバリエーション
```javascript
const testCase003 = {
  id: 'TC-003',
  name: '哲学的・スピリチュアル表現',
  inputs: [
    '人と自然の調和を大切にして生きたいと思っています',
    '自分の使命や存在意義について考える毎日です',
    '地球環境と人類の未来について真剣に向き合いたい',
    '心の平和と世界平和は繋がっていると信じています',
    '本質的な幸せとは何かを日々模索しています'
  ],
  expected: {
    contextType: 'philosophical',
    confidence: 0.8,
    keywordMatches: ['調和', '使命', '存在意義', '地球', '本質', '幸せ']
  }
};
```

### TC-004: 複合表現（HSP + philosophical）
```javascript
const testCase004 = {
  id: 'TC-004',
  name: 'HSP特性と哲学的要素の複合',
  inputs: [
    '繊細な心で世界の痛みを感じながら、それでも愛と調和の世界を作りたい',
    '敏感な性質を活かして、人と地球が共生できる社会を目指したい',
    '感受性の強さを使命として、真の平和を実現するために生きている'
  ],
  expected: {
    contextType: 'emotion_management', // primary
    secondaryContext: 'philosophical',
    confidence: 0.85,
    keywordMatches: ['繊細', '敏感', '感受性', '調和', '共生', '使命', '平和']
  }
};
```

### TC-005: 口語表現・SNS的表現
```javascript
const testCase005 = {
  id: 'TC-005',
  name: '口語的・SNS的表現パターン',
  inputs: [
    'なんか最近、世の中の空気に敏感に反応しちゃって疲れる',
    '人の機嫌とか雰囲気を察知しすぎて自分がしんどくなっちゃう',
    'もっと鈍感になりたいけど、それって本来の自分じゃないような気がする',
    'バランス感覚を保ちながら生きるってどういうことなんだろう'
  ],
  expected: {
    contextType: 'emotion_management',
    confidence: 0.7,
    colloquialPatterns: ['〜しちゃって', '〜なんだろう', '〜ような気がする'],
    keywordMatches: ['敏感', '反応', '察知', 'バランス']
  }
};
```

### TC-006: キーワード抽出精度テスト
```javascript
const testCase006 = {
  id: 'TC-006',
  name: 'キーワード抽出精度検証',
  input: '世の中イライラしてる人敏感に感じやすく対応しちゃう',
  expected: {
    morphologicalAnalysis: [
      { surface: '世の中', pos: '名詞' },
      { surface: 'イライラ', pos: '副詞' },
      { surface: 'してる', pos: '動詞' },  
      { surface: '人', pos: '名詞' },
      { surface: '敏感', pos: '形容動詞' },
      { surface: 'に', pos: '助詞' },
      { surface: '感じ', pos: '動詞' },
      { surface: 'やすく', pos: '形容詞' },
      { surface: '対応', pos: '名詞' },
      { surface: 'しちゃう', pos: '動詞' }
    ],
    extractedKeywords: [
      'イライラ', '敏感', '感じやすい', '対応'
    ],
    contextClues: ['emotion_management']
  }
};
```

### TC-007: フォールバック条件テスト
```javascript
const testCase007 = {
  id: 'TC-007',
  name: 'フォールバック発生条件の検証',
  inputs: [
    '', // 空文字
    'あ', // 短すぎる
    '１２３４５', // 意味のない数字
    'test test test', // 英語のみ
    '。。。？？？', // 記号のみ
  ],
  expected: {
    shouldFallback: true,
    fallbackReason: ['EMPTY_INPUT', 'TOO_SHORT', 'NO_KEYWORDS', 'NON_JAPANESE', 'INVALID_CHARS'],
    contextType: 'personal', // デフォルト
    confidence: 0.3
  }
};
```

### TC-008: パフォーマンステスト
```javascript
const testCase008 = {
  id: 'TC-008',
  name: 'パフォーマンス要件検証',
  input: '世の中イライラしてる人敏感に感じやすく対応しちゃう。自分の気持ちが浮き沈みが影響受けやすい。そういう自分の性格をもっとニュートラルを保てるようにするにはどうしたらいいんだろうって言う。元の部分が志の本質をバランスよく整えて、人と地球の調和の取れた充実した世界を創造するって言うことを、自分の人生の心志として生きているんですが',
  expected: {
    processingTime: 500, // 500ms以内
    memoryUsage: 50, // 50MB以内
    keywordExtractionTime: 200, // 200ms以内
    analysisTime: 300 // 300ms以内
  }
};
```

## 改善対象の特定

### 1. キーワードデータベース拡張
```javascript
// 追加が必要なキーワード
const additionalKeywords = {
  emotion_management: {
    hsp_enhanced: [
      '感じやすく', '感じやすい', '影響受けやすい', '左右される',
      '振り回される', '察知', '反応しちゃう', '疲れちゃう'
    ],
    colloquial: [
      'しちゃう', 'なっちゃう', 'だろうって', 'なんですが',
      'みたいな', 'っぽい', 'かもしれない'
    ]
  },
  philosophical: {
    enhanced_abstract: [
      '志', '心志', '使命', '天命', '宿命', '運命',
      '調和', '共生', '創造', '理想', '夢', '願い'
    ],
    environmental: [
      '地球', '自然', '環境', '生態系', '持続可能',
      '未来世代', '次世代', 'サステナブル'
    ]
  }
};
```

### 2. パターンマッチング改善
```javascript
// 改善されたパターン
const enhancedPatterns = {
  emotion_management: [
    /世の中.{0,15}イライラ.{0,15}敏感/,
    /敏感.{0,10}感じ.{0,10}対応/,
    /気持ち.{0,10}浮き沈み.{0,10}影響/,
    /ニュートラル.{0,15}保[つて]/,
    /.{0,10}しちゃう$/,
    /影響.{0,10}受けやすい/
  ],
  philosophical: [
    /志.{0,10}本質/,
    /人と地球.{0,10}調和/,
    /[充実平和].{0,10}世界.{0,10}創造/,
    /人生.{0,10}心志/,
    /生きている.{0,10}[んです]が$/
  ]
};
```

## 期待される改善効果

### 定量的指標
1. **キーワード抽出成功率**: 現在 0% → 目標 95%
2. **コンテキスト分類精度**: 現在 フォールバック → 目標 85%
3. **処理時間**: 目標 500ms以内
4. **フォールバック発生率**: 目標 5%以下

### 定性的指標
1. **ユーザー体験**: 適切な分析結果とアドバイス提供
2. **システム信頼性**: エラー・フォールバック大幅削減
3. **分析精度**: HSP特性と哲学的要素の正確な検出

## 次のステップ

1. **TC-001の成功**: 最優先で実際の入力での動作確認
2. **段階的改善**: キーワード → パターン → 統合テスト
3. **リグレッション防止**: 既存機能への影響を最小化
4. **パフォーマンス最適化**: 精度向上と処理速度のバランス

このテストケースに基づいて、次のフェーズで実装改善を行います。