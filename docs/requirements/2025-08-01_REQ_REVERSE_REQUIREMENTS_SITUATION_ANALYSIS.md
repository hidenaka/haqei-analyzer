# /rev-requirements: 状況分析システム要件書逆算

## 🎯 Tsumikiワークフロー実行

**実行コマンド**: `/rev-requirements`  
**対象システム**: 状況分析システム（4コンポーネント統合）  
**実行日**: 2025年8月1日  
**前提**: /rev-design完了済み（設計レベル問題4項目特定）  

## 📋 現在のシステム要件（逆算結果）

### 機能要件

#### FR-001: テキスト入力処理
**現在の要件**:
- テキスト長制限: なし（任意長入力対応）
- 文字コード: UTF-8対応
- 入力形式: プレーンテキストのみ

**問題点**:
- 最適なテキスト長の指針なし
- 短文・長文での品質差未考慮
- 特殊文字・絵文字処理の曖昧性

#### FR-002: アーキタイプ判定機能
**現在の要件**:
- 4つのアーキタイプ分類: creation, development, transformation, maturity
- キーワードマッチング判定手法
- 信頼度付き判定結果出力

**致命的問題**:
- ❌ **偏重許容**: transformation 35%集中を問題視しない設計
- ❌ **重み設計欠陥**: temporal指標2.0重みでバランス破綻
- ❌ **現代語適応不足**: 「転職」「見直し」を易経的大変革と同等扱い

#### FR-003: 易経64卦マッピング機能
**現在の要件**:
- 64卦完全対応
- 重み付けスコア計算（100点満点）
- 上位3卦提示（主要卦+代替卦2つ）

**致命的問題**:
- ❌ **多様性破綻**: 18卦が永続的に未使用
- ❌ **重み配分異常**: archetype(30)+temporal(20)=50点の過大重み
- ❌ **フォールバック災害**: 64卦→8卦への87.5%機能喪失

#### FR-004: 信頼度計算機能  
**現在の要件**:
- 多次元信頼度評価
- 0-1範囲の正規化出力
- 平均74.2%の実績ベースライン

**致命的問題**:
- ❌ **透明性皆無**: 計算過程がブラックボックス
- ❌ **固定重み依存**: 状況に応じた動的調整なし
- ❌ **妥当性未検証**: 統計的裏付けの欠如

### 非機能要件

#### NFR-001: 性能要件
**現在の要件**:
- 処理時間制限: なし
- 同時処理数制限: なし
- メモリ使用量制限: なし

**問題点**:
- パフォーマンス基準の欠如
- スケーラビリティ考慮不足

#### NFR-002: 可用性要件
**現在の要件**:
- フォールバック機能: 8卦基本モード
- エラーハンドリング: try-catch基本対応
- 復旧機能: 手動リロード依存

**致命的問題**:
- ❌ **段階的縮退なし**: 64→8卦の極端な品質低下
- ❌ **透明性欠如**: フォールバック状態の不明示
- ❌ **自動復旧なし**: 障害からの自律的回復機能なし

#### NFR-003: 拡張性要件
**現在の要件**:
- 新卦追加対応: HexagramDatabase編集
- 新アーキタイプ追加: 4つ固定（拡張性なし）
- アルゴリズム改良: 各クラス個別修正

**問題点**:
- bunenjin哲学の4アーキタイプ固定制約
- プラグイン機構の欠如

## 🚨 要件レベルでの根本的問題

### 1. ユーザー体験要件の欠陥

#### 問題: 偏重結果の許容設計
```yaml
現在の要件:
  archetype_distribution: "制限なし"
  acceptable_bias: "未定義"
  user_satisfaction: "未測定"

期待される要件:
  archetype_distribution: "25% ± 5%の均等分布"
  acceptable_bias: "最大頻度アーキタイプ30%以下"
  user_satisfaction: "4.0/5.0以上"
```

#### 問題: 結果多様性の軽視
```yaml
現在の要件:
  hexagram_usage: "制限なし"
  diversity_index: "未定義"
  rare_hexagram_protection: "なし"

期待される要件:
  hexagram_usage: "全64卦が年間1回以上選択"
  diversity_index: "Gini係数0.7以下"
  rare_hexagram_protection: "希少卦ボーナス機構"
```

### 2. bunenjin哲学整合性要件の不足

#### 問題: 易経64卦表現力の軽視
```yaml
現在の要件:
  iching_completeness: "64卦定義のみ"
  philosophical_accuracy: "未定義"
  cultural_sensitivity: "未考慮"

期待される要件:
  iching_completeness: "64卦均等活用保証"
  philosophical_accuracy: "易経原典との整合性90%以上"
  cultural_sensitivity: "現代解釈と古典的知恵の融合"
```

#### 問題: 4アーキタイプバランス軽視
```yaml
現在の要件:
  archetype_balance: "キーワード判定のみ"
  temporal_integration: "重み付け固定"
  holistic_view: "未考慮"

期待される要件:
  archetype_balance: "人生段階の動的バランス"
  temporal_integration: "過去・現在・未来の統合的理解"
  holistic_view: "Triple OS Architecture との整合性"
```

### 3. 品質保証要件の重大な欠落

#### 問題: 統計的妥当性要件なし
```yaml
現在の要件:
  validation_method: "なし"
  statistical_significance: "未定義"
  quality_metrics: "基本メトリクスのみ"

期待される要件:
  validation_method: "100人以上のテスト必須"
  statistical_significance: "信頼区間95%以上"
  quality_metrics: "多次元品質スコア"
```

#### 問題: 継続改善要件なし
```yaml
現在の要件:
  feedback_integration: "手動"
  learning_mechanism: "なし"
  adaptive_improvement: "未対応"

期待される要件:
  feedback_integration: "自動フィードバック統合"
  learning_mechanism: "使用パターン学習"
  adaptive_improvement: "動的重み調整"
```

## 📊 ユーザーフィードバック基準の要件化

### 100人テスト結果による要件修正

#### 変革期偏重問題 → 新要件
```yaml
要件ID: FR-002-1
内容: アーキタイプ分布均等性保証
基準: 各アーキタイプ20-30%の範囲内
測定: 100回判定での分布測定
不合格: 35%超過または15%未満
```

#### 未使用卦問題 → 新要件  
```yaml
要件ID: FR-003-1
内容: 64卦多様性保証
基準: 上位10卦の占有率50%以下
測定: 100回マッピングでの頻度分析
不合格: 18卦以上が未使用
```

### 100人批判的レビューによる要件追加

#### 「抽象的すぎる」→ 新要件
```yaml
要件ID: FR-005
内容: 具体性レベル保証
基準: 解釈文の具体性スコア3.5/5.0以上
測定: ユーザー理解度調査
評価: 5段階評価で平均3.5以上
```

#### 「同じ卦ばかり」→ 新要件
```yaml
要件ID: FR-006
内容: 個人レベル多様性保証
基準: 同一ユーザー5回連続で異なる卦
測定: 個人使用履歴追跡
制約: 同一卦連続選択は最大2回まで
```

## 🎯 改善要件の優先順位

### 最優先（即座の改善必須）

#### 1. アーキタイプ判定バランス改善
```yaml
要件ID: FR-002-IMPROVED
内容: 4アーキタイプの動的バランス判定
実装: temporal重み2.0→1.2へ調整
検証: 100人テストで25±5%分布達成
期限: Phase 3実装時
```

#### 2. 64卦多様性確保機構
```yaml
要件ID: FR-003-IMPROVED  
内容: 希少卦積極選択アルゴリズム
実装: 使用頻度による動的重み調整
検証: 18個未使用卦→0個達成
期限: Phase 3実装時
```

### 高優先（早期改善推奨）

#### 3. 段階的フォールバック機構
```yaml
要件ID: NFR-002-IMPROVED
内容: 64→32→16→8卦の段階的品質縮退
実装: 4段階フォールバックモード
検証: 各段階での最低限多様性確保
期限: Phase 3後半
```

#### 4. 透明性向上機構
```yaml
要件ID: FR-004-IMPROVED
内容: 計算過程の完全透明化
実装: 信頼度計算の説明機能
検証: ユーザー理解度4.0/5.0以上
期限: Phase 3後半
```

### 中優先（継続的改善対象）

#### 5. 学習・適応機構
```yaml
要件ID: FR-007-NEW
内容: ユーザーフィードバック自動学習
実装: 使用パターン分析・重み自動調整
検証: 継続的品質向上の確認
期限: Phase 4以降
```

## 📋 次のTsumikiステップへの準備

### 要件逆算完了確認
- ✅ 現在の要件仕様を完全逆算
- ✅ 4つの致命的要件欠陥を特定  
- ✅ ユーザーフィードバックを具体的要件に変換
- ✅ 改善要件の優先順位付け完了

### /tdd-requirements 準備完了
**移行可能な改善要件**:
1. アーキタイプ判定バランス改善（FR-002-IMPROVED）
2. 64卦多様性確保機構（FR-003-IMPROVED）
3. 段階的フォールバック機構（NFR-002-IMPROVED）
4. 透明性向上機構（FR-004-IMPROVED）

**TDD実装対象**:
- 各改善要件に対する包括的テストケース作成
- Red→Green→Refactorサイクルでの品質保証
- 100人テストでの継続的検証

### 実行予定
1. ✅ `/rev-design` - 設計書逆生成（完了）
2. ✅ `/rev-requirements` - 要件書逆算（完了）
3. ⏭️ `/tdd-requirements` - TDD改善要件定義
4. 🔄 `/tdd-testcases` - テストケース作成
5. 🔄 `/tdd-implement` - 改善実装

この要件書逆算により、現在のシステムの要件レベルでの根本的問題が明確になりました。次のステップでTDD基準での改善要件を定義し、テスト駆動での解決に移行します。