# 📋 384爻システム改善ドキュメント体系

**最終更新**: 2025年8月28日  
**ステータス**: Edge制約対応版を正式採用

---

## 📁 正式ドキュメント（Edge制約対応版）

以下が本プロジェクトで採用する正式ドキュメントです。

### 必須ドキュメント

1. **[01_要件定義書_Edge制約対応版.md](01_要件定義書_Edge制約対応版.md)**
   - データ活用率: 85%（軽量化版）
   - 応答時間: p50 30ms / p99 100ms
   - 学習/推論分離アーキテクチャ

2. **[02_システム設計書_Edge制約対応版.md](02_システム設計書_Edge制約対応版.md)**
   - Edge推論層（45ms以内処理）
   - バックエンド学習層（GPU/TPU）
   - 3段階フォールバック戦略

3. **[03_実装計画書_Edge制約対応版.md](03_実装計画書_Edge制約対応版.md)**
   - 8週間段階的実装
   - Phase別実装（基本→NLP→ML→最適化）
   - ライセンス対策明記

4. **[04_テスト計画書_優先順位版.md](04_テスト計画書_優先順位版.md)**
   - P0: Critical（Edge制約確認）
   - P1: High（パフォーマンス）
   - P2: Medium（品質）
   - P3: Low（追加検証）
   - **環境切替テスト追加**

5. **[05_運用連携仕様書.md](05_運用連携仕様書.md)**
   - 学習/推論連携フロー
   - モデル更新サイクル
   - **圧縮データ品質保証**
   - **精度モニタリング計画**
   - 辞書・ベクトルメンテナンス

6. **[06_ライセンス準拠ガイド.md](06_ライセンス準拠ガイド.md)**（新規追加）
   - 外部リソース利用方針
   - MeCab/WordNet代替実装
   - ライセンスコンプライアンス
   - API利用戦略

---

## 🗄️ アーカイブドキュメント（参考用）

以下は過去の検討案として参考保管しています。

### 初期検討版（制約考慮不足）
- `archive/01_要件定義書.md` - 初期フル機能版
- `archive/02_システム設計書.md` - 初期フル機能版
- `archive/03_タスク分解書.md` - AI並列実装版
- `archive/04_実装計画書.md` - 初期版
- `archive/05_テスト計画書.md` - 初期版

### AI実装フル機能版（制約超過）
- `archive/01_要件定義書_AI実装版.md`
- `archive/02_システム設計書_AI実装版.md`
- `archive/03_タスク分解書_AI実装版.md`
- `archive/04_実装計画書_AI実装版.md`
- `archive/05_テスト計画書_AI実装版.md`

### 簡易実装版
- `archive/02_システム設計書_現実版.md`

---

## 🎯 採用方針

### Edge制約対応版の特徴

1. **現実的な制約対応**
   - Cloudflare Pages/Workers制限内
   - D1 50MB、CPU 50ms、メモリ 128MB

2. **学習/推論分離**
   - Edge: 軽量推論のみ
   - Backend: GPU/TPU学習

3. **段階的実装**
   - 基本機能から順次拡張
   - 各フェーズで動作確認

4. **フォールバック重視**
   - 3段階デグレード
   - オフライン対応

---

## 📊 制約と目標値

| 項目 | 制約/現状 | 目標値 | 備考 |
|------|-----------|--------|------|
| D1サイズ | 50MB/DB | 45MB×2 | 分割構成 |
| CPU時間 | 50ms/req | 45ms以内 | キャッシュ必須 |
| 応答時間p50 | - | 30ms | キャッシュヒット時 |
| 応答時間p99 | - | 100ms | キャッシュミス時 |
| 分類精度 | 50% | 85% | 3ヶ月後目標 |
| データ活用率 | 25% | 85% | 軽量化後 |

---

## 🛠️ 開発者向けクイックガイド

### セットアップ

```bash
# 開発環境構築
npm install
cp .env.example .env.local

# 環境別起動
npm run dev          # 開発（SQLite/Redis）
npm run test         # テスト（メモリDB）
npm run preview      # 本番相当（D1/KV）
```

### API仕様

#### 384爻分類エンドポイント

```javascript
POST /api/classify
Content-Type: application/json

{
  "text": "入力テキスト",
  "options": {
    "detailed": false,  // 詳細結果
    "cache": true      // キャッシュ利用
  }
}

// レスポンス例
{
  "hexagram": "乾為天",
  "line": 3,
  "confidence": 0.92,
  "processing_time": 28,
  "cache_hit": true
}
```

#### ヘルスチェック

```javascript
GET /api/health

{
  "status": "healthy",
  "metrics": {
    "accuracy": 0.82,
    "cache_hit_rate": 0.87,
    "avg_response_time": 28
  }
}
```

### テスト実行

```bash
# 優先度別
npm run test:p0  # Edge制約（必須）
npm run test:p1  # パフォーマンス
npm run test:p2  # 精度・品質
npm run test:p3  # 追加機能

# 環境切替
npm run test:env  # マルチ環境対応
```

### デプロイ

```bash
# Cloudflare Pages
npm run build
wrangler pages deploy dist/

# カナリアリリース
npm run deploy:canary --percentage=5
```

## 📊 品質メトリクス

### 現在の達成状況

| メトリクス | 現状 | 目標 | 期限 |
|------------|------|------|------|
| 分類精度 | 50% | 85% | 3ヶ月後 |
| 応答時間(p50) | - | 30ms | Week 4 |
| 応答時間(p99) | - | 100ms | Week 4 |
| データ活用率 | 25% | 85% | Week 2 |
| キャッシュヒット率 | - | 85% | Week 6 |

### 精度改善ロードマップ

- **Week 1-2**: 基本改善（50%→60%）
- **Week 3-4**: データ統合（60%→70%）  
- **Week 5-8**: 学習サイクル（70%→75%）
- **Month 2-3**: 最適化（75%→85%）

## 🔄 今後の更新予定

- [x] 圧縮データ品質保証プロセス
- [x] ライセンス準拠ガイド作成
- [x] 精度モニタリング計画追加
- [x] 環境切替テスト追加
- [ ] A/Bテスト詳細実装ガイド
- [ ] 運用監視ダッシュボード設計
- [ ] コスト最適化の定期レビュープロセス