# 📜 384爻システム ライセンス準拠ガイド

**文書番号**: LC-384-001  
**バージョン**: 1.0  
**作成日**: 2025年8月28日  
**作成者**: HAQEI開発チーム  
**承認者**: [未承認]

---

## 1. 外部リソース利用方針

### 1.1 基本方針

```yaml
利用優先順位:
  1. 自前実装:
     - 正規表現ベース形態素解析
     - 易経専門辞書
     - カスタムキーワード抽出
     
  2. MIT/Apache 2.0ライセンス:
     - 商用利用可能
     - 改変・再配布自由
     - ライセンス表示のみ必要
     
  3. 制限付きライセンス:
     - GPL/LGPL: 慎重に検討
     - 商用制限: 使用回避
     - API経由での利用検討
```

---

## 2. 形態素解析の代替実装

### 2.1 MeCab代替案

```javascript
// nlp/morpheme_alternative.js

/**
 * MeCabを使用しない自前の形態素解析実装
 * ライセンス: MIT (HAQEI Project)
 */
class CustomMorphemeAnalyzer {
    constructor() {
        // 易経専門用語辞書（自作）
        this.iChingDictionary = {
            '乾為天': { type: 'hexagram', reading: 'けんいてん' },
            '坤為地': { type: 'hexagram', reading: 'こんいち' },
            '初九': { type: 'line', reading: 'しょきゅう' },
            '上九': { type: 'line', reading: 'じょうきゅう' },
            // ... 384爻分のエントリー
        };
        
        // 基本語彙辞書（MIT/Apache 2.0ライセンスから収集）
        this.basicDictionary = this.loadOpenSourceDict();
    }
    
    async analyze(text) {
        // 1. 易経専門用語の優先マッチング
        const iChingTokens = this.extractIChingTerms(text);
        
        // 2. 正規表現による基本分割
        const basicTokens = this.regexTokenize(text);
        
        // 3. N-gram分割
        const ngramTokens = this.ngramSplit(text, 2, 3);
        
        return this.mergeTokens(iChingTokens, basicTokens, ngramTokens);
    }
    
    loadOpenSourceDict() {
        // MIT/Apache 2.0ライセンスの辞書のみ使用
        // 例: kuromoji.js辞書データ（Apache 2.0）の部分利用
        return {
            source: 'kuromoji-dict-subset',
            license: 'Apache-2.0',
            size: '200KB',
            words: 5000
        };
    }
}
```

### 2.2 WordNet代替案

```javascript
// nlp/synonym_alternative.js

/**
 * WordNetを使用しない類義語処理
 * ライセンス: MIT (HAQEI Project)
 */
class CustomSynonymProcessor {
    constructor() {
        // 自作類義語辞書（易経ドメイン特化）
        this.synonymMap = {
            '変化': ['変動', '転換', '推移', '変革'],
            '陽': ['積極', '明', '動', '外向'],
            '陰': ['消極', '暗', '静', '内向'],
            '発展': ['成長', '進展', '向上', '進歩'],
            // 頻出1000語の類義語マップ
        };
        
        // オープンソース類義語データ
        this.openSynonyms = this.loadOpenSynonyms();
    }
    
    loadOpenSynonyms() {
        // CC0/パブリックドメインの類義語データ利用
        return {
            source: 'japanese-synonyms-cc0',
            license: 'CC0-1.0',
            entries: 3000
        };
    }
    
    async getSynonyms(word) {
        // 1. 自作辞書を優先
        if (this.synonymMap[word]) {
            return this.synonymMap[word];
        }
        
        // 2. オープンソースデータ参照
        if (this.openSynonyms[word]) {
            return this.openSynonyms[word];
        }
        
        // 3. 編集距離による類似語検索
        return this.findSimilarWords(word);
    }
}
```

---

## 3. 事前学習モデルの利用

### 3.1 軽量埋め込みモデル

```yaml
使用可能なモデル:
  FastText日本語モデル（軽量版）:
    - ライセンス: CC-BY-SA 3.0
    - サイズ: 圧縮後 5MB以下
    - 利用方法: モデル配布時にライセンス表記
    
  自作Word2Vecモデル:
    - 学習データ: 易経テキスト（パブリックドメイン）
    - ライセンス: MIT (HAQEI Project)
    - サイズ: 2MB（50次元、5000語彙）
    
  Sentence-BERT軽量版:
    - ライセンス: Apache 2.0
    - 利用: 量子化・蒸留版のみ
    - サイズ: 3MB以下に圧縮
```

### 3.2 モデル配布時の注意

```javascript
// models/license_manager.js
class ModelLicenseManager {
    generateLicenseFile() {
        return {
            models: [
                {
                    name: 'fasttext-ja-light',
                    license: 'CC-BY-SA 3.0',
                    attribution: 'Facebook Research',
                    modifications: '量子化・次元削減による軽量化'
                },
                {
                    name: 'iching-word2vec',
                    license: 'MIT',
                    attribution: 'HAQEI Project',
                    training_data: 'Public Domain I-Ching texts'
                }
            ],
            notice: `
This software includes the following third-party components:

1. FastText Japanese Model (Modified)
   Copyright (c) Facebook, Inc.
   Licensed under CC-BY-SA 3.0
   Modifications: Quantized and reduced to 5MB

2. I-Ching Word Embeddings
   Copyright (c) 2025 HAQEI Project
   Licensed under MIT License
            `
        };
    }
}
```

---

## 4. JSONデータのライセンス確認

### 4.1 プロジェクト内JSONファイル

```yaml
データファイル利用権限:
  koudo_shishin.json:
    - 権限: プロジェクト内利用可
    - 制限: 外部配布時は要確認
    - 圧縮: 必須（500KB以下）
    - 商用利用: 要個別確認
    
  enhanced_hexagrams_complete.json:
    - 権限: プロジェクト内利用可
    - 処理: 要約版作成（1MB以下）
    - 配布: Edge向け軽量版のみ
    - 商用利用: 要個別確認
    
  yaoci_31-63.json:
    - 権限: プロジェクト内利用可
    - 処理: キーワード抽出版（500KB以下）
    - 商用利用: 要個別確認
    
  h384.json:
    - 権限: プロジェクト内利用可
    - 処理: メタデータのみ（200KB以下）
    - 商用利用: 要個別確認
```

### 4.2 ライセンス適用範囲の明確化

```javascript
// license/scope_manager.js
class LicenseScopeManager {
    constructor() {
        this.licenses = {
            // 各リソースの具体的な利用範囲
            'koudo_shishin.json': {
                scope: 'internal',
                commercial: 'pending',
                distribution: 'restricted',
                actions: [
                    '1. 権利者への問い合わせ実施',
                    '2. 商用利用許諾の取得',
                    '3. 配布条件の明文化'
                ]
            },
            
            'mecab-alternative': {
                scope: 'internal',
                commercial: 'allowed',
                distribution: 'mit',
                actions: [
                    '1. 独自実装のため制限なし',
                    '2. MITライセンスで公開可能'
                ]
            },
            
            'fasttext-model': {
                scope: 'modified',
                commercial: 'cc-by-sa',
                distribution: 'with-attribution',
                actions: [
                    '1. 改変内容の明記',
                    '2. 元モデルへの帰属表示',
                    '3. 同一ライセンスでの配布'
                ]
            }
        };
    }
    
    async checkCommercialUsage(resource) {
        const info = this.licenses[resource];
        
        if (info.commercial === 'pending') {
            return {
                allowed: false,
                message: '商用利用許諾が未取得です',
                required_actions: info.actions
            };
        }
        
        return {
            allowed: true,
            conditions: info.distribution
        };
    }
    
    generateLicenseReport() {
        const report = [];
        
        for (const [resource, info] of Object.entries(this.licenses)) {
            report.push({
                resource,
                status: info.commercial === 'pending' ? '⚠️ 要確認' : '✅ 利用可',
                scope: info.scope,
                next_steps: info.actions
            });
        }
        
        return report;
    }
}

### 4.2 データ圧縮とライセンス保持

```javascript
// data/compressor.js
class DataCompressor {
    compressWithLicense(jsonData, license) {
        const compressed = {
            // ライセンス情報を保持
            _license: license,
            _compressed: true,
            _original_size: JSON.stringify(jsonData).length,
            
            // データ圧縮
            data: this.compress(jsonData)
        };
        
        return compressed;
    }
    
    compress(data) {
        // 1. 不要フィールド削除
        const cleaned = this.removeRedundant(data);
        
        // 2. 文字列の辞書圧縮
        const dictCompressed = this.dictionaryEncode(cleaned);
        
        // 3. gzip圧縮
        return this.gzipCompress(dictCompressed);
    }
}
```

---

## 5. API利用による外部リソース活用

### 5.1 ライセンス回避策としてのAPI利用

```javascript
// external/api_wrapper.js
class ExternalAPIWrapper {
    constructor() {
        this.apis = {
            // MeCab API（自前サーバーで提供）
            morpheme: {
                endpoint: 'https://api.haqei.com/v1/morpheme',
                fallback: this.localMorpheme,
                rateLimit: 1000  // req/day
            },
            
            // WordNet API（学術利用）
            synonym: {
                endpoint: 'https://wordnet.jp/api/v1/',
                fallback: this.localSynonym,
                cache: true
            }
        };
    }
    
    async analyze(text) {
        try {
            // APIを試行
            return await this.callAPI(text);
        } catch (error) {
            // ローカルフォールバック
            return await this.localFallback(text);
        }
    }
}
```

---

## 6. ライセンスコンプライアンスチェックリスト

### 6.1 開発時チェック項目

```yaml
必須確認事項:
  □ 新規ライブラリ追加時:
    - ライセンス種別の確認
    - 商用利用可否の確認
    - 改変・再配布条件の確認
    
  □ モデル利用時:
    - 学習データのライセンス
    - モデル自体のライセンス
    - 配布条件の確認
    
  □ データ圧縮時:
    - 元データの利用権限
    - 圧縮後の配布可否
    - 帰属表示の必要性
    
  □ API利用時:
    - 利用規約の確認
    - レート制限の把握
    - 商用利用条件
```

### 6.2 リリース前チェック

```bash
#!/bin/bash
# scripts/license_check.sh

echo "=== License Compliance Check ==="

# 1. package.jsonの依存関係チェック
echo "Checking npm dependencies..."
npx license-checker --production --summary

# 2. ライセンスファイル生成
echo "Generating LICENSE file..."
cat > LICENSE << EOF
MIT License

Copyright (c) 2025 HAQEI Project

[Standard MIT License text]

---
Third-party licenses:
EOF

npx license-checker --production --out licenses.txt
cat licenses.txt >> LICENSE

# 3. 禁止ライセンスの検出
echo "Checking for prohibited licenses..."
npx license-checker --production --onlyAllow 'MIT;Apache-2.0;BSD;CC0-1.0;CC-BY-SA-3.0'

echo "=== Check Complete ==="
```

---

## 7. 継続的コンプライアンス管理

### 7.1 定期レビュー

```yaml
月次レビュー:
  - 新規追加ライブラリの確認
  - ライセンス変更の追跡
  - 圧縮データの品質・サイズ確認
  
四半期レビュー:
  - 外部API利用状況の評価
  - 自前実装への移行検討
  - ライセンスコストの最適化
```

### 7.2 ドキュメント更新

```yaml
更新対象:
  - README.md: 使用ライブラリ一覧
  - LICENSE: サードパーティライセンス
  - NOTICE: 帰属表示
  - docs/licenses/: 詳細ライセンス情報
```

---

## 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| 法務責任者 | | | |
| 技術責任者 | | | |
| プロジェクトマネージャー | | | |

**文書管理**
- **目的**: 外部リソースの適切な利用とライセンス準拠
- **対象**: 開発チーム全員
- **更新頻度**: 月次
- **配布先**: 開発チーム、法務チーム、QAチーム