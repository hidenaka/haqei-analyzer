# 🎯 TRAE向け OSアナライザー結果ページ 超詳細タスク分解

## 📌 タスク実行の前提条件

### 必須確認事項
```bash
# 作業開始前に必ず実行
cd /Users/hideakimacbookair/Desktop/haqei-analyzer
ls -la public/js/components/  # ディレクトリ存在確認
ls -la public/js/shared/core/  # StorageManager.js存在確認
```

---

## 🔴 Phase 1: 基盤復旧タスク（合計時間：4時間）

### 📁 Task 1.1: ディレクトリ構造の準備（15分）

#### Task 1.1.1: componentsディレクトリ作成（5分）
```bash
# 実行コマンド
mkdir -p public/js/components
# 確認コマンド
ls -la public/js/components/
```
**成功条件**: ディレクトリが作成される

#### Task 1.1.2: os-analyzerディレクトリ構造作成（5分）
```bash
mkdir -p public/js/os-analyzer/core
mkdir -p public/js/os-analyzer/components
mkdir -p public/js/os-analyzer/data
# 確認
tree public/js/os-analyzer/
```
**成功条件**: 3つのサブディレクトリが作成される

#### Task 1.1.3: shared/coreディレクトリ確認（5分）
```bash
ls -la public/js/shared/core/
# StorageManager.jsが存在することを確認
cat public/js/shared/core/StorageManager.js | head -20
```
**成功条件**: StorageManager.jsの存在確認

---

### 📝 Task 1.2: VirtualPersonaResultsView.js作成（45分）

#### Task 1.2.1: ファイル作成と基本構造（10分）
```javascript
// ファイル: public/js/components/VirtualPersonaResultsView.js
// 以下の内容を記述

/**
 * VirtualPersonaResultsView
 * OSアナライザー結果表示用メインビュー
 * 作成日: 2025-08-18
 * 作成者: TRAE
 */

class VirtualPersonaResultsView {
    constructor() {
        console.log('🎯 VirtualPersonaResultsView: コンストラクタ開始');
        this.container = null;
        this.storageManager = null;
        this.isInitialized = false;
    }
}

// グローバルスコープに公開
window.VirtualPersonaResultsView = VirtualPersonaResultsView;
console.log('✅ VirtualPersonaResultsView.js loaded');
```
**成功条件**: ファイルが作成され、console.logが出力される

#### Task 1.2.2: 初期化メソッド実装（15分）
```javascript
// initializeメソッドを追加
async initialize() {
    console.log('🚀 VirtualPersonaResultsView: 初期化開始');
    
    try {
        // Step 1: DOM要素取得
        this.container = document.getElementById('virtual-persona-container');
        if (!this.container) {
            throw new Error('virtual-persona-containerが見つかりません');
        }
        console.log('✅ コンテナ要素取得成功');
        
        // Step 2: StorageManager初期化
        if (typeof StorageManager !== 'undefined') {
            this.storageManager = new StorageManager();
            console.log('✅ StorageManager初期化成功');
        } else {
            console.warn('⚠️ StorageManagerが見つかりません - スタブモード');
            this.storageManager = this.createStorageManagerStub();
        }
        
        // Step 3: データ読み込み
        await this.loadAnalysisData();
        
        // Step 4: 初期レンダリング
        this.render();
        
        this.isInitialized = true;
        console.log('✅ VirtualPersonaResultsView: 初期化完了');
        
    } catch (error) {
        console.error('❌ VirtualPersonaResultsView初期化エラー:', error);
        this.showError(error.message);
        throw error;
    }
}
```
**成功条件**: エラーなくメソッドが追加される

#### Task 1.2.3: データ読み込みメソッド実装（10分）
```javascript
// loadAnalysisDataメソッドを追加
async loadAnalysisData() {
    console.log('📊 データ読み込み開始');
    
    try {
        // localStorageから各種データを取得
        this.answers = this.storageManager.getAnswers() || [];
        this.tripleOSData = this.storageManager.getTripleOSAnalysis() || null;
        
        console.log('📝 取得したデータ:', {
            answersCount: this.answers.length,
            hasTripleOS: !!this.tripleOSData
        });
        
        // データ検証
        if (this.answers.length === 0) {
            console.warn('⚠️ 回答データが空です');
        }
        
        if (!this.tripleOSData) {
            console.warn('⚠️ Triple OSデータがありません - ダミーデータ使用');
            this.tripleOSData = this.createDummyTripleOSData();
        }
        
    } catch (error) {
        console.error('❌ データ読み込みエラー:', error);
        // エラーでも続行（ダミーデータ使用）
        this.tripleOSData = this.createDummyTripleOSData();
    }
}
```
**成功条件**: データ読み込み処理が実装される

#### Task 1.2.4: レンダリングメソッド実装（10分）
```javascript
// renderメソッドを追加
render() {
    console.log('🎨 レンダリング開始');
    
    if (!this.container) {
        console.error('❌ コンテナが設定されていません');
        return;
    }
    
    // ローディング非表示
    const loadingOverlay = document.getElementById('loading-overlay');
    if (loadingOverlay) {
        loadingOverlay.classList.remove('active');
    }
    
    // 基本的なHTML構造を生成
    this.container.innerHTML = `
        <div class="vp-main-content">
            <header class="results-header">
                <h1 class="results-title">🔍 OSアナライザー分析結果</h1>
                <p class="results-subtitle">あなたの3つのOSシステムを解析しました</p>
            </header>
            
            <div class="results-body">
                <div id="os-cards-container" class="os-cards-container">
                    <!-- OSカードがここに挿入されます -->
                    <div class="loading-message">データを処理中...</div>
                </div>
                
                <div id="analysis-details" class="analysis-details">
                    <!-- 詳細分析がここに表示されます -->
                </div>
            </div>
            
            <footer class="results-footer">
                <button class="btn-back" onclick="history.back()">戻る</button>
                <button class="btn-save" onclick="window.print()">保存</button>
            </footer>
        </div>
    `;
    
    console.log('✅ 基本レンダリング完了');
    
    // Triple OSカードを表示
    if (this.tripleOSData) {
        this.renderTripleOSCards();
    }
}
```
**成功条件**: HTMLが正しく生成される

---

### 🛠️ Task 1.3: 必須サポートファイル作成（45分）

#### Task 1.3.1: BaseComponent.js作成（15分）
```javascript
// ファイル: public/js/shared/core/BaseComponent.js

/**
 * BaseComponent - 全コンポーネントの基底クラス
 */
class BaseComponent {
    constructor(container) {
        this.container = container;
        this.eventListeners = [];
        console.log(`✅ ${this.constructor.name} created`);
    }
    
    // イベントリスナー管理
    addEventListener(element, event, handler) {
        element.addEventListener(event, handler);
        this.eventListeners.push({ element, event, handler });
    }
    
    // クリーンアップ
    destroy() {
        this.eventListeners.forEach(({ element, event, handler }) => {
            element.removeEventListener(event, handler);
        });
        this.eventListeners = [];
        console.log(`🗑️ ${this.constructor.name} destroyed`);
    }
    
    // HTML生成ヘルパー
    createElement(tag, className, innerHTML = '') {
        const element = document.createElement(tag);
        if (className) element.className = className;
        if (innerHTML) element.innerHTML = innerHTML;
        return element;
    }
}

window.BaseComponent = BaseComponent;
console.log('✅ BaseComponent.js loaded');
```
**成功条件**: BaseComponentクラスが利用可能になる

#### Task 1.3.2: DataManager.js作成（15分）
```javascript
// ファイル: public/js/shared/core/DataManager.js

/**
 * DataManager - データ管理クラス
 */
class DataManager {
    constructor() {
        this.cache = {};
        this.isLoaded = false;
        console.log('📊 DataManager initialized');
    }
    
    async loadData() {
        console.log('📁 DataManager: データ読み込み開始');
        
        try {
            // 各種データファイルの存在確認
            if (typeof window.questionsData !== 'undefined') {
                this.cache.questions = window.questionsData;
                console.log('✅ 質問データ読み込み成功');
            }
            
            if (typeof window.vectorsData !== 'undefined') {
                this.cache.vectors = window.vectorsData;
                console.log('✅ ベクターデータ読み込み成功');
            }
            
            if (typeof window.hexagramsData !== 'undefined') {
                this.cache.hexagrams = window.hexagramsData;
                console.log('✅ 易卦データ読み込み成功');
            }
            
            this.isLoaded = true;
            return true;
            
        } catch (error) {
            console.error('❌ DataManager: データ読み込みエラー', error);
            return false;
        }
    }
    
    getData(key) {
        return this.cache[key] || null;
    }
    
    setData(key, value) {
        this.cache[key] = value;
        console.log(`📝 DataManager: ${key} saved`);
    }
}

window.DataManager = DataManager;
console.log('✅ DataManager.js loaded');
```
**成功条件**: DataManagerクラスが利用可能になる

#### Task 1.3.3: ErrorHandler.js作成（15分）
```javascript
// ファイル: public/js/shared/core/ErrorHandler.js

/**
 * ErrorHandler - エラー処理クラス
 */
class ErrorHandler {
    constructor() {
        this.errors = [];
        this.setupGlobalHandler();
        console.log('🛡️ ErrorHandler initialized');
    }
    
    setupGlobalHandler() {
        window.addEventListener('error', (event) => {
            this.handleError(event.error, 'Global');
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            this.handleError(event.reason, 'Promise');
        });
    }
    
    handleError(error, context = 'Unknown') {
        console.error(`❌ [${context}] Error:`, error);
        
        const errorInfo = {
            message: error?.message || String(error),
            stack: error?.stack || '',
            context: context,
            timestamp: new Date().toISOString()
        };
        
        this.errors.push(errorInfo);
        this.showUserError(errorInfo);
        
        return errorInfo;
    }
    
    showUserError(errorInfo) {
        // エラーコンテナを探す
        let errorContainer = document.getElementById('error-container');
        
        if (!errorContainer) {
            // エラーコンテナがなければ作成
            errorContainer = document.createElement('div');
            errorContainer.id = 'error-container';
            errorContainer.className = 'error-container';
            document.body.appendChild(errorContainer);
        }
        
        // エラーメッセージ表示
        errorContainer.innerHTML = `
            <div class="error-content">
                <h3>⚠️ エラーが発生しました</h3>
                <p>${errorInfo.message}</p>
                <small>${errorInfo.context} - ${new Date(errorInfo.timestamp).toLocaleTimeString()}</small>
                <button onclick="this.parentElement.parentElement.style.display='none'">閉じる</button>
            </div>
        `;
        
        errorContainer.style.display = 'block';
        
        // 5秒後に自動で非表示
        setTimeout(() => {
            errorContainer.style.display = 'none';
        }, 5000);
    }
    
    getErrors() {
        return this.errors;
    }
    
    clearErrors() {
        this.errors = [];
        console.log('🧹 ErrorHandler: エラーログをクリア');
    }
}

window.ErrorHandler = ErrorHandler;
window.errorHandler = new ErrorHandler();
console.log('✅ ErrorHandler.js loaded and activated');
```
**成功条件**: グローバルエラーハンドラーが動作する

---

### 🔧 Task 1.4: ヘルパーメソッド実装（30分）

#### Task 1.4.1: StorageManagerスタブ作成（10分）
```javascript
// VirtualPersonaResultsView.jsに追加
createStorageManagerStub() {
    console.warn('📦 StorageManagerスタブを作成');
    
    return {
        getAnswers: () => {
            console.log('📝 スタブ: getAnswers呼び出し');
            // ダミーの回答データ（36問分）
            return Array(36).fill(null).map((_, i) => ({
                questionId: i + 1,
                answer: Math.floor(Math.random() * 5) + 1
            }));
        },
        
        getTripleOSAnalysis: () => {
            console.log('📊 スタブ: getTripleOSAnalysis呼び出し');
            return null; // 意図的にnullを返してダミーデータ生成をトリガー
        },
        
        saveData: (key, value) => {
            console.log(`💾 スタブ: saveData(${key})`);
            localStorage.setItem(key, JSON.stringify(value));
        },
        
        getData: (key) => {
            console.log(`📖 スタブ: getData(${key})`);
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        }
    };
}
```
**成功条件**: StorageManagerが存在しない場合でも動作する

#### Task 1.4.2: ダミーデータ生成メソッド（10分）
```javascript
// VirtualPersonaResultsView.jsに追加
createDummyTripleOSData() {
    console.log('🎲 ダミーTriple OSデータを生成');
    
    return {
        engineOS: {
            name: "価値観システム（Engine OS）",
            score: Math.floor(Math.random() * 30) + 70, // 70-100
            percentage: "85%",
            hexagram: "乾為天",
            hexagramNumber: 1,
            description: "あなたの核となる価値観を表すシステムです",
            traits: ["リーダーシップ", "創造性", "独立心"],
            color: "#3B82F6"
        },
        interfaceOS: {
            name: "社会的システム（Interface OS）",
            score: Math.floor(Math.random() * 30) + 60, // 60-90
            percentage: "72%",
            hexagram: "風火家人",
            hexagramNumber: 37,
            description: "他者との関わり方を管理するシステムです",
            traits: ["協調性", "コミュニケーション", "適応力"],
            color: "#10B981"
        },
        safeModeOS: {
            name: "防御システム（SafeMode OS）",
            score: Math.floor(Math.random() * 30) + 50, // 50-80
            percentage: "68%",
            hexagram: "山雷頤",
            hexagramNumber: 27,
            description: "ストレス時の対処法を制御するシステムです",
            traits: ["慎重性", "分析力", "安定志向"],
            color: "#F59E0B"
        },
        timestamp: new Date().toISOString(),
        version: "1.0.0"
    };
}
```
**成功条件**: ダミーデータが正しい構造で生成される

#### Task 1.4.3: エラー表示メソッド（10分）
```javascript
// VirtualPersonaResultsView.jsに追加
showError(message) {
    console.error('🚨 エラー表示:', message);
    
    if (this.container) {
        this.container.innerHTML = `
            <div class="error-display">
                <div class="error-icon">⚠️</div>
                <h2>エラーが発生しました</h2>
                <p>${message}</p>
                <button onclick="location.reload()" class="btn-retry">
                    再読み込み
                </button>
                <button onclick="history.back()" class="btn-back">
                    前のページに戻る
                </button>
            </div>
        `;
    }
    
    // グローバルエラーハンドラーにも通知
    if (window.errorHandler) {
        window.errorHandler.handleError(new Error(message), 'VirtualPersonaResultsView');
    }
}
```
**成功条件**: エラーが適切に表示される

---

### 🎨 Task 1.5: CSS基本スタイル作成（30分）

#### Task 1.5.1: results-page.css作成（15分）
```css
/* ファイル: public/css/results-page.css */

/* 基本レイアウト */
.vp-main-content {
    min-height: 100vh;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.results-header {
    text-align: center;
    padding: 40px 20px;
    color: white;
}

.results-title {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 10px;
}

.results-subtitle {
    font-size: 1.2rem;
    opacity: 0.9;
}

.results-body {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.os-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.loading-message {
    grid-column: 1 / -1;
    text-align: center;
    padding: 40px;
    color: white;
    font-size: 1.2rem;
}

.results-footer {
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 40px 20px;
}

.btn-back, .btn-save {
    padding: 12px 24px;
    font-size: 1rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-back {
    background: white;
    color: #667eea;
}

.btn-save {
    background: #10B981;
    color: white;
}

.btn-back:hover, .btn-save:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}
```
**成功条件**: CSSファイルが作成される

#### Task 1.5.2: エラー表示用CSS追加（10分）
```css
/* results-page.cssに追加 */

/* エラー表示 */
.error-display {
    background: white;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    max-width: 500px;
    margin: 100px auto;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
}

.error-icon {
    font-size: 4rem;
    margin-bottom: 20px;
}

.error-display h2 {
    color: #EF4444;
    margin-bottom: 10px;
}

.error-display p {
    color: #6B7280;
    margin-bottom: 30px;
}

.btn-retry, .btn-back {
    margin: 0 10px;
}

/* エラーコンテナ（グローバル） */
.error-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    max-width: 400px;
}

.error-content {
    background: #FEE2E2;
    border: 2px solid #EF4444;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
}

.error-content h3 {
    color: #991B1B;
    margin-bottom: 10px;
}

.error-content p {
    color: #7F1D1D;
    margin-bottom: 5px;
}

.error-content small {
    color: #991B1B;
    opacity: 0.8;
}

.error-content button {
    margin-top: 10px;
    padding: 5px 15px;
    background: #EF4444;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
```
**成功条件**: エラー表示が適切にスタイリングされる

#### Task 1.5.3: results.htmlにCSS追加（5分）
```html
<!-- results.htmlの<head>セクションに追加 -->
<!-- 既存のCSS読み込みの後に追加 -->
<link rel="stylesheet" href="css/results-page.css">
```
**確認コマンド**:
```bash
grep "results-page.css" public/results.html
```
**成功条件**: CSSファイルが読み込まれる

---

### ✅ Task 1.6: Phase 1統合テスト（45分）

#### Task 1.6.1: ブラウザで基本動作確認（15分）
```bash
# サーバー起動
cd /Users/hideakimacbookair/Desktop/haqei-analyzer
python3 -m http.server 8000

# ブラウザで開く
# http://localhost:8000/public/results.html
```
**チェック項目**:
- [ ] ページが読み込まれる
- [ ] コンソールにエラーがない
- [ ] "OSアナライザー分析結果"のタイトルが表示される
- [ ] ローディングが非表示になる

#### Task 1.6.2: コンソールログ確認（10分）
```javascript
// ブラウザのコンソールで以下を確認
// 期待されるログ:
// ✅ BaseComponent.js loaded
// ✅ DataManager.js loaded
// ✅ ErrorHandler.js loaded and activated
// ✅ VirtualPersonaResultsView.js loaded
// 🎯 VirtualPersonaResultsView: コンストラクタ開始
// 🚀 VirtualPersonaResultsView: 初期化開始
// ✅ コンテナ要素取得成功
// ✅ StorageManager初期化成功
// 📊 データ読み込み開始
// 🎨 レンダリング開始
// ✅ 基本レンダリング完了
```
**成功条件**: 全ての初期化ログが順番に表示される

#### Task 1.6.3: エラーハンドリングテスト（10分）
```javascript
// コンソールで意図的にエラーを発生させる
throw new Error("テストエラー");

// 期待される動作:
// 1. エラーコンテナが表示される
// 2. エラーメッセージが表示される
// 3. 5秒後に自動で非表示になる
```
**成功条件**: エラーが適切に表示される

#### Task 1.6.4: localStorageテスト（10分）
```javascript
// コンソールでダミーデータを設定
localStorage.setItem('haqei_answers', JSON.stringify([
    {questionId: 1, answer: 3},
    {questionId: 2, answer: 4},
    {questionId: 3, answer: 2}
]));

// ページをリロード
location.reload();

// コンソールで確認
// "📝 取得したデータ: {answersCount: 3, hasTripleOS: false}"
```
**成功条件**: localStorageのデータが読み込まれる

---

## 🟡 Phase 2: Triple OS表示タスク（合計時間：5時間）

### 📊 Task 2.1: OSカードコンポーネント作成（60分）

#### Task 2.1.1: OSCard.js作成（20分）
```javascript
// ファイル: public/js/components/OSCard.js

class OSCard {
    constructor(osData, type) {
        this.data = osData;
        this.type = type; // 'engine', 'interface', 'safemode'
        this.element = null;
    }
    
    render() {
        const card = document.createElement('div');
        card.className = `os-card os-card-${this.type}`;
        card.setAttribute('data-aos', 'fade-up');
        
        card.innerHTML = `
            <div class="os-card-header">
                <div class="os-card-icon">${this.getIcon()}</div>
                <h3 class="os-card-title">${this.data.name}</h3>
            </div>
            
            <div class="os-card-body">
                <div class="os-score-container">
                    <div class="os-score-circle">
                        <svg width="120" height="120">
                            <circle cx="60" cy="60" r="54" 
                                stroke="#e5e7eb" stroke-width="12" fill="none"/>
                            <circle cx="60" cy="60" r="54" 
                                stroke="${this.data.color}" 
                                stroke-width="12" fill="none"
                                stroke-dasharray="${this.calculateDashArray()}"
                                stroke-dashoffset="0"
                                class="os-score-progress"/>
                        </svg>
                        <div class="os-score-text">${this.data.percentage}</div>
                    </div>
                </div>
                
                <div class="os-hexagram">
                    <span class="hexagram-name">${this.data.hexagram}</span>
                    <span class="hexagram-number">#${this.data.hexagramNumber}</span>
                </div>
                
                <p class="os-description">${this.data.description}</p>
                
                <div class="os-traits">
                    ${this.data.traits.map(trait => 
                        `<span class="trait-badge">${trait}</span>`
                    ).join('')}
                </div>
            </div>
            
            <div class="os-card-footer">
                <button class="btn-details" data-os="${this.type}">
                    詳細を見る
                </button>
            </div>
        `;
        
        this.element = card;
        this.attachEventListeners();
        return card;
    }
    
    getIcon() {
        const icons = {
            engine: '⚙️',
            interface: '🔗',
            safemode: '🛡️'
        };
        return icons[this.type] || '📊';
    }
    
    calculateDashArray() {
        const circumference = 2 * Math.PI * 54;
        const progress = (this.data.score / 100) * circumference;
        return `${progress} ${circumference}`;
    }
    
    attachEventListeners() {
        const btn = this.element.querySelector('.btn-details');
        btn.addEventListener('click', () => {
            console.log(`📖 ${this.type} OSの詳細を表示`);
            this.showDetails();
        });
    }
    
    showDetails() {
        // 詳細モーダル表示（Phase 3で実装）
        alert(`${this.data.name}の詳細\n\n${JSON.stringify(this.data, null, 2)}`);
    }
}

window.OSCard = OSCard;
console.log('✅ OSCard.js loaded');
```
**成功条件**: OSCardクラスが作成される

#### Task 2.1.2: VirtualPersonaResultsViewにカード表示メソッド追加（20分）
```javascript
// VirtualPersonaResultsView.jsに追加
renderTripleOSCards() {
    console.log('🎴 Triple OSカードを表示');
    
    const container = document.getElementById('os-cards-container');
    if (!container) {
        console.error('❌ os-cards-containerが見つかりません');
        return;
    }
    
    // ローディングメッセージをクリア
    container.innerHTML = '';
    
    // OSカードを作成
    const osTypes = [
        { type: 'engine', data: this.tripleOSData.engineOS },
        { type: 'interface', data: this.tripleOSData.interfaceOS },
        { type: 'safemode', data: this.tripleOSData.safeModeOS }
    ];
    
    osTypes.forEach((os, index) => {
        if (typeof OSCard !== 'undefined') {
            const card = new OSCard(os.data, os.type);
            const cardElement = card.render();
            
            // アニメーション遅延を設定
            cardElement.style.animationDelay = `${index * 0.2}s`;
            
            container.appendChild(cardElement);
            console.log(`✅ ${os.type} OSカード追加`);
        } else {
            console.error('❌ OSCardクラスが見つかりません');
            // フォールバック: シンプルなカード表示
            container.innerHTML += this.createSimpleOSCard(os.data, os.type);
        }
    });
    
    console.log('✅ 全OSカード表示完了');
}

// シンプルなカード表示（フォールバック）
createSimpleOSCard(data, type) {
    return `
        <div class="os-card-simple os-card-${type}">
            <h3>${data.name}</h3>
            <div class="score">${data.percentage}</div>
            <div class="hexagram">${data.hexagram}</div>
            <p>${data.description}</p>
        </div>
    `;
}
```
**成功条件**: カードが3枚表示される

#### Task 2.1.3: results.htmlにOSCard.js追加（5分）
```html
<!-- results.htmlのスクリプトセクションに追加 -->
<!-- VirtualPersonaResultsView.jsの前に追加 -->
<script type="text/javascript" src="./js/components/OSCard.js"></script>
```
**成功条件**: OSCard.jsが読み込まれる

#### Task 2.1.4: OSカード用CSS作成（15分）
```css
/* results-page.cssに追加 */

/* OSカードスタイル */
.os-card {
    background: white;
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    animation: fadeInUp 0.6s ease both;
}

.os-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

.os-card-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
}

.os-card-icon {
    font-size: 2rem;
    margin-right: 10px;
}

.os-card-title {
    font-size: 1.2rem;
    font-weight: bold;
    color: #1F2937;
}

.os-score-container {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 20px auto;
}

.os-score-circle {
    position: relative;
}

.os-score-progress {
    transform: rotate(-90deg);
    transform-origin: center;
    transition: stroke-dasharray 1s ease;
}

.os-score-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.5rem;
    font-weight: bold;
    color: #1F2937;
}

.os-hexagram {
    text-align: center;
    margin: 20px 0;
    padding: 10px;
    background: #F3F4F6;
    border-radius: 8px;
}

.hexagram-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: #374151;
}

.hexagram-number {
    display: block;
    font-size: 0.9rem;
    color: #6B7280;
    margin-top: 5px;
}

.os-description {
    color: #4B5563;
    line-height: 1.6;
    margin: 20px 0;
}

.os-traits {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 20px 0;
}

.trait-badge {
    padding: 4px 12px;
    background: #EBF8FF;
    color: #2563EB;
    border-radius: 20px;
    font-size: 0.9rem;
}

.os-card-footer {
    margin-top: 20px;
    text-align: center;
}

.btn-details {
    padding: 10px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.btn-details:hover {
    transform: scale(1.05);
}

/* カードタイプ別のカラー */
.os-card-engine .os-score-progress {
    stroke: #3B82F6;
}

.os-card-interface .os-score-progress {
    stroke: #10B981;
}

.os-card-safemode .os-score-progress {
    stroke: #F59E0B;
}

/* アニメーション */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* シンプルカード（フォールバック） */
.os-card-simple {
    background: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.os-card-simple .score {
    font-size: 2rem;
    font-weight: bold;
    color: #667eea;
    margin: 10px 0;
}

.os-card-simple .hexagram {
    font-size: 1.1rem;
    color: #6B7280;
    margin: 10px 0;
}
```
**成功条件**: カードが美しく表示される

---

### 📈 Task 2.2: データ分析エンジン基礎（60分）

#### Task 2.2.1: TripleOSEngine.js作成（30分）
```javascript
// ファイル: public/js/os-analyzer/core/TripleOSEngine.js

class TripleOSEngine {
    constructor() {
        this.hexagrams = this.loadHexagrams();
        console.log('🔮 TripleOSEngine initialized');
    }
    
    loadHexagrams() {
        // 64卦の基本データ
        return [
            { number: 1, name: "乾為天", meaning: "創造力と力" },
            { number: 2, name: "坤為地", meaning: "受容と従順" },
            { number: 3, name: "水雷屯", meaning: "困難の始まり" },
            { number: 4, name: "山水蒙", meaning: "若さと無知" },
            // ... 実際は64個
        ];
    }
    
    analyzeAnswers(answers) {
        console.log('🔍 回答分析開始:', answers.length, '問');
        
        // 回答をスコア化
        const scores = this.calculateScores(answers);
        
        // Triple OSを決定
        const engineOS = this.determineEngineOS(scores);
        const interfaceOS = this.determineInterfaceOS(scores);
        const safeModeOS = this.determineSafeModeOS(scores);
        
        return {
            engineOS,
            interfaceOS,
            safeModeOS,
            scores,
            timestamp: new Date().toISOString()
        };
    }
    
    calculateScores(answers) {
        // 各質問の回答を0-100のスコアに変換
        const scoreMap = {
            1: 20,  // 全く当てはまらない
            2: 40,  // あまり当てはまらない
            3: 60,  // どちらともいえない
            4: 80,  // やや当てはまる
            5: 100  // 非常に当てはまる
        };
        
        return answers.map(a => ({
            questionId: a.questionId,
            score: scoreMap[a.answer] || 60
        }));
    }
    
    determineEngineOS(scores) {
        // Engine OS: 質問1-12の平均
        const engineQuestions = scores.slice(0, 12);
        const avgScore = this.calculateAverage(engineQuestions);
        
        return {
            name: "価値観システム（Engine OS）",
            score: avgScore,
            percentage: `${Math.round(avgScore)}%`,
            hexagram: this.selectHexagram(avgScore, 'engine'),
            hexagramNumber: this.getHexagramNumber(avgScore, 'engine'),
            description: this.getEngineDescription(avgScore),
            traits: this.getEngineTraits(avgScore),
            color: "#3B82F6"
        };
    }
    
    determineInterfaceOS(scores) {
        // Interface OS: 質問13-24の平均
        const interfaceQuestions = scores.slice(12, 24);
        const avgScore = this.calculateAverage(interfaceQuestions);
        
        return {
            name: "社会的システム（Interface OS）",
            score: avgScore,
            percentage: `${Math.round(avgScore)}%`,
            hexagram: this.selectHexagram(avgScore, 'interface'),
            hexagramNumber: this.getHexagramNumber(avgScore, 'interface'),
            description: this.getInterfaceDescription(avgScore),
            traits: this.getInterfaceTraits(avgScore),
            color: "#10B981"
        };
    }
    
    determineSafeModeOS(scores) {
        // SafeMode OS: 質問25-36の平均
        const safeModeQuestions = scores.slice(24, 36);
        const avgScore = this.calculateAverage(safeModeQuestions);
        
        return {
            name: "防御システム（SafeMode OS）",
            score: avgScore,
            percentage: `${Math.round(avgScore)}%`,
            hexagram: this.selectHexagram(avgScore, 'safemode'),
            hexagramNumber: this.getHexagramNumber(avgScore, 'safemode'),
            description: this.getSafeModeDescription(avgScore),
            traits: this.getSafeModeTraits(avgScore),
            color: "#F59E0B"
        };
    }
    
    calculateAverage(scores) {
        const sum = scores.reduce((acc, s) => acc + s.score, 0);
        return Math.round(sum / scores.length);
    }
    
    selectHexagram(score, type) {
        // スコアに基づいて適切な易卦を選択
        const hexagramMap = {
            engine: {
                high: "乾為天",    // 81-100
                medium: "離為火",  // 61-80
                low: "巽為風"      // 0-60
            },
            interface: {
                high: "兌為沢",
                medium: "風火家人",
                low: "坎為水"
            },
            safemode: {
                high: "艮為山",
                medium: "山雷頤",
                low: "震為雷"
            }
        };
        
        let level = 'low';
        if (score > 80) level = 'high';
        else if (score > 60) level = 'medium';
        
        return hexagramMap[type][level];
    }
    
    getHexagramNumber(score, type) {
        // 仮の番号割り当て（実際は複雑なロジック）
        return Math.floor((score / 100) * 64) + 1;
    }
    
    getEngineDescription(score) {
        if (score > 80) return "強固な価値観を持ち、自己の信念に従って行動します";
        if (score > 60) return "バランスの取れた価値観を持ち、状況に応じて柔軟に対応します";
        return "価値観を探求中で、様々な可能性を模索しています";
    }
    
    getInterfaceDescription(score) {
        if (score > 80) return "社交的で、他者との関係構築に優れています";
        if (score > 60) return "適度な社交性を持ち、必要に応じて関係を築きます";
        return "内向的で、少数の深い関係を大切にします";
    }
    
    getSafeModeDescription(score) {
        if (score > 80) return "強固な防御システムを持ち、ストレスに強い耐性があります";
        if (score > 60) return "適度な防御力を持ち、バランスよく対処します";
        return "柔軟な対処法を持ち、状況に応じて適応します";
    }
    
    getEngineTraits(score) {
        if (score > 80) return ["リーダーシップ", "決断力", "独創性"];
        if (score > 60) return ["バランス感覚", "適応力", "創造性"];
        return ["探究心", "柔軟性", "成長志向"];
    }
    
    getInterfaceTraits(score) {
        if (score > 80) return ["社交性", "共感力", "コミュニケーション"];
        if (score > 60) return ["協調性", "適応力", "観察力"];
        return ["内省的", "誠実性", "深い洞察"];
    }
    
    getSafeModeTraits(score) {
        if (score > 80) return ["忍耐力", "回復力", "安定性"];
        if (score > 60) return ["柔軟性", "バランス", "対処力"];
        return ["適応性", "創造的対処", "変化受容"];
    }
}

window.TripleOSEngine = TripleOSEngine;
console.log('✅ TripleOSEngine.js loaded');
```
**成功条件**: TripleOSEngineが動作する

#### Task 2.2.2: VirtualPersonaResultsViewに分析機能統合（15分）
```javascript
// loadAnalysisDataメソッドを更新
async loadAnalysisData() {
    console.log('📊 データ読み込み開始');
    
    try {
        // localStorageから各種データを取得
        this.answers = this.storageManager.getAnswers() || [];
        this.tripleOSData = this.storageManager.getTripleOSAnalysis() || null;
        
        console.log('📝 取得したデータ:', {
            answersCount: this.answers.length,
            hasTripleOS: !!this.tripleOSData
        });
        
        // Triple OSデータがない場合は分析を実行
        if (!this.tripleOSData && this.answers.length > 0) {
            console.log('🔬 Triple OS分析を実行');
            
            if (typeof TripleOSEngine !== 'undefined') {
                const engine = new TripleOSEngine();
                this.tripleOSData = engine.analyzeAnswers(this.answers);
                
                // 分析結果を保存
                this.storageManager.saveData('tripleOSAnalysis', this.tripleOSData);
                console.log('✅ Triple OS分析完了');
            } else {
                console.warn('⚠️ TripleOSEngineが見つかりません');
                this.tripleOSData = this.createDummyTripleOSData();
            }
        } else if (!this.tripleOSData) {
            console.warn('⚠️ データ不足 - ダミーデータ使用');
            this.tripleOSData = this.createDummyTripleOSData();
        }
        
    } catch (error) {
        console.error('❌ データ読み込みエラー:', error);
        this.tripleOSData = this.createDummyTripleOSData();
    }
}
```
**成功条件**: 回答データから自動的にTriple OSが計算される

#### Task 2.2.3: results.htmlにTripleOSEngine追加（5分）
```html
<!-- results.htmlのスクリプトセクションに追加 -->
<!-- OSCard.jsの後に追加 -->
<script type="text/javascript" src="./js/os-analyzer/core/TripleOSEngine.js"></script>
```
**成功条件**: TripleOSEngine.jsが読み込まれる

#### Task 2.2.4: 分析結果の永続化確認（10分）
```javascript
// ブラウザコンソールでテスト
// テストデータを設定
const testAnswers = Array(36).fill(null).map((_, i) => ({
    questionId: i + 1,
    answer: Math.floor(Math.random() * 5) + 1
}));

localStorage.setItem('haqei_answers', JSON.stringify(testAnswers));
localStorage.removeItem('tripleOSAnalysis'); // 既存の分析をクリア

// ページリロード
location.reload();

// 分析が実行されることを確認
// コンソールに "🔬 Triple OS分析を実行" が表示される

// 結果が保存されたことを確認
const saved = JSON.parse(localStorage.getItem('tripleOSAnalysis'));
console.log('保存された分析結果:', saved);
```
**成功条件**: 分析結果がlocalStorageに保存される

---

### 📊 Task 2.3: 詳細情報セクション（45分）

#### Task 2.3.1: AnalysisDetails.js作成（20分）
```javascript
// ファイル: public/js/components/AnalysisDetails.js

class AnalysisDetails {
    constructor(tripleOSData) {
        this.data = tripleOSData;
        this.container = null;
    }
    
    render() {
        const details = document.createElement('div');
        details.className = 'analysis-details-content';
        
        details.innerHTML = `
            <h2 class="details-title">📊 詳細分析レポート</h2>
            
            <div class="details-sections">
                ${this.renderSummarySection()}
                ${this.renderComparisonSection()}
                ${this.renderRecommendationSection()}
            </div>
        `;
        
        return details;
    }
    
    renderSummarySection() {
        return `
            <section class="detail-section">
                <h3>💡 総合分析</h3>
                <div class="summary-content">
                    <p>あなたのTriple OSシステムは以下の特徴を示しています：</p>
                    <ul>
                        <li><strong>${this.data.engineOS.name}</strong>: ${this.data.engineOS.percentage} - ${this.getStrengthLevel(this.data.engineOS.score)}</li>
                        <li><strong>${this.data.interfaceOS.name}</strong>: ${this.data.interfaceOS.percentage} - ${this.getStrengthLevel(this.data.interfaceOS.score)}</li>
                        <li><strong>${this.data.safeModeOS.name}</strong>: ${this.data.safeModeOS.percentage} - ${this.getStrengthLevel(this.data.safeModeOS.score)}</li>
                    </ul>
                    <div class="balance-indicator">
                        <span>システムバランス: </span>
                        <span class="balance-score">${this.calculateBalance()}%</span>
                    </div>
                </div>
            </section>
        `;
    }
    
    renderComparisonSection() {
        return `
            <section class="detail-section">
                <h3>⚖️ OS間の相互作用</h3>
                <div class="comparison-content">
                    <div class="comparison-item">
                        <h4>価値観と社会性の調和</h4>
                        <p>${this.analyzeEngineInterface()}</p>
                    </div>
                    <div class="comparison-item">
                        <h4>価値観と防御の関係</h4>
                        <p>${this.analyzeEngineSafeMode()}</p>
                    </div>
                    <div class="comparison-item">
                        <h4>社会性と防御のバランス</h4>
                        <p>${this.analyzeInterfaceSafeMode()}</p>
                    </div>
                </div>
            </section>
        `;
    }
    
    renderRecommendationSection() {
        return `
            <section class="detail-section">
                <h3>🎯 実践的アドバイス</h3>
                <div class="recommendation-content">
                    <div class="advice-card">
                        <h4>強みを活かす方法</h4>
                        <ul>
                            ${this.getStrengths().map(s => `<li>${s}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="advice-card">
                        <h4>成長の機会</h4>
                        <ul>
                            ${this.getGrowthAreas().map(g => `<li>${g}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="advice-card">
                        <h4>今日から始められること</h4>
                        <ul>
                            ${this.getActionItems().map(a => `<li>${a}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            </section>
        `;
    }
    
    getStrengthLevel(score) {
        if (score > 80) return "非常に強い";
        if (score > 60) return "バランス型";
        return "発展途上";
    }
    
    calculateBalance() {
        const scores = [
            this.data.engineOS.score,
            this.data.interfaceOS.score,
            this.data.safeModeOS.score
        ];
        
        const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
        const variance = scores.reduce((sum, score) => 
            sum + Math.pow(score - avg, 2), 0) / scores.length;
        const stdDev = Math.sqrt(variance);
        
        // 標準偏差が小さいほどバランスが良い
        const balance = Math.max(0, 100 - stdDev * 2);
        return Math.round(balance);
    }
    
    analyzeEngineInterface() {
        const diff = Math.abs(this.data.engineOS.score - this.data.interfaceOS.score);
        
        if (diff < 10) {
            return "価値観と社会的表現が調和しており、内外の一致が見られます。";
        } else if (this.data.engineOS.score > this.data.interfaceOS.score) {
            return "内なる価値観が強く、それを社会的に表現する機会を増やすと良いでしょう。";
        } else {
            return "社会的な適応力が高く、自己の価値観をより明確にする時期かもしれません。";
        }
    }
    
    analyzeEngineSafeMode() {
        const diff = Math.abs(this.data.engineOS.score - this.data.safeModeOS.score);
        
        if (diff < 10) {
            return "価値観と防御システムがバランスよく機能しています。";
        } else if (this.data.engineOS.score > this.data.safeModeOS.score) {
            return "強い価値観を持ちながら、柔軟な対処が可能な状態です。";
        } else {
            return "慎重な防御システムが、価値観の表現を守っています。";
        }
    }
    
    analyzeInterfaceSafeMode() {
        const diff = Math.abs(this.data.interfaceOS.score - this.data.safeModeOS.score);
        
        if (diff < 10) {
            return "社会性と防御のバランスが取れており、適応力があります。";
        } else if (this.data.interfaceOS.score > this.data.safeModeOS.score) {
            return "開放的な社交性を持ち、ストレスにも柔軟に対応できます。";
        } else {
            return "慎重な姿勢で社会との関わりを調整しています。";
        }
    }
    
    getStrengths() {
        const strengths = [];
        
        if (this.data.engineOS.score > 70) {
            strengths.push("明確な価値観による決断力");
        }
        if (this.data.interfaceOS.score > 70) {
            strengths.push("優れたコミュニケーション能力");
        }
        if (this.data.safeModeOS.score > 70) {
            strengths.push("高いストレス耐性");
        }
        
        if (strengths.length === 0) {
            strengths.push("バランスの取れた適応力");
            strengths.push("柔軟な思考と行動");
        }
        
        return strengths;
    }
    
    getGrowthAreas() {
        const areas = [];
        
        if (this.data.engineOS.score < 60) {
            areas.push("自己の価値観を明確にする");
        }
        if (this.data.interfaceOS.score < 60) {
            areas.push("社会的なつながりを広げる");
        }
        if (this.data.safeModeOS.score < 60) {
            areas.push("ストレス管理方法を強化する");
        }
        
        if (areas.length === 0) {
            areas.push("さらなる自己理解を深める");
            areas.push("新しい挑戦に取り組む");
        }
        
        return areas;
    }
    
    getActionItems() {
        return [
            "今日の決断を価値観に照らして振り返る",
            "信頼できる人と本音で話す時間を作る",
            "ストレスを感じたら深呼吸して対処法を選ぶ"
        ];
    }
}

window.AnalysisDetails = AnalysisDetails;
console.log('✅ AnalysisDetails.js loaded');
```
**成功条件**: AnalysisDetailsクラスが作成される

#### Task 2.3.2: VirtualPersonaResultsViewに詳細表示統合（10分）
```javascript
// renderメソッドの最後に追加
render() {
    // ... 既存のコード ...
    
    // Triple OSカードを表示
    if (this.tripleOSData) {
        this.renderTripleOSCards();
        this.renderAnalysisDetails(); // 追加
    }
}

// 新しいメソッドを追加
renderAnalysisDetails() {
    console.log('📋 詳細分析を表示');
    
    const container = document.getElementById('analysis-details');
    if (!container) {
        console.error('❌ analysis-detailsが見つかりません');
        return;
    }
    
    if (typeof AnalysisDetails !== 'undefined') {
        const details = new AnalysisDetails(this.tripleOSData);
        container.appendChild(details.render());
        console.log('✅ 詳細分析表示完了');
    } else {
        console.warn('⚠️ AnalysisDetailsクラスが見つかりません');
        container.innerHTML = '<p>詳細分析を読み込めませんでした</p>';
    }
}
```
**成功条件**: 詳細分析セクションが表示される

#### Task 2.3.3: results.htmlにAnalysisDetails追加（5分）
```html
<!-- results.htmlのスクリプトセクションに追加 -->
<!-- TripleOSEngine.jsの後に追加 -->
<script type="text/javascript" src="./js/components/AnalysisDetails.js"></script>
```
**成功条件**: AnalysisDetails.jsが読み込まれる

#### Task 2.3.4: 詳細セクション用CSS（10分）
```css
/* results-page.cssに追加 */

/* 詳細分析セクション */
.analysis-details {
    margin-top: 40px;
}

.analysis-details-content {
    background: white;
    border-radius: 16px;
    padding: 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.details-title {
    font-size: 1.8rem;
    font-weight: bold;
    color: #1F2937;
    margin-bottom: 30px;
    text-align: center;
}

.detail-section {
    margin-bottom: 40px;
    padding-bottom: 30px;
    border-bottom: 1px solid #E5E7EB;
}

.detail-section:last-child {
    border-bottom: none;
}

.detail-section h3 {
    font-size: 1.4rem;
    color: #374151;
    margin-bottom: 20px;
}

.summary-content ul {
    list-style: none;
    padding: 0;
}

.summary-content li {
    padding: 10px 0;
    border-bottom: 1px solid #F3F4F6;
}

.balance-indicator {
    margin-top: 20px;
    padding: 15px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px;
    text-align: center;
}

.balance-score {
    font-size: 1.5rem;
    font-weight: bold;
}

.comparison-item {
    margin-bottom: 20px;
    padding: 15px;
    background: #F9FAFB;
    border-radius: 8px;
}

.comparison-item h4 {
    color: #4B5563;
    margin-bottom: 10px;
}

.recommendation-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.advice-card {
    padding: 20px;
    background: #EBF8FF;
    border-radius: 8px;
    border-left: 4px solid #3B82F6;
}

.advice-card h4 {
    color: #1E40AF;
    margin-bottom: 15px;
}

.advice-card ul {
    list-style: none;
    padding: 0;
}

.advice-card li {
    padding: 5px 0;
    color: #3730A3;
}

.advice-card li:before {
    content: "✓ ";
    color: #10B981;
    font-weight: bold;
    margin-right: 5px;
}
```
**成功条件**: 詳細セクションが整ったレイアウトで表示される

---

### ✅ Task 2.4: Phase 2統合テスト（45分）

#### Task 2.4.1: 完全な診断フローテスト（20分）
```javascript
// ブラウザコンソールで実行
// 36問の完全な回答データを設定
const fullAnswers = [
    // 価値観系の質問（1-12）
    {questionId: 1, answer: 5},
    {questionId: 2, answer: 4},
    {questionId: 3, answer: 5},
    {questionId: 4, answer: 3},
    {questionId: 5, answer: 4},
    {questionId: 6, answer: 5},
    {questionId: 7, answer: 4},
    {questionId: 8, answer: 3},
    {questionId: 9, answer: 5},
    {questionId: 10, answer: 4},
    {questionId: 11, answer: 5},
    {questionId: 12, answer: 4},
    
    // 社会性系の質問（13-24）
    {questionId: 13, answer: 3},
    {questionId: 14, answer: 4},
    {questionId: 15, answer: 3},
    {questionId: 16, answer: 2},
    {questionId: 17, answer: 3},
    {questionId: 18, answer: 4},
    {questionId: 19, answer: 3},
    {questionId: 20, answer: 4},
    {questionId: 21, answer: 3},
    {questionId: 22, answer: 2},
    {questionId: 23, answer: 3},
    {questionId: 24, answer: 4},
    
    // 防御系の質問（25-36）
    {questionId: 25, answer: 2},
    {questionId: 26, answer: 3},
    {questionId: 27, answer: 2},
    {questionId: 28, answer: 3},
    {questionId: 29, answer: 4},
    {questionId: 30, answer: 3},
    {questionId: 31, answer: 2},
    {questionId: 32, answer: 3},
    {questionId: 33, answer: 4},
    {questionId: 34, answer: 3},
    {questionId: 35, answer: 2},
    {questionId: 36, answer: 3}
];

// データを設定
localStorage.setItem('haqei_answers', JSON.stringify(fullAnswers));
localStorage.removeItem('tripleOSAnalysis');

// ページリロード
location.reload();
```
**チェック項目**:
- [ ] 3つのOSカードが表示される
- [ ] 各カードにスコアが表示される
- [ ] 易卦名が表示される
- [ ] 特性バッジが表示される

#### Task 2.4.2: レスポンシブ確認（10分）
```javascript
// デベロッパーツールでデバイスモードに切り替え
// 以下のサイズで確認:
// - iPhone SE (375px)
// - iPad (768px)
// - Desktop (1920px)
```
**チェック項目**:
- [ ] モバイルで1列表示
- [ ] タブレットで2列表示
- [ ] デスクトップで3列表示
- [ ] テキストが読みやすい

#### Task 2.4.3: パフォーマンス確認（10分）
```javascript
// デベロッパーツールのNetworkタブで確認
// ページロード時間を測定

// Performanceタブで確認
// - First Contentful Paint < 2秒
// - Time to Interactive < 3秒
```
**成功条件**: 3秒以内に全コンテンツが表示される

#### Task 2.4.4: エラー耐性テスト（5分）
```javascript
// 不正なデータでテスト
localStorage.setItem('haqei_answers', JSON.stringify([
    {questionId: 1} // answerが欠損
]));

location.reload();

// エラーが表示されず、ダミーデータが使用されることを確認
```
**成功条件**: エラーが発生してもページが機能する

---

## 🚧 依存関係マトリックス

### ファイル依存関係
```
VirtualPersonaResultsView.js
├── StorageManager.js (必須)
├── BaseComponent.js (推奨)
├── DataManager.js (推奨)
├── ErrorHandler.js (推奨)
├── OSCard.js (Phase 2)
├── TripleOSEngine.js (Phase 2)
└── AnalysisDetails.js (Phase 2)

results.html
├── results-page.css (必須)
├── haqei-unified-design.css (既存)
└── 全JSファイル (順序重要)
```

### 実行順序の重要性
1. **ユーティリティ系を先に読み込む**
2. **基盤クラスを次に読み込む**
3. **エンジン系を読み込む**
4. **コンポーネント系を読み込む**
5. **メインビューを最後に読み込む**

---

## 🔍 デバッグチートシート

### よくあるエラーと対処法

#### エラー1: "VirtualPersonaResultsView is not defined"
```javascript
// 対処法: ファイルの読み込み順序を確認
console.log(typeof VirtualPersonaResultsView); // "function"であるべき
```

#### エラー2: "Cannot read property 'innerHTML' of null"
```javascript
// 対処法: DOM要素の存在確認
const container = document.getElementById('virtual-persona-container');
if (!container) {
    console.error('コンテナが見つかりません');
    return;
}
```

#### エラー3: "localStorage is not defined"
```javascript
// 対処法: ブラウザ環境確認
if (typeof localStorage === 'undefined') {
    console.error('localStorageが利用できません');
    // メモリ上でのフォールバック実装
}
```

#### エラー4: スコアが表示されない
```javascript
// 対処法: データ構造の確認
console.log('Triple OSデータ:', this.tripleOSData);
// 必須プロパティ: engineOS, interfaceOS, safeModeOS
```

---

## 📝 完了チェックリスト

### Phase 1完了条件
- [ ] results.htmlがエラーなく開く
- [ ] コンソールにエラーがない
- [ ] ローディングが消える
- [ ] 基本的なコンテンツが表示される
- [ ] エラーハンドリングが機能する

### Phase 2完了条件
- [ ] 3つのOSカードが表示される
- [ ] 各カードにデータが正しく表示される
- [ ] 詳細分析セクションが表示される
- [ ] レスポンシブデザインが機能する
- [ ] 36問の回答から正しく分析される

### 全体完了条件
- [ ] ユーザーテストで問題なし
- [ ] パフォーマンス基準を満たす
- [ ] エラー耐性がある
- [ ] コードが整理されている
- [ ] ドキュメントが更新されている

---

**この超詳細タスク分解に従って、TRAEは1つずつ確実にタスクを完了させることができます。**
**各タスクには具体的なコード、確認方法、成功条件が明記されています。**
**Phase 1から順番に、各タスクを完了してから次に進んでください。**