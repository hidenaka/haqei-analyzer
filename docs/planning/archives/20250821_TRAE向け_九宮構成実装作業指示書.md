# TRAE向け 九宮構成実装作業指示書

**作成日**: 2025年8月21日  
**作業目的**: 詳細分析レポートを10項目アコーディオンから九宮構成（9項目＋統合）に変更  
**作業範囲**: BasicResultsTab.js、SummaryGenerator.js、関連CSS  

---

## 📋 作業概要

36問の質問に答えてもらった価値を最大化するため、詳細分析レポートを「九宮構成」に変更します。

### 変更前後の比較
- **現状**: 10項目のアコーディオン式詳細分析
- **変更後**: 9項目（3×3グリッド）＋統合分析

---

## 🗑️ Phase 1: 既存コードの削除

### Task 1.1: アコーディオン関連メソッドの削除
**ファイル**: `/public/js/tabs/BasicResultsTab.js`

削除対象メソッド（行番号は目安）:
```javascript
// 以下のメソッドを完全削除
- renderDetailedAnalysisSection() // 約831-859行
- renderAccordionItem() // 約885-908行
- renderScoreExplanations() // 約910-952行
- setupAccordionInteractions() // （もし存在すれば）
```

### Task 1.2: 詳細分析生成メソッドの削除
**ファイル**: `/public/js/core/SummaryGenerator.js`

削除対象メソッド（行番号は目安）:
```javascript
// 以下のメソッドを完全削除
- generateDetailedSummary() // 約56-87行
- generateOverview() // 約176-186行
- generateEngineAnalysis() // 約188-204行
- generateInterfaceAnalysis() // 約206-222行
- generateSafeModeAnalysis() // 約224-240行
- analyzeOSInteractions() // 約242-267行
- generateRecommendations() // 約269-289行
- extractStrengths() // 約291-310行
- identifyGrowthAreas() // 約312-334行
- generateActionItems() // 約336-359行
- generateConclusion() // 約361-372行
- getFallbackDetailedSummary() // 約374-390行
```

### Task 1.3: アコーディオンCSSの削除
**ファイル**: `/public/css/results.css` または `/public/css/haqei-unified-design.css`

削除対象CSS:
```css
/* 以下のクラスを削除 */
.accordion-container { ... }
.accordion-item { ... }
.accordion-header { ... }
.accordion-content { ... }
.accordion-icon { ... }
.accordion-item.active { ... }
/* その他 accordion- で始まる全てのクラス */
```

### Task 1.4: 削除確認テスト
```bash
# 削除後、エラーが出ないことを確認
1. ブラウザでresults.htmlを開く
2. コンソールエラーがないことを確認
3. 既存の4行要約とTriple OSカードが正常表示されることを確認
```

---

## 🏗️ Phase 2: 九宮構成の実装

### Task 2.1: 九宮分析生成メソッドの追加
**ファイル**: `/public/js/core/SummaryGenerator.js`

追加位置: `generateFourLineSummary()`メソッドの後（約54行目以降）

```javascript
/**
 * 九宮構成による詳細分析を生成
 * @param {Object} analysisData - 分析データ
 * @returns {Object} 九宮分析結果
 */
generateNinePhaseAnalysis(analysisData) {
    if (!analysisData) {
        return this.getFallbackNinePhaseAnalysis();
    }
    
    try {
        const { engineOS, interfaceOS, safeModeOS } = analysisData;
        
        // V3データ取得
        const engineV3 = this.getV3DataForOS(engineOS.hexagramName, 'engineOS');
        const interfaceV3 = this.getV3DataForOS(interfaceOS.hexagramName, 'interfaceOS');
        const safeModeV3 = this.getV3DataForOS(safeModeOS.hexagramName, 'safeModeOS');
        
        return {
            // Engine OS 3側面
            engineDrive: {
                title: '原動力',
                icon: '⚡',
                score: engineOS.score,
                content: engineV3?.profile?.type || '創造的エネルギー',
                description: engineV3?.profile?.description || 'あなたの内なる原動力の源泉',
                detail: engineV3?.normalState?.whatHappens || '積極的に新しいことに挑戦する'
            },
            engineCreativity: {
                title: '創造性',
                icon: '💡',
                score: this.calculateSubScore(engineOS.score, 'creativity'),
                content: engineV3?.normalState?.example || 'アイデアが次々と湧いてくる',
                description: '新しいものを生み出す力',
                detail: this.extractCreativityPattern(engineV3)
            },
            enginePropulsion: {
                title: '推進力',
                icon: '🚀',
                score: this.calculateSubScore(engineOS.score, 'propulsion'),
                content: engineV3?.maintenance?.tip || '定期的に新しい刺激を取り入れる',
                description: '物事を前に進める力',
                detail: this.extractPropulsionPattern(engineV3)
            },
            
            // Interface OS 3側面
            interfaceSocial: {
                title: '社会性',
                icon: '🤝',
                score: interfaceOS.score,
                content: interfaceV3?.profile?.type || '調和型',
                description: interfaceV3?.profile?.description || '周囲と調和的な関係を築く',
                detail: interfaceV3?.howToTalk?.style || '相手に配慮した話し方'
            },
            interfaceEmpathy: {
                title: '共感力',
                icon: '💖',
                score: this.calculateSubScore(interfaceOS.score, 'empathy'),
                content: interfaceV3?.relationshipTips?.empathy || '相手の気持ちを理解する',
                description: '他者を理解し寄り添う力',
                detail: this.extractEmpathyPattern(interfaceV3)
            },
            interfaceInfluence: {
                title: '影響力',
                icon: '✨',
                score: this.calculateSubScore(interfaceOS.score, 'influence'),
                content: interfaceV3?.bestEnvironment?.impact || '周囲にポジティブな影響を与える',
                description: '周りに与えるインパクト',
                detail: this.extractInfluencePattern(interfaceV3)
            },
            
            // SafeMode OS 3側面
            safeModeStability: {
                title: '安定性',
                icon: '⚖️',
                score: safeModeOS.score,
                content: safeModeV3?.profile?.type || '堅実型',
                description: safeModeV3?.profile?.description || '一貫性のある安定した基盤',
                detail: safeModeV3?.normalState?.whatHappens || '冷静に状況を見極める'
            },
            safeModeDefense: {
                title: '防御力',
                icon: '🛡️',
                score: this.calculateSubScore(safeModeOS.score, 'defense'),
                content: safeModeV3?.stressResponse?.whatYouDo || 'ストレスから自分を守る',
                description: 'リスクから身を守る力',
                detail: this.extractDefensePattern(safeModeV3)
            },
            safeModeRecovery: {
                title: '回復力',
                icon: '🌱',
                score: this.calculateSubScore(safeModeOS.score, 'recovery'),
                content: safeModeV3?.howToRecover?.bestWay || '十分な休息を取る',
                description: '立ち直る力と方法',
                detail: this.extractRecoveryPattern(safeModeV3)
            },
            
            // 統合分析
            integration: this.calculateIntegration(engineOS, interfaceOS, safeModeOS)
        };
    } catch (error) {
        console.error('❌ 九宮分析生成エラー:', error);
        return this.getFallbackNinePhaseAnalysis();
    }
}

/**
 * サブスコアを計算
 */
calculateSubScore(baseScore, aspect) {
    // ベーススコアから側面別のスコアを算出
    const variation = {
        creativity: 0.9,
        propulsion: 1.1,
        empathy: 0.95,
        influence: 1.05,
        defense: 0.85,
        recovery: 1.15
    };
    
    return Math.round(baseScore * (variation[aspect] || 1));
}

/**
 * 各パターンの抽出メソッド群
 */
extractCreativityPattern(v3Data) {
    if (!v3Data) return '創造的な思考パターンを持つ';
    return v3Data.normalState?.example || v3Data.profile?.metaphor || '新しいアイデアを生み出す';
}

extractPropulsionPattern(v3Data) {
    if (!v3Data) return '着実に前進する力を持つ';
    return v3Data.maintenance?.warning || v3Data.normalState?.whatHappens || '目標に向かって推進する';
}

extractEmpathyPattern(v3Data) {
    if (!v3Data) return '他者の感情を理解する';
    return v3Data.relationshipTips?.advice || v3Data.howToTalk?.example || '相手の立場で考える';
}

extractInfluencePattern(v3Data) {
    if (!v3Data) return '周囲に良い影響を与える';
    return v3Data.bestEnvironment?.where || v3Data.profile?.description || 'ポジティブな変化を起こす';
}

extractDefensePattern(v3Data) {
    if (!v3Data) return '自分を守る術を知っている';
    return v3Data.stressResponse?.example || v3Data.emergencyMode?.whatHappens || '冷静に対処する';
}

extractRecoveryPattern(v3Data) {
    if (!v3Data) return '自然に回復する力がある';
    return v3Data.howToRecover?.example || v3Data.howToRecover?.bestWay || '時間をかけて立ち直る';
}

/**
 * 統合分析を計算
 */
calculateIntegration(engineOS, interfaceOS, safeModeOS) {
    // 人格卦の算出
    const personalHexagram = this.derivePersonalHexagram(engineOS, interfaceOS, safeModeOS);
    
    // バランス度の計算
    const scores = [engineOS.score, interfaceOS.score, safeModeOS.score];
    const maxScore = Math.max(...scores);
    const minScore = Math.min(...scores);
    const balance = 100 - (maxScore - minScore);
    
    // 調和度の計算
    const average = scores.reduce((a, b) => a + b, 0) / 3;
    const variance = scores.reduce((sum, score) => sum + Math.pow(score - average, 2), 0) / 3;
    const harmony = Math.round(100 - Math.sqrt(variance));
    
    // シナジー度の計算
    const synergy = this.calculateSynergy(engineOS, interfaceOS, safeModeOS);
    
    return {
        hexagram: personalHexagram.name,
        hexagramDescription: personalHexagram.description,
        balance: balance,
        harmony: harmony,
        synergy: synergy,
        overallScore: Math.round((balance + harmony + synergy) / 3),
        message: this.generateIntegrationMessage(personalHexagram, balance, harmony, synergy)
    };
}

/**
 * 人格卦を導出
 */
derivePersonalHexagram(engineOS, interfaceOS, safeModeOS) {
    // 簡易版：最も高いスコアのOSの卦を基準に選定
    const dominant = [engineOS, interfaceOS, safeModeOS].reduce((max, os) => 
        os.score > max.score ? os : max
    );
    
    // 実際はもっと複雑なロジックで64卦から選定
    return {
        name: dominant.hexagramName,
        description: `${dominant.hexagramName}の特性が強く表れています`
    };
}

/**
 * シナジーを計算
 */
calculateSynergy(engineOS, interfaceOS, safeModeOS) {
    // OS間の相性を計算（簡易版）
    const engineInterface = this.calculatePairSynergy(engineOS, interfaceOS);
    const interfaceSafeMode = this.calculatePairSynergy(interfaceOS, safeModeOS);
    const safeModeEngine = this.calculatePairSynergy(safeModeOS, engineOS);
    
    return Math.round((engineInterface + interfaceSafeMode + safeModeEngine) / 3);
}

/**
 * ペア間のシナジーを計算
 */
calculatePairSynergy(os1, os2) {
    // スコアの差が小さいほどシナジーが高い
    const diff = Math.abs(os1.score - os2.score);
    return Math.max(0, 100 - diff * 2);
}

/**
 * 統合メッセージを生成
 */
generateIntegrationMessage(hexagram, balance, harmony, synergy) {
    let message = `あなたの人格は「${hexagram.name}」的な特性を持ちます。`;
    
    if (balance >= 80) {
        message += '3つのOSが非常にバランス良く発達しています。';
    } else if (harmony >= 80) {
        message += '内面的な調和が取れた安定した人格です。';
    } else if (synergy >= 80) {
        message += '各要素が相乗効果を生み出す優れた統合性があります。';
    } else {
        message += '個性的な強みを持つ独自の人格構造です。';
    }
    
    return message;
}

/**
 * フォールバック用の九宮分析
 */
getFallbackNinePhaseAnalysis() {
    return {
        engineDrive: {
            title: '原動力',
            icon: '⚡',
            score: 70,
            content: '創造的エネルギー',
            description: 'あなたの内なる原動力',
            detail: '新しいことへの挑戦を楽しむ'
        },
        // ... 他の8項目も同様にフォールバック値を設定
        integration: {
            hexagram: '乾為天',
            hexagramDescription: '創造的な力に満ちています',
            balance: 75,
            harmony: 70,
            synergy: 72,
            overallScore: 72,
            message: 'バランスの取れた人格構造です'
        }
    };
}
```

### Task 2.2: UI表示メソッドの追加
**ファイル**: `/public/js/tabs/BasicResultsTab.js`

追加位置: `renderSummarySection()`メソッドの後（約825行目以降）

```javascript
/**
 * 九宮分析セクションのレンダリング
 * @returns {string} HTML文字列
 */
renderNinePhaseSection() {
    if (!this.summaryGenerator || !this.analysisData) {
        return '<div class="nine-phase-placeholder">分析準備中...</div>';
    }
    
    const analysis = this.summaryGenerator.generateNinePhaseAnalysis(this.analysisData);
    
    return `
        <div class="nine-phase-section">
            <div class="nine-phase-header">
                <h2>📊 九宮による人格深層分析</h2>
                <p class="nine-phase-subtitle">36問の回答から導き出された9つの側面</p>
            </div>
            
            <div class="nine-phase-grid">
                <!-- Engine OS 列 -->
                <div class="phase-column engine-column">
                    <div class="column-header">
                        <h3>⚙️ Engine OS</h3>
                        <p>内なる原動力</p>
                    </div>
                    ${this.renderPhaseCard(analysis.engineDrive, 'engine')}
                    ${this.renderPhaseCard(analysis.engineCreativity, 'engine')}
                    ${this.renderPhaseCard(analysis.enginePropulsion, 'engine')}
                </div>
                
                <!-- Interface OS 列 -->
                <div class="phase-column interface-column">
                    <div class="column-header">
                        <h3>🔄 Interface OS</h3>
                        <p>社会との関わり</p>
                    </div>
                    ${this.renderPhaseCard(analysis.interfaceSocial, 'interface')}
                    ${this.renderPhaseCard(analysis.interfaceEmpathy, 'interface')}
                    ${this.renderPhaseCard(analysis.interfaceInfluence, 'interface')}
                </div>
                
                <!-- SafeMode OS 列 -->
                <div class="phase-column safemode-column">
                    <div class="column-header">
                        <h3>🛡️ SafeMode OS</h3>
                        <p>守りと回復</p>
                    </div>
                    ${this.renderPhaseCard(analysis.safeModeStability, 'safemode')}
                    ${this.renderPhaseCard(analysis.safeModeDefense, 'safemode')}
                    ${this.renderPhaseCard(analysis.safeModeRecovery, 'safemode')}
                </div>
            </div>
            
            ${this.renderIntegrationPanel(analysis.integration)}
        </div>
    `;
}

/**
 * 各フェーズカードのレンダリング
 */
renderPhaseCard(phaseData, osType) {
    if (!phaseData) return '';
    
    const scoreClass = this.getScoreClass(phaseData.score);
    
    return `
        <div class="phase-card phase-card-${osType}" data-score="${phaseData.score}">
            <div class="phase-card-header">
                <span class="phase-icon">${phaseData.icon}</span>
                <h4 class="phase-title">${phaseData.title}</h4>
                <span class="phase-score ${scoreClass}">${phaseData.score}pts</span>
            </div>
            <div class="phase-card-content">
                <p class="phase-main">${phaseData.content}</p>
                <p class="phase-description">${phaseData.description}</p>
            </div>
            <div class="phase-card-detail">
                <p>${phaseData.detail}</p>
            </div>
        </div>
    `;
}

/**
 * 統合パネルのレンダリング
 */
renderIntegrationPanel(integration) {
    if (!integration) return '';
    
    return `
        <div class="integration-panel">
            <div class="integration-header">
                <h3>🌟 統合分析 - あなたの人格卦</h3>
            </div>
            <div class="integration-content">
                <div class="hexagram-display">
                    <h4 class="hexagram-name">${integration.hexagram}</h4>
                    <p class="hexagram-description">${integration.hexagramDescription}</p>
                </div>
                
                <div class="integration-metrics">
                    <div class="metric-item">
                        <span class="metric-label">バランス</span>
                        <div class="metric-bar">
                            <div class="metric-fill" style="width: ${integration.balance}%"></div>
                        </div>
                        <span class="metric-value">${integration.balance}%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">調和</span>
                        <div class="metric-bar">
                            <div class="metric-fill" style="width: ${integration.harmony}%"></div>
                        </div>
                        <span class="metric-value">${integration.harmony}%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">シナジー</span>
                        <div class="metric-bar">
                            <div class="metric-fill" style="width: ${integration.synergy}%"></div>
                        </div>
                        <span class="metric-value">${integration.synergy}%</span>
                    </div>
                </div>
                
                <div class="integration-message">
                    <p>${integration.message}</p>
                    <div class="overall-score">
                        <span>総合スコア</span>
                        <strong>${integration.overallScore}</strong>
                        <span>/ 100</span>
                    </div>
                </div>
            </div>
        </div>
    `;
}

/**
 * スコアに基づくクラスを取得
 */
getScoreClass(score) {
    if (score >= 80) return 'score-excellent';
    if (score >= 60) return 'score-good';
    if (score >= 40) return 'score-moderate';
    return 'score-low';
}
```

### Task 2.3: renderTripleOSCards内での呼び出し修正
**ファイル**: `/public/js/tabs/BasicResultsTab.js`

`renderTripleOSCards()`メソッド内（約231行目付近）を修正:

```javascript
// 変更前
container.innerHTML = `
    ${fourLineSummary ? this.renderSummarySection(fourLineSummary) : ''}
    <div class="os-cards-wrapper">
        ${this.renderEngineOSCard(engineOS)}
        ${this.renderInterfaceOSCard(interfaceOS)}
        ${this.renderSafeModeOSCard(safeModeOS)}
    </div>
    ${this.renderDetailedAnalysisSection()}  // ← この行を変更
`;

// 変更後
container.innerHTML = `
    ${fourLineSummary ? this.renderSummarySection(fourLineSummary) : ''}
    <div class="os-cards-wrapper">
        ${this.renderEngineOSCard(engineOS)}
        ${this.renderInterfaceOSCard(interfaceOS)}
        ${this.renderSafeModeOSCard(safeModeOS)}
    </div>
    ${this.renderNinePhaseSection()}  // ← 九宮分析セクションに変更
`;
```

### Task 2.4: CSSスタイルの追加
**ファイル**: `/public/css/results.css` または `/public/css/haqei-unified-design.css`

追加位置: ファイルの最後

```css
/* ========== 九宮分析セクション ========== */
.nine-phase-section {
    margin-top: 3rem;
    padding: 2rem;
    background: #f8f9fa;
    border-radius: 12px;
}

.nine-phase-header {
    text-align: center;
    margin-bottom: 2rem;
}

.nine-phase-header h2 {
    color: #2c3e50;
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
}

.nine-phase-subtitle {
    color: #6c757d;
    font-size: 0.95rem;
}

/* グリッドレイアウト */
.nine-phase-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
}

/* 列ヘッダー */
.phase-column {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.column-header {
    text-align: center;
    padding: 0.75rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.column-header h3 {
    font-size: 1.1rem;
    margin: 0 0 0.25rem 0;
}

.column-header p {
    font-size: 0.85rem;
    color: #6c757d;
    margin: 0;
}

/* フェーズカード */
.phase-card {
    background: white;
    border-radius: 8px;
    padding: 1rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    border-left: 4px solid;
}

.phase-card-engine {
    border-left-color: #FF6B6B;
}

.phase-card-interface {
    border-left-color: #4ECDC4;
}

.phase-card-safemode {
    border-left-color: #95E77E;
}

.phase-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.12);
}

.phase-card-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
}

.phase-icon {
    font-size: 1.2rem;
}

.phase-title {
    flex: 1;
    font-size: 0.95rem;
    font-weight: 600;
    margin: 0;
}

.phase-score {
    font-size: 0.85rem;
    font-weight: bold;
    padding: 0.15rem 0.5rem;
    border-radius: 12px;
    background: #f0f0f0;
}

.score-excellent {
    background: #d4edda;
    color: #155724;
}

.score-good {
    background: #cce5ff;
    color: #004085;
}

.score-moderate {
    background: #fff3cd;
    color: #856404;
}

.score-low {
    background: #f8d7da;
    color: #721c24;
}

.phase-card-content {
    margin-bottom: 0.5rem;
}

.phase-main {
    font-size: 0.9rem;
    font-weight: 500;
    color: #2c3e50;
    margin: 0 0 0.25rem 0;
}

.phase-description {
    font-size: 0.85rem;
    color: #6c757d;
    margin: 0;
}

.phase-card-detail {
    padding-top: 0.5rem;
    border-top: 1px solid #e9ecef;
}

.phase-card-detail p {
    font-size: 0.85rem;
    color: #495057;
    margin: 0;
    line-height: 1.4;
}

/* 統合パネル */
.integration-panel {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
    padding: 2rem;
    margin-top: 2rem;
}

.integration-header h3 {
    text-align: center;
    font-size: 1.4rem;
    margin: 0 0 1.5rem 0;
}

.hexagram-display {
    text-align: center;
    margin-bottom: 1.5rem;
}

.hexagram-name {
    font-size: 1.8rem;
    margin: 0 0 0.5rem 0;
}

.hexagram-description {
    font-size: 1rem;
    opacity: 0.95;
    margin: 0;
}

.integration-metrics {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.metric-item {
    text-align: center;
}

.metric-label {
    display: block;
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
    opacity: 0.9;
}

.metric-bar {
    height: 8px;
    background: rgba(255,255,255,0.3);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 0.25rem;
}

.metric-fill {
    height: 100%;
    background: white;
    border-radius: 4px;
    transition: width 1s ease;
}

.metric-value {
    font-size: 1.1rem;
    font-weight: bold;
}

.integration-message {
    text-align: center;
    padding-top: 1rem;
    border-top: 1px solid rgba(255,255,255,0.3);
}

.integration-message p {
    font-size: 1rem;
    line-height: 1.5;
    margin: 0 0 1rem 0;
}

.overall-score {
    display: inline-flex;
    align-items: baseline;
    gap: 0.5rem;
    font-size: 1rem;
}

.overall-score strong {
    font-size: 2rem;
}

/* レスポンシブ対応 */
@media (max-width: 768px) {
    .nine-phase-grid {
        grid-template-columns: 1fr;
    }
    
    .integration-metrics {
        grid-template-columns: 1fr;
    }
    
    .phase-column {
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
    }
    
    .phase-column:last-child {
        border-bottom: none;
    }
}

@media (max-width: 480px) {
    .nine-phase-section {
        padding: 1rem;
    }
    
    .phase-card {
        padding: 0.75rem;
    }
    
    .integration-panel {
        padding: 1.5rem 1rem;
    }
}
```

---

## 🧪 Phase 3: テストと確認

### Task 3.1: 基本動作確認
```bash
1. ブラウザでresults.htmlを開く
2. 開発者ツールのコンソールを開く
3. エラーがないことを確認
```

### Task 3.2: 表示確認チェックリスト
- [ ] 4行要約が正常に表示される
- [ ] Triple OSカードが正常に表示される
- [ ] 九宮分析セクションが表示される
- [ ] 9つのフェーズカードが3×3で配置される
- [ ] 各カードにアイコン、タイトル、スコアが表示される
- [ ] 統合パネルが表示される
- [ ] 人格卦が表示される
- [ ] バランス、調和、シナジーのメーターが表示される

### Task 3.3: データ連携確認
```javascript
// コンソールで実行
console.log(window.basicResultsTab.summaryGenerator.generateNinePhaseAnalysis(
    window.basicResultsTab.analysisData
));
```
- [ ] 9つの項目データが取得できる
- [ ] 統合データが取得できる
- [ ] V3データベースから正しくデータが取得されている

### Task 3.4: レスポンシブ確認
- [ ] PC表示（1024px以上）: 3列グリッド
- [ ] タブレット表示（768px）: 1列表示に切り替わる
- [ ] スマホ表示（480px以下）: パディング調整される

### Task 3.5: スコア表示確認
- [ ] 80点以上: 緑色背景（excellent）
- [ ] 60-79点: 青色背景（good）
- [ ] 40-59点: 黄色背景（moderate）
- [ ] 39点以下: 赤色背景（low）

---

## 📝 注意事項

### 重要な確認ポイント
1. **V3データベースの null チェック**
   - 各フィールドアクセス時に `?.` を使用
   - フォールバック値を必ず設定

2. **既存機能への影響**
   - 4行要約は変更しない
   - Triple OSカードは変更しない
   - エクスポート機能がある場合は別途対応

3. **パフォーマンス**
   - 9項目の計算は非同期にしない（すぐに表示）
   - アニメーションは軽量に保つ

### エラー時の対処
1. `generateNinePhaseAnalysis is not a function`
   → SummaryGenerator.jsへの追加漏れ
   
2. `Cannot read properties of undefined`
   → V3データのnullチェック不足
   
3. CSSが適用されない
   → CSSファイルの読み込み順序を確認

---

## 🎯 完了条件

以下がすべて確認できたら作業完了:
1. アコーディオン式の詳細分析が完全に削除されている
2. 九宮分析（9項目）が正しく表示される
3. 統合パネルで人格卦が表示される
4. エラーが発生していない
5. レスポンシブ対応が機能している

---

## 📞 サポート

不明点や問題が発生した場合は、以下の情報とともに報告してください:
- エラーメッセージ（コンソール）
- 該当ファイルと行番号
- スクリーンショット

作業お疲れ様です！丁寧に実装していただければ、ユーザーにとって価値の高い分析レポートが完成します。