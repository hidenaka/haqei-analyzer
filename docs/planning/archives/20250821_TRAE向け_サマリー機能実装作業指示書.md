# 20250821_TRAE向け_サマリー機能実装作業指示書

## 📋 作業概要
**作成日**: 2025年1月21日
**目的**: Results画面にTriple OSの分析結果サマリー機能を追加し、ユーザーの理解を促進する
**担当**: TRAE（実装担当）
**レビュー**: Claude Code（レビュー担当）
**予想作業時間**: 3-4時間

## 🎯 達成目標

### 必須要件
- [ ] 各OSカードの上部に4行要約を表示
- [ ] 10行詳細分析をアコーディオンで表示
- [ ] スコア（pts）の意味を分かりやすく説明
- [ ] V3データベースと連携した動的テキスト生成
- [ ] モバイル対応（レスポンシブデザイン）

### 品質要件
- [ ] 既存機能（V3データ表示）を破壊しない
- [ ] パフォーマンス劣化なし（初期表示1秒以内）
- [ ] エラー時のフォールバック機能
- [ ] 日本漢字のみ使用（中国漢字禁止）

## 📐 モックアップ仕様

### 4行要約の表示イメージ
```
┌─────────────────────────────────────────────────┐
│ 📊 あなたのTriple OS分析結果サマリー           │
├─────────────────────────────────────────────────┤
│ Engine OS (85点) - 革新追求エンジン             │
│ 新しいアイデアが次々と生まれる創造的な状態です   │
│ 🔥🔥🔥 高い活性度 - 内なるエネルギーが充実     │
│ 💡 新しいプロジェクトに挑戦してみましょう       │
└─────────────────────────────────────────────────┘
```

### 10行詳細分析の表示イメージ
```
┌─────────────────────────────────────────────────┐
│ ▼ 詳細分析を見る                               │
├─────────────────────────────────────────────────┤
│ 【3つのOSの調和状態】                          │
│ Engine OS（85点）が最も活発です                 │
│ Interface OS（72点）は適度に機能中              │
│ SafeMode OS（65点）は待機状態です              │
│                                                 │
│ 【あなたの強み】                               │
│ ✨ 革新的なアイデア創出力                      │
│ ✨ 他者との協調性                              │
│                                                 │
│ 【成長のヒント】                               │
│ 🎯 Interface OSを高めて伝達力向上              │
└─────────────────────────────────────────────────┘
```

## 📝 タスク分解表

### Phase 1: SummaryGeneratorクラス作成（推定1時間）

#### Task 1-1: ファイル作成とクラス定義
**ファイル**: `/public/js/core/SummaryGenerator.js`（新規作成）
**実装要件**: 
1. SummaryGeneratorクラスを定義
2. V3データベースとの連携機能
3. TripleOSInteractionAnalyzerとの連携

**期待される実装**:
```javascript
/**
 * SummaryGenerator.js - Triple OS分析結果のサマリー生成
 * V3データベースを活用した動的テキスト生成
 */

class SummaryGenerator {
    constructor() {
        this.v3Database = window.hexagramHumanTraitsV3 || null;
        this.interactionAnalyzer = null;
        
        // TripleOSInteractionAnalyzerの初期化
        if (typeof TripleOSInteractionAnalyzer !== 'undefined') {
            this.interactionAnalyzer = new TripleOSInteractionAnalyzer();
        }
    }
    
    /**
     * 4行要約を生成
     * @param {Object} osData - OSデータ（engineOS, interfaceOS, safeModeOS）
     * @param {String} osType - OSタイプ（'engineOS', 'interfaceOS', 'safeModeOS'）
     * @returns {Object} 4行の要約テキスト
     */
    generate4LineSummary(osData, osType) {
        // V3データ取得
        const v3Data = this.getV3DataForOS(osData, osType);
        
        if (!v3Data) {
            return this.generateFallbackSummary(osData, osType);
        }
        
        return {
            line1: this.generateTypeLine(osData, v3Data),
            line2: this.generateStateLine(v3Data, osType),
            line3: this.generateEnergyLine(osData, v3Data, osType),
            line4: this.generateActionLine(v3Data, osType)
        };
    }
    
    /**
     * V3データを取得
     */
    getV3DataForOS(osData, osType) {
        if (!this.v3Database || !osData) return null;
        
        const hexagramName = this.extractHexagramName(osData);
        if (!hexagramName) return null;
        
        const normalizedName = this.normalizeHexagramName(hexagramName);
        const v3Entry = this.v3Database[normalizedName];
        
        if (!v3Entry) return null;
        
        // OSタイプに応じたデータを返す
        switch(osType) {
            case 'engineOS':
                return v3Entry.asEngineOS;
            case 'interfaceOS':
                return v3Entry.asInterfaceOS;
            case 'safeModeOS':
                return v3Entry.asSafeModeOS;
            default:
                return null;
        }
    }
    
    /**
     * 卦名を抽出
     */
    extractHexagramName(osData) {
        if (osData.hexagram?.name) return osData.hexagram.name;
        if (osData.hexagramName) return osData.hexagramName;
        if (osData.name && osData.name.includes('（')) {
            const match = osData.name.match(/（(.+?)）/);
            return match ? match[1] : null;
        }
        return null;
    }
    
    /**
     * 卦名を正規化（中国漢字を日本漢字に変換）
     */
    normalizeHexagramName(name) {
        if (!name) return '';
        
        // 中国漢字 → 日本漢字変換
        const conversionMap = {
            '乾为天': '乾為天',
            '坤为地': '坤為地',
            '水雷屯': '水雷屯',
            '山水蒙': '山水蒙',
            '水天需': '水天需',
            '天水讼': '天水訟',
            '地水师': '地水師',
            '水地比': '水地比',
            '风天小畜': '風天小畜',
            '天泽履': '天澤履',
            '离为火': '離為火',
            // 必要に応じて全64卦分追加
        };
        
        return conversionMap[name] || name;
    }
    
    /**
     * Line 1: タイプ情報
     */
    generateTypeLine(osData, v3Data) {
        const score = osData.score || 0;
        const type = v3Data?.profile?.type || 'データ取得中';
        const osName = this.getOSDisplayName(osData);
        
        return `${osName} (${score}点) - ${type}`;
    }
    
    /**
     * Line 2: 現在の状態
     */
    generateStateLine(v3Data, osType) {
        if (osType === 'engineOS' && v3Data?.normalState) {
            return v3Data.normalState.whatHappens || v3Data.profile.description;
        } else if (osType === 'interfaceOS' && v3Data?.howToTalk) {
            return `${v3Data.howToTalk.style}でコミュニケーションを取るタイプです`;
        } else if (osType === 'safeModeOS' && v3Data?.stressResponse) {
            return `ストレス時は${v3Data.stressResponse.whatYouDo}`;
        }
        
        return v3Data?.profile?.description || '分析中...';
    }
    
    /**
     * Line 3: エネルギー/活性度
     */
    generateEnergyLine(osData, v3Data, osType) {
        const score = osData.score || 0;
        const level = this.getEnergyLevel(score);
        const emoji = this.getEnergyEmoji(score);
        
        if (osType === 'engineOS' && v3Data?.normalState?.energyLevel) {
            return v3Data.normalState.energyLevel;
        }
        
        return `${emoji} ${level} (${score}点) - ${this.getEnergyDescription(score, osType)}`;
    }
    
    /**
     * Line 4: アクションアドバイス
     */
    generateActionLine(v3Data, osType) {
        if (osType === 'engineOS' && v3Data?.maintenance?.tip) {
            return `💡 ${v3Data.maintenance.tip}`;
        } else if (osType === 'interfaceOS' && v3Data?.relationshipTips?.advice) {
            return `💡 ${v3Data.relationshipTips.advice}`;
        } else if (osType === 'safeModeOS' && v3Data?.howToRecover?.bestWay) {
            return `💡 ${v3Data.howToRecover.bestWay}`;
        }
        
        return '💡 自分のペースで進みましょう';
    }
    
    /**
     * エネルギーレベル判定
     */
    getEnergyLevel(score) {
        if (score >= 80) return '非常に高い活性度';
        if (score >= 70) return '高い活性度';
        if (score >= 60) return '適度な活性度';
        if (score >= 50) return 'バランスの取れた状態';
        return '潜在的な力を秘めた状態';
    }
    
    /**
     * エネルギー絵文字
     */
    getEnergyEmoji(score) {
        if (score >= 80) return '🔥🔥🔥';
        if (score >= 70) return '🔥🔥';
        if (score >= 60) return '🔥';
        if (score >= 50) return '⚡';
        return '💫';
    }
    
    /**
     * フォールバック要約生成
     */
    generateFallbackSummary(osData, osType) {
        const osName = this.getOSDisplayName(osData);
        const score = osData.score || 0;
        
        return {
            line1: `${osName} (${score}点)`,
            line2: `現在の活性度は${this.getEnergyLevel(score)}です`,
            line3: `${this.getEnergyEmoji(score)} スコア: ${score}/100`,
            line4: '💡 詳細はV3データ読み込み後に表示されます'
        };
    }
    
    /**
     * OS表示名取得
     */
    getOSDisplayName(osData) {
        if (osData.name) return osData.name;
        
        const nameMap = {
            'engineOS': 'Engine OS',
            'interfaceOS': 'Interface OS',
            'safeModeOS': 'SafeMode OS'
        };
        
        return nameMap[osData.type] || 'Unknown OS';
    }
    
    /**
     * 10行詳細分析を生成
     */
    generate10LineDetail(analysisData) {
        const lines = [];
        
        // 3つのOSの調和状態（3行）
        lines.push('【3つのOSの調和状態】');
        lines.push(this.generateHarmonyLine(analysisData.engineOS, 'Engine OS', '創造的な原動力'));
        lines.push(this.generateHarmonyLine(analysisData.interfaceOS, 'Interface OS', '社会との架け橋'));
        lines.push(this.generateHarmonyLine(analysisData.safeModeOS, 'SafeMode OS', '心の防御機構'));
        
        lines.push(''); // 空行
        
        // 強み（2行）
        lines.push('【あなたの強み】');
        const strengths = this.identifyStrengths(analysisData);
        strengths.slice(0, 2).forEach(strength => {
            lines.push(`✨ ${strength}`);
        });
        
        lines.push(''); // 空行
        
        // 成長のヒント（2行）
        lines.push('【成長のヒント】');
        const hints = this.generateGrowthHints(analysisData);
        hints.slice(0, 2).forEach(hint => {
            lines.push(`🎯 ${hint}`);
        });
        
        return lines;
    }
    
    /**
     * 調和状態の説明生成
     */
    generateHarmonyLine(osData, osName, description) {
        const score = osData?.score || 0;
        const status = this.getHarmonyStatus(score);
        return `${osName}（${score}点）${status} - ${description}`;
    }
    
    /**
     * 調和状態の判定
     */
    getHarmonyStatus(score) {
        if (score >= 75) return 'が最も活発';
        if (score >= 60) return 'は適度に機能中';
        if (score >= 45) return 'はバランス状態';
        return 'は待機状態';
    }
    
    /**
     * 強みの特定
     */
    identifyStrengths(analysisData) {
        const strengths = [];
        
        if (analysisData.engineOS?.score >= 70) {
            strengths.push('革新的なアイデアを生み出す力');
        }
        if (analysisData.interfaceOS?.score >= 70) {
            strengths.push('他者と協調しながら目標を達成する力');
        }
        if (analysisData.safeModeOS?.score >= 70) {
            strengths.push('ストレス時も冷静に対処する力');
        }
        
        // デフォルトの強み
        if (strengths.length === 0) {
            strengths.push('バランスの取れた総合力');
            strengths.push('柔軟な適応力');
        }
        
        return strengths;
    }
    
    /**
     * 成長ヒントの生成
     */
    generateGrowthHints(analysisData) {
        const hints = [];
        
        // 最も低いOSを特定
        const osScores = [
            { type: 'engineOS', score: analysisData.engineOS?.score || 0 },
            { type: 'interfaceOS', score: analysisData.interfaceOS?.score || 0 },
            { type: 'safeModeOS', score: analysisData.safeModeOS?.score || 0 }
        ].sort((a, b) => a.score - b.score);
        
        const lowestOS = osScores[0];
        
        if (lowestOS.type === 'engineOS' && lowestOS.score < 60) {
            hints.push('Engine OSを高めて創造性を解放しましょう');
        } else if (lowestOS.type === 'interfaceOS' && lowestOS.score < 60) {
            hints.push('Interface OSを高めて伝達力を向上させましょう');
        } else if (lowestOS.type === 'safeModeOS' && lowestOS.score < 60) {
            hints.push('SafeMode OSを高めて心の安定を保ちましょう');
        }
        
        // バランスに関するヒント
        const maxDiff = osScores[2].score - osScores[0].score;
        if (maxDiff > 30) {
            hints.push('OSバランスを整えることでより安定した成長が期待できます');
        }
        
        // デフォルトヒント
        if (hints.length === 0) {
            hints.push('現在のバランスを維持しながら成長を続けましょう');
        }
        
        hints.push('定期的な自己分析で変化を確認しましょう');
        
        return hints;
    }
    
    /**
     * スコア説明の生成
     */
    generateScoreExplanation() {
        return {
            title: 'スコア（pts）について',
            description: 'pts（ポイント）は各OSの活性度を0-100で表した数値です',
            ranges: [
                { range: '70点以上', meaning: 'そのOSが強く働いている状態', advice: '強みとして活用しましょう' },
                { range: '50-70点', meaning: 'バランスよく機能している状態', advice: '現状を維持しましょう' },
                { range: '50点未満', meaning: '潜在的な力を秘めている状態', advice: '意識的に高める機会を作りましょう' }
            ]
        };
    }
}

// グローバルスコープに公開
window.SummaryGenerator = SummaryGenerator;
```

### Phase 2: BasicResultsTabへの統合（推定1.5時間）

#### Task 2-1: renderContent拡張
**ファイル**: `/public/js/tabs/BasicResultsTab.js`
**行番号**: 714-722付近（renderContent メソッド内）
**実装要件**: 
1. SummaryGeneratorのインポート
2. renderSummarySection()メソッドの追加
3. 既存のカード表示の前にサマリーセクションを挿入

**期待される変更**:
```javascript
// 行番号: 714付近のrenderContent メソッドを修正
renderContent(container) {
    // コンテナにHTMLを設定
    container.innerHTML = `
        <div class="basic-results-content">
            <!-- 新規追加: サマリーセクション -->
            <div id="summary-section">
                ${this.renderSummarySection()}
            </div>
            
            <!-- 既存: OSカードコンテナ -->
            <div id="os-cards-container">
                <!-- ここにTriple OSカードが描画される -->
            </div>
        </div>
    `;
}
```

#### Task 2-2: renderSummarySection実装
**ファイル**: `/public/js/tabs/BasicResultsTab.js`
**行番号**: 758付近（getContainer メソッドの後）
**実装要件**: 
1. renderSummarySection()メソッドを新規追加
2. SummaryGeneratorを使用してサマリー生成
3. HTMLテンプレート作成

**期待される実装**:
```javascript
/**
 * サマリーセクションをレンダリング
 */
renderSummarySection() {
    if (!this.analysisData) {
        return '<div class="summary-placeholder">データを読み込み中...</div>';
    }
    
    try {
        // SummaryGeneratorのインスタンス作成
        const summaryGenerator = new SummaryGenerator();
        
        // 全体サマリー生成
        const overallSummary = this.generateOverallSummary(summaryGenerator);
        
        // 各OSの4行要約生成
        const engineSummary = summaryGenerator.generate4LineSummary(
            this.analysisData.engineOS, 
            'engineOS'
        );
        const interfaceSummary = summaryGenerator.generate4LineSummary(
            this.analysisData.interfaceOS,
            'interfaceOS'
        );
        const safeModeSummary = summaryGenerator.generate4LineSummary(
            this.analysisData.safeModeOS,
            'safeModeOS'
        );
        
        // 10行詳細分析生成
        const detailedAnalysis = summaryGenerator.generate10LineDetail(this.analysisData);
        
        // スコア説明生成
        const scoreExplanation = summaryGenerator.generateScoreExplanation();
        
        return `
            <div class="summary-container">
                <!-- 全体サマリーヘッダー -->
                <div class="summary-header">
                    <h2 class="summary-title">
                        <span class="summary-icon">📊</span>
                        あなたのTriple OS分析結果サマリー
                    </h2>
                </div>
                
                <!-- 各OSの4行要約カード -->
                <div class="summary-cards">
                    ${this.renderSummaryCard('engine', engineSummary, '⚙️')}
                    ${this.renderSummaryCard('interface', interfaceSummary, '🌐')}
                    ${this.renderSummaryCard('safemode', safeModeSummary, '🛡️')}
                </div>
                
                <!-- 詳細分析（アコーディオン） -->
                <details class="detailed-analysis">
                    <summary class="analysis-toggle">
                        <span class="toggle-icon">▶</span>
                        詳細分析を見る
                    </summary>
                    <div class="analysis-content">
                        ${this.renderDetailedAnalysis(detailedAnalysis)}
                    </div>
                </details>
                
                <!-- スコア説明 -->
                <div class="score-explanation">
                    ${this.renderScoreExplanation(scoreExplanation)}
                </div>
            </div>
        `;
    } catch (error) {
        console.error('サマリー生成エラー:', error);
        return '<div class="summary-error">サマリーの生成中にエラーが発生しました</div>';
    }
}

/**
 * 4行要約カードをレンダリング
 */
renderSummaryCard(osType, summary, icon) {
    if (!summary) return '';
    
    return `
        <div class="summary-card summary-card-${osType}">
            <div class="summary-card-icon">${icon}</div>
            <div class="summary-card-content">
                <div class="summary-line summary-line-title">${summary.line1}</div>
                <div class="summary-line summary-line-state">${summary.line2}</div>
                <div class="summary-line summary-line-energy">${summary.line3}</div>
                <div class="summary-line summary-line-action">${summary.line4}</div>
            </div>
        </div>
    `;
}

/**
 * 詳細分析をレンダリング
 */
renderDetailedAnalysis(analysisLines) {
    if (!analysisLines || !Array.isArray(analysisLines)) return '';
    
    return `
        <div class="detailed-analysis-content">
            ${analysisLines.map(line => {
                if (line === '') {
                    return '<div class="analysis-spacer"></div>';
                } else if (line.startsWith('【')) {
                    return `<h4 class="analysis-section-title">${line}</h4>`;
                } else if (line.startsWith('✨')) {
                    return `<div class="analysis-strength">${line}</div>`;
                } else if (line.startsWith('🎯')) {
                    return `<div class="analysis-hint">${line}</div>`;
                } else {
                    return `<div class="analysis-line">${line}</div>`;
                }
            }).join('')}
        </div>
    `;
}

/**
 * スコア説明をレンダリング
 */
renderScoreExplanation(explanation) {
    if (!explanation) return '';
    
    return `
        <div class="score-explanation-content">
            <h3 class="score-title">
                <span class="score-icon">📈</span>
                ${explanation.title}
            </h3>
            <p class="score-description">${explanation.description}</p>
            <div class="score-ranges">
                ${explanation.ranges.map(range => `
                    <div class="score-range">
                        <span class="range-value">${range.range}</span>
                        <span class="range-meaning">${range.meaning}</span>
                        <span class="range-advice">${range.advice}</span>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

/**
 * 全体サマリー生成（オプション）
 */
generateOverallSummary(summaryGenerator) {
    // 将来的な拡張用
    return null;
}
```

### Phase 3: CSSスタイリング（推定30分）

#### Task 3-1: サマリー用スタイル追加
**ファイル**: `/public/css/results.css`
**行番号**: ファイル末尾に追加
**実装要件**: 
1. サマリーカードのスタイル
2. アコーディオンのアニメーション
3. レスポンシブ対応

**期待される実装**:
```css
/* ==========================================
   サマリーセクション
   ========================================== */

.summary-container {
    background: linear-gradient(135deg, #f0f4ff 0%, #e8f0ff 100%);
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.summary-header {
    margin-bottom: 1.5rem;
    text-align: center;
}

.summary-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2c3e50;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.summary-icon {
    font-size: 1.8rem;
}

/* 4行要約カード */
.summary-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.summary-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    display: flex;
    gap: 1rem;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.summary-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
}

.summary-card-engine {
    border-left: 4px solid #FF6B6B;
}

.summary-card-interface {
    border-left: 4px solid #4ECDC4;
}

.summary-card-safemode {
    border-left: 4px solid #45B7D1;
}

.summary-card-icon {
    font-size: 2rem;
    line-height: 1;
}

.summary-card-content {
    flex: 1;
}

.summary-line {
    margin-bottom: 0.5rem;
    line-height: 1.6;
}

.summary-line-title {
    font-weight: 600;
    color: #2c3e50;
    font-size: 1.1rem;
}

.summary-line-state {
    color: #5a6c7d;
}

.summary-line-energy {
    color: #FF6B6B;
    font-weight: 500;
}

.summary-line-action {
    color: #4ECDC4;
    font-weight: 500;
}

/* 詳細分析アコーディオン */
.detailed-analysis {
    background: white;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    overflow: hidden;
}

.analysis-toggle {
    width: 100%;
    padding: 1.25rem 1.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    transition: background 0.3s ease;
    list-style: none;
}

.analysis-toggle:hover {
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
}

.analysis-toggle::-webkit-details-marker {
    display: none;
}

.toggle-icon {
    transition: transform 0.3s ease;
    display: inline-block;
}

.detailed-analysis[open] .toggle-icon {
    transform: rotate(90deg);
}

.analysis-content {
    padding: 1.5rem;
    background: white;
}

.detailed-analysis-content {
    font-size: 1rem;
    line-height: 1.8;
}

.analysis-section-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2c3e50;
    margin: 1rem 0 0.5rem 0;
}

.analysis-section-title:first-child {
    margin-top: 0;
}

.analysis-line {
    color: #5a6c7d;
    margin-bottom: 0.5rem;
}

.analysis-strength {
    color: #4ECDC4;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.analysis-hint {
    color: #FF6B6B;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.analysis-spacer {
    height: 0.75rem;
}

/* スコア説明 */
.score-explanation {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
}

.score-explanation-content {
    max-width: 800px;
    margin: 0 auto;
}

.score-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.2rem;
    color: #2c3e50;
    margin-bottom: 1rem;
}

.score-description {
    color: #5a6c7d;
    margin-bottom: 1.5rem;
    line-height: 1.6;
}

.score-ranges {
    display: grid;
    gap: 1rem;
}

.score-range {
    display: grid;
    grid-template-columns: 120px 1fr auto;
    gap: 1rem;
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 8px;
    align-items: center;
}

.range-value {
    font-weight: 600;
    color: #2c3e50;
}

.range-meaning {
    color: #5a6c7d;
}

.range-advice {
    color: #4ECDC4;
    font-size: 0.9rem;
}

/* レスポンシブ対応 */
@media (max-width: 768px) {
    .summary-container {
        padding: 1.5rem;
    }
    
    .summary-cards {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .summary-card {
        padding: 1.25rem;
    }
    
    .score-range {
        grid-template-columns: 1fr;
        gap: 0.5rem;
    }
    
    .range-value {
        font-size: 1rem;
    }
}

@media (max-width: 480px) {
    .summary-container {
        padding: 1rem;
        border-radius: 12px;
    }
    
    .summary-title {
        font-size: 1.25rem;
    }
    
    .summary-card {
        padding: 1rem;
        flex-direction: column;
        text-align: center;
    }
    
    .summary-card-icon {
        font-size: 1.5rem;
    }
    
    .analysis-toggle {
        padding: 1rem 1.25rem;
        font-size: 1rem;
    }
    
    .analysis-content {
        padding: 1.25rem;
    }
}

/* アニメーション */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.summary-card {
    animation: fadeIn 0.5s ease-out;
}

.summary-card:nth-child(2) {
    animation-delay: 0.1s;
}

.summary-card:nth-child(3) {
    animation-delay: 0.2s;
}

/* アクセシビリティ */
.summary-card:focus-within,
.analysis-toggle:focus {
    outline: 2px solid #667eea;
    outline-offset: 2px;
}

/* ダークモード対応（将来的な拡張用） */
@media (prefers-color-scheme: dark) {
    /* ダークモード用スタイルを後日追加 */
}
```

### Phase 4: HTMLファイル更新（推定15分）

#### Task 4-1: results.htmlにSummaryGenerator読み込み追加
**ファイル**: `/public/results.html`
**行番号**: 78行目付近（HexagramExtractorの後）
**実装要件**: 
1. SummaryGenerator.jsのscriptタグ追加
2. 読み込み順序の確認

**期待される変更**:
```html
<!-- 行番号: 78付近に追加 -->
<!-- HexagramExtractor -->
<script src="js/core/HexagramExtractor.js"></script>

<!-- 新規追加: SummaryGenerator -->
<script src="js/core/SummaryGenerator.js"></script>

<!-- タブシステム -->
<script src="js/components/TabNavigator.js"></script>
```

## 🔍 レビューチェックリスト

### 機能確認
- [ ] 4行要約が各OSごとに正しく表示される
- [ ] 10行詳細分析がアコーディオンで開閉できる
- [ ] スコア説明が分かりやすく表示される
- [ ] V3データベースとの連携が正常動作
- [ ] データがない場合のフォールバック表示

### コード品質
- [ ] 日本漢字のみ使用（中国漢字なし）
- [ ] エラーハンドリングが適切
- [ ] コメントが適切に記載
- [ ] 既存機能を破壊していない
- [ ] メモリリークがない

### パフォーマンス
- [ ] 初期表示が1秒以内
- [ ] アコーディオンのアニメーションがスムーズ
- [ ] 大量データでも問題なく動作

### UI/UX
- [ ] モバイルでも見やすい
- [ ] タッチ操作に対応
- [ ] キーボード操作可能
- [ ] スクリーンリーダー対応

## ⚠️ 注意事項

### 削除対象ファイル
なし（既存ファイルの削除は不要）

### 新規作成ファイル
1. `/public/js/core/SummaryGenerator.js`

### 修正対象ファイル
1. `/public/js/tabs/BasicResultsTab.js`
2. `/public/css/results.css`
3. `/public/results.html`

### 重要な制約
1. **V3データベースの活用**: 必ずhexagramHumanTraitsV3を使用
2. **中国漢字禁止**: すべての文字列で日本漢字のみ使用
3. **既存機能の保護**: 現在のV3データ表示機能を破壊しない
4. **エラー処理**: V3データが取得できない場合のフォールバック必須

## 📚 参考資料

### 既存実装の参照先
- V3データ取得ロジック: `/public/js/tabs/BasicResultsTab.js` の getV3DataForOS() メソッド
- TripleOSInteractionAnalyzer: `/public/js/core/TripleOSInteractionAnalyzer.js`
- V3データベース構造: `/public/js/data/hexagram-human-traits-v3.js`

### デザイン参照
- 既存のカードデザイン: `/public/css/results.css` の .os-card クラス
- 青色基調のカラーパレット: `#667eea`, `#764ba2`, `#4ECDC4`, `#FF6B6B`, `#45B7D1`

## 🚀 実装開始手順

1. まず `/public/js/core/SummaryGenerator.js` を新規作成
2. 次に `/public/js/tabs/BasicResultsTab.js` を修正
3. `/public/css/results.css` にスタイルを追加
4. `/public/results.html` でSummaryGeneratorを読み込み
5. ブラウザで動作確認とデバッグ
6. Playwrightでテスト実行

---

**TRAE作業依頼文（コピペ用）**:
```
【TRAE作業依頼】

参照ドキュメント: /Users/hideakimacbookair/Desktop/haqei-analyzer/20250821_TRAE向け_サマリー機能実装作業指示書.md

上記ドキュメントに記載された内容に従って実装を進めてください。
特にPhase 1から順番に実装し、各フェーズ完了後に動作確認を行ってください。
```