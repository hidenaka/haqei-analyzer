# Mac mini用 HAQEI Analyzer MCP環境セットアップガイド

## 🎯 概要

MacBook AirからMac miniへ同じMCP環境を移行するためのステップバイステップガイドです。

## 📋 前提条件

### Mac mini側で必要なソフトウェア
- **Node.js v22.17.0以上**
- **Python 3.12以上**
- **Git**
- **Claude Desktop** (最新版)

### 確認コマンド
```bash
node --version    # v22.17.0以上
python3 --version # Python 3.12以上
git --version     # 任意のバージョン
```

## 🔄 同期手順

### 1. プロジェクトのクローン/同期

Mac mini側で実行：

```bash
# 新規クローンの場合
cd ~/Desktop
git clone <リポジトリURL> haqei-analyzer
cd haqei-analyzer

# 既存プロジェクトの更新の場合
cd ~/Desktop/haqei-analyzer
git pull origin main
```

### 2. 依存関係のインストール

```bash
# Node.js依存関係
npm install

# Python依存関係（Serena用、必要に応じて）
pip3 install -r requirements.txt  # requirements.txtがある場合
```

### 3. MCP環境セットアップ実行

```bash
# セットアップスクリプトに実行権限付与
chmod +x setup-mcp-environment.sh

# セットアップ実行
./setup-mcp-environment.sh
```

セットアップスクリプトは自動的に：
- Mac miniを検出
- 適切なパスに設定ファイルを生成
- Claude Desktop設定を作成
- 依存関係をチェック

### 4. 設定ファイルの確認

生成された設定ファイルを確認：

```bash
# MCP設定ファイル
cat ~/Library/Application\ Support/Claude/claude_desktop_config.json

# 環境変数ファイル
cat .env.mcp

# Cipher設定
cat cipher.config.yaml

# Serena設定  
cat .serena/project.yml
```

### 5. Claude Desktopの再起動

1. Claude Desktopを完全終了
2. Claude Desktopを再起動
3. 右下のMCPサーバー接続状況を確認

## 🧪 動作テスト

### MCPサービス起動

```bash
# 全サービス起動
./start-mcp-services.sh

# 個別サービステスト
npm run cipher:start
node tsumiki-cli.js --help
python3 -m serena_mcp --version
npx @playwright/mcp --version
```

### 接続確認

```bash
# Cipher接続確認
curl http://localhost:3001/

# ポート使用状況確認
lsof -i :3001
```

## 📂 ディレクトリ構造の確認

Mac mini上で以下の構造になっていることを確認：

```
~/Desktop/haqei-analyzer/
├── cipher-server.js          # Cipher MCPサーバー
├── tsumiki-cli.js            # Tsumiki CLI
├── .serena/
│   └── project.yml           # Serena設定
├── setup-mcp-environment.sh  # セットアップスクリプト
├── start-mcp-services.sh     # サービス起動スクリプト
├── .env.mcp                  # 環境変数
└── claude-mcp-config.json    # MCP設定参考
```

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### 1. Node.jsパスが見つからない
```bash
# Node.jsの場所確認
which node

# NVMを使用している場合
nvm list
nvm use v22.17.0
```

#### 2. Python モジュールが見つからない
```bash
# Python3の場所確認
which python3

# モジュール検索パス確認
python3 -c "import sys; print('\n'.join(sys.path))"
```

#### 3. Claude Desktop設定が反映されない
```bash
# Claude Desktop完全再起動
pkill -f "Claude Desktop"
sleep 3
open -a "Claude Desktop"

# MCP設定ファイル確認
cat ~/Library/Application\ Support/Claude/claude_desktop_config.json
```

#### 4. ポート競合
```bash
# ポート使用状況確認
lsof -i :3001

# 競合プロセス終了
pkill -f cipher-server
```

### デバッグ用コマンド

```bash
# システム情報表示
uname -a
hostname

# 環境変数確認
env | grep -E "(NODE|PYTHON|PATH)"

# ファイル権限確認
ls -la setup-mcp-environment.sh
ls -la start-mcp-services.sh
```

## 🔐 セキュリティ注意事項

- **プライベートキー**: ~/.ssh/config でSSHキーを適切に設定
- **環境変数**: 機密情報は.env.mcpに記載せず、システム環境変数を使用
- **ファイル権限**: スクリプトファイルの権限を適切に設定

## 🚀 完了確認

すべて正しく設定された場合：

1. **Claude Desktop起動時**: 右下にMCPサーバー接続表示
2. **コマンド実行**: MCPコマンドが正常動作
3. **サービス起動**: `./start-mcp-services.sh` が正常完了

## 📞 サポート

問題が発生した場合：

1. **ログ確認**: 各サービスのエラーログを確認
2. **設定ファイル**: パスや権限を再確認
3. **依存関係**: Node.js/Python のバージョンを確認

## 🎉 完了

Mac mini環境でHAQEI Analyzer + MCP環境が正常に動作することを確認できれば、セットアップ完了です！

---

**Generated by HAQEI Analyzer MCP Setup System**  
**Date**: $(date)  
**MacBook Air → Mac mini Migration Guide**