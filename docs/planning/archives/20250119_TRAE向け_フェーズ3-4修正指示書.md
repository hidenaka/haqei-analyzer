# ğŸ“‹ TRAEå‘ã‘ ãƒ•ã‚§ãƒ¼ã‚º3-4ä¿®æ­£æŒ‡ç¤ºæ›¸ - ãƒ‡ãƒ¼ã‚¿æ´»ç”¨å¼·åŒ–ã¨ã‚¹ãƒãƒ›æœ€é©åŒ–

## ğŸ¯ ä¿®æ­£ã®ç›®çš„

1. **æ´å¯Ÿã‚¿ãƒ–ãƒ»ã‚·ãƒŠãƒªã‚ªã‚¿ãƒ–**: H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’æ´»ç”¨ã—ã€ã‚ˆã‚Šæ·±ã„åˆ†æã‚’æä¾›
2. **ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¿ãƒ–**: ã‚¹ãƒãƒ›ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®å…±æœ‰æ©Ÿèƒ½ã‚’å®Ÿè£…
3. **å‹•ä½œç¢ºèª**: ä¿®æ­£å¾Œã®ç”»é¢è¡¨ç¤ºãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

## ğŸ“Š ãƒ•ã‚§ãƒ¼ã‚º3: æ´å¯Ÿã‚¿ãƒ–ã®H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº

### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«: `/public/js/components/tabs/InsightsTab.js`

#### 1. ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«HexagramExtractorè¿½åŠ 

```javascript
class InsightsTab extends BaseTabView {
    constructor(tabId) {
        super(tabId);
        this.analysisData = null;
        this.insights = null;
        this.ichingEngine = null;
        this.hexagramExtractor = null; // è¿½åŠ 
    }
```

#### 2. åˆæœŸåŒ–ãƒ¡ã‚½ãƒƒãƒ‰ã®ä¿®æ­£

```javascript
    /**
     * ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆæœŸåŒ–
     */
    init() {
        this.initializeIChingEngine();
        this.initializeHexagramExtractor(); // è¿½åŠ 
        this.bindEvents();
    }

    /**
     * HexagramExtractorã®åˆæœŸåŒ–ï¼ˆæ–°è¦è¿½åŠ ï¼‰
     */
    initializeHexagramExtractor() {
        if (typeof HexagramExtractor !== 'undefined') {
            this.hexagramExtractor = new HexagramExtractor();
            console.log('âœ… InsightsTab: HexagramExtractor initialized');
        } else {
            console.warn('âš ï¸ InsightsTab: HexagramExtractor not available');
        }
    }
```

#### 3. æ˜“å¦è©³ç´°æƒ…å ±å–å¾—ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ 

```javascript
    /**
     * H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æ˜“å¦ã®è©³ç´°æƒ…å ±ã‚’å–å¾—
     */
    getHexagramDetailedInsights(hexagramName, osType) {
        if (!this.hexagramExtractor) {
            return this.getFallbackInsights(hexagramName, osType);
        }

        const hexagramData = this.hexagramExtractor.getHexagramDataByName(hexagramName);
        
        if (!hexagramData || hexagramData.length === 0) {
            return this.getFallbackInsights(hexagramName, osType);
        }

        // æœ€åˆã®3ã¤ã®çˆ»ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦æ´å¯Ÿã‚’ç”Ÿæˆ
        const topYaos = hexagramData.slice(0, 3);
        
        return {
            keywords: this.extractKeywords(topYaos),
            interpretation: this.generateInterpretation(topYaos, osType),
            advice: this.generatePersonalizedAdvice(topYaos, osType),
            scores: this.calculateDetailedScores(topYaos)
        };
    }

    /**
     * ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º
     */
    extractKeywords(yaos) {
        const allKeywords = [];
        yaos.forEach(yao => {
            if (yao['ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰']) {
                allKeywords.push(...yao['ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰']);
            }
        });
        // é‡è¤‡ã‚’é™¤å»ã—ã¦æœ€åˆã®5ã¤ã‚’è¿”ã™
        return [...new Set(allKeywords)].slice(0, 5);
    }

    /**
     * è§£é‡ˆã®ç”Ÿæˆ
     */
    generateInterpretation(yaos, osType) {
        const interpretations = yaos.map(yao => yao['ç¾ä»£è§£é‡ˆã®è¦ç´„'] || '').filter(i => i);
        
        if (interpretations.length === 0) {
            return this.getDefaultInterpretation(osType);
        }

        // OSã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦è§£é‡ˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
        const osContext = {
            'engine': 'ã‚ãªãŸã®å†…çš„å‹•æ©Ÿã¨å‰µé€ æ€§ã«ãŠã„ã¦ã€',
            'interface': 'ã‚ãªãŸã®ç¤¾ä¼šçš„ãªé–¢ã‚ã‚Šã«ãŠã„ã¦ã€',
            'safemode': 'ã‚ãªãŸã®å¿ƒã®å®‰å®šã¨åŸºç›¤ã«ãŠã„ã¦ã€'
        };

        return osContext[osType] + interpretations[0];
    }

    /**
     * ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ
     */
    generatePersonalizedAdvice(yaos, osType) {
        const advice = [];
        
        yaos.forEach((yao, index) => {
            const score = yao['S1_åŸºæœ¬ã‚¹ã‚³ã‚¢'] || 50;
            const keyword = yao['ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰'] ? yao['ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰'][0] : '';
            
            if (score >= 70) {
                advice.push(`ã€Œ${keyword}ã€ã®åŠ›ã‚’æœ€å¤§é™ã«æ´»ç”¨ã—ã¾ã—ã‚‡ã†`);
            } else if (score >= 50) {
                advice.push(`ã€Œ${keyword}ã€ã®å´é¢ã‚’ã•ã‚‰ã«ç™ºå±•ã•ã›ã‚‹ä½™åœ°ãŒã‚ã‚Šã¾ã™`);
            } else {
                advice.push(`ã€Œ${keyword}ã€ã®è¦ç´ ã‚’æ„è­˜çš„ã«å¼·åŒ–ã™ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™`);
            }
        });

        return advice.slice(0, 3);
    }

    /**
     * è©³ç´°ã‚¹ã‚³ã‚¢è¨ˆç®—
     */
    calculateDetailedScores(yaos) {
        const scores = {
            potential: 0,
            stability: 0,
            growth: 0
        };

        yaos.forEach(yao => {
            scores.potential += (yao['S1_åŸºæœ¬ã‚¹ã‚³ã‚¢'] || 0) * 0.4;
            scores.stability += (yao['S2_é–¢é€£ã‚¹ã‚³ã‚¢'] || 0) * 0.3;
            scores.growth += (yao['S3_çŠ¶æ³ã‚¹ã‚³ã‚¢'] || 0) * 0.3;
        });

        return {
            potential: Math.round(scores.potential / yaos.length),
            stability: Math.round(scores.stability / yaos.length),
            growth: Math.round(scores.growth / yaos.length)
        };
    }
```

#### 4. æ˜“çµŒæ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä¿®æ­£

```javascript
    /**
     * æ˜“çµŒæ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆä¿®æ­£ç‰ˆï¼‰
     */
    renderIChingOverview() {
        const { engineOS, interfaceOS, safeModeOS } = this.analysisData;
        
        // H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰è©³ç´°æƒ…å ±ã‚’å–å¾—
        const engineInsights = this.getHexagramDetailedInsights(engineOS.hexagram.name, 'engine');
        const interfaceInsights = this.getHexagramDetailedInsights(interfaceOS.hexagram.name, 'interface');
        const safeModeInsights = this.getHexagramDetailedInsights(safeModeOS.hexagram.name, 'safemode');
        
        return `
            <div class="iching-overview-section">
                <h3 class="section-title">
                    <span class="section-icon">â˜¯ï¸</span>
                    æ˜“çµŒã«ã‚ˆã‚‹æ·±å±¤åˆ†æ
                </h3>
                <div class="hexagram-grid">
                    <!-- Engine OS Card -->
                    <div class="hexagram-insight-card engine">
                        <div class="hexagram-header">
                            <div class="hexagram-symbol">${engineOS.hexagram.symbol}</div>
                            <div class="hexagram-info">
                                <h4 class="hexagram-name">${engineOS.hexagram.name}</h4>
                                <p class="hexagram-role">å†…ãªã‚‹ä¾¡å€¤è¦³ã®æºæ³‰</p>
                            </div>
                        </div>
                        
                        <div class="hexagram-keywords">
                            ${engineInsights.keywords.map(keyword => 
                                `<span class="keyword-tag">${keyword}</span>`
                            ).join('')}
                        </div>
                        
                        <div class="hexagram-interpretation">
                            <p>${engineInsights.interpretation}</p>
                        </div>
                        
                        <div class="hexagram-scores">
                            <div class="score-item">
                                <span class="score-label">æ½œåœ¨åŠ›</span>
                                <div class="score-bar">
                                    <div class="score-fill" style="width: ${engineInsights.scores.potential}%"></div>
                                </div>
                                <span class="score-value">${engineInsights.scores.potential}%</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">å®‰å®šæ€§</span>
                                <div class="score-bar">
                                    <div class="score-fill" style="width: ${engineInsights.scores.stability}%"></div>
                                </div>
                                <span class="score-value">${engineInsights.scores.stability}%</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">æˆé•·æ€§</span>
                                <div class="score-bar">
                                    <div class="score-fill" style="width: ${engineInsights.scores.growth}%"></div>
                                </div>
                                <span class="score-value">${engineInsights.scores.growth}%</span>
                            </div>
                        </div>
                        
                        <div class="hexagram-advice">
                            <h5 class="advice-title">ğŸ’¡ å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h5>
                            <ul class="advice-list">
                                ${engineInsights.advice.map(item => 
                                    `<li>${item}</li>`
                                ).join('')}
                            </ul>
                        </div>
                    </div>

                    <!-- Interface OS Card -->
                    <div class="hexagram-insight-card interface">
                        <div class="hexagram-header">
                            <div class="hexagram-symbol">${interfaceOS.hexagram.symbol}</div>
                            <div class="hexagram-info">
                                <h4 class="hexagram-name">${interfaceOS.hexagram.name}</h4>
                                <p class="hexagram-role">ç¤¾ä¼šã¨ã®é–¢ã‚ã‚Šæ–¹</p>
                            </div>
                        </div>
                        
                        <div class="hexagram-keywords">
                            ${interfaceInsights.keywords.map(keyword => 
                                `<span class="keyword-tag">${keyword}</span>`
                            ).join('')}
                        </div>
                        
                        <div class="hexagram-interpretation">
                            <p>${interfaceInsights.interpretation}</p>
                        </div>
                        
                        <div class="hexagram-scores">
                            <div class="score-item">
                                <span class="score-label">æ½œåœ¨åŠ›</span>
                                <div class="score-bar">
                                    <div class="score-fill" style="width: ${interfaceInsights.scores.potential}%"></div>
                                </div>
                                <span class="score-value">${interfaceInsights.scores.potential}%</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">å®‰å®šæ€§</span>
                                <div class="score-bar">
                                    <div class="score-fill" style="width: ${interfaceInsights.scores.stability}%"></div>
                                </div>
                                <span class="score-value">${interfaceInsights.scores.stability}%</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">æˆé•·æ€§</span>
                                <div class="score-bar">
                                    <div class="score-fill" style="width: ${interfaceInsights.scores.growth}%"></div>
                                </div>
                                <span class="score-value">${interfaceInsights.scores.growth}%</span>
                            </div>
                        </div>
                        
                        <div class="hexagram-advice">
                            <h5 class="advice-title">ğŸ’¡ å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h5>
                            <ul class="advice-list">
                                ${interfaceInsights.advice.map(item => 
                                    `<li>${item}</li>`
                                ).join('')}
                            </ul>
                        </div>
                    </div>

                    <!-- Safe Mode OS Card -->
                    <div class="hexagram-insight-card safemode">
                        <div class="hexagram-header">
                            <div class="hexagram-symbol">${safeModeOS.hexagram.symbol}</div>
                            <div class="hexagram-info">
                                <h4 class="hexagram-name">${safeModeOS.hexagram.name}</h4>
                                <p class="hexagram-role">å¿ƒã®åŸºç›¤ã¨å®‰å®š</p>
                            </div>
                        </div>
                        
                        <div class="hexagram-keywords">
                            ${safeModeInsights.keywords.map(keyword => 
                                `<span class="keyword-tag">${keyword}</span>`
                            ).join('')}
                        </div>
                        
                        <div class="hexagram-interpretation">
                            <p>${safeModeInsights.interpretation}</p>
                        </div>
                        
                        <div class="hexagram-scores">
                            <div class="score-item">
                                <span class="score-label">æ½œåœ¨åŠ›</span>
                                <div class="score-bar">
                                    <div class="score-fill" style="width: ${safeModeInsights.scores.potential}%"></div>
                                </div>
                                <span class="score-value">${safeModeInsights.scores.potential}%</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">å®‰å®šæ€§</span>
                                <div class="score-bar">
                                    <div class="score-fill" style="width: ${safeModeInsights.scores.stability}%"></div>
                                </div>
                                <span class="score-value">${safeModeInsights.scores.stability}%</span>
                            </div>
                            <div class="score-item">
                                <span class="score-label">æˆé•·æ€§</span>
                                <div class="score-bar">
                                    <div class="score-fill" style="width: ${safeModeInsights.scores.growth}%"></div>
                                </div>
                                <span class="score-value">${safeModeInsights.scores.growth}%</span>
                            </div>
                        </div>
                        
                        <div class="hexagram-advice">
                            <h5 class="advice-title">ğŸ’¡ å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h5>
                            <ul class="advice-list">
                                ${safeModeInsights.advice.map(item => 
                                    `<li>${item}</li>`
                                ).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
```

## ğŸ® ãƒ•ã‚§ãƒ¼ã‚º3: ã‚·ãƒŠãƒªã‚ªã‚¿ãƒ–ã®H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº

### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«: `/public/js/components/tabs/ScenariosTab.js`

#### 1. ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨initä¿®æ­£

```javascript
class ScenariosTab extends BaseTabView {
    constructor(tabId) {
        super(tabId);
        this.analysisData = null;
        this.currentScenario = null;
        this.dialogueHistory = [];
        this.simulationState = 'idle';
        this.interactionEngine = null;
        this.hexagramExtractor = null; // è¿½åŠ 
    }

    init() {
        this.initializeInteractionEngine();
        this.initializeHexagramExtractor(); // è¿½åŠ 
        this.bindEvents();
    }

    /**
     * HexagramExtractorã®åˆæœŸåŒ–ï¼ˆæ–°è¦è¿½åŠ ï¼‰
     */
    initializeHexagramExtractor() {
        if (typeof HexagramExtractor !== 'undefined') {
            this.hexagramExtractor = new HexagramExtractor();
            console.log('âœ… ScenariosTab: HexagramExtractor initialized');
        } else {
            console.warn('âš ï¸ ScenariosTab: HexagramExtractor not available');
        }
    }
```

#### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºã‚·ãƒŠãƒªã‚ªç”Ÿæˆ

```javascript
    /**
     * H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ´»ç”¨ã—ãŸã‚·ãƒŠãƒªã‚ªç”Ÿæˆ
     */
    generateDataDrivenScenarios() {
        if (!this.analysisData || !this.hexagramExtractor) {
            return this.getDefaultScenarios();
        }

        const scenarios = [];
        
        // å„OSã®æ˜“å¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const engineData = this.hexagramExtractor.getHexagramDataByName(
            this.analysisData.engineOS.hexagram.name
        );
        const interfaceData = this.hexagramExtractor.getHexagramDataByName(
            this.analysisData.interfaceOS.hexagram.name
        );
        const safeModeData = this.hexagramExtractor.getHexagramDataByName(
            this.analysisData.safeModeOS.hexagram.name
        );

        // ã‚·ãƒŠãƒªã‚ª1: å†…çš„è‘›è—¤
        if (engineData && engineData.length > 0) {
            const engineKeywords = engineData[0]['ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰'] || [];
            scenarios.push({
                id: 'inner-conflict',
                name: 'å†…çš„è‘›è—¤ã®è§£æ±º',
                icon: 'ğŸ”¥',
                description: `ã€Œ${engineKeywords[0]}ã€ã¨ã€Œ${engineKeywords[1] || 'å®‰å®š'}ã€ã®é–“ã§æºã‚Œå‹•ãå¿ƒã®å¯¾è©±`,
                participants: ['Engine OS', 'Safe Mode OS'],
                dialogue: this.generateConflictDialogue(engineData, safeModeData),
                insights: this.extractScenarioInsights(engineData, safeModeData)
            });
        }

        // ã‚·ãƒŠãƒªã‚ª2: ç¤¾ä¼šçš„èª¿å’Œ
        if (interfaceData && interfaceData.length > 0) {
            const interfaceKeywords = interfaceData[0]['ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰'] || [];
            scenarios.push({
                id: 'social-harmony',
                name: 'ç¤¾ä¼šçš„èª¿å’Œã®æ¢æ±‚',
                icon: 'ğŸ¤',
                description: `ã€Œ${interfaceKeywords[0]}ã€ã‚’é€šã˜ã¦ä»–è€…ã¨ã®é–¢ä¿‚ã‚’æ·±ã‚ã‚‹å¯¾è©±`,
                participants: ['Interface OS', 'Engine OS'],
                dialogue: this.generateHarmonyDialogue(interfaceData, engineData),
                insights: this.extractScenarioInsights(interfaceData, engineData)
            });
        }

        // ã‚·ãƒŠãƒªã‚ª3: çµ±åˆçš„æˆé•·
        scenarios.push({
            id: 'integrated-growth',
            name: 'çµ±åˆçš„æˆé•·ã¸ã®é“',
            icon: 'ğŸŒŸ',
            description: '3ã¤ã®OSãŒå”åŠ›ã—ã¦æ–°ãŸãªå¯èƒ½æ€§ã‚’æ¢ã‚‹å¯¾è©±',
            participants: ['Engine OS', 'Interface OS', 'Safe Mode OS'],
            dialogue: this.generateIntegratedDialogue(engineData, interfaceData, safeModeData),
            insights: this.extractTripleInsights(engineData, interfaceData, safeModeData)
        });

        return scenarios;
    }

    /**
     * è‘›è—¤å¯¾è©±ã®ç”Ÿæˆ
     */
    generateConflictDialogue(engineData, safeModeData) {
        const dialogue = [];
        
        if (engineData && engineData[0]) {
            const engineInterpretation = engineData[0]['ç¾ä»£è§£é‡ˆã®è¦ç´„'] || '';
            const engineKeyword = engineData[0]['ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰'][0] || 'å‰µé€ æ€§';
            
            dialogue.push({
                speaker: 'Engine OS',
                message: `ç§ã¯ã€Œ${engineKeyword}ã€ã‚’è¿½æ±‚ã—ãŸã„ã€‚${engineInterpretation.substring(0, 50)}...`,
                emotion: 'passionate'
            });
        }

        if (safeModeData && safeModeData[0]) {
            const safeModeKeyword = safeModeData[0]['ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰'][0] || 'å®‰å®š';
            const safeModeInterpretation = safeModeData[0]['ç¾ä»£è§£é‡ˆã®è¦ç´„'] || '';
            
            dialogue.push({
                speaker: 'Safe Mode OS',
                message: `ã§ã‚‚ã€Œ${safeModeKeyword}ã€ã‚‚å¤§åˆ‡ã§ã™ã€‚${safeModeInterpretation.substring(0, 50)}...`,
                emotion: 'cautious'
            });
        }

        dialogue.push({
            speaker: 'Engine OS',
            message: 'ãƒªã‚¹ã‚¯ã‚’æã‚Œã¦ã„ã¦ã¯æˆé•·ã§ããªã„ã€‚æ–°ã—ã„æŒ‘æˆ¦ãŒå¿…è¦ã ã€‚',
            emotion: 'determined'
        });

        dialogue.push({
            speaker: 'Safe Mode OS',
            message: 'æ…é‡ã«é€²ã‚€ã“ã¨ã§ã€æŒç¶šå¯èƒ½ãªæˆé•·ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚',
            emotion: 'thoughtful'
        });

        return dialogue;
    }
```

#### 3. ã‚·ãƒŠãƒªã‚ªè¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä¿®æ­£

```javascript
    /**
     * ã‚·ãƒŠãƒªã‚ªã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆä¿®æ­£ç‰ˆï¼‰
     */
    renderScenarioSelector() {
        const scenarios = this.generateDataDrivenScenarios(); // ãƒ‡ãƒ¼ã‚¿é§†å‹•å‹ã‚·ãƒŠãƒªã‚ªã‚’ä½¿ç”¨
        
        return `
            <div class="scenario-selector-section">
                <h3 class="section-title">
                    <span class="section-icon">ğŸ¬</span>
                    ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚·ãƒŠãƒªã‚ª
                </h3>
                <p class="section-description">
                    ã‚ãªãŸã®æ˜“å¦ã«åŸºã¥ã„ãŸã€ç‹¬è‡ªã®å†…çš„å¯¾è©±ã‚·ãƒŠãƒªã‚ªã§ã™
                </p>
                <div class="scenario-grid">
                    ${scenarios.map(scenario => `
                        <div class="scenario-card" data-scenario="${scenario.id}">
                            <div class="scenario-header">
                                <span class="scenario-icon">${scenario.icon}</span>
                                <h4 class="scenario-name">${scenario.name}</h4>
                            </div>
                            <p class="scenario-description">${scenario.description}</p>
                            <div class="scenario-participants">
                                ${scenario.participants.map(participant => `
                                    <span class="participant-tag ${participant.toLowerCase().replace(' ', '-')}">${participant}</span>
                                `).join('')}
                            </div>
                            <div class="scenario-insights-preview">
                                <h5>ä¸»è¦ãªãƒ†ãƒ¼ãƒ:</h5>
                                <ul class="theme-list">
                                    ${scenario.insights ? scenario.insights.themes.map(theme => 
                                        `<li>${theme}</li>`
                                    ).join('') : ''}
                                </ul>
                            </div>
                            <button class="scenario-start-btn" onclick="scenariosTab.startScenario('${scenario.id}')">
                                ã“ã®ã‚·ãƒŠãƒªã‚ªã‚’é–‹å§‹
                            </button>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
```

## ğŸ“± ãƒ•ã‚§ãƒ¼ã‚º4: ã‚¹ãƒãƒ›å‘ã‘ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½

### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«: `/public/js/components/tabs/ExportTab.js`

#### 1. ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå½¢å¼ã®è¿½åŠ 

```javascript
    /**
     * ãƒ¬ãƒãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®åˆæœŸåŒ–ï¼ˆä¿®æ­£ç‰ˆï¼‰
     */
    initializeReportTemplates() {
        // æ—¢å­˜ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«åŠ ãˆã¦ã€ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚’è¿½åŠ 
        this.reportTemplates = [
            // ... æ—¢å­˜ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ ...
            
            // ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
            {
                id: 'mobile-card',
                name: 'ãƒ¢ãƒã‚¤ãƒ«çµæœã‚«ãƒ¼ãƒ‰',
                description: 'SNSå…±æœ‰ç”¨ã®ç”»åƒã‚«ãƒ¼ãƒ‰ï¼ˆInstagram/Twitterï¼‰',
                icon: 'ğŸ“±',
                sections: ['mobile-visual'],
                format: 'image',
                mobile: true
            },
            {
                id: 'line-share',
                name: 'LINEå…±æœ‰ç”¨ãƒ†ã‚­ã‚¹ãƒˆ',
                description: 'LINEã§é€ã‚Šã‚„ã™ã„å½¢å¼ã®ãƒ†ã‚­ã‚¹ãƒˆ',
                icon: 'ğŸ’¬',
                sections: ['line-text'],
                format: 'text',
                mobile: true
            },
            {
                id: 'qr-code',
                name: 'QRã‚³ãƒ¼ãƒ‰ä¿å­˜',
                description: 'çµæœã‚’QRã‚³ãƒ¼ãƒ‰ã§ä¿å­˜ãƒ»å…±æœ‰',
                icon: 'ğŸ“²',
                sections: ['qr'],
                format: 'qr',
                mobile: true
            }
        ];
    }
```

#### 2. ãƒ¢ãƒã‚¤ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ 

```javascript
    /**
     * ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ–°è¦è¿½åŠ ï¼‰
     */
    renderMobileExport() {
        const isMobile = window.innerWidth <= 768;
        
        if (!isMobile) {
            return ''; // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã¯è¡¨ç¤ºã—ãªã„
        }
        
        return `
            <div class="mobile-export-section">
                <h3 class="section-title">
                    <span class="section-icon">ğŸ“±</span>
                    ã‚¹ãƒãƒ›ã§å…±æœ‰
                </h3>
                
                <!-- SNSå…±æœ‰ã‚«ãƒ¼ãƒ‰ -->
                <div class="mobile-share-card">
                    <h4>SNSå…±æœ‰ç”¨ã‚«ãƒ¼ãƒ‰</h4>
                    <div class="share-preview" id="sharePreview">
                        ${this.generateShareCardPreview()}
                    </div>
                    <div class="share-buttons">
                        <button class="share-btn instagram" onclick="exportTab.shareToInstagram()">
                            <span class="btn-icon">ğŸ“·</span>
                            Instagramã‚¹ãƒˆãƒ¼ãƒªãƒ¼
                        </button>
                        <button class="share-btn twitter" onclick="exportTab.shareToTwitter()">
                            <span class="btn-icon">ğŸ¦</span>
                            Twitterã«æŠ•ç¨¿
                        </button>
                        <button class="share-btn download" onclick="exportTab.downloadAsImage()">
                            <span class="btn-icon">ğŸ’¾</span>
                            ç”»åƒã¨ã—ã¦ä¿å­˜
                        </button>
                    </div>
                </div>
                
                <!-- LINEå…±æœ‰ -->
                <div class="line-share-section">
                    <h4>LINE/ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§å…±æœ‰</h4>
                    <div class="line-text-preview" id="lineTextPreview">
                        ${this.generateLineText()}
                    </div>
                    <div class="line-buttons">
                        <button class="share-btn line" onclick="exportTab.shareToLine()">
                            <span class="btn-icon">ğŸ’š</span>
                            LINEã§é€ã‚‹
                        </button>
                        <button class="share-btn copy" onclick="exportTab.copyToClipboard()">
                            <span class="btn-icon">ğŸ“‹</span>
                            ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                </div>
                
                <!-- QRã‚³ãƒ¼ãƒ‰ -->
                <div class="qr-code-section">
                    <h4>QRã‚³ãƒ¼ãƒ‰ã§ä¿å­˜</h4>
                    <div class="qr-code-container" id="qrCodeContainer">
                        <!-- QRã‚³ãƒ¼ãƒ‰ã‚’ã“ã“ã«ç”Ÿæˆ -->
                    </div>
                    <p class="qr-description">
                        ã“ã®QRã‚³ãƒ¼ãƒ‰ã«ã¯çµæœã®URLãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
                        å¾Œã§ç¢ºèªã—ãŸã‚Šã€å‹é”ã¨å…±æœ‰ã§ãã¾ã™ã€‚
                    </p>
                    <button class="share-btn qr-save" onclick="exportTab.saveQRCode()">
                        <span class="btn-icon">ğŸ“²</span>
                        QRã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜
                    </button>
                </div>
            </div>
        `;
    }

    /**
     * SNSå…±æœ‰ã‚«ãƒ¼ãƒ‰ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆ
     */
    generateShareCardPreview() {
        const { engineOS, interfaceOS, safeModeOS } = this.analysisData;
        const totalScore = Math.round((engineOS.score + interfaceOS.score + safeModeOS.score) / 3);
        
        return `
            <div class="share-card-visual">
                <div class="card-header">
                    <h3 class="card-title">ç§ã®Triple OSè¨ºæ–­çµæœ</h3>
                    <div class="card-score">${totalScore}</div>
                </div>
                
                <div class="card-os-summary">
                    <div class="os-item">
                        <span class="os-emoji">âš¡</span>
                        <span class="os-name">Engine</span>
                        <span class="os-score">${engineOS.score}</span>
                        <span class="os-hexagram">${engineOS.hexagram.symbol}</span>
                    </div>
                    <div class="os-item">
                        <span class="os-emoji">ğŸ”„</span>
                        <span class="os-name">Interface</span>
                        <span class="os-score">${interfaceOS.score}</span>
                        <span class="os-hexagram">${interfaceOS.hexagram.symbol}</span>
                    </div>
                    <div class="os-item">
                        <span class="os-emoji">ğŸ›¡ï¸</span>
                        <span class="os-name">Safe Mode</span>
                        <span class="os-score">${safeModeOS.score}</span>
                        <span class="os-hexagram">${safeModeOS.hexagram.symbol}</span>
                    </div>
                </div>
                
                <div class="card-footer">
                    <p class="card-tagline">#HAQEI #è‡ªå·±åˆ†æ #Triple_OS</p>
                    <p class="card-url">haqei.com</p>
                </div>
            </div>
        `;
    }

    /**
     * LINEå…±æœ‰ç”¨ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
     */
    generateLineText() {
        const { engineOS, interfaceOS, safeModeOS } = this.analysisData;
        const totalScore = Math.round((engineOS.score + interfaceOS.score + safeModeOS.score) / 3);
        
        return `
ã€HAQEIè¨ºæ–­çµæœã€‘
ç·åˆã‚¹ã‚³ã‚¢: ${totalScore}ç‚¹

âš¡ Engine OS: ${engineOS.score}ç‚¹
${engineOS.hexagram.symbol} ${engineOS.hexagram.name}

ğŸ”„ Interface OS: ${interfaceOS.score}ç‚¹  
${interfaceOS.hexagram.symbol} ${interfaceOS.hexagram.name}

ğŸ›¡ï¸ Safe Mode OS: ${safeModeOS.score}ç‚¹
${safeModeOS.hexagram.symbol} ${safeModeOS.hexagram.name}

è©³ç´°ã¯ã“ã¡ã‚‰: https://haqei.com/results/${this.getResultId()}
        `;
    }

    /**
     * ç”»åƒã¨ã—ã¦ä¿å­˜
     */
    async downloadAsImage() {
        const shareCard = document.getElementById('sharePreview');
        
        // html2canvasãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ï¼ˆCDNè¿½åŠ ãŒå¿…è¦ï¼‰
        if (typeof html2canvas !== 'undefined') {
            const canvas = await html2canvas(shareCard);
            const link = document.createElement('a');
            link.download = `haqei-result-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        } else {
            alert('ç”»åƒç”Ÿæˆæ©Ÿèƒ½ã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™ã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            // html2canvasã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚€
            this.loadHtml2Canvas();
        }
    }

    /**
     * LINEã§å…±æœ‰
     */
    shareToLine() {
        const text = document.getElementById('lineTextPreview').textContent;
        const encodedText = encodeURIComponent(text);
        window.open(`https://line.me/R/msg/text/?${encodedText}`);
    }

    /**
     * ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
     */
    async copyToClipboard() {
        const text = document.getElementById('lineTextPreview').textContent;
        
        try {
            await navigator.clipboard.writeText(text);
            this.showNotification('âœ… ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
        } catch (err) {
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            this.showNotification('âœ… ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
        }
    }

    /**
     * é€šçŸ¥è¡¨ç¤º
     */
    showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'copy-notification';
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.classList.add('show');
        }, 10);
        
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 2000);
    }
```

#### 3. renderContentãƒ¡ã‚½ãƒƒãƒ‰ã®ä¿®æ­£

```javascript
    renderContent(container) {
        if (!this.analysisData) {
            this.showLoading(container);
            return;
        }

        const isMobile = window.innerWidth <= 768;

        const content = `
            <div class="export-container">
                ${this.renderHeader()}
                ${isMobile ? this.renderMobileExport() : ''} <!-- ãƒ¢ãƒã‚¤ãƒ«æ™‚ã¯æœ€åˆã«è¡¨ç¤º -->
                ${!isMobile ? this.renderQuickExport() : ''}
                ${!isMobile ? this.renderReportTemplates() : ''}
                ${this.renderCustomExport()}
                ${this.renderExportHistory()}
                ${!isMobile ? this.renderSharingOptions() : ''}
            </div>
        `;

        container.innerHTML = content;
        this.initializeInteractiveElements();
        
        // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        if (isMobile) {
            this.generateQRCode();
        }
    }
```

## ğŸ¨ è¿½åŠ CSS

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«: `/public/css/insights-enhanced.css`

```css
/* æ´å¯Ÿã‚¿ãƒ–ã®å¼·åŒ–ã‚¹ã‚¿ã‚¤ãƒ« */
.hexagram-insight-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.hexagram-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 16px;
}

.hexagram-symbol {
    font-size: 48px;
    color: #1E293B;
}

.hexagram-keywords {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
}

.keyword-tag {
    padding: 4px 12px;
    background: linear-gradient(135deg, #667EEA, #764BA2);
    color: white;
    border-radius: 16px;
    font-size: 13px;
    font-weight: 500;
}

.hexagram-scores {
    margin: 16px 0;
}

.score-item {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 8px;
}

.score-label {
    width: 60px;
    font-size: 12px;
    color: #6B7280;
}

.score-bar {
    flex: 1;
    height: 8px;
    background: #E5E7EB;
    border-radius: 4px;
    overflow: hidden;
}

.score-fill {
    height: 100%;
    background: linear-gradient(90deg, #3B82F6, #8B5CF6);
    transition: width 0.6s ease;
}

.score-value {
    width: 40px;
    text-align: right;
    font-weight: 600;
    color: #1E293B;
}

.hexagram-advice {
    background: #F9FAFB;
    border-radius: 8px;
    padding: 16px;
    margin-top: 16px;
}

.advice-title {
    font-size: 14px;
    font-weight: 600;
    color: #1E293B;
    margin-bottom: 8px;
}

.advice-list {
    margin: 0;
    padding-left: 20px;
    font-size: 13px;
    color: #4B5563;
    line-height: 1.6;
}
```

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«: `/public/css/export-mobile.css`

```css
/* ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¹ã‚¿ã‚¤ãƒ« */
.mobile-export-section {
    padding: 20px;
}

.mobile-share-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 24px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.share-card-visual {
    background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
    color: white;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 16px;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.card-title {
    font-size: 18px;
    font-weight: 600;
}

.card-score {
    font-size: 36px;
    font-weight: 700;
}

.card-os-summary {
    display: flex;
    justify-content: space-around;
    margin: 20px 0;
}

.os-item {
    text-align: center;
}

.os-emoji {
    display: block;
    font-size: 24px;
    margin-bottom: 4px;
}

.os-name {
    display: block;
    font-size: 12px;
    opacity: 0.9;
}

.os-score {
    display: block;
    font-size: 20px;
    font-weight: 600;
    margin: 4px 0;
}

.os-hexagram {
    display: block;
    font-size: 28px;
}

.card-footer {
    text-align: center;
    margin-top: 20px;
    padding-top: 16px;
    border-top: 1px solid rgba(255, 255, 255, 0.3);
}

.card-tagline {
    font-size: 12px;
    opacity: 0.9;
    margin-bottom: 4px;
}

.card-url {
    font-size: 14px;
    font-weight: 600;
}

.share-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.share-btn {
    padding: 12px 16px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.3s ease;
}

.share-btn.instagram {
    background: linear-gradient(45deg, #F58529, #DD2A7B, #8134AF, #515BD4);
    color: white;
}

.share-btn.twitter {
    background: #1DA1F2;
    color: white;
}

.share-btn.line {
    background: #00B900;
    color: white;
}

.share-btn.copy {
    background: #6B7280;
    color: white;
}

.share-btn.download {
    background: #3B82F6;
    color: white;
    grid-column: 1 / -1;
}

.line-text-preview {
    background: #F9FAFB;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
    font-family: monospace;
    font-size: 13px;
    line-height: 1.6;
    white-space: pre-wrap;
}

.qr-code-container {
    text-align: center;
    padding: 20px;
    background: white;
    border-radius: 8px;
    margin-bottom: 16px;
}

.copy-notification {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: #10B981;
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    transition: transform 0.3s ease;
    z-index: 10000;
}

.copy-notification.show {
    transform: translateX(-50%) translateY(0);
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
    .export-container {
        padding: 16px;
    }
    
    .share-buttons {
        grid-template-columns: 1fr;
    }
    
    .quick-export-section,
    .report-templates-section {
        display: none;
    }
}
```

## ğŸ§ª å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«: `/phase3-4-test.mjs`

```javascript
import { chromium } from 'playwright';

console.log('ğŸ§ª ãƒ•ã‚§ãƒ¼ã‚º3-4ä¿®æ­£ç¢ºèªãƒ†ã‚¹ãƒˆé–‹å§‹\n');

const browser = await chromium.launch({ 
    headless: false,
    devtools: true 
});

const context = await browser.newContext({
    viewport: { width: 390, height: 844 }, // iPhone 12ã‚µã‚¤ã‚º
    userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15'
});

const page = await context.newPage();

try {
    // ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹
    console.log('ğŸ“± Step 1: ãƒ¢ãƒã‚¤ãƒ«ãƒ“ãƒ¥ãƒ¼ã§ãƒšãƒ¼ã‚¸ã‚’é–‹ã');
    await page.goto('http://localhost:8012/public/results.html');
    await page.waitForTimeout(2000);

    // æ´å¯Ÿã‚¿ãƒ–ã®ãƒ†ã‚¹ãƒˆ
    console.log('\nğŸ’¡ Step 2: æ´å¯Ÿã‚¿ãƒ–ã®H384ãƒ‡ãƒ¼ã‚¿æ´»ç”¨ç¢ºèª');
    
    // æ´å¯Ÿã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
    await page.evaluate(() => {
        const buttons = Array.from(document.querySelectorAll('button'));
        const insightButton = buttons.find(b => b.textContent.includes('æ´å¯Ÿ'));
        if (insightButton) insightButton.click();
    });
    
    await page.waitForTimeout(1000);
    
    const insightCheck = await page.evaluate(() => {
        return {
            hexagramExtractor: typeof window.HexagramExtractor !== 'undefined',
            keywordTags: document.querySelectorAll('.keyword-tag').length,
            scoreItems: document.querySelectorAll('.score-item').length,
            adviceLists: document.querySelectorAll('.advice-list').length,
            hasInterpretation: document.querySelector('.hexagram-interpretation')?.textContent?.length > 0
        };
    });
    
    console.log('  HexagramExtractor: ' + (insightCheck.hexagramExtractor ? 'âœ…' : 'âŒ'));
    console.log('  ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚¿ã‚°æ•°: ' + insightCheck.keywordTags);
    console.log('  ã‚¹ã‚³ã‚¢é …ç›®æ•°: ' + insightCheck.scoreItems);
    console.log('  ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãƒªã‚¹ãƒˆæ•°: ' + insightCheck.adviceLists);
    console.log('  è§£é‡ˆãƒ†ã‚­ã‚¹ãƒˆ: ' + (insightCheck.hasInterpretation ? 'âœ…' : 'âŒ'));

    // ã‚·ãƒŠãƒªã‚ªã‚¿ãƒ–ã®ãƒ†ã‚¹ãƒˆ
    console.log('\nğŸ­ Step 3: ã‚·ãƒŠãƒªã‚ªã‚¿ãƒ–ã®H384ãƒ‡ãƒ¼ã‚¿æ´»ç”¨ç¢ºèª');
    
    await page.evaluate(() => {
        const buttons = Array.from(document.querySelectorAll('button'));
        const scenarioButton = buttons.find(b => b.textContent.includes('ã‚·ãƒŠãƒªã‚ª'));
        if (scenarioButton) scenarioButton.click();
    });
    
    await page.waitForTimeout(1000);
    
    const scenarioCheck = await page.evaluate(() => {
        const scenarioCards = document.querySelectorAll('.scenario-card');
        const themes = document.querySelectorAll('.theme-list li');
        
        return {
            scenarioCount: scenarioCards.length,
            hasPersonalizedScenarios: Array.from(scenarioCards).some(card => 
                card.textContent.includes('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰') || card.textContent.includes('æ˜“å¦')
            ),
            themeCount: themes.length,
            hasDialogue: document.querySelector('.dialogue-message')?.textContent?.length > 0
        };
    });
    
    console.log('  ã‚·ãƒŠãƒªã‚ªæ•°: ' + scenarioCheck.scenarioCount);
    console.log('  ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚º: ' + (scenarioCheck.hasPersonalizedScenarios ? 'âœ…' : 'âŒ'));
    console.log('  ãƒ†ãƒ¼ãƒæ•°: ' + scenarioCheck.themeCount);

    // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¿ãƒ–ã®ãƒ†ã‚¹ãƒˆï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰
    console.log('\nğŸ“± Step 4: ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ç¢ºèª');
    
    await page.evaluate(() => {
        const buttons = Array.from(document.querySelectorAll('button'));
        const exportButton = buttons.find(b => 
            b.textContent.includes('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ') || b.textContent.includes('å…±æœ‰')
        );
        if (exportButton) exportButton.click();
    });
    
    await page.waitForTimeout(1000);
    
    const exportCheck = await page.evaluate(() => {
        return {
            hasMobileSection: !!document.querySelector('.mobile-export-section'),
            hasShareCard: !!document.querySelector('.share-card-visual'),
            hasLineText: !!document.querySelector('.line-text-preview'),
            shareButtonCount: document.querySelectorAll('.share-btn').length,
            hasInstagramButton: !!document.querySelector('.share-btn.instagram'),
            hasLineButton: !!document.querySelector('.share-btn.line'),
            hasCopyButton: !!document.querySelector('.share-btn.copy')
        };
    });
    
    console.log('  ãƒ¢ãƒã‚¤ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³: ' + (exportCheck.hasMobileSection ? 'âœ…' : 'âŒ'));
    console.log('  å…±æœ‰ã‚«ãƒ¼ãƒ‰: ' + (exportCheck.hasShareCard ? 'âœ…' : 'âŒ'));
    console.log('  LINEç”¨ãƒ†ã‚­ã‚¹ãƒˆ: ' + (exportCheck.hasLineText ? 'âœ…' : 'âŒ'));
    console.log('  å…±æœ‰ãƒœã‚¿ãƒ³æ•°: ' + exportCheck.shareButtonCount);
    console.log('  Instagram: ' + (exportCheck.hasInstagramButton ? 'âœ…' : 'âŒ'));
    console.log('  LINE: ' + (exportCheck.hasLineButton ? 'âœ…' : 'âŒ'));
    console.log('  ã‚³ãƒ”ãƒ¼: ' + (exportCheck.hasCopyButton ? 'âœ…' : 'âŒ'));

    // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
    console.log('\nğŸ“‹ Step 5: ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ');
    
    const copySuccess = await page.evaluate(async () => {
        const copyButton = document.querySelector('.share-btn.copy');
        if (copyButton) {
            copyButton.click();
            await new Promise(resolve => setTimeout(resolve, 500));
            return !!document.querySelector('.copy-notification');
        }
        return false;
    });
    
    console.log('  ã‚³ãƒ”ãƒ¼é€šçŸ¥: ' + (copySuccess ? 'âœ…' : 'âŒ'));

    // ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
    await page.screenshot({ 
        path: 'phase3-4-mobile-test.png', 
        fullPage: true 
    });
    console.log('\nğŸ“¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ: phase3-4-mobile-test.png');

    // ç·åˆè©•ä¾¡
    console.log('\n========== è©•ä¾¡ ==========');
    const score = {
        insights: (insightCheck.keywordTags > 0 && insightCheck.hasInterpretation) ? 30 : 0,
        scenarios: (scenarioCheck.hasPersonalizedScenarios) ? 30 : 0,
        mobileExport: (exportCheck.hasMobileSection && exportCheck.hasShareCard) ? 30 : 0,
        functionality: (copySuccess) ? 10 : 0
    };
    
    const total = Object.values(score).reduce((a, b) => a + b, 0);
    
    console.log(`æ´å¯Ÿã‚¿ãƒ–æ”¹å–„: ${score.insights}/30ç‚¹`);
    console.log(`ã‚·ãƒŠãƒªã‚ªã‚¿ãƒ–æ”¹å–„: ${score.scenarios}/30ç‚¹`);
    console.log(`ãƒ¢ãƒã‚¤ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ: ${score.mobileExport}/30ç‚¹`);
    console.log(`æ©Ÿèƒ½å‹•ä½œ: ${score.functionality}/10ç‚¹`);
    console.log(`ç·åˆ: ${total}/100ç‚¹`);
    
    if (total >= 80) {
        console.log('\nğŸ‰ ä¿®æ­£ã¯æˆåŠŸã§ã™ï¼');
    } else if (total >= 60) {
        console.log('\nâš ï¸ éƒ¨åˆ†çš„ã«ä¿®æ­£ã•ã‚Œã¦ã„ã¾ã™');
    } else {
        console.log('\nâŒ ä¿®æ­£ãŒä¸å®Œå…¨ã§ã™');
    }

} finally {
    console.log('\nğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ã„ãŸã¾ã¾ã«ã—ã¾ã™');
    console.log('çµ‚äº†ã™ã‚‹ã«ã¯ Ctrl+C ã‚’æŠ¼ã—ã¦ãã ã•ã„');
    await new Promise(() => {});
}
```

## âœ… å®Ÿè£…ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### æ´å¯Ÿã‚¿ãƒ–
- [ ] HexagramExtractorãŒåˆæœŸåŒ–ã•ã‚Œã‚‹
- [ ] å„OSã‚«ãƒ¼ãƒ‰ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚¿ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] æ½œåœ¨åŠ›ãƒ»å®‰å®šæ€§ãƒ»æˆé•·æ€§ã®ã‚¹ã‚³ã‚¢ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¾ä»£è§£é‡ˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒ3ã¤è¡¨ç¤ºã•ã‚Œã‚‹

### ã‚·ãƒŠãƒªã‚ªã‚¿ãƒ–
- [ ] æ˜“å¦ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸã‚·ãƒŠãƒªã‚ªãŒç”Ÿæˆã•ã‚Œã‚‹
- [ ] ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ãŸå¯¾è©±ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ä¸»è¦ãªãƒ†ãƒ¼ãƒãŒãƒªã‚¹ãƒˆè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚·ãƒŠãƒªã‚ªé–‹å§‹ãƒœã‚¿ãƒ³ãŒæ©Ÿèƒ½ã™ã‚‹

### ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¿ãƒ–ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰
- [ ] ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºæ™‚ã«å°‚ç”¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] SNSå…±æœ‰ç”¨ã‚«ãƒ¼ãƒ‰ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] Instagram/Twitter/LINEå…±æœ‰ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹
- [ ] ã‚³ãƒ”ãƒ¼æˆåŠŸé€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œã‚‹

## ğŸš€ å®Ÿè£…æ‰‹é †

1. **CSSãƒ•ã‚¡ã‚¤ãƒ«ã®è¿½åŠ **
   - `insights-enhanced.css`ã‚’ä½œæˆ
   - `export-mobile.css`ã‚’ä½œæˆ
   - results.htmlã«èª­ã¿è¾¼ã¿è¿½åŠ 

2. **JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£**
   - InsightsTab.jsã«ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 
   - ScenariosTab.jsã«ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 
   - ExportTab.jsã«ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 

3. **å‹•ä½œç¢ºèª**
   ```bash
   # ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
   python3 -m http.server 8012
   
   # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
   node phase3-4-test.mjs
   ```

4. **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**
   - æ´å¯Ÿã‚¿ãƒ–ã§H384ãƒ‡ãƒ¼ã‚¿ãŒæ´»ç”¨ã•ã‚Œã¦ã„ã‚‹
   - ã‚·ãƒŠãƒªã‚ªã‚¿ãƒ–ã§ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚·ãƒŠãƒªã‚ªãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒæœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹

## ğŸ‰ æœŸå¾…ã•ã‚Œã‚‹æˆæœ

1. **ãƒ‡ãƒ¼ã‚¿ã®ä¾¡å€¤æœ€å¤§åŒ–**
   - H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®384å€‹ã®çˆ»ãƒ‡ãƒ¼ã‚¿ãŒæ´»ç”¨ã•ã‚Œã‚‹
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã®æ˜“å¦ã«åŸºã¥ã„ãŸæ·±ã„æ´å¯Ÿ

2. **ã‚¹ãƒãƒ›ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š**
   - SNSå…±æœ‰ãŒç°¡å˜ã«
   - LINE/ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã§ã®å…±æœ‰å¯¾å¿œ
   - ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã®UI

ã“ã‚Œã§ã€ã‚ˆã‚Šä¾¡å€¤ã®ã‚ã‚‹åˆ†æçµæœã¨ã‚¹ãƒãƒ›ã§ã®ä½¿ã„ã‚„ã™ã•ãŒå®Ÿç¾ã•ã‚Œã¾ã™ï¼