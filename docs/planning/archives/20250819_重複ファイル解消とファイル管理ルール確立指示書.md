# 20250819_重複ファイル解消とファイル管理ルール確立指示書

**作成日**: 2025年8月19日  
**担当**: Claude Code  
**実装担当**: TRAE  
**重要度**: 🚨 最高優先（システム安定性に直結）

---

## 📋 重複ファイル問題の概要

### ⚠️ **緊急対応が必要な重複ファイル**

プロジェクト全体調査の結果、以下の重大な重複・破損問題を確認：

1. **TripleOSInteractionAnalyzer.js** (117 bytes) - メインファイルが破損
2. **Chart.jsライブラリ** - 異なるバージョンが複数存在
3. **QuestionManager** - 2つの異なる実装が併存

---

## 🚨 緊急修正: Priority 1

### **修正1: TripleOSInteractionAnalyzer.js 破損修復**

#### **問題箇所**: `/public/js/core/TripleOSInteractionAnalyzer.js`

**現状**: わずか117バイトしかない破損状態  
**影響**: コア機能が動作しない可能性

**修復手順**:
1. 破損したメインファイルのバックアップ作成
2. 以下から最適な実装を選択して統合：
   - `TripleOSInteractionAnalyzer_improved.js` (10,459 bytes)
   - `TripleOSInteractionAnalyzer-v2-integration.js` (7,115 bytes)
3. メインファイルに統合実装を配置
4. 古いファイルを`/backup/`フォルダに移動

```bash
# 実行コマンド例
cp /public/js/core/TripleOSInteractionAnalyzer.js /backup/
# 最適な実装をメインファイルに統合
```

### **修正2: Chart.jsバージョン統一**

#### **問題**: 2つの異なるバージョンが存在

**統一作業**:
- `/public/js/lib/chart.min.js` (199,560 bytes) ← **削除**
- `/public/lib/chart.min.js` (205,222 bytes) ← **使用**

**HTML参照の更新**:
```html
<!-- 古い参照 -->
<script src="js/lib/chart.min.js"></script>

<!-- 新しい統一参照 -->
<script src="lib/chart.min.js"></script>
```

---

## 🔧 中優先修正: Priority 2

### **修正3: QuestionManager重複整理**

#### **2つのファイルが存在**:
- `/public/js/core/QuestionManager.js` (17,764 bytes) - Advanced機能
- `/public/js/ui/QuestionManager.js` (13,337 bytes) - 30問フロー特化

**統合方針**:
1. `core`版をメインとし、`ui`版の特化機能を移植
2. または役割を明確に分離（BaseQuestionManager + UIQuestionManager）

### **修正4: KeywordAnalyzer階層整理**

#### **3つのAnalyzerが存在**:
- `KeywordAnalyzer.js` - ベース実装
- `EnhancedKeywordAnalyzer.js` - 拡張版
- `DataDrivenKeywordAnalyzer.js` - 最新版

**整理方針**: 継承関係を明確化し、最新版をメインに統合

---

## 📝 ファイル管理ルールの確立

### **A. ディレクトリ構造ルール**

```
/public/js/
├── core/           # コアロジック（1機能=1ファイル）
├── components/     # 再利用可能UIコンポーネント
├── tabs/          # 独立タブファイル
├── lib/           # 外部ライブラリ（統一バージョン）
├── utils/         # ユーティリティ関数
├── data/          # データファイル
└── backup/        # 旧バージョンバックアップ
```

### **B. 命名規則**

#### **バージョン管理命名**:
```
- メインファイル: ComponentName.js
- 改良版: ComponentName-v2.js
- 拡張版: ComponentName-enhanced.js  
- 統合版: ComponentName-integration.js
- バックアップ: ComponentName.backup.YYYYMMDD.js
```

#### **役割別命名**:
```
- コア: CoreComponentName.js
- UI特化: UIComponentName.js
- データ特化: DataComponentName.js
```

### **C. 重複防止ルール**

1. **1機能1ファイル原則**: 同一クラス名は1つのファイルにのみ
2. **継承関係の明確化**: Base → Enhanced → Specialized
3. **依存関係文書化**: README.mdに依存グラフ記載
4. **HTML参照の統一**: 複数ファイル読み込み禁止

### **D. バックアップルール**

1. **削除前バックアップ必須**: `/backup/YYYYMMDD/`フォルダに保存
2. **変更履歴の記録**: CHANGELOG.md に変更内容記録
3. **復旧手順の文書化**: 各バックアップにREADME.txt添付

---

## ✅ 実装完了の確認基準

### **修復確認項目**:

#### **Priority 1 確認**:
- [ ] TripleOSInteractionAnalyzer.js が正常な容量（10KB以上）
- [ ] Chart.jsが単一バージョンで統一済み
- [ ] 関連HTMLファイルでの参照パス更新完了

#### **Priority 2 確認**:
- [ ] QuestionManagerの役割分離または統合完了
- [ ] KeywordAnalyzer継承関係の整理完了

#### **ルール確立確認**:
- [ ] `/backup/`フォルダ作成と旧ファイル移動完了
- [ ] ディレクトリ構造がルール準拠
- [ ] 重複ファイルの完全解消

### **動作確認テスト**:
```javascript
// 必須テスト項目
1. TripleOSInteractionAnalyzer の基本動作
2. Chart.js の正常読み込み
3. QuestionManager の機能動作
4. タブナビゲーションの正常動作
```

---

## 🎯 期待される効果

### **システム安定性の向上**:
- クラス定義競合の解消
- 予期しない動作の防止
- デバッグ効率の向上

### **開発効率の向上**:
- ファイル場所の迷いがなくなる
- 重複開発の防止
- メンテナンス工数の削減

### **品質向上**:
- 一貫したコード構造
- 依存関係の明確化
- テスト対象の明確化

---

## ⚠️ 作業時の注意事項

1. **バックアップ必須**: 削除・変更前に必ずバックアップ
2. **段階的実行**: Priority順に段階的に実行
3. **動作確認必須**: 各修正後に動作テスト実行
4. **影響調査**: 変更前に参照箇所を全て確認

---

**緊急度**: 🚨 最高優先  
**完了期限**: 即日実行  

**実装完了の報告**: 各Priority完了時に動作確認テストを実施し、Claude Code へ報告

---
**指示書作成**: Claude Code  
**実装責任**: TRAE