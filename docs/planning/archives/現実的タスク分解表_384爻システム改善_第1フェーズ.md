# 現実的タスク分解表 - 384爻システム改善 第1フェーズ

**作成日**: 2025年8月26日  
**期間**: 第1フェーズ 1週間（8月27日〜9月3日）  
**目標**: 達成度40%→60%（現実的な改善）  

---

## 🎯 現実的な目標設定（調整版）

### 第1フェーズ目標（1週間）
| 指標 | 現在値 | 当初目標 | **調整後目標** | 理由 |
|------|--------|----------|--------------|------|
| カバー率 | 5.7% | 30% | **10-15%** | 現実的な段階的改善 |
| 5爻選択率 | 0% | 15-20% | **5-10%** | 過度な偏り防止 |
| ユニーク爻数 | 22個 | 115個 | **40-60個** | 段階的拡大 |
| テストサンプル | 100件 | 500件 | **200件** | 検証可能な規模 |

### 制約事項の明確化
- ✅ **利用可能データ**: koudo_shishin.jsonの`shin`と`hen`のみ
- ❌ **利用不可データ**: `yao_ci`、`xiang_yi`（存在しない）
- ✅ **決定論性維持**: 同じ入力→同じ出力を厳守
- ⚠️ **リソース制約**: 開発者1-2名での実装

---

## 📅 Week 1: 5爻問題と基本的カバー率改善

### Day 1（8月27日）: 現状分析と準備 - 4時間

| # | タスク | 優先度 | 所要時間 | 完了 | 詳細 |
|---|--------|--------|----------|------|------|
| 1-1 | 現在のコードバックアップ作成 | 🔴 | 10分 | ☐ | git branch backup-20250827 |
| 1-2 | 開発ブランチ作成 | 🔴 | 5分 | ☐ | feature/384-improvement-phase1 |
| 1-3 | 現在の5爻関連コード詳細分析 | 🔴 | 30分 | ☐ | なぜ0%なのか根本原因特定 |
| 1-4 | koudo_shishin.jsonの5爻データ確認 | 🔴 | 20分 | ☐ | shin/henの内容精査 |
| 1-5 | 現在のキーワード効果測定 | 🔴 | 30分 | ☐ | どのキーワードが機能していないか |
| 1-6 | テストサンプル50個作成（5爻向け） | 🟠 | 45分 | ☐ | リーダーシップ関連テキスト |
| 1-7 | 現在の重み配分の可視化 | 🟠 | 30分 | ☐ | console.logで確認 |
| 1-8 | 200サンプル用データ準備開始 | 🟡 | 40分 | ☐ | カテゴリ別に整理 |
| 1-9 | 検証用スクリプト作成 | 🟠 | 30分 | ☐ | test-5yao-selection.js |
| 1-10 | Day 2の詳細計画作成 | 🟢 | 10分 | ☐ | 具体的な修正箇所リスト |

---

### Day 2（8月28日）: 5爻キーワードの段階的改善 - 5時間

| # | タスク | 優先度 | 所要時間 | 完了 | 詳細 |
|---|--------|--------|----------|------|------|
| 2-1 | 5爻キーワード第1次追加（10語） | 🔴 | 20分 | ☐ | 実用的な日本語を優先 |
| 2-2 | getEnhancedPositionAdjustment修正 | 🔴 | 30分 | ☐ | 5爻の条件を追加 |
| 2-3 | テスト実行（50サンプル） | 🔴 | 15分 | ☐ | 5爻選択率確認 |
| 2-4 | 効果測定と記録 | 🔴 | 15分 | ☐ | 何%改善したか |
| 2-5 | キーワード第2次追加（10語） | 🟠 | 20分 | ☐ | 第1次の結果を踏まえて |
| 2-6 | 重み微調整（0.6→0.7） | 🟠 | 15分 | ☐ | 段階的に増やす |
| 2-7 | 再テスト実行 | 🟠 | 15分 | ☐ | 改善確認 |
| 2-8 | 他の爻への影響確認 | 🔴 | 30分 | ☐ | 新たな偏りがないか |
| 2-9 | 決定論性の確認テスト | 🔴 | 20分 | ☐ | 同じ入力で同じ結果か |
| 2-10 | 調整結果の文書化 | 🟡 | 20分 | ☐ | 何を変更して何%改善したか |

#### 追加するキーワード案（段階的）
```javascript
// 第1次（実用的・一般的）
['決定', '判断', '方針', '主導', '統括', 
 '責任者', 'マネジメント', '上司', '代表', '指示']

// 第2次（効果を見て追加）
['戦略', '経営', '統制', 'トップ', '指揮',
 '権限', '裁量', '中心的', '主要', '重要']
```

---

### Day 3（8月29日）: 2爻・6爻の偏り調整 - 4時間

| # | タスク | 優先度 | 所要時間 | 完了 | 詳細 |
|---|--------|--------|----------|------|------|
| 3-1 | 2爻の現在のキーワード分析 | 🔴 | 20分 | ☐ | なぜ29%も選ばれるのか |
| 3-2 | 6爻の現在のキーワード分析 | 🔴 | 20分 | ☐ | なぜ28%も選ばれるのか |
| 3-3 | 2爻キーワードの一部削除/特殊化 | 🟠 | 30分 | ☐ | 汎用的すぎるものを削除 |
| 3-4 | 6爻キーワードの一部削除/特殊化 | 🟠 | 30分 | ☐ | 汎用的すぎるものを削除 |
| 3-5 | encodePositionVector重み調整 | 🔴 | 20分 | ☐ | 2爻:0.35→0.3、6爻:0.35→0.3 |
| 3-6 | 100サンプルテスト実行 | 🔴 | 20分 | ☐ | 分布の変化確認 |
| 3-7 | 5爻への影響確認 | 🔴 | 15分 | ☐ | 5爻選択率が維持されているか |
| 3-8 | 微調整実施 | 🟠 | 30分 | ☐ | テスト結果に基づく |
| 3-9 | 再テスト（100サンプル） | 🟠 | 20分 | ☐ | 目標分布に近づいたか |
| 3-10 | 3日間の成果まとめ | 🟡 | 25分 | ☐ | 改善率の文書化 |

---

### Day 4（8月30日）: セマンティックベクトル改善 - 5時間

| # | タスク | 優先度 | 所要時間 | 完了 | 詳細 |
|---|--------|--------|----------|------|------|
| 4-1 | 現在のベクトル生成ロジック分析 | 🔴 | 30分 | ☐ | なぜ22個しか選ばれないのか |
| 4-2 | 爻固有パターンの設計 | 🔴 | 40分 | ☐ | 各爻の差別化方法検討 |
| 4-3 | encodeUniquePattern実装 | 🔴 | 60分 | ☐ | 決定論的な固有パターン |
| 4-4 | generateSemanticVectors修正 | 🟠 | 30分 | ☐ | 固有パターン統合 |
| 4-5 | ベクトル多様性の測定 | 🟠 | 30分 | ☐ | 384個の分散確認 |
| 4-6 | 類似度計算の調整 | 🟠 | 40分 | ☐ | より差別化される計算 |
| 4-7 | 100サンプルテスト | 🔴 | 20分 | ☐ | カバー率の変化確認 |
| 4-8 | 未使用爻の分析 | 🟠 | 30分 | ☐ | なぜ選ばれないのか |
| 4-9 | 追加調整 | 🟡 | 30分 | ☐ | 分析結果に基づく |
| 4-10 | 結果記録 | 🟢 | 10分 | ☐ | カバー率の変化 |

#### 実装する固有パターン（シンプル版）
```javascript
encodeUniquePattern(vector, offset, lineId) {
    // 決定論的で各爻に固有のパターン
    const seed = lineId * 137; // 素数を使用
    for (let i = 0; i < 100; i++) {
        // シンプルだが固有のパターン
        vector[offset + i] = Math.sin(seed + i * 0.1) * 0.3 +
                            Math.cos(seed * 0.5 + i * 0.05) * 0.2;
    }
}
```

---

### Day 5（8月31日）: キーワード拡張と語彙強化 - 5時間

| # | タスク | 優先度 | 所要時間 | 完了 | 詳細 |
|---|--------|--------|----------|------|------|
| 5-1 | koudo_shishin.jsonのshin/hen活用方法検討 | 🔴 | 40分 | ☐ | 現在のデータで可能な拡張 |
| 5-2 | shin/henからのキーワード自動抽出 | 🔴 | 60分 | ☐ | 形態素解析的アプローチ |
| 5-3 | 1爻のキーワード拡張（+5語） | 🟠 | 20分 | ☐ | 選択率向上のため |
| 5-4 | 3爻のキーワード見直し | 🟠 | 20分 | ☐ | 22%を20%以下に |
| 5-5 | 4爻のキーワード拡張（+5語） | 🟠 | 20分 | ☐ | 選択率向上のため |
| 5-6 | キーワードマッチング改善 | 🔴 | 45分 | ☐ | 部分一致の実装 |
| 5-7 | 200サンプルテスト準備完了 | 🔴 | 30分 | ☐ | 全カテゴリ用意 |
| 5-8 | 200サンプルテスト実行 | 🔴 | 30分 | ☐ | 統計的に有意な規模 |
| 5-9 | カバー率測定と分析 | 🔴 | 20分 | ☐ | 目標10-15%に対して |
| 5-10 | 未達の場合の追加調整 | 🟡 | 25分 | ☐ | 緊急対応 |

---

### Day 6（9月1日）: 統合テストと最適化 - 4時間

| # | タスク | 優先度 | 所要時間 | 完了 | 詳細 |
|---|--------|--------|----------|------|------|
| 6-1 | 全修正内容の確認 | 🔴 | 20分 | ☐ | チェックリスト作成 |
| 6-2 | パフォーマンステスト | 🔴 | 30分 | ☐ | 処理速度の確認 |
| 6-3 | メモリ使用量確認 | 🟠 | 20分 | ☐ | リーク確認 |
| 6-4 | 決定論性の最終確認 | 🔴 | 30分 | ☐ | 100ケースで検証 |
| 6-5 | 統計的検証（簡易版） | 🔴 | 40分 | ☐ | 分布の偏り確認 |
| 6-6 | エッジケーステスト | 🟠 | 30分 | ☐ | 空文字、長文など |
| 6-7 | 回帰テスト | 🔴 | 30分 | ☐ | 既存機能が壊れていないか |
| 6-8 | ドキュメント更新 | 🟡 | 20分 | ☐ | 変更内容の記録 |
| 6-9 | コードレビュー準備 | 🟡 | 15分 | ☐ | PR作成 |
| 6-10 | バックアップ作成 | 🟠 | 5分 | ☐ | 成果物の保存 |

---

### Day 7（9月2日）: 評価とNext Step計画 - 3時間

| # | タスク | 優先度 | 所要時間 | 完了 | 詳細 |
|---|--------|--------|----------|------|------|
| 7-1 | 最終テスト実行（200サンプル） | 🔴 | 30分 | ☐ | 全指標測定 |
| 7-2 | 達成度評価レポート作成 | 🔴 | 45分 | ☐ | 定量的成果まとめ |
| 7-3 | 残存課題の整理 | 🔴 | 20分 | ☐ | 未達成項目リスト |
| 7-4 | 第2フェーズ計画案作成 | 🟠 | 40分 | ☐ | 次の1週間の計画 |
| 7-5 | ステークホルダー報告資料 | 🟠 | 30分 | ☐ | 成果と今後 |
| 7-6 | コード品質確認 | 🟡 | 15分 | ☐ | Linter実行 |
| 7-7 | テストコード整理 | 🟡 | 10分 | ☐ | 不要なものを削除 |
| 7-8 | リリースノート作成 | 🟢 | 10分 | ☐ | 変更内容サマリー |
| 7-9 | 振り返り会準備 | 🟢 | 10分 | ☐ | アジェンダ作成 |
| 7-10 | 最終コミット | 🔴 | 10分 | ☐ | feature branch完了 |

---

## 📊 成功基準（現実的版）

### 必達目標（MUST）
- ✅ 5爻選択率 > 0%（最低1%以上）
- ✅ カバー率 ≥ 10%（40個以上の爻使用）
- ✅ 決定論性の維持（100%）
- ✅ 処理速度の維持（劣化なし）

### 努力目標（SHOULD）
- ⭐ 5爻選択率 5-10%
- ⭐ カバー率 12-15%
- ⭐ 全位置15-20%の範囲内
- ⭐ 200サンプルテスト完了

### ストレッチ目標（NICE TO HAVE）
- 🌟 カバー率 15%超
- 🌟 ユニーク爻数 60個以上
- 🌟 統計的有意性の確認

---

## ⚠️ リスクと対策

### 技術的リスク
| リスク | 可能性 | 影響度 | 対策 |
|--------|--------|--------|------|
| 5爻過度調整による新偏り | 中 | 高 | 段階的調整、都度測定 |
| 決定論性の破壊 | 低 | 高 | ノイズ追加を避ける |
| パフォーマンス劣化 | 低 | 中 | 複雑な処理を避ける |
| 2爻/6爻調整の副作用 | 中 | 中 | 小幅調整に留める |

### プロジェクトリスク
| リスク | 可能性 | 影響度 | 対策 |
|--------|--------|--------|------|
| 目標未達 | 中 | 中 | 早期に目標見直し |
| スケジュール遅延 | 低 | 低 | バッファ日を設定 |
| データ不足 | 確定 | 高 | shin/henのみで工夫 |

---

## 🔄 日次進捗管理

### チェックポイント
```bash
# 毎日17:00に実行
node test-384-quality.mjs > daily-$(date +%Y%m%d).log

# 主要指標の確認
- カバー率: X%（前日比+Y%）
- 5爻選択率: X%（前日比+Y%）
- 処理時間: Xms（変化なし）
- エラー: なし
```

### エスカレーション基準
- Day 3終了時: 5爻選択率0%なら緊急対応
- Day 5終了時: カバー率8%未満なら目標修正
- Day 6終了時: 重大バグ発生なら延期検討

---

## 👥 体制（最小限）

### 必要リソース
- 開発者: 1名（専任）
- レビュアー: 1名（兼任可）
- 時間: 27時間（実作業）

### コミュニケーション
- 朝会: なし（1人作業の場合）
- 日次報告: Slack 17:00
- 週次: 金曜16:00（成果報告）

---

## ✅ 開始前チェックリスト

- [ ] 現在のコードのバックアップ完了
- [ ] テスト環境の動作確認
- [ ] 200サンプルのデータ準備計画
- [ ] 作業時間の確保（1日3-5時間）
- [ ] 決定論性維持の方針確認
- [ ] 目標値の合意（10-15%）

---

## 📝 第2フェーズ以降の展望

### Phase 2（第2週）検討事項
- 監視システムの簡易版実装
- カバー率15-20%への挑戦
- 偏り自動検知機能

### Phase 3（将来）検討事項
- 機械学習プロトタイプ評価
- 爻辞データの追加検討
- ユーザーフィードバック収集

---

**備考**: 
- データ制約（shin/henのみ）を前提とした現実的計画
- 決定論性を厳守（ノイズ追加は行わない）
- 段階的改善を重視（一気に変えない）
- 測定と調整を繰り返す