<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>状況卦精度向上システム - 動作テスト</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1f2937;
            color: #f3f4f6;
        }
        .test-container {
            background: #374151;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .test-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #4b5563;
            border-radius: 8px;
            background: #1f2937;
            color: #f3f4f6;
            font-size: 16px;
            margin: 10px 0;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .result-section {
            background: #1f2937;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #3b82f6;
        }
        .enhanced-info {
            background: #065f46;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .hsp-detected {
            background: #7c2d12;
            color: #fed7aa;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .multidimensional {
            background: #581c87;
            color: #e9d5ff;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .confidence-high { color: #10b981; }
        .confidence-medium { color: #f59e0b; }
        .confidence-low { color: #ef4444; }
        .loading {
            display: none;
            color: #3b82f6;
        }
    </style>
</head>
<body>
    <h1>🌐 状況卦精度向上システム - 動作テスト</h1>
    <p>多次元コンテキスト分析エンジンの動作を検証します</p>

    <div class="test-container">
        <h2>テストケース1: HSP特性検出テスト</h2>
        <textarea class="test-input" id="hspTestInput" placeholder="HSP関連のテキストを入力してください..." rows="4">世の中にイライラしていることが多くて、他人の感情や周りの空気に敏感に感じて対応しちゃうんです。気持ちの浮き沈みが影響を受けやすくて、もっとニュートラルを保てるようになりたいと思っています。繊細すぎる自分の性格をなんとかしたいです。</textarea>
        <button class="test-button" onclick="testHSPDetection()">HSP特性分析テスト</button>
        <div id="hspTestResult" class="result-section" style="display:none;"></div>
    </div>

    <div class="test-container">
        <h2>テストケース2: 複合問題検出テスト</h2>
        <textarea class="test-input" id="hybridTestInput" placeholder="複数の領域にまたがる問題を入力してください..." rows="4">仕事でのストレスが原因で家族関係がうまくいかなくなって、将来のキャリアについても迷っています。最近は人生の意味について考えることが多くて、自分の価値観と社会の期待との間で揺れ動いています。技術的なスキルアップも必要だと思うのですが、時間的な余裕がありません。</textarea>
        <button class="test-button" onclick="testMultidimensionalDetection()">複合問題分析テスト</button>
        <div id="hybridTestResult" class="result-section" style="display:none;"></div>
    </div>

    <div class="test-container">
        <h2>テストケース3: 意図理解テスト</h2>
        <textarea class="test-input" id="intentionTestInput" placeholder="明確な意図を含むテキストを入力してください..." rows="4">どうすれば自分の気持ちをうまくコントロールできるようになるでしょうか。アドバイスをください。これまでの経験を振り返ってみると、感情的になりやすい場面がいくつかあることが分かりました。今後はもっと冷静に対応したいと考えています。</textarea>
        <button class="test-button" onclick="testIntentionAnalysis()">意図理解分析テスト</button>
        <div id="intentionTestResult" class="result-section" style="display:none;"></div>
    </div>

    <div class="test-container">
        <h2>テストケース4: 従来システムとの比較</h2>
        <textarea class="test-input" id="comparisonTestInput" placeholder="比較テスト用のテキストを入力してください..." rows="4">最近、職場の人間関係で悩んでいます。上司との相性が悪くて、毎日仕事に行くのが憂鬱です。転職も考えていますが、今の経済状況を考えると不安もあります。</textarea>
        <button class="test-button" onclick="testComparison()">従来vs拡張システム比較</button>
        <div id="comparisonTestResult" class="result-section" style="display:none;"></div>
    </div>

    <div class="loading" id="loadingIndicator">
        <p>🔄 分析中...</p>
    </div>

    <!-- 必要なスクリプトを読み込み -->
    <script src="./public/js/pages/future-simulator/MultiDimensionalContextAnalyzer.js"></script>
    
    <script>
        // グローバル変数
        let enhancedAnalyzer = null;

        // ENHANCED_CONTEXT_TYPES の定義（Future Simulatorから抜粋）
        window.ENHANCED_CONTEXT_TYPES = {
            emotion_management: {
                id: 'emotion_management',
                name: '感情調整・HSP',
                priority: 1,
                keywords: {
                    primary: ['感情', '敏感', '繊細', 'HSP', '気持ち', '感受性', 'ニュートラル'],
                    hsp_specific: ['世の中イライラ', '敏感に感じ', '対応しちゃう', '浮き沈みが影響', '繊細すぎる']
                },
                weight: 1.3,
                confidence_boost: 0.2
            },
            personal: {
                id: 'personal',
                name: '個人的問題',
                priority: 2,
                keywords: {
                    primary: ['私', '自分', '個人的', '自己'],
                    secondary: ['不安', '悩み', '感じる', '思う', '心配']
                },
                weight: 1.0,
                confidence_boost: 0.1
            },
            relationship: {
                id: 'relationship',
                name: '人間関係',
                priority: 1,
                keywords: {
                    primary: ['家族', '恋人', '友人', '夫婦', '人間関係'],
                    secondary: ['上司', '部下', '同僚', '職場']
                },
                weight: 1.1,
                confidence_boost: 0.12
            },
            business: {
                id: 'business',
                name: 'ビジネス',
                priority: 1,
                keywords: {
                    primary: ['仕事', '会社', '職場', '業務', 'キャリア'],
                    secondary: ['転職', '昇進', '給料', 'スキル']
                },
                weight: 1.1,
                confidence_boost: 0.12
            },
            philosophical: {
                id: 'philosophical',
                name: '哲学的問題',
                priority: 3,
                keywords: {
                    primary: ['人生', '生きる', '存在', '意味', '価値観'],
                    secondary: ['幸せ', '成功', '目的', '将来']
                },
                weight: 1.3,
                confidence_boost: 0.2
            }
        };

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            try {
                enhancedAnalyzer = new MultiDimensionalContextAnalyzer(null);
                console.log('✅ MultiDimensionalContextAnalyzer 初期化完了');
            } catch (error) {
                console.error('❌ MultiDimensionalContextAnalyzer 初期化失敗:', error);
                document.body.innerHTML += '<div style="color: red; background: yellow; padding: 10px; margin: 20px;">⚠️ MultiDimensionalContextAnalyzer の読み込みに失敗しました。</div>';
            }
        });

        // HSP特性検出テスト
        async function testHSPDetection() {
            const input = document.getElementById('hspTestInput').value;
            const resultDiv = document.getElementById('hspTestResult');
            
            showLoading(true);
            
            try {
                const result = await enhancedAnalyzer.analyzeMultiDimensionalContext(input);
                
                let resultHTML = `
                    <h3>🧠 HSP特性分析結果</h3>
                    <div><strong>主要コンテキスト:</strong> ${result.primaryContext}</div>
                    <div><strong>信頼度:</strong> <span class="${getConfidenceClass(result.confidence)}">${Math.round(result.confidence * 100)}%</span></div>
                `;
                
                if (result.isHSPCase) {
                    resultHTML += `<div class="hsp-detected">💖 HSP特性が検出されました</div>`;
                    resultHTML += `<div>HSPレベル: ${Math.round((result.emotionalProfile?.emotionalProfile?.hspLevel || 0) * 100)}%</div>`;
                    resultHTML += `<div>調整ニーズ: ${Math.round((result.emotionalProfile?.emotionalProfile?.adjustmentNeed || 0) * 100)}%</div>`;
                }
                
                if (result.isMultidimensional) {
                    resultHTML += `<div class="multidimensional">🔄 複数領域の複合問題として認識</div>`;
                }
                
                resultHTML += `
                    <div class="enhanced-info">
                        <h4>詳細分析:</h4>
                        <div>意図明確度: ${Math.round((result?.intentionAnalysis?.intentionClarity || 0) * 100)}%</div>
                        <div>感情複雑度: ${result?.emotionalProfile?.emotionalComplexity || 0}</div>
                        <div>処理時間: ${Math.round(result?.qualityMetrics?.processingTime || 0)}ms</div>
                    </div>
                `;
                
                resultDiv.innerHTML = resultHTML;
                resultDiv.style.display = 'block';
                
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">エラー: ${error.message}</div>`;
                resultDiv.style.display = 'block';
            }
            
            showLoading(false);
        }

        // 複合問題検出テスト
        async function testMultidimensionalDetection() {
            const input = document.getElementById('hybridTestInput').value;
            const resultDiv = document.getElementById('hybridTestResult');
            
            showLoading(true);
            
            try {
                const result = await enhancedAnalyzer.analyzeMultiDimensionalContext(input);
                
                let resultHTML = `
                    <h3>🔄 複合問題分析結果</h3>
                    <div><strong>主要コンテキスト:</strong> ${result.primaryContext}</div>
                    <div><strong>信頼度:</strong> <span class="${getConfidenceClass(result.confidence)}">${Math.round(result.confidence * 100)}%</span></div>
                `;
                
                if (result.isMultidimensional) {
                    resultHTML += `<div class="multidimensional">🔄 複数領域にまたがる複合問題を検出</div>`;
                    if (result.secondaryContexts && result.secondaryContexts.length > 0) {
                        resultHTML += `<div><strong>副次コンテキスト:</strong></div>`;
                        result.secondaryContexts.forEach(ctx => {
                            resultHTML += `<div style="margin-left: 20px;">• ${ctx.type} (重み: ${Math.round(ctx.weight * 100)}%)</div>`;
                        });
                    }
                }
                
                if (result.contextWeights) {
                    resultHTML += `<div class="enhanced-info">
                        <h4>コンテキスト重み分布:</h4>
                        ${Object.entries(result.contextWeights).map(([context, weight]) => 
                            `<div>${context}: ${Math.round(weight * 100)}%</div>`
                        ).join('')}
                    </div>`;
                }
                
                resultDiv.innerHTML = resultHTML;
                resultDiv.style.display = 'block';
                
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">エラー: ${error.message}</div>`;
                resultDiv.style.display = 'block';
            }
            
            showLoading(false);
        }

        // 意図理解テスト
        async function testIntentionAnalysis() {
            const input = document.getElementById('intentionTestInput').value;
            const resultDiv = document.getElementById('intentionTestResult');
            
            showLoading(true);
            
            try {
                const result = await enhancedAnalyzer.analyzeMultiDimensionalContext(input);
                
                let resultHTML = `
                    <h3>🎯 意図理解分析結果</h3>
                    <div><strong>主要コンテキスト:</strong> ${result.primaryContext}</div>
                    <div><strong>信頼度:</strong> <span class="${getConfidenceClass(result.confidence)}">${Math.round(result.confidence * 100)}%</span></div>
                `;
                
                if (result.intentionAnalysis) {
                    const intention = result.intentionAnalysis;
                    resultHTML += `<div class="enhanced-info">
                        <h4>意図分析:</h4>
                        <div>意図明確度: ${Math.round(intention.intentionClarity * 100)}%</div>`;
                    
                    if (intention.primaryIntention) {
                        resultHTML += `<div>主要意図: ${intention.primaryIntention.type}</div>`;
                        resultHTML += `<div>意図信頼度: ${Math.round(intention.primaryIntention.confidence * 100)}%</div>`;
                    }
                    
                    if (intention.multipleIntentions) {
                        resultHTML += `<div>🔄 複数の意図が検出されました</div>`;
                    }
                    
                    resultHTML += `</div>`;
                }
                
                resultDiv.innerHTML = resultHTML;
                resultDiv.style.display = 'block';
                
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">エラー: ${error.message}</div>`;
                resultDiv.style.display = 'block';
            }
            
            showLoading(false);
        }

        // 従来システムとの比較テスト（簡易版）
        async function testComparison() {
            const input = document.getElementById('comparisonTestInput').value;
            const resultDiv = document.getElementById('comparisonTestResult');
            
            showLoading(true);
            
            try {
                // 従来方式の簡易シミュレーション
                const basicResult = simulateBasicAnalysis(input);
                
                // 拡張方式
                const enhancedResult = await enhancedAnalyzer.analyzeMultiDimensionalContext(input);
                
                let resultHTML = `
                    <h3>🔍 従来システム vs 拡張システム比較</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="background: #374151; padding: 15px; border-radius: 8px;">
                            <h4>従来システム</h4>
                            <div>コンテキスト: ${basicResult.primary}</div>
                            <div>信頼度: ${Math.round(basicResult.confidence * 100)}%</div>
                            <div>特別機能: なし</div>
                        </div>
                        <div style="background: #065f46; padding: 15px; border-radius: 8px;">
                            <h4>拡張システム（NEW!）</h4>
                            <div>コンテキスト: ${enhancedResult.primaryContext}</div>
                            <div>信頼度: <span class="${getConfidenceClass(enhancedResult.confidence)}">${Math.round(enhancedResult.confidence * 100)}%</span></div>
                            <div>HSP検出: ${enhancedResult.isHSPCase ? '✅' : '❌'}</div>
                            <div>複合問題: ${enhancedResult.isMultidimensional ? '✅' : '❌'}</div>
                            <div>意図理解: ${Math.round((enhancedResult?.intentionAnalysis?.intentionClarity || 0) * 100)}%</div>
                        </div>
                    </div>
                `;
                
                resultDiv.innerHTML = resultHTML;
                resultDiv.style.display = 'block';
                
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">エラー: ${error.message}</div>`;
                resultDiv.style.display = 'block';
            }
            
            showLoading(false);
        }

        // ヘルパー関数
        function simulateBasicAnalysis(text) {
            // 従来システムの簡易シミュレーション
            if (text.includes('職場') || text.includes('仕事')) return { primary: 'business', confidence: 0.7 };
            if (text.includes('人間関係') || text.includes('家族')) return { primary: 'relationship', confidence: 0.6 };
            if (text.includes('悩み') || text.includes('心配')) return { primary: 'personal', confidence: 0.5 };
            return { primary: 'personal', confidence: 0.4 };
        }

        function getConfidenceClass(confidence) {
            if (confidence >= 0.8) return 'confidence-high';
            if (confidence >= 0.6) return 'confidence-medium';
            return 'confidence-low';
        }

        function showLoading(show) {
            document.getElementById('loadingIndicator').style.display = show ? 'block' : 'none';
        }
    </script>
</body>
</html>