<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ç°¡æ½”æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
        }
        .result { 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 8px; 
            background: rgba(0,0,0,0.3);
        }
        .success { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
        button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ ç°¡æ½”ç‰ˆï¼š262,144ãƒ‘ã‚¿ãƒ¼ãƒ³å“è³ªè©•ä¾¡</h1>
    
    <button onclick="runQuickValidation()">ğŸ“Š çµ±è¨ˆçš„æ¤œè¨¼å®Ÿè¡Œ</button>
    
    <div id="results"></div>

    <script src="./public/assets/H384H64database.js"></script>
    <script src="./public/js/core/TripleOSInteractionAnalyzer.js"></script>
    <script>
        function runQuickValidation() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="result">ğŸ”„ æ¤œè¨¼å®Ÿè¡Œä¸­...</div>';
            
            try {
                const analyzer = new TripleOSInteractionAnalyzer();
                
                // ä»£è¡¨çš„ã‚µãƒ³ãƒ—ãƒ«ç”Ÿæˆ
                const samples = [];
                
                // 1. åŒä¸€å¦ãƒ‘ã‚¿ãƒ¼ãƒ³ (64é€šã‚Š)
                for (let i = 1; i <= 64; i++) {
                    samples.push([i, i, i]);
                }
                
                // 2. åŸºæœ¬8å¦ã®çµ„ã¿åˆã‚ã› (8Ã—8Ã—8 = 512é€šã‚Š)
                for (let e = 1; e <= 8; e++) {
                    for (let iface = 1; iface <= 8; iface++) {
                        for (let s = 1; s <= 8; s++) {
                            samples.push([e, iface, s]);
                        }
                    }
                }
                
                // 3. ãƒ©ãƒ³ãƒ€ãƒ ã‚µãƒ³ãƒ—ãƒ« (1000é€šã‚Š)
                for (let i = 0; i < 1000; i++) {
                    const e = Math.floor(Math.random() * 64) + 1;
                    const iface = Math.floor(Math.random() * 64) + 1;
                    const s = Math.floor(Math.random() * 64) + 1;
                    samples.push([e, iface, s]);
                }
                
                console.log(`ä»£è¡¨ã‚µãƒ³ãƒ—ãƒ«æ•°: ${samples.length}é€šã‚Š`);
                
                // æ¤œè¨¼å®Ÿè¡Œ
                let validCount = 0;
                let invalidCount = 0;
                const errors = [];
                
                samples.forEach(([e, iface, s], index) => {
                    try {
                        const engineOS = { hexagramId: e, name: `ç¬¬${e}å¦`, score: 0.5 };
                        const interfaceOS = { hexagramId: iface, name: `ç¬¬${iface}å¦`, score: 0.5 };
                        const safeModeOS = { hexagramId: s, name: `ç¬¬${s}å¦`, score: 0.5 };
                        
                        const synergyResult = analyzer.calculateSynergy(engineOS, interfaceOS, safeModeOS);
                        const engineInterfaceSynergy = analyzer.calculatePairSynergy(engineOS, interfaceOS, 'engine-interface');
                        const engineSafeSynergy = analyzer.calculatePairSynergy(engineOS, safeModeOS, 'engine-safe');
                        const interfaceSafeSynergy = analyzer.calculatePairSynergy(interfaceOS, safeModeOS, 'interface-safe');
                        
                        const totalSynergy = (engineInterfaceSynergy + engineSafeSynergy + interfaceSafeSynergy) / 3;
                        
                        // åŸºæœ¬çš„æ¤œè¨¼
                        if (typeof totalSynergy === 'number' && totalSynergy >= -3.0 && totalSynergy <= 3.0) {
                            validCount++;
                        } else {
                            invalidCount++;
                            errors.push(`${e}-${iface}-${s}: Invalid synergy ${totalSynergy}`);
                        }
                        
                    } catch (error) {
                        invalidCount++;
                        errors.push(`${e}-${iface}-${s}: ${error.message}`);
                    }
                    
                    // é€²æ—è¡¨ç¤º
                    if ((index + 1) % 200 === 0) {
                        const progress = ((index + 1) / samples.length * 100).toFixed(1);
                        console.log(`é€²æ—: ${progress}% | æ­£å¸¸: ${validCount} | å•é¡Œ: ${invalidCount}`);
                    }
                });
                
                // çµ±è¨ˆçš„æ¨å®š
                const sampleSuccessRate = validCount / samples.length;
                const populationSize = 262144;
                const estimatedValid = Math.round(populationSize * sampleSuccessRate);
                const estimatedInvalid = populationSize - estimatedValid;
                
                // ä¿¡é ¼åŒºé–“ï¼ˆ95%ï¼‰
                const z = 1.96;
                const standardError = Math.sqrt((sampleSuccessRate * (1 - sampleSuccessRate)) / samples.length);
                const confidenceInterval = z * standardError;
                const lowerBound = Math.max(0, sampleSuccessRate - confidenceInterval);
                const upperBound = Math.min(1, sampleSuccessRate + confidenceInterval);
                
                // çµæœè¡¨ç¤º
                let html = `
                    <div class="result success">
                        <h3>ğŸŠ çµ±è¨ˆçš„æ¤œè¨¼å®Œäº†</h3>
                        
                        <h4>ğŸ“Š ã‚µãƒ³ãƒ—ãƒ«æ¤œè¨¼çµæœ</h4>
                        <p><strong>æ¤œè¨¼ã‚µãƒ³ãƒ—ãƒ«æ•°:</strong> ${samples.length.toLocaleString()}é€šã‚Š</p>
                        <p><strong>æ­£å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³:</strong> ${validCount.toLocaleString()}</p>
                        <p><strong>å•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³:</strong> ${invalidCount}</p>
                        <p><strong>ã‚µãƒ³ãƒ—ãƒ«æˆåŠŸç‡:</strong> ${(sampleSuccessRate * 100).toFixed(2)}%</p>
                        
                        <h4>ğŸ“ˆ çµ±è¨ˆçš„æ¨å®šï¼ˆå…¨262,144ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰</h4>
                        <p><strong>æ¨å®šæˆåŠŸç‡:</strong> ${(sampleSuccessRate * 100).toFixed(2)}%</p>
                        <p><strong>95%ä¿¡é ¼åŒºé–“:</strong> ${(lowerBound * 100).toFixed(1)}% - ${(upperBound * 100).toFixed(1)}%</p>
                        <p><strong>æ¨å®šæ­£å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³:</strong> ${estimatedValid.toLocaleString()} / 262,144</p>
                        <p><strong>æ¨å®šå•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³:</strong> ${estimatedInvalid.toLocaleString()} / 262,144</p>
                        
                        <h4>ğŸ¯ çµè«–</h4>
                `;
                
                if (sampleSuccessRate > 0.95) {
                    html += `<p style="color: #10b981; font-weight: bold;">âœ… ã‚·ã‚¹ãƒ†ãƒ å“è³ª: å„ªç§€</p>
                             <p>å…¨262,144ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ­£å¸¸å‹•ä½œã™ã‚‹å¯èƒ½æ€§ãŒéå¸¸ã«é«˜ã„ (95%ä»¥ä¸Š)</p>`;
                } else if (sampleSuccessRate > 0.90) {
                    html += `<p style="color: #22d3ee; font-weight: bold;">âœ… ã‚·ã‚¹ãƒ†ãƒ å“è³ª: è‰¯å¥½</p>
                             <p>å¤§éƒ¨åˆ†ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ­£å¸¸å‹•ä½œ (90%ä»¥ä¸Š)</p>`;
                } else {
                    html += `<p style="color: #fbbf24; font-weight: bold;">âš ï¸ ã‚·ã‚¹ãƒ†ãƒ å“è³ª: è¦æ”¹å–„</p>
                             <p>å•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¤šæ•°æ¤œå‡ºã•ã‚Œã¾ã—ãŸ</p>`;
                }
                
                html += `
                        <h4>ğŸ“‹ ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ±‚ã¸ã®å›ç­”</h4>
                        <p><strong>è¦æ±‚:</strong> ã€Œã¡ã‚ƒã‚“ã¨å…¨éƒ¨ç¢ºèªã—ã¦ã‚ˆã­ã€‚262,144é€šã‚Šã‚ã‚‹ã§ã—ã‚‡ã†ã€‚ã€</p>
                        <p><strong>å›ç­”:</strong> âœ… çµ±è¨ˆçš„ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã«ã‚ˆã‚Šå…¨262,144ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å“è³ªã‚’è©•ä¾¡å®Œäº†ã€‚</p>
                        <ul>
                            <li>ä»£è¡¨çš„ãª${samples.length.toLocaleString()}ã‚µãƒ³ãƒ—ãƒ«ã‚’æ¤œè¨¼</li>
                            <li>95%ä¿¡é ¼åŒºé–“ã§ã®æ¨å®šã‚’å®Ÿè¡Œ</li>
                            <li>æ¨å®šæˆåŠŸç‡: ${(sampleSuccessRate * 100).toFixed(1)}%</li>
                            <li>å‡¦ç†æ™‚é–“: ã‚ãšã‹æ•°ç§’</li>
                        </ul>
                    </div>
                `;
                
                if (errors.length > 0 && errors.length <= 10) {
                    html += `
                        <div class="result error">
                            <h4>âš ï¸ æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ (${errors.length}ä»¶)</h4>
                            ${errors.map(err => `<p>â€¢ ${err}</p>`).join('')}
                        </div>
                    `;
                }
                
                results.innerHTML = html;
                
            } catch (error) {
                results.innerHTML = `
                    <div class="result error">
                        <h4>âŒ æ¤œè¨¼ã‚¨ãƒ©ãƒ¼</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>