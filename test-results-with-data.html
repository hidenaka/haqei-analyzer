<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results.html データ投入テスト</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #f8fafc;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .section {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 0.5rem;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        .status {
            padding: 1rem;
            margin: 1rem 0;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
        }
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.875rem;
        }
        .error {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }
    </style>
</head>
<body>
    <h1>Results.html データ投入テスト</h1>
    
    <div class="section">
        <h2>🎯 テスト概要</h2>
        <p>results.htmlに正しい分析結果データを投入して、画面が正常に表示されることを確認します。</p>
        
        <button onclick="injectCompleteData()">完全な分析結果を投入</button>
        <button onclick="openResultsPage()">Results.htmlを開く</button>
        <button onclick="checkCurrentData()">現在のデータを確認</button>
        <button onclick="clearAllData()">全データをクリア</button>
        
        <div id="status" class="status" style="display: none;"></div>
    </div>
    
    <div class="section">
        <h2>📊 投入する分析結果データ</h2>
        <pre id="data-preview"></pre>
    </div>

    <script>
        // 完全な分析結果データ
        const completeAnalysisData = {
            engineOS: {
                hexagramId: "11",
                hexagramName: "地天泰",
                hexagramSymbol: "☷☰",
                primaryElement: "earth",
                traits: ["安定性", "調和", "豊かさ"],
                scores: {
                    authenticity: 85,
                    consistency: 78,
                    influence: 82
                },
                description: "あなたの価値観システムは「地天泰」のように、天地が調和し、すべてが順調に進む状態を示しています。内なる価値観が明確で、それに基づいて安定した判断ができます。"
            },
            interfaceOS: {
                hexagramId: "17",
                hexagramName: "沢雷随",
                hexagramSymbol: "☱☳",
                primaryElement: "lake",
                traits: ["柔軟性", "適応力", "共感力"],
                scores: {
                    adaptability: 75,
                    expressiveness: 70,
                    socialAlignment: 73
                },
                description: "社会的な場面では「沢雷随」のように、状況に応じて柔軟に対応し、人々との調和を重視します。相手に合わせながらも、自分らしさを失わない絶妙なバランスを保っています。"
            },
            safeModeOS: {
                hexagramId: "51",
                hexagramName: "震為雷",
                hexagramSymbol: "☳☳",
                primaryElement: "thunder",
                traits: ["瞬発力", "警戒心", "回復力"],
                scores: {
                    reactivity: 88,
                    resilience: 80,
                    protectionLevel: 85
                },
                description: "防御システムは「震為雷」のように、危機を素早く察知し、雷鳴のような瞬発力で対応します。一時的に動揺しても、すぐに立ち直る強い回復力を持っています。"
            },
            tripleOSBalance: {
                dominantOS: "engineOS",
                balanceScore: 78,
                interactions: {
                    engineInterface: {
                        compatibility: 75,
                        dynamic: "complementary",
                        description: "価値観と社会的表現が良好に連携"
                    },
                    engineSafeMode: {
                        compatibility: 68,
                        dynamic: "tension",
                        description: "理想と防御本能の間に創造的な緊張"
                    },
                    interfaceSafeMode: {
                        compatibility: 72,
                        dynamic: "supportive",
                        description: "社会性と防御が相互にサポート"
                    }
                }
            },
            insights: {
                core: "あなたは明確な価値観を持ちながら、状況に応じて柔軟に対応できる稀有なバランスを持っています。",
                strengths: [
                    "価値観に基づいた一貫した判断力",
                    "社会的な場面での適応力と共感力",
                    "危機に対する素早い反応と回復力"
                ],
                opportunities: [
                    "価値観と社会的期待のバランスをさらに最適化",
                    "防御反応を建設的な行動に転換する練習",
                    "3つのOSの調和を意識的に活用した戦略的行動"
                ],
                recommendations: [
                    "定期的に自分の価値観を振り返り、明文化する",
                    "社会的な場面でも本来の自分を表現する機会を増やす",
                    "ストレス時の防御反応パターンを観察し、より建設的な対処法を開発"
                ]
            },
            metadata: {
                analysisVersion: "2.0",
                timestamp: new Date().toISOString(),
                questionCount: 30,
                completionTime: 300000, // 5分
                reliability: 0.92
            }
        };
        
        // 30問の回答データ
        const completeAnswers = [];
        for (let i = 1; i <= 30; i++) {
            completeAnswers.push({
                questionId: `q${i}`,
                selectedValue: ['A', 'B', 'C', 'D'][Math.floor(Math.random() * 4)],
                timestamp: new Date(Date.now() - (30 - i) * 10000).toISOString(),
                responseTime: Math.floor(Math.random() * 5000) + 5000
            });
        }
        
        // データプレビューを表示
        document.getElementById('data-preview').textContent = JSON.stringify(completeAnalysisData, null, 2);
        
        // 完全なデータを投入
        function injectCompleteData() {
            const status = document.getElementById('status');
            status.style.display = 'block';
            status.className = 'status';
            
            try {
                // セッションデータ
                const sessionData = {
                    sessionId: 'test-' + Date.now(),
                    stage: 'results',
                    startedAt: new Date(Date.now() - 360000).toISOString(),
                    completedAt: new Date().toISOString(),
                    version: '2.0'
                };
                
                // 診断結果データ
                const diagnosisData = {
                    analysisResult: completeAnalysisData,
                    userAnswers: completeAnswers,
                    timestamp: new Date().toISOString()
                };
                
                // LocalStorageに保存
                localStorage.setItem('haqei_session', JSON.stringify(sessionData));
                localStorage.setItem('haqei_answers', JSON.stringify(completeAnswers));
                localStorage.setItem('haqei_analysis_result', JSON.stringify(completeAnalysisData));
                localStorage.setItem('haqei_diagnosis_result', JSON.stringify(diagnosisData));
                
                // 進行状況も保存
                localStorage.setItem('haqei_progress', JSON.stringify({
                    currentStep: 'results',
                    completedSteps: ['welcome', 'questions', 'analysis', 'results'],
                    timestamp: new Date().toISOString()
                }));
                
                status.innerHTML = `
                    <h3>✅ データ投入完了！</h3>
                    <p>以下のデータが LocalStorage に保存されました：</p>
                    <ul>
                        <li>セッション情報</li>
                        <li>30問の回答データ</li>
                        <li>分析結果（3つのOS）</li>
                        <li>診断結果（統合データ）</li>
                        <li>進行状況</li>
                    </ul>
                    <p>「Results.htmlを開く」ボタンをクリックして結果を確認してください。</p>
                `;
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = `<h3>❌ エラー</h3><p>${error.message}</p>`;
            }
        }
        
        // Results.htmlを開く
        function openResultsPage() {
            window.open('/results.html', '_blank');
        }
        
        // 現在のデータを確認
        function checkCurrentData() {
            const status = document.getElementById('status');
            status.style.display = 'block';
            status.className = 'status';
            
            const data = {
                session: localStorage.getItem('haqei_session'),
                answers: localStorage.getItem('haqei_answers'),
                analysisResult: localStorage.getItem('haqei_analysis_result'),
                diagnosisResult: localStorage.getItem('haqei_diagnosis_result'),
                progress: localStorage.getItem('haqei_progress')
            };
            
            let html = '<h3>📊 LocalStorage の現在の状態</h3>';
            for (const [key, value] of Object.entries(data)) {
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        html += `<p><strong>${key}:</strong> ${Object.keys(parsed).length} properties</p>`;
                    } catch {
                        html += `<p><strong>${key}:</strong> ${value.length} characters</p>`;
                    }
                } else {
                    html += `<p><strong>${key}:</strong> <span style="color: #ef4444;">なし</span></p>`;
                }
            }
            
            status.innerHTML = html;
        }
        
        // データをクリア
        function clearAllData() {
            const keys = ['haqei_session', 'haqei_answers', 'haqei_analysis_result', 'haqei_diagnosis_result', 'haqei_progress'];
            keys.forEach(key => localStorage.removeItem(key));
            
            const status = document.getElementById('status');
            status.style.display = 'block';
            status.className = 'status';
            status.innerHTML = '<h3>🗑️ 全データをクリアしました</h3>';
        }
    </script>
</body>
</html>