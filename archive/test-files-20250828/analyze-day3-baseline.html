<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Day 3 - ç¾çŠ¶åã‚Šåˆ†æ</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            padding: 20px; 
            background: #1e1e1e; 
            color: #d4d4d4;
        }
        h1 { color: #4ec9b0; }
        .analysis { 
            background: #2d2d30; 
            padding: 15px; 
            margin: 20px 0;
            border-radius: 5px;
        }
        .high { color: #f48771; font-weight: bold; }
        .low { color: #569cd6; font-weight: bold; }
        .normal { color: #4ec9b0; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #3c3c3c;
        }
        th { background: #252526; }
        .deviation-chart {
            margin: 20px 0;
        }
        .bar {
            display: inline-block;
            height: 20px;
            margin-right: 5px;
        }
        .bar-over { background: #f48771; }
        .bar-under { background: #569cd6; }
        .bar-normal { background: #4ec9b0; }
    </style>
</head>
<body>
    <h1>Day 3 - ç¾çŠ¶åã‚Šåˆ†æ</h1>
    
    <div id="loading">åˆ†æä¸­...</div>
    <div id="results"></div>
    
    <script type="module">
        import { TextTo384LinesBridge } from './public/js/ai/TextTo384LinesBridge.js';
        
        async function analyzeBaseline() {
            const bridge = new TextTo384LinesBridge();
            await bridge.initialize();
            
            // ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«ï¼ˆå„ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰å‡ç­‰ã«ï¼‰
            const testSamples = {
                neutral: [
                    "æ—¥å¸¸çš„ãªæ¥­å‹™ã‚’é€²ã‚ã‚‹",
                    "é€šå¸¸ã®ä½œæ¥­ã‚’ç¶™ç¶š",
                    "å¹³å¸¸å¿ƒã‚’ä¿ã¤",
                    "æ¨™æº–çš„ãªå¯¾å¿œ",
                    "ä¸€èˆ¬çš„ãªå‡¦ç†"
                ],
                position1: [
                    "æ–°ã—ã„æŒ‘æˆ¦ã‚’å§‹ã‚ã‚‹",
                    "ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹ã«ç«‹ã¤",
                    "åˆå¿ƒè€…ã¨ã—ã¦å­¦ã¶",
                    "åŸºç¤ã‹ã‚‰å§‹ã‚ã‚‹",
                    "ç¬¬ä¸€æ­©ã‚’è¸ã¿å‡ºã™"
                ],
                position2: [
                    "å”åŠ›ã—ã¦é€²ã‚ã‚‹",
                    "ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ç™ºæ®",
                    "å†…é¢ã¨å‘ãåˆã†",
                    "ã‚µãƒãƒ¼ãƒˆã™ã‚‹ç«‹å ´",
                    "ç›¸è«‡ã«ä¹—ã‚‹"
                ],
                position3: [
                    "å›°é›£ã«ç›´é¢ã™ã‚‹",
                    "è©¦ç·´ã‚’ä¹—ã‚Šè¶Šãˆã‚‹",
                    "å•é¡Œè§£æ±ºã«å–ã‚Šçµ„ã‚€",
                    "æŒ‘æˆ¦çš„ãªèª²é¡Œ",
                    "å£ã‚’çªç ´ã™ã‚‹"
                ],
                position4: [
                    "å¤‰åŒ–ã®æ™‚æœŸ",
                    "è»¢æ›ç‚¹ã‚’è¿ãˆã‚‹",
                    "æ±ºæ–­ãŒå¿…è¦",
                    "æ–¹å‘è»¢æ›ã™ã‚‹",
                    "ç§»è¡ŒæœŸã«ã‚ã‚‹"
                ],
                position5: [
                    "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®",
                    "éƒ¨é•·ã¨ã—ã¦åˆ¤æ–­",
                    "çµ±æ‹¬çš„ã«ç®¡ç†",
                    "è²¬ä»»è€…ã¨ã—ã¦æ±ºå®š",
                    "ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ç«‹å ´"
                ],
                position6: [
                    "å®Œæˆã«å‘ã‘ã¦",
                    "æœ€çµ‚æ®µéš",
                    "ä»•ä¸Šã’ã®ä½œæ¥­",
                    "çµ‚äº†é–“è¿‘",
                    "ç· ã‚ããã‚Š"
                ]
            };
            
            // åˆ†æå®Ÿè¡Œ
            const results = {
                total: 0,
                positions: [0, 0, 0, 0, 0, 0, 0], // index 0ã¯æœªä½¿ç”¨
                categoryAnalysis: {},
                keywords: {
                    1: [], 2: [], 3: [], 4: [], 5: [], 6: []
                }
            };
            
            for (const [category, samples] of Object.entries(testSamples)) {
                results.categoryAnalysis[category] = {
                    samples: [],
                    positionCounts: [0, 0, 0, 0, 0, 0, 0]
                };
                
                for (const text of samples) {
                    const result = await bridge.analyzeText(text);
                    results.total++;
                    results.positions[result.line_position]++;
                    results.categoryAnalysis[category].samples.push({
                        text: text,
                        position: result.line_position
                    });
                    results.categoryAnalysis[category].positionCounts[result.line_position]++;
                }
            }
            
            displayAnalysis(results);
        }
        
        function displayAnalysis(results) {
            const ideal = 100 / 6; // 16.67%
            let html = '';
            
            // åå·®åˆ†æ
            html += '<div class="analysis">';
            html += '<h2>ğŸ“Š ä½ç½®åˆ¥åå·®åˆ†æ</h2>';
            html += '<table>';
            html += '<tr><th>ä½ç½®</th><th>å›æ•°</th><th>å‰²åˆ</th><th>ç†æƒ³å€¤</th><th>åå·®</th><th>åˆ¤å®š</th></tr>';
            
            const positions = results.positions.slice(1);
            for (let i = 0; i < positions.length; i++) {
                const count = positions[i];
                const percent = ((count / results.total) * 100).toFixed(1);
                const deviation = (parseFloat(percent) - ideal).toFixed(1);
                
                let status = 'normal';
                let statusText = 'æ­£å¸¸';
                if (deviation > 5) {
                    status = 'high';
                    statusText = 'éå¤š âš ï¸';
                } else if (deviation < -5) {
                    status = 'low';
                    statusText = 'ä¸è¶³ âš ï¸';
                }
                
                html += '<tr>';
                html += `<td>${i + 1}çˆ»</td>`;
                html += `<td>${count}</td>`;
                html += `<td class="${status}">${percent}%</td>`;
                html += `<td>${ideal.toFixed(1)}%</td>`;
                html += `<td class="${status}">${deviation > 0 ? '+' : ''}${deviation}%</td>`;
                html += `<td class="${status}">${statusText}</td>`;
                html += '</tr>';
            }
            html += '</table>';
            html += '</div>';
            
            // å•é¡Œç®‡æ‰€ã®ç‰¹å®š
            html += '<div class="analysis">';
            html += '<h2>ğŸ¯ æ”¹å–„å¿…è¦ç®‡æ‰€</h2>';
            
            const problems = [];
            for (let i = 0; i < positions.length; i++) {
                const percent = ((positions[i] / results.total) * 100);
                const deviation = percent - ideal;
                
                if (Math.abs(deviation) > 5) {
                    problems.push({
                        position: i + 1,
                        percent: percent.toFixed(1),
                        deviation: deviation.toFixed(1),
                        type: deviation > 0 ? 'over' : 'under'
                    });
                }
            }
            
            problems.sort((a, b) => Math.abs(b.deviation) - Math.abs(a.deviation));
            
            html += '<ol>';
            for (const problem of problems) {
                const className = problem.type === 'over' ? 'high' : 'low';
                const action = problem.type === 'over' ? 'å‰Šæ¸›ãŒå¿…è¦' : 'å¼·åŒ–ãŒå¿…è¦';
                html += `<li class="${className}">`;
                html += `${problem.position}çˆ»: ${problem.percent}% (${problem.deviation > 0 ? '+' : ''}${problem.deviation}%) - ${action}`;
                html += '</li>';
            }
            html += '</ol>';
            html += '</div>';
            
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥åå¿œ
            html += '<div class="analysis">';
            html += '<h2>ğŸ“‹ ã‚«ãƒ†ã‚´ãƒªåˆ¥åå¿œãƒ‘ã‚¿ãƒ¼ãƒ³</h2>';
            html += '<table>';
            html += '<tr><th>ã‚«ãƒ†ã‚´ãƒª</th><th>æœ€é »å‡ºä½ç½®</th><th>ãƒ‘ã‚¿ãƒ¼ãƒ³</th></tr>';
            
            for (const [category, data] of Object.entries(results.categoryAnalysis)) {
                const maxPos = data.positionCounts.indexOf(Math.max(...data.positionCounts));
                const pattern = data.samples.map(s => s.position).join(', ');
                
                html += '<tr>';
                html += `<td>${category}</td>`;
                html += `<td>${maxPos}çˆ»</td>`;
                html += `<td style="font-size: 0.9em">${pattern}</td>`;
                html += '</tr>';
            }
            html += '</table>';
            html += '</div>';
            
            // æ”¹å–„ææ¡ˆ
            html += '<div class="analysis">';
            html += '<h2>ğŸ’¡ Day 3 æ”¹å–„ææ¡ˆ</h2>';
            html += '<h3>å„ªå…ˆåº¦é«˜ï¼ˆåå·® > 5%ï¼‰</h3>';
            html += '<ul>';
            
            for (const problem of problems) {
                if (Math.abs(problem.deviation) > 5) {
                    if (problem.type === 'over') {
                        html += `<li class="high">${problem.position}çˆ»: `;
                        html += `ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å‰Šæ¸›ã€é‡ã¿æ¸›å°‘ï¼ˆç¾åœ¨ã®é‡ã¿ã‹ã‚‰-0.05ï½-0.10ï¼‰</li>`;
                    } else {
                        html += `<li class="low">${problem.position}çˆ»: `;
                        html += `ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¿½åŠ ã€é‡ã¿å¢—åŠ ï¼ˆç¾åœ¨ã®é‡ã¿ã‹ã‚‰+0.05ï½+0.10ï¼‰</li>`;
                    }
                }
            }
            
            html += '</ul>';
            html += '</div>';
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').innerHTML = html;
        }
        
        analyzeBaseline();
    </script>
</body>
</html>