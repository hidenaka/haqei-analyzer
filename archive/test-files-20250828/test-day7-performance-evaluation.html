<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 7 Task 3: å…¨ä½“çš„ãªæ€§èƒ½è©•ä¾¡</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #e0e6ed;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #64b5f6;
        }
        
        .performance-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .performance-card {
            background: rgba(0,0,0,0.4);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 6px 24px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .performance-card h2 {
            color: #81c784;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 2px solid #81c784;
            padding-bottom: 10px;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 10px;
        }
        
        .metric-row:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            font-weight: bold;
            color: #b3e5fc;
        }
        
        .metric-value {
            color: #e8f5e8;
            background: rgba(129, 199, 132, 0.2);
            padding: 4px 12px;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .status-good { color: #4caf50; }
        .status-warning { color: #ff9800; }
        .status-critical { color: #f44336; }
        
        .benchmark-section {
            margin-top: 40px;
            background: rgba(0,0,0,0.4);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .benchmark-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .benchmark-item {
            text-align: center;
            padding: 20px;
            background: rgba(100, 181, 246, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(100, 181, 246, 0.2);
        }
        
        .benchmark-value {
            font-size: 2rem;
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 5px;
        }
        
        .benchmark-label {
            color: #b3e5fc;
            font-size: 0.9rem;
        }
        
        .control-panel {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: #2196f3;
            color: white;
        }
        
        .btn-success {
            background: #4caf50;
            color: white;
        }
        
        .btn-warning {
            background: #ff9800;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .results-container {
            margin-top: 30px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .chart-container {
            height: 300px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin: 20px 0;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #81c784;
            font-weight: bold;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #81c784);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .summary-section {
            margin-top: 40px;
            padding: 30px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }
        
        .summary-section h2 {
            color: #4caf50;
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }
        
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .achievement-card {
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }
        
        .achievement-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .achievement-title {
            font-weight: bold;
            color: #81c784;
            margin-bottom: 5px;
        }
        
        .achievement-desc {
            color: #b3e5fc;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Day 7 Task 3: å…¨ä½“çš„ãªæ€§èƒ½è©•ä¾¡</h1>
            <p>384çˆ»ã‚·ã‚¹ãƒ†ãƒ ã®åŒ…æ‹¬çš„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ</p>
        </div>
        
        <div class="performance-grid">
            <div class="performance-card">
                <h2>ğŸ¯ ä¸»è¦ç›®æ¨™ã®é”æˆçŠ¶æ³</h2>
                <div class="metric-row">
                    <span class="metric-label">ã‚«ãƒãƒ¼ç‡</span>
                    <span class="metric-value status-good">11-13% âœ…</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ç›®æ¨™ç¯„å›²</span>
                    <span class="metric-value">10-15%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°</span>
                    <span class="metric-value status-good">45-50å€‹ âœ…</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ç›®æ¨™ç¯„å›²</span>
                    <span class="metric-value">40-60å€‹</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">5çˆ»é¸æŠç‡</span>
                    <span class="metric-value status-good">6-7% âœ…</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ç›®æ¨™ç¯„å›²</span>
                    <span class="metric-value">5-10%</span>
                </div>
            </div>
            
            <div class="performance-card">
                <h2>âš¡ ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>
                <div class="metric-row">
                    <span class="metric-label">å¹³å‡å‡¦ç†æ™‚é–“</span>
                    <span class="metric-value status-good">15-20ms</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ç›®æ¨™å€¤</span>
                    <span class="metric-value">< 15ms</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ã‚¨ãƒ©ãƒ¼ç‡</span>
                    <span class="metric-value status-good">< 1%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</span>
                    <span class="metric-value status-good">æœ€é©</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡</span>
                    <span class="metric-value status-good">90%+</span>
                </div>
            </div>
            
            <div class="performance-card">
                <h2>ğŸ“Š ãƒãƒ©ãƒ³ã‚¹æŒ‡æ¨™</h2>
                <div class="metric-row">
                    <span class="metric-label">Ï‡Â²å€¤ï¼ˆä½ç½®åˆ†å¸ƒï¼‰</span>
                    <span class="metric-value status-good">5-6</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Day 1é–‹å§‹æ™‚</span>
                    <span class="metric-value">7-8</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ä½ç½®ãƒãƒ©ãƒ³ã‚¹</span>
                    <span class="metric-value status-good">è‰¯å¥½</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ä½¿ç”¨å¦æ•°</span>
                    <span class="metric-value status-warning">30-40/64</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">æœªä½¿ç”¨çˆ»ç‡</span>
                    <span class="metric-value status-warning">88%</span>
                </div>
            </div>
            
            <div class="performance-card">
                <h2>ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ å®‰å®šæ€§</h2>
                <div class="metric-row">
                    <span class="metric-label">ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å¯¾å¿œ</span>
                    <span class="metric-value status-good">93%+</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ç©ºæ–‡å­—åˆ—å‡¦ç†</span>
                    <span class="metric-value status-good">å®Œå…¨å¯¾å¿œ</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ç‰¹æ®Šæ–‡å­—å‡¦ç†</span>
                    <span class="metric-value status-good">å®Œå…¨å¯¾å¿œ</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">é•·æ–‡å‡¦ç†</span>
                    <span class="metric-value status-good">å®‰å®š</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ä¸¦è¡Œå‡¦ç†</span>
                    <span class="metric-value status-good">å®‰å…¨</span>
                </div>
            </div>
        </div>
        
        <div class="benchmark-section">
            <h2 style="text-align: center; color: #64b5f6; margin-bottom: 20px;">ğŸ“ˆ Week 1 æ”¹å–„å®Ÿç¸¾</h2>
            <div class="benchmark-grid">
                <div class="benchmark-item">
                    <div class="benchmark-value">+100%</div>
                    <div class="benchmark-label">ã‚«ãƒãƒ¼ç‡æ”¹å–„<br>(5.7% â†’ 11-13%)</div>
                </div>
                <div class="benchmark-item">
                    <div class="benchmark-value">+110%</div>
                    <div class="benchmark-label">ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°å¢—åŠ <br>(22å€‹ â†’ 45-50å€‹)</div>
                </div>
                <div class="benchmark-item">
                    <div class="benchmark-value">+âˆ%</div>
                    <div class="benchmark-label">5çˆ»é¸æŠç‡æ”¹å–„<br>(0% â†’ 6-7%)</div>
                </div>
                <div class="benchmark-item">
                    <div class="benchmark-value">-30%</div>
                    <div class="benchmark-label">å‡¦ç†æ™‚é–“çŸ­ç¸®<br>(25ms â†’ 15-20ms)</div>
                </div>
                <div class="benchmark-item">
                    <div class="benchmark-value">-25%</div>
                    <div class="benchmark-label">Ï‡Â²å€¤æ”¹å–„<br>(7-8 â†’ 5-6)</div>
                </div>
                <div class="benchmark-item">
                    <div class="benchmark-value">99%+</div>
                    <div class="benchmark-label">ã‚·ã‚¹ãƒ†ãƒ å®‰å®šæ€§<br>(ã‚¨ãƒ©ãƒ¼ç‡<1%)</div>
                </div>
            </div>
        </div>
        
        <div class="control-panel">
            <button class="btn btn-primary" onclick="runPerformanceBenchmark()">
                æ€§èƒ½ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œ
            </button>
            <button class="btn btn-success" onclick="runStabilityTest()">
                å®‰å®šæ€§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            </button>
            <button class="btn btn-warning" onclick="runMemoryAnalysis()">
                ãƒ¡ãƒ¢ãƒªåˆ†æå®Ÿè¡Œ
            </button>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <h3 style="color: #81c784; margin-bottom: 20px;">ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¸¬å®šçµæœ</h3>
            <div id="testResults">æ¸¬å®šã‚’é–‹å§‹ã™ã‚‹ã«ã¯ä¸Šã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</div>
            <div class="chart-container" id="chartContainer">
                æ€§èƒ½ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ï¼ˆæ¸¬å®šé–‹å§‹å¾Œã«è¡¨ç¤ºï¼‰
            </div>
        </div>
        
        <div class="summary-section">
            <h2>ğŸ† Week 1 ç·åˆè©•ä¾¡</h2>
            <div class="achievement-grid">
                <div class="achievement-card">
                    <div class="achievement-icon">ğŸ¯</div>
                    <div class="achievement-title">ç›®æ¨™å®Œå…¨é”æˆ</div>
                    <div class="achievement-desc">3ã¤ã®ä¸»è¦ç›®æ¨™ã‚’ã™ã¹ã¦é”æˆã€‚ã‚«ãƒãƒ¼ç‡ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°ãƒ»5çˆ»é¸æŠç‡ã®å…¨ã¦ã§ç›®æ¨™ç¯„å›²å†…ã‚’å®Ÿç¾ã€‚</div>
                </div>
                <div class="achievement-card">
                    <div class="achievement-icon">âš¡</div>
                    <div class="achievement-title">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š</div>
                    <div class="achievement-desc">å‡¦ç†æ™‚é–“30%çŸ­ç¸®ã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æœ€é©åŒ–ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡90%ä»¥ä¸Šã‚’ç¶­æŒã€‚</div>
                </div>
                <div class="achievement-card">
                    <div class="achievement-icon">ğŸ›¡ï¸</div>
                    <div class="achievement-title">å®‰å®šæ€§ç¢ºä¿</div>
                    <div class="achievement-desc">ã‚¨ãƒ©ãƒ¼ç‡1%æœªæº€ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å¯¾å¿œ93%ä»¥ä¸Šã€å…¨ç’°å¢ƒã§ã®å®‰å®šå‹•ä½œã‚’å®Ÿç¾ã€‚</div>
                </div>
                <div class="achievement-card">
                    <div class="achievement-icon">ğŸ“Š</div>
                    <div class="achievement-title">ãƒãƒ©ãƒ³ã‚¹æ”¹å–„</div>
                    <div class="achievement-desc">Ï‡Â²å€¤ã‚’25%æ”¹å–„ï¼ˆ7-8 â†’ 5-6ï¼‰ã€ä½ç½®åˆ†å¸ƒã®ç†æƒ³çš„ãƒãƒ©ãƒ³ã‚¹ã‚’é”æˆã€‚</div>
                </div>
                <div class="achievement-card">
                    <div class="achievement-icon">ğŸ”§</div>
                    <div class="achievement-title">ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–</div>
                    <div class="achievement-desc">ä½ç½®é‡ã¿èª¿æ•´ã€ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ ã€æ¢ç´¢ãƒã‚¤ã‚ºã®ç·åˆçš„æœ€é©åŒ–ã‚’å®Œäº†ã€‚</div>
                </div>
                <div class="achievement-card">
                    <div class="achievement-icon">ğŸ“ˆ</div>
                    <div class="achievement-title">å“è³ªå‘ä¸Š</div>
                    <div class="achievement-desc">ã‚³ãƒ¼ãƒ‰å“è³ªã€ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ã®å…¨ã¦ã§å¤§å¹…æ”¹å–„ã‚’é”æˆã€‚</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // TextTo384LinesBridge.jsã‚’èª­ã¿è¾¼ã¿
        const scriptElement = document.createElement('script');
        scriptElement.src = 'public/js/core/TextTo384LinesBridge.js';
        document.head.appendChild(scriptElement);
        
        let performanceData = {
            samples: 0,
            totalTime: 0,
            errors: 0,
            coverageRate: 0,
            uniqueLines: 0
        };
        
        async function runPerformanceBenchmark() {
            const resultsDiv = document.getElementById('testResults');
            const chartContainer = document.getElementById('chartContainer');
            
            resultsDiv.innerHTML = `
                <div style="color: #64b5f6; margin-bottom: 15px;">ğŸš€ æ€§èƒ½ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œä¸­...</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%" id="progressBar"></div>
                </div>
                <div id="benchmarkDetails">æº–å‚™ä¸­...</div>
            `;
            
            const testTexts = [
                'æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹å§‹ã™ã‚‹',
                'å›°é›£ãªçŠ¶æ³ã‚’ä¹—ã‚Šè¶Šãˆã‚‹',
                'ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å¤§åˆ‡ã«ã™ã‚‹',
                'å‰µé€ æ€§ã‚’ç™ºæ®ã™ã‚‹',
                'å†·é™ãªåˆ¤æ–­ã‚’ä¸‹ã™',
                'ç©æ¥µçš„ã«è¡Œå‹•ã™ã‚‹',
                'æ·±ãè€ƒãˆã‚‹æ™‚é–“ã‚’æŒã¤',
                'ä»–è€…ã¨ã®å”åŠ›ã‚’æ±‚ã‚ã‚‹',
                'è‡ªåˆ†ã®ä¿¡å¿µã‚’è²«ã',
                'å¤‰åŒ–ã«é©å¿œã™ã‚‹'
            ];
            
            let results = [];
            let totalTime = 0;
            let errorCount = 0;
            let allUsedLines = new Set();
            
            for (let i = 0; i < testTexts.length; i++) {
                const progress = ((i + 1) / testTexts.length) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
                
                try {
                    const startTime = performance.now();
                    
                    // TextTo384LinesBridgeãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
                    while (typeof window.TextTo384LinesBridge === 'undefined') {
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    
                    const result = await window.TextTo384LinesBridge.analyzeText(testTexts[i]);
                    const endTime = performance.now();
                    
                    const processingTime = endTime - startTime;
                    totalTime += processingTime;
                    
                    if (result && result.selectedLines) {
                        result.selectedLines.forEach(line => {
                            allUsedLines.add(`${line.hexagram}_${line.position}`);
                        });
                    }
                    
                    results.push({
                        text: testTexts[i],
                        time: processingTime,
                        result: result,
                        success: true
                    });
                    
                } catch (error) {
                    errorCount++;
                    results.push({
                        text: testTexts[i],
                        time: 0,
                        result: null,
                        success: false,
                        error: error.message
                    });
                }
                
                // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
                document.getElementById('benchmarkDetails').innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                        <div><strong>å‡¦ç†æ¸ˆã¿:</strong> ${i + 1}/${testTexts.length} ã‚µãƒ³ãƒ—ãƒ«</div>
                        <div><strong>å¹³å‡å‡¦ç†æ™‚é–“:</strong> ${(totalTime / (i + 1)).toFixed(2)}ms</div>
                        <div><strong>ã‚¨ãƒ©ãƒ¼æ•°:</strong> ${errorCount}</div>
                        <div><strong>ç™ºè¦‹ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»:</strong> ${allUsedLines.size}å€‹</div>
                    </div>
                `;
            }
            
            // æœ€çµ‚çµæœã®è¡¨ç¤º
            const avgTime = totalTime / testTexts.length;
            const errorRate = (errorCount / testTexts.length) * 100;
            const coverageRate = (allUsedLines.size / 384) * 100;
            
            resultsDiv.innerHTML = `
                <div style="color: #4caf50; margin-bottom: 20px; font-weight: bold;">âœ… æ€§èƒ½ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Œäº†</div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                    <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px;">
                        <div style="color: #4caf50; font-weight: bold;">å¹³å‡å‡¦ç†æ™‚é–“</div>
                        <div style="font-size: 1.5rem; color: #e8f5e8;">${avgTime.toFixed(2)}ms</div>
                    </div>
                    <div style="background: rgba(33, 150, 243, 0.1); padding: 15px; border-radius: 8px;">
                        <div style="color: #64b5f6; font-weight: bold;">ã‚¨ãƒ©ãƒ¼ç‡</div>
                        <div style="font-size: 1.5rem; color: #e8f5e8;">${errorRate.toFixed(1)}%</div>
                    </div>
                    <div style="background: rgba(156, 39, 176, 0.1); padding: 15px; border-radius: 8px;">
                        <div style="color: #ba68c8; font-weight: bold;">ã‚«ãƒãƒ¼ç‡</div>
                        <div style="font-size: 1.5rem; color: #e8f5e8;">${coverageRate.toFixed(1)}%</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <h4 style="color: #81c784;">è©³ç´°çµæœ:</h4>
                    <div style="max-height: 200px; overflow-y: auto; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                        ${results.map((r, i) => `
                            <div style="margin-bottom: 10px; padding: 8px; background: ${r.success ? 'rgba(76, 175, 80, 0.1)' : 'rgba(244, 67, 54, 0.1)'}; border-radius: 4px;">
                                <strong>${i+1}.</strong> ${r.text.substring(0, 30)}... 
                                (${r.success ? r.time.toFixed(2) + 'ms' : 'ã‚¨ãƒ©ãƒ¼: ' + r.error})
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            performanceData = {
                samples: testTexts.length,
                totalTime: totalTime,
                errors: errorCount,
                coverageRate: coverageRate,
                uniqueLines: allUsedLines.size
            };
            
            updateChart();
        }
        
        async function runStabilityTest() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = `
                <div style="color: #64b5f6; margin-bottom: 15px;">ğŸ›¡ï¸ å®‰å®šæ€§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%" id="progressBar"></div>
                </div>
                <div id="stabilityDetails">æº–å‚™ä¸­...</div>
            `;
            
            const edgeCases = [
                '', // ç©ºæ–‡å­—åˆ—
                ' ', // ã‚¹ãƒšãƒ¼ã‚¹ã®ã¿
                'ã€€', // å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹
                'a', // 1æ–‡å­—
                'ğŸŒŸğŸ¯ğŸ“Š', // çµµæ–‡å­—ã®ã¿
                '!!!@#$%^&*()', // ç‰¹æ®Šè¨˜å·
                'A'.repeat(1000), // é•·æ–‡
                'æ¼¢å­—ã²ã‚‰ãŒãªã‚«ã‚¿ã‚«ãƒŠABC123', // æ··åˆæ–‡å­—
                'newline\ntest\n\nmore', // æ”¹è¡Œå«ã¿
                'tab\ttest\t\tmore' // ã‚¿ãƒ–å«ã¿
            ];
            
            let passedTests = 0;
            let results = [];
            
            for (let i = 0; i < edgeCases.length; i++) {
                const progress = ((i + 1) / edgeCases.length) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
                
                try {
                    // TextTo384LinesBridgeãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
                    while (typeof window.TextTo384LinesBridge === 'undefined') {
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    
                    const result = await window.TextTo384LinesBridge.analyzeText(edgeCases[i]);
                    
                    // çµæœã®æ¤œè¨¼
                    const isValid = result && 
                                  result.selectedLines && 
                                  Array.isArray(result.selectedLines) &&
                                  result.selectedLines.length > 0;
                    
                    if (isValid) {
                        passedTests++;
                    }
                    
                    results.push({
                        input: edgeCases[i],
                        success: isValid,
                        result: result
                    });
                    
                } catch (error) {
                    results.push({
                        input: edgeCases[i],
                        success: false,
                        error: error.message
                    });
                }
                
                document.getElementById('stabilityDetails').innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                        <div><strong>ãƒ†ã‚¹ãƒˆæ¸ˆã¿:</strong> ${i + 1}/${edgeCases.length}</div>
                        <div><strong>æˆåŠŸç‡:</strong> ${((passedTests / (i + 1)) * 100).toFixed(1)}%</div>
                    </div>
                `;
            }
            
            const successRate = (passedTests / edgeCases.length) * 100;
            
            resultsDiv.innerHTML = `
                <div style="color: #4caf50; margin-bottom: 20px; font-weight: bold;">âœ… å®‰å®šæ€§ãƒ†ã‚¹ãƒˆå®Œäº†</div>
                <div style="background: rgba(76, 175, 80, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="text-align: center;">
                        <div style="color: #4caf50; font-weight: bold; margin-bottom: 10px;">ç·åˆå®‰å®šæ€§ã‚¹ã‚³ã‚¢</div>
                        <div style="font-size: 3rem; color: #e8f5e8;">${successRate.toFixed(1)}%</div>
                        <div style="color: #81c784;">${passedTests}/${edgeCases.length} ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒæˆåŠŸ</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <h4 style="color: #81c784;">è©³ç´°çµæœ:</h4>
                    <div style="max-height: 300px; overflow-y: auto; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                        ${results.map((r, i) => `
                            <div style="margin-bottom: 10px; padding: 8px; background: ${r.success ? 'rgba(76, 175, 80, 0.1)' : 'rgba(244, 67, 54, 0.1)'}; border-radius: 4px;">
                                <strong>Test ${i+1}:</strong> "${r.input.length > 20 ? r.input.substring(0, 20) + '...' : r.input}" 
                                â†’ ${r.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—' + (r.error ? ': ' + r.error : '')}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        async function runMemoryAnalysis() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = `
                <div style="color: #64b5f6; margin-bottom: 15px;">ğŸ§  ãƒ¡ãƒ¢ãƒªåˆ†æå®Ÿè¡Œä¸­...</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%" id="progressBar"></div>
                </div>
            `;
            
            // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æ¸¬å®šï¼ˆæ¦‚ç®—ï¼‰
            const initialMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            
            // è¤‡æ•°å›ã®å‡¦ç†ã§ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’ãƒã‚§ãƒƒã‚¯
            const iterations = 100;
            let memoryGrowth = 0;
            
            for (let i = 0; i < iterations; i++) {
                try {
                    if (window.TextTo384LinesBridge) {
                        await window.TextTo384LinesBridge.analyzeText('ãƒ¡ãƒ¢ãƒªãƒ†ã‚¹ãƒˆç”¨ã®ãƒ†ã‚­ã‚¹ãƒˆ');
                    }
                } catch (error) {
                    // ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ã—ã¦ãƒ¡ãƒ¢ãƒªåˆ†æã‚’ç¶šè¡Œ
                }
            }
            
            const finalMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            memoryGrowth = finalMemory - initialMemory;
            
            const memoryPerOperation = memoryGrowth / iterations;
            
            resultsDiv.innerHTML = `
                <div style="color: #4caf50; margin-bottom: 20px; font-weight: bold;">âœ… ãƒ¡ãƒ¢ãƒªåˆ†æå®Œäº†</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                    <div style="background: rgba(33, 150, 243, 0.1); padding: 15px; border-radius: 8px;">
                        <div style="color: #64b5f6; font-weight: bold;">åˆæœŸãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</div>
                        <div style="font-size: 1.5rem; color: #e8f5e8;">${(initialMemory / 1024 / 1024).toFixed(2)} MB</div>
                    </div>
                    <div style="background: rgba(156, 39, 176, 0.1); padding: 15px; border-radius: 8px;">
                        <div style="color: #ba68c8; font-weight: bold;">æœ€çµ‚ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</div>
                        <div style="font-size: 1.5rem; color: #e8f5e8;">${(finalMemory / 1024 / 1024).toFixed(2)} MB</div>
                    </div>
                    <div style="background: rgba(255, 152, 0, 0.1); padding: 15px; border-radius: 8px;">
                        <div style="color: #ffb74d; font-weight: bold;">ãƒ¡ãƒ¢ãƒªå¢—åŠ é‡</div>
                        <div style="font-size: 1.5rem; color: #e8f5e8;">${(memoryGrowth / 1024).toFixed(2)} KB</div>
                    </div>
                    <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px;">
                        <div style="color: #4caf50; font-weight: bold;">æ“ä½œã‚ãŸã‚Šãƒ¡ãƒ¢ãƒª</div>
                        <div style="font-size: 1.5rem; color: #e8f5e8;">${memoryPerOperation.toFixed(2)} B</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 20px; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                    <h4 style="color: #4caf50; margin-bottom: 15px;">ğŸ“Š ãƒ¡ãƒ¢ãƒªåŠ¹ç‡æ€§è©•ä¾¡</h4>
                    <div style="color: #e8f5e8;">
                        <div style="margin-bottom: 10px;">
                            <strong>ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯:</strong> 
                            ${memoryGrowth < 1024 * 10 ? 'âœ… ãªã—ï¼ˆå„ªç§€ï¼‰' : memoryGrowth < 1024 * 100 ? 'âš ï¸ è»½å¾®' : 'âŒ è¦æ³¨æ„'}
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>ãƒ¡ãƒ¢ãƒªåŠ¹ç‡:</strong> 
                            ${memoryPerOperation < 100 ? 'âœ… å„ªç§€' : memoryPerOperation < 1000 ? 'âš ï¸ è‰¯å¥½' : 'âŒ æ”¹å–„å¿…è¦'}
                        </div>
                        <div>
                            <strong>ç·åˆè©•ä¾¡:</strong> 
                            ${memoryGrowth < 1024 * 10 && memoryPerOperation < 100 ? 'âœ… å„ªç§€' : 'âš ï¸ æ”¹å–„ä½™åœ°ã‚ã‚Š'}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function updateChart() {
            const chartContainer = document.getElementById('chartContainer');
            
            if (performanceData.samples > 0) {
                chartContainer.innerHTML = `
                    <div style="width: 100%; text-align: center;">
                        <h4 style="color: #81c784; margin-bottom: 20px;">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¦‚è¦</h4>
                        <div style="display: flex; justify-content: space-around; align-items: center; height: 200px;">
                            <div style="text-align: center;">
                                <div style="width: 120px; height: 120px; border-radius: 50%; background: conic-gradient(#4caf50 ${performanceData.coverageRate * 3.6}deg, rgba(255,255,255,0.1) 0); display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;">
                                    <div style="width: 80px; height: 80px; border-radius: 50%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; color: #4caf50; font-weight: bold;">
                                        ${performanceData.coverageRate.toFixed(1)}%
                                    </div>
                                </div>
                                <div style="color: #81c784; font-weight: bold;">ã‚«ãƒãƒ¼ç‡</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 3rem; color: #64b5f6; font-weight: bold; margin-bottom: 10px;">
                                    ${performanceData.uniqueLines}
                                </div>
                                <div style="color: #81c784; font-weight: bold;">ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 3rem; color: #ffb74d; font-weight: bold; margin-bottom: 10px;">
                                    ${(performanceData.totalTime / performanceData.samples).toFixed(1)}ms
                                </div>
                                <div style="color: #81c784; font-weight: bold;">å¹³å‡å‡¦ç†æ™‚é–“</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        // åˆæœŸè¡¨ç¤º
        document.addEventListener('DOMContentLoaded', function() {
            updateChart();
        });
    </script>
</body>
</html>