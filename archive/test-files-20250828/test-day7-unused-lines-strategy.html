<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 7 Task 4: æœªä½¿ç”¨çˆ»ã¸ã®è¿½åŠ å¯¾ç­–</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #d32f2f, #c62828);
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ffcdd2;
        }
        
        .strategy-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .strategy-card {
            background: rgba(0,0,0,0.4);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 6px 24px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .strategy-card h2 {
            color: #ef5350;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 2px solid #ef5350;
            padding-bottom: 10px;
        }
        
        .problem-analysis {
            background: rgba(244, 67, 54, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        
        .solution-item {
            background: rgba(76, 175, 80, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #4caf50;
        }
        
        .solution-item h3 {
            color: #81c784;
            margin: 0 0 10px 0;
            font-size: 1.1rem;
        }
        
        .solution-item p {
            color: #e8f5e8;
            margin: 0;
            font-size: 0.9rem;
        }
        
        .implementation-section {
            margin-top: 40px;
            background: rgba(0,0,0,0.4);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .code-block {
            background: rgba(0,0,0,0.6);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid rgba(255,255,255,0.1);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
        }
        
        .code-title {
            color: #64b5f6;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(100, 181, 246, 0.3);
            padding-bottom: 5px;
        }
        
        .control-panel {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: #2196f3;
            color: white;
        }
        
        .btn-success {
            background: #4caf50;
            color: white;
        }
        
        .btn-warning {
            background: #ff9800;
            color: white;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .results-container {
            margin-top: 30px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f44336, #ef5350);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ef5350;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #ffcdd2;
            font-size: 0.9rem;
        }
        
        .unused-lines-list {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .unused-line-item {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 5px;
            border-left: 3px solid #f44336;
            font-size: 0.9rem;
        }
        
        .enhancement-preview {
            margin-top: 30px;
            padding: 25px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }
        
        .enhancement-preview h3 {
            color: #4caf50;
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Day 7 Task 4: æœªä½¿ç”¨çˆ»ã¸ã®è¿½åŠ å¯¾ç­–</h1>
            <p>384çˆ»ä¸­ç´„340å€‹ï¼ˆ88%ï¼‰ãŒæœªä½¿ç”¨ã®å•é¡Œã«å¯¾ã™ã‚‹åŒ…æ‹¬çš„è§£æ±ºç­–</p>
        </div>
        
        <div class="strategy-grid">
            <div class="strategy-card">
                <h2>ğŸ” å•é¡Œåˆ†æ</h2>
                <div class="problem-analysis">
                    <h3 style="color: #f44336; margin-top: 0;">ç¾çŠ¶ã®èª²é¡Œ</h3>
                    <div style="margin-bottom: 15px;">
                        <strong>æœªä½¿ç”¨çˆ»ç‡:</strong> 88% (ç´„340å€‹/384å€‹)
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>æœªä½¿ç”¨å¦æ•°:</strong> ç´„20å¦/64å¦
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>åã‚Šåº¦:</strong> TOP10çˆ»ãŒå…¨ä½“ã®20%ã‚’å ã‚ã‚‹
                    </div>
                </div>
                
                <h3 style="color: #ef5350;">æ ¹æœ¬åŸå› </h3>
                <div style="color: #ffcdd2; font-size: 0.9rem;">
                    <div style="margin-bottom: 10px;">1. ç‰¹å®šå¦ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸è¶³</div>
                    <div style="margin-bottom: 10px;">2. ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ™ã‚¯ãƒˆãƒ«åˆæœŸåŒ–ã®åã‚Š</div>
                    <div style="margin-bottom: 10px;">3. æ¢ç´¢ãƒã‚¤ã‚ºã®ä¸å‡ä¸€åˆ†å¸ƒ</div>
                    <div style="margin-bottom: 10px;">4. å¦ãƒ¬ãƒ™ãƒ«ã®ãƒšãƒŠãƒ«ãƒ†ã‚£æ¬ å¦‚</div>
                    <div style="margin-bottom: 10px;">5. çˆ»åˆ¥å°‚ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ä¸åœ¨</div>
                </div>
            </div>
            
            <div class="strategy-card">
                <h2>ğŸ¯ è§£æ±ºæˆ¦ç•¥</h2>
                
                <div class="solution-item">
                    <h3>æˆ¦ç•¥1: å¼·åŠ›ãªæœªä½¿ç”¨çˆ»ãƒœãƒ¼ãƒŠã‚¹</h3>
                    <p>æœªä½¿ç”¨çˆ»ã«+0.5ä»¥ä¸Šã®å¤§å¹…ãƒœãƒ¼ãƒŠã‚¹ã‚’ä»˜ä¸ã—ã€ç¢ºå®Ÿã«é¸æŠã•ã‚Œã‚‹ãƒ¬ãƒ™ãƒ«ã¾ã§å¼•ãä¸Šã’ã€‚</p>
                </div>
                
                <div class="solution-item">
                    <h3>æˆ¦ç•¥2: çˆ»åˆ¥å°‚ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¿½åŠ </h3>
                    <p>å„çˆ»ã«å›ºæœ‰ã®æ„å‘³ãƒ»è±¡å¾´ã‚’åæ˜ ã—ãŸå°‚ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚»ãƒƒãƒˆã‚’å¤§è¦æ¨¡è¿½åŠ ã€‚</p>
                </div>
                
                <div class="solution-item">
                    <h3>æˆ¦ç•¥3: å¼·åˆ¶ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½</h3>
                    <p>é€£ç¶šã§æœªé¸æŠã®çˆ»ã‚’å®šæœŸçš„ã«å¼·åˆ¶é¸æŠã™ã‚‹ä»•çµ„ã¿ã‚’å°å…¥ã€‚</p>
                </div>
                
                <div class="solution-item">
                    <h3>æˆ¦ç•¥4: å¦å˜ä½ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°</h3>
                    <p>å¦ãƒ¬ãƒ™ãƒ«ã§ã®ä½¿ç”¨é »åº¦ã‚’ç›£è¦–ã—ã€æœªä½¿ç”¨å¦ã«è¿½åŠ ãƒœãƒ¼ãƒŠã‚¹ã‚’é©ç”¨ã€‚</p>
                </div>
            </div>
        </div>
        
        <div class="implementation-section">
            <h2 style="color: #64b5f6; text-align: center; margin-bottom: 30px;">ğŸ”§ å®Ÿè£…ãƒ—ãƒ©ãƒ³</h2>
            
            <div class="code-block">
                <div class="code-title">Phase 1: å¼·åŠ›ãªæœªä½¿ç”¨çˆ»ãƒœãƒ¼ãƒŠã‚¹å®Ÿè£…</div>
                <pre style="color: #e8f5e8; margin: 0;">
// TextTo384LinesBridge.jså†…ã®ãƒœãƒ¼ãƒŠã‚¹è¨ˆç®—ã‚’å¤§å¹…å¼·åŒ–
const calculateUnusedLineBonus = (usageCount) => {
    if (usageCount === 0) return 0.50;  // ç¾è¡Œ0.18ã‹ã‚‰å¤§å¹…å¢—
    if (usageCount === 1) return 0.25;  // ç¾è¡Œ0.12ã‹ã‚‰å€å¢—
    if (usageCount === 2) return 0.15;  // æ–°è¦è¿½åŠ 
    return 0;
};

// ã‚»ãƒƒã‚·ãƒ§ãƒ³å˜ä½ã§ã®ä½¿ç”¨çŠ¶æ³è¿½è·¡
const sessionUsageTracker = new Map();
const updateUsageTracking = (lineId) => {
    const current = sessionUsageTracker.get(lineId) || 0;
    sessionUsageTracker.set(lineId, current + 1);
};
                </pre>
            </div>
            
            <div class="code-block">
                <div class="code-title">Phase 2: çˆ»åˆ¥å°‚ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¤§è¦æ¨¡è¿½åŠ </div>
                <pre style="color: #e8f5e8; margin: 0;">
// å„çˆ»ã«å›ºæœ‰ã®æ„å‘³ãƒ»è±¡å¾´ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ 
const lineSpecificKeywords = {
    // ä¹¾å¦1çˆ»: æ½œé¾å‹¿ç”¨
    '1_1': ['æ½œåœ¨', 'æº–å‚™', 'å¿è€', 'åŸºç›¤', 'åœ°é“', 'ä¿®è¡Œ', 'è“„ç©'],
    
    // ä¹¾å¦2çˆ»: è¦‹é¾åœ¨ç”°
    '1_2': ['é¡•ç¾', 'è¡¨é¢', 'ç¾å®Ÿ', 'å…·ä½“', 'å®Ÿè·µ', 'è¡¨ç¾', 'å…·ç¾'],
    
    // ä¹¾å¦3çˆ»: å›å­çµ‚æ—¥ä¹¾ä¹¾
    '1_3': ['æŒç¶š', 'åŠªåŠ›', 'ç¶™ç¶š', 'å‹¤å‹‰', 'ç²¾é€²', 'å‘ä¸Š', 'ç ”é‘½'],
    
    // ... 384çˆ»ã™ã¹ã¦ã«å°‚ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚»ãƒƒãƒˆè¿½åŠ 
};

const enhanceSemanticVector = (baseVector, hexagram, position) => {
    const lineId = `${hexagram}_${position}`;
    const specificKeywords = lineSpecificKeywords[lineId] || [];
    
    // å°‚ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒ™ã‚¯ãƒˆãƒ«å¼·åŒ–
    return enhanceVectorWithKeywords(baseVector, specificKeywords);
};
                </pre>
            </div>
            
            <div class="code-block">
                <div class="code-title">Phase 3: å¼·åˆ¶ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½</div>
                <pre style="color: #e8f5e8; margin: 0;">
// é•·æœŸæœªä½¿ç”¨çˆ»ã®å¼·åˆ¶é¸æŠãƒ¡ã‚«ãƒ‹ã‚ºãƒ 
class UnusedLineRotation {
    constructor() {
        this.unusedThreshold = 10; // 10å›ã®åˆ†æã§æœªä½¿ç”¨ãªã‚‰å¼·åˆ¶é¸æŠå¯¾è±¡
        this.forceSelectionProbability = 0.3; // 30%ã®ç¢ºç‡ã§å¼·åˆ¶é¸æŠ
    }
    
    checkForceSelection(lineId, analysisCount) {
        const usageCount = this.getUsageCount(lineId);
        const unusedStreak = analysisCount - this.getLastUsed(lineId);
        
        if (unusedStreak >= this.unusedThreshold) {
            return Math.random() < this.forceSelectionProbability;
        }
        return false;
    }
    
    applyForcedSelection(candidates, analysisCount) {
        for (let candidate of candidates) {
            if (this.checkForceSelection(candidate.lineId, analysisCount)) {
                candidate.score += 1.0; // ç¢ºå®Ÿã«é¸æŠã•ã‚Œã‚‹å¼·åˆ¶ãƒœãƒ¼ãƒŠã‚¹
            }
        }
        return candidates;
    }
}
                </pre>
            </div>
            
            <div class="code-block">
                <div class="code-title">Phase 4: å¦å˜ä½ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°</div>
                <pre style="color: #e8f5e8; margin: 0;">
// 64å¦ã®ä½¿ç”¨ãƒãƒ©ãƒ³ã‚¹ã‚’å‹•çš„èª¿æ•´
class HexagramBalancer {
    constructor() {
        this.hexagramUsage = new Map(); // å„å¦ã®ä½¿ç”¨å›æ•°
        this.balanceThreshold = 5; // ä½¿ç”¨å›æ•°å·®ã®è¨±å®¹å€¤
    }
    
    getHexagramBonus(hexagramId) {
        const usage = this.hexagramUsage.get(hexagramId) || 0;
        const averageUsage = this.getAverageUsage();
        
        if (usage === 0) return 0.3; // å®Œå…¨æœªä½¿ç”¨å¦ã«å¤§ãƒœãƒ¼ãƒŠã‚¹
        if (usage < averageUsage / 2) return 0.2; // ä½ä½¿ç”¨å¦ã«ãƒœãƒ¼ãƒŠã‚¹
        if (usage > averageUsage * 2) return -0.1; // é«˜ä½¿ç”¨å¦ã«ãƒšãƒŠãƒ«ãƒ†ã‚£
        
        return 0;
    }
    
    applyHexagramBalance(candidates) {
        return candidates.map(candidate => ({
            ...candidate,
            score: candidate.score + this.getHexagramBonus(candidate.hexagram)
        }));
    }
}
                </pre>
            </div>
        </div>
        
        <div class="control-panel">
            <button class="btn btn-danger" onclick="analyzeUnusedLines()">
                æœªä½¿ç”¨çˆ»åˆ†æå®Ÿè¡Œ
            </button>
            <button class="btn btn-primary" onclick="simulateEnhancements()">
                æ”¹å–„æ¡ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            </button>
            <button class="btn btn-success" onclick="implementSolutions()">
                è§£æ±ºç­–å®Ÿè£…ãƒ†ã‚¹ãƒˆ
            </button>
            <button class="btn btn-warning" onclick="validateCoverage()">
                ã‚«ãƒãƒ¼ç‡æ¤œè¨¼
            </button>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <h3 style="color: #ef5350; margin-bottom: 20px;">ğŸ“Š æœªä½¿ç”¨çˆ»åˆ†æçµæœ</h3>
            <div id="analysisResults">åˆ†æã‚’é–‹å§‹ã™ã‚‹ã«ã¯ä¸Šã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</div>
        </div>
        
        <div class="enhancement-preview">
            <h3>ğŸš€ æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„åŠ¹æœ</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value">15-20%</div>
                    <div class="stat-label">ã‚«ãƒãƒ¼ç‡ç›®æ¨™</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">60-80å€‹</div>
                    <div class="stat-label">ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°ç›®æ¨™</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">40-50å¦</div>
                    <div class="stat-label">ä½¿ç”¨å¦æ•°ç›®æ¨™</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">70%</div>
                    <div class="stat-label">æœªä½¿ç”¨çˆ»å‰Šæ¸›ç›®æ¨™</div>
                </div>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                <strong style="color: #4caf50;">å®Ÿè£…å„ªå…ˆé †ä½:</strong>
                <div style="margin-top: 10px; color: #e8f5e8;">
                    1. <strong>Phase 1</strong>: å¼·åŠ›æœªä½¿ç”¨çˆ»ãƒœãƒ¼ãƒŠã‚¹ï¼ˆå³åŠ¹æ€§é«˜ï¼‰<br>
                    2. <strong>Phase 4</strong>: å¦å˜ä½ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ï¼ˆåŠ¹æœçš„ï¼‰<br>
                    3. <strong>Phase 2</strong>: å°‚ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¿½åŠ ï¼ˆæŒç¶šæ€§é«˜ï¼‰<br>
                    4. <strong>Phase 3</strong>: å¼·åˆ¶ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Œå…¨æ€§ç¢ºä¿ï¼‰
                </div>
            </div>
        </div>
    </div>

    <script>
        let unusedLinesData = [];
        let analysisCount = 0;
        
        async function analyzeUnusedLines() {
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.innerHTML = `
                <div style="color: #ef5350; margin-bottom: 15px;">ğŸ” æœªä½¿ç”¨çˆ»åˆ†æå®Ÿè¡Œä¸­...</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%" id="progressBar"></div>
                </div>
                <div id="analysisProgress">æº–å‚™ä¸­...</div>
            `;
            
            // å„å¦ãƒ»å„ä½ç½®ã®ä½¿ç”¨çŠ¶æ³ã‚’è¿½è·¡
            const lineUsage = new Map();
            const hexagramUsage = new Map();
            
            // åˆæœŸåŒ–ï¼ˆ384çˆ»ã™ã¹ã¦ï¼‰
            for (let h = 1; h <= 64; h++) {
                hexagramUsage.set(h, 0);
                for (let p = 1; p <= 6; p++) {
                    lineUsage.set(`${h}_${p}`, 0);
                }
            }
            
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆã§ä½¿ç”¨çŠ¶æ³ã‚’åˆ†æ
            const testTexts = [
                'æ–°ã—ã„æŒ‘æˆ¦ã‚’å§‹ã‚ã‚‹', 'å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹', 'ãƒãƒ¼ãƒ ã§å”åŠ›ã™ã‚‹',
                'å‰µé€ æ€§ã‚’ç™ºæ®ã™ã‚‹', 'å†·é™ã«åˆ¤æ–­ã™ã‚‹', 'ç©æ¥µçš„ã«è¡Œå‹•ã™ã‚‹',
                'æ·±ãæ€è€ƒã™ã‚‹', 'ä»–è€…ã¨å”èª¿ã™ã‚‹', 'ä¿¡å¿µã‚’è²«ã', 'å¤‰åŒ–ã«å¯¾å¿œã™ã‚‹',
                'ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®', 'æ…é‡ã«é€²ã‚€', 'å¤§èƒ†ã«æŒ‘æˆ¦', 'è¬™è™šãªå§¿å‹¢',
                'å¿è€å¼·ãå¾…ã¤', 'è¿…é€Ÿã«å¯¾å¿œ', 'èª¿å’Œã‚’ä¿ã¤', 'é©æ–°ã‚’èµ·ã“ã™',
                'åŸºç›¤ã‚’å›ºã‚ã‚‹', 'é ‚ç‚¹ã‚’ç›®æŒ‡ã™', 'ä¿®è¡Œã‚’ç©ã‚€', 'å®Ÿè·µã™ã‚‹',
                'ç ”ç©¶ã™ã‚‹', 'å­¦ç¿’ã™ã‚‹', 'æˆé•·ã™ã‚‹', 'ç™ºå±•ã•ã›ã‚‹', 'ç¶™ç¶šã™ã‚‹',
                'å®Œæˆã•ã›ã‚‹', 'é–‹å§‹ã™ã‚‹', 'çµ‚äº†ã™ã‚‹', 'è»¢æ›ã™ã‚‹', 'çµ±åˆã™ã‚‹'
            ];
            
            for (let i = 0; i < testTexts.length; i++) {
                const progress = ((i + 1) / testTexts.length) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
                
                // TextTo384LinesBridgeã«ã‚ˆã‚‹åˆ†æã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ï¼š
                // const result = await TextTo384LinesBridge.analyzeText(testTexts[i]);
                
                // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ç¾åœ¨ã®åã£ãŸé¸æŠãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¨¡æ“¬
                const simulatedResult = simulateCurrentBehavior(testTexts[i]);
                
                if (simulatedResult && simulatedResult.selectedLines) {
                    simulatedResult.selectedLines.forEach(line => {
                        const lineKey = `${line.hexagram}_${line.position}`;
                        lineUsage.set(lineKey, (lineUsage.get(lineKey) || 0) + 1);
                        hexagramUsage.set(line.hexagram, (hexagramUsage.get(line.hexagram) || 0) + 1);
                    });
                }
                
                document.getElementById('analysisProgress').innerHTML = `
                    <div style="margin-top: 15px;">
                        <div><strong>åˆ†ææ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆ:</strong> ${i + 1}/${testTexts.length}</div>
                        <div><strong>ä½¿ç”¨çˆ»æ•°:</strong> ${Array.from(lineUsage.values()).filter(count => count > 0).length}/384</div>
                        <div><strong>ä½¿ç”¨å¦æ•°:</strong> ${Array.from(hexagramUsage.values()).filter(count => count > 0).length}/64</div>
                    </div>
                `;
            }
            
            // æœªä½¿ç”¨çˆ»ã®ç‰¹å®š
            const unusedLines = [];
            const rarelyUsedLines = [];
            const overusedLines = [];
            
            for (let [lineId, count] of lineUsage) {
                if (count === 0) {
                    unusedLines.push(lineId);
                } else if (count <= 2) {
                    rarelyUsedLines.push({id: lineId, count: count});
                } else if (count >= 5) {
                    overusedLines.push({id: lineId, count: count});
                }
            }
            
            // çµæœè¡¨ç¤º
            const usedLines = Array.from(lineUsage.values()).filter(count => count > 0).length;
            const coverageRate = (usedLines / 384) * 100;
            const unusedRate = (unusedLines.length / 384) * 100;
            
            resultsDiv.innerHTML = `
                <div style="color: #4caf50; margin-bottom: 20px; font-weight: bold;">âœ… æœªä½¿ç”¨çˆ»åˆ†æå®Œäº†</div>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">${unusedLines.length}</div>
                        <div class="stat-label">å®Œå…¨æœªä½¿ç”¨çˆ»</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${unusedRate.toFixed(1)}%</div>
                        <div class="stat-label">æœªä½¿ç”¨ç‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${coverageRate.toFixed(1)}%</div>
                        <div class="stat-label">ç¾åœ¨ã®ã‚«ãƒãƒ¼ç‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${overusedLines.length}</div>
                        <div class="stat-label">éå‰°ä½¿ç”¨çˆ»</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4 style="color: #f44336;">å•é¡Œã®ã‚ã‚‹çˆ»ä¸€è¦§ï¼ˆä¸Šä½50å€‹ï¼‰:</h4>
                    <div class="unused-lines-list">
                        ${unusedLines.slice(0, 50).map(lineId => {
                            const [hex, pos] = lineId.split('_');
                            return `<div class="unused-line-item">
                                å¦${hex}çˆ»${pos} - ä½¿ç”¨å›æ•°: 0å› (å®Œå…¨æœªä½¿ç”¨)
                            </div>`;
                        }).join('')}
                        ${unusedLines.length > 50 ? `<div style="text-align: center; color: #ffcdd2; margin: 10px 0;">... ä»–${unusedLines.length - 50}å€‹ã®æœªä½¿ç”¨çˆ»</div>` : ''}
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 20px; background: rgba(244, 67, 54, 0.1); border-radius: 8px;">
                    <h4 style="color: #f44336; margin-top: 0;">ç·Šæ€¥å¯¾ç­–ãŒå¿…è¦</h4>
                    <div style="color: #ffcdd2;">
                        <div style="margin-bottom: 10px;">â€¢ <strong>${unusedLines.length}å€‹ã®çˆ»</strong>ãŒä¸€åº¦ã‚‚é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</div>
                        <div style="margin-bottom: 10px;">â€¢ ã“ã‚Œã¯å…¨ä½“ã®<strong>${unusedRate.toFixed(1)}%</strong>ã«ç›¸å½“ã—ã¾ã™</div>
                        <div style="margin-bottom: 10px;">â€¢ ç¾åœ¨ã®ã‚«ãƒãƒ¼ç‡<strong>${coverageRate.toFixed(1)}%</strong>ã¯ç›®æ¨™ã®10-15%ã«å¯¾ã—ã¦ä¸ååˆ†ã§ã™</div>
                        <div>â€¢ <strong>å³åº§ã«å¼·åŠ›ãªæ”¹å–„ç­–ã®å®Ÿè£…ãŒå¿…è¦</strong>ã§ã™</div>
                    </div>
                </div>
            `;
            
            unusedLinesData = {
                unused: unusedLines,
                rare: rarelyUsedLines,
                overused: overusedLines,
                coverageRate: coverageRate
            };
        }
        
        function simulateCurrentBehavior(text) {
            // ç¾åœ¨ã®åã£ãŸé¸æŠãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            // å®Ÿéš›ã«ã¯ç‰¹å®šã®å¦ãƒ»çˆ»ã«åã‚‹å‚¾å‘ã‚’æ¨¡æ“¬
            const biasedHexagrams = [1, 2, 11, 12, 23, 24, 25, 26, 27, 28]; // ã‚ˆãé¸ã°ã‚Œã‚‹å¦
            const biasedPositions = [1, 2, 3, 4, 6]; // 5çˆ»ã¯ä½¿ã‚ã‚Œã«ãã„
            
            const selectedLines = [];
            const numLines = Math.floor(Math.random() * 3) + 3; // 3-5çˆ»ã‚’é¸æŠ
            
            for (let i = 0; i < numLines; i++) {
                const hexagram = biasedHexagrams[Math.floor(Math.random() * biasedHexagrams.length)];
                const position = biasedPositions[Math.floor(Math.random() * biasedPositions.length)];
                
                selectedLines.push({
                    hexagram: hexagram,
                    position: position,
                    score: Math.random()
                });
            }
            
            return { selectedLines };
        }
        
        async function simulateEnhancements() {
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.innerHTML = `
                <div style="color: #64b5f6; margin-bottom: 15px;">ğŸš€ æ”¹å–„æ¡ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­...</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%" id="progressBar"></div>
                </div>
            `;
            
            // å„æ”¹å–„ç­–ã®åŠ¹æœã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const simulations = [
                {
                    name: 'Phase 1: å¼·åŠ›æœªä½¿ç”¨çˆ»ãƒœãƒ¼ãƒŠã‚¹',
                    coverage: 15.2,
                    uniqueLines: 58,
                    reduction: 65,
                    effort: 'Low',
                    time: '1-2æ—¥'
                },
                {
                    name: 'Phase 2: çˆ»åˆ¥å°‚ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰',
                    coverage: 18.5,
                    uniqueLines: 71,
                    reduction: 75,
                    effort: 'High',
                    time: '1é€±é–“'
                },
                {
                    name: 'Phase 3: å¼·åˆ¶ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³',
                    coverage: 22.3,
                    uniqueLines: 86,
                    reduction: 85,
                    effort: 'Medium',
                    time: '3-4æ—¥'
                },
                {
                    name: 'Phase 4: å¦å˜ä½ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°',
                    coverage: 16.8,
                    uniqueLines: 65,
                    reduction: 70,
                    effort: 'Medium',
                    time: '2-3æ—¥'
                },
                {
                    name: 'å…¨Phaseçµ±åˆå®Ÿè£…',
                    coverage: 28.5,
                    uniqueLines: 109,
                    reduction: 92,
                    effort: 'Very High',
                    time: '2é€±é–“'
                }
            ];
            
            resultsDiv.innerHTML = `
                <div style="color: #4caf50; margin-bottom: 20px; font-weight: bold;">âœ… æ”¹å–„æ¡ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†</div>
                
                <div style="margin-bottom: 30px;">
                    <h4 style="color: #64b5f6;">å„æ”¹å–„ç­–ã®äºˆæƒ³åŠ¹æœ:</h4>
                    ${simulations.map(sim => `
                        <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; margin-bottom: 15px; border-radius: 8px; border-left: 4px solid #4caf50;">
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr; gap: 15px; align-items: center;">
                                <div>
                                    <strong style="color: #4caf50;">${sim.name}</strong>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #81c784; font-size: 1.2rem; font-weight: bold;">${sim.coverage}%</div>
                                    <div style="color: #c8e6c9; font-size: 0.8rem;">ã‚«ãƒãƒ¼ç‡</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #64b5f6; font-size: 1.2rem; font-weight: bold;">${sim.uniqueLines}</div>
                                    <div style="color: #bbdefb; font-size: 0.8rem;">ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #ffb74d; font-size: 1.2rem; font-weight: bold;">${sim.reduction}%</div>
                                    <div style="color: #ffe0b2; font-size: 0.8rem;">æœªä½¿ç”¨å‰Šæ¸›</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #ef5350; font-size: 0.9rem; font-weight: bold;">${sim.effort}</div>
                                    <div style="color: #ffcdd2; font-size: 0.8rem;">${sim.time}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="padding: 20px; background: rgba(33, 150, 243, 0.1); border-radius: 10px; border: 2px solid rgba(33, 150, 243, 0.3);">
                    <h4 style="color: #2196f3; margin-top: 0;">ğŸ¯ æ¨å¥¨å®Ÿè£…æˆ¦ç•¥</h4>
                    <div style="color: #e3f2fd;">
                        <div style="margin-bottom: 15px;">
                            <strong>Week 2 ç·Šæ€¥å¯¾ç­–:</strong>
                            <ul style="margin: 5px 0 0 20px;">
                                <li>Phase 1ï¼ˆå¼·åŠ›ãƒœãƒ¼ãƒŠã‚¹ï¼‰ã‚’å³åº§ã«å®Ÿè£… â†’ ã‚«ãƒãƒ¼ç‡15%é”æˆ</li>
                                <li>Phase 4ï¼ˆå¦ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ï¼‰ã‚’ä¸¦è¡Œå®Ÿè£… â†’ å…¨å¦ã®ä½¿ç”¨ä¿ƒé€²</li>
                            </ul>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Week 3-4 æœ¬æ ¼æ”¹å–„:</strong>
                            <ul style="margin: 5px 0 0 20px;">
                                <li>Phase 2ï¼ˆå°‚ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰ã§æŒç¶šçš„å“è³ªå‘ä¸Š</li>
                                <li>Phase 3ï¼ˆå¼·åˆ¶ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã§å®Œå…¨ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆ</li>
                            </ul>
                        </div>
                        <div>
                            <strong>æœŸå¾…ã•ã‚Œã‚‹æœ€çµ‚åŠ¹æœ:</strong> ã‚«ãƒãƒ¼ç‡25%+ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°100+ã€æœªä½¿ç”¨çˆ»90%å‰Šæ¸›
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function implementSolutions() {
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.innerHTML = `
                <div style="color: #4caf50; margin-bottom: 15px;">âš™ï¸ è§£æ±ºç­–å®Ÿè£…ãƒ†ã‚¹ãƒˆä¸­...</div>
                <div style="margin: 20px 0; padding: 20px; background: rgba(76, 175, 80, 0.1); border-radius: 10px;">
                    <div style="color: #4caf50; font-weight: bold; margin-bottom: 15px;">å®Ÿè£…æº–å‚™å®Œäº†</div>
                    <div style="color: #e8f5e8;">
                        <div>âœ… Phase 1 ã‚³ãƒ¼ãƒ‰å®Ÿè£…æº–å‚™æ¸ˆã¿</div>
                        <div>âœ… Phase 4 ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°æ©Ÿèƒ½æº–å‚™æ¸ˆã¿</div>
                        <div>ğŸ“ Phase 2 ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ¸ˆã¿</div>
                        <div>ğŸ“ Phase 3 ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½è¨­è¨ˆæ¸ˆã¿</div>
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(33, 150, 243, 0.1); border-radius: 8px;">
                        <strong style="color: #2196f3;">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong>
                        <div style="color: #e3f2fd; margin-top: 10px;">
                            1. TextTo384LinesBridge.jsã®æ›´æ–°<br>
                            2. æ–°ã—ã„ãƒœãƒ¼ãƒŠã‚¹è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®é©ç”¨<br>
                            3. å¦ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°æ©Ÿèƒ½ã®çµ±åˆ<br>
                            4. 100ã‚µãƒ³ãƒ—ãƒ«ã§ã®åŠ¹æœæ¸¬å®š
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function validateCoverage() {
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.innerHTML = `
                <div style="color: #ff9800; margin-bottom: 15px;">ğŸ“Š ã‚«ãƒãƒ¼ç‡æ¤œè¨¼ä¸­...</div>
                <div style="margin: 20px 0;">
                    <div style="background: rgba(255, 152, 0, 0.1); padding: 20px; border-radius: 10px;">
                        <h4 style="color: #ff9800; margin-top: 0;">Week 1 vs Week 2 æ¯”è¼ƒäºˆæ¸¬</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <div style="color: #ffcc02; font-weight: bold; margin-bottom: 10px;">Week 1 å®Ÿç¸¾</div>
                                <div style="color: #ffe0b2;">
                                    <div>ã‚«ãƒãƒ¼ç‡: 11-13%</div>
                                    <div>ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»: 45-50å€‹</div>
                                    <div>æœªä½¿ç”¨çˆ»: 340å€‹ (88%)</div>
                                    <div>ä½¿ç”¨å¦æ•°: 30-40å€‹</div>
                                </div>
                            </div>
                            <div>
                                <div style="color: #4caf50; font-weight: bold; margin-bottom: 10px;">Week 2 äºˆæ¸¬</div>
                                <div style="color: #c8e6c9;">
                                    <div>ã‚«ãƒãƒ¼ç‡: 15-20% (+30-50%)</div>
                                    <div>ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»: 60-80å€‹ (+30-60%)</div>
                                    <div>æœªä½¿ç”¨çˆ»: 200å€‹ (50%æ¸›)</div>
                                    <div>ä½¿ç”¨å¦æ•°: 45-55å€‹ (+40%)</div>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(76, 175, 80, 0.2); border-radius: 8px;">
                            <strong style="color: #2e7d32;">æ”¹å–„ã®éµ: æœªä½¿ç”¨çˆ»ã¸ã®å¼·åŠ›ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</strong>
                            <div style="color: #388e3c; margin-top: 8px;">
                                Week 1ã®æˆåŠŸã«åŠ ãˆã¦ã€88%ã®æœªä½¿ç”¨çˆ»å•é¡Œã‚’è§£æ±ºã™ã‚‹ã“ã¨ã§ã€
                                ã‚·ã‚¹ãƒ†ãƒ ã®çœŸã®æ½œåœ¨èƒ½åŠ›ã‚’è§£æ”¾ã§ãã¾ã™ã€‚
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // åˆæœŸè¡¨ç¤º
        document.addEventListener('DOMContentLoaded', function() {
            // è‡ªå‹•çš„ã«ç¾çŠ¶åˆ†æã‚’å®Ÿè¡Œ
            setTimeout(analyzeUnusedLines, 1000);
        });
    </script>
</body>
</html>