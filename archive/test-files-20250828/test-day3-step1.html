<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Day 3 Step 1 - 2çˆ»/6çˆ»åã‚Šæ˜¯æ­£åŠ¹æœæ¸¬å®š</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            padding: 20px; 
            background: #1e1e1e; 
            color: #d4d4d4;
        }
        h1 { color: #4ec9b0; }
        .summary { 
            background: #2d2d30; 
            padding: 15px; 
            margin: 20px 0;
            border-radius: 5px;
        }
        .improved { color: #4ec9b0; font-weight: bold; }
        .warning { color: #dcdcaa; }
        .bad { color: #f48771; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #3c3c3c;
        }
        th { background: #252526; }
        .comparison {
            display: flex;
            justify-content: space-between;
        }
        .before, .after {
            width: 48%;
        }
        .deviation-bar {
            display: inline-block;
            height: 15px;
            margin-left: 10px;
        }
        .deviation-positive { background: #f48771; }
        .deviation-negative { background: #569cd6; }
        .deviation-normal { background: #4ec9b0; }
    </style>
</head>
<body>
    <h1>Day 3 Step 1 - 2çˆ»/6çˆ»åã‚Šæ˜¯æ­£åŠ¹æœæ¸¬å®š</h1>
    
    <div class="summary">
        <h2>ğŸ“‹ å®Ÿæ–½å†…å®¹</h2>
        <ul>
            <li>2çˆ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: 25å€‹ â†’ 15å€‹ï¼ˆ-10å€‹ï¼‰</li>
            <li>2çˆ»é‡ã¿: 0.48 â†’ 0.43ï¼ˆ-0.05ï¼‰</li>
            <li>6çˆ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: 26å€‹ â†’ 15å€‹ï¼ˆ-11å€‹ï¼‰</li>
            <li>6çˆ»é‡ã¿: 0.45 â†’ 0.40ï¼ˆ-0.05ï¼‰</li>
        </ul>
    </div>
    
    <div id="results"></div>
    
    <script type="module">
        import { TextTo384LinesBridge } from './public/js/ai/TextTo384LinesBridge.js';
        
        // ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«ï¼ˆãƒãƒ©ãƒ³ã‚¹ç¢ºèªç”¨ï¼‰
        const testSamples = {
            neutral: [
                "æ—¥å¸¸çš„ãªæ¥­å‹™ã‚’é€²ã‚ã‚‹",
                "é€šå¸¸ã®ä½œæ¥­ã‚’ç¶™ç¶š",
                "å¹³å¸¸å¿ƒã‚’ä¿ã¤",
                "æ¨™æº–çš„ãªå¯¾å¿œã‚’è¡Œã†",
                "ä¸€èˆ¬çš„ãªå‡¦ç†ã‚’å®Ÿæ–½"
            ],
            position1: [
                "æ–°ã—ã„æŒ‘æˆ¦ã‚’å§‹ã‚ã‚‹æ™‚æœŸ",
                "ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹ã«ç«‹ã¤",
                "åˆå¿ƒè€…ã¨ã—ã¦å­¦ã³å§‹ã‚ã‚‹",
                "åŸºç¤ã‹ã‚‰ç©ã¿ä¸Šã’ã¦ã„ã",
                "ç¬¬ä¸€æ­©ã‚’è¸ã¿å‡ºã™"
            ],
            position2: [
                "å”åŠ›ã—ã¦é€²ã‚ã‚‹æ®µéš",
                "ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ç™ºæ®",
                "å†…é¢ã¨å‘ãåˆã†æ™‚é–“",
                "ã‚µãƒãƒ¼ãƒˆã™ã‚‹ç«‹å ´",
                "ç›¸è«‡ã«ä¹—ã‚‹å½¹å‰²"
            ],
            position3: [
                "å›°é›£ã«ç›´é¢ã™ã‚‹æ™‚",
                "è©¦ç·´ã‚’ä¹—ã‚Šè¶Šãˆã‚‹",
                "å•é¡Œè§£æ±ºã«å–ã‚Šçµ„ã‚€",
                "æŒ‘æˆ¦çš„ãªèª²é¡Œã«å¯¾å¿œ",
                "å£ã‚’çªç ´ã™ã‚‹å¿…è¦"
            ],
            position4: [
                "å¤‰åŒ–ã®æ™‚æœŸã‚’è¿ãˆã‚‹",
                "è»¢æ›ç‚¹ã§ã®æ±ºæ–­",
                "æ–¹å‘è»¢æ›ãŒå¿…è¦",
                "ç§»è¡ŒæœŸã§ã®å¯¾å¿œ",
                "é¸æŠã‚’è¿«ã‚‰ã‚Œã‚‹"
            ],
            position5: [
                "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®",
                "éƒ¨é•·ã¨ã—ã¦åˆ¤æ–­ã™ã‚‹",
                "çµ±æ‹¬çš„ã«ç®¡ç†",
                "è²¬ä»»è€…ã¨ã—ã¦æ±ºå®š",
                "ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ç«‹å ´"
            ],
            position6: [
                "å®Œæˆã«å‘ã‘ãŸæœ€çµ‚æ®µéš",
                "ä»•ä¸Šã’ã®ä½œæ¥­",
                "çµ‚äº†é–“è¿‘ã®çŠ¶æ…‹",
                "ç· ã‚ããã‚Šã®æ™‚æœŸ",
                "æœ€çµ‚çš„ãªçµæœã‚’å‡ºã™"
            ]
        };
        
        async function runTest() {
            const bridge = new TextTo384LinesBridge();
            await bridge.initialize();
            
            const results = {
                total: 0,
                positions: [0, 0, 0, 0, 0, 0, 0],
                categoryBreakdown: {},
                improvements: {
                    position2: { before: 20, after: 0 },
                    position6: { before: 20, after: 0 }
                }
            };
            
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ†ã‚¹ãƒˆ
            for (const [category, samples] of Object.entries(testSamples)) {
                results.categoryBreakdown[category] = {
                    positions: [0, 0, 0, 0, 0, 0, 0],
                    samples: []
                };
                
                for (const text of samples) {
                    const result = await bridge.analyzeText(text);
                    results.total++;
                    results.positions[result.line_position]++;
                    results.categoryBreakdown[category].positions[result.line_position]++;
                    results.categoryBreakdown[category].samples.push({
                        text: text,
                        position: result.line_position
                    });
                }
            }
            
            // æ”¹å–„ç‡è¨ˆç®—
            results.improvements.position2.after = 
                (results.positions[2] / results.total * 100).toFixed(1);
            results.improvements.position6.after = 
                (results.positions[6] / results.total * 100).toFixed(1);
            
            displayResults(results);
        }
        
        function displayResults(results) {
            let html = '';
            const ideal = 16.67;
            
            // æ”¹å–„çµæœã‚µãƒãƒªãƒ¼
            html += '<div class="summary">';
            html += '<h2>ğŸ¯ åã‚Šæ˜¯æ­£çµæœ</h2>';
            html += '<div class="comparison">';
            
            // Before/Afteræ¯”è¼ƒ
            html += '<div class="before">';
            html += '<h3>æ”¹å–„å‰ï¼ˆæ¨å®šå€¤ï¼‰</h3>';
            html += '<p>2çˆ»: ç´„20% (éå¤š)</p>';
            html += '<p>6çˆ»: ç´„20% (éå¤š)</p>';
            html += '</div>';
            
            html += '<div class="after">';
            html += '<h3>æ”¹å–„å¾Œï¼ˆå®Ÿæ¸¬å€¤ï¼‰</h3>';
            const pos2Class = Math.abs(parseFloat(results.improvements.position2.after) - ideal) <= 3 ? 'improved' : 'warning';
            const pos6Class = Math.abs(parseFloat(results.improvements.position6.after) - ideal) <= 3 ? 'improved' : 'warning';
            html += `<p class="${pos2Class}">2çˆ»: ${results.improvements.position2.after}%</p>`;
            html += `<p class="${pos6Class}">6çˆ»: ${results.improvements.position6.after}%</p>`;
            html += '</div>';
            html += '</div>';
            html += '</div>';
            
            // å…¨ä½“åˆ†å¸ƒ
            html += '<div class="summary">';
            html += '<h2>ğŸ“Š ä½ç½®åˆ¥åˆ†å¸ƒï¼ˆå…¨ä½“ï¼‰</h2>';
            html += '<table>';
            html += '<tr><th>ä½ç½®</th><th>å›æ•°</th><th>å‰²åˆ</th><th>ç†æƒ³å€¤ã¨ã®å·®</th><th>è©•ä¾¡</th></tr>';
            
            for (let i = 1; i <= 6; i++) {
                const count = results.positions[i];
                const percent = (count / results.total * 100).toFixed(1);
                const deviation = (parseFloat(percent) - ideal).toFixed(1);
                
                let evalClass = 'improved';
                let evalText = 'è‰¯å¥½';
                if (Math.abs(deviation) > 5) {
                    evalClass = 'warning';
                    evalText = 'è¦èª¿æ•´';
                } else if (Math.abs(deviation) > 10) {
                    evalClass = 'bad';
                    evalText = 'å•é¡Œ';
                }
                
                html += '<tr>';
                html += `<td>${i}çˆ»</td>`;
                html += `<td>${count}</td>`;
                html += `<td>${percent}%</td>`;
                html += `<td>${deviation > 0 ? '+' : ''}${deviation}%</td>`;
                html += `<td class="${evalClass}">${evalText}</td>`;
                html += '</tr>';
            }
            html += '</table>';
            html += '</div>';
            
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥åå¿œ
            html += '<div class="summary">';
            html += '<h2>ğŸ“‹ ã‚«ãƒ†ã‚´ãƒªåˆ¥åå¿œ</h2>';
            html += '<table>';
            html += '<tr><th>ã‚«ãƒ†ã‚´ãƒª</th><th>1çˆ»</th><th>2çˆ»</th><th>3çˆ»</th><th>4çˆ»</th><th>5çˆ»</th><th>6çˆ»</th></tr>';
            
            for (const [category, data] of Object.entries(results.categoryBreakdown)) {
                html += '<tr>';
                html += `<td>${category}</td>`;
                for (let i = 1; i <= 6; i++) {
                    const count = data.positions[i];
                    const cellClass = count > 2 ? 'warning' : count > 0 ? '' : '';
                    html += `<td class="${cellClass}">${count}</td>`;
                }
                html += '</tr>';
            }
            html += '</table>';
            html += '</div>';
            
            // è©•ä¾¡
            html += '<div class="summary">';
            html += '<h2>ğŸ’¡ è©•ä¾¡ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h2>';
            
            const pos2Improved = Math.abs(parseFloat(results.improvements.position2.after) - ideal) < 5;
            const pos6Improved = Math.abs(parseFloat(results.improvements.position6.after) - ideal) < 5;
            
            if (pos2Improved && pos6Improved) {
                html += '<p class="improved">âœ… 2çˆ»/6çˆ»ã®åã‚Šæ˜¯æ­£ã«æˆåŠŸï¼</p>';
            } else {
                html += '<p class="warning">âš ï¸ ã¾ã èª¿æ•´ãŒå¿…è¦ã§ã™</p>';
            }
            
            html += '<h3>æ¬¡ã®ã‚¿ã‚¹ã‚¯ï¼ˆ3-7ï½3-9ï¼‰</h3>';
            html += '<ul>';
            html += '<li>3çˆ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¿½åŠ ï¼ˆä¸è¶³å‚¾å‘æ”¹å–„ï¼‰</li>';
            html += '<li>4çˆ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¿½åŠ ï¼ˆä¸è¶³å‚¾å‘æ”¹å–„ï¼‰</li>';
            html += '<li>3çˆ»/4çˆ»é‡ã¿èª¿æ•´ï¼ˆå¼·åŒ–ï¼‰</li>';
            html += '</ul>';
            html += '</div>';
            
            document.getElementById('results').innerHTML = html;
        }
        
        runTest();
    </script>
</body>
</html>