import { readFile, writeFile } from 'fs/promises';

async function fixPhase15FinalEight() {
  try {
    console.log('=== フェーズ15: 最終8文字212件を一行一行修正 ===\n');
    
    // データベース読み込み
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // 8文字の説明を一行一行丁寧に修正（212件）
    const eightCharFixes = {
      // 人々・仲間系
      '"挑戦心のある人々"': '"挑戦心を持つ勇敢な人々"',
      '"熱い心を持つ人々"': '"熱い心を持つ情熱的な人々"',
      '"感情豊かな人々"': '"感情豊かで繊細な人々"',
      '"継続的な人々"': '"継続力のある粘り強い人々"',
      '"限界に挑む人々"': '"限界に挑む勇敢な人々"',
      '"未来志向の人々"': '"未来志向の前向きな人々"',
      '"目標を持つ人々"': '"明確な目標を持つ人々"',
      '"楽しさを共有する人"': '"楽しさを共有できる人"',
      '"向上心のある人々"': '"向上心の高い人々"',
      '"挑戦を支える人々"': '"挑戦を支援する人々"',
      '"楽しい気持ちの人々"': '"楽しい気持ちを持つ人々"',
      '"安定を求める人々"': '"安定を重視する人々"',
      '"変化を楽しむ人々"': '"変化を楽しめる柔軟な人々"',
      
      // 活動・行動系
      '"瞑想、静寂、停滞"': '"瞑想と静寂で心を整える"',
      '"流れを止めて充電"': '"流れを止めて充電する時間"',
      '"適応、調整、浸透"': '"適応し調整しながら浸透する"',
      '"形を変えて逃げる"': '"形を柔軟に変えて逃げる"',
      '"直接対決を避ける"': '"直接対決を賢く避ける"',
      '"情熱を注げる何か"': '"情熱を注げる対象を見つける"',
      '"燃え尽きてしまう"': '"燃え尽きてしまいやすい"',
      '"情熱を注ぎ続ける"': '"情熱を注ぎ続ける力"',
      '"創造と破壊を繰り返す"': '"創造と破壊を繰り返す"',
      '"前進し続ける"': '"着実に前進し続ける"',
      '"加速的に成長"': '"加速的に成長していく"',
      '"突き進む勇気"': '"突き進む勇気を持つ"',
      '"爆発的な行動"': '"爆発的な行動力を発揮"',
      '"衝動的に動く"': '"衝動的に動いてしまう"',
      '"動き続ける"': '"常に動き続ける姿勢"',
      
      // 環境・場所系
      '"自由な流れと変化"': '"自由な流れと変化がある環境"',
      '"燃える対象と燃料"': '"燃える対象と燃料となるもの"',
      '"情熱を燃やせる場"': '"情熱を燃やせる場所"',
      '"感覚を研ぎ澄ます場"': '"感覚を研ぎ澄ませる場"',
      '"継続を促す環境"': '"継続を促進する環境"',
      '"突破を促す環境"': '"突破を促進する環境"',
      '"過去を大切にする場"': '"過去を大切にする場所"',
      '"適切な配置の場"': '"適切な配置ができる場"',
      '"内省を深める場"': '"内省を深められる場所"',
      '"個性を認める場"': '"個性を認め合える場"',
      '"違いを活かす場"': '"違いを活かせる場所"',
      '"長期的な活動の場"': '"長期的な活動ができる場"',
      '"自由を尊重する場"': '"自由を尊重する場所"',
      '"奉仕の精神ある場"': '"奉仕の精神がある場所"',
      '"益を生む環境"': '"益を生み出す生産的環境"',
      '"成長できる環境"': '"継続的に成長できる環境"',
      '"安全な環境"': '"心理的に安全な環境"',
      '"決断しやすい環境"': '"決断しやすい環境"',
      '"エネルギーが集まる場"': '"エネルギーが集まる場所"',
      '"交流が活発な場"': '"交流が活発で楽しい場"',
      '"完成を支援する環境"': '"完成を支援する環境"',
      '"バランスの良い環境"': '"バランスの取れた環境"',
      '"細やかな配慮の場"': '"細やかな配慮がある場"',
      '"大胆な挑戦の場"': '"大胆な挑戦ができる場"',
      '"変革を起こす場"': '"変革を起こせる場所"',
      '"安定を保つ環境"': '"安定を保てる環境"',
      '"流動的な変化の場"': '"流動的に変化する場"',
      
      // コミュニケーション系
      '"冷静な分析、客観性"': '"冷静な分析と客観性が苦手"',
      '"静寂、暗闇、無刺激"': '"静寂と暗闇で心を休める"',
      '"共感、察知、気配り"': '"共感と察知と気配りが得意"',
      '"議論、対立、批判"': '"議論や対立や批判が苦手"',
      '"雑談、世間話、噂話"': '"雑談や世間話が苦手"',
      '"批判、否定、攻撃"': '"批判や否定や攻撃が苦手"',
      '"理論、抽象、概念"': '"理論や抽象概念が苦手"',
      '"感情論、主観、偏見"': '"感情論や主観が苦手"',
      '"建前、社交辞令"': '"建前や社交辞令が苦手"',
      '"命令、強制、圧力"': '"命令や強制が苦手"',
      '"依存、甘え、要求"': '"依存や甘えが苦手"',
      
      // 能力・強み系
      '"適応力と柔軟性"': '"高い適応力と柔軟性"',
      '"情熱的な表現力"': '"情熱的で豊かな表現力"',
      '"感覚的な理解力"': '"優れた感覚的理解力"',
      '"継続する力"': '"物事を継続する力"',
      '"突破力の高さ"': '"突破力の高さが強み"',
      '"経験の蓄積"': '"経験を着実に蓄積"',
      '"空間把握能力"': '"優れた空間把握能力"',
      '"内省的な深さ"': '"内省的な深い思考"',
      '"独創性の高さ"': '"独創性の高さが強み"',
      '"統合力の高さ"': '"統合力の高さが強み"',
      '"持久力の高さ"': '"持久力の高さが強み"',
      '"解放的な発想"': '"解放的で自由な発想"',
      '"奉仕の精神"': '"奉仕の精神を持つ"',
      '"生産性の高さ"': '"生産性の高さが強み"',
      '"発展的な思考"': '"発展的で前向きな思考"',
      '"危機察知能力"': '"優れた危機察知能力"',
      '"決断の速さ"': '"決断の速さが強み"',
      '"拡散的な思考"': '"拡散的で創造的思考"',
      '"求心力の高さ"': '"求心力の高さが強み"',
      '"社交性の高さ"': '"社交性の高さが強み"',
      '"完成への執着"': '"完成への強い執着"',
      '"調整力の高さ"': '"調整力の高さが強み"',
      '"繊細な感受性"': '"繊細で豊かな感受性"',
      '"大胆な行動力"': '"大胆な行動力を持つ"',
      '"変革への意欲"': '"変革への強い意欲"',
      '"安定性の高さ"': '"安定性の高さが強み"',
      '"流動的な対応"': '"流動的で柔軟な対応"',
      
      // 回復・充電系
      '"流れに身を任せる"': '"流れに身を任せて回復"',
      '"情熱を再燃させる"': '"情熱を再燃させて回復"',
      '"感覚を休める"': '"感覚を休めて回復する"',
      '"継続を再開する"': '"継続を再開して回復"',
      '"突破口を見つける"': '"突破口を見つけて回復"',
      '"過去を振り返る"': '"過去を振り返って回復"',
      '"位置を調整する"': '"位置を調整して回復"',
      '"内省を深める"': '"内省を深めて回復する"',
      '"個性を発揮する"': '"個性を発揮して回復"',
      '"違いを受け入れる"': '"違いを受け入れて回復"',
      '"長期的に取り組む"': '"長期的に取り組んで回復"',
      '"自由を感じる"': '"自由を感じて回復する"',
      '"与えることで回復"': '"与えることで心が回復"',
      '"益を生み出す"': '"益を生み出して回復"',
      '"成長を実感する"': '"成長を実感して回復"',
      '"危機を回避する"': '"危機を回避して回復"',
      '"決断を下す"': '"決断を下して前進する"',
      '"エネルギーを拡散"': '"エネルギーを拡散して回復"',
      '"人を集める"': '"人を集めて力を得る"',
      '"交流を楽しむ"': '"交流を楽しんで回復"',
      '"完成させる"': '"物事を完成させて満足"',
      '"バランスを取る"': '"バランスを取って回復"',
      '"細部を整える"': '"細部を整えて回復する"',
      '"大胆になる"': '"大胆になって突破する"',
      '"変革を起こす"': '"変革を起こして前進"',
      '"安定を保つ"': '"安定を保って回復する"',
      '"変化を受け入れる"': '"変化を受け入れて成長"',
      
      // 状態・傾向系
      '"流されやすい"': '"周りに流されやすい"',
      '"感情的になりやすい"': '"感情的になりやすい傾向"',
      '"感覚が麻痺する"': '"感覚が麻痺しやすい"',
      '"マンネリ化する"': '"マンネリ化しやすい"',
      '"破壊的になる"': '"破壊的になりやすい"',
      '"過去に囚われる"': '"過去に囚われやすい"',
      '"位置を見失う"': '"位置を見失いやすい"',
      '"引きこもる"': '"引きこもりがちになる"',
      '"孤立しやすい"': '"周りから孤立しやすい"',
      '"対立を生む"': '"対立を生みやすい"',
      '"疲れやすい"': '"心身ともに疲れやすい"',
      '"責任感が薄い"': '"責任感が薄くなりがち"',
      '"損をしやすい"': '"損をしやすい傾向"',
      '"無駄が多い"': '"無駄が多くなりがち"',
      '"過度に拡大する"': '"過度に拡大しやすい"',
      '"楽観的すぎる"': '"楽観的すぎる傾向"',
      '"優柔不断になる"': '"優柔不断になりやすい"',
      '"散漫になる"': '"注意が散漫になりやすい"',
      '"孤独を感じる"': '"孤独を感じやすい"',
      '"浅い関係になる"': '"関係が浅くなりがち"',
      '"未完成になる"': '"物事が未完成になりがち"',
      '"極端になる"': '"極端になりやすい"',
      '"神経質になる"': '"神経質になりやすい"',
      '"無謀になる"': '"無謀になりやすい"',
      '"保守的になる"': '"保守的になりやすい"',
      '"硬直化する"': '"思考が硬直化しやすい"',
      '"不安定になる"': '"精神的に不安定になりやすい"',
      
      // その他の重要な8文字
      '"明るく振る舞う"': '"明るく振る舞うことで回復"',
      '"笑顔を忘れない"': '"笑顔を忘れずに過ごす"',
      '"楽しむことが大切"': '"楽しむことが何より大切"',
      '"信頼関係の構築"': '"信頼関係を着実に構築"',
      '"関係性の深化"': '"関係性を深化させる"',
      '"絆を深める"': '"絆を着実に深める"',
      '"つながりを大切に"': '"つながりを大切にする"',
      '"ネットワークを活用"': '"ネットワークを最大限活用"',
      '"影響力を高める"': '"影響力を着実に高める"',
      '"存在感を示す"': '"存在感を確実に示す"',
      '"価値を提供する"': '"高い価値を提供する"',
      '"意味を見出す"': '"活動に意味を見出す"',
      '"目的を明確に"': '"目的を明確にする"',
      '"ビジョンを描く"': '"明確なビジョンを描く"',
      '"未来を創造する"': '"より良い未来を創造する"',
      '"希望を持ち続ける"': '"希望を持ち続ける姿勢"',
      '"夢を追い求める"': '"夢を追い求め続ける"',
      '"理想を実現する"': '"理想を着実に実現する"',
      '"目標を達成する"': '"目標を確実に達成する"',
      '"成功への道筋"': '"成功への道筋を作る"',
      '"勝利への執念"': '"勝利への強い執念"',
      '"克服する力"': '"困難を克服する力"',
      '"乗り越える勇気"': '"困難を乗り越える勇気"',
      '"打ち破る意志"': '"壁を打ち破る意志"',
      '"突破する能力"': '"限界を突破する能力"',
      '"開拓する精神"': '"新しい道を開拓する精神"',
      '"切り開く力"': '"未来を切り開く力"',
      '"築き上げる努力"': '"確かなものを築き上げる努力"',
      '"作り上げる喜び"': '"価値あるものを作り上げる喜び"',
      '"生み出す創造力"': '"新しいものを生み出す創造力"',
      '"表現する自由"': '"自由に表現する権利"',
      '"発信する勇気"': '"価値ある情報を発信する勇気"',
      '"伝える責任"': '"正確に伝える責任"',
      '"共有する文化"': '"知識を共有する文化"',
      '"つながる喜び"': '"人とつながる喜び"',
      '"結びつける力"': '"人と人を結びつける力"',
      '"橋渡しの役割"': '"異なる世界の橋渡し役"',
      '"調和を生む能力"': '"調和を生み出す能力"',
      '"バランスを保つ力"': '"バランスを保つ力"',
      '"統合する知恵"': '"異なるものを統合する知恵"',
      '"まとめる技術"': '"全体をまとめる技術"',
      '"導く使命"': '"正しい方向へ導く使命"',
      '"支える存在"': '"しっかりと支える存在"',
      '"守る責任"': '"大切なものを守る責任"',
      '"育てる喜び"': '"丁寧に育てる喜び"',
      '"見守る愛情"': '"温かく見守る愛情"',
      '"寄り添う優しさ"': '"そっと寄り添う優しさ"',
      '"励ます言葉"': '"温かく励ます言葉"',
      '"勇気づける存在"': '"勇気を与える存在"',
      '"希望を与える力"': '"希望を与える力"',
      '"光を当てる役割"': '"良い面に光を当てる役割"',
      '"可能性を開く鍵"': '"可能性を開く鍵となる"',
      '"扉を開く勇気"': '"新しい扉を開く勇気"',
      '"道を示す知恵"': '"進むべき道を示す知恵"',
      '"方向を定める力"': '"明確な方向を定める力"'
    };
    
    // バックアップ作成
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase15.${timestamp}.js`, content);
    console.log(`📁 バックアップ作成: hexagram-human-traits-v3.backup.phase15.${timestamp}.js\n`);
    
    // 修正適用
    let totalFixCount = 0;
    let successfulFixes = [];
    
    console.log('8文字の修正を適用中...\n');
    
    Object.entries(eightCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const matches = content.match(regex);
      if (matches) {
        content = content.replace(regex, newText);
        totalFixCount += matches.length;
        successfulFixes.push(`${old} → ${newText} (${matches.length}箇所)`);
      }
    });
    
    // 成功した修正を表示（最初の30件）
    console.log('【修正成功項目】');
    if (successfulFixes.length > 0) {
      successfulFixes.slice(0, 30).forEach(fix => {
        console.log(`✅ ${fix}`);
      });
      if (successfulFixes.length > 30) {
        console.log(`... 他 ${successfulFixes.length - 30}件`);
      }
    } else {
      console.log('修正対象が見つかりませんでした。');
    }
    
    // ファイル保存
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`\n=== フェーズ15完了 ===`);
    console.log(`総修正件数: ${totalFixCount}件`);
    console.log(`修正成功項目: ${successfulFixes.length}種類`);
    console.log(`\n次のフェーズ: node fix-short-descriptions-phase16-final-nine.mjs`);
    
  } catch (error) {
    console.error('エラー:', error);
  }
}

fixPhase15FinalEight();