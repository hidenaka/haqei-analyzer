<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Day 6 - å¾®èª¿æ•´å®Ÿæ–½ï¼ˆTask 6-2ï¼‰</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            padding: 20px; 
            background: #1e1e1e; 
            color: #d4d4d4;
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 { color: #4ec9b0; }
        h2 { color: #569cd6; }
        h3 { color: #dcdcaa; }
        
        .adjustment-section {
            background: #2d2d30;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .box {
            background: #252526;
            padding: 15px;
            border-radius: 5px;
        }
        
        .improved { color: #4ec9b0; }
        .warning { color: #dcdcaa; }
        .normal { color: #d4d4d4; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid #3c3c3c;
        }
        
        th { background: #252526; }
        
        .code-block {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .metric-card {
            background: #252526;
            padding: 10px;
            margin: 5px;
            border-radius: 3px;
            display: inline-block;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4ec9b0;
        }
        
        .chart-bar {
            height: 20px;
            background: linear-gradient(to right, #4ec9b0, #569cd6);
            border-radius: 3px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>Day 6 - å¾®èª¿æ•´å®Ÿæ–½ï¼ˆTask 6-2ï¼‰</h1>
    
    <div id="adjustments"></div>
    
    <script type="module">
        import { TextTo384LinesBridge } from './public/js/ai/TextTo384LinesBridge.js';
        
        // Task 6-2: å¾®èª¿æ•´ã®å®Ÿè£…
        async function implementAdjustments() {
            const bridge = new TextTo384LinesBridge();
            await bridge.initialize();
            
            let html = '';
            
            // èª¿æ•´å†…å®¹ã®å®šç¾©
            const adjustments = {
                positionWeights: {
                    title: 'ä½ç½®é‡ã¿èª¿æ•´',
                    changes: [
                        { position: 1, before: 0.50, after: 0.52, reason: 'ãƒãƒ©ãƒ³ã‚¹æ”¹å–„' },
                        { position: 2, before: 0.43, after: 0.43, reason: 'ç¶­æŒï¼ˆé©åˆ‡ï¼‰' },
                        { position: 3, before: 0.58, after: 0.58, reason: 'ç¶­æŒï¼ˆé©åˆ‡ï¼‰' },
                        { position: 4, before: 0.60, after: 0.60, reason: 'ç¶­æŒï¼ˆé©åˆ‡ï¼‰' },
                        { position: 5, before: 0.70, after: 0.65, reason: 'éåº¦ãªåã‚Šé˜²æ­¢' },
                        { position: 6, before: 0.40, after: 0.42, reason: 'å¾®å¢—ã§å‡è¡¡åŒ–' }
                    ]
                },
                penaltySystem: {
                    title: 'ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚«ãƒ¼ãƒ–èª¿æ•´',
                    changes: [
                        { usage: 1, before: 0.90, after: 0.92, reason: 'ç·©å’Œ' },
                        { usage: 2, before: 0.75, after: 0.80, reason: 'ç·©å’Œ' },
                        { usage: 3, before: 0.55, after: 0.65, reason: 'ç·©å’Œ' },
                        { usage: 4, before: 0.35, after: 0.45, reason: 'ç·©å’Œ' },
                        { usage: 5, before: 0.20, after: 0.30, reason: 'ç·©å’Œ' }
                    ]
                },
                explorationNoise: {
                    title: 'æ¢ç´¢ãƒã‚¤ã‚ºèª¿æ•´',
                    changes: [
                        { type: 'unusedBonus', before: 0.20, after: 0.18, reason: 'å¾®èª¿æ•´' },
                        { type: 'rareBonus', before: 0.10, after: 0.12, reason: 'ä½ä½¿ç”¨ä¿ƒé€²' },
                        { type: 'primaryNoise', before: '0-0.2', after: '0-0.15', reason: 'ç¯„å›²ç¸®å°' }
                    ]
                }
            };
            
            // èª¿æ•´å‰å¾Œã®æ¯”è¼ƒè¡¨ç¤º
            html += '<div class="adjustment-section">';
            html += '<h2>ğŸ“Š å¾®èª¿æ•´ã®å®Ÿè£…å†…å®¹</h2>';
            
            // ä½ç½®é‡ã¿èª¿æ•´
            html += '<h3>1ï¸âƒ£ ' + adjustments.positionWeights.title + '</h3>';
            html += '<div class="before-after">';
            
            html += '<div class="box">';
            html += '<h4>èª¿æ•´å‰</h4>';
            html += '<table>';
            for (const change of adjustments.positionWeights.changes) {
                html += `<tr><td>${change.position}çˆ»</td><td>${change.before.toFixed(2)}</td></tr>`;
            }
            html += '</table>';
            html += '</div>';
            
            html += '<div class="box">';
            html += '<h4>èª¿æ•´å¾Œ</h4>';
            html += '<table>';
            for (const change of adjustments.positionWeights.changes) {
                const changeClass = change.before !== change.after ? 'improved' : 'normal';
                html += `<tr><td>${change.position}çˆ»</td>`;
                html += `<td class="${changeClass}">${change.after.toFixed(2)}</td>`;
                html += `<td>${change.reason}</td></tr>`;
            }
            html += '</table>';
            html += '</div>';
            
            html += '</div>';
            
            // ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ èª¿æ•´
            html += '<h3>2ï¸âƒ£ ' + adjustments.penaltySystem.title + '</h3>';
            html += '<p>ä½¿ç”¨é »åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’ã‚ˆã‚Šç·©ã‚„ã‹ã«ã—ã¦ã€å¤šæ§˜æ€§ã¨å®‰å®šæ€§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æ”¹å–„</p>';
            html += '<table>';
            html += '<tr><th>ä½¿ç”¨å›æ•°</th><th>èª¿æ•´å‰</th><th>èª¿æ•´å¾Œ</th><th>å¤‰åŒ–é‡</th></tr>';
            for (const change of adjustments.penaltySystem.changes) {
                const diff = change.after - change.before;
                html += '<tr>';
                html += `<td>${change.usage}å›</td>`;
                html += `<td>${change.before.toFixed(2)}</td>`;
                html += `<td class="improved">${change.after.toFixed(2)}</td>`;
                html += `<td class="improved">+${diff.toFixed(2)}</td>`;
                html += '</tr>';
            }
            html += '</table>';
            
            // æ¢ç´¢ãƒã‚¤ã‚ºèª¿æ•´
            html += '<h3>3ï¸âƒ£ ' + adjustments.explorationNoise.title + '</h3>';
            html += '<table>';
            html += '<tr><th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th><th>èª¿æ•´å‰</th><th>èª¿æ•´å¾Œ</th><th>ç†ç”±</th></tr>';
            for (const change of adjustments.explorationNoise.changes) {
                html += '<tr>';
                html += `<td>${change.type}</td>`;
                html += `<td>${change.before}</td>`;
                html += `<td class="improved">${change.after}</td>`;
                html += `<td>${change.reason}</td>`;
                html += '</tr>';
            }
            html += '</table>';
            
            html += '</div>';
            
            // å®Ÿè£…ã‚³ãƒ¼ãƒ‰è¡¨ç¤º
            html += '<div class="adjustment-section">';
            html += '<h2>ğŸ”§ å®Ÿè£…ã‚³ãƒ¼ãƒ‰ï¼ˆTextTo384LinesBridge.js ã®å¤‰æ›´ç®‡æ‰€ï¼‰</h2>';
            
            html += '<h3>ä½ç½®é‡ã¿é…åˆ—ã®æ›´æ–°</h3>';
            html += '<div class="code-block">';
            html += `const positionWeights = [
    0.52,  // 1çˆ»: 0.50â†’0.52 ãƒãƒ©ãƒ³ã‚¹æ”¹å–„
    0.43,  // 2çˆ»: ç¶­æŒ
    0.58,  // 3çˆ»: ç¶­æŒ
    0.60,  // 4çˆ»: ç¶­æŒ
    0.65,  // 5çˆ»: 0.70â†’0.65 éåº¦ãªåã‚Šé˜²æ­¢
    0.42   // 6çˆ»: 0.40â†’0.42 å¾®å¢—ã§å‡è¡¡åŒ–
];`;
            html += '</div>';
            
            html += '<h3>ãƒšãƒŠãƒ«ãƒ†ã‚£é–¢æ•°ã®æ›´æ–°</h3>';
            html += '<div class="code-block">';
            html += `const getPenalty = (usageCount) => {
    if (usageCount === 1) return 0.92;  // 0.90â†’0.92
    if (usageCount === 2) return 0.80;  // 0.75â†’0.80
    if (usageCount === 3) return 0.65;  // 0.55â†’0.65
    if (usageCount === 4) return 0.45;  // 0.35â†’0.45
    if (usageCount >= 5) return 0.30;   // 0.20â†’0.30
    return 1.0;
};`;
            html += '</div>';
            
            html += '<h3>æ¢ç´¢ãƒã‚¤ã‚ºã®æ›´æ–°</h3>';
            html += '<div class="code-block">';
            html += `// æœªä½¿ç”¨çˆ»ãƒœãƒ¼ãƒŠã‚¹
const unusedBonus = (usageCount === 0) ? 0.18 : 0;  // 0.20â†’0.18
const rareBonus = (usageCount === 1) ? 0.12 : 0;    // 0.10â†’0.12

// ãƒ—ãƒ©ã‚¤ãƒãƒªãƒã‚¤ã‚ºç¯„å›²
const primaryNoise = ((lineId * noiseBase * 13) % 150) / 1000; // 0-0.15ã«ç¸®å°`;
            html += '</div>';
            html += '</div>';
            
            // åŠ¹æœæ¸¬å®š
            html += '<div class="adjustment-section">';
            html += '<h2>ğŸ¯ èª¿æ•´åŠ¹æœã®äºˆæ¸¬</h2>';
            
            html += '<h3>æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„</h3>';
            html += '<ul>';
            html += '<li class="improved">âœ… 5çˆ»é¸æŠç‡: 7-8% â†’ 6-7%ï¼ˆé©æ­£åŒ–ï¼‰</li>';
            html += '<li class="improved">âœ… 1çˆ»é¸æŠç‡: 15% â†’ 16-17%ï¼ˆæ”¹å–„ï¼‰</li>';
            html += '<li class="improved">âœ… 6çˆ»é¸æŠç‡: 15% â†’ 16%ï¼ˆå¾®æ”¹å–„ï¼‰</li>';
            html += '<li class="improved">âœ… ã‚«ãƒãƒ¼ç‡: 11% â†’ 12-13%ï¼ˆå‘ä¸Šï¼‰</li>';
            html += '<li class="improved">âœ… Ï‡Â²å€¤: 7-8 â†’ 5-6ï¼ˆãƒãƒ©ãƒ³ã‚¹æ”¹å–„ï¼‰</li>';
            html += '</ul>';
            
            html += '<h3>ãƒªã‚¹ã‚¯ã¨å¯¾ç­–</h3>';
            html += '<ul>';
            html += '<li class="warning">âš ï¸ 5çˆ»ã®èª¿æ•´ãŒå¤§ãã™ãã‚‹å¯èƒ½æ€§ â†’ æ®µéšçš„ã«è¦³å¯Ÿ</li>';
            html += '<li class="warning">âš ï¸ ãƒšãƒŠãƒ«ãƒ†ã‚£ç·©å’Œã«ã‚ˆã‚‹å¤šæ§˜æ€§ä½ä¸‹ â†’ æ¢ç´¢ãƒã‚¤ã‚ºã§è£œå„Ÿ</li>';
            html += '<li class="warning">âš ï¸ å‡¦ç†é€Ÿåº¦ã¸ã®å½±éŸ¿ â†’ Task 6-3ã§æœ€é©åŒ–</li>';
            html += '</ul>';
            html += '</div>';
            
            // ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒ³ãƒ—ãƒ«
            html += '<div class="adjustment-section">';
            html += '<h2>ğŸ“ å‹•ä½œç¢ºèªç”¨ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«</h2>';
            html += '<p>ä»¥ä¸‹ã®ã‚µãƒ³ãƒ—ãƒ«ã§èª¿æ•´åŠ¹æœã‚’ç¢ºèªï¼š</p>';
            html += '<ol>';
            const testSamples = [
                'æ–°ã—ã„å§‹ã¾ã‚Š',
                'å”åŠ›ã—ã¦é€²ã‚ã‚‹',
                'å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹',
                'å¤‰åŒ–ã«å¯¾å¿œã™ã‚‹',
                'ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®',
                'å®Œæˆã«å‘ã‘ã¦',
                'æ±ºæ–­ã®æ™‚',
                'å†…éƒ¨èª¿æ•´',
                'å¤–éƒ¨ç’°å¢ƒ',
                'æˆ¦ç•¥çš„åˆ¤æ–­'
            ];
            for (const sample of testSamples) {
                html += `<li>${sample}</li>`;
            }
            html += '</ol>';
            html += '</div>';
            
            document.getElementById('adjustments').innerHTML = html;
        }
        
        implementAdjustments();
    </script>
</body>
</html>