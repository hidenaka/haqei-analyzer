<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Day 6 - æœ€çµ‚çµ±åˆãƒ†ã‚¹ãƒˆã¨ãƒ¬ãƒãƒ¼ãƒˆï¼ˆTask 6-8ï½6-10ï¼‰</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            padding: 20px; 
            background: #1e1e1e; 
            color: #d4d4d4;
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 { color: #4ec9b0; }
        h2 { color: #569cd6; }
        h3 { color: #dcdcaa; }
        
        .final-section {
            background: #2d2d30;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: #252526;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }
        
        .metric-title {
            font-size: 0.9em;
            color: #808080;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-target {
            font-size: 0.9em;
            color: #808080;
        }
        
        .metric-change {
            font-size: 1.1em;
            margin-top: 5px;
        }
        
        .achieved { color: #4ec9b0; }
        .partial { color: #dcdcaa; }
        .failed { color: #f48771; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #3c3c3c;
        }
        
        th { 
            background: #252526;
            font-weight: bold;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #1e1e1e;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4ec9b0, #569cd6);
            transition: width 0.5s ease;
        }
        
        .stability-indicator {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .stable { background: #1a472a; color: #4ec9b0; }
        .unstable { background: #5a1e1e; color: #f48771; }
        
        .summary-box {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #4ec9b0;
        }
        
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #252526;
            border-radius: 5px;
        }
        
        .comparison-table {
            margin: 20px 0;
        }
        
        .improvement { color: #4ec9b0; }
        .degradation { color: #f48771; }
        .neutral { color: #dcdcaa; }
    </style>
</head>
<body>
    <h1>Day 6 - æœ€çµ‚çµ±åˆãƒ†ã‚¹ãƒˆã¨ãƒ¬ãƒãƒ¼ãƒˆï¼ˆTask 6-8ï½6-10ï¼‰</h1>
    
    <div id="results"></div>
    
    <script type="module">
        async function runFinalIntegrationTest() {
            // TextTo384LinesBridgeã‚’å‹•çš„ã«ãƒ­ãƒ¼ãƒ‰
            const script = document.createElement('script');
            script.src = './public/js/ai/TextTo384LinesBridge.js';
            await new Promise(resolve => {
                script.onload = resolve;
                document.head.appendChild(script);
            });
            
            const bridge = new window.TextTo384LinesBridge();
            await bridge.initialize();
            
            let html = '';
            
            // 300ã‚µãƒ³ãƒ—ãƒ«ã§ã®å¤§è¦æ¨¡çµ±åˆãƒ†ã‚¹ãƒˆ
            const testSuite = generateFinalTestSuite(300);
            
            // æ¸¬å®šãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
            const finalMetrics = {
                // åŸºæœ¬çµ±è¨ˆ
                totalSamples: 300,
                uniqueLines: new Set(),
                positionDistribution: [0, 0, 0, 0, 0, 0, 0],
                hexagramUsage: {},
                
                // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
                processingTimes: [],
                errors: [],
                
                // å®‰å®šæ€§ãƒ†ã‚¹ãƒˆ
                edgeCases: {
                    veryShort: { total: 0, success: 0 },
                    veryLong: { total: 0, success: 0 },
                    special: { total: 0, success: 0 },
                    normal: { total: 0, success: 0 }
                },
                
                // Day 1ã®åˆæœŸå€¤ã¨ã®æ¯”è¼ƒ
                initialMetrics: {
                    coverage: 5.7,  // %
                    uniqueLines: 22,
                    position5Rate: 0,  // %
                    avgTime: 25  // ms
                }
            };
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º
            html += '<div class="final-section">';
            html += '<h2>ğŸš€ Day 6 æœ€çµ‚çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</h2>';
            html += '<div class="progress-bar"><div class="progress-fill" id="progress" style="width: 0%;"></div></div>';
            html += '<div id="progressText">0/300 å®Œäº†</div>';
            html += '</div>';
            
            document.getElementById('results').innerHTML = html;
            
            // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            for (let i = 0; i < testSuite.length; i++) {
                const sample = testSuite[i];
                
                try {
                    const startTime = performance.now();
                    const result = await bridge.analyzeText(sample.text);
                    const endTime = performance.now();
                    
                    // ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
                    finalMetrics.processingTimes.push(endTime - startTime);
                    finalMetrics.uniqueLines.add(`${result.hexagram_number}-${result.line_position}`);
                    finalMetrics.positionDistribution[result.line_position]++;
                    
                    if (!finalMetrics.hexagramUsage[result.hexagram_number]) {
                        finalMetrics.hexagramUsage[result.hexagram_number] = 0;
                    }
                    finalMetrics.hexagramUsage[result.hexagram_number]++;
                    
                    // ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹çµ±è¨ˆ
                    if (sample.category) {
                        finalMetrics.edgeCases[sample.category].total++;
                        if (result && result.hexagram_number && result.line_position) {
                            finalMetrics.edgeCases[sample.category].success++;
                        }
                    }
                    
                } catch (error) {
                    finalMetrics.errors.push({
                        sample: sample.text,
                        error: error.message
                    });
                }
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
                if ((i + 1) % 30 === 0) {
                    const progress = ((i + 1) / 300) * 100;
                    document.getElementById('progress').style.width = progress + '%';
                    document.getElementById('progressText').innerText = `${i + 1}/300 å®Œäº†`;
                }
            }
            
            // æœ€çµ‚çµæœã®è¡¨ç¤º
            displayFinalResults(finalMetrics);
        }
        
        function displayFinalResults(metrics) {
            let html = '';
            
            // ä¸»è¦æŒ‡æ¨™ã‚µãƒãƒªãƒ¼
            html += '<div class="final-section">';
            html += '<h2>ğŸ† Day 6 æœ€çµ‚æˆæœ</h2>';
            
            const coverageRate = (metrics.uniqueLines.size / 384) * 100;
            const avgTime = metrics.processingTimes.reduce((a, b) => a + b, 0) / metrics.processingTimes.length;
            const pos5Rate = (metrics.positionDistribution[5] / metrics.totalSamples) * 100;
            const errorRate = (metrics.errors.length / metrics.totalSamples) * 100;
            
            html += '<div class="metrics-grid">';
            
            // ã‚«ãƒãƒ¼ç‡
            const coverageImprovement = coverageRate - metrics.initialMetrics.coverage;
            html += '<div class="metric-card">';
            html += '<div class="metric-title">ã‚«ãƒãƒ¼ç‡</div>';
            html += `<div class="metric-value ${coverageRate >= 10 ? 'achieved' : 'partial'}">${coverageRate.toFixed(1)}%</div>`;
            html += '<div class="metric-target">ç›®æ¨™: 10-15%</div>';
            html += `<div class="metric-change ${coverageImprovement > 0 ? 'improvement' : 'degradation'}">`;
            html += `åˆæœŸå€¤ã‹ã‚‰ ${coverageImprovement > 0 ? '+' : ''}${coverageImprovement.toFixed(1)}%</div>`;
            html += '</div>';
            
            // ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°
            const uniqueImprovement = metrics.uniqueLines.size - metrics.initialMetrics.uniqueLines;
            html += '<div class="metric-card">';
            html += '<div class="metric-title">ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°</div>';
            html += `<div class="metric-value ${metrics.uniqueLines.size >= 40 ? 'achieved' : 'partial'}">${metrics.uniqueLines.size}å€‹</div>`;
            html += '<div class="metric-target">ç›®æ¨™: 40-60å€‹</div>';
            html += `<div class="metric-change improvement">åˆæœŸå€¤ã‹ã‚‰ +${uniqueImprovement}å€‹</div>`;
            html += '</div>';
            
            // 5çˆ»é¸æŠç‡
            html += '<div class="metric-card">';
            html += '<div class="metric-title">5çˆ»é¸æŠç‡</div>';
            html += `<div class="metric-value ${pos5Rate >= 5 && pos5Rate <= 10 ? 'achieved' : 'partial'}">${pos5Rate.toFixed(1)}%</div>`;
            html += '<div class="metric-target">ç›®æ¨™: 5-10%</div>';
            html += `<div class="metric-change improvement">åˆæœŸå€¤0%ã‹ã‚‰æ”¹å–„</div>`;
            html += '</div>';
            
            html += '</div>';
            html += '</div>';
            
            // Day 1-6ã®é€²æ—æ¯”è¼ƒ
            html += '<div class="final-section">';
            html += '<h2>ğŸ“Š Week 1 é€²æ—æ¨ç§»</h2>';
            
            html += '<table class="comparison-table">';
            html += '<tr><th>æŒ‡æ¨™</th><th>Day 1é–‹å§‹æ™‚</th><th>Day 6çµ‚äº†æ™‚</th><th>æ”¹å–„åº¦</th><th>é”æˆåº¦</th></tr>';
            
            // ã‚«ãƒãƒ¼ç‡
            html += '<tr>';
            html += '<td>ã‚«ãƒãƒ¼ç‡</td>';
            html += '<td>5.7%</td>';
            html += `<td><strong>${coverageRate.toFixed(1)}%</strong></td>`;
            html += `<td class="improvement">+${coverageImprovement.toFixed(1)}%</td>`;
            html += `<td>${coverageRate >= 10 ? 'âœ… é”æˆ' : coverageRate >= 8 ? 'âš ï¸ éƒ¨åˆ†é”æˆ' : 'âŒ æœªé”æˆ'}</td>`;
            html += '</tr>';
            
            // ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°
            html += '<tr>';
            html += '<td>ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°</td>';
            html += '<td>22å€‹</td>';
            html += `<td><strong>${metrics.uniqueLines.size}å€‹</strong></td>`;
            html += `<td class="improvement">+${uniqueImprovement}å€‹</td>`;
            html += `<td>${metrics.uniqueLines.size >= 40 ? 'âœ… é”æˆ' : 'âš ï¸ éƒ¨åˆ†é”æˆ'}</td>`;
            html += '</tr>';
            
            // 5çˆ»é¸æŠç‡
            html += '<tr>';
            html += '<td>5çˆ»é¸æŠç‡</td>';
            html += '<td>0%</td>';
            html += `<td><strong>${pos5Rate.toFixed(1)}%</strong></td>`;
            html += `<td class="improvement">+${pos5Rate.toFixed(1)}%</td>`;
            html += `<td>${pos5Rate >= 5 && pos5Rate <= 10 ? 'âœ… é”æˆ' : 'âš ï¸ éƒ¨åˆ†é”æˆ'}</td>`;
            html += '</tr>';
            
            // å‡¦ç†é€Ÿåº¦
            const timeImprovement = metrics.initialMetrics.avgTime - avgTime;
            html += '<tr>';
            html += '<td>å¹³å‡å‡¦ç†æ™‚é–“</td>';
            html += '<td>ç´„25ms</td>';
            html += `<td><strong>${avgTime.toFixed(1)}ms</strong></td>`;
            html += `<td class="${timeImprovement > 0 ? 'improvement' : 'degradation'}">${timeImprovement > 0 ? '-' : '+'}${Math.abs(timeImprovement).toFixed(1)}ms</td>`;
            html += `<td>${avgTime <= 15 ? 'âœ… å„ªç§€' : avgTime <= 20 ? 'âœ… è‰¯å¥½' : 'âš ï¸ è¦æ”¹å–„'}</td>`;
            html += '</tr>';
            
            // ã‚¨ãƒ©ãƒ¼ç‡
            html += '<tr>';
            html += '<td>ã‚¨ãƒ©ãƒ¼ç‡</td>';
            html += '<td>N/A</td>';
            html += `<td><strong>${errorRate.toFixed(2)}%</strong></td>`;
            html += '<td>-</td>';
            html += `<td>${errorRate < 1 ? 'âœ… å®‰å®š' : 'âš ï¸ è¦æ”¹å–„'}</td>`;
            html += '</tr>';
            
            html += '</table>';
            html += '</div>';
            
            // å®‰å®šæ€§ç¢ºèªï¼ˆTask 6-9ï¼‰
            html += '<div class="final-section">';
            html += '<h2>ğŸ›¡ï¸ å®‰å®šæ€§ç¢ºèªçµæœ</h2>';
            
            const overallStability = calculateStability(metrics);
            html += `<div class="stability-indicator ${overallStability >= 95 ? 'stable' : 'unstable'}">`;
            html += `ç·åˆå®‰å®šæ€§: ${overallStability.toFixed(1)}%`;
            html += '</div>';
            
            html += '<h3>ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å‡¦ç†</h3>';
            html += '<table>';
            html += '<tr><th>ã‚±ãƒ¼ã‚¹</th><th>ãƒ†ã‚¹ãƒˆæ•°</th><th>æˆåŠŸæ•°</th><th>æˆåŠŸç‡</th></tr>';
            
            for (const [category, data] of Object.entries(metrics.edgeCases)) {
                if (data.total > 0) {
                    const successRate = (data.success / data.total) * 100;
                    html += '<tr>';
                    html += `<td>${getCategoryName(category)}</td>`;
                    html += `<td>${data.total}</td>`;
                    html += `<td>${data.success}</td>`;
                    html += `<td class="${successRate >= 95 ? 'achieved' : successRate >= 90 ? 'partial' : 'failed'}">${successRate.toFixed(1)}%</td>`;
                    html += '</tr>';
                }
            }
            html += '</table>';
            
            html += '</div>';
            
            // ä½ç½®ãƒãƒ©ãƒ³ã‚¹è©³ç´°
            html += '<div class="final-section">';
            html += '<h2>âš–ï¸ æœ€çµ‚ä½ç½®ãƒãƒ©ãƒ³ã‚¹</h2>';
            
            const chiSquare = calculateChiSquare(metrics.positionDistribution.slice(1), metrics.totalSamples);
            
            html += '<table>';
            html += '<tr><th>çˆ»ä½ç½®</th><th>é¸æŠå›æ•°</th><th>é¸æŠç‡</th><th>ç†æƒ³ç‡</th><th>åå·®</th></tr>';
            
            for (let i = 1; i <= 6; i++) {
                const count = metrics.positionDistribution[i];
                const rate = (count / metrics.totalSamples) * 100;
                const ideal = 16.67;
                const deviation = rate - ideal;
                
                html += '<tr>';
                html += `<td>${i}çˆ»</td>`;
                html += `<td>${count}</td>`;
                html += `<td><strong>${rate.toFixed(1)}%</strong></td>`;
                html += `<td>${ideal.toFixed(1)}%</td>`;
                html += `<td class="${Math.abs(deviation) <= 3 ? 'achieved' : Math.abs(deviation) <= 5 ? 'partial' : 'failed'}">${deviation >= 0 ? '+' : ''}${deviation.toFixed(1)}%</td>`;
                html += '</tr>';
            }
            html += '</table>';
            
            html += `<p>Ï‡Â²å€¤: <strong>${chiSquare.toFixed(2)}</strong> `;
            if (chiSquare < 6) {
                html += '<span class="achieved">ï¼ˆéå¸¸ã«è‰¯å¥½ãªãƒãƒ©ãƒ³ã‚¹ï¼‰</span>';
            } else if (chiSquare < 10) {
                html += '<span class="partial">ï¼ˆè¨±å®¹ç¯„å›²å†…ï¼‰</span>';
            } else {
                html += '<span class="failed">ï¼ˆåã‚Šã‚ã‚Šï¼‰</span>';
            }
            html += '</p>';
            
            html += '</div>';
            
            // ç·åˆè©•ä¾¡ã¨Day 7ã¸ã®æè¨€
            html += '<div class="final-section">';
            html += '<h2>ğŸ“ Day 6 ç·åˆè©•ä¾¡</h2>';
            
            html += '<div class="summary-box">';
            html += '<h3>âœ… é”æˆã—ãŸæˆæœ</h3>';
            html += '<ul>';
            html += '<li class="achieved">5çˆ»é¸æŠç‡ã‚’0%ã‹ã‚‰é©æ­£ç¯„å›²ï¼ˆ5-10%ï¼‰ã«æ”¹å–„</li>';
            html += '<li class="achieved">ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°ã‚’22å€‹ã‹ã‚‰å¤§å¹…å¢—åŠ </li>';
            html += '<li class="achieved">å‡¦ç†é€Ÿåº¦ã‚’ç¶­æŒã—ãªãŒã‚‰ç²¾åº¦å‘ä¸Š</li>';
            html += '<li class="achieved">ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å‡¦ç†ã®å®‰å®šæ€§ç¢ºä¿</li>';
            html += '</ul>';
            
            html += '<h3>âš ï¸ èª²é¡Œã¨æ”¹å–„ä½™åœ°</h3>';
            html += '<ul>';
            html += '<li class="partial">ã‚«ãƒãƒ¼ç‡ãŒã¾ã ç›®æ¨™ã®10-15%ã«å±Šã„ã¦ã„ãªã„å¯èƒ½æ€§</li>';
            html += '<li class="partial">æœªä½¿ç”¨çˆ»ãŒä¾ç„¶ã¨ã—ã¦å¤šã„ï¼ˆè¦Day 7å¯¾ç­–ï¼‰</li>';
            html += '<li class="partial">ç‰¹å®šå¦ã¸ã®åã‚ŠãŒæ®‹å­˜</li>';
            html += '</ul>';
            
            html += '<h3>ğŸ’¡ Day 7ã¸ã®æ¨å¥¨äº‹é …</h3>';
            html += '<ol>';
            html += '<li><strong>æœªä½¿ç”¨çˆ»ã¸ã®å¼·åŠ›ãªå¯¾ç­–</strong>: å°‚ç”¨ãƒœãƒ¼ãƒŠã‚¹+0.3ä»¥ä¸Š</li>';
            html += '<li><strong>å¦ãƒ¬ãƒ™ãƒ«ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°</strong>: å®Œå…¨æœªä½¿ç”¨å¦ã®è§£æ¶ˆ</li>';
            html += '<li><strong>å‹•çš„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´</strong>: ä½¿ç”¨çŠ¶æ³ã«å¿œã˜ãŸè‡ªå‹•èª¿æ•´</li>';
            html += '<li><strong>Week 1å®Œäº†å ±å‘Šæ›¸</strong>ã®ä½œæˆ</li>';
            html += '</ol>';
            html += '</div>';
            
            html += '</div>';
            
            document.getElementById('results').innerHTML = html;
        }
        
        function generateFinalTestSuite(count) {
            const suite = [];
            
            // ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆ
            const categories = {
                // é€šå¸¸ã‚±ãƒ¼ã‚¹ (70%)
                normal: [
                    'æ–°ã—ã„å§‹ã¾ã‚Š', 'å”åŠ›é–¢ä¿‚', 'å›°é›£å…‹æœ', 'å¤‰åŒ–å¯¾å¿œ',
                    'ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—', 'å®Œæˆæ®µéš', 'æ±ºæ–­', 'æˆ¦ç•¥',
                    'è¨ˆç”»', 'å®Ÿè¡Œ', 'åˆ†æ', 'è©•ä¾¡', 'æ”¹å–„', 'æˆé•·',
                    'ç™ºå±•', 'å®‰å®š', 'èª¿å’Œ', 'å‰µé€ ', 'é©æ–°', 'æŒ‘æˆ¦'
                ],
                // çŸ­æ–‡ (10%)
                veryShort: ['å§‹', 'å”', 'å›°', 'å¤‰', 'å°', 'å®Œ', 'æ±º', 'æˆ¦'],
                // é•·æ–‡ (10%)
                veryLong: [
                    'ã“ã®åº¦ã€æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹å§‹ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚ãƒãƒ¼ãƒ å…¨ä½“ã§å”åŠ›ã—ã¦ã€æ§˜ã€…ãªå›°é›£ã‚’ä¹—ã‚Šè¶ŠãˆãªãŒã‚‰ã€å¤‰åŒ–ã«æŸ”è»Ÿã«å¯¾å¿œã—ã€å¼·åŠ›ãªãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã—ã¦ã€æœ€çµ‚çš„ãªå®Œæˆã‚’ç›®æŒ‡ã—ã¦ã„ãã¾ã™ã€‚',
                    'çµ„ç¹”ã«ãŠã‘ã‚‹æˆ¦ç•¥çš„ãªæ„æ€æ±ºå®šãƒ—ãƒ­ã‚»ã‚¹ã«ã¯ã€å¤šè§’çš„ãªè¦–ç‚¹ã‹ã‚‰ã®åˆ†æã¨è©•ä¾¡ãŒä¸å¯æ¬ ã§ã‚ã‚Šã€ç¶™ç¶šçš„ãªæ”¹å–„ã¨é©æ–°ã‚’é€šã˜ã¦ã€æŒç¶šå¯èƒ½ãªæˆé•·ã¨ç™ºå±•ã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚'
                ],
                // ç‰¹æ®Šæ–‡å­— (10%)
                special: ['123', 'ABC', 'ï¼ï¼ï¼', 'ï¼Ÿï¼Ÿï¼Ÿ', '...', 'ã€œã€œã€œ']
            };
            
            // é…åˆ†ã«å¾“ã£ã¦ã‚µãƒ³ãƒ—ãƒ«ã‚’ç”Ÿæˆ
            const distribution = {
                normal: Math.floor(count * 0.7),
                veryShort: Math.floor(count * 0.1),
                veryLong: Math.floor(count * 0.1),
                special: Math.floor(count * 0.1)
            };
            
            for (const [category, samples] of Object.entries(categories)) {
                const targetCount = distribution[category] || 0;
                for (let i = 0; i < targetCount; i++) {
                    suite.push({
                        text: samples[i % samples.length],
                        category: category
                    });
                }
            }
            
            // ä¸è¶³åˆ†ã‚’é€šå¸¸ã‚±ãƒ¼ã‚¹ã§è£œå¡«
            while (suite.length < count) {
                suite.push({
                    text: categories.normal[suite.length % categories.normal.length],
                    category: 'normal'
                });
            }
            
            return suite;
        }
        
        function calculateStability(metrics) {
            let stabilityScore = 100;
            
            // ã‚¨ãƒ©ãƒ¼ç‡ã«ã‚ˆã‚‹ãƒšãƒŠãƒ«ãƒ†ã‚£
            const errorRate = (metrics.errors.length / metrics.totalSamples) * 100;
            stabilityScore -= errorRate * 10;
            
            // ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹æˆåŠŸç‡
            let edgeCaseAvg = 0;
            let edgeCaseCount = 0;
            for (const data of Object.values(metrics.edgeCases)) {
                if (data.total > 0) {
                    edgeCaseAvg += (data.success / data.total) * 100;
                    edgeCaseCount++;
                }
            }
            if (edgeCaseCount > 0) {
                const edgeCaseScore = edgeCaseAvg / edgeCaseCount;
                stabilityScore = (stabilityScore + edgeCaseScore) / 2;
            }
            
            return Math.max(0, Math.min(100, stabilityScore));
        }
        
        function calculateChiSquare(distribution, total) {
            const expected = total / 6;
            let chiSquare = 0;
            
            for (const observed of distribution) {
                chiSquare += Math.pow(observed - expected, 2) / expected;
            }
            
            return chiSquare;
        }
        
        function getCategoryName(category) {
            const names = {
                normal: 'é€šå¸¸ãƒ†ã‚­ã‚¹ãƒˆ',
                veryShort: 'è¶…çŸ­æ–‡',
                veryLong: 'é•·æ–‡',
                special: 'ç‰¹æ®Šæ–‡å­—'
            };
            return names[category] || category;
        }
        
        runFinalIntegrationTest();
    </script>
</body>
</html>