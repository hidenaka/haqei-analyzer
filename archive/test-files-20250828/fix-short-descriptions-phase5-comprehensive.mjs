import { readFile, writeFile } from 'fs/promises';

async function fixPhase5Comprehensive() {
  try {
    console.log('=== ãƒ•ã‚§ãƒ¼ã‚º5: åŒ…æ‹¬çš„ä¿®æ­£ï¼ˆ5-6æ–‡å­—ã®çŸ­ã„èª¬æ˜ï¼‰ ===\n');
    
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èª­ã¿è¾¼ã¿
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // 5æ–‡å­—ã®èª¬æ˜ã‚’å…¨ã¦ä¿®æ­£ï¼ˆ65ä»¶ï¼‰
    const fiveCharFixes = {
      // environmentï¼ˆç’°å¢ƒï¼‰
      '"å‹•ã‘ã‚‹ç’°å¢ƒ"': '"è‡ªç”±ã«å‹•ãå›ã‚Œã‚‹ç’°å¢ƒ"',
      '"è‡ªç”±ãªç’°å¢ƒ"': '"åˆ¶ç´„ã®ãªã„è‡ªç”±ãªç’°å¢ƒ"',
      '"æ¸©ã‹ã„å®¶åº­"': '"æ¸©ã‹ãå®‰å¿ƒã§ãã‚‹å®¶åº­ç’°å¢ƒ"',
      '"è±Šã‹ãªç’°å¢ƒ"': '"ç‰©è³ªçš„ç²¾ç¥çš„ã«è±Šã‹ãªç’°å¢ƒ"',
      '"æ–°ã—ã„ç’°å¢ƒ"': '"æ–°é®®ã§åˆºæ¿€çš„ãªæ–°ã—ã„ç’°å¢ƒ"',
      '"æŸ”è»Ÿãªç’°å¢ƒ"': '"å¤‰åŒ–ã«å¯¾å¿œã§ãã‚‹æŸ”è»Ÿãªç’°å¢ƒ"',
      
      // äººã€…ãƒ»ä»²é–“
      '"æŸ”è»Ÿãªäººã€…"': '"æŸ”è»Ÿãªè€ƒãˆã‚’æŒã¤äººã€…"',
      '"æ–°ã—ã„ä»²é–“"': '"æ–°ã—ãå‡ºä¼šã£ãŸä»²é–“ãŸã¡"',
      '"å¤šæ§˜ãªäººã€…"': '"å¤šæ§˜ãªä¾¡å€¤è¦³ã‚’æŒã¤äººã€…"',
      '"èª å®Ÿãªäººã€…"': '"èª å®Ÿã§ä¿¡é ¼ã§ãã‚‹äººã€…"',
      '"æ…é‡ãªäººã€…"': '"æ…é‡ã«è€ƒãˆã¦è¡Œå‹•ã™ã‚‹äººã€…"',
      
      // æ„Ÿæƒ…ãƒ»å¿ƒç†çŠ¶æ…‹
      '"ç„¡ã‚’æ¥½ã—ã‚€"': '"ä½•ã‚‚ã—ãªã„æ™‚é–“ã‚’æ¥½ã—ã‚€"',
      '"å¿ƒèº«ã‚’ç™’ã™"': '"å¿ƒã¨ä½“ã‚’ã‚†ã£ãã‚Šç™’ã™"',
      '"ç°ã‹ã‚‰å†ç”Ÿ"': '"ç‡ƒãˆå°½ããŸç°ã‹ã‚‰å†ç”Ÿã™ã‚‹"',
      '"ç€å®Ÿãªå‰é€²"': '"ä¸€æ­©ä¸€æ­©ç€å®Ÿã«å‰é€²ã™ã‚‹"',
      '"è‡ªç”±ã‚’å®ˆã‚‹"': '"è‡ªåˆ†ã®è‡ªç”±ã‚’å®ˆã‚ŠæŠœã"',
      '"å®Œå…¨ãªè‡ªç”±"': '"å®Œå…¨ã«è‡ªç”±ãªçŠ¶æ…‹ã«ãªã‚‹"',
      '"ä»–è€…ã‚’å®ˆã‚‹"': '"ä»–è€…ã‚’å®ˆã‚‹ã“ã¨ã‚’å„ªå…ˆã™ã‚‹"',
      
      // æ™‚é–“ãƒ»æ©Ÿä¼š
      '"é™è¦³ã®æ™‚é–“"': '"é™ã‹ã«è¦³å¯Ÿã™ã‚‹æ™‚é–“ã‚’æŒã¤"',
      '"æ™‚é–“ãŒè§£æ±º"': '"æ™‚é–“ãŒçµŒã¦ã°è‡ªç„¶ã«è§£æ±ºã™ã‚‹"',
      '"ä¼‘è€•ã‚‚å¿…è¦"': '"ä¼‘è€•æœŸé–“ã‚‚å¿…è¦ã ã¨ç†è§£ã™ã‚‹"',
      '"å®Œäº†ã‚‚å¤§åˆ‡"': '"ç‰©äº‹ã‚’å®Œäº†ã•ã›ã‚‹ã“ã¨ã‚‚å¤§åˆ‡"',
      '"å¸¸ã«é€²è¡Œä¸­"': '"å¸¸ã«é€²åŒ–ã—ç¶šã‘ã¦ã„ã‚‹çŠ¶æ…‹"',
      
      // åŠ›ãƒ»å¼·ã•
      '"é ¼ã‚Œã‚‹å¼·ã•"': '"å‘¨ã‚Šã‹ã‚‰é ¼ã‚‰ã‚Œã‚‹å¼·ã•"',
      '"å‹åˆ©ã§å›å¾©"': '"å‹åˆ©ã™ã‚‹ã“ã¨ã§åŠ›ã‚’å›å¾©ã™ã‚‹"',
      '"å¼·åŠ›ãªé˜²å¾¡"': '"å¼·åŠ›ãªé˜²å¾¡åŠ›ã‚’ç™ºæ®ã™ã‚‹"',
      
      // æˆåŠŸãƒ»å–œã³
      '"ä¸Šæ˜‡ã®å®Ÿæ„Ÿ"': '"ç€å®Ÿã«ä¸Šæ˜‡ã—ã¦ã„ã‚‹å®Ÿæ„Ÿ"',
      '"æ±ºæ–­ã®æˆåŠŸ"': '"æ±ºæ–­ãŒæˆåŠŸã—ãŸæ™‚ã®å……å®Ÿæ„Ÿ"',
      '"æ–°ã—ã„æ±ºæ–­"': '"æ–°ã—ã„æ±ºæ–­ã‚’ä¸‹ã™å‹‡æ°—"',
      '"é›†çµã®æˆåŠŸ"': '"äººã‚’é›†ã‚ã‚‹ã“ã¨ã«æˆåŠŸã™ã‚‹"',
      '"æˆé•·ã®å–œã³"': '"æˆé•·ã‚’å®Ÿæ„Ÿã™ã‚‹å–œã³"',
      '"åç©«ã®å–œã³"': '"åŠªåŠ›ã®åç©«ã‚’å¾—ã‚‹å–œã³"',
      '"å‰µé€ ã®å–œã³"': '"ä½•ã‹ã‚’å‰µé€ ã™ã‚‹å–œã³"',
      '"é©å‘½ã®æˆåŠŸ"': '"å¤‰é©ãŒæˆåŠŸã—ãŸæ™‚ã®é”æˆæ„Ÿ"',
      
      // å®¶æ—é–¢é€£
      '"å®¶æ—ã¨ã®çµ†"': '"å®¶æ—ã¨ã®æ·±ã„çµ†ã‚’å¤§åˆ‡ã«ã™ã‚‹"',
      '"å®¶æ—ã®ç¬‘é¡”"': '"å®¶æ—ã®ç¬‘é¡”ãŒæœ€é«˜ã®å ±é…¬"',
      '"å®¶æ—ã®æ„›æƒ…"': '"å®¶æ—ã‹ã‚‰ã®æ„›æƒ…ã«æ”¯ãˆã‚‰ã‚Œã‚‹"',
      '"å®¶æ—ã¨ã®æ™‚é–“"': '"å®¶æ—ã¨éã”ã™å¤§åˆ‡ãªæ™‚é–“"',
      
      // å¯¾å‡¦ãƒ»è§£æ±º
      '"ç¢ºå®Ÿãªå¯¾å‡¦"': '"ç¢ºå®Ÿã«å•é¡Œã«å¯¾å‡¦ã™ã‚‹åŠ›"',
      '"æ ¹æœ¬çš„è§£æ±º"': '"å•é¡Œã‚’æ ¹æœ¬ã‹ã‚‰è§£æ±ºã™ã‚‹åŠ›"',
      '"å‰µé€ çš„æ˜‡è¯"': '"å•é¡Œã‚’å‰µé€ çš„ã«æ˜‡è¯ã™ã‚‹"',
      
      // ãã®ä»–ã®çŠ¶æ…‹
      '"é™ã‹ã«å……é›»"': '"é™ã‹ã«ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å……é›»ã™ã‚‹"',
      '"ä¸€äººã§é™é¤Š"': '"ä¸€äººã§é™ã‹ã«é¤Šç”Ÿã™ã‚‹"',
      '"é™å¯‚ã¨å®‰å®š"': '"é™å¯‚ã¨å®‰å®šã‚’ä¿ã¤åŠ›"',
      '"èª°ã‹ã«é ¼ã‚‹"': '"å›°ã£ãŸæ™‚ã¯èª°ã‹ã«é ¼ã‚‹"',
      '"ä½™è£•ãŒã‚ã‚‹"': '"å¿ƒã«ä½™è£•ãŒã‚ã‚‹çŠ¶æ…‹"',
      '"æ–°ãŸãªè±Šä½œ"': '"æ–°ãŸãªè±Šä½œã‚’æœŸå¾…ã™ã‚‹"',
      '"å†’é™ºå¿ƒå…¨é–‹"': '"å†’é™ºå¿ƒã‚’å…¨é–‹ã«ã™ã‚‹"',
      '"å®¿ã§ã®ä¼‘æ¯"': '"æ—…ã®å®¿ã§ã‚†ã£ãã‚Šä¼‘æ¯ã™ã‚‹"',
      '"å®šç€ã—ãªã„"': '"ä¸€ã¤ã®å ´æ‰€ã«å®šç€ã—ãªã„"',
      '"ç›´é¢ã—ãªã„"': '"å•é¡Œã«ç›´é¢ã™ã‚‹ã“ã¨ã‚’é¿ã‘ã‚‹"',
      '"å®Œå…¨ã«æ‹¡æ•£"': '"ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å®Œå…¨ã«æ‹¡æ•£ã™ã‚‹"',
      '"è§£æ”¾ã®å®Ÿæ„Ÿ"': '"æŸç¸›ã‹ã‚‰è§£æ”¾ã•ã‚ŒãŸå®Ÿæ„Ÿ"',
      '"ç„¡é§„ã‚’çœã"': '"ç„¡é§„ã‚’çœã„ã¦åŠ¹ç‡åŒ–ã™ã‚‹"',
      '"ç¯€åº¦ã®ç¾å¾³"': '"ç¯€åº¦ã‚’ä¿ã¤ã“ã¨ã®ç¾å¾³"',
      '"ãƒŸã‚¹ã‚’é˜²ã"': '"æ…é‡ã«ãƒŸã‚¹ã‚’é˜²ãåŠªåŠ›"',
      
      // ãƒã‚¬ãƒ†ã‚£ãƒ–ãªçŠ¶æ…‹
      '"æ©Ÿä¼šã‚‚é€ƒã™"': '"ãƒãƒ£ãƒ³ã‚¹ã‚‚é€ƒã—ã¦ã—ã¾ã†"',
      '"ç–²ã‚Œæœã¦ã‚‹"': '"å®Œå…¨ã«ç–²ã‚Œæœã¦ã¦ã—ã¾ã†"',
      '"ä¿¡é ¼ã‚’å¤±ã†"': '"å‘¨ã‚Šã‹ã‚‰ã®ä¿¡é ¼ã‚’å¤±ã†"',
      '"æˆé•·ã®æ©Ÿä¼š"': '"å›°é›£ã‚‚æˆé•·ã®æ©Ÿä¼šã¨æ‰ãˆã‚‹"'
    };
    
    // 6æ–‡å­—ã®èª¬æ˜ã‚’ä¿®æ­£ï¼ˆ102ä»¶ã®ä¸»è¦ãªã‚‚ã®ï¼‰
    const sixCharFixes = {
      // ç’°å¢ƒãƒ»å ´æ‰€
      '"å®‰å®šã—ãŸç’°å¢ƒ"': '"å¤‰åŒ–ã®å°‘ãªã„å®‰å®šã—ãŸç’°å¢ƒ"',
      '"èª¿å’Œçš„ãªç’°å¢ƒ"': '"ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸèª¿å’Œçš„ãªç’°å¢ƒ"',
      '"æµå‹•çš„ãªç’°å¢ƒ"': '"å¸¸ã«å¤‰åŒ–ã™ã‚‹æµå‹•çš„ãªç’°å¢ƒ"',
      '"åˆºæ¿€çš„ãªç’°å¢ƒ"': '"æ–°ã—ã„åˆºæ¿€ã«æº€ã¡ãŸç’°å¢ƒ"',
      '"ç«¶äº‰çš„ãªç’°å¢ƒ"': '"ç«¶äº‰ãŒæ¿€ã—ã„ç’°å¢ƒ"',
      
      // äººã€…ãƒ»ä»²é–“
      '"è¡Œå‹•æ´¾ã®ä»²é–“"': '"è¡Œå‹•åŠ›ã®ã‚ã‚‹ä»²é–“ãŸã¡"',
      '"å‰å‘ããªäººã€…"': '"å‰å‘ããªè€ƒãˆã‚’æŒã¤äººã€…"',
      '"æ€æ…®æ·±ã„äººã€…"': '"æ·±ãè€ƒãˆã¦è¡Œå‹•ã™ã‚‹äººã€…"',
      '"è‡ªç«‹ã—ãŸäººã€…"': '"è‡ªç«‹å¿ƒã®å¼·ã„äººã€…"',
      
      // å¼·ã•ãƒ»åŠ›
      '"è±Šå¯Œãªäººè„ˆ"': '"è±Šå¯Œã§å¤šæ§˜ãªäººè„ˆã‚’æŒã¤"',
      '"é ¼ã‚Œã‚‹å­˜åœ¨"': '"ã¿ã‚“ãªã‹ã‚‰é ¼ã‚‰ã‚Œã‚‹å­˜åœ¨"',
      '"å†·é™ãªåˆ¤æ–­åŠ›"': '"å†·é™ã§çš„ç¢ºãªåˆ¤æ–­åŠ›"',
      '"è² ã‘ãªã„å¼·ã•"': '"ã©ã‚“ãªå›°é›£ã«ã‚‚è² ã‘ãªã„å¼·ã•"',
      '"ç‹¬ç«‹å¿ƒã®å¼·ã•"': '"ä»–ã«é ¼ã‚‰ãªã„ç‹¬ç«‹å¿ƒã®å¼·ã•"',
      
      // æ„Ÿæƒ…ãƒ»å¿ƒç†
      '"æ¥½ã—ã•ã¨å¸Œæœ›"': '"æ¥½ã—ã•ã¨å¸Œæœ›ã«æº€ã¡ãŸæ—¥ã€…"',
      '"æƒ³å®šå¤–ã«å¼±ã„"': '"æƒ³å®šå¤–ã®äº‹æ…‹ã«å¼±ã„å‚¾å‘"',
      '"æ™‚é–“ãŒã‹ã‹ã‚‹"': '"è§£æ±ºã«æ™‚é–“ãŒã‹ã‹ã‚‹"',
      '"é¨™ã•ã‚Œã‚„ã™ã„"': '"äººã‚’ä¿¡ã˜ã¦é¨™ã•ã‚Œã‚„ã™ã„"',
      '"å…¨ã¦ã‚’è³­ã‘ã‚‹"': '"å…¨ã¦ã‚’è³­ã‘ã¦æŒ‘æˆ¦ã™ã‚‹"',
      '"é€ƒã’ç™–ãŒã¤ã"': '"å›°é›£ã‹ã‚‰é€ƒã’ã‚‹ç™–ãŒã¤ã"',
      '"å®Œå…¨ã«æµå‹•åŒ–"': '"å›ºå®šè¦³å¿µã‚’å®Œå…¨ã«æµå‹•åŒ–ã™ã‚‹"',
      '"æºœã‚è¾¼ã¾ãªã„"': '"ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æºœã‚è¾¼ã¾ãªã„"',
      
      // å¯¾å‡¦ãƒ»å›å¾©
      '"ä¸€æ™‚çš„ãªä¿è­·"': '"ä¸€æ™‚çš„ã«èº«ã‚’å®ˆã‚‹ä¿è­·"',
      '"æ®µéšçš„ãªå¾©å¸°"': '"æ®µéšã‚’è¸ã‚“ã§å¾©å¸°ã™ã‚‹"',
      '"åŠ›å¼·ãæ–­å®šçš„"': '"åŠ›å¼·ãæ–­å®šçš„ã«è©±ã™"',
      '"åŠ›ã‚’ä½¿ã†æ©Ÿä¼š"': '"è‡ªåˆ†ã®åŠ›ã‚’ä½¿ã†æ©Ÿä¼š"',
      '"æ‰¹åˆ¤ã‚’é¿ã‘ã‚‹"': '"æ‰¹åˆ¤ã•ã‚Œã‚‹ã“ã¨ã‚’é¿ã‘ã‚‹"',
      '"æ¸©ã‹ãå®¶æ—çš„"': '"æ¸©ã‹ãå®¶æ—çš„ãªé›°å›²æ°—"',
      '"æ·±ã„ä¿¡é ¼ã¨çµ†"': '"æ·±ã„ä¿¡é ¼é–¢ä¿‚ã¨çµ†"',
      '"æ”¯ãˆåˆã„ã®åŠ›"': '"ãŠäº’ã„ã«æ”¯ãˆåˆã†åŠ›"',
      '"è‡ªç«‹å¿ƒãŒå¼±ã„"': '"è‡ªç«‹å¿ƒãŒå¼±ã„å‚¾å‘"',
      '"ç‹¬è‡ªæ€§ã®è©•ä¾¡"': '"ç‹¬è‡ªæ€§ãŒè©•ä¾¡ã•ã‚Œã‚‹"',
      
      // ãã®ä»–
      '"å­˜åœ¨æ„ŸãŒè–„ã„"': '"å­˜åœ¨æ„ŸãŒè–„ããªã‚ŠãŒã¡"',
      '"å”èª¿ã€å¦¥å”"': '"å”èª¿ã¨å¦¥å”ã‚’é‡è¦–ã™ã‚‹"',
      '"ç‘æƒ³ã€é™é¤Š"': '"ç‘æƒ³ã¨é™é¤Šã§å›å¾©ã™ã‚‹"',
      '"é€²å±•ãŒé…ã„"': '"ç‰©äº‹ã®é€²å±•ãŒé…ã„"',
      '"è¦æ±‚ã€äº¤æ¸‰"': '"è¦æ±‚ã¨äº¤æ¸‰ã‚’è¡Œã†"',
      '"å‰µé€ çš„æ˜‡è¯"': '"å‰µé€ çš„ã«å•é¡Œã‚’æ˜‡è¯ã™ã‚‹"'
    };
    
    // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase5.${timestamp}.js`, content);
    console.log(`ğŸ“ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ: hexagram-human-traits-v3.backup.phase5.${timestamp}.js\n`);
    
    // ä¿®æ­£é©ç”¨
    let totalFixCount = 0;
    
    console.log('ã€5æ–‡å­—ã®ä¿®æ­£ã€‘');
    let count5 = 0;
    Object.entries(fiveCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const originalContent = content;
      content = content.replace(regex, newText);
      if (originalContent !== content) {
        count5++;
        console.log(`âœ… ${old} â†’ ${newText}`);
      }
    });
    console.log(`å°è¨ˆ: ${count5}ä»¶\n`);
    
    console.log('ã€6æ–‡å­—ã®ä¿®æ­£ã€‘');
    let count6 = 0;
    Object.entries(sixCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const originalContent = content;
      content = content.replace(regex, newText);
      if (originalContent !== content) {
        count6++;
        console.log(`âœ… ${old} â†’ ${newText}`);
      }
    });
    console.log(`å°è¨ˆ: ${count6}ä»¶\n`);
    
    totalFixCount = count5 + count6;
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`=== ãƒ•ã‚§ãƒ¼ã‚º5å®Œäº† ===`);
    console.log(`ç·ä¿®æ­£ä»¶æ•°: ${totalFixCount}ä»¶`);
    console.log(`\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: node fix-short-descriptions-phase6.mjs`);
    
  } catch (error) {
    console.error('ã‚¨ãƒ©ãƒ¼:', error);
  }
}

fixPhase5Comprehensive();