<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Day 4 - ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ™ã‚¯ãƒˆãƒ«åˆ†æ</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            padding: 20px; 
            background: #1e1e1e; 
            color: #d4d4d4;
        }
        h1 { color: #4ec9b0; }
        .analysis { 
            background: #2d2d30; 
            padding: 15px; 
            margin: 20px 0;
            border-radius: 5px;
        }
        .segment {
            margin: 10px 0;
            padding: 10px;
            background: #252526;
            border-radius: 3px;
        }
        .weight-high { color: #f48771; }
        .weight-medium { color: #dcdcaa; }
        .weight-low { color: #569cd6; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid #3c3c3c;
        }
        th { background: #252526; }
    </style>
</head>
<body>
    <h1>Day 4 - ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ™ã‚¯ãƒˆãƒ«åˆ†æ</h1>
    
    <div class="analysis">
        <h2>ğŸ“Š ç¾åœ¨ã®ãƒ™ã‚¯ãƒˆãƒ«æ§‹æˆï¼ˆ656æ¬¡å…ƒï¼‰</h2>
        <table>
            <tr><th>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ</th><th>ç¯„å›²</th><th>æ¬¡å…ƒæ•°</th><th>ç¾åœ¨ã®é‡ã¿</th><th>å½¹å‰²</th></tr>
            <tr><td>Hexagram</td><td>0-100</td><td>100</td><td class="weight-medium">1.0</td><td>å¦ã®ç‰¹æ€§</td></tr>
            <tr><td>Position</td><td>100-200</td><td>100</td><td class="weight-high">1.5</td><td>çˆ»ä½ç½®ã®ç‰¹æ€§</td></tr>
            <tr><td>Text</td><td>200-300</td><td>100</td><td class="weight-high">1.8</td><td>ãƒ†ã‚­ã‚¹ãƒˆåˆ†æï¼ˆæœ€é‡è¦ï¼‰</td></tr>
            <tr><td>Change</td><td>300-400</td><td>100</td><td class="weight-medium">1.0</td><td>å¤‰åŒ–ãƒ»å‹•ç·š</td></tr>
            <tr><td>Temporal</td><td>400-500</td><td>100</td><td class="weight-low">0.8</td><td>æ™‚é–“çš„è¦ç´ </td></tr>
            <tr><td>Context</td><td>500-656</td><td>156</td><td class="weight-medium">1.2</td><td>æ–‡è„ˆæƒ…å ±</td></tr>
        </table>
    </div>
    
    <div id="results"></div>
    
    <script type="module">
        import { TextTo384LinesBridge } from './public/js/ai/TextTo384LinesBridge.js';
        
        async function analyzeVectors() {
            const bridge = new TextTo384LinesBridge();
            await bridge.initialize();
            
            // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
            const testCases = [
                { text: "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã™ã‚‹", expectedPosition: 5 },
                { text: "å”åŠ›ã—ã¦é€²ã‚ã‚‹", expectedPosition: 2 },
                { text: "å›°é›£ã«ç›´é¢ã™ã‚‹", expectedPosition: 3 },
                { text: "å¤‰åŒ–ã®æ™‚æœŸ", expectedPosition: 4 },
                { text: "å®Œæˆã«å‘ã‘ã¦", expectedPosition: 6 },
                { text: "æ–°ã—ãå§‹ã‚ã‚‹", expectedPosition: 1 }
            ];
            
            const results = {
                vectorAnalysis: [],
                similarityScores: [],
                coverageImpact: {}
            };
            
            // å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ãƒ™ã‚¯ãƒˆãƒ«åˆ†æ
            for (const testCase of testCases) {
                const analysis = await bridge.performComprehensiveAnalysis(testCase.text);
                const result = await bridge.analyzeText(testCase.text);
                
                results.vectorAnalysis.push({
                    text: testCase.text,
                    expected: testCase.expectedPosition,
                    actual: result.line_position,
                    vector: analysis.semantic_vectors,
                    match: result.line_position === testCase.expectedPosition
                });
            }
            
            // ã‚«ãƒãƒ¼ç‡ã¸ã®å½±éŸ¿åˆ†æ
            const uniqueLines = new Set();
            const testSamples = generateTestSamples();
            
            for (const sample of testSamples) {
                const result = await bridge.analyzeText(sample);
                const lineKey = `${result.hexagram_number}-${result.line_position}`;
                uniqueLines.add(lineKey);
            }
            
            results.coverageImpact = {
                uniqueLines: uniqueLines.size,
                coverageRate: ((uniqueLines.size / 384) * 100).toFixed(2)
            };
            
            displayAnalysis(results);
        }
        
        function generateTestSamples() {
            // ç°¡æ˜“çš„ãª100ã‚µãƒ³ãƒ—ãƒ«ç”Ÿæˆ
            const templates = [
                "æ–°ãŸãª", "å”åŠ›ã®", "å›°é›£ãª", "å¤‰åŒ–ã™ã‚‹", "å®Œæˆã—ãŸ",
                "ãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦", "ãƒãƒ¼ãƒ ã§", "å•é¡Œã‚’", "è»¢æ›æœŸã®", "æœ€çµ‚çš„ãª"
            ];
            const nouns = [
                "æŒ‘æˆ¦", "é–¢ä¿‚", "è©¦ç·´", "æ±ºæ–­", "æ®µéš",
                "è²¬ä»»", "ä½œæ¥­", "å±€é¢", "é¸æŠ", "çµæœ"
            ];
            
            const samples = [];
            for (const template of templates) {
                for (const noun of nouns) {
                    samples.push(template + noun);
                    if (samples.length >= 100) break;
                }
                if (samples.length >= 100) break;
            }
            return samples;
        }
        
        function displayAnalysis(results) {
            let html = '';
            
            // ãƒ™ã‚¯ãƒˆãƒ«ç²¾åº¦åˆ†æ
            html += '<div class="analysis">';
            html += '<h2>ğŸ¯ ãƒ™ã‚¯ãƒˆãƒ«ç²¾åº¦åˆ†æ</h2>';
            
            const matches = results.vectorAnalysis.filter(r => r.match).length;
            const accuracy = ((matches / results.vectorAnalysis.length) * 100).toFixed(1);
            
            html += `<p>ç²¾åº¦: ${accuracy}% (${matches}/${results.vectorAnalysis.length})</p>`;
            html += '<table>';
            html += '<tr><th>ãƒ†ã‚­ã‚¹ãƒˆ</th><th>æœŸå¾…ä½ç½®</th><th>å®Ÿéš›ä½ç½®</th><th>åˆ¤å®š</th></tr>';
            
            for (const item of results.vectorAnalysis) {
                const matchClass = item.match ? 'weight-high' : 'weight-low';
                const matchText = item.match ? 'âœ…' : 'âŒ';
                html += '<tr>';
                html += `<td>${item.text}</td>`;
                html += `<td>${item.expected}çˆ»</td>`;
                html += `<td>${item.actual}çˆ»</td>`;
                html += `<td class="${matchClass}">${matchText}</td>`;
                html += '</tr>';
            }
            html += '</table>';
            html += '</div>';
            
            // ã‚«ãƒãƒ¼ç‡åˆ†æ
            html += '<div class="analysis">';
            html += '<h2>ğŸ“ˆ ã‚«ãƒãƒ¼ç‡ã¸ã®å½±éŸ¿</h2>';
            html += `<p>ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°: ${results.coverageImpact.uniqueLines}å€‹</p>`;
            html += `<p>ã‚«ãƒãƒ¼ç‡: ${results.coverageImpact.coverageRate}%</p>`;
            html += '</div>';
            
            // æ”¹å–„ææ¡ˆ
            html += '<div class="analysis">';
            html += '<h2>ğŸ’¡ Day 4 æ”¹å–„ææ¡ˆ</h2>';
            html += '<h3>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé‡ã¿èª¿æ•´æ¡ˆ</h3>';
            html += '<ul>';
            html += '<li><strong>Text (200-300)</strong>: 1.8 â†’ 2.0ï¼ˆãƒ†ã‚­ã‚¹ãƒˆåˆ†æã‚’ã•ã‚‰ã«é‡è¦–ï¼‰</li>';
            html += '<li><strong>Position (100-200)</strong>: 1.5 â†’ 1.3ï¼ˆä½ç½®ã¸ã®ä¾å­˜ã‚’è»½æ¸›ï¼‰</li>';
            html += '<li><strong>Context (500-656)</strong>: 1.2 â†’ 1.5ï¼ˆæ–‡è„ˆæƒ…å ±ã‚’å¼·åŒ–ï¼‰</li>';
            html += '</ul>';
            
            html += '<h3>è¿½åŠ æ”¹å–„ç­–</h3>';
            html += '<ul>';
            html += '<li>TF-IDFé‡ã¿ã®å‹•çš„èª¿æ•´</li>';
            html += '<li>æœªä½¿ç”¨çˆ»ã¸ã®è¿½åŠ ãƒœãƒ¼ãƒŠã‚¹ï¼ˆ0.15â†’0.20ï¼‰</li>';
            html += '<li>ä½¿ç”¨é »åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£ã®æ®µéšçš„å¼·åŒ–</li>';
            html += '<li>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…ã§ã®éç·šå½¢å¤‰æ›å¼·åŒ–</li>';
            html += '</ul>';
            html += '</div>';
            
            document.getElementById('results').innerHTML = html;
        }
        
        analyzeVectors();
    </script>
</body>
</html>