<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Day 6 - å¦å˜ä½ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ï¼ˆTask 6-4ï¼‰</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            padding: 20px; 
            background: #1e1e1e; 
            color: #d4d4d4;
            max-width: 1600px;
            margin: 0 auto;
        }
        h1 { color: #4ec9b0; }
        h2 { color: #569cd6; }
        h3 { color: #dcdcaa; }
        
        .balance-section {
            background: #2d2d30;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .hexagram-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            margin: 20px 0;
        }
        
        .hexagram-cell {
            background: #252526;
            padding: 10px;
            text-align: center;
            border-radius: 3px;
            position: relative;
            min-height: 60px;
        }
        
        .hexagram-cell.used {
            background: #1a472a;
            border: 1px solid #4ec9b0;
        }
        
        .hexagram-cell.hot {
            background: #5a1e1e;
            border: 2px solid #f48771;
        }
        
        .hexagram-id {
            font-size: 0.8em;
            color: #808080;
        }
        
        .hexagram-name {
            font-size: 0.9em;
            margin: 5px 0;
        }
        
        .hexagram-count {
            font-weight: bold;
            color: #4ec9b0;
        }
        
        .heatmap-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid #3c3c3c;
        }
        
        th { background: #252526; }
        
        .chart-container {
            margin: 20px 0;
        }
        
        .distribution-bar {
            height: 30px;
            background: linear-gradient(to right, #4ec9b0, #569cd6);
            border-radius: 3px;
            margin: 5px 0;
        }
        
        .good { color: #4ec9b0; }
        .warning { color: #dcdcaa; }
        .bad { color: #f48771; }
    </style>
</head>
<body>
    <h1>Day 6 - å¦å˜ä½ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ï¼ˆTask 6-4ï¼‰</h1>
    
    <div id="analysis"></div>
    
    <script type="module">
        // 64å¦ã®åŸºæœ¬ãƒ‡ãƒ¼ã‚¿
        const hexagramNames = [
            'ä¹¾ç‚ºå¤©', 'å¤ç‚ºåœ°', 'æ°´é›·å±¯', 'å±±æ°´è’™', 'æ°´å¤©éœ€', 'å¤©æ°´è¨Ÿ', 'åœ°æ°´å¸«', 'æ°´åœ°æ¯”',
            'é¢¨å¤©å°ç•œ', 'å¤©æ¾¤å±¥', 'åœ°å¤©æ³°', 'å¤©åœ°å¦', 'å¤©ç«åŒäºº', 'ç«å¤©å¤§æœ‰', 'åœ°å±±è¬™', 'é›·åœ°è±«',
            'æ¾¤é›·éš', 'å±±é¢¨è ±', 'åœ°æ¾¤è‡¨', 'é¢¨åœ°è¦³', 'ç«é›·å™¬å—‘', 'å±±ç«è³', 'å±±åœ°å‰', 'åœ°é›·å¾©',
            'å¤©é›·ç„¡å¦„', 'å±±å¤©å¤§ç•œ', 'å±±é›·é ¤', 'æ¾¤é¢¨å¤§é', 'åç‚ºæ°´', 'é›¢ç‚ºç«', 'æ¾¤å±±å’¸', 'é›·é¢¨æ’',
            'å¤©å±±é¯', 'é›·å¤©å¤§å£®', 'ç«åœ°æ™‹', 'åœ°ç«æ˜å¤·', 'é¢¨ç«å®¶äºº', 'ç«æ¾¤ç½', 'æ°´å±±è¹‡', 'é›·æ°´è§£',
            'å±±æ¾¤æ', 'é¢¨é›·ç›Š', 'æ¾¤å¤©å¤¬', 'å¤©é¢¨å§¤', 'æ¾¤åœ°èƒ', 'åœ°é¢¨å‡', 'æ¾¤æ°´å›°', 'æ°´é¢¨äº•',
            'æ¾¤ç«é©', 'ç«é¢¨é¼', 'éœ‡ç‚ºé›·', 'è‰®ç‚ºå±±', 'é¢¨å±±æ¼¸', 'é›·æ¾¤å¸°å¦¹', 'é›·ç«è±Š', 'ç«å±±æ—…',
            'å·½ç‚ºé¢¨', 'å…Œç‚ºæ¾¤', 'é¢¨æ°´æ¸™', 'æ°´æ¾¤ç¯€', 'é¢¨æ¾¤ä¸­å­š', 'é›·å±±å°é', 'æ°´ç«æ—¢æ¸ˆ', 'ç«æ°´æœªæ¸ˆ'
        ];
        
        async function analyzeHexagramBalance() {
            // å‹•çš„ã«TextTo384LinesBridgeã‚’ãƒ­ãƒ¼ãƒ‰
            const script = document.createElement('script');
            script.src = './public/js/ai/TextTo384LinesBridge.js';
            await new Promise(resolve => {
                script.onload = resolve;
                document.head.appendChild(script);
            });
            
            const bridge = new window.TextTo384LinesBridge();
            await bridge.initialize();
            
            // 100å€‹ã®ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«ã§å¦åˆ†å¸ƒã‚’æ¸¬å®š
            const testSamples = generateTestSamples();
            
            // å¦ã”ã¨ã®ä½¿ç”¨çµ±è¨ˆ
            const hexagramStats = {};
            for (let i = 1; i <= 64; i++) {
                hexagramStats[i] = {
                    id: i,
                    name: hexagramNames[i - 1],
                    count: 0,
                    positions: [0, 0, 0, 0, 0, 0, 0],
                    lines: []
                };
            }
            
            let html = '';
            
            // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            html += '<div class="balance-section">';
            html += '<h2>ğŸ“Š å¦å˜ä½ã§ã®ä½¿ç”¨åˆ†å¸ƒæ¸¬å®šä¸­...</h2>';
            html += '<div id="progress"></div>';
            html += '</div>';
            
            document.getElementById('analysis').innerHTML = html;
            
            for (let i = 0; i < testSamples.length; i++) {
                const result = await bridge.analyzeText(testSamples[i]);
                const hexagramId = result.hexagram_number;
                const position = result.line_position;
                
                hexagramStats[hexagramId].count++;
                hexagramStats[hexagramId].positions[position]++;
                hexagramStats[hexagramId].lines.push(`${position}çˆ»`);
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
                if (i % 10 === 0) {
                    document.getElementById('progress').innerText = `${i + 1}/${testSamples.length} å®Œäº†`;
                }
            }
            
            // åˆ†æçµæœã®è¡¨ç¤º
            html = '';
            
            // ã‚µãƒãƒªãƒ¼
            html += '<div class="balance-section">';
            html += '<h2>ğŸ“ˆ å¦å˜ä½ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°åˆ†æçµæœ</h2>';
            
            // ä½¿ç”¨ã•ã‚ŒãŸå¦ã®æ•°
            const usedHexagrams = Object.values(hexagramStats).filter(h => h.count > 0);
            const unusedHexagrams = Object.values(hexagramStats).filter(h => h.count === 0);
            
            html += `<p>ä½¿ç”¨ã•ã‚ŒãŸå¦: <span class="good">${usedHexagrams.length}/64</span>`;
            html += ` (ã‚«ãƒãƒ¼ç‡: ${((usedHexagrams.length / 64) * 100).toFixed(1)}%)</p>`;
            html += `<p>æœªä½¿ç”¨ã®å¦: <span class="warning">${unusedHexagrams.length}å€‹</span></p>`;
            
            html += '</div>';
            
            // ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
            html += '<div class="balance-section">';
            html += '<h2>ğŸ—ºï¸ å¦ä½¿ç”¨ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—</h2>';
            
            html += '<div class="heatmap-legend">';
            html += '<div class="legend-item"><div class="legend-color" style="background: #252526;"></div><span>æœªä½¿ç”¨</span></div>';
            html += '<div class="legend-item"><div class="legend-color" style="background: #1a472a;"></div><span>ä½¿ç”¨æ¸ˆ</span></div>';
            html += '<div class="legend-item"><div class="legend-color" style="background: #5a1e1e;"></div><span>é«˜é »åº¦</span></div>';
            html += '</div>';
            
            html += '<div class="hexagram-grid">';
            for (let i = 1; i <= 64; i++) {
                const stat = hexagramStats[i];
                let className = 'hexagram-cell';
                if (stat.count > 3) className += ' hot';
                else if (stat.count > 0) className += ' used';
                
                html += `<div class="${className}">`;
                html += `<div class="hexagram-id">#${i}</div>`;
                html += `<div class="hexagram-name">${stat.name}</div>`;
                if (stat.count > 0) {
                    html += `<div class="hexagram-count">${stat.count}å›</div>`;
                }
                html += '</div>';
            }
            html += '</div>';
            html += '</div>';
            
            // ãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆï¼ˆä½¿ç”¨é »åº¦ãŒé«˜ã„å¦ï¼‰
            const hotspots = Object.values(hexagramStats)
                .filter(h => h.count > 0)
                .sort((a, b) => b.count - a.count)
                .slice(0, 10);
            
            html += '<div class="balance-section">';
            html += '<h2>ğŸ”¥ ãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆï¼ˆé«˜é »åº¦å¦ TOP10ï¼‰</h2>';
            html += '<table>';
            html += '<tr><th>é †ä½</th><th>å¦ç•ªå·</th><th>å¦å</th><th>ä½¿ç”¨å›æ•°</th><th>ä¸»ãªçˆ»</th></tr>';
            
            for (let i = 0; i < hotspots.length; i++) {
                const h = hotspots[i];
                const mainPosition = h.positions.indexOf(Math.max(...h.positions));
                html += '<tr>';
                html += `<td>${i + 1}</td>`;
                html += `<td>#${h.id}</td>`;
                html += `<td>${h.name}</td>`;
                html += `<td class="${h.count > 3 ? 'bad' : 'warning'}">${h.count}å›</td>`;
                html += `<td>${mainPosition}çˆ»ãŒä¸­å¿ƒ</td>`;
                html += '</tr>';
            }
            html += '</table>';
            html += '</div>';
            
            // ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ãƒãƒƒãƒˆï¼ˆæœªä½¿ç”¨ã¾ãŸã¯ä½é »åº¦ï¼‰
            const coldspots = Object.values(hexagramStats)
                .filter(h => h.count === 0)
                .slice(0, 10);
            
            if (coldspots.length > 0) {
                html += '<div class="balance-section">';
                html += '<h2>â„ï¸ ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ãƒãƒƒãƒˆï¼ˆæœªä½¿ç”¨å¦ï¼‰</h2>';
                html += '<p>ä»¥ä¸‹ã®å¦ãŒå…¨ãé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼š</p>';
                html += '<div style="display: flex; flex-wrap: wrap; gap: 10px;">';
                for (const h of coldspots) {
                    html += `<div class="hexagram-cell">`;
                    html += `<div class="hexagram-id">#${h.id}</div>`;
                    html += `<div class="hexagram-name">${h.name}</div>`;
                    html += '</div>';
                }
                if (unusedHexagrams.length > 10) {
                    html += `<div style="padding: 20px;">ä»–${unusedHexagrams.length - 10}å€‹...</div>`;
                }
                html += '</div>';
                html += '</div>';
            }
            
            // æ”¹å–„ææ¡ˆ
            html += '<div class="balance-section">';
            html += '<h2>ğŸ’¡ å¦å˜ä½ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°æ”¹å–„ææ¡ˆ</h2>';
            
            const avgUsage = testSamples.length / 64;
            const overusedCount = Object.values(hexagramStats).filter(h => h.count > avgUsage * 2).length;
            const underusedCount = unusedHexagrams.length;
            
            html += '<h3>ç¾çŠ¶ã®å•é¡Œç‚¹</h3>';
            html += '<ul>';
            if (overusedCount > 5) {
                html += `<li class="bad">éåº¦ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å¦: ${overusedCount}å€‹</li>`;
            }
            if (underusedCount > 20) {
                html += `<li class="warning">æœªä½¿ç”¨ã®å¦ãŒå¤šã™ãã‚‹: ${underusedCount}/64</li>`;
            }
            html += '</ul>';
            
            html += '<h3>æ¨å¥¨ã•ã‚Œã‚‹èª¿æ•´</h3>';
            html += '<ol>';
            html += '<li>é«˜é »åº¦å¦ã¸ã®è¿½åŠ ãƒšãƒŠãƒ«ãƒ†ã‚£å®Ÿè£…</li>';
            html += '<li>æœªä½¿ç”¨å¦ã¸ã®æ¢ç´¢ãƒœãƒ¼ãƒŠã‚¹å¢—åŠ </li>';
            html += '<li>å¦ã”ã¨ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å†é…åˆ†</li>';
            html += '<li>ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒ™ã‚¯ãƒˆãƒ«ã®å¦åˆ¥èª¿æ•´</li>';
            html += '</ol>';
            
            html += '</div>';
            
            document.getElementById('analysis').innerHTML = html;
        }
        
        function generateTestSamples() {
            // å¤šæ§˜ãªãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«ã‚’ç”Ÿæˆ
            const samples = [];
            
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚µãƒ³ãƒ—ãƒ«
            const categories = {
                beginning: ['æ–°ã—ã„å§‹ã¾ã‚Š', 'é–‹å§‹', 'ç€æ‰‹', 'ç«‹ã¡ä¸Šã’', 'å‰µå§‹'],
                cooperation: ['å”åŠ›é–¢ä¿‚', 'ãƒãƒ¼ãƒ ä½œæ¥­', 'é€£æº', 'å…±åŒä½œæ¥­', 'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—'],
                challenge: ['å›°é›£å…‹æœ', 'å•é¡Œè§£æ±º', 'è©¦ç·´', 'éšœå®³', 'é€†å¢ƒ'],
                change: ['å¤‰åŒ–å¯¾å¿œ', 'è»¢æ›æœŸ', 'ç§»è¡Œ', 'èª¿æ•´', 'é©å¿œ'],
                leadership: ['ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—', 'çµ±ç‡', 'æŒ‡å°', 'ç®¡ç†', 'è²¬ä»»'],
                completion: ['å®Œæˆæ®µéš', 'çµ‚äº†', 'é”æˆ', 'çµæœ', 'å®Œäº†'],
                decision: ['æ±ºæ–­', 'åˆ¤æ–­', 'é¸æŠ', 'æ±ºå®š', 'æ–¹é‡'],
                planning: ['è¨ˆç”»', 'æˆ¦ç•¥', 'ä¼ç”»', 'è¨­è¨ˆ', 'æ§‹æƒ³']
            };
            
            for (const [category, words] of Object.entries(categories)) {
                for (const word of words) {
                    samples.push(word);
                    // çµ„ã¿åˆã‚ã›ã‚‚è¿½åŠ 
                    if (samples.length < 100) {
                        samples.push(word + 'ã«ã¤ã„ã¦');
                        samples.push(word + 'ã®æ™‚æœŸ');
                    }
                }
            }
            
            // 100å€‹ã«ãªã‚‹ã¾ã§è¿½åŠ ã®ã‚µãƒ³ãƒ—ãƒ«
            const additionalWords = [
                'æˆé•·', 'ç™ºå±•', 'å®‰å®š', 'èª¿å’Œ', 'å‰µé€ ', 'é©æ–°', 'æ”¹å–„', 'æœ€é©åŒ–',
                'åˆ†æ', 'è©•ä¾¡', 'æ¤œè¨', 'å®Ÿè¡Œ', 'å±•é–‹', 'æ¨é€²', 'ä¿ƒé€²', 'å¼·åŒ–'
            ];
            
            while (samples.length < 100) {
                const word = additionalWords[samples.length % additionalWords.length];
                samples.push(word);
            }
            
            return samples.slice(0, 100);
        }
        
        analyzeHexagramBalance();
    </script>
</body>
</html>