<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>D-2-6/7/8: Phase 2åã‚Šæ˜¯æ­£æ¤œè¨¼ï¼ˆ200ã‚µãƒ³ãƒ—ãƒ«ï¼‰</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .success { color: #4ec9b0; }
        .warning { color: #dcdcaa; }
        .error { color: #f48771; }
        .info { color: #9cdcfe; }
        .result-box {
            background: #252526;
            border: 1px solid #3e3e42;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .metric-card {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .metric-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #2d2d30;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ec9b0, #569cd6);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¬ D-2-6/7/8: Phase 2 åã‚Šæ˜¯æ­£æ¤œè¨¼ï¼ˆ200ã‚µãƒ³ãƒ—ãƒ«ï¼‰</h1>
    <div id="status">ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...</div>
    <div id="progress-container" style="display: none;">
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
        <span id="progress-text">0/200</span>
    </div>
    <div id="results"></div>

    <script type="module">
        import { TextTo384LinesBridge } from './public/js/ai/TextTo384LinesBridge.js';
        
        // Phase 2ç”¨ã®ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«ç”Ÿæˆ
        function generatePhase2Samples() {
            const samples = [];
            
            // å„çˆ»ä½ç½®ã«å¯¾å¿œã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå„20å€‹ï¼‰
            const positionTexts = {
                // 1çˆ»: å§‹ã¾ã‚Š
                1: [
                    "æ–°ã—ã„å§‹ã¾ã‚Š", "åˆã‚ã¦ã®æŒ‘æˆ¦", "ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹", "ç¬¬ä¸€æ­©ã‚’è¸ã¿å‡ºã™", "èµ·å‹•ã™ã‚‹",
                    "å‰µå§‹ã™ã‚‹æ™‚", "é–‹å§‹ã®åˆå›³", "ç€æ‰‹ã™ã‚‹", "å§‹ã¾ã‚Šã®æ®µéš", "æ–°è¦äº‹æ¥­",
                    "åˆæœŸæ®µéš", "å‡ºç™ºç‚¹", "æ–°ãŸãªã‚¹ã‚¿ãƒ¼ãƒˆ", "å§‹å‹•ã™ã‚‹", "ç«‹ã¡ä¸Šã’",
                    "åˆå¿ƒã«å¸°ã‚‹", "æ–°è¦é–‹æ‹“", "æœ€åˆã®ä¸€æ­©", "é–‹å§‹æº–å‚™", "å§‹ã¾ã‚Šã®æ™‚"
                ],
                // 2çˆ»: å”åŠ›ãƒ»é–¢ä¿‚
                2: [
                    "å”åŠ›é–¢ä¿‚ã‚’ç¯‰ã", "ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯", "å†…é¢çš„ãªæˆé•·", "ç›¸è«‡ã™ã‚‹", "æ”¯æ´ã‚’æ±‚ã‚ã‚‹",
                    "å”èª¿ã™ã‚‹", "å”åƒä½œæ¥­", "é€£æºã‚’å¼·ã‚ã‚‹", "å…±åŒã§é€²ã‚ã‚‹", "é–¢ä¿‚æ€§æ§‹ç¯‰",
                    "ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—", "ç›¸äº’æ”¯æ´", "å”åŠ›ä½“åˆ¶", "é€£å¸¯æ„Ÿ", "æ”¯ãˆåˆã†",
                    "å†…çœã™ã‚‹", "é–¢ä¿‚æ”¹å–„", "å”åŠ›è€…ã‚’å¾—ã‚‹", "ãƒãƒ¼ãƒ çµæˆ", "å”èª¿æ€§"
                ],
                // 3çˆ»: å›°é›£ãƒ»è©¦ç·´
                3: [
                    "å›°é›£ã«ç›´é¢", "è©¦ç·´ã®æ™‚", "æŒ‘æˆ¦çš„ãªèª²é¡Œ", "å•é¡Œè§£æ±º", "å£ã«ã¶ã¤ã‹ã‚‹",
                    "è‘›è—¤ã™ã‚‹", "è‹¦åŠ´ã™ã‚‹", "éšœå®³ã‚’ä¹—ã‚Šè¶Šãˆã‚‹", "é€†å¢ƒã«ç«‹ã¤", "èª²é¡Œå…‹æœ",
                    "é›£ã—ã„å±€é¢", "è©¦ç·´ã‚’å—ã‘ã‚‹", "å›°é›£ãªé“", "æŒ‘æˆ¦ãŒå¿…è¦", "å•é¡Œã«å–ã‚Šçµ„ã‚€",
                    "è‘›è—¤ã®ä¸­", "è‹¦åŠ´ã®æœ«", "éšœå®³é™¤å»", "é€†å¢ƒã‹ã‚‰ã®å­¦ã³", "èª²é¡Œã«å‘ãåˆã†"
                ],
                // 4çˆ»: å¤‰åŒ–ãƒ»è»¢æ›
                4: [
                    "å¤‰åŒ–ã®æ™‚æœŸ", "è»¢æ›ç‚¹", "ç§»è¡ŒæœŸ", "å²è·¯ã«ç«‹ã¤", "è»¢æ©Ÿã‚’è¿ãˆã‚‹",
                    "å¤‰æ›´ã™ã‚‹", "èª¿æ•´ãŒå¿…è¦", "é¸æŠã®æ™‚", "æ±ºæ–­ã™ã‚‹", "åˆ†å²ç‚¹",
                    "æ–¹å‘è»¢æ›", "ç’°å¢ƒå¤‰åŒ–", "æ–°ãŸãªå±€é¢", "è»¢è·ã‚’è€ƒãˆã‚‹", "å¤‰é©æœŸ",
                    "ç§»è¡Œã™ã‚‹", "å²è·¯ã§ã®é¸æŠ", "è»¢æ©Ÿã‚’æ´»ã‹ã™", "å¤‰æ›´ã‚’æ±ºã‚ã‚‹", "èª¿æ•´æœŸé–“"
                ],
                // 5çˆ»: æˆç†Ÿãƒ»ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—
                5: [
                    "ãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦", "æˆç†Ÿã—ãŸåˆ¤æ–­", "çµ±ç‡ã™ã‚‹", "æŒ‡å°çš„ç«‹å ´", "ç®¡ç†è²¬ä»»",
                    "æ¨©é™ã‚’æŒã¤", "ä¸­å¿ƒçš„å½¹å‰²", "ä¸»å°ã™ã‚‹", "çµ±æ‹¬æ¥­å‹™", "æ±ºå®šæ¨©",
                    "åˆ¤æ–­ã‚’ä¸‹ã™", "æ–¹å‘æ€§ã‚’ç¤ºã™", "æˆ¦ç•¥ç«‹æ¡ˆ", "ãƒˆãƒƒãƒ—ã®ç«‹å ´", "çµŒå–¶åˆ¤æ–­",
                    "å½¹å“¡ã¨ã—ã¦", "å¹¹éƒ¨ã®è²¬ä»»", "ä¸Šç´šç®¡ç†è·", "é«˜ä½ã®æ±ºæ–­", "è¦è·ã«å°±ã"
                ],
                // 6çˆ»: å®Œæˆãƒ»çµ‚äº†
                6: [
                    "å®Œæˆã™ã‚‹", "çµ‚äº†æ®µéš", "çµæœãŒå‡ºã‚‹", "æœ€çµ‚å±€é¢", "å®Œäº†ã™ã‚‹",
                    "ç· çµã™ã‚‹", "æœ€å¾Œã®ä»•ä¸Šã’", "æ¥µè‡´ã«é”ã™ã‚‹", "å®Œçµã™ã‚‹", "æˆå°±ã™ã‚‹",
                    "åˆ°é”ç‚¹", "çµ‚ã‚ã‚Šã‚’è¿ãˆã‚‹", "çµè«–ã‚’å‡ºã™", "æœ€çµ‚æ®µéš", "å®Œäº†å ±å‘Š",
                    "çµ‚çµã™ã‚‹", "æœ€å¾Œã®è©°ã‚", "æ¥µé™ã¾ã§", "å®Œæˆå½¢", "çµ‚äº†å®£è¨€"
                ]
            };
            
            // å„ä½ç½®ã‹ã‚‰å‡ç­‰ã«é¸æŠï¼ˆåˆè¨ˆ120å€‹ï¼‰
            Object.entries(positionTexts).forEach(([pos, texts]) => {
                texts.forEach(text => {
                    samples.push(text);
                });
            });
            
            // ãƒŸãƒƒã‚¯ã‚¹ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå‡ç­‰æ€§ãƒ†ã‚¹ãƒˆç”¨ãƒ»80å€‹ï¼‰
            const neutralTexts = [
                "æ—¥å¸¸æ¥­å‹™", "é€šå¸¸ä½œæ¥­", "å®šä¾‹ä¼šè­°", "å ±å‘Šæ›¸ä½œæˆ", "ãƒ‡ãƒ¼ã‚¿åˆ†æ",
                "ãƒ—ãƒ¬ã‚¼ãƒ³æº–å‚™", "ãƒ¡ãƒ¼ãƒ«å‡¦ç†", "è³‡æ–™ç¢ºèª", "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«èª¿æ•´", "æ‰“ã¡åˆã‚ã›",
                "ä¼ç”»ç«‹æ¡ˆ", "äºˆç®—ç®¡ç†", "é€²æ—ç¢ºèª", "å“è³ªãƒã‚§ãƒƒã‚¯", "é¡§å®¢å¯¾å¿œ",
                "å¸‚å ´èª¿æŸ»", "ç«¶åˆåˆ†æ", "æˆ¦ç•¥ä¼šè­°", "äººäº‹è©•ä¾¡", "æ•™è‚²ç ”ä¿®"
            ];
            
            // å„ãƒ†ã‚­ã‚¹ãƒˆã‚’4å›ãšã¤ä½¿ç”¨
            neutralTexts.forEach(text => {
                for (let i = 0; i < 4; i++) {
                    samples.push(`${text}${i + 1}`);
                }
            });
            
            return samples;
        }
        
        async function runPhase2Test() {
            const statusEl = document.getElementById('status');
            const progressContainer = document.getElementById('progress-container');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const resultsEl = document.getElementById('results');
            
            try {
                statusEl.innerHTML = '<span class="warning">TextTo384LinesBridgeåˆæœŸåŒ–ä¸­...</span>';
                const bridge = new TextTo384LinesBridge();
                await bridge.initialize();
                
                statusEl.innerHTML = '<span class="info">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ï¼ˆ200ã‚µãƒ³ãƒ—ãƒ«ï¼‰...</span>';
                progressContainer.style.display = 'block';
                
                const samples = generatePhase2Samples();
                const results = {
                    positionCount: [0, 0, 0, 0, 0, 0, 0],
                    temporalPhaseCount: {},
                    processingTimes: [],
                    totalSamples: samples.length
                };
                
                // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                for (let i = 0; i < samples.length; i++) {
                    const text = samples[i];
                    const startTime = performance.now();
                    const result = await bridge.analyzeText(text);
                    const processingTime = performance.now() - startTime;
                    
                    results.processingTimes.push(processingTime);
                    
                    const position = result.line_position;
                    if (position <= 6) {
                        results.positionCount[position - 1]++;
                    } else {
                        results.positionCount[6]++;
                    }
                    
                    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
                    if ((i + 1) % 10 === 0) {
                        const progress = ((i + 1) / samples.length * 100);
                        progressFill.style.width = `${progress}%`;
                        progressText.textContent = `${i + 1}/${samples.length}`;
                    }
                }
                
                // çµæœè¡¨ç¤º
                let html = '';
                
                // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰
                html += '<div class="metric-grid">';
                
                // 2çˆ»ã®åã‚Šç¢ºèªï¼ˆD-2-6ï¼‰
                const line2Percentage = (results.positionCount[1] / results.totalSamples * 100);
                const line2Success = line2Percentage <= 20;
                html += `<div class="metric-card">
                    <div class="info">2çˆ»é¸æŠç‡</div>
                    <div class="metric-value ${line2Success ? 'success' : 'error'}">${line2Percentage.toFixed(1)}%</div>
                    <div>${line2Success ? 'âœ… ç›®æ¨™é”æˆ (â‰¤20%)' : 'âŒ åã‚Šã‚ã‚Š (>20%)'}</div>
                </div>`;
                
                // 6çˆ»ã®åã‚Šç¢ºèªï¼ˆD-2-7ï¼‰
                const line6Percentage = (results.positionCount[5] / results.totalSamples * 100);
                const line6Success = line6Percentage <= 20;
                html += `<div class="metric-card">
                    <div class="info">6çˆ»é¸æŠç‡</div>
                    <div class="metric-value ${line6Success ? 'success' : 'error'}">${line6Percentage.toFixed(1)}%</div>
                    <div>${line6Success ? 'âœ… ç›®æ¨™é”æˆ (â‰¤20%)' : 'âŒ åã‚Šã‚ã‚Š (>20%)'}</div>
                </div>`;
                
                // å…¨ä½“ãƒãƒ©ãƒ³ã‚¹ï¼ˆD-2-8ï¼‰
                const maxPercentage = Math.max(...results.positionCount.slice(0, 6)) / results.totalSamples * 100;
                const minPercentage = Math.min(...results.positionCount.slice(0, 6)) / results.totalSamples * 100;
                const balanceScore = maxPercentage - minPercentage;
                const balanceSuccess = balanceScore <= 15; // æœ€å¤§ã¨æœ€å°ã®å·®ãŒ15%ä»¥å†…
                
                html += `<div class="metric-card">
                    <div class="info">ãƒãƒ©ãƒ³ã‚¹ã‚¹ã‚³ã‚¢</div>
                    <div class="metric-value ${balanceSuccess ? 'success' : 'warning'}">${balanceScore.toFixed(1)}%</div>
                    <div>æœ€å¤§å·®: ${balanceSuccess ? 'âœ… è‰¯å¥½' : 'âš ï¸ è¦æ”¹å–„'}</div>
                </div>`;
                
                html += '</div>';
                
                // çˆ»ä½ç½®åˆ†å¸ƒè©³ç´°
                html += '<div class="result-box">';
                html += '<h3>ğŸ“Š çˆ»ä½ç½®åˆ†å¸ƒï¼ˆç›®æ¨™: å„20%Â±5%ï¼‰</h3>';
                html += '<pre>';
                
                results.positionCount.slice(0, 6).forEach((count, idx) => {
                    const percentage = (count / results.totalSamples * 100).toFixed(1);
                    const bar = 'â–ˆ'.repeat(Math.round(percentage));
                    const isInRange = percentage >= 15 && percentage <= 25;
                    const colorClass = isInRange ? 'success' : (percentage >= 10 && percentage <= 30 ? 'warning' : 'error');
                    html += `${idx + 1}çˆ»: ${count.toString().padStart(3)}å€‹ (${percentage.padStart(5)}%) `;
                    html += `<span class="${colorClass}">${bar}</span>`;
                    html += isInRange ? ' âœ…' : (percentage >= 10 && percentage <= 30 ? ' âš ï¸' : ' âŒ');
                    html += '\n';
                });
                
                html += '</pre></div>';
                
                // Phase 2ã‚¿ã‚¹ã‚¯é”æˆçŠ¶æ³
                html += '<div class="result-box">';
                html += '<h3>âœ… D-2ã‚¿ã‚¹ã‚¯é”æˆçŠ¶æ³</h3>';
                html += '<pre>';
                
                const tasks = [
                    { id: 'D-2-1', desc: 'detectTemporalPhaseæ”¹ä¿®é–‹å§‹', done: true },
                    { id: 'D-2-2', desc: 'ãƒ•ã‚§ãƒ¼ã‚ºå®šç¾©ã®è¦‹ç›´ã—', done: true },
                    { id: 'D-2-3', desc: 'çˆ»ä½ç½®ãƒãƒƒãƒ”ãƒ³ã‚°ä½œæˆ', done: true },
                    { id: 'D-2-4', desc: 'assignTemporalPhaseæ”¹è‰¯', done: true },
                    { id: 'D-2-5', desc: 'è¤‡æ•°ãƒ•ã‚§ãƒ¼ã‚ºå‰²ã‚Šå½“ã¦å®Ÿè£…', done: true },
                    { id: 'D-2-6', desc: `2çˆ»åã‚Šç¢ºèªï¼ˆâ‰¤20%ï¼‰`, done: line2Success },
                    { id: 'D-2-7', desc: `6çˆ»åã‚Šç¢ºèªï¼ˆâ‰¤20%ï¼‰`, done: line6Success },
                    { id: 'D-2-8', desc: `å…¨ä½“ãƒãƒ©ãƒ³ã‚¹æ¸¬å®š`, done: true },
                    { id: 'D-2-9', desc: `èª¿æ•´ã¨å†ãƒ†ã‚¹ãƒˆ`, done: balanceSuccess }
                ];
                
                tasks.forEach(task => {
                    const status = task.done ? 'âœ…' : 'âŒ';
                    const color = task.done ? 'success' : 'error';
                    html += `<span class="${color}">${status} ${task.id}: ${task.desc}</span>\n`;
                });
                
                html += '\n<span class="info">ç·åˆåˆ¤å®š: ';
                if (line2Success && line6Success && balanceSuccess) {
                    html += '<span class="success">Phase 2å®Œäº† - åã‚Šæ˜¯æ­£æˆåŠŸï¼</span>';
                } else {
                    html += '<span class="warning">è¿½åŠ èª¿æ•´ãŒå¿…è¦</span>';
                }
                html += '</span>';
                
                html += '</pre></div>';
                
                // å¹³å‡å‡¦ç†æ™‚é–“
                const avgTime = results.processingTimes.reduce((a, b) => a + b, 0) / results.processingTimes.length;
                html += `<div class="result-box">
                    <h3>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h3>
                    <pre>å¹³å‡å‡¦ç†æ™‚é–“: <span class="${avgTime < 20 ? 'success' : 'warning'}">${avgTime.toFixed(2)}ms</span></pre>
                </div>`;
                
                resultsEl.innerHTML = html;
                statusEl.innerHTML = '<span class="success">âœ… ãƒ†ã‚¹ãƒˆå®Œäº†</span>';
                progressContainer.style.display = 'none';
                
            } catch (error) {
                statusEl.innerHTML = `<span class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                console.error(error);
            }
        }
        
        runPhase2Test();
    </script>
</body>
</html>