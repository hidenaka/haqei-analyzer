<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Day 6 - å…¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆTask 6-1ï¼‰</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            padding: 20px; 
            background: #1e1e1e; 
            color: #d4d4d4;
            max-width: 1600px;
            margin: 0 auto;
        }
        h1 { color: #4ec9b0; }
        h2 { color: #569cd6; }
        h3 { color: #dcdcaa; }
        
        .param-section {
            background: #2d2d30;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .param-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .param-card {
            background: #252526;
            padding: 15px;
            border-radius: 5px;
        }
        
        .param-value {
            font-size: 1.2em;
            color: #4ec9b0;
            font-weight: bold;
        }
        
        .param-change {
            color: #dcdcaa;
            font-size: 0.9em;
        }
        
        .improved { color: #4ec9b0; }
        .warning { color: #dcdcaa; }
        .critical { color: #f48771; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid #3c3c3c;
        }
        
        th { background: #252526; }
        
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #252526;
            border-radius: 5px;
        }
        
        .bar {
            height: 20px;
            background: linear-gradient(to right, #4ec9b0, #569cd6);
            margin: 5px 0;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>Day 6 - å…¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆTask 6-1ï¼‰</h1>
    
    <div id="analysis"></div>
    
    <script type="module">
        import { TextTo384LinesBridge } from './public/js/ai/TextTo384LinesBridge.js';
        
        async function analyzeAllParameters() {
            const bridge = new TextTo384LinesBridge();
            await bridge.initialize();
            
            // Day 1-5ã§èª¿æ•´ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ç¾çŠ¶
            const currentParams = {
                positionWeights: {
                    name: 'ä½ç½®é‡ã¿',
                    values: [
                        { position: 1, initial: 0.50, current: 0.50, change: 'ç¶­æŒ' },
                        { position: 2, initial: 0.48, current: 0.43, change: 'Day3: -0.05' },
                        { position: 3, initial: 0.52, current: 0.58, change: 'Day3: +0.06' },
                        { position: 4, initial: 0.55, current: 0.60, change: 'Day3: +0.05' },
                        { position: 5, initial: 0.50, current: 0.70, change: 'Day2: +0.20' },
                        { position: 6, initial: 0.45, current: 0.40, change: 'Day3: -0.05' }
                    ]
                },
                explorationNoise: {
                    name: 'æ¢ç´¢ãƒã‚¤ã‚º',
                    values: [
                        { type: 'primaryNoise', range: '0-0.2', change: 'Day2: å¢—å¼·' },
                        { type: 'secondaryNoise', range: '0-0.1', change: 'è¿½åŠ ' },
                        { type: 'tertiaryNoise', range: '0-0.05', change: 'è¿½åŠ ' },
                        { type: 'unusedBonus', value: 0.20, change: 'Day4: 0.15â†’0.20' },
                        { type: 'rareBonus', value: 0.10, change: 'Day4: 0.08â†’0.10' }
                    ]
                },
                semanticWeights: {
                    name: 'ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé‡ã¿',
                    values: [
                        { segment: 'hexagram', weight: 1.0, change: 'ç¶­æŒ' },
                        { segment: 'position', weight: 1.3, change: 'Day4: 1.5â†’1.3' },
                        { segment: 'text', weight: 2.0, change: 'Day4: 1.8â†’2.0' },
                        { segment: 'change', weight: 1.1, change: 'Day4: 1.0â†’1.1' },
                        { segment: 'temporal', weight: 0.8, change: 'ç¶­æŒ' },
                        { segment: 'context', weight: 1.5, change: 'Day4: 1.2â†’1.5' }
                    ]
                },
                penaltySystem: {
                    name: 'ä½¿ç”¨é »åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£',
                    values: [
                        { usage: 1, penalty: 0.90, change: 'Day4: 0.95â†’0.90' },
                        { usage: 2, penalty: 0.75, change: 'Day4: 0.85â†’0.75' },
                        { usage: 3, penalty: 0.55, change: 'Day4: 0.70â†’0.55' },
                        { usage: 4, penalty: 0.35, change: 'Day4: 0.50â†’0.35' },
                        { usage: 5, penalty: 0.20, change: 'Day4: æ–°è¦è¿½åŠ ' }
                    ]
                },
                keywordCounts: {
                    name: 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ•°',
                    values: [
                        { position: 1, count: 25, change: 'ç¶­æŒ' },
                        { position: 2, count: 15, change: 'Day3: 25â†’15' },
                        { position: 3, count: 35, change: 'Day3: 25â†’35ï¼ˆ+10ï¼‰' },
                        { position: 4, count: 35, change: 'Day3: 25â†’35ï¼ˆ+10ï¼‰' },
                        { position: 5, count: 45, change: 'Day2: 25â†’45ï¼ˆ+20ï¼‰' },
                        { position: 6, count: 15, change: 'Day3: 26â†’15' }
                    ]
                }
            };
            
            // ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«ã§ç¾çŠ¶ç¢ºèª
            const testSamples = [
                'æ–°ã—ã„æŒ‘æˆ¦', 'å”åŠ›é–¢ä¿‚', 'å›°é›£å…‹æœ', 'å¤‰åŒ–å¯¾å¿œ',
                'ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—', 'å®Œæˆæ®µéš', 'æ—¥å¸¸æ¥­å‹™', 'æˆ¦ç•¥ç«‹æ¡ˆ'
            ];
            
            const testResults = {
                positionDistribution: [0, 0, 0, 0, 0, 0, 0],
                uniqueLines: new Set()
            };
            
            for (const sample of testSamples) {
                const result = await bridge.analyzeText(sample);
                testResults.positionDistribution[result.line_position]++;
                testResults.uniqueLines.add(`${result.hexagram_number}-${result.line_position}`);
            }
            
            displayAnalysis(currentParams, testResults);
        }
        
        function displayAnalysis(params, testResults) {
            let html = '';
            
            // ã‚µãƒãƒªãƒ¼
            html += '<div class="param-section">';
            html += '<h2>ğŸ“Š Day 1-5 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ã‚µãƒãƒªãƒ¼</h2>';
            html += '<p>ã“ã‚Œã¾ã§ã«èª¿æ•´ã•ã‚ŒãŸã™ã¹ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ç¾çŠ¶ã¨ã€ãã®å½±éŸ¿ã‚’åˆ†æã—ã¾ã™ã€‚</p>';
            html += '</div>';
            
            // ä½ç½®é‡ã¿
            html += '<div class="param-section">';
            html += '<h2>1ï¸âƒ£ ä½ç½®é‡ã¿ï¼ˆPosition Weightsï¼‰</h2>';
            html += '<table>';
            html += '<tr><th>çˆ»ä½ç½®</th><th>åˆæœŸå€¤</th><th>ç¾åœ¨å€¤</th><th>å¤‰æ›´</th><th>å½±éŸ¿</th></tr>';
            
            for (const pw of params.positionWeights.values) {
                const changeClass = pw.change.includes('+') ? 'improved' : 
                                   pw.change.includes('-') ? 'warning' : '';
                const impact = analyzePositionWeightImpact(pw.position, pw.current);
                html += '<tr>';
                html += `<td>${pw.position}çˆ»</td>`;
                html += `<td>${pw.initial.toFixed(2)}</td>`;
                html += `<td class="param-value">${pw.current.toFixed(2)}</td>`;
                html += `<td class="${changeClass}">${pw.change}</td>`;
                html += `<td>${impact}</td>`;
                html += '</tr>';
            }
            html += '</table>';
            html += '</div>';
            
            // æ¢ç´¢ãƒã‚¤ã‚º
            html += '<div class="param-section">';
            html += '<h2>2ï¸âƒ£ æ¢ç´¢ãƒã‚¤ã‚ºï¼ˆExploration Noiseï¼‰</h2>';
            html += '<div class="param-grid">';
            
            for (const noise of params.explorationNoise.values) {
                html += '<div class="param-card">';
                html += `<h3>${noise.type}</h3>`;
                if (noise.value !== undefined) {
                    html += `<div class="param-value">${noise.value}</div>`;
                } else {
                    html += `<div class="param-value">${noise.range}</div>`;
                }
                html += `<div class="param-change">${noise.change}</div>`;
                html += '</div>';
            }
            html += '</div>';
            html += '</div>';
            
            // ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯é‡ã¿
            html += '<div class="param-section">';
            html += '<h2>3ï¸âƒ£ ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé‡ã¿</h2>';
            html += '<div class="chart-container">';
            
            for (const seg of params.semanticWeights.values) {
                const width = seg.weight * 40;
                html += `<div style="margin: 10px 0;">`;
                html += `<div style="display: flex; align-items: center;">`;
                html += `<div style="width: 100px;">${seg.segment}</div>`;
                html += `<div class="bar" style="width: ${width}%;"></div>`;
                html += `<span style="margin-left: 10px;" class="param-value">${seg.weight}</span>`;
                html += `<span style="margin-left: 10px;" class="param-change">${seg.change}</span>`;
                html += `</div>`;
                html += `</div>`;
            }
            html += '</div>';
            html += '</div>';
            
            // ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ 
            html += '<div class="param-section">';
            html += '<h2>4ï¸âƒ£ ä½¿ç”¨é »åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£</h2>';
            html += '<table>';
            html += '<tr><th>ä½¿ç”¨å›æ•°</th><th>ãƒšãƒŠãƒ«ãƒ†ã‚£</th><th>å¤‰æ›´</th></tr>';
            
            for (const penalty of params.penaltySystem.values) {
                html += '<tr>';
                html += `<td>${penalty.usage}å›</td>`;
                html += `<td class="param-value">${penalty.penalty.toFixed(2)}</td>`;
                html += `<td class="param-change">${penalty.change}</td>`;
                html += '</tr>';
            }
            html += '</table>';
            html += '</div>';
            
            // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ•°
            html += '<div class="param-section">';
            html += '<h2>5ï¸âƒ£ ä½ç½®åˆ¥ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ•°</h2>';
            html += '<table>';
            html += '<tr><th>çˆ»ä½ç½®</th><th>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ•°</th><th>å¤‰æ›´</th></tr>';
            
            for (const kw of params.keywordCounts.values) {
                const changeClass = kw.change.includes('â†’15') ? 'warning' :
                                   kw.change.includes('+') ? 'improved' : '';
                html += '<tr>';
                html += `<td>${kw.position}çˆ»</td>`;
                html += `<td class="param-value">${kw.count}å€‹</td>`;
                html += `<td class="${changeClass}">${kw.change}</td>`;
                html += '</tr>';
            }
            html += '</table>';
            html += '</div>';
            
            // ç›¸äº’å½±éŸ¿ã®åˆ†æ
            html += '<div class="param-section">';
            html += '<h2>ğŸ”„ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç›¸äº’å½±éŸ¿åˆ†æ</h2>';
            html += '<h3>å¼·åŒ–ã•ã‚ŒãŸé ˜åŸŸ</h3>';
            html += '<ul>';
            html += '<li class="improved">5çˆ»: é‡ã¿0.70 + ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰45å€‹ = å¼·åŠ›ãªé¸æŠãƒã‚¤ã‚¢ã‚¹</li>';
            html += '<li class="improved">3çˆ»/4çˆ»: é‡ã¿å¢—åŠ  + ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¿½åŠ  = ãƒãƒ©ãƒ³ã‚¹æ”¹å–„</li>';
            html += '<li class="improved">æœªä½¿ç”¨çˆ»: 20%ãƒœãƒ¼ãƒŠã‚¹ + æ®µéšçš„ãƒšãƒŠãƒ«ãƒ†ã‚£ = å¤šæ§˜æ€§ä¿ƒé€²</li>';
            html += '</ul>';
            
            html += '<h3>æŠ‘åˆ¶ã•ã‚ŒãŸé ˜åŸŸ</h3>';
            html += '<ul>';
            html += '<li class="warning">2çˆ»: é‡ã¿0.43 + ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰15å€‹ = é¸æŠæŠ‘åˆ¶</li>';
            html += '<li class="warning">6çˆ»: é‡ã¿0.40 + ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰15å€‹ = é¸æŠæŠ‘åˆ¶</li>';
            html += '</ul>';
            
            html += '<h3>æ½œåœ¨çš„ãªå•é¡Œç‚¹</h3>';
            html += '<ul>';
            html += '<li class="critical">5çˆ»ã¸ã®éåº¦ãªåã‚Šãƒªã‚¹ã‚¯ï¼ˆè¦ç›£è¦–ï¼‰</li>';
            html += '<li class="warning">ãƒšãƒŠãƒ«ãƒ†ã‚£ãŒæ€¥æ¿€ã™ãã‚‹å¯èƒ½æ€§</li>';
            html += '<li class="warning">ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯é‡ã¿ã®ãƒãƒ©ãƒ³ã‚¹</li>';
            html += '</ul>';
            html += '</div>';
            
            // æ¨å¥¨èª¿æ•´
            html += '<div class="param-section">';
            html += '<h2>ğŸ’¡ Day 6 æ¨å¥¨èª¿æ•´æ¡ˆ</h2>';
            html += '<h3>å„ªå…ˆåº¦é«˜</h3>';
            html += '<ol>';
            html += '<li>5çˆ»ã®é‡ã¿ã‚’0.70â†’0.65ã«å¾®èª¿æ•´ï¼ˆéåº¦ãªåã‚Šé˜²æ­¢ï¼‰</li>';
            html += '<li>1çˆ»ã®é‡ã¿ã‚’0.50â†’0.52ã«å¾®å¢—ï¼ˆãƒãƒ©ãƒ³ã‚¹æ”¹å–„ï¼‰</li>';
            html += '<li>ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚«ãƒ¼ãƒ–ã‚’ç·©ã‚„ã‹ã«ï¼ˆ0.90â†’0.92, 0.75â†’0.80ç­‰ï¼‰</li>';
            html += '</ol>';
            
            html += '<h3>å„ªå…ˆåº¦ä¸­</h3>';
            html += '<ul>';
            html += '<li>æ¢ç´¢ãƒã‚¤ã‚ºã®å…¨ä½“çš„ãªè¦‹ç›´ã—</li>';
            html += '<li>å¦å˜ä½ã§ã®ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°æ©Ÿèƒ½è¿½åŠ </li>';
            html += '</ul>';
            html += '</div>';
            
            document.getElementById('analysis').innerHTML = html;
        }
        
        function analyzePositionWeightImpact(position, weight) {
            if (position === 5 && weight >= 0.70) {
                return 'éå¸¸ã«å¼·ã„é¸æŠãƒã‚¤ã‚¢ã‚¹';
            } else if (weight >= 0.60) {
                return 'å¼·ã„é¸æŠå‚¾å‘';
            } else if (weight >= 0.50) {
                return 'æ¨™æº–çš„ãªé¸æŠ';
            } else if (weight >= 0.40) {
                return 'æŠ‘åˆ¶ã•ã‚ŒãŸé¸æŠ';
            } else {
                return 'å¼·ãæŠ‘åˆ¶';
            }
        }
        
        analyzeAllParameters();
    </script>
</body>
</html>