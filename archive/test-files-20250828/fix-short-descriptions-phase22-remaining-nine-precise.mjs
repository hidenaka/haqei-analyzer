import { readFile, writeFile } from 'fs/promises';

async function fixPhase22RemainingNinePrecise() {
  try {
    console.log('=== フェーズ22: 残り9文字177件を一行一行丁寧に修正 ===\n');
    
    // データベース読み込み
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // remaining-short-descriptions.jsonから抽出した実際の9文字の説明（177件）
    // 各説明に対して、意味を保ちながら10文字以上に拡張
    const nineCharFixes = {
      // 天山遯
      '"深い信頼関係、密着"': '"深い信頼関係と密着した交流"',
      '"無用な争いを避ける"': '"無用な争いを避けて守る"',
      '"リスクの少ない場所"': '"リスクの少ない安全な場所"',
      
      // 山澤損
      '"静かに自分を回復"': '"静かに自分を回復させる"',
      '"感謝と意味の実感"': '"感謝と意味を実感する"',
      '"奉仕の心を持つ人々"': '"奉仕の心を持つ人々と活動"',
      '"奉仕の意味を再確認"': '"奉仕の意味を再確認する"',
      
      // 風雷益
      '"非常に強い価値創造"': '"非常に強い価値創造を行う"',
      '"常に成長を考える"': '"常に成長を考え続ける"',
      '"成長と拡大の機会"': '"成長と拡大の機会を得る"',
      '"みんなの価値を増幅"': '"みんなの価値を増幅させる"',
      '"成長を重視する環境"': '"成長を重視する環境で活動"',
      '"みんなを成長させる"': '"みんなを成長させる力"',
      '"プレッシャーになる"': '"プレッシャーになることがある"',
      '"前向きに転換する力"': '"前向きに転換する力を持つ"',
      '"成長と共に回復する"': '"成長と共に回復していく"',
      '"成長を応援する人"': '"成長を応援してくれる人"',
      '"持続的な価値創造"': '"持続的な価値創造を実現"',
      '"暴走、または停滞"': '"暴走または停滞しやすい"',
      
      // 澤天夬
      '"決断の結果を見守る"': '"決断の結果を見守って学ぶ"',
      '"明確な指示を出す"': '"明確な指示を出して導く"',
      '"決定、指示、締結"': '"決定と指示と締結を行う"',
      '"相談、議論、迷い"': '"相談や議論で迷いやすい"',
      '"迷いのない決定力"': '"迷いのない決定力を発揮"',
      '"大切なものも切る"': '"大切なものも切ってしまう"',
      '"関係も仕事も断つ"': '"関係も仕事も断ち切る"',
      '"次の目標を決める"': '"次の目標を決めて進む"',
      '"決断を支持する人"': '"決断を支持してくれる人"',
      '"的確な決断で前進"': '"的確な決断で前進する"',
      
      // 天風姤
      '"人脈を広げ、繋げる"': '"人脈を広げて繋げていく"',
      '"運命的な出会いの時"': '"運命的な出会いの時を迎える"',
      '"縁を最大限に活かす"': '"縁を最大限に活かして成功"',
      '"親しい人との時間"': '"親しい人との大切な時間"',
      '"新しい縁より深い縁"': '"新しい縁より深い縁を大切に"',
      '"新しい出会いと縁"': '"新しい出会いと縁を得る"',
      '"誰とでもすぐ仲良く"': '"誰とでもすぐ仲良くなれる"',
      '"深い関係、一対一"': '"深い関係や一対一が苦手"',
      '"社交的で明るい人々"': '"社交的で明るい人々と活動"',
      '"表面的になりがち"': '"表面的になりがちな傾向"',
      '"問題のある縁を切る"': '"問題のある縁を切って守る"',
      '"悪縁から身を守る"': '"悪縁から身を守って安全に"',
      '"全ての縁を見直す"': '"全ての縁を見直して整理"',
      '"人間関係の大整理"': '"人間関係の大整理を行う"',
      '"出会いのある場所"': '"出会いのある場所で活動"',
      '"悪縁、または孤立"': '"悪縁または孤立しやすい"',
      
      // 澤地萃
      '"次の集結に備える"': '"次の集結に備えて準備"',
      '"みんなを巻き込む"': '"みんなを巻き込んで進める"',
      '"個別対応、少人数"': '"個別対応や少人数が苦手"',
      '"個が見えなくなる"': '"個が見えなくなりやすい"',
      
      // 地風升
      '"成長の転機が来た時"': '"成長の転機が来た時に発動"',
      '"一気にレベルアップ"': '"一気にレベルアップする"',
      '"見えない成長も大切"': '"見えない成長も大切にする"',
      '"成長の実感と環境"': '"成長の実感と環境を得る"',
      '"成長を実感する喜び"': '"成長を実感する喜びを得る"',
      '"育成、教育、支援"': '"育成と教育と支援を行う"',
      '"即効性、短期決戦"': '"即効性や短期決戦が苦手"',
      '"スピード感に欠ける"': '"スピード感に欠けることがある"',
      '"時には飛躍も必要"': '"時には飛躍も必要となる"',
      '"守りに入って様子見"': '"守りに入って様子を見る"',
      '"少しずつ成長再開"': '"少しずつ成長を再開する"',
      '"着実に高みへ到達"': '"着実に高みへ到達する"',
      
      // 澤水困
      '"大きな困難に直面"': '"大きな困難に直面した時"',
      '"絶体絶命から復活"': '"絶体絶命から復活する"',
      '"困難がないと退屈"': '"困難がないと退屈に感じる"',
      '"困難克服の達成感"': '"困難克服の達成感を得る"',
      '"『一緒に頑張ろう』"': '"『一緒に頑張ろう』と励ます"',
      '"団結、共闘、励まし"': '"団結と共闘と励ましを行う"',
      '"困難を恐れない人々"': '"困難を恐れない人々と協働"',
      '"困難を通じた深い絆"': '"困難を通じた深い絆を築く"',
      '"日常も大切にしよう"': '"日常も大切にしていこう"',
      '"問題を解決して前進"': '"問題を解決して前進する"',
      
      // 水風井
      '"大きな需要がある時"': '"大きな需要がある時に活躍"',
      '"自分の井戸を満たす"': '"自分の井戸を満たして準備"',
      '"与えるために蓄える"': '"与えるために蓄えておく"',
      '"誰かの役に立つ喜び"': '"誰かの役に立つ喜びを感じる"',
      '"提供、支援、供給"': '"提供と支援と供給を行う"',
      '"要求と交渉を行う"': '"要求と交渉を行うのが苦手"',
      '"供給が必要な環境"': '"供給が必要な環境で活動"',
      '"与えすぎて枯れる"': '"与えすぎて枯れてしまう"',
      '"自己を守る防衛本能"': '"自己を守る防衛本能が働く"',
      '"少しずつ供給再開"': '"少しずつ供給を再開する"',
      '"自分のための時間"': '"自分のための時間を取る"',
      
      // 澤火革
      '"革命の炎を燃やす"': '"革命の炎を燃やして進む"',
      '"静かに革命の準備"': '"静かに革命の準備を進める"',
      '"変革促進、意識改革"': '"変革促進と意識改革を行う"',
      '"変革が必要な環境"': '"変革が必要な環境で活動"',
      '"変化を求める人々"': '"変化を求める人々と協働"',
      '"段階的な変化も考慮"': '"段階的な変化も考慮する"',
      '"既存の全てを否定"': '"既存の全てを否定する"',
      '"ゼロから作り直す"': '"ゼロから作り直していく"',
      '"革命を共にする仲間"': '"革命を共にする仲間と進む"',
      '"建設的な変革を実現"': '"建設的な変革を実現する"',
      '"変革的、または停滞"': '"変革的または停滞しやすい"',
      
      // 火風鼎
      '"インプットの時間"': '"インプットの時間を取る"',
      '"創造の自由と素材"': '"創造の自由と素材を得る"',
      '"何かを創造する喜び"': '"何かを創造する喜びを感じる"',
      '"創造的で独特な表現"': '"創造的で独特な表現をする"',
      '"創造力豊かな人々"': '"創造力豊かな人々と活動"',
      '"新しい価値を生む"': '"新しい価値を生み出す"',
      '"現実離れすることも"': '"現実離れすることもある"',
      '"実現可能性も考慮"': '"実現可能性も考慮する"',
      '"創造活動に逃げる"': '"創造活動に逃げてしまう"',
      '"現実から目を背ける"': '"現実から目を背けてしまう"',
      '"創造の世界に籠る"': '"創造の世界に籠ってしまう"',
      '"現実を忘れて創作"': '"現実を忘れて創作に没頭"',
      '"創造活動を通じて"': '"創造活動を通じて回復する"',
      '"作品を作り上げる"': '"作品を作り上げて達成感"',
      '"創造を理解する人"': '"創造を理解してくれる人"',
      
      // 震為雷
      '"一瞬で状況を変える"': '"一瞬で状況を変える力"',
      '"静電気のように蓄積"': '"静電気のように蓄積する"',
      '"瞬発力が必要な環境"': '"瞬発力が必要な環境で活躍"',
      '"忘れられない存在"': '"忘れられない存在となる"',
      '"強い防御反応を示す"': '"強い防御反応を示して守る"',
      '"刺激の少ない場所"': '"刺激の少ない場所で休む"',
      
      // 艮為山
      '"常に休息状態を保つ"': '"常に休息状態を保って安定"',
      '"静寂と安定を保つ力"': '"静寂と安定を保つ力を持つ"',
      '"固まりすぎに注意"': '"固まりすぎに注意が必要"',
      '"変化、柔軟性、即応"': '"変化や柔軟性や即応が苦手"',
      '"完全に動きを止める"': '"完全に動きを止めて守る"',
      '"批判を受け流す"': '"批判を受け流して守る"',
      '"完全に反応を止める"': '"完全に反応を止めて防御"',
      '"自然の流れに任せる"': '"自然の流れに任せて回復"',
      '"時の流れに任せる"': '"時の流れに任せて待つ"',
      '"組織の礎として機能"': '"組織の礎として機能する"',
      
      // 風山漸
      '"階段を一歩ずつ上る"': '"階段を一歩ずつ上って進む"',
      '"手順通りに進める"': '"手順通りに進めていく"',
      '"今のレベルを定着"': '"今のレベルを定着させる"',
      '"次の段階への準備"': '"次の段階への準備を進める"',
      '"明確な段階と目標"': '"明確な段階と目標を設定"',
      '"段階クリアの達成感"': '"段階クリアの達成感を得る"',
      '"段階的に教える先生"': '"段階的に教える先生のように"',
      '"飛躍的発想、即興"': '"飛躍的発想や即興が苦手"',
      '"段階的成長の環境"': '"段階的成長の環境で活動"',
      '"着実に成長する人々"': '"着実に成長する人々と協働"',
      '"遅いと感じられる"': '"遅いと感じられることがある"',
      '"安全な段階まで戻る"': '"安全な段階まで戻って守る"',
      '"後退と見られる"': '"後退と見られることがある"',
      '"最初の段階まで戻る"': '"最初の段階まで戻って再開"',
      '"一段ずつ上り直す"': '"一段ずつ上り直していく"',
      '"基礎から積み上げる"': '"基礎から積み上げていく"',
      '"確実に目標に到達"': '"確実に目標に到達する"',
      
      // 雷澤帰妹
      '"関係修復が必要な時"': '"関係修復が必要な時に動く"',
      '"完璧な調和を作る"': '"完璧な調和を作り出す"',
      '"自分との調和も大切"': '"自分との調和も大切にする"',
      '"関係改善の成功"': '"関係改善の成功を実感"',
      '"押し付けない調和を"': '"押し付けない調和を実現"',
      '"双方の立場を理解"': '"双方の立場を理解する"',
      '"調和が必要な環境"': '"調和が必要な環境で活動"',
      '"協調的で優しい人々"': '"協調的で優しい人々と協働"',
      '"みんなを繋げる力"': '"みんなを繋げる力を持つ"',
      '"八方美人に見える"': '"八方美人に見えることがある"',
      '"自分の立場も大切に"': '"自分の立場も大切にする"',
      '"支援を得やすい"': '"支援を得やすい状況"',
      '"自立性に欠ける"': '"自立性に欠けることがある"',
      '"全ての関係を動員"': '"全ての関係を動員する"',
      '"関係修復と共に"': '"関係修復と共に回復する"',
      '"関係性の再構築"': '"関係性の再構築を行う"',
      '"信頼関係を取り戻す"': '"信頼関係を取り戻していく"',
      '"支援的で温かい環境"': '"支援的で温かい環境で回復"',
      '"関係の要として機能"': '"関係の要として機能する"',
      
      // 雷火豊
      '"非常に強い生産性"': '"非常に強い生産性を発揮"',
      '"通常の10倍の成果"': '"通常の10倍の成果を出す"',
      '"種まきと土作り"': '"種まきと土作りを行う"',
      '"豊かな環境と資源"': '"豊かな環境と資源を得る"',
      '"質も量も大切に"': '"質も量も大切にする"',
      '"豊作を分かち合う"': '"豊作を分かち合って喜ぶ"',
      '"豊かで寛大な態度"': '"豊かで寛大な態度を示す"',
      '"節約、制限、厳格さ"': '"節約や制限や厳格さが苦手"',
      '"豊かさを求める人々"': '"豊かさを求める人々と活動"',
      '"みんなを豊かにする"': '"みんなを豊かにする力"',
      '"浪費的に見える"': '"浪費的に見えることがある"',
      '"持続可能な豊かさを"': '"持続可能な豊かさを実現"',
      '"蓄えを使って対処"': '"蓄えを使って対処する"',
      '"心に余裕がある状態"': '"心に余裕がある状態を保つ"',
      '"持てる全てで対処"': '"持てる全てで対処する"',
      '"また蓄積から始める"': '"また蓄積から始めていく"'
    };
    
    // バックアップ作成
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase22.${timestamp}.js`, content);
    console.log(`📁 バックアップ作成: hexagram-human-traits-v3.backup.phase22.${timestamp}.js\n`);
    
    // 修正適用
    let totalFixCount = 0;
    let successfulFixes = [];
    
    console.log('9文字の修正を一行一行適用中...\n');
    
    Object.entries(nineCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const matches = content.match(regex);
      if (matches) {
        content = content.replace(regex, newText);
        totalFixCount += matches.length;
        successfulFixes.push(`${old} → ${newText} (${matches.length}箇所)`);
      }
    });
    
    // 成功した修正を表示
    console.log('【修正成功項目】');
    if (successfulFixes.length > 0) {
      successfulFixes.slice(0, 30).forEach(fix => {
        console.log(`✅ ${fix}`);
      });
      if (successfulFixes.length > 30) {
        console.log(`... 他 ${successfulFixes.length - 30}件`);
      }
    } else {
      console.log('修正対象が見つかりませんでした。');
    }
    
    // ファイル保存
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`\n=== フェーズ22完了 ===`);
    console.log(`総修正件数: ${totalFixCount}件`);
    console.log(`修正成功項目: ${successfulFixes.length}種類`);
    console.log(`\n最終検証: node comprehensive-v3-review.mjs`);
    
  } catch (error) {
    console.error('エラー:', error);
  }
}

fixPhase22RemainingNinePrecise();