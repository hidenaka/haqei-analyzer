import { readFile, writeFile } from 'fs/promises';

async function fixPhase14FinalSeven() {
  try {
    console.log('=== ãƒ•ã‚§ãƒ¼ã‚º14: æœ€çµ‚7æ–‡å­—58ä»¶ã‚’ä¸€è¡Œä¸€è¡Œä¿®æ­£ ===\n');
    
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èª­ã¿è¾¼ã¿
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // 7æ–‡å­—ã®èª¬æ˜ã‚’ä¸€è¡Œä¸€è¡Œä¸å¯§ã«ä¿®æ­£ï¼ˆ58ä»¶ï¼‰
    const sevenCharFixes = {
      // ç’°å¢ƒãƒ»å ´æ‰€ç³»
      '"è‰¯ç¸ã«æµã¾ã‚Œã‚‹"': '"è‰¯ç¸ã«æµã¾ã‚Œã‚‹å¹¸é‹ãªçŠ¶æ…‹"',
      '"é›†å›£æ´»å‹•ã®ç’°å¢ƒ"': '"é›†å›£æ´»å‹•ã«é©ã—ãŸç’°å¢ƒ"',
      '"è¦æ±‚ã®ãªã„ç’°å¢ƒ"': '"è¦æ±‚ã‚„åœ§åŠ›ã®ãªã„ç’°å¢ƒ"',
      '"å¤‰åŒ–ã‚’æ„Ÿã˜ã‚‹å ´"': '"å¤‰åŒ–ã‚’æ•æ„Ÿã«æ„Ÿã˜ã‚‹å ´"',
      '"äººã€…ãŒé›†ã¾ã‚‹å ´"': '"å¤šãã®äººã€…ãŒé›†ã¾ã‚‹å ´"',
      '"äº¤æµã®ä¸­å¿ƒåœ°"': '"æ´»ç™ºãªäº¤æµã®ä¸­å¿ƒåœ°"',
      '"æ„Ÿè¦šçš„ãªç’°å¢ƒ"': '"æ„Ÿè¦šã‚’åˆºæ¿€ã™ã‚‹ç’°å¢ƒ"',
      '"ç·Šå¼µæ„Ÿã‚ã‚‹ç’°å¢ƒ"': '"é©åº¦ãªç·Šå¼µæ„ŸãŒã‚ã‚‹ç’°å¢ƒ"',
      '"é™çš„ãªç’°å¢ƒ"': '"é™ã‹ã§è½ã¡ç€ã„ãŸç’°å¢ƒ"',
      '"æ³¢å‹•ã®å…±é³´å ´"': '"æ³¢å‹•ãŒå…±é³´ã™ã‚‹ç‰¹åˆ¥ãªå ´"',
      '"å›°é›£ãªç’°å¢ƒ"': '"å›°é›£ã ãŒæˆé•·ã§ãã‚‹ç’°å¢ƒ"',
      '"åˆ¶é™ã®ã‚ã‚‹ç’°å¢ƒ"': '"åˆ¶é™ãŒã‚ã‚‹ãŒå®‰å…¨ãªç’°å¢ƒ"',
      '"è§£æ”¾çš„ãªç’°å¢ƒ"': '"è§£æ”¾çš„ã§è‡ªç”±ãªç’°å¢ƒ"',
      '"æå¾—æŠœãã®ç’°å¢ƒ"': '"æå¾—ã‚’è¶…ãˆãŸç´”ç²‹ãªç’°å¢ƒ"',
      '"ç›Šã‚’ç”Ÿã‚€ç’°å¢ƒ"': '"ç›Šã‚’ç”Ÿã¿å‡ºã™ç”Ÿç”£çš„ãªç’°å¢ƒ"',
      '"æ‹¡å¤§ã™ã‚‹ç’°å¢ƒ"': '"æ´»å‹•ãŒæ‹¡å¤§ã™ã‚‹ç’°å¢ƒ"',
      '"å±é™ºãªç’°å¢ƒ"': '"å±é™ºã ãŒåˆºæ¿€çš„ãªç’°å¢ƒ"',
      '"æ±ºæ–­ã‚’ä¿ƒã™ç’°å¢ƒ"': '"æ±ºæ–­ã‚’ä¿ƒé€²ã™ã‚‹ç’°å¢ƒ"',
      '"æ‹¡æ•£ã™ã‚‹ç’°å¢ƒ"': '"ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒæ‹¡æ•£ã™ã‚‹ç’°å¢ƒ"',
      '"æ±‚å¿ƒåŠ›ã‚ã‚‹ç’°å¢ƒ"': '"æ±‚å¿ƒåŠ›ãŒåƒãç’°å¢ƒ"',
      '"äº¤æµãŒç››ã‚“ãªå ´"': '"äº¤æµãŒç››ã‚“ã§æ´»æ°—ã‚ã‚‹å ´"',
      '"å®Œæˆã‚’ç›®æŒ‡ã™å ´"': '"å®Œæˆã‚’ç›®æŒ‡ã—ã¦åŠªåŠ›ã™ã‚‹å ´"',
      '"ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„å ´"': '"ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸå ´"',
      '"ç´°ã‚„ã‹ãªç’°å¢ƒ"': '"ç´°ã‚„ã‹ãªé…æ…®ãŒã‚ã‚‹ç’°å¢ƒ"',
      '"å¤§èƒ†ãªç’°å¢ƒ"': '"å¤§èƒ†ãªæŒ‘æˆ¦ãŒã§ãã‚‹ç’°å¢ƒ"',
      '"å¤‰é©çš„ãªç’°å¢ƒ"': '"å¤‰é©ã‚’ä¿ƒé€²ã™ã‚‹ç’°å¢ƒ"',
      '"å®‰å®šã—ãŸç’°å¢ƒ"': '"å¤‰åŒ–ã®å°‘ãªã„å®‰å®šã—ãŸç’°å¢ƒ"',
      '"æµå‹•çš„ãªç’°å¢ƒ"': '"å¸¸ã«å¤‰åŒ–ã™ã‚‹æµå‹•çš„ãªç’°å¢ƒ"',
      
      // æ™‚é–“ãƒ»æ´»å‹•ç³»
      '"æ•´ç†æ•´é “ã®æ™‚é–“"': '"æ•´ç†æ•´é “ã‚’ã™ã‚‹è²´é‡ãªæ™‚é–“"',
      '"ç ´å£Šã¨å‰µé€ ã®æ™‚"': '"ç ´å£Šã¨å‰µé€ ã‚’åŒæ™‚ã«è¡Œã†æ™‚"',
      '"æŒ¯ã‚Šè¿”ã‚Šã®æ™‚é–“"': '"éå»ã‚’æŒ¯ã‚Šè¿”ã‚‹å¤§åˆ‡ãªæ™‚é–“"',
      '"æº–å‚™ã¨è¨ˆç”»ã®æ™‚"': '"æº–å‚™ã¨è¨ˆç”»ã‚’ç«‹ã¦ã‚‹æ™‚"',
      '"è§£æ”¾ã•ã‚Œã‚‹æ™‚é–“"': '"æŸç¸›ã‹ã‚‰è§£æ”¾ã•ã‚Œã‚‹æ™‚é–“"',
      '"ä¸ãˆã‚‹æ™‚é–“"': '"æƒœã—ã¿ãªãä¸ãˆã‚‹æ™‚é–“"',
      '"æˆé•·ã®æ™‚é–“"': '"ç€å®Ÿã«æˆé•·ã™ã‚‹æ™‚é–“"',
      '"æ±ºæ–­ã®æ™‚é–“"': '"é‡è¦ãªæ±ºæ–­ã‚’ä¸‹ã™æ™‚é–“"',
      '"äº¤æµã®æ™‚é–“"': '"äººã¨äº¤æµã™ã‚‹æ¥½ã—ã„æ™‚é–“"',
      '"å®Œæˆã®æ™‚é–“"': '"ç‰©äº‹ã‚’å®Œæˆã•ã›ã‚‹æ™‚é–“"',
      '"èª¿æ•´ã®æ™‚é–“"': '"ãƒãƒ©ãƒ³ã‚¹ã‚’èª¿æ•´ã™ã‚‹æ™‚é–“"',
      '"å¤‰é©ã®æ™‚é–“"': '"å¤§ããªå¤‰é©ã‚’èµ·ã“ã™æ™‚é–“"',
      
      // å¯¾è±¡ãƒ»ç›®çš„ç³»
      '"é›†ã‚ã‚‹å¯¾è±¡ã¨å ´"': '"é›†ã‚ã‚‹ã¹ãå¯¾è±¡ã¨é©åˆ‡ãªå ´"',
      '"æ¬¡ã®é©å‘½ã‚’è¨ˆç”»"': '"æ¬¡ã®é©å‘½ã‚’ç¶¿å¯†ã«è¨ˆç”»ã™ã‚‹"',
      '"æ–°ã—ã„äº•æˆ¸æ¢ã—"': '"æ–°ã—ã„æ°´æºã‚’æ¢ã—æ±‚ã‚ã‚‹"',
      '"æ¬¡ã®æ—…ã®æº–å‚™"': '"æ¬¡ã®æ—…ã«å‘ã‘ã¦æº–å‚™ã™ã‚‹"',
      '"æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã¸"': '"æ¬¡ã®ã‚µã‚¤ã‚¯ãƒ«ã¸ç§»è¡Œã™ã‚‹"',
      
      // è¨€è‘‰ãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç³»
      '"æˆé•·ã‚’ä¿ƒã™è¨€è‘‰"': '"æˆé•·ã‚’ä¿ƒã™åŠ±ã¾ã—ã®è¨€è‘‰"',
      '"æ¥½ã—ã•ã¨ç¬‘é¡”"': '"æ¥½ã—ã•ã¨ç¬‘é¡”ã‚’å¤§åˆ‡ã«ã™ã‚‹"',
      '"ä¿¡é ¼ã®è¨€è‘‰"': '"ä¿¡é ¼ã‚’ç¯‰ãèª å®Ÿãªè¨€è‘‰"',
      
      // èƒ½åŠ›ãƒ»å¼·ã¿ç³»
      '"ç€å®Ÿãªä¿¡é ¼æ§‹ç¯‰"': '"ç€å®Ÿã«ä¿¡é ¼ã‚’æ§‹ç¯‰ã™ã‚‹åŠ›"',
      '"äº¤æµã®æ´»æ€§åŒ–"': '"äº¤æµã‚’æ´»æ€§åŒ–ã•ã›ã‚‹èƒ½åŠ›"',
      
      // æˆé•·ãƒ»å›å¾©ç³»
      '"å°ã•ãªæˆé•·ã‹ã‚‰"': '"å°ã•ãªæˆé•·ã‹ã‚‰å§‹ã‚ã‚‹"',
      '"æˆé•·ã‚’è¦‹å®ˆã‚‹äºº"': '"æˆé•·ã‚’æ¸©ã‹ãè¦‹å®ˆã‚‹äºº"',
      '"ç™ºå±•çš„ãªç¸ã‹ã‚‰"': '"ç™ºå±•çš„ãªç¸ã‹ã‚‰å§‹ã¾ã‚‹"',
      '"æ–°ãŸãªã‚µã‚¤ã‚¯ãƒ«"': '"æ–°ãŸãªã‚µã‚¤ã‚¯ãƒ«ã‚’å§‹ã‚ã‚‹"',
      
      // ãã®ä»–
      '"èª°ã‚‚å‚·ã¤ã‘ãªã„"': '"èª°ã‚‚å‚·ã¤ã‘ãªã„å„ªã—ã•"',
      '"å®‰å…¨ãªç«‹ã¡ä½ç½®"': '"å®‰å…¨ã§ç¢ºå®Ÿãªç«‹ã¡ä½ç½®"',
      '"å°ã•ãªæ­£ç¢ºã•"': '"å°ã•ãªã“ã¨ã‚‚æ­£ç¢ºã«è¡Œã†"'
    };
    
    // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase14.${timestamp}.js`, content);
    console.log(`ğŸ“ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ: hexagram-human-traits-v3.backup.phase14.${timestamp}.js\n`);
    
    // ä¿®æ­£é©ç”¨
    let totalFixCount = 0;
    let successfulFixes = [];
    
    console.log('7æ–‡å­—ã®ä¿®æ­£ã‚’é©ç”¨ä¸­...\n');
    
    Object.entries(sevenCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const matches = content.match(regex);
      if (matches) {
        content = content.replace(regex, newText);
        totalFixCount += matches.length;
        successfulFixes.push(`${old} â†’ ${newText} (${matches.length}ç®‡æ‰€)`);
      }
    });
    
    // æˆåŠŸã—ãŸä¿®æ­£ã‚’è¡¨ç¤º
    console.log('ã€ä¿®æ­£æˆåŠŸé …ç›®ã€‘');
    if (successfulFixes.length > 0) {
      successfulFixes.slice(0, 20).forEach(fix => {
        console.log(`âœ… ${fix}`);
      });
      if (successfulFixes.length > 20) {
        console.log(`... ä»– ${successfulFixes.length - 20}ä»¶`);
      }
    } else {
      console.log('ä¿®æ­£å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
    }
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`\n=== ãƒ•ã‚§ãƒ¼ã‚º14å®Œäº† ===`);
    console.log(`ç·ä¿®æ­£ä»¶æ•°: ${totalFixCount}ä»¶`);
    console.log(`ä¿®æ­£æˆåŠŸé …ç›®: ${successfulFixes.length}ç¨®é¡`);
    console.log(`\næ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º: node fix-short-descriptions-phase15-final-eight.mjs`);
    
  } catch (error) {
    console.error('ã‚¨ãƒ©ãƒ¼:', error);
  }
}

fixPhase14FinalSeven();