<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>D-1-8/9: Phase 1æ¤œè¨¼ãƒ†ã‚¹ãƒˆï¼ˆ100ã‚µãƒ³ãƒ—ãƒ«ï¼‰</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .success { color: #4ec9b0; }
        .warning { color: #dcdcaa; }
        .error { color: #f48771; }
        .info { color: #9cdcfe; }
        .result-box {
            background: #252526;
            border: 1px solid #3e3e42;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .metric-card {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .metric-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¬ D-1-8/9: Phase 1å®Ÿè£…æ¤œè¨¼ï¼ˆ100ã‚µãƒ³ãƒ—ãƒ«ï¼‰</h1>
    <div id="status">ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...</div>
    <div id="results"></div>

    <script type="module">
        import { TextTo384LinesBridge } from './public/js/ai/TextTo384LinesBridge.js';
        
        // ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«ç”Ÿæˆï¼ˆ5çˆ»ãŒé¸ã°ã‚Œã‚„ã™ã„ã‚‚ã®ä¸­å¿ƒï¼‰
        function generateTestSamples() {
            const samples = [];
            
            // æ±ºå®šãƒ»åˆ¤æ–­ç³»ï¼ˆD-1-6ã§ãƒœãƒ¼ãƒŠã‚¹å¯¾è±¡ï¼‰
            const decisionTexts = [
                "æœ€çµ‚æ±ºå®šã‚’è¡Œã†", "é‡è¦ãªåˆ¤æ–­ã‚’ä¸‹ã™", "æˆ¦ç•¥çš„æ±ºæ–­ã‚’ã™ã‚‹",
                "æ–¹é‡ã‚’æ±ºå®šã™ã‚‹", "çµŒå–¶åˆ¤æ–­ã‚’è¡Œã†", "ãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦æ±ºã‚ã‚‹",
                "æ‰¿èªã‚’ä¸ãˆã‚‹", "æ‰¹å‡†ã™ã‚‹", "æ±ºè£ã‚’è¡Œã†", "è£å®šã‚’ä¸‹ã™"
            ];
            
            // ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ç³»ï¼ˆ5çˆ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰
            const leaderTexts = [
                "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã™ã‚‹", "ãƒãƒ¼ãƒ ã‚’çµ±ç‡ã™ã‚‹", "çµ„ç¹”ã‚’æŒ‡å°ã™ã‚‹",
                "éƒ¨ä¸‹ã‚’ç®¡ç†ã™ã‚‹", "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’çµ±æ‹¬ã™ã‚‹", "å…¨ä½“ã‚’ç›£ç£ã™ã‚‹",
                "ãƒˆãƒƒãƒ—ã¨ã—ã¦è¡Œå‹•", "å½¹å“¡ã¨ã—ã¦åˆ¤æ–­", "å¹¹éƒ¨ã®è²¬ä»»", "çµŒå–¶è€…ã®è¦–ç‚¹"
            ];
            
            // æˆç†Ÿãƒ»å®Œæˆç³»
            const maturityTexts = [
                "å††ç†Ÿã—ãŸåˆ¤æ–­åŠ›", "ç†Ÿç·´ã®æŠ€", "é”äººã®åŸŸ", "ãƒã‚¹ã‚¿ãƒ¼ãƒ¬ãƒ™ãƒ«",
                "ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã®çŸ¥è¦‹", "ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªå¯¾å¿œ", "ãƒ™ãƒ†ãƒ©ãƒ³ã®çµŒé¨“",
                "å®Œæˆã«è¿‘ã¥ã", "æœ€é«˜ã®çŠ¶æ…‹", "é ‚ç‚¹ã«é”ã™ã‚‹"
            ];
            
            // ãƒŸãƒƒã‚¯ã‚¹ï¼ˆå¤šæ§˜æ€§ç¢ºä¿ï¼‰
            const mixedTexts = [
                "æ–°ã—ã„å§‹ã¾ã‚Š", "å”åŠ›é–¢ä¿‚ã‚’ç¯‰ã", "å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹",
                "å¤‰åŒ–ã®æ™‚æœŸ", "å®Œäº†ã™ã‚‹æ®µéš", "åˆã‚ã¦ã®æŒ‘æˆ¦",
                "å†…é¢çš„ãªæˆé•·", "å¤–éƒ¨ã¨ã®äº¤æ¸‰", "åŸºç¤ã‚’å›ºã‚ã‚‹", "æœ€çµ‚æ®µéšã«å…¥ã‚‹"
            ];
            
            // å„ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰2å›ãšã¤ï¼ˆè¨ˆ100ã‚µãƒ³ãƒ—ãƒ«ï¼‰
            [...decisionTexts, ...leaderTexts, ...maturityTexts, ...mixedTexts].forEach(text => {
                samples.push(`${text}`);
                samples.push(`ä»Šæ—¥ã¯${text}æ™‚`);
            });
            
            return samples;
        }
        
        async function runPhase1Test() {
            const statusEl = document.getElementById('status');
            const resultsEl = document.getElementById('results');
            
            try {
                statusEl.innerHTML = '<span class="warning">TextTo384LinesBridgeåˆæœŸåŒ–ä¸­...</span>';
                const bridge = new TextTo384LinesBridge();
                await bridge.initialize();
                
                statusEl.innerHTML = '<span class="info">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</span>';
                
                const samples = generateTestSamples();
                const results = {
                    positionCount: [0, 0, 0, 0, 0, 0, 0], // 7ç•ªç›®ã¯ç”¨ä¹ãƒ»ç”¨å…­
                    decisionTextResults: { total: 0, line5Count: 0 },
                    processingTimes: [],
                    totalSamples: samples.length
                };
                
                // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                for (const text of samples) {
                    const startTime = performance.now();
                    const result = await bridge.analyzeText(text);
                    const processingTime = performance.now() - startTime;
                    
                    results.processingTimes.push(processingTime);
                    
                    const position = result.line_position;
                    if (position <= 6) {
                        results.positionCount[position - 1]++;
                    } else {
                        results.positionCount[6]++;
                    }
                    
                    // æ±ºå®šç³»ãƒ†ã‚­ã‚¹ãƒˆã®çµ±è¨ˆ
                    if (bridge.isDecisionRelatedText(text)) {
                        results.decisionTextResults.total++;
                        if (position === 5) {
                            results.decisionTextResults.line5Count++;
                        }
                    }
                }
                
                // çµæœè¡¨ç¤º
                let html = '';
                
                // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰
                html += '<div class="metric-grid">';
                
                // 5çˆ»é¸æŠç‡
                const line5Percentage = (results.positionCount[4] / results.totalSamples * 100);
                const line5Success = line5Percentage >= 10;
                html += `<div class="metric-card">
                    <div class="info">5çˆ»é¸æŠç‡</div>
                    <div class="metric-value ${line5Success ? 'success' : 'error'}">${line5Percentage.toFixed(1)}%</div>
                    <div>${line5Success ? 'âœ… ç›®æ¨™é”æˆ (â‰¥10%)' : 'âŒ æœªé”æˆ (<10%)'}</div>
                </div>`;
                
                // æ±ºå®šç³»ãƒ†ã‚­ã‚¹ãƒˆã§ã®5çˆ»ç‡
                const decisionLine5Rate = results.decisionTextResults.total > 0 
                    ? (results.decisionTextResults.line5Count / results.decisionTextResults.total * 100)
                    : 0;
                html += `<div class="metric-card">
                    <div class="info">æ±ºå®šç³»ã§ã®5çˆ»ç‡</div>
                    <div class="metric-value ${decisionLine5Rate >= 30 ? 'success' : 'warning'}">${decisionLine5Rate.toFixed(1)}%</div>
                    <div>å¯¾è±¡: ${results.decisionTextResults.total}ä»¶</div>
                </div>`;
                
                // å¹³å‡å‡¦ç†æ™‚é–“
                const avgTime = results.processingTimes.reduce((a, b) => a + b, 0) / results.processingTimes.length;
                html += `<div class="metric-card">
                    <div class="info">å¹³å‡å‡¦ç†æ™‚é–“</div>
                    <div class="metric-value ${avgTime < 20 ? 'success' : 'warning'}">${avgTime.toFixed(1)}ms</div>
                    <div>${avgTime < 20 ? 'âœ… é«˜é€Ÿ' : 'âš ï¸ ã‚„ã‚„é…ã„'}</div>
                </div>`;
                
                html += '</div>';
                
                // çˆ»ä½ç½®åˆ†å¸ƒè©³ç´°
                html += '<div class="result-box">';
                html += '<h3>ğŸ“Š çˆ»ä½ç½®åˆ†å¸ƒï¼ˆD-1-9: ç›®æ¨™é”æˆç¢ºèªï¼‰</h3>';
                html += '<pre>';
                
                results.positionCount.slice(0, 6).forEach((count, idx) => {
                    const percentage = (count / results.totalSamples * 100).toFixed(1);
                    const bar = 'â–ˆ'.repeat(Math.round(percentage / 2));
                    const colorClass = idx === 4 ? (percentage >= 10 ? 'success' : 'error') : '';
                    html += `${idx + 1}çˆ»: ${count.toString().padStart(3)}å€‹ (${percentage.padStart(5)}%) `;
                    html += `<span class="${colorClass}">${bar}</span>\n`;
                });
                
                html += '</pre></div>';
                
                // é”æˆçŠ¶æ³ã‚µãƒãƒªãƒ¼
                html += '<div class="result-box">';
                html += '<h3>âœ… D-1ã‚¿ã‚¹ã‚¯é”æˆçŠ¶æ³</h3>';
                html += '<pre>';
                
                const tasks = [
                    { id: 'D-1-1', desc: 'getEnhancedPositionAdjustmentä¿®æ­£', done: true },
                    { id: 'D-1-2', desc: '5çˆ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰47å€‹ã«æ‹¡å……', done: true },
                    { id: 'D-1-3', desc: 'encodePositionVectorä¿®æ­£', done: true },
                    { id: 'D-1-4', desc: 'positionWeights[4]ã‚’0.8ã«å¤‰æ›´', done: true },
                    { id: 'D-1-5', desc: 'getPositionAdjustmentæ‹¡å¼µ', done: true },
                    { id: 'D-1-6', desc: 'æ±ºå®šãƒ»åˆ¤æ–­ç³»ã®ç‰¹åˆ¥å‡¦ç†è¿½åŠ ', done: true },
                    { id: 'D-1-8', desc: '100ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ', done: true },
                    { id: 'D-1-9', desc: `5çˆ»é¸æŠç‡ã®ç¢ºèªï¼ˆ>10%ï¼‰`, done: line5Success }
                ];
                
                tasks.forEach(task => {
                    const status = task.done ? 'âœ…' : 'âŒ';
                    const color = task.done ? 'success' : 'error';
                    html += `<span class="${color}">${status} ${task.id}: ${task.desc}</span>\n`;
                });
                
                html += '\n<span class="info">ç·åˆåˆ¤å®š: ';
                if (line5Success) {
                    html += '<span class="success">Phase 1å®Œäº† - ç›®æ¨™é”æˆï¼</span>';
                } else {
                    html += '<span class="error">è¿½åŠ èª¿æ•´ãŒå¿…è¦</span>';
                }
                html += '</span>';
                
                html += '</pre></div>';
                
                resultsEl.innerHTML = html;
                statusEl.innerHTML = '<span class="success">âœ… ãƒ†ã‚¹ãƒˆå®Œäº†</span>';
                
            } catch (error) {
                statusEl.innerHTML = `<span class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                console.error(error);
            }
        }
        
        runPhase1Test();
    </script>
</body>
</html>