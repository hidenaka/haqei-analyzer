<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Day 5: Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ500ã‚µãƒ³ãƒ—ãƒ«ï¼‰</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        .info { color: #9cdcfe; }
        .result-box {
            background: #252526;
            border: 1px solid #3e3e42;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        .metric-card {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            padding: 10px;
            border-radius: 3px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            margin: 5px 0;
        }
        .metric-label {
            font-size: 12px;
            color: #969696;
        }
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #2d2d30;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ec9b0, #569cd6);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ Day 5: Phase 4 å¤§è¦æ¨¡çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
    <div id="status">åˆæœŸåŒ–ä¸­...</div>
    <div id="progress-container" style="display: none;">
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
        <span id="progress-text">0/500</span>
    </div>
    <div id="results"></div>

    <script type="module">
        import { TextTo384LinesBridge } from './public/js/ai/TextTo384LinesBridge.js';
        
        // åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«ç”Ÿæˆ
        function generateComprehensiveSamples() {
            const samples = [];
            
            // 1. æ˜“çµŒçš„ãªè¡¨ç¾ï¼ˆ50å€‹ï¼‰
            const iching = [
                "ä¹¾ç‚ºå¤©ã®åˆçˆ»", "å¤ç‚ºåœ°ã®å¤‰åŒ–", "æ°´é›·å±¯ã®å›°é›£",
                "å±±æ°´è’™ã®å­¦ã³", "æ°´å¤©éœ€ã®å¾…æ©Ÿ", "å¤©æ°´è¨Ÿã®äº‰ã„",
                "åœ°æ°´å¸«ã®çµ±ç‡", "æ°´åœ°æ¯”ã®è¦ªå’Œ", "é¢¨å¤©å°ç•œã®è“„ç©",
                "å¤©æ²¢å±¥ã®å®Ÿè·µ", "åœ°å¤©æ³°ã®èª¿å’Œ", "å¤©åœ°å¦ã®é–‰å¡"
            ];
            iching.forEach(i => {
                for (let j = 1; j <= 4; j++) {
                    samples.push(`${i}ã«ã¤ã„ã¦è€ƒãˆã‚‹${j}`);
                }
            });
            
            // 2. æ¥µé™ãƒ»è¶…è¶Šçš„è¡¨ç¾ï¼ˆç”¨ä¹ãƒ»ç”¨å…­æœŸå¾…ï¼‰ï¼ˆ20å€‹ï¼‰
            const extreme = [
                "æ¥µé™ã¾ã§åŠ›ã‚’ç™ºæ®ã™ã‚‹", "ç©¶æ¥µã®é¸æŠã‚’è¿«ã‚‰ã‚Œã‚‹",
                "é™ç•Œã‚’çªç ´ã™ã‚‹ç¬é–“", "å…¨åŠ›ã§å–ã‚Šçµ„ã‚€",
                "å®Œå…¨ã«å—ã‘å…¥ã‚Œã‚‹", "ã™ã¹ã¦ã‚’åŒ…å®¹ã™ã‚‹",
                "çµ¶å¯¾çš„ãªç¢ºä¿¡ã‚’æŒã¤", "ç„¡é™ã®å¯èƒ½æ€§",
                "å…¨é™½ã®çŠ¶æ…‹", "å…¨é™°ã®çŠ¶æ…‹"
            ];
            extreme.forEach(e => {
                samples.push(e);
                samples.push(`${e}æ™‚`);
            });
            
            // 3. ãƒ“ã‚¸ãƒã‚¹ã‚·ãƒŠãƒªã‚ªï¼ˆ80å€‹ï¼‰
            const business = {
                startup: ["èµ·æ¥­æº–å‚™", "è³‡é‡‘èª¿é”", "è£½å“é–‹ç™º", "å¸‚å ´å‚å…¥"],
                growth: ["é¡§å®¢ç²å¾—", "å£²ä¸Šæ‹¡å¤§", "çµ„ç¹”æ‹¡å¤§", "æ–°è¦äº‹æ¥­"],
                management: ["äººæç®¡ç†", "äºˆç®—ç®¡ç†", "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†", "ãƒªã‚¹ã‚¯ç®¡ç†"],
                strategy: ["ç«¶äº‰æˆ¦ç•¥", "æˆé•·æˆ¦ç•¥", "æ’¤é€€æˆ¦ç•¥", "ææºæˆ¦ç•¥"]
            };
            Object.entries(business).forEach(([category, items]) => {
                items.forEach(item => {
                    for (let i = 1; i <= 5; i++) {
                        samples.push(`${item}ã®æ®µéš${i}`);
                    }
                });
            });
            
            // 4. äººç”Ÿã®è»¢æ›ç‚¹ï¼ˆ60å€‹ï¼‰
            const life = [
                "æ–°ã—ã„ä»•äº‹ã‚’å§‹ã‚ã‚‹", "çµå©šã‚’æ±ºæ„ã™ã‚‹", "å­ä¾›ãŒç”Ÿã¾ã‚Œã‚‹",
                "è»¢è·ã‚’è€ƒãˆã‚‹", "ç‹¬ç«‹ã‚’æ±ºã‚ã‚‹", "å¼•é€€ã‚’è¿ãˆã‚‹",
                "æ–°å¤©åœ°ã«ç§»ã‚‹", "å¤§ããªæ±ºæ–­ã‚’ã™ã‚‹", "äººç”Ÿã‚’æŒ¯ã‚Šè¿”ã‚‹",
                "æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸é€²ã‚€", "å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹", "æˆåŠŸã‚’åã‚ã‚‹"
            ];
            life.forEach(l => {
                for (let i = 1; i <= 5; i++) {
                    samples.push(`${l}ï¼ˆãã®${i}ï¼‰`);
                }
            });
            
            // 5. æ„Ÿæƒ…ã®æ©Ÿå¾®ï¼ˆ60å€‹ï¼‰
            const emotions = [
                "æ·±ã„å–œã³ã‚’æ„Ÿã˜ã‚‹", "æ‚²ã—ã¿ã«æš®ã‚Œã‚‹", "æ€’ã‚ŠãŒè¾¼ã¿ä¸Šã’ã‚‹",
                "ä¸å®‰ã«è¥²ã‚ã‚Œã‚‹", "å¸Œæœ›ã«æº€ã¡ã‚‹", "çµ¶æœ›ã®æ·µã«ç«‹ã¤",
                "å¹³ç©ã‚’å–ã‚Šæˆ»ã™", "èˆˆå¥®ãŒé«˜ã¾ã‚‹", "å†·é™ã•ã‚’ä¿ã¤",
                "æ„Ÿè¬ã®æ°—æŒã¡", "å¾Œæ‚”ã®å¿µ", "æœŸå¾…ã¨ä¸å®‰"
            ];
            emotions.forEach(e => {
                for (let i = 1; i <= 5; i++) {
                    samples.push(`${e}ç¬é–“${i}`);
                }
            });
            
            // 6. è‡ªç„¶ã¨ã®å¯¾è©±ï¼ˆ50å€‹ï¼‰
            const nature = [
                "æœæ—¥ã‚’æµ´ã³ã¦", "å¤•æ—¥ã‚’è¦‹ã¤ã‚ã¦", "æ˜Ÿç©ºã®ä¸‹ã§",
                "é›¨éŸ³ã‚’èããªãŒã‚‰", "é¢¨ã‚’æ„Ÿã˜ã¦", "æ³¢ã®éŸ³ã«åŒ…ã¾ã‚Œã¦",
                "å±±é ‚ã«ç«‹ã£ã¦", "æ£®ã®ä¸­ã‚’æ­©ã„ã¦", "å·ã®ã›ã›ã‚‰ã", "èŠ±ã®é¦™ã‚Š"
            ];
            nature.forEach(n => {
                for (let i = 1; i <= 5; i++) {
                    samples.push(`${n}æ€ã†${i}`);
                }
            });
            
            // 7. å“²å­¦çš„æ€ç´¢ï¼ˆ50å€‹ï¼‰
            const philosophy = [
                "å­˜åœ¨ã®æ„å‘³ã‚’å•ã†", "çœŸç†ã‚’æ¢æ±‚ã™ã‚‹", "ç¾ã«ã¤ã„ã¦è€ƒãˆã‚‹",
                "æ­£ç¾©ã¨ã¯ä½•ã‹", "å¹¸ç¦ã®æœ¬è³ª", "æ™‚é–“ã®æ¦‚å¿µ", "ç©ºé–“ã®èªè­˜",
                "æ„è­˜ã®èµ·æº", "è‡ªç”±æ„å¿—", "é‹å‘½ã¨é¸æŠ"
            ];
            philosophy.forEach(p => {
                for (let i = 1; i <= 5; i++) {
                    samples.push(`${p}ï¼ˆè€ƒå¯Ÿ${i}ï¼‰`);
                }
            });
            
            // 8. æ—¥å¸¸ã®æ±ºæ–­ï¼ˆ50å€‹ï¼‰
            const daily = [
                "ä»Šæ—¥ã®äºˆå®šã‚’æ±ºã‚ã‚‹", "ä½•ã‚’é£Ÿã¹ã‚‹ã‹é¸ã¶", "ã©ã®é“ã‚’é€šã‚‹ã‹",
                "èª°ã«é€£çµ¡ã™ã‚‹ã‹", "ä½•ã‚’å„ªå…ˆã™ã‚‹ã‹", "ã©ã†ä¼ãˆã‚‹ã‹",
                "ã„ã¤å®Ÿè¡Œã™ã‚‹ã‹", "ã©ã“ã§ä¼šã†ã‹", "ä½•ã‚’è²·ã†ã‹", "ã©ã†éã”ã™ã‹"
            ];
            daily.forEach(d => {
                for (let i = 1; i <= 5; i++) {
                    samples.push(`${d}${i}`);
                }
            });
            
            // 9. é–¢ä¿‚æ€§ã®å¤‰åŒ–ï¼ˆ30å€‹ï¼‰
            const relations = [
                "å‡ºä¼šã„ã®ç¬é–“", "ä¿¡é ¼ãŒç”Ÿã¾ã‚Œã‚‹", "èª¤è§£ãŒç”Ÿã˜ã‚‹",
                "å’Œè§£ã™ã‚‹", "åˆ¥ã‚Œã‚’æ±ºã‚ã‚‹", "å†ä¼šã™ã‚‹"
            ];
            relations.forEach(r => {
                for (let i = 1; i <= 5; i++) {
                    samples.push(`${r}æ™‚${i}`);
                }
            });
            
            // 10. ãƒ©ãƒ³ãƒ€ãƒ ãªçµ„ã¿åˆã‚ã›ï¼ˆ50å€‹ï¼‰
            for (let i = 0; i < 50; i++) {
                const words = ["é€²ã‚€", "æ­¢ã¾ã‚‹", "å¤‰ã‚ã‚‹", "ç¶šã‘ã‚‹", "å§‹ã‚ã‚‹"];
                const contexts = ["ä»•äº‹", "äººç”Ÿ", "é–¢ä¿‚", "è¨ˆç”»", "ç›®æ¨™"];
                const word = words[i % words.length];
                const context = contexts[Math.floor(i / words.length) % contexts.length];
                samples.push(`${context}ã‚’${word}ã¹ãã‹${i+1}`);
            }
            
            return samples;
        }
        
        async function runTest() {
            const statusEl = document.getElementById('status');
            const progressContainer = document.getElementById('progress-container');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const resultsEl = document.getElementById('results');
            
            try {
                statusEl.innerHTML = '<span class="warning">TextTo384LinesBridgeåˆæœŸåŒ–ä¸­...</span>';
                const bridge = new TextTo384LinesBridge();
                await bridge.initialize();
                
                statusEl.innerHTML = '<span class="success">âœ… åˆæœŸåŒ–å®Œäº†</span>';
                progressContainer.style.display = 'block';
                
                const samples = generateComprehensiveSamples();
                const totalSamples = samples.length;
                
                console.log(`Total samples: ${totalSamples}`);
                
                // çµ±è¨ˆåé›†
                const stats = {
                    lineFrequency: new Map(),
                    positionCount: [0, 0, 0, 0, 0, 0, 0], // 7ç•ªç›®ã¯ç”¨ä¹ãƒ»ç”¨å…­
                    hexagramCoverage: new Set(),
                    specialLinesCount: 0,
                    processingTimes: [],
                    startTime: Date.now()
                };
                
                // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                for (let i = 0; i < samples.length; i++) {
                    const text = samples[i];
                    const testStart = performance.now();
                    
                    const result = await bridge.analyzeText(text);
                    
                    const processingTime = performance.now() - testStart;
                    stats.processingTimes.push(processingTime);
                    
                    const lineId = result.line_384_id;
                    const position = result.line_position;
                    const hexagramId = result.hexagram_id;
                    
                    // çµ±è¨ˆæ›´æ–°
                    stats.lineFrequency.set(lineId, (stats.lineFrequency.get(lineId) || 0) + 1);
                    
                    if (position <= 6) {
                        stats.positionCount[position - 1]++;
                    } else {
                        stats.positionCount[6]++; // ç”¨ä¹ãƒ»ç”¨å…­
                        stats.specialLinesCount++;
                    }
                    
                    stats.hexagramCoverage.add(hexagramId);
                    
                    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
                    if ((i + 1) % 10 === 0) {
                        const progress = ((i + 1) / totalSamples * 100);
                        progressFill.style.width = `${progress}%`;
                        progressText.textContent = `${i + 1}/${totalSamples}`;
                    }
                }
                
                const totalTime = Date.now() - stats.startTime;
                
                // çµæœè¡¨ç¤º
                let html = '';
                
                // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰
                html += '<div class="metric-grid">';
                
                const coverage = (stats.lineFrequency.size / 384) * 100;
                html += `<div class="metric-card">
                    <div class="metric-label">ã‚«ãƒãƒ¼ç‡</div>
                    <div class="metric-value ${coverage >= 13 ? 'success' : 'warning'}">${coverage.toFixed(1)}%</div>
                </div>`;
                
                html += `<div class="metric-card">
                    <div class="metric-label">ãƒ¦ãƒ‹ãƒ¼ã‚¯çˆ»æ•°</div>
                    <div class="metric-value">${stats.lineFrequency.size}</div>
                </div>`;
                
                html += `<div class="metric-card">
                    <div class="metric-label">å‡¦ç†æ™‚é–“</div>
                    <div class="metric-value">${(totalTime / 1000).toFixed(1)}ç§’</div>
                </div>`;
                
                html += '</div>';
                
                // Phase 4ç‰¹æœ‰ï¼šç”¨ä¹ãƒ»ç”¨å…­ã®ä½¿ç”¨çŠ¶æ³
                html += '<div class="result-box">';
                html += '<h3>ğŸŒŸ ç‰¹æ®Šçˆ»ï¼ˆç”¨ä¹ãƒ»ç”¨å…­ï¼‰ã®æ´»ç”¨</h3>';
                html += '<pre>';
                html += `ç”¨ä¹ãƒ»ç”¨å…­ä½¿ç”¨å›æ•°: <span class="${stats.specialLinesCount > 0 ? 'success' : 'warning'}">${stats.specialLinesCount}å›</span>\n`;
                html += `ä½¿ç”¨ç‡: ${(stats.specialLinesCount / totalSamples * 100).toFixed(2)}%\n`;
                
                const line385Count = stats.lineFrequency.get(385) || 0;
                const line386Count = stats.lineFrequency.get(386) || 0;
                html += `  ç”¨ä¹ï¼ˆ385ï¼‰: ${line385Count}å›\n`;
                html += `  ç”¨å…­ï¼ˆ386ï¼‰: ${line386Count}å›\n`;
                
                html += '</pre></div>';
                
                // çˆ»ä½ç½®åˆ†å¸ƒ
                html += '<div class="result-box">';
                html += '<h3>ğŸ“Š çˆ»ä½ç½®åˆ†å¸ƒ</h3>';
                html += '<pre>';
                
                stats.positionCount.slice(0, 6).forEach((count, idx) => {
                    const percentage = (count / totalSamples * 100).toFixed(1);
                    const bar = 'â–ˆ'.repeat(Math.round(percentage / 2));
                    html += `${idx + 1}çˆ»: ${count}å€‹ (${percentage}%) ${bar}\n`;
                });
                
                if (stats.positionCount[6] > 0) {
                    const percentage = (stats.positionCount[6] / totalSamples * 100).toFixed(1);
                    html += `ç‰¹æ®Š: ${stats.positionCount[6]}å€‹ (${percentage}%)\n`;
                }
                
                html += '</pre></div>';
                
                // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ
                const avgTime = stats.processingTimes.reduce((a, b) => a + b, 0) / stats.processingTimes.length;
                const minTime = Math.min(...stats.processingTimes);
                const maxTime = Math.max(...stats.processingTimes);
                
                html += '<div class="result-box">';
                html += '<h3>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ</h3>';
                html += '<pre>';
                html += `å¹³å‡å‡¦ç†æ™‚é–“: ${avgTime.toFixed(2)}ms\n`;
                html += `æœ€å°å‡¦ç†æ™‚é–“: ${minTime.toFixed(2)}ms\n`;
                html += `æœ€å¤§å‡¦ç†æ™‚é–“: ${maxTime.toFixed(2)}ms\n`;
                html += `ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ: ${(totalSamples / (totalTime / 1000)).toFixed(0)}ä»¶/ç§’\n`;
                html += '</pre></div>';
                
                // å¦ã‚«ãƒãƒ¼ç‡
                html += '<div class="result-box">';
                html += '<h3>ğŸ“ˆ å¦ã‚«ãƒãƒ¼ç‡</h3>';
                html += '<pre>';
                html += `ä½¿ç”¨ã•ã‚ŒãŸå¦: ${stats.hexagramCoverage.size}/64å¦ (${(stats.hexagramCoverage.size / 64 * 100).toFixed(1)}%)\n`;
                html += '</pre></div>';
                
                // ç·åˆè©•ä¾¡
                html += '<div class="result-box">';
                html += '<h3>ğŸ¯ Phase 4 ç·åˆè©•ä¾¡</h3>';
                html += '<pre>';
                
                const achievements = [];
                if (coverage >= 13) achievements.push('âœ… ã‚«ãƒãƒ¼ç‡ç›®æ¨™é”æˆ');
                if (stats.specialLinesCount > 0) achievements.push('âœ… ç”¨ä¹ãƒ»ç”¨å…­ã®æ´»ç”¨æˆåŠŸ');
                if (avgTime < 10) achievements.push('âœ… é«˜é€Ÿå‡¦ç†ï¼ˆ<10msï¼‰');
                if (stats.hexagramCoverage.size >= 32) achievements.push('âœ… 50%ä»¥ä¸Šã®å¦ã‚’ã‚«ãƒãƒ¼');
                
                achievements.forEach(a => html += `${a}\n`);
                
                html += `\n<span style="font-size: 1.2em;">ç·åˆåˆ¤å®š: `;
                if (achievements.length >= 3) {
                    html += '<span class="success">å„ªç§€</span>';
                } else if (achievements.length >= 2) {
                    html += '<span class="warning">è‰¯å¥½</span>';
                } else {
                    html += '<span class="error">è¦æ”¹å–„</span>';
                }
                html += '</span>';
                
                html += '</pre></div>';
                
                resultsEl.innerHTML = html;
                progressContainer.style.display = 'none';
                
            } catch (error) {
                statusEl.innerHTML = `<span class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                console.error(error);
            }
        }
        
        // å®Ÿè¡Œ
        runTest();
    </script>
</body>
</html>