import { readFile, writeFile } from 'fs/promises';

async function fixPhase18EightFinal() {
  try {
    console.log('=== フェーズ18: 最終8文字208件を一行一行修正 ===\n');
    
    // データベース読み込み
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // 8文字の説明を一行一行丁寧に修正（208件）
    const eightCharFixes = {
      // 水・火系メタファー
      '"水のような適応力"': '"水のような柔軟な適応力"',
      '"人を熱くさせる力"': '"人を熱くさせる強い力"',
      '"火のような激しさ"': '"火のような激しい情熱"',
      '"水のように流れる"': '"水のように自然に流れる"',
      
      // 感覚・感受性系
      '"感覚の休息が必要"': '"感覚の休息が必要な時"',
      '"適度な刺激と休息"': '"適度な刺激と休息が必要"',
      '"鈍感な人との会話"': '"鈍感な人との会話が苦手"',
      '"感受性豊かな人々"': '"感受性豊かな人々と共に"',
      '"感じすぎて疲れる"': '"感じすぎて疲れやすい"',
      '"感覚を麻痺させる"': '"感覚を麻痺させて守る"',
      
      // 安心・信頼系
      '"変わらない安心感"': '"変わらない安心感を与える"',
      '"長期的視点の人々"': '"長期的視点を持つ人々"',
      '"変わらない信頼感"': '"変わらない信頼感を築く"',
      '"じっと耐えて続ける"': '"じっと耐えて続けていく"',
      '"継続しながら回復"': '"継続しながら回復する"',
      
      // 退避・回避系
      '"安全な退路と避難所"': '"安全な退路と避難所を確保"',
      '"危機回避の成功体験"': '"危機回避の成功体験を積む"',
      '"適度な距離感を保つ"': '"適度な距離感を保って接する"',
      '"退避後の安全な場所"': '"退避後の安全な場所で休む"',
      '"距離を置いて観察"': '"距離を置いて冷静に観察"',
      
      // 力・エネルギー系
      '"大きな力を持つ人々"': '"大きな力を持つ人々と協力"',
      '"力の適切な使い方"': '"力の適切な使い方を学ぶ"',
      '"力を持った者の責任"': '"力を持った者の責任を果たす"',
      '"パワフルさと優しさ"': '"パワフルさと優しさを両立"',
      '"力を制御して発揮"': '"力を制御して効果的に発揮"',
      '"力を溜めながら回復"': '"力を溜めながら徐々に回復"',
      
      // 集中・静寂系
      '"内側に集中する力"': '"内側に集中する強い力"',
      '"静かな場所での充電"': '"静かな場所でエネルギー充電"',
      '"内省的な人々と共に"': '"内省的な人々と共に過ごす"',
      '"一人の時間を大切に"': '"一人の時間を大切にする"',
      '"静寂の中で考える"': '"静寂の中でじっくり考える"',
      '"内面を見つめ直す"': '"内面を見つめ直して成長"',
      
      // 明るさ・楽観系
      '"明るく楽観的な人々"': '"明るく楽観的な人々と活動"',
      '"希望を語り続ける"': '"希望を語り続けて励ます"',
      '"前向きな姿勢を保つ"': '"前向きな姿勢を常に保つ"',
      '"楽観的過ぎる傾向"': '"楽観的過ぎる傾向がある"',
      '"明るく振る舞う"': '"明るく振る舞って場を和ます"',
      '"笑顔で乗り切る"': '"笑顔で困難を乗り切る"',
      
      // 交流・家族系
      '"交流を楽しむ人々"': '"交流を楽しむ人々と活動"',
      '"大家族的な雰囲気"': '"大家族的な温かい雰囲気"',
      '"みんなと一緒に成長"': '"みんなと一緒に成長する"',
      '"交流の中で生きる"': '"交流の中で生き生きする"',
      '"人との繋がりを重視"': '"人との繋がりを重視する"',
      
      // 問題解決系
      '"問題を直視する人々"': '"問題を直視する勇敢な人々"',
      '"困難に立ち向かう"': '"困難に果敢に立ち向かう"',
      '"問題から逃げない"': '"問題から逃げずに対処"',
      '"困難を乗り越える"': '"困難を乗り越えて成長"',
      
      // 損得・利益系
      '"損得を超えた関係"': '"損得を超えた純粋な関係"',
      '"利益を生む環境作り"': '"利益を生む環境を作る"',
      '"win-winを目指す"': '"win-winの関係を目指す"',
      '"相互利益の追求"': '"相互利益を追求する"',
      
      // 拡大・成長系
      '"拡大志向の人々"': '"拡大志向を持つ人々"',
      '"成長を続ける環境"': '"成長を続けられる環境"',
      '"発展的な関係構築"': '"発展的な関係を構築する"',
      '"前進し続ける力"': '"前進し続ける強い力"',
      
      // リスク・危険系
      '"リスクを恐れない"': '"リスクを恐れずに挑戦"',
      '"危険を察知する力"': '"危険を察知する鋭い力"',
      '"冒険心のある人々"': '"冒険心のある人々と行動"',
      '"危機管理能力"': '"危機管理能力を発揮する"',
      
      // 決断・実行系
      '"決断力のある人々"': '"決断力のある人々と協働"',
      '"迷わず実行する"': '"迷わず実行に移す"',
      '"即断即決の精神"': '"即断即決の精神で動く"',
      '"実行力を重視"': '"実行力を重視して活動"',
      
      // 分散・集約系
      '"エネルギーの分散"': '"エネルギーを分散させる"',
      '"力を集約させる"': '"力を一点に集約させる"',
      '"分散から統合へ"': '"分散から統合へ向かう"',
      '"拡散を防ぐ工夫"': '"拡散を防ぐ工夫をする"',
      
      // 完成・仕上げ系
      '"完璧を求める人々"': '"完璧を求める人々と作業"',
      '"仕上げにこだわる"': '"仕上げに徹底的にこだわる"',
      '"完成度を追求"': '"完成度を追求し続ける"',
      '"最後まで諦めない"': '"最後まで諦めずに完成"',
      
      // バランス・調和系
      '"バランス感覚が鋭い"': '"バランス感覚が鋭い人"',
      '"調和を重視する"': '"調和を重視して行動"',
      '"中庸を保つ努力"': '"中庸を保つ努力を続ける"',
      '"均衡を維持する"': '"均衡を維持して安定"',
      
      // 細やか・繊細系
      '"細部にこだわる人々"': '"細部にこだわる人々と仕事"',
      '"繊細な感性を持つ"': '"繊細な感性を持って接する"',
      '"丁寧な仕事ぶり"': '"丁寧な仕事ぶりを貫く"',
      '"細かい配慮"': '"細かい配慮を欠かさない"',
      
      // 大胆・勇気系
      '"大胆な行動を取る"': '"大胆な行動を取って進む"',
      '"勇気ある人々"': '"勇気ある人々と共に挑戦"',
      '"恐れず前進する"': '"恐れず前進し続ける"',
      '"果敢に挑戦する"': '"果敢に挑戦して成長"',
      
      // 変革・革新系
      '"変革を恐れない"': '"変革を恐れずに進む"',
      '"革新的な人々"': '"革新的な人々と創造"',
      '"現状打破の精神"': '"現状打破の精神で動く"',
      '"変化を起こす力"': '"変化を起こす強い力"',
      
      // 安定・継続系
      '"安定を重視する"': '"安定を重視して基盤作り"',
      '"継続は力なり"': '"継続は力なりを実践"',
      '"地道な努力を続ける"': '"地道な努力を続けていく"',
      '"変化の少ない環境"': '"変化の少ない安定環境"',
      
      // 流動・変化系
      '"流動的な環境"': '"流動的な環境で柔軟に"',
      '"変化に適応する"': '"変化に素早く適応する"',
      '"柔軟性を保つ"': '"柔軟性を保って対応"',
      '"流れに乗る感覚"': '"流れに乗る感覚を大切に"',
      
      // 時間・タイミング系
      '"タイミングを計る"': '"タイミングを慎重に計る"',
      '"時を待つ忍耐力"': '"時を待つ忍耐力を持つ"',
      '"適切な時期を見極め"': '"適切な時期を見極める"',
      '"時間をかけて育む"': '"時間をかけて関係を育む"',
      
      // 準備・計画系
      '"準備を怠らない"': '"準備を怠らずに進める"',
      '"計画的に進める"': '"計画的に物事を進める"',
      '"段取りを重視"': '"段取りを重視して実行"',
      '"先を見据えて動く"': '"先を見据えて行動する"',
      
      // 直感・感性系
      '"直感を信じる"': '"直感を信じて行動する"',
      '"感性を大切にする"': '"感性を大切にして生きる"',
      '"インスピレーション"': '"インスピレーションを活かす"',
      '"第六感を活用"': '"第六感を活用して判断"',
      
      // 理性・論理系
      '"論理的に考える"': '"論理的に考えて判断"',
      '"理性的な判断"': '"理性的な判断を下す"',
      '"合理的な選択"': '"合理的な選択をする"',
      '"客観的な視点"': '"客観的な視点を保つ"',
      
      // 感情・情緒系
      '"感情を大切にする"': '"感情を大切にして生きる"',
      '"情緒豊かな表現"': '"情緒豊かな表現をする"',
      '"心の動きに敏感"': '"心の動きに敏感に反応"',
      '"感情の波を受け入れ"': '"感情の波を受け入れる"',
      
      // 行動・実践系
      '"行動で示す姿勢"': '"行動で示す姿勢を貫く"',
      '"実践を重視する"': '"実践を重視して学ぶ"',
      '"動きながら考える"': '"動きながら考えて進む"',
      '"アクティブな姿勢"': '"アクティブな姿勢を保つ"',
      
      // 思考・熟考系
      '"じっくり考える"': '"じっくり考えて決める"',
      '"熟考してから動く"': '"熟考してから行動する"',
      '"深い思索を好む"': '"深い思索を好んで行う"',
      '"考え抜く姿勢"': '"考え抜く姿勢を大切に"',
      
      // 創造・想像系
      '"創造力を発揮"': '"創造力を発揮して活動"',
      '"想像力豊かな人々"': '"想像力豊かな人々と創作"',
      '"新しいものを生む"': '"新しいものを生み出す"',
      '"クリエイティブ"': '"クリエイティブに活動する"',
      
      // 破壊・再生系
      '"破壊と創造の両立"': '"破壊と創造を両立させる"',
      '"古いものを壊す"': '"古いものを壊して新生"',
      '"再生への道筋"': '"再生への道筋を作る"',
      '"スクラップ&ビルド"': '"スクラップ&ビルドを実践"',
      
      // 保守・維持系
      '"現状を維持する"': '"現状を維持して安定"',
      '"伝統を守る姿勢"': '"伝統を守る姿勢を持つ"',
      '"保守的な考え方"': '"保守的な考え方で守る"',
      '"既存の枠組み重視"': '"既存の枠組みを重視する"',
      
      // 革新・挑戦系
      '"新しいことに挑戦"': '"新しいことに果敢に挑戦"',
      '"革新的なアイデア"': '"革新的なアイデアを出す"',
      '"チャレンジ精神"': '"チャレンジ精神を持つ"',
      '"未知への探求心"': '"未知への探求心を持つ"',
      
      // 協調・協力系
      '"協力して進める"': '"協力して物事を進める"',
      '"チームワーク重視"': '"チームワークを重視する"',
      '"協調性を大切に"': '"協調性を大切にする"',
      '"みんなで成し遂げる"': '"みんなで成し遂げる喜び"',
      
      // 独立・自立系
      '"独立心を持つ"': '"独立心を持って行動"',
      '"自立した姿勢"': '"自立した姿勢を保つ"',
      '"一人で進む勇気"': '"一人で進む勇気を持つ"',
      '"自己完結型"': '"自己完結型で物事を進める"',
      
      // リーダー・フォロワー系
      '"リーダーシップ"': '"リーダーシップを発揮する"',
      '"導く立場を取る"': '"導く立場を取って指導"',
      '"フォロワーとして"': '"フォロワーとして支える"',
      '"支える役割を担う"': '"支える役割を担って貢献"',
      
      // 攻撃・防御系
      '"攻めの姿勢を保つ"': '"攻めの姿勢を保って前進"',
      '"守りを固める"': '"守りを固めて安全確保"',
      '"攻守のバランス"': '"攻守のバランスを取る"',
      '"防御態勢を整える"': '"防御態勢を整えて備える"',
      
      // 開放・閉鎖系
      '"オープンな姿勢"': '"オープンな姿勢で接する"',
      '"心を開いて接する"': '"心を開いて人と接する"',
      '"閉じた状態から開く"': '"閉じた状態から徐々に開く"',
      '"ガードを下げる"': '"ガードを下げて信頼する"',
      
      // 集中・分散系
      '"一点集中型"': '"一点集中型で取り組む"',
      '"マルチタスク型"': '"マルチタスク型で処理"',
      '"集中力を高める"': '"集中力を高めて取り組む"',
      '"分散して効率化"': '"分散して効率化を図る"',
      
      // 速度・ペース系
      '"スピード重視"': '"スピード重視で進める"',
      '"ゆっくり着実に"': '"ゆっくり着実に進む"',
      '"自分のペースで"': '"自分のペースで進める"',
      '"急がず焦らず"': '"急がず焦らず確実に"',
      
      // その他の8文字
      '"シャッターを下ろす"': '"シャッターを下ろして守る"',
      '"人との交流を楽しむ"': '"人との交流を楽しんで成長"',
      '"エネルギーを充電"': '"エネルギーを充電する"',
      '"休息と回復の時間"': '"休息と回復の時間を取る"',
      '"新たな始まりへ"': '"新たな始まりへ向かう"',
      '"次のステージへ"': '"次のステージへ進む"',
      '"サイクルの完成"': '"サイクルを完成させる"',
      '"循環の中で生きる"': '"循環の中で生きていく"'
    };
    
    // バックアップ作成
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase18.${timestamp}.js`, content);
    console.log(`📁 バックアップ作成: hexagram-human-traits-v3.backup.phase18.${timestamp}.js\n`);
    
    // 修正適用
    let totalFixCount = 0;
    let successfulFixes = [];
    
    console.log('8文字の修正を適用中...\n');
    
    Object.entries(eightCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const matches = content.match(regex);
      if (matches) {
        content = content.replace(regex, newText);
        totalFixCount += matches.length;
        successfulFixes.push(`${old} → ${newText} (${matches.length}箇所)`);
      }
    });
    
    // 成功した修正を表示
    console.log('【修正成功項目】');
    if (successfulFixes.length > 0) {
      successfulFixes.slice(0, 20).forEach(fix => {
        console.log(`✅ ${fix}`);
      });
      if (successfulFixes.length > 20) {
        console.log(`... 他 ${successfulFixes.length - 20}件`);
      }
    } else {
      console.log('修正対象が見つかりませんでした。');
    }
    
    // ファイル保存
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`\n=== フェーズ18完了 ===`);
    console.log(`総修正件数: ${totalFixCount}件`);
    console.log(`修正成功項目: ${successfulFixes.length}種類`);
    console.log(`\n次のフェーズ: node fix-short-descriptions-phase19-nine-final.mjs`);
    
  } catch (error) {
    console.error('エラー:', error);
  }
}

fixPhase18EightFinal();