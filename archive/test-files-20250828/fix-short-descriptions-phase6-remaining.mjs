import { readFile, writeFile } from 'fs/promises';

async function fixPhase6Remaining() {
  try {
    console.log('=== フェーズ6: 7-9文字の残り修正 ===\n');
    
    // データベース読み込み
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // 7文字の修正（184件から主要なもの）
    const sevenCharFixes = {
      // whatYouNeed（必要なもの）
      '"解決すべき課題"': '"解決すべき課題や問題がある環境"',
      '"シンプルな環境"': '"余計なものがないシンプルな環境"',
      '"素敵な出会い"': '"素敵な人との新しい出会い"',
      '"変革すべき対象"': '"変革すべき対象となる課題"',
      '"源泉を大切に"': '"エネルギーの源泉を大切にする"',
      
      // howToCharge（充電方法）
      '"体を動かすこと"': '"体を動かしてエネルギーを充電する"',
      '"適度な休息"': '"適度な休息を取ることが大切"',
      '"感情を共有"': '"他者と感情を共有して充電する"',
      '"問題の解決"': '"問題を解決することで充電する"',
      '"美的体験"': '"美しいものに触れて充電する"',
      '"新しい始まり"': '"新しい始まりでエネルギーを得る"',
      '"健康的な生活"': '"健康的な生活でエネルギーを維持"',
      '"感覚的な体験"': '"五感を使った体験で充電する"',
      '"長期的な計画"': '"長期的な計画を立てて充電する"',
      '"新しい視点"': '"新しい視点を得ることで充電する"',
      '"実力の証明"': '"実力を証明して自信を充電する"',
      '"独自の発見"': '"独自の発見をして充電する"',
      '"困難の克服"': '"困難を克服して充電する"',
      '"自由の獲得"': '"自由を獲得して充電する"',
      '"与える喜び"': '"他者に与える喜びで充電する"',
      '"価値の創造"': '"新しい価値を創造して充電する"',
      '"段階的な進歩"': '"段階的に進歩して充電する"',
      '"関係の調和"': '"人間関係の調和で充電する"',
      '"流れに乗る"': '"自然の流れに乗って充電する"',
      '"節度を保つ"': '"適切な節度を保って充電する"',
      '"信頼の構築"': '"信頼関係を構築して充電する"',
      '"完成の実感"': '"物事を完成させた実感で充電する"',
      
      // note（注意点）
      '"無を楽しむ"': '"何もしない時間を楽しむことも大切"',
      '"内なる平和が大切"': '"内なる平和を保つことが大切"',
      '"美的感覚を養う"': '"美的感覚を養い続けることが大切"',
      '"次の飛躍への準備"': '"次の飛躍に向けて準備する時間"',
      '"頭を空っぽにする"': '"時には頭を空っぽにすることも必要"',
      '"一歩ずつ確実に"': '"焦らず一歩ずつ確実に進む"',
      
      // weakness（弱点）
      '"孤独を感じやすい"': '"一人でいると孤独を感じやすい"',
      '"極端になりやすい"': '"考えや行動が極端になりやすい"',
      '"感情移入しすぎる"': '"相手に感情移入しすぎる傾向"',
      '"軽く見られることも"': '"軽い人と見られることもある"',
      '"本心が見えにくい"': '"本当の気持ちが見えにくい"',
      '"批判的に見られがち"': '"批判的な人と見られがちになる"',
      '"距離を感じさせる"': '"他者に距離を感じさせやすい"',
      '"現場感覚に欠ける"': '"現場の実感に欠けることがある"',
      '"独断的に見られる"': '"独断的な人と見られやすい"',
      '"表面的に見られがち"': '"表面的な人と見られがちになる"',
      '"冷たく感じられる"': '"冷たい人と感じられやすい"',
      '"子供っぽく見られる"': '"子供っぽい人と見られやすい"',
      '"頑固に見られる"': '"頑固な人と見られやすい"',
      '"威圧的に感じられる"': '"威圧的と感じられることがある"',
      '"暑苦しいと感じられる"': '"暑苦しい人と感じられやすい"',
      '"しつこく感じられる"': '"しつこい人と感じられやすい"',
      '"変わり者扱い"': '"変わり者として扱われやすい"',
      '"冷酷に見られる"': '"冷酷な人と見られやすい"',
      '"頼りないと見られる"': '"頼りない人と見られやすい"',
      '"強引に見られる"': '"強引な人と見られやすい"',
      '"高慢に見られる"': '"高慢な人と見られやすい"',
      '"依存的に見られる"': '"依存的な人と見られやすい"',
      '"不安定に見られる"': '"不安定な人と見られやすい"',
      '"優柔不断に見られる"': '"優柔不断な人と見られやすい"',
      '"慎重すぎると見られる"': '"慎重すぎる人と見られやすい"',
      
      // goodPoint（良い点）
      '"根本的な解決力"': '"問題を根本から解決する力"',
      '"感情的な浄化力"': '"感情を浄化させる特別な力"',
      '"大局的な解決力"': '"大局的な視点で解決する力"',
      '"立ち直りの早さ"': '"失敗から立ち直る早さ"',
      '"無駄な動きをしない"': '"無駄な動きをせず効率的"',
      '"他人事に見える"': '"冷静すぎて他人事に見える"',
      '"後悔することも"': '"決断を後悔することもある"',
      '"自力解決が苦手"': '"自分の力だけで解決するのが苦手"',
      '"時間が経てば回復"': '"時間が経てば自然に回復する"',
      
      // recovery（回復）
      '"動きながら回復"': '"動き続けることで回復する"',
      '"美を通じて回復"': '"美しいものを通じて回復する"',
      '"行動の結果次第"': '"行動の結果によって回復度が変わる"',
      '"感情の共有で回復"': '"感情を共有することで回復する"',
      '"完全修復と共に回復"': '"完全に修復されると同時に回復"',
      '"泣いたらスッキリ"': '"思い切り泣いたらスッキリする"',
      
      // whatHappens（何が起きるか）
      '"全てを賭けて挑戦"': '"持てる全てを賭けて挑戦する"',
      '"次の挑戦を計画"': '"次の大きな挑戦を計画している"',
      '"障害を避けて流れる"': '"障害を上手く避けて流れていく"',
      '"全感覚を研ぎ澄ます"': '"全ての感覚を研ぎ澄ませる"',
      '"完全に感覚を閉じる"': '"外部の感覚を完全に閉じる"',
      '"淡々と継続する"': '"感情を込めず淡々と継続する"',
      '"最小限の機能で継続"': '"最小限の機能だけで継続する"',
      '"常に退路を確保"': '"常に退路を確保しておく"',
      '"安全な場所で充電"': '"安全な場所でゆっくり充電する"',
      '"その場から離れる"': '"問題のある場所から離れる"',
      
      // 環境・場所
      '"多様性のある環境"': '"多様な価値観がある環境"',
      '"効率性重視の環境"': '"効率性を重視する環境"',
      '"再生と成長の環境"': '"再生と成長ができる環境"',
      '"知識が活きる環境"': '"知識や経験が活きる環境"',
      
      // その他
      '"変化を恐れない人々"': '"変化を恐れずに進む人々"',
      '"向上心のある人々"': '"常に向上心を持つ人々"',
      '"大局観のある人々"': '"大局的な視点を持つ人々"',
      '"協調性のある仲間"': '"協調性を大切にする仲間"',
      '"決断力のある人々"': '"素早く決断できる人々"',
      '"美的センスのある人々"': '"美的センスに優れた人々"',
      '"素直で純粋な人々"': '"素直で純粋な心を持つ人々"',
      '"知識豊富な人々"': '"豊富な知識を持つ人々"',
      '"健康意識の高い人々"': '"健康を大切にする人々"',
      '"チャレンジ精神のある人々"': '"チャレンジ精神旺盛な人々"',
      '"感受性の高い人々"': '"感受性が豊かな人々"',
      '"独立心の強い人々"': '"独立心を持った人々"',
      '"実力のある人々"': '"確かな実力を持つ人々"',
      '"個性的な人々"': '"独自の個性を持つ人々"',
      '"忍耐強い人々"': '"忍耐強く待てる人々"',
      '"自由を愛する人々"': '"自由を大切にする人々"',
      '"献身的な人々"': '"献身的に尽くす人々"',
      '"成長意欲のある人々"': '"成長への意欲が高い人々"',
      '"創造的な人々"': '"創造力豊かな人々"'
    };
    
    // 8文字の修正（300件から主要なもの）
    const eightCharFixes = {
      // strength（強み）
      '"絶対的な信頼性"': '"絶対的な信頼性を持つ存在"',
      '"場を明るくする力"': '"どんな場も明るくする特別な力"',
      '"無駄のない関係性"': '"無駄のない効率的な関係性"',
      '"チームの力を活用"': '"チームの力を最大限に活用する"',
      '"停滞を打破する力"': '"停滞した状況を打破する力"',
      
      // advice（アドバイス）
      '"時には柔軟さも必要"': '"時には柔軟な対応も必要になる"',
      '"時には妥協も必要"': '"時には妥協することも必要"',
      '"時には行動も必要"': '"考えるだけでなく行動も必要"',
      '"時には穏やかさも"': '"時には穏やかな態度も大切"',
      '"時には厳しさも必要"': '"時には厳しい態度も必要"',
      '"時にはリスクも必要"': '"安全ばかりでなくリスクも必要"',
      '"適度な距離感も必要"': '"適度な距離感を保つことも必要"',
      '"現場の声も大切に"': '"現場の声を聞くことも大切"',
      '"時には余白も大切"': '"余白を残すことも時には大切"',
      '"時にはサプライズも"': '"時にはサプライズで驚かせる"',
      '"優しさも強さの一つ"': '"優しさも強さの表れの一つ"',
      '"時には決断も必要"': '"慎重さだけでなく決断も必要"',
      '"休息も成長の一部"': '"休息も成長に必要な一部"',
      '"量より質も大切に"': '"量だけでなく質も大切にする"',
      '"個人も大切にしよう"': '"集団だけでなく個人も大切に"',
      '"定住も時には必要"': '"旅だけでなく定住も時には必要"',
      '"時には固定も必要"': '"流動的なだけでなく固定も必要"',
      '"時には厳格さも必要"': '"柔軟なだけでなく厳格さも必要"',
      '"時には表面的でも良い"': '"深い関係だけでなく表面的でも良い"',
      '"時には不確実でも進む"': '"確実さだけでなく不確実でも進む"',
      '"時には未完成でも良い"': '"完成だけでなく未完成も認める"',
      '"時には立ち止まることも"': '"進むだけでなく立ち止まることも"',
      
      // badPoint（悪い点）
      '"時に無駄な動きも"': '"時に無駄な動きをしてしまう"',
      '"決断が遅れることも"': '"決断が遅れてしまうこともある"',
      '"主体性を失うことも"': '"主体性を失ってしまうこともある"',
      '"機会を逃すことも"': '"良い機会を逃してしまうこともある"',
      '"仕事が後回しになる"': '"仕事を後回しにしてしまう傾向"',
      '"集中力が分散"': '"集中力が分散してしまいやすい"',
      '"孤立することも"': '"周りから孤立してしまうこともある"',
      '"極端になることも"': '"考えが極端になってしまうこともある"',
      '"自己中心的になる"': '"自己中心的になってしまいやすい"',
      '"無責任になることも"': '"無責任になってしまうこともある"',
      '"依存的になることも"': '"依存的になってしまうこともある"',
      '"現実逃避することも"': '"現実から逃避してしまうこともある"',
      
      // recovery/timeToRecover
      '"仲間との絆で回復"': '"仲間との絆を通じて回復する"',
      '"少しずつ立て直す"': '"少しずつ着実に立て直していく"',
      '"少しずつ機能を回復"': '"少しずつ機能を回復させていく"',
      '"時が来れば必ず復活"': '"時が来れば必ず復活できる"',
      '"長期戦（数ヶ月）"': '"数ヶ月かかる長期戦になる"',
      '"自分次第（不定）"': '"自分の努力次第で期間が変わる"',
      '"1週間（再充電）"': '"1週間程度で再充電できる"',
      '"収穫サイクル次第"': '"収穫のサイクルによって変わる"',
      '"旅の期間次第"': '"旅の期間によって回復度が変わる"',
      
      // whenImbalanced（バランスが崩れた時）
      '"直感が強く働く時"': '"直感が特に強く働く時"',
      '"無謀、または臆病"': '"無謀になるか臆病になるか極端"',
      '"過敏、または鈍感"': '"過敏になるか鈍感になるか極端"',
      '"暴走、または無力感"': '"暴走するか無力感に襲われる"',
      '"昇進や成長の機会"': '"昇進や成長の大きな機会"',
      '"真の実力が必要な時"': '"真の実力が試される時"',
      '"長期戦が必要な時"': '"長期戦を覚悟する必要がある時"',
      '"危険を察知した時"': '"危険を本能的に察知した時"',
      
      // withWho（誰と）
      '"学ぶ意欲のある人々"': '"学ぶ意欲に満ちた人々と共に"',
      '"理性的で公正な人々"': '"理性的で公正な判断ができる人々"',
      '"様々なタイプの人々"': '"様々なタイプの多様な人々"',
      '"強い意志のある人々"': '"強い意志を持った人々"',
      '"直感的な人々"': '"直感を大切にする人々"',
      '"安定を求める人々"': '"安定を求める堅実な人々"',
      '"力のある人々"': '"実力と影響力のある人々"',
      '"志の高い人々"': '"高い志を持った人々"',
      '"仲間意識の強い人々"': '"仲間意識を大切にする人々"',
      '"挑戦的な人々"': '"挑戦を恐れない人々"',
      '"変化を受け入れる人々"': '"変化を柔軟に受け入れる人々"',
      '"成長志向の人々"': '"成長を志向する人々"',
      '"困難を共にする人々"': '"困難を共に乗り越える人々"',
      '"革新的な人々"': '"革新的な考えを持つ人々"',
      '"不動の信念を持つ人々"': '"不動の信念を持った人々"',
      '"段階的に進む人々"': '"段階的に物事を進める人々"',
      '"調和を重視する人々"': '"調和を大切にする人々"',
      '"豊かさを分かち合う人々"': '"豊かさを分かち合える人々"',
      '"自由を愛する人々"': '"自由を愛し大切にする人々"',
      '"喜びを共有する人々"': '"喜びを共有できる人々"',
      '"変化を促す人々"': '"変化を促進する人々"',
      '"節度を持つ人々"': '"節度を大切にする人々"',
      '"信頼できる人々"': '"深く信頼できる人々"',
      '"完成を目指す人々"': '"完成を共に目指す人々"',
      '"未来志向の人々"': '"未来を見据える人々"'
    };
    
    // 9文字の修正（253件から主要なもの）
    const nineCharFixes = {
      // strength/weakness
      '"的確な判断と信頼性"': '"的確な判断力と高い信頼性"',
      '"公正な判断と説得力"': '"公正な判断力と強い説得力"',
      '"説得力のある行動力"': '"説得力のある確かな行動力"',
      '"変化を起こす推進力"': '"変化を起こす強い推進力"',
      '"みんなをまとめる力"': '"みんなをまとめる統率力"',
      '"決断の速さと明確さ"': '"素早く明確な決断力"',
      '"場を華やかにする力"': '"場を華やかにする特別な力"',
      
      // environment
      '"温かく支援的な環境"': '"温かく支援的な雰囲気の環境"',
      '"信頼できる仲間たち"': '"深く信頼できる仲間たち"',
      '"素直でいられる環境"': '"素直な自分でいられる環境"',
      '"広い視野と高い視点"': '"広い視野と高い視点を持つ環境"',
      '"繊細さが活きる環境"': '"繊細な感性が活きる環境"',
      '"独立性が保てる環境"': '"独立性を保つことができる環境"',
      '"力が評価される環境"': '"実力が正当に評価される環境"',
      '"成長機会のある環境"': '"成長の機会が豊富な環境"',
      
      // advice/tip
      '"時には信頼して任せよう"': '"時には相手を信頼して任せる"',
      '"家族も個人も大切に"': '"家族も個人もどちらも大切にする"',
      '"自分も大切にしよう"': '"他者だけでなく自分も大切にする"',
      '"質と量のバランスを"': '"質と量のバランスを保つことが大切"',
      '"縁を大切に育てよう"': '"人との縁を大切に育てていく"',
      '"質も考えて集めよう"': '"量だけでなく質も考えて集める"',
      '"着実な成長が最強"': '"着実な成長こそが最強の戦略"',
      '"困難も選んで挑もう"': '"困難を選んで挑戦することも大切"',
      '"時には動くことも"': '"じっとしているだけでなく動くことも"',
      
      // whenBalanced/whenImbalanced
      '"依存的、または孤立"': '"依存的になるか孤立するか極端"',
      '"長期的な成功を実現"': '"長期的な成功を着実に実現する"',
      
      // whatYouNeed
      '"着実な進歩の実感"': '"着実に進歩している実感"',
      '"行動する機会と自由"': '"自由に行動できる機会"',
      '"変化を起こせる環境"': '"変化を起こすことができる環境"',
      '"決断の機会と権限"': '"決断する機会と権限"',
      
      // example
      '"最重要から順に再開"': '"最重要なものから順に再開する"',
      '"泣く、笑う、怒る"': '"泣いたり笑ったり怒ったりする"',
      '"最後の大勝負に出る"': '"最後に大きな勝負に出る"',
      '"寝食を忘れて没頭"': '"寝食を忘れるほど没頭する"',
      '"心を閉ざして防御"': '"心を閉ざして自分を防御する"',
      '"辛くても淡々と継続"': '"辛い時でも淡々と継続する"',
      '"無理せず着実に"': '"無理をせず着実に進める"',
      '"最後まで頑張り抜く"': '"最後まで諦めずに頑張り抜く"',
      '"スポーツ、筋トレ"': '"スポーツや筋トレで体を鍛える"',
      '"大企業、成長企業"': '"大企業や成長企業での活躍"',
      
      // その他
      '"部分より全体を見る"': '"部分だけでなく全体を見る視点"',
      '"適応疲れをリセット"': '"適応疲れを完全にリセットする"',
      '"視野を広げ続ける"': '"常に視野を広げ続ける努力"',
      '"決断力を研ぎ澄ます"': '"決断力を研ぎ澄ませ続ける"',
      '"無駄な対立を避ける"': '"無駄な対立を賢く避ける"',
      '"対立を避ける柔軟性"': '"対立を避ける柔軟な対応力"'
    };
    
    // バックアップ作成
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase6.${timestamp}.js`, content);
    console.log(`📁 バックアップ作成: hexagram-human-traits-v3.backup.phase6.${timestamp}.js\n`);
    
    // 修正適用
    let totalFixCount = 0;
    
    // 各文字数の修正を適用
    const applyFixes = (fixes, charCount) => {
      console.log(`【${charCount}文字の修正】`);
      let count = 0;
      Object.entries(fixes).forEach(([old, newText]) => {
        const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
        const originalContent = content;
        content = content.replace(regex, newText);
        if (originalContent !== content) {
          count++;
          if (count <= 10) { // 最初の10件だけ表示
            console.log(`✅ ${old} → ${newText}`);
          }
        }
      });
      if (count > 10) {
        console.log(`... 他 ${count - 10}件`);
      }
      console.log(`小計: ${count}件\n`);
      return count;
    };
    
    totalFixCount += applyFixes(sevenCharFixes, 7);
    totalFixCount += applyFixes(eightCharFixes, 8);
    totalFixCount += applyFixes(nineCharFixes, 9);
    
    // ファイル保存
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`=== フェーズ6完了 ===`);
    console.log(`総修正件数: ${totalFixCount}件`);
    console.log(`\n最終確認: node comprehensive-v3-review.mjs`);
    
  } catch (error) {
    console.error('エラー:', error);
  }
}

fixPhase6Remaining();