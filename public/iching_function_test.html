<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Chingæ©Ÿèƒ½å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ¯ HAQEIã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ I Chingçµ±åˆæ©Ÿèƒ½ å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>Phase 1: ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ç¢ºèª</h2>
        <div id="init-results"></div>
        <button onclick="testSystemInit()">ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    </div>
    
    <div class="test-section">
        <h2>Phase 2: JavaScript ã‚¨ãƒ©ãƒ¼ç¢ºèª</h2>
        <div id="error-results"></div>
        <button onclick="testJavaScriptErrors()">JavaScriptã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    </div>
    
    <div class="test-section">
        <h2>Phase 3: I Chingåˆ†ææ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
        <textarea id="situation-input" placeholder="çŠ¶æ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šè»¢è·ã‚’è€ƒãˆã¦ã„ã‚‹ãŒã€ç¾åœ¨ã®ä¼šç¤¾ã‚’è¾ã‚ã‚‹ã¹ãã‹è¿·ã£ã¦ã„ã‚‹ï¼‰">è»¢è·ã‚’è€ƒãˆã¦ã„ã‚‹ãŒã€ç¾åœ¨ã®ä¼šç¤¾ã‚’è¾ã‚ã‚‹ã¹ãã‹è¿·ã£ã¦ã„ã‚‹</textarea>
        <button onclick="testIChingAnalysis()">I Chingåˆ†æãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <div id="analysis-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Phase 4: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª</h2>
        <div id="database-results"></div>
        <button onclick="testDatabaseConnection()">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    </div>
    
    <div class="test-section">
        <h2>Phase 5: åŒ…æ‹¬çš„æ©Ÿèƒ½ç¢ºèª</h2>
        <div id="comprehensive-results"></div>
        <button onclick="runComprehensiveTest()">åŒ…æ‹¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    </div>

    <script>
        let testResults = {
            systemInit: false,
            jsErrors: [],
            ichingAnalysis: false,
            databaseConnection: false,
            overallStatus: 'pending'
        };

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
            element.innerHTML += `<div class="${className}">${new Date().toLocaleTimeString()}: ${message}</div>`;
        }

        function testSystemInit() {
            log('init-results', 'ğŸ”„ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            
            // H384ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
            if (typeof window.H384_DATA !== 'undefined') {
                log('init-results', `âœ… H384_DATAèª­ã¿è¾¼ã¿æˆåŠŸ: ${window.H384_DATA.length}ã‚¨ãƒ³ãƒˆãƒªãƒ¼`, 'success');
                testResults.systemInit = true;
            } else {
                log('init-results', 'âŒ H384_DATAãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            }
            
            // I Chingé–¢é€£ã‚¯ãƒ©ã‚¹ã®ç¢ºèª
            const ichingClasses = [
                'IChingFutureSimulator',
                'IChingSituationAnalyzer', 
                'YaoTransformationSimulator',
                'IChingMetaphorDisplay'
            ];
            
            ichingClasses.forEach(className => {
                if (typeof window[className] !== 'undefined') {
                    log('init-results', `âœ… ${className}ã‚¯ãƒ©ã‚¹åˆ©ç”¨å¯èƒ½`, 'success');
                } else {
                    log('init-results', `âš ï¸ ${className}ã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`, 'warning');
                }
            });
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®ç¢ºèª
            const globalVars = ['hexagrams_master', 'futureThemeMap', 'koudoShishinData'];
            globalVars.forEach(varName => {
                if (typeof window[varName] !== 'undefined') {
                    log('init-results', `âœ… ${varName}åˆ©ç”¨å¯èƒ½`, 'success');
                } else {
                    log('init-results', `âš ï¸ ${varName}ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`, 'warning');
                }
            });
        }

        function testJavaScriptErrors() {
            log('error-results', 'ğŸ”„ JavaScriptã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            
            // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã®ã‚­ãƒ£ãƒ—ãƒãƒ£
            const originalError = console.error;
            let errorCount = 0;
            
            console.error = function(...args) {
                errorCount++;
                const errorMsg = args.join(' ');
                if (errorMsg.includes('await is only valid in async functions')) {
                    log('error-results', `âŒ CRITICAL: ${errorMsg}`, 'error');
                    testResults.jsErrors.push(errorMsg);
                } else {
                    log('error-results', `âš ï¸ Error: ${errorMsg}`, 'warning');
                }
                originalError.apply(console, args);
            };
            
            // åŸºæœ¬çš„ãªå‹•ä½œãƒ†ã‚¹ãƒˆ
            try {
                // ç°¡å˜ãªé–¢æ•°å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
                const testFunction = () => {
                    return "Test successful";
                };
                const result = testFunction();
                log('error-results', `âœ… åŸºæœ¬JavaScriptå‹•ä½œ: ${result}`, 'success');
            } catch (error) {
                log('error-results', `âŒ åŸºæœ¬JavaScriptå‹•ä½œã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                testResults.jsErrors.push(error.message);
            }
            
            setTimeout(() => {
                if (errorCount === 0) {
                    log('error-results', 'âœ… JavaScriptã‚¨ãƒ©ãƒ¼ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ', 'success');
                } else {
                    log('error-results', `âŒ ${errorCount}å€‹ã®ã‚¨ãƒ©ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ`, 'error');
                }
                console.error = originalError;
            }, 2000);
        }

        function testIChingAnalysis() {
            const situation = document.getElementById('situation-input').value;
            log('analysis-results', `ğŸ”„ I Chingåˆ†æãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™: "${situation}"`, 'info');
            
            try {
                // IChingFutureSimulatorã®å‹•ä½œãƒ†ã‚¹ãƒˆ
                if (typeof IChingFutureSimulator !== 'undefined') {
                    const container = document.createElement('div');
                    const simulator = new IChingFutureSimulator(container);
                    log('analysis-results', 'âœ… IChingFutureSimulatoråˆæœŸåŒ–æˆåŠŸ', 'success');
                    
                    // åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
                    if (typeof simulator.init === 'function') {
                        simulator.init().then(() => {
                            log('analysis-results', 'âœ… I Chingã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†', 'success');
                            testResults.ichingAnalysis = true;
                        }).catch(error => {
                            log('analysis-results', `âŒ I Chingã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                        });
                    }
                } else {
                    log('analysis-results', 'âŒ IChingFutureSimulatorã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                }
                
                // çŠ¶æ³åˆ†æã®ãƒ†ã‚¹ãƒˆ
                if (typeof IChingSituationAnalyzer !== 'undefined') {
                    const analyzer = new IChingSituationAnalyzer();
                    log('analysis-results', 'âœ… IChingSituationAnalyzeråˆæœŸåŒ–æˆåŠŸ', 'success');
                } else {
                    log('analysis-results', 'âš ï¸ IChingSituationAnalyzerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'warning');
                }
                
            } catch (error) {
                log('analysis-results', `âŒ I Chingåˆ†æãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                testResults.jsErrors.push(error.message);
            }
        }

        function testDatabaseConnection() {
            log('database-results', 'ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            
            // H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
            if (window.H384_DATA && Array.isArray(window.H384_DATA)) {
                log('database-results', `âœ… H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæˆåŠŸ: ${window.H384_DATA.length}ã‚¨ãƒ³ãƒˆãƒªãƒ¼`, 'success');
                
                // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
                const sampleEntry = window.H384_DATA[0];
                if (sampleEntry && typeof sampleEntry === 'object') {
                    log('database-results', `âœ… ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèª: ${Object.keys(sampleEntry).join(', ')}`, 'success');
                    testResults.databaseConnection = true;
                } else {
                    log('database-results', 'âŒ H384ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã«å•é¡ŒãŒã‚ã‚Šã¾ã™', 'error');
                }
            } else {
                log('database-results', 'âŒ H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
            }
            
            // ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¢ºèª
            const databases = [
                { name: 'hexagrams_master', desc: '64å¦ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿' },
                { name: 'futureThemeMap', desc: 'æœªæ¥ãƒ†ãƒ¼ãƒãƒãƒƒãƒ—' },
                { name: 'koudoShishinData', desc: 'è¡Œå‹•æŒ‡é‡ãƒ‡ãƒ¼ã‚¿' }
            ];
            
            databases.forEach(db => {
                if (window[db.name]) {
                    log('database-results', `âœ… ${db.desc}åˆ©ç”¨å¯èƒ½`, 'success');
                } else {
                    log('database-results', `âš ï¸ ${db.desc}ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`, 'warning');
                }
            });
        }

        function runComprehensiveTest() {
            log('comprehensive-results', 'ğŸ¯ åŒ…æ‹¬çš„æ©Ÿèƒ½ç¢ºèªãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            
            // å…¨ã¦ã®ãƒ†ã‚¹ãƒˆã‚’é †æ¬¡å®Ÿè¡Œ
            testSystemInit();
            setTimeout(() => testJavaScriptErrors(), 1000);
            setTimeout(() => testIChingAnalysis(), 2000);
            setTimeout(() => testDatabaseConnection(), 3000);
            
            setTimeout(() => {
                // ç·åˆè©•ä¾¡
                const passedTests = [
                    testResults.systemInit,
                    testResults.jsErrors.length === 0,
                    testResults.ichingAnalysis,
                    testResults.databaseConnection
                ].filter(test => test).length;
                
                const totalTests = 4;
                const successRate = Math.round((passedTests / totalTests) * 100);
                
                if (successRate >= 80) {
                    testResults.overallStatus = 'success';
                    log('comprehensive-results', `ğŸ‰ ç·åˆãƒ†ã‚¹ãƒˆçµæœ: ${successRate}% (${passedTests}/${totalTests}) - æˆåŠŸ`, 'success');
                    log('comprehensive-results', 'âœ… HAQEIã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼I Chingçµ±åˆæ©Ÿèƒ½ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼', 'success');
                } else if (successRate >= 60) {
                    testResults.overallStatus = 'partial';
                    log('comprehensive-results', `âš ï¸ ç·åˆãƒ†ã‚¹ãƒˆçµæœ: ${successRate}% (${passedTests}/${totalTests}) - éƒ¨åˆ†çš„æˆåŠŸ`, 'warning');
                    log('comprehensive-results', 'âš ï¸ ä¸€éƒ¨ã®æ©Ÿèƒ½ã«å•é¡ŒãŒã‚ã‚Šã¾ã™ãŒã€åŸºæœ¬å‹•ä½œã¯å¯èƒ½ã§ã™', 'warning');
                } else {
                    testResults.overallStatus = 'failure';
                    log('comprehensive-results', `âŒ ç·åˆãƒ†ã‚¹ãƒˆçµæœ: ${successRate}% (${passedTests}/${totalTests}) - ä¿®æ­£ãŒå¿…è¦`, 'error');
                    log('comprehensive-results', 'âŒ ã‚·ã‚¹ãƒ†ãƒ ã«é‡è¦ãªå•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚', 'error');
                }
                
                // ã‚¨ãƒ©ãƒ¼ã‚µãƒãƒªãƒ¼
                if (testResults.jsErrors.length > 0) {
                    log('comprehensive-results', `ğŸ“‹ æ¤œå‡ºã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼æ•°: ${testResults.jsErrors.length}`, 'error');
                    testResults.jsErrors.forEach((error, index) => {
                        log('comprehensive-results', `${index + 1}. ${error}`, 'error');
                    });
                }
                
            }, 5000);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯
        window.addEventListener('load', function() {
            log('init-results', 'ğŸš€ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†ã€‚ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†ã€‚', 'success');
        });
    </script>
</body>
</html>