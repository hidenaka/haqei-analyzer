<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future Simulator Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #0f172a;
            color: #ffffff;
            font-family: "Inter", sans-serif;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #1e293b;
            padding: 2rem;
            border-radius: 12px;
        }
        .test-input {
            width: 100%;
            padding: 1rem;
            margin: 1rem 0;
            background-color: #334155;
            border: 1px solid #475569;
            color: #ffffff;
            border-radius: 8px;
        }
        .test-button {
            background-color: #2563eb;
            color: #ffffff;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
        }
        .test-button:hover {
            background-color: #1d4ed8;
        }
        .result-container {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #334155;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🎯 Future Simulator Integration Test</h1>
        
        <div>
            <h2>📚 System Status</h2>
            <div id="systemStatus">Loading...</div>
        </div>
        
        <div>
            <h2>🔮 Test Analysis</h2>
            <textarea id="testInput" class="test-input" placeholder="悩みや状況を入力してください（10文字以上）" rows="4">将来のキャリアについて悩んでいます。現在の仕事を続けるべきか、新しい挑戦をするべきか迷っています。</textarea>
            <button id="testButton" class="test-button">テスト実行</button>
        </div>
        
        <div class="result-container">
            <h2>📊 Test Results</h2>
            <div id="testResults">テスト実行後にここに結果が表示されます</div>
        </div>
        
        <div id="three-stage-visualizer"></div>
        <div id="eight-scenarios-display"></div>
    </div>

    <!-- Core System Assets -->
    <script src="./assets/H384H64database.js"></script>
    <script src="./js/core/H384DatabaseConnector.js"></script>
    <script src="./js/core/IChingChoiceLogic.js"></script>
    <script src="./js/core/IChingGuidanceEngine.js"></script>
    <script src="./js/components/ThreeStageVisualizer.js"></script>
    <script src="./js/components/EightScenariosDisplay.js"></script>
    <script src="./js/future-simulator-integration.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 Starting Future Simulator Test...');
            
            const statusDiv = document.getElementById('systemStatus');
            const testButton = document.getElementById('testButton');
            const testInput = document.getElementById('testInput');
            const testResults = document.getElementById('testResults');
            
            // System Status Check
            setTimeout(() => {
                const status = [];
                
                if (window.H384_DATA) {
                    status.push('✅ H384_DATA: Loaded (' + Object.keys(window.H384_DATA).length + ' entries)');
                } else {
                    status.push('❌ H384_DATA: Not loaded');
                }
                
                if (window.h384db && window.h384db.isLoaded) {
                    status.push('✅ H384DatabaseConnector: Ready');
                } else {
                    status.push('❌ H384DatabaseConnector: Not ready');
                }
                
                if (window.iChingChoice) {
                    status.push('✅ IChingChoiceLogic: Loaded');
                } else {
                    status.push('❌ IChingChoiceLogic: Not loaded');
                }
                
                if (window.iChingGuidance) {
                    status.push('✅ IChingGuidanceEngine: Loaded');
                } else {
                    status.push('❌ IChingGuidanceEngine: Not loaded');
                }
                
                if (window.futureSimulator && window.futureSimulator.isInitialized) {
                    status.push('✅ FutureSimulatorIntegration: Initialized');
                } else {
                    status.push('❌ FutureSimulatorIntegration: Not initialized');
                }
                
                statusDiv.innerHTML = status.join('<br>');
            }, 2000);
            
            // Test Button Handler
            testButton.addEventListener('click', async function() {
                const inputText = testInput.value.trim();
                
                if (!inputText || inputText.length < 10) {
                    alert('10文字以上の内容を入力してください');
                    return;
                }
                
                testButton.textContent = 'テスト実行中...';
                testButton.disabled = true;
                testResults.innerHTML = 'テスト実行中...';
                
                try {
                    // Check if Future Simulator is available
                    if (!window.futureSimulator) {
                        throw new Error('FutureSimulatorIntegration not available');
                    }
                    
                    // Test IChingChoiceLogic directly
                    if (window.iChingChoice) {
                        const testHexagram = {
                            '卦名': '水雷屯',
                            '爻': '初九',
                            '卦番号': 3,
                            'キーワード': ['協力者', '待機', '準備']
                        };
                        
                        const followChange = window.iChingChoice.calculateChange(testHexagram, true);
                        const rejectChange = window.iChingChoice.calculateChange(testHexagram, false);
                        
                        const testResult = {
                            input: inputText,
                            testHexagram: testHexagram,
                            followChange: followChange,
                            rejectChange: rejectChange,
                            systemStatus: 'IChingChoiceLogic working correctly'
                        };
                        
                        testResults.innerHTML = '<pre>' + JSON.stringify(testResult, null, 2) + '</pre>';
                    } else {
                        testResults.innerHTML = '❌ IChingChoiceLogic not available';
                    }
                    
                } catch (error) {
                    console.error('❌ Test failed:', error);
                    testResults.innerHTML = '❌ Test failed: ' + error.message;
                } finally {
                    testButton.textContent = 'テスト実行';
                    testButton.disabled = false;
                }
            });
        });
    </script>
</body>
</html>