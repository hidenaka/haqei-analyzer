<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI Virtual Personality Phase 1 Test (Standalone)</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #ffffff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #4fc3f7;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4fc3f7;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: transform 0.2s;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
        }
        
        .result-area {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid #333;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            color: #4caf50;
        }
        
        .error {
            color: #f44336;
        }
        
        .info {
            color: #2196f3;
        }
        
        .warning {
            color: #ff9800;
        }
        
        .os-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid;
        }
        
        .engine-os {
            border-left-color: #e74c3c;
        }
        
        .interface-os {
            border-left-color: #3498db;
        }
        
        .safemode-os {
            border-left-color: #f39c12;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎭 HAQEI Virtual Personality System Phase 1 Test (Standalone)</h1>
        
        <div class="test-section" style="border-left-color: #4caf50;">
            <h3>🌐 スタンドアローン版テスト</h3>
            <p><strong>説明:</strong> JavaScriptファイル埋め込み版でMIMEタイプ問題を回避</p>
            <p><strong>推奨:</strong> 「Run Simple Test」をクリックして基本動作を確認</p>
        </div>
        
        <div class="test-section">
            <h3>🧪 基本動作テスト</h3>
            <button class="test-button" onclick="runSimpleTest()">Run Simple Test</button>
            <button class="test-button" onclick="runBasicPersonalityTest()">Test Basic Personality Creation</button>
            <div id="simple-test-result" class="result-area"></div>
        </div>
        
        <div class="test-section">
            <h3>📊 クラス可用性確認</h3>
            <button class="test-button" onclick="checkClassAvailability()">Check Class Availability</button>
            <div id="class-check-result" class="result-area"></div>
        </div>
    </div>

    <script>
        // Simplified PersonalityOS for testing
        class PersonalityOS {
            constructor(osType, userAnswers) {
                this.osType = osType;
                this.osName = this.getOSDisplayName(osType);
                this.hexagramId = this.getDefaultHexagram(osType);
                this.hexagramName = `第${this.hexagramId}卦`;
                this.activation = Math.random() * 0.8 + 0.2; // 0.2-1.0
                
                this.characteristics = {
                    primary_traits: this.generateTraits(osType)
                };
                
                this.personality = {
                    voice: this.generateVoice(osType),
                    priorities: this.generatePriorities(osType),
                    strengths: this.generateStrengths(osType)
                };
                
                console.log(`🧠 PersonalityOS [${this.osType}] initialized`);
            }
            
            getOSDisplayName(osType) {
                const osNames = {
                    'engine': 'Engine OS (価値観OS)',
                    'interface': 'Interface OS (社会的OS)', 
                    'safemode': 'SafeMode OS (防御OS)'
                };
                return osNames[osType] || `Unknown OS (${osType})`;
            }
            
            getDefaultHexagram(osType) {
                const defaultHexagrams = {
                    'engine': 1,
                    'interface': 19,
                    'safemode': 52
                };
                return defaultHexagrams[osType] || 1;
            }
            
            generateTraits(osType) {
                const traits = {
                    'engine': ['創造的', '理想主義的', '独立志向'],
                    'interface': ['協調的', '思いやり深い', '適応力がある'],
                    'safemode': ['慎重', '安定志向', '分析的']
                };
                return traits[osType] || ['標準的'];
            }
            
            generateVoice(osType) {
                const voices = {
                    'engine': '情熱的で理想主義的な語り口',
                    'interface': '温かく配慮深い話し方',
                    'safemode': '慎重で分析的な表現'
                };
                return voices[osType] || '標準的な表現';
            }
            
            generatePriorities(osType) {
                const priorities = {
                    'engine': ['真実の追求', '創造的表現', '理想の実現'],
                    'interface': ['人間関係の維持', '調和の創造', '他者への貢献'],
                    'safemode': ['安全の確保', 'リスクの回避', '安定の維持']
                };
                return priorities[osType] || ['基本的な目標'];
            }
            
            generateStrengths(osType) {
                const strengths = {
                    'engine': ['創造力', '情熱', '信念の強さ'],
                    'interface': ['共感力', '協調性', '思いやり'],
                    'safemode': ['慎重さ', '分析力', '危機管理能力']
                };
                return strengths[osType] || ['基本的な能力'];
            }
            
            makeDecision(context) {
                return {
                    osType: this.osType,
                    reasoning: `${this.osType}の観点から「${context}」について判断しました`,
                    confidence: Math.random() * 0.5 + 0.5,
                    alternatives: [`${this.osType}的な代替案1`, `${this.osType}的な代替案2`],
                    concerns: [`${this.osType}的な懸念1`, `${this.osType}的な懸念2`]
                };
            }
            
            expressOpinion(topic) {
                return {
                    osType: this.osType,
                    stance: `${this.osType}として「${topic}」について考えます`,
                    reasoning: `${this.osType}の特性に基づく判断`,
                    emotion: 'neutral',
                    confidence: Math.random() * 0.5 + 0.5
                };
            }
        }

        // Simplified VirtualPersonality for testing
        class VirtualPersonality {
            constructor(userAnswers) {
                this.id = `personality_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                this.createdAt = new Date();
                
                this.engineOS = new PersonalityOS('engine', userAnswers);
                this.interfaceOS = new PersonalityOS('interface', userAnswers);
                this.safeModeOS = new PersonalityOS('safemode', userAnswers);
                
                this.personalityState = {
                    currentDominantOS: this.calculateDominantOS(),
                    osBalance: {
                        engine: this.engineOS.activation / 3,
                        interface: this.interfaceOS.activation / 3,
                        safemode: this.safeModeOS.activation / 3
                    },
                    overallCoherence: Math.random() * 0.5 + 0.5,
                    internalHarmony: Math.random() * 0.5 + 0.5,
                    adaptabilityIndex: Math.random() * 0.5 + 0.5
                };
                
                this.personalityMetadata = {
                    personalityType: this.generatePersonalityType(),
                    tags: this.generateTags()
                };
                
                console.log('🎭 VirtualPersonality created successfully');
            }
            
            calculateDominantOS() {
                const activations = {
                    engine: this.engineOS.activation,
                    interface: this.interfaceOS.activation,
                    safemode: this.safeModeOS.activation
                };
                
                return Object.keys(activations).reduce((a, b) => 
                    activations[a] > activations[b] ? a : b);
            }
            
            generatePersonalityType() {
                const types = [
                    '創造的思考型', '調和重視型', '安定志向型',
                    'バランス型', '直感型', '分析型'
                ];
                return types[Math.floor(Math.random() * types.length)];
            }
            
            generateTags() {
                const allTags = [
                    '創造的', '協調的', '慎重', '情熱的', '思いやり深い',
                    '分析的', '理想主義', '現実的', '柔軟', '安定志向'
                ];
                return allTags.slice(0, 3 + Math.floor(Math.random() * 3));
            }
            
            simulateInternalDialogue(scenario) {
                const engineDecision = this.engineOS.makeDecision(scenario);
                const interfaceDecision = this.interfaceOS.makeDecision(scenario);
                const safeModeDecision = this.safeModeOS.makeDecision(scenario);
                
                return {
                    scenario: scenario,
                    exchanges: [
                        {
                            speaker: 'Engine OS',
                            type: 'proposal',
                            content: engineDecision.reasoning
                        },
                        {
                            speaker: 'Interface OS',
                            type: 'consideration',
                            content: interfaceDecision.reasoning
                        },
                        {
                            speaker: 'SafeMode OS',
                            type: 'caution',
                            content: safeModeDecision.reasoning
                        }
                    ],
                    consensusLevel: Math.random() * 0.5 + 0.5,
                    outcome: 'バランスの取れた判断'
                };
            }
            
            predictBehavior(situation) {
                return {
                    situation: situation,
                    osDecisions: {
                        engine: this.engineOS.makeDecision(situation),
                        interface: this.interfaceOS.makeDecision(situation),
                        safemode: this.safeModeOS.makeDecision(situation)
                    },
                    integratedPrediction: `${situation}に対して${this.personalityState.currentDominantOS}的にアプローチ`,
                    confidence: Math.random() * 0.5 + 0.5
                };
            }
            
            generatePersonalityNarrative() {
                return {
                    introduction: `あなたは${this.personalityMetadata.personalityType}として、3つのOS人格のバランスを持っています。`,
                    osPersonalities: {
                        engineOS: {
                            name: this.engineOS.osName,
                            hexagram: this.engineOS.hexagramName,
                            description: '創造性と理想を追求する人格',
                            voice: this.engineOS.personality.voice,
                            strengths: this.engineOS.personality.strengths
                        },
                        interfaceOS: {
                            name: this.interfaceOS.osName,
                            hexagram: this.interfaceOS.hexagramName,
                            description: '社会的調和を重視する人格',
                            voice: this.interfaceOS.personality.voice,
                            strengths: this.interfaceOS.personality.strengths
                        },
                        safeModeOS: {
                            name: this.safeModeOS.osName,
                            hexagram: this.safeModeOS.hexagramName,
                            description: '安全と安定を確保する人格',
                            voice: this.safeModeOS.personality.voice,
                            strengths: this.safeModeOS.personality.strengths
                        }
                    }
                };
            }
            
            getFullState() {
                return {
                    personalityState: this.personalityState,
                    personalityMetadata: this.personalityMetadata,
                    osStates: {
                        engineOS: this.engineOS,
                        interfaceOS: this.interfaceOS,
                        safeModeOS: this.safeModeOS
                    }
                };
            }
        }

        // Test functions
        let testUserAnswers = [];
        let testVirtualPersonality = null;

        function runSimpleTest() {
            const result = document.getElementById('simple-test-result');
            
            try {
                result.innerHTML = '<div class="info">🔧 Running simple test...</div>';
                
                // Generate test data
                testUserAnswers = [
                    {
                        question: "あなたの価値観について最も重要なのは？",
                        selectedOption: "理想を追求し、創造的な表現をすること",
                        intensity: 0.8,
                        category: "engine"
                    },
                    {
                        question: "人間関係で最も大切にしていることは？",
                        selectedOption: "調和を保ち、皆が幸せになること",
                        intensity: 0.7,
                        category: "interface"
                    },
                    {
                        question: "困難な状況に直面した時、あなたは？",
                        selectedOption: "慎重にリスクを評価し、安全な選択をする",
                        intensity: 0.9,
                        category: "safemode"
                    }
                ];
                
                // Test PersonalityOS creation
                const engineOS = new PersonalityOS('engine', testUserAnswers);
                const interfaceOS = new PersonalityOS('interface', testUserAnswers);
                const safeModeOS = new PersonalityOS('safemode', testUserAnswers);
                
                // Test VirtualPersonality creation
                testVirtualPersonality = new VirtualPersonality(testUserAnswers);
                
                let html = '<div class="success">✅ Simple test completed successfully!</div>';
                html += '<div class="info">📊 Test Results:</div>';
                html += `<p>• Engine OS: ${engineOS.osName} (活性度: ${engineOS.activation.toFixed(3)})</p>`;
                html += `<p>• Interface OS: ${interfaceOS.osName} (活性度: ${interfaceOS.activation.toFixed(3)})</p>`;
                html += `<p>• SafeMode OS: ${safeModeOS.osName} (活性度: ${safeModeOS.activation.toFixed(3)})</p>`;
                html += `<p>• Virtual Personality ID: ${testVirtualPersonality.id}</p>`;
                html += `<p>• Personality Type: ${testVirtualPersonality.personalityMetadata.personalityType}</p>`;
                html += `<p>• Dominant OS: ${testVirtualPersonality.personalityState.currentDominantOS}</p>`;
                
                result.innerHTML = html;
                
            } catch (error) {
                result.innerHTML = `<div class="error">❌ Test failed: ${error.message}</div>`;
                console.error('Simple test error:', error);
            }
        }

        function runBasicPersonalityTest() {
            const result = document.getElementById('simple-test-result');
            
            if (!testVirtualPersonality) {
                result.innerHTML = '<div class="warning">⚠️ Run Simple Test first to create personality!</div>';
                return;
            }
            
            try {
                const scenario = "新しい職場でのプロジェクトリーダー就任の提案";
                const dialogue = testVirtualPersonality.simulateInternalDialogue(scenario);
                const prediction = testVirtualPersonality.predictBehavior(scenario);
                
                let html = '<div class="success">✅ Basic personality test completed!</div>';
                html += `<div class="info">🗨️ Internal Dialogue Scenario: "${scenario}"</div>`;
                html += `<p><strong>Consensus Level:</strong> ${(dialogue.consensusLevel * 100).toFixed(1)}%</p>`;
                html += `<p><strong>Final Outcome:</strong> ${dialogue.outcome}</p>`;
                html += `<p><strong>Behavior Prediction:</strong> ${prediction.integratedPrediction}</p>`;
                html += `<p><strong>Prediction Confidence:</strong> ${(prediction.confidence * 100).toFixed(1)}%</p>`;
                
                result.innerHTML = html;
                
            } catch (error) {
                result.innerHTML = `<div class="error">❌ Personality test failed: ${error.message}</div>`;
                console.error('Personality test error:', error);
            }
        }

        function checkClassAvailability() {
            const result = document.getElementById('class-check-result');
            
            let html = '<div class="info">🔍 Class Availability Check:</div>';
            html += `<p>• PersonalityOS: ${typeof PersonalityOS !== 'undefined' ? '✅ Available' : '❌ Not Available'}</p>`;
            html += `<p>• VirtualPersonality: ${typeof VirtualPersonality !== 'undefined' ? '✅ Available' : '❌ Not Available'}</p>`;
            
            if (typeof PersonalityOS !== 'undefined' && typeof VirtualPersonality !== 'undefined') {
                html += '<div class="success">🎉 All classes are available and ready for testing!</div>';
            } else {
                html += '<div class="error">⚠️ Some classes are missing. Check console for errors.</div>';
            }
            
            result.innerHTML = html;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎭 Virtual Personality Phase 1 Test Page (Standalone) Loaded');
            checkClassAvailability();
        });
    </script>
</body>
</html>