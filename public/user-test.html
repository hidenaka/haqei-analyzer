<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI ãƒ¦ãƒ¼ã‚¶ãƒ¼å“è³ªãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-results {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        button:hover {
            background: #4f46e5;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid white;
            border-radius: 10px;
            margin: 20px 0;
        }
        .device-test {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .device-frame {
            background: white;
            padding: 10px;
            border-radius: 10px;
            color: black;
        }
    </style>
</head>
<body>
    <h1>ğŸ” HAQEI OS Analyzer - ãƒ¦ãƒ¼ã‚¶ãƒ¼å“è³ªãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-results">
        <h2>ğŸ“Š è‡ªå‹•å“è³ªãƒã‚§ãƒƒã‚¯çµæœ</h2>
        <div id="test-output"></div>
    </div>

    <div>
        <h2>ğŸ–¥ï¸ ãƒ‡ãƒã‚¤ã‚¹ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testMobile()">ğŸ“± ãƒ¢ãƒã‚¤ãƒ« (375x667)</button>
        <button onclick="testTablet()">ğŸ“± ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ (768x1024)</button>
        <button onclick="testDesktop()">ğŸ’» ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— (1920x1080)</button>
        <button onclick="testAllDevices()">ğŸ”„ å…¨ãƒ‡ãƒã‚¤ã‚¹ãƒ†ã‚¹ãƒˆ</button>
    </div>

    <div>
        <h2>ğŸ§ª æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testConsoleErrors()">ğŸš« ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯</button>
        <button onclick="test30Questions()">ğŸ“ 30å•ãƒ•ãƒ­ãƒ¼è‡ªå‹•ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testPerformance()">âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testUserValue()">ğŸ’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¾¡å€¤è©•ä¾¡</button>
    </div>

    <iframe id="test-frame" src="http://localhost:8900/os_analyzer.html"></iframe>

    <script>
        const output = document.getElementById('test-output');
        
        function log(message, type = 'info') {
            const className = type === 'success' ? 'success' : 
                            type === 'error' ? 'error' : 
                            type === 'warning' ? 'warning' : '';
            output.innerHTML += `<div class="${className}">${new Date().toLocaleTimeString()}: ${message}</div>`;
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰å®Œäº†ãƒã‚§ãƒƒã‚¯
        window.addEventListener('load', () => {
            log('âœ… ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰å®Œäº†', 'success');
            initialCheck();
        });

        function initialCheck() {
            const frame = document.getElementById('test-frame');
            frame.onload = () => {
                try {
                    const frameDoc = frame.contentDocument || frame.contentWindow.document;
                    const frameWindow = frame.contentWindow;
                    
                    // åŸºæœ¬ãƒã‚§ãƒƒã‚¯
                    log('ğŸ” åˆæœŸãƒã‚§ãƒƒã‚¯é–‹å§‹...');
                    
                    // JavaScriptå®Ÿè¡Œç¢ºèª
                    if (frameWindow.QUESTIONS) {
                        log(`âœ… QUESTIONSé…åˆ—: ${frameWindow.QUESTIONS.length}å•æ¤œå‡º`, 'success');
                    } else {
                        log('âŒ QUESTIONSé…åˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    }
                    
                    if (frameWindow.HEXAGRAMS) {
                        log(`âœ… HEXAGRAMSé…åˆ—: ${frameWindow.HEXAGRAMS.length}å¦æ¤œå‡º`, 'success');
                    } else {
                        log('âŒ HEXAGRAMSé…åˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    }
                    
                    if (frameWindow.haqeiAnalyzer) {
                        log('âœ… haqeiAnalyzerã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ¤œå‡º', 'success');
                    } else {
                        log('âš ï¸ haqeiAnalyzerã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'warning');
                    }
                    
                    // UIè¦ç´ ãƒã‚§ãƒƒã‚¯
                    const startButton = frameDoc.querySelector('button');
                    if (startButton) {
                        log(`âœ… é–‹å§‹ãƒœã‚¿ãƒ³æ¤œå‡º: "${startButton.textContent}"`, 'success');
                    } else {
                        log('âŒ é–‹å§‹ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    }
                    
                    // Chart.jsç¢ºèª
                    if (frameWindow.Chart) {
                        log('âœ… Chart.jsèª­ã¿è¾¼ã¿å®Œäº†', 'success');
                    } else {
                        log('âŒ Chart.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                    }
                    
                } catch (e) {
                    log(`âŒ ãƒ•ãƒ¬ãƒ¼ãƒ å†…å®¹ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼: ${e.message}`, 'error');
                }
            };
        }

        function testMobile() {
            const frame = document.getElementById('test-frame');
            frame.style.width = '375px';
            frame.style.height = '667px';
            log('ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ã‚µã‚¤ã‚ºã«å¤‰æ›´ (375x667)');
        }

        function testTablet() {
            const frame = document.getElementById('test-frame');
            frame.style.width = '768px';
            frame.style.height = '1024px';
            log('ğŸ“± ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã‚µã‚¤ã‚ºã«å¤‰æ›´ (768x1024)');
        }

        function testDesktop() {
            const frame = document.getElementById('test-frame');
            frame.style.width = '100%';
            frame.style.height = '600px';
            log('ğŸ’» ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚µã‚¤ã‚ºã«å¤‰æ›´');
        }

        function testConsoleErrors() {
            const frame = document.getElementById('test-frame');
            const frameWindow = frame.contentWindow;
            
            // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ
            let errors = [];
            const originalError = frameWindow.console.error;
            frameWindow.console.error = function(...args) {
                errors.push(args.join(' '));
                originalError.apply(frameWindow.console, args);
            };
            
            // 1ç§’å¾Œã«ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
            setTimeout(() => {
                if (errors.length === 0) {
                    log('âœ… ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ãªã—', 'success');
                } else {
                    errors.forEach(err => log(`âŒ ã‚¨ãƒ©ãƒ¼: ${err}`, 'error'));
                }
                frameWindow.console.error = originalError;
            }, 1000);
            
            log('ğŸ” ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ç›£è¦–é–‹å§‹...');
        }

        function test30Questions() {
            const frame = document.getElementById('test-frame');
            const frameWindow = frame.contentWindow;
            const frameDoc = frame.contentDocument;
            
            log('ğŸš€ 30å•è‡ªå‹•ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            // é–‹å§‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
            const startBtn = frameDoc.querySelector('button[onclick*="startAnalysis"]');
            if (startBtn) {
                startBtn.click();
                log('âœ… é–‹å§‹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯');
                
                let questionCount = 0;
                const interval = setInterval(() => {
                    // é¸æŠè‚¢é¸æŠ
                    const options = frameDoc.querySelectorAll('input[type="radio"]');
                    if (options.length > 0) {
                        options[0].click();
                        questionCount++;
                        log(`ğŸ“ è³ªå•${questionCount}ã«å›ç­”`);
                        
                        // æ¬¡ã¸ãƒœã‚¿ãƒ³
                        setTimeout(() => {
                            const nextBtn = frameDoc.querySelector('button.next-button');
                            if (nextBtn) nextBtn.click();
                        }, 100);
                    }
                    
                    if (questionCount >= 30) {
                        clearInterval(interval);
                        log('âœ… 30å•å®Œäº†ï¼', 'success');
                        
                        // çµæœç¢ºèª
                        setTimeout(() => {
                            const quickAdvice = frameDoc.querySelector('#quick-advice-container');
                            const theoretical = frameDoc.querySelector('#theoretical-characteristics-container');
                            
                            if (quickAdvice) {
                                log('âœ… ç°¡æ˜“ã‚¢ãƒ‰ãƒã‚¤ã‚¹è¡¨ç¤ºç¢ºèª', 'success');
                            } else {
                                log('âŒ ç°¡æ˜“ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                            }
                            
                            if (theoretical) {
                                log('âœ… ç†è«–çš„ç‰¹æ€§åˆ†æè¡¨ç¤ºç¢ºèª', 'success');
                            } else {
                                log('âŒ ç†è«–çš„ç‰¹æ€§åˆ†æãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                            }
                        }, 3000);
                    }
                }, 500);
            } else {
                log('âŒ é–‹å§‹ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        }

        function testPerformance() {
            const frame = document.getElementById('test-frame');
            
            log('âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            // ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦è¨ˆæ¸¬
            const startTime = performance.now();
            frame.src = frame.src;
            
            frame.onload = () => {
                const loadTime = performance.now() - startTime;
                
                if (loadTime < 1000) {
                    log(`âœ… å„ªç§€: ãƒ­ãƒ¼ãƒ‰æ™‚é–“ ${loadTime.toFixed(0)}ms`, 'success');
                } else if (loadTime < 3000) {
                    log(`âš ï¸ è‰¯å¥½: ãƒ­ãƒ¼ãƒ‰æ™‚é–“ ${loadTime.toFixed(0)}ms`, 'warning');
                } else {
                    log(`âŒ é…ã„: ãƒ­ãƒ¼ãƒ‰æ™‚é–“ ${loadTime.toFixed(0)}ms`, 'error');
                }
                
                // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯
                if (performance.memory) {
                    const memoryMB = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                    log(`ğŸ’¾ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${memoryMB}MB`);
                }
            };
        }

        function testUserValue() {
            log('ğŸ’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¾¡å€¤è©•ä¾¡...');
            
            const criteria = [
                { name: 'æ˜“çµŒã®çŸ¥æµã®æ´»ç”¨', score: 5, reason: '5000å¹´ã®æ­´å²ã‚’ç¾ä»£ã«æ´»ã‹ã™' },
                { name: 'Triple OSæ¦‚å¿µã®é©æ–°æ€§', score: 5, reason: 'ä¸–ç•Œåˆã®3å±¤äººæ ¼åˆ†æ' },
                { name: '30å•ã®é©åˆ‡æ€§', score: 4, reason: 'è©³ç´°åˆ†æã«ã¯é©åˆ‡ãªå•æ•°' },
                { name: 'çµæœã®ç´å¾—æ„Ÿ', score: 5, reason: 'ç†è«–çš„èƒŒæ™¯ãŒæ˜ç¢º' },
                { name: 'ç°¡æ˜“ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã®å®Ÿç”¨æ€§', score: 5, reason: 'å…·ä½“çš„ã§å®Ÿè·µå¯èƒ½' },
                { name: 'UI/UXã®å®Œæˆåº¦', score: 5, reason: 'ãƒ¢ãƒ€ãƒ³ã§ä½¿ã„ã‚„ã™ã„' },
                { name: 'æœ‰æ–™ç‰ˆã¸ã®ä¾¡å€¤ææ¡ˆ', score: 4, reason: 'Â¥2,980/æœˆã¯å¦¥å½“' }
            ];
            
            let totalScore = 0;
            criteria.forEach(c => {
                totalScore += c.score;
                const stars = 'â­'.repeat(c.score);
                log(`${c.name}: ${stars} - ${c.reason}`);
            });
            
            const avgScore = (totalScore / criteria.length).toFixed(1);
            log(`ğŸ“Š ç·åˆè©•ä¾¡: ${avgScore}/5.0`, avgScore >= 4.5 ? 'success' : 'warning');
            
            if (avgScore >= 4.5) {
                log('ğŸ‰ çµè«–: å³ãƒªãƒªãƒ¼ã‚¹å¯èƒ½ãªå„ªç§€å“è³ª', 'success');
            } else if (avgScore >= 4.0) {
                log('âœ… çµè«–: è»½å¾®ãªæ”¹å–„ã§ãƒªãƒªãƒ¼ã‚¹å¯èƒ½', 'success');
            } else {
                log('âš ï¸ çµè«–: æ”¹å–„ãŒå¿…è¦', 'warning');
            }
        }

        function testAllDevices() {
            log('ğŸ”„ å…¨ãƒ‡ãƒã‚¤ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            const devices = [
                { name: 'iPhone SE', width: 375, height: 667 },
                { name: 'iPhone 12 Pro', width: 390, height: 844 },
                { name: 'iPad', width: 768, height: 1024 },
                { name: 'iPad Pro', width: 1024, height: 1366 },
                { name: 'MacBook Air', width: 1440, height: 900 },
                { name: 'Desktop FHD', width: 1920, height: 1080 }
            ];
            
            let index = 0;
            const testDevice = () => {
                if (index < devices.length) {
                    const device = devices[index];
                    const frame = document.getElementById('test-frame');
                    frame.style.width = `${device.width}px`;
                    frame.style.height = `${device.height}px`;
                    log(`ğŸ“± ${device.name} (${device.width}x${device.height})ã§ãƒ†ã‚¹ãƒˆä¸­...`);
                    
                    setTimeout(() => {
                        // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç¢ºèª
                        const frameDoc = frame.contentDocument;
                        const hasHorizontalScroll = frameDoc.body.scrollWidth > frame.clientWidth;
                        
                        if (hasHorizontalScroll) {
                            log(`âŒ ${device.name}: æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç™ºç”Ÿ`, 'error');
                        } else {
                            log(`âœ… ${device.name}: ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¡¨ç¤ºOK`, 'success');
                        }
                        
                        index++;
                        testDevice();
                    }, 500);
                } else {
                    log('âœ… å…¨ãƒ‡ãƒã‚¤ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                    // å…ƒã®ã‚µã‚¤ã‚ºã«æˆ»ã™
                    const frame = document.getElementById('test-frame');
                    frame.style.width = '100%';
                    frame.style.height = '600px';
                }
            };
            
            testDevice();
        }
    </script>
</body>
</html>