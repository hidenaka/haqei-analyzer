<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HaQei Analyzer Debug Test - 8æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«è¨ˆç®—ãƒ†ã‚¹ãƒˆ</title>
    <style>
      body {
        font-family: "Courier New", monospace;
        background: #1a1a1a;
        color: #00ff00;
        margin: 0;
        padding: 20px;
        line-height: 1.6;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: #0d1117;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.1);
      }
      h1,
      h2 {
        color: #58a6ff;
        text-align: center;
      }
      .section {
        margin: 20px 0;
        padding: 15px;
        background: #161b22;
        border-radius: 8px;
        border-left: 4px solid #58a6ff;
      }
      .test-button {
        background: #238636;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
        font-size: 14px;
      }
      .test-button:hover {
        background: #2ea043;
      }
      .error {
        color: #ff6b6b;
        background: #341a1a;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .success {
        color: #51cf66;
        background: #1a341a;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .info {
        color: #74c0fc;
        background: #1a1a34;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .vector-display {
        font-family: monospace;
        background: #0d1117;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        border: 1px solid #30363d;
      }
      .dimension-score {
        display: inline-block;
        width: 80px;
        margin: 2px;
        padding: 3px;
        background: #21262d;
        text-align: center;
        border-radius: 3px;
      }
      .log-output {
        background: #000;
        color: #00ff00;
        padding: 15px;
        border-radius: 5px;
        max-height: 400px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ”¬ HaQei Analyzer Debug Test</h1>
      <p style="text-align: center; color: #8b949e">
        8æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸
      </p>

      <div class="section">
        <h2>ğŸ¯ åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testDataLoading()">
          ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ ãƒ†ã‚¹ãƒˆ
        </button>
        <button class="test-button" onclick="testVectorCalculation()">
          ãƒ™ã‚¯ãƒˆãƒ«è¨ˆç®— ãƒ†ã‚¹ãƒˆ
        </button>
        <button class="test-button" onclick="testHexagramMatching()">
          64å¦ãƒãƒƒãƒãƒ³ã‚° ãƒ†ã‚¹ãƒˆ
        </button>
        <button class="test-button" onclick="testFullAnalysis()">
          ãƒ•ãƒ«åˆ†æ ãƒ†ã‚¹ãƒˆ
        </button>
        <button class="test-button" onclick="testTripleOSAnalysis()">
          TripleOSåˆ†æ ãƒ†ã‚¹ãƒˆ
        </button>
        <button class="test-button" onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
      </div>

      <div class="section">
        <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ</h2>
        <div id="test-results"></div>
      </div>

      <div class="section">
        <h2>ğŸ–¥ï¸ ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h2>
        <div id="debug-log" class="log-output"></div>
      </div>

      <div class="section">
        <h2>ğŸ” è¨ˆç®—è©³ç´°</h2>
        <div id="calculation-details"></div>
      </div>
    </div>

    <!-- ä¾å­˜é–¢ä¿‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script src="new-analyzer/js/data/questions.js"></script>
    <script src="new-analyzer/js/data/vectors.js"></script>
    <script src="new-analyzer/js/data/hexagrams.js"></script>
    <script src="new-analyzer/js/core/BaseComponent.js"></script>
    <script src="new-analyzer/js/core/StorageManager.js"></script>
    <script src="new-analyzer/js/core/DataManager.js"></script>
    <script src="new-analyzer/js/core/Calculator.js"></script>
    <script src="new-analyzer/js/core/Engine.js"></script>
    <script src="new-analyzer/js/core/TripleOSEngine.js"></script>

    <script>
      // ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ­ã‚°å‡ºåŠ›
      function debugLog(message, type = "info") {
        const logElement = document.getElementById("debug-log");
        const timestamp = new Date().toLocaleTimeString();
        const colorClass =
          type === "error" ? "error" : type === "success" ? "success" : "info";

        const logEntry = document.createElement("div");
        logEntry.className = colorClass;
        logEntry.innerHTML = `[${timestamp}] ${message}`;

        logElement.appendChild(logEntry);
        logElement.scrollTop = logElement.scrollHeight;

        // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚å‡ºåŠ›
        console.log(`[DEBUG] ${message}`);
      }

      function clearLog() {
        document.getElementById("debug-log").innerHTML = "";
        document.getElementById("test-results").innerHTML = "";
        document.getElementById("calculation-details").innerHTML = "";
      }

      function showResult(title, content, type = "info") {
        const resultsElement = document.getElementById("test-results");
        const resultDiv = document.createElement("div");
        resultDiv.className = type;
        resultDiv.innerHTML = `<strong>${title}</strong><br>${content}`;
        resultsElement.appendChild(resultDiv);
      }

      // ãƒ†ã‚¹ãƒˆç”¨ã®ã‚µãƒ³ãƒ—ãƒ«å›ç­”ãƒ‡ãƒ¼ã‚¿ï¼ˆä¾¡å€¤è¦³è¨­å•ï¼‰
      const sampleAnswers = [
        {
          questionId: "q1",
          selectedValue: "A",
          scoring_tags: [
            { key: "ä¹¾_å‰µé€ æ€§", value: 3.0 },
            { key: "é›¢_è¡¨ç¾æ€§", value: 1.5 },
            { key: "è‰®_å®‰å®šæ€§", value: -1.0 },
          ],
        },
        {
          questionId: "q2",
          selectedValue: "B",
          scoring_tags: [
            { key: "å_æ¢æ±‚æ€§", value: 2.5 },
            { key: "è‰®_å®‰å®šæ€§", value: 2.0 },
            { key: "éœ‡_è¡Œå‹•æ€§", value: -1.0 },
          ],
        },
        {
          questionId: "q3",
          selectedValue: "A",
          scoring_tags: [
            { key: "ä¹¾_å‰µé€ æ€§", value: 3.0 },
            { key: "é›¢_è¡¨ç¾æ€§", value: 1.5 },
            { key: "å¤_å—å®¹æ€§", value: -1.0 },
          ],
        },
      ];

      // TripleOSãƒ†ã‚¹ãƒˆç”¨ã®ã‚µãƒ³ãƒ—ãƒ«å›ç­”ãƒ‡ãƒ¼ã‚¿ï¼ˆä¾¡å€¤è¦³+ã‚·ãƒŠãƒªã‚ªè¨­å•ï¼‰
      const tripleOSSampleAnswers = [
        // ä¾¡å€¤è¦³è¨­å•ï¼ˆQ1-Q3ï¼‰
        {
          questionId: "q1",
          selectedValue: "A",
          scoring_tags: [
            { key: "ä¹¾_å‰µé€ æ€§", value: 3.0 },
            { key: "é›¢_è¡¨ç¾æ€§", value: 1.5 },
            { key: "è‰®_å®‰å®šæ€§", value: -1.0 },
          ],
        },
        {
          questionId: "q2",
          selectedValue: "B",
          scoring_tags: [
            { key: "å_æ¢æ±‚æ€§", value: 2.5 },
            { key: "è‰®_å®‰å®šæ€§", value: 2.0 },
            { key: "éœ‡_è¡Œå‹•æ€§", value: -1.0 },
          ],
        },
        {
          questionId: "q3",
          selectedValue: "A",
          scoring_tags: [
            { key: "ä¹¾_å‰µé€ æ€§", value: 3.0 },
            { key: "é›¢_è¡¨ç¾æ€§", value: 1.5 },
            { key: "å¤_å—å®¹æ€§", value: -1.0 },
          ],
        },
        // ã‚·ãƒŠãƒªã‚ªè¨­å•ï¼ˆQ25-Q26ï¼‰
        {
          questionId: "q25",
          innerChoice: {
            value: "A",
            scoring_tags: [
              { key: "ä¹¾_å‰µé€ æ€§", value: 1.5 },
              { key: "è‰®_å®‰å®šæ€§", value: 2.0 },
              { key: "å_æ¢æ±‚æ€§", value: -1.0 },
            ],
          },
          outerChoice: {
            value: "B",
            scoring_tags: [
              { key: "å…Œ_èª¿å’Œæ€§", value: 2.5 },
              { key: "å¤_å—å®¹æ€§", value: 2.0 },
              { key: "é›¢_è¡¨ç¾æ€§", value: -0.5 },
            ],
          },
        },
        {
          questionId: "q26",
          innerChoice: {
            value: "C",
            scoring_tags: [
              { key: "å_æ¢æ±‚æ€§", value: 2.5 },
              { key: "è‰®_å®‰å®šæ€§", value: 1.5 },
              { key: "éœ‡_è¡Œå‹•æ€§", value: -1.0 },
            ],
          },
          outerChoice: {
            value: "D",
            scoring_tags: [
              { key: "é›¢_è¡¨ç¾æ€§", value: 2.0 },
              { key: "å…Œ_èª¿å’Œæ€§", value: 1.5 },
              { key: "è‰®_å®‰å®šæ€§", value: -1.0 },
            ],
          },
        },
      ];

      // ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
      async function testDataLoading() {
        debugLog("ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...", "info");

        try {
          // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®ç¢ºèª
          if (typeof WORLDVIEW_QUESTIONS === "undefined") {
            throw new Error("WORLDVIEW_QUESTIONS ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“");
          }
          if (typeof SCENARIO_QUESTIONS === "undefined") {
            throw new Error("SCENARIO_QUESTIONS ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“");
          }

          debugLog(
            `âœ… WORLDVIEW_QUESTIONS: ${WORLDVIEW_QUESTIONS.length}å•`,
            "success"
          );
          debugLog(
            `âœ… SCENARIO_QUESTIONS: ${SCENARIO_QUESTIONS.length}å•`,
            "success"
          );

          // DataManagerãƒ†ã‚¹ãƒˆ
          const dataManager = new DataManager();
          await dataManager.loadData();

          const stats = dataManager.getDataStats();
          debugLog(`ğŸ“Š ãƒ‡ãƒ¼ã‚¿çµ±è¨ˆ: ${JSON.stringify(stats)}`, "info");

          showResult(
            "ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ",
            `
                    ä¾¡å€¤è¦³è¨­å•: ${WORLDVIEW_QUESTIONS.length}å•<br>
                    ã‚·ãƒŠãƒªã‚ªè¨­å•: ${SCENARIO_QUESTIONS.length}å•<br>
                    ãƒ‡ãƒ¼ã‚¿çµ±è¨ˆ: ${JSON.stringify(stats)}
                `,
            "success"
          );
        } catch (error) {
          debugLog(`âŒ ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
          showResult("ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ", `ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      // ãƒ™ã‚¯ãƒˆãƒ«è¨ˆç®—ãƒ†ã‚¹ãƒˆ
      async function testVectorCalculation() {
        debugLog("ğŸ§® ãƒ™ã‚¯ãƒˆãƒ«è¨ˆç®—ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...", "info");

        try {
          const dataManager = new DataManager();
          await dataManager.loadData();

          const calculator = new Calculator(dataManager);
          const vector = calculator.buildUserVector(sampleAnswers);

          debugLog(`ğŸ¯ è¨ˆç®—ã•ã‚ŒãŸãƒ™ã‚¯ãƒˆãƒ«: ${JSON.stringify(vector)}`, "info");

          // ãƒ™ã‚¯ãƒˆãƒ«ã®è©³ç´°è¡¨ç¤º
          const dimensions = [
            "ä¹¾_å‰µé€ æ€§",
            "éœ‡_è¡Œå‹•æ€§",
            "å_æ¢æ±‚æ€§",
            "è‰®_å®‰å®šæ€§",
            "å¤_å—å®¹æ€§",
            "å·½_é©å¿œæ€§",
            "é›¢_è¡¨ç¾æ€§",
            "å…Œ_èª¿å’Œæ€§",
          ];
          let vectorDisplay = '<div class="vector-display">';
          dimensions.forEach((dim) => {
            const score = vector[dim] || 0;
            vectorDisplay += `<div class="dimension-score">${dim}: ${score.toFixed(
              2
            )}</div>`;
          });
          vectorDisplay += "</div>";

          showResult(
            "ãƒ™ã‚¯ãƒˆãƒ«è¨ˆç®—ãƒ†ã‚¹ãƒˆ",
            `
                    è¨ˆç®—æˆåŠŸ!<br>
                    ${vectorDisplay}
                `,
            "success"
          );

          // è¨ˆç®—è©³ç´°ã‚’è¡¨ç¤º
          const detailsElement = document.getElementById("calculation-details");
          detailsElement.innerHTML = `
                    <h3>è¨ˆç®—ãƒ—ãƒ­ã‚»ã‚¹è©³ç´°</h3>
                    <pre>${JSON.stringify(vector, null, 2)}</pre>
                    <h3>å…¥åŠ›ãƒ‡ãƒ¼ã‚¿</h3>
                    <pre>${JSON.stringify(sampleAnswers, null, 2)}</pre>
                `;
        } catch (error) {
          debugLog(`âŒ ãƒ™ã‚¯ãƒˆãƒ«è¨ˆç®—ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
          showResult("ãƒ™ã‚¯ãƒˆãƒ«è¨ˆç®—ãƒ†ã‚¹ãƒˆ", `ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      // 64å¦ãƒãƒƒãƒãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
      async function testHexagramMatching() {
        debugLog("ğŸ”® 64å¦ãƒãƒƒãƒãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...", "info");

        try {
          const dataManager = new DataManager();
          await dataManager.loadData();

          const calculator = new Calculator(dataManager);
          const userVector = calculator.buildUserVector(sampleAnswers);

          const vectorsData = dataManager.getVectorsData();
          const candidates = calculator.analyzeOSCandidates(
            userVector,
            vectorsData
          );
          const matches = candidates.slice(0, 5).map((candidate) => ({
            ...candidate,
            hexagramInfo: dataManager.getHexagramData(candidate.osId),
            matchPercentage: Math.round(candidate.score * 100),
            similarity: candidate.score,
            hexagramId: candidate.osId,
          }));

          debugLog(`ğŸ¯ ãƒãƒƒãƒãƒ³ã‚°çµæœ: ${matches.length}ä»¶`, "info");

          let matchDisplay = '<div class="vector-display">';
          matches.forEach((match, index) => {
            matchDisplay += `<div style="margin: 10px 0; padding: 10px; background: #21262d; border-radius: 5px;">
                        <strong>${index + 1}. ${
              match.hexagramInfo.name
            }</strong> (é©åˆåº¦: ${match.matchPercentage.toFixed(1)}%)<br>
                        <small>é¡ä¼¼åº¦: ${match.similarity.toFixed(
                          4
                        )} | 64å¦ID: ${match.hexagramId}</small>
                    </div>`;
          });
          matchDisplay += "</div>";

          showResult(
            "64å¦ãƒãƒƒãƒãƒ³ã‚°ãƒ†ã‚¹ãƒˆ",
            `
                    ãƒãƒƒãƒãƒ³ã‚°æˆåŠŸ!<br>
                    ${matchDisplay}
                `,
            "success"
          );
        } catch (error) {
          debugLog(`âŒ 64å¦ãƒãƒƒãƒãƒ³ã‚°ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
          showResult(
            "64å¦ãƒãƒƒãƒãƒ³ã‚°ãƒ†ã‚¹ãƒˆ",
            `ã‚¨ãƒ©ãƒ¼: ${error.message}`,
            "error"
          );
        }
      }

      // ãƒ•ãƒ«åˆ†æãƒ†ã‚¹ãƒˆ
      async function testFullAnalysis() {
        debugLog("ğŸ”¬ ãƒ•ãƒ«åˆ†æãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...", "info");

        try {
          const dataManager = new DataManager();
          await dataManager.loadData();

          const engine = new DiagnosisEngine(dataManager);
          const result = await engine.analyze(sampleAnswers);

          debugLog(`ğŸ¯ åˆ†æçµæœ: ${JSON.stringify(result)}`, "info");

          // æ´å¯Ÿç”Ÿæˆãƒ†ã‚¹ãƒˆ
          const insights = await engine.generateInsights(result);

          debugLog(`ğŸ’¡ æ´å¯Ÿç”Ÿæˆ: ${JSON.stringify(insights)}`, "info");

          // 8æ¬¡å…ƒã‚¹ã‚³ã‚¢ã‚’èª­ã¿ã‚„ã™ã„å½¢å¼ã§è¡¨ç¤º
          const dimensions = [
            "ä¹¾_å‰µé€ æ€§",
            "éœ‡_è¡Œå‹•æ€§",
            "å_æ¢æ±‚æ€§",
            "è‰®_å®‰å®šæ€§",
            "å¤_å—å®¹æ€§",
            "å·½_é©å¿œæ€§",
            "é›¢_è¡¨ç¾æ€§",
            "å…Œ_èª¿å’Œæ€§",
          ];

          let dimensionDisplay = '<div class="vector-display">';
          dimensions.forEach((dim) => {
            const score = result.eightDimensionVector[dim] || 0;
            const level =
              score >= 20
                ? "very-high"
                : score >= 15
                ? "high"
                : score >= 10
                ? "medium"
                : score >= 5
                ? "low"
                : "very-low";
            const color =
              score >= 15
                ? "#51cf66"
                : score >= 10
                ? "#74c0fc"
                : score >= 5
                ? "#ffd43b"
                : "#ff6b6b";
            dimensionDisplay += `<div class="dimension-score" style="color: ${color}">${dim}: ${score.toFixed(
              1
            )} (${level})</div>`;
          });
          dimensionDisplay += "</div>";

          showResult(
            "ãƒ•ãƒ«åˆ†æãƒ†ã‚¹ãƒˆ",
            `
                    åˆ†ææˆåŠŸ!<br>
                    <strong>äººæ ¼OS:</strong> ${
                      result.primaryOS.hexagramInfo.name
                    }<br>
                    <strong>é©åˆåº¦:</strong> ${result.primaryOS.matchPercentage.toFixed(
                      1
                    )}%<br>
                    <strong>æ´å¯Ÿ:</strong> ${insights.summary}<br>
                    <strong>8æ¬¡å…ƒã‚¹ã‚³ã‚¢:</strong><br>
                    ${dimensionDisplay}
                `,
            "success"
          );
        } catch (error) {
          debugLog(`âŒ ãƒ•ãƒ«åˆ†æã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
          showResult("ãƒ•ãƒ«åˆ†æãƒ†ã‚¹ãƒˆ", `ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      // TripleOSåˆ†æãƒ†ã‚¹ãƒˆ
      async function testTripleOSAnalysis() {
        debugLog("ğŸ”¬ TripleOSåˆ†æãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...", "info");

        try {
          const dataManager = new DataManager();
          await dataManager.loadData();

          const tripleOSEngine = new TripleOSEngine(dataManager);
          const result = await tripleOSEngine.analyzeTripleOS(
            tripleOSSampleAnswers
          );

          debugLog(`ğŸ¯ TripleOSåˆ†æçµæœ: ${JSON.stringify(result)}`, "info");

          // é˜²å¾¡çš„ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: engineOS/engine, dominantTrigramsã®undefinedå¯¾ç­–
          const engineOS = result.engineOS || result.engine || {};
          const safeDominantTrigrams = Array.isArray(engineOS.dominantTrigrams)
            ? engineOS.dominantTrigrams
            : [];
          const topTrigrams = safeDominantTrigrams.slice(0, 2);

          const resultDisplay = `
            <div class="vector-display">
              <h3>ğŸ”§ ã‚¨ãƒ³ã‚¸ãƒ³OS</h3>
              <div><strong>64å¦:</strong> ${
                engineOS.hexagramInfo?.name || engineOS.osName || "ä¸æ˜"
              }</div>
              <div><strong>å¼·åº¦:</strong> ${Math.round(
                (engineOS.strength || engineOS.confidence || 0) * 100
              )}%</div>
              <div><strong>ä¸»è¦å…«å¦:</strong> ${
                topTrigrams.length > 0
                  ? topTrigrams.map((t) => `${t.name}(${t.value})`).join(", ")
                  : "åˆ†æä¸­..."
              }</div>
              <div><strong>æ§‹æˆå…«å¦:</strong> ${
                engineOS.trigramComposition
                  ? engineOS.trigramComposition
                  : '<span style="color:#ff6b6b">trigramCompositionæœªç”Ÿæˆã‚¨ãƒ©ãƒ¼</span>'
              }</div>
              <div><strong>é¡ä¼¼åº¦:</strong> ${Math.round(
                (engineOS.cosineSimilarity || 0) * 100
              )}%</div>
              
              <h3>ğŸ–¥ï¸ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹OS</h3>
              <div><strong>64å¦:</strong> ${
                result.interfaceOS?.hexagramInfo?.name ||
                result.interface?.hexagramInfo?.name ||
                "ä¸æ˜"
              }</div>
              <div><strong>ãƒãƒƒãƒã‚¹ã‚³ã‚¢:</strong> ${Math.round(
                result.interfaceOS?.matchScore ||
                  result.interface?.matchScore ||
                  0
              )}%</div>
              
              <h3>ğŸ›¡ï¸ ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰OS</h3>
              <div><strong>64å¦:</strong> ${
                result.safeModeOS?.hexagramInfo?.name ||
                result.safeMode?.hexagramInfo?.name ||
                "ä¸æ˜"
              }</div>
              <div><strong>ãƒãƒƒãƒã‚¹ã‚³ã‚¢:</strong> ${Math.round(
                result.safeModeOS?.matchScore ||
                  result.safeMode?.matchScore ||
                  0
              )}%</div>
              
              <h3>ğŸ“Š ä¸€è²«æ€§ã‚¹ã‚³ã‚¢</h3>
              <div><strong>ç·åˆ:</strong> ${Math.round(
                (result.consistencyScore?.overall || 0) * 100
              )}%</div>
              <div><strong>ã‚¨ãƒ³ã‚¸ãƒ³-ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹:</strong> ${Math.round(
                (result.consistencyScore?.engineInterface || 0) * 100
              )}%</div>
              <div><strong>ã‚¨ãƒ³ã‚¸ãƒ³-ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰:</strong> ${Math.round(
                (result.consistencyScore?.engineSafeMode || 0) * 100
              )}%</div>
              <div><strong>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹-ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰:</strong> ${Math.round(
                (result.consistencyScore?.interfaceSafeMode || 0) * 100
              )}%</div>
            </div>
          `;

          showResult(
            "TripleOSåˆ†æãƒ†ã‚¹ãƒˆ",
            `
              åˆ†ææˆåŠŸ!<br>
              ${resultDisplay}
            `,
            "success"
          );

          // è¨ˆç®—è©³ç´°ã‚’è¡¨ç¤º
          const detailsElement = document.getElementById("calculation-details");
          detailsElement.innerHTML = `
            <h3>TripleOSåˆ†æçµæœè©³ç´°</h3>
            <pre>${JSON.stringify(result, null, 2)}</pre>
          `;
        } catch (error) {
          debugLog(`âŒ TripleOSåˆ†æã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
          showResult("TripleOSåˆ†æãƒ†ã‚¹ãƒˆ", `ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®åˆæœŸè¨­å®š
      window.addEventListener("load", function () {
        debugLog("ğŸš€ Debug Test Page loaded", "info");
        debugLog(
          "ğŸ“‹ ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å„æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„",
          "info"
        );
      });
    </script>
  </body>
</html>
