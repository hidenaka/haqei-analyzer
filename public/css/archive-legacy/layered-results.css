/* HaQei Analyzer - Layered Results CSS
 * Phase 5.2: UX/情報アーキテクチャ再設計版
 * bunenjin哲学に基づく4階層情報構造スタイル
 */

/* ========================================
 * 基本変数定義
 * ======================================== */
:root {
  /* bunenjin分人カラーパレット */
  --bunenjin-engine: #ef4444;      /* 本質的な自分（赤系） */
  --bunenjin-interface: #3b82f6;   /* 社会的な自分（青系） */
  --bunenjin-safe: #10b981;        /* 守る自分（緑系） */
  
  /* 階層レベルカラー */
  --level-1: #1f2937;              /* 基本結果（ダーク） */
  --level-2: #374151;              /* 詳細分析（ミディアム） */
  --level-3: #dc2626;              /* 批判的視点（レッド） */
  --level-4: #7c3aed;              /* 実践ガイド（パープル） */
  
  /* ユーザビリティカラー */
  --primary-bg: #0f172a;
  --secondary-bg: #1e293b;
  --tertiary-bg: #334155;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --text-accent: #10b981;
  --border-color: rgba(255, 255, 255, 0.1);
  
  /* アニメーション変数 */
  --transition-fast: 200ms ease;
  --transition-normal: 300ms ease;
  --transition-slow: 500ms ease;
  --curve-smooth: cubic-bezier(0.4, 0, 0.2, 1);
  
  /* レスポンシブブレークポイント */
  --mobile-max: 768px;
  --tablet-max: 1024px;
}

/* ========================================
 * LayeredResultsView メインコンテナ
 * ======================================== */
.layered-results-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 1rem;
  background: var(--primary-bg);
  border-radius: 1rem;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.layered-results-container[data-mobile-optimized="true"] {
  padding: 0.75rem;
  margin: 0.5rem;
  border-radius: 0.75rem;
}

/* ========================================
 * 階層構造基本スタイル
 * ======================================== */
.result-layer {
  margin-bottom: 1.5rem;
  border-radius: 0.75rem;
  overflow: hidden;
  transition: all var(--transition-normal);
  position: relative;
}

.result-layer[data-level="1"] {
  background: linear-gradient(135deg, var(--level-1), var(--secondary-bg));
  border: 2px solid var(--text-accent);
}

.result-layer[data-level="2"] {
  background: linear-gradient(135deg, var(--level-2), var(--tertiary-bg));
  border: 1px solid var(--level-2);
}

.result-layer[data-level="3"] {
  background: linear-gradient(135deg, var(--level-3), #dc2626aa);
  border: 1px solid var(--level-3);
}

.result-layer[data-level="4"] {
  background: linear-gradient(135deg, var(--level-4), #7c3aedaa);
  border: 1px solid var(--level-4);
}

/* 展開・折りたたみ状態 */
.result-layer[data-state="expanded"] {
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
  transform: translateY(-2px);
}

.result-layer[data-state="collapsed"] {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* ========================================
 * 階層ヘッダー
 * ======================================== */
.layer-header {
  position: relative;
}

.layer-toggle {
  width: 100%;
  background: none;
  border: none;
  padding: 1.25rem 1.5rem;
  color: var(--text-primary);
  font-size: 1.1rem;
  font-weight: 600;
  text-align: left;
  cursor: pointer;
  transition: all var(--transition-normal);
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-radius: 0.75rem;
}

.layer-toggle:hover {
  background: rgba(255, 255, 255, 0.05);
}

.layer-toggle:focus {
  outline: 2px solid var(--text-accent);
  outline-offset: 2px;
}

.layer-toggle[aria-expanded="true"] {
  background: rgba(255, 255, 255, 0.08);
}

/* 階層タイトルと要素 */
.layer-title {
  flex: 1;
  margin: 0 1rem;
  line-height: 1.4;
}

.toggle-icon {
  font-size: 1.2rem;
  transition: transform var(--transition-normal);
  color: var(--text-accent);
}

.layer-toggle[aria-expanded="true"] .toggle-icon {
  transform: rotate(180deg);
}

.layer-badge {
  padding: 0.25rem 0.75rem;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--text-secondary);
}

/* 階層別バッジカラー */
.result-layer[data-level="1"] .layer-badge {
  background: var(--text-accent);
  color: var(--primary-bg);
}

.result-layer[data-level="2"] .layer-badge {
  background: var(--level-2);
  color: var(--text-primary);
}

.result-layer[data-level="3"] .layer-badge {
  background: var(--level-3);
  color: var(--text-primary);
}

.result-layer[data-level="4"] .layer-badge {
  background: var(--level-4);
  color: var(--text-primary);
}

/* ========================================
 * 階層コンテンツ
 * ======================================== */
.layer-content {
  overflow: hidden;
  transition: all var(--transition-normal) var(--curve-smooth);
}

.layer-content[aria-hidden="true"] {
  max-height: 0;
  opacity: 0;
}

.layer-content[aria-hidden="false"] {
  opacity: 1;
  max-height: none;
}

.layer-content .content-placeholder {
  padding: 2rem;
  text-align: center;
  color: var(--text-secondary);
}

.loading-indicator {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.loading-indicator::before {
  content: '';
  width: 1rem;
  height: 1rem;
  border: 2px solid var(--text-secondary);
  border-top: 2px solid var(--text-accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ========================================
 * Level 1: bunenjin基本結果スタイル
 * ======================================== */
.bunenjin-introduction {
  padding: 2rem;
}

.intro-header {
  text-align: center;
  margin-bottom: 2rem;
}

.results-title {
  font-size: 2rem;
  margin-bottom: 0.5rem;
  background: linear-gradient(135deg, var(--text-accent), #22d3ee);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 700;
}

.intro-subtitle {
  font-size: 1.1rem;
  color: var(--text-secondary);
  line-height: 1.6;
  max-width: 600px;
  margin: 0 auto;
}

/* bunenjin概要グリッド */
.bunenjin-overview {
  margin-bottom: 2rem;
}

.bunenjin-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.bunenjin-card {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 1rem;
  padding: 1.5rem;
  transition: all var(--transition-normal);
  border: 2px solid transparent;
  position: relative;
  overflow: hidden;
}

.bunenjin-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--text-accent);
  transition: all var(--transition-normal);
}

.bunenjin-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
}

/* 分人タイプ別スタイル */
.engine-bunenjin {
  border-color: var(--bunenjin-engine);
}

.engine-bunenjin::before {
  background: var(--bunenjin-engine);
}

.interface-bunenjin {
  border-color: var(--bunenjin-interface);
}

.interface-bunenjin::before {
  background: var(--bunenjin-interface);
}

.safe-bunenjin {
  border-color: var(--bunenjin-safe);
}

.safe-bunenjin::before {
  background: var(--bunenjin-safe);
}

/* bunenjinカード内容 */
.bunenjin-icon {
  font-size: 2.5rem;
  margin-bottom: 1rem;
  display: block;
  text-align: center;
}

.bunenjin-info {
  text-align: center;
}

.bunenjin-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
}

.bunenjin-name {
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--text-accent);
  margin-bottom: 0.75rem;
}

.bunenjin-essence {
  font-size: 0.9rem;
  color: var(--text-secondary);
  line-height: 1.5;
  margin-bottom: 1rem;
}

.bunenjin-strength {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-accent);
  padding: 0.5rem 1rem;
  background: rgba(16, 185, 129, 0.1);
  border-radius: 0.5rem;
  display: inline-block;
}

/* バランス表示 */
.bunenjin-balance {
  background: rgba(255, 255, 255, 0.03);
  border-radius: 0.75rem;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.bunenjin-balance h4 {
  text-align: center;
  margin-bottom: 1rem;
  color: var(--text-primary);
  font-size: 1.2rem;
}

.balance-visualization {
  margin-bottom: 1rem;
}

.balance-bars {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.balance-item {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.balance-label {
  min-width: 80px;
  font-size: 0.9rem;
  color: var(--text-secondary);
  font-weight: 500;
}

.balance-bar {
  flex: 1;
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
}

.balance-fill {
  height: 100%;
  border-radius: 4px;
  transition: width var(--transition-slow);
  position: relative;
}

.engine-fill {
  background: linear-gradient(90deg, var(--bunenjin-engine), #f87171);
}

.interface-fill {
  background: linear-gradient(90deg, var(--bunenjin-interface), #60a5fa);
}

.safe-fill {
  background: linear-gradient(90deg, var(--bunenjin-safe), #34d399);
}

.balance-value {
  min-width: 60px;
  text-align: right;
  font-size: 0.9rem;
  color: var(--text-accent);
  font-weight: 600;
}

.balance-insight {
  text-align: center;
  padding: 1rem;
  background: rgba(16, 185, 129, 0.1);
  border-radius: 0.5rem;
  color: var(--text-primary);
  line-height: 1.6;
  font-size: 0.95rem;
}

/* レベル遷移 */
.level-transition {
  text-align: center;
  padding: 2rem 1rem;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 0.75rem;
  border: 1px dashed var(--border-color);
}

.transition-message {
  margin-bottom: 1.5rem;
  color: var(--text-secondary);
  font-size: 1rem;
  line-height: 1.6;
}

.transition-btn {
  background: linear-gradient(135deg, var(--text-accent), #22d3ee);
  color: var(--primary-bg);
  border: none;
  padding: 1rem 2rem;
  border-radius: 0.75rem;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-normal);
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.transition-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
}

.transition-btn:focus {
  outline: 2px solid var(--text-accent);
  outline-offset: 2px;
}

/* ========================================
 * Level 2: 詳細分析スタイル
 * ======================================== */
.level2-detailed-analysis {
  padding: 2rem;
}

.analysis-intro {
  text-align: center;
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid var(--border-color);
}

.analysis-intro h3 {
  font-size: 1.8rem;
  margin-bottom: 1rem;
  color: var(--text-primary);
}

.analysis-intro p {
  color: var(--text-secondary);
  font-size: 1.05rem;
  line-height: 1.6;
  max-width: 600px;
  margin: 0 auto;
}

/* 詳細分析グリッド */
.bunenjin-detailed-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.bunenjin-detailed-card {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 1rem;
  overflow: hidden;
  border: 1px solid var(--border-color);
  transition: all var(--transition-normal);
}

.bunenjin-detailed-card:hover {
  border-color: var(--text-accent);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.detailed-header {
  background: rgba(255, 255, 255, 0.05);
  padding: 1.5rem;
  display: flex;
  align-items: center;
  gap: 1rem;
  border-bottom: 1px solid var(--border-color);
}

.bunenjin-icon-large {
  font-size: 2rem;
  opacity: 0.8;
}

.bunenjin-title-group h4 {
  margin: 0 0 0.25rem 0;
  color: var(--text-primary);
  font-size: 1.2rem;
}

.bunenjin-name {
  color: var(--text-accent);
  font-weight: 600;
}

.detailed-content {
  padding: 1.5rem;
}

.characteristic-section {
  margin-bottom: 1.5rem;
}

.characteristic-section:last-child {
  margin-bottom: 0;
}

.characteristic-section h5 {
  margin-bottom: 0.75rem;
  color: var(--text-primary);
  font-size: 1rem;
  font-weight: 600;
}

.characteristic-section p {
  color: var(--text-secondary);
  line-height: 1.6;
  margin-bottom: 0.75rem;
}

.pattern-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.pattern-list li {
  padding: 0.5rem 0;
  color: var(--text-secondary);
  font-size: 0.95rem;
  line-height: 1.5;
  position: relative;
  padding-left: 1.5rem;
}

.pattern-list li::before {
  content: "→";
  position: absolute;
  left: 0;
  color: var(--text-accent);
  font-weight: bold;
}

/* 強み・課題グリッド */
.strengths-challenges-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.strengths, .challenges {
  padding: 1rem;
  border-radius: 0.5rem;
}

.strengths {
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid rgba(16, 185, 129, 0.3);
}

.challenges {
  background: rgba(251, 191, 36, 0.1);
  border: 1px solid rgba(251, 191, 36, 0.3);
}

.strengths h6 {
  color: var(--bunenjin-safe);
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

.challenges h6 {
  color: #fbbf24;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

.strengths ul, .challenges ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.strengths li, .challenges li {
  font-size: 0.85rem;
  color: var(--text-secondary);
  margin-bottom: 0.25rem;
  padding-left: 1rem;
  position: relative;
}

.strengths li::before {
  content: "✓";
  position: absolute;
  left: 0;
  color: var(--bunenjin-safe);
}

.challenges li::before {
  content: "!";
  position: absolute;
  left: 0;
  color: #fbbf24;
}

/* 相互作用分析 */
.interaction-analysis {
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 0.75rem;
  border: 1px solid var(--border-color);
}

.interaction-analysis h4 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
  font-size: 1.4rem;
}

.interactions-grid {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.interaction-item {
  padding: 1rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 0.5rem;
  border: 1px solid var(--border-color);
}

.interaction-item h5 {
  margin-bottom: 0.75rem;
  color: var(--text-accent);
  font-size: 1rem;
}

.interaction-metrics {
  display: flex;
  gap: 1rem;
  margin-bottom: 0.75rem;
}

.synergy, .tension {
  padding: 0.25rem 0.75rem;
  border-radius: 0.25rem;
  font-size: 0.8rem;
  font-weight: 500;
}

.synergy {
  background: rgba(16, 185, 129, 0.2);
  color: var(--bunenjin-safe);
}

.tension {
  background: rgba(239, 68, 68, 0.2);
  color: #ef4444;
}

.harmony-summary {
  padding: 1.5rem;
  background: rgba(16, 185, 129, 0.1);
  border-radius: 0.5rem;
  text-align: center;
}

.harmony-level {
  font-size: 1.2rem;
  font-weight: 600;
  color: var(--text-accent);
  margin-bottom: 0.5rem;
}

/* 統計的信頼度 */
.statistical-confidence {
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 0.75rem;
  border: 1px solid var(--border-color);
}

.statistical-confidence h4 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
  font-size: 1.3rem;
}

.confidence-metrics {
  margin-bottom: 1.5rem;
}

.confidence-grid {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.confidence-item {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.confidence-label {
  min-width: 120px;
  font-size: 0.9rem;
  color: var(--text-secondary);
}

.confidence-bar {
  flex: 1;
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
}

.confidence-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--text-accent), #22d3ee);
  border-radius: 4px;
  transition: width var(--transition-slow);
}

.confidence-value {
  min-width: 60px;
  text-align: right;
  font-size: 0.9rem;
  color: var(--text-accent);
  font-weight: 600;
}

.overall-confidence {
  text-align: center;
  padding: 1rem;
  background: rgba(16, 185, 129, 0.1);
  border-radius: 0.5rem;
  margin-top: 1rem;
}

.methodology-note {
  text-align: center;
  color: var(--text-secondary);
  font-size: 0.9rem;
  line-height: 1.5;
}

.methodology-note p {
  margin-bottom: 0.5rem;
}

/* ========================================
 * Level 3: 批判的視点スタイル
 * ======================================== */
.level3-critical-analysis {
  padding: 2rem;
}

.critical-intro {
  text-align: center;
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: rgba(239, 68, 68, 0.1);
  border-radius: 0.75rem;
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.critical-intro h3 {
  font-size: 1.8rem;
  margin-bottom: 1rem;
  color: #ef4444;
}

.critical-intro p {
  color: var(--text-secondary);
  font-size: 1.05rem;
  line-height: 1.6;
}

/* 影の分析 */
.shadow-analysis {
  margin-bottom: 2rem;
}

.shadow-analysis h4 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
  font-size: 1.4rem;
}

.shadow-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
}

.shadow-card {
  background: rgba(239, 68, 68, 0.05);
  border: 1px solid rgba(239, 68, 68, 0.2);
  border-radius: 0.75rem;
  padding: 1.5rem;
}

.shadow-card h5 {
  margin-bottom: 1rem;
  color: #ef4444;
  font-size: 1.1rem;
}

.shadow-content p {
  color: var(--text-secondary);
  font-size: 0.95rem;
  line-height: 1.6;
  margin-bottom: 0.75rem;
}

.shadow-content strong {
  color: var(--text-primary);
}

/* バイアス警告 */
.bias-warnings {
  margin-bottom: 2rem;
}

.bias-warnings h4 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
  font-size: 1.4rem;
}

.bias-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.bias-item {
  padding: 1.5rem;
  background: rgba(251, 191, 36, 0.1);
  border: 1px solid rgba(251, 191, 36, 0.3);
  border-radius: 0.75rem;
}

.bias-item h5 {
  margin-bottom: 0.75rem;
  color: #fbbf24;
  font-size: 1.1rem;
}

.bias-item p {
  color: var(--text-secondary);
  line-height: 1.6;
  margin: 0;
}

/* ツールの限界 */
.tool-limitations {
  margin-bottom: 2rem;
}

.tool-limitations h4 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
  font-size: 1.4rem;
}

.limitations-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
}

.limitation-section {
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 0.75rem;
  border: 1px solid var(--border-color);
}

.limitation-section h5 {
  margin-bottom: 1rem;
  color: var(--text-primary);
  font-size: 1.1rem;
}

.limitation-section ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.limitation-section li {
  color: var(--text-secondary);
  font-size: 0.95rem;
  line-height: 1.5;
  margin-bottom: 0.75rem;
  padding-left: 1.5rem;
  position: relative;
}

.limitation-section li::before {
  content: "⚠️";
  position: absolute;
  left: 0;
}

/* 健全な活用方法 */
.healthy-usage {
  margin-bottom: 2rem;
}

.healthy-usage h4 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: var(--bunenjin-safe);
  font-size: 1.4rem;
}

.usage-guidelines {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.guideline-item {
  padding: 1.5rem;
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid rgba(16, 185, 129, 0.3);
  border-radius: 0.75rem;
}

.guideline-item h5 {
  margin-bottom: 0.75rem;
  color: var(--bunenjin-safe);
  font-size: 1.1rem;
}

.guideline-item p {
  color: var(--text-secondary);
  line-height: 1.6;
  margin: 0;
}

/* プライバシー注記 */
.privacy-note {
  padding: 1.5rem;
  background: rgba(59, 130, 246, 0.1);
  border: 1px solid rgba(59, 130, 246, 0.3);
  border-radius: 0.75rem;
  text-align: center;
}

.privacy-note h4 {
  margin-bottom: 1rem;
  color: var(--bunenjin-interface);
  font-size: 1.2rem;
}

.privacy-note p {
  color: var(--text-secondary);
  line-height: 1.6;
  margin: 0;
}

/* ========================================
 * Level 4: 実践ガイドスタイル
 * ======================================== */
.level4-practical-guide {
  padding: 2rem;
}

.guide-intro {
  text-align: center;
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: rgba(124, 58, 237, 0.1);
  border-radius: 0.75rem;
  border: 1px solid rgba(124, 58, 237, 0.3);
}

.guide-intro h3 {
  font-size: 1.8rem;
  margin-bottom: 1rem;
  color: var(--level-4);
}

.guide-intro p {
  color: var(--text-secondary);
  font-size: 1.05rem;
  line-height: 1.6;
}

/* 実践戦略 */
.practical-strategies {
  margin-bottom: 2rem;
}

.practical-strategies h4 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
  font-size: 1.4rem;
}

.strategy-sections {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.strategy-section {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 0.75rem;
  padding: 1.5rem;
  border: 1px solid var(--border-color);
}

.strategy-section h5 {
  margin-bottom: 1rem;
  color: var(--text-primary);
  font-size: 1.2rem;
}

.engine-strategy {
  border-left: 4px solid var(--bunenjin-engine);
}

.interface-strategy {
  border-left: 4px solid var(--bunenjin-interface);
}

.safe-strategy {
  border-left: 4px solid var(--bunenjin-safe);
}

.strategy-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.daily-practices, .micro-experiments {
  padding: 1rem;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 0.5rem;
}

.daily-practices h6, .micro-experiments h6 {
  margin-bottom: 0.75rem;
  color: var(--text-accent);
  font-size: 1rem;
}

.daily-practices ul, .micro-experiments ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.daily-practices li, .micro-experiments li {
  color: var(--text-secondary);
  font-size: 0.9rem;
  line-height: 1.5;
  margin-bottom: 0.5rem;
  padding-left: 1.5rem;
  position: relative;
}

.daily-practices li::before {
  content: "🔄";
  position: absolute;
  left: 0;
}

.micro-experiments li::before {
  content: "🧪";
  position: absolute;
  left: 0;
}

/* 調和の実践 */
.harmony-practices {
  margin-bottom: 2rem;
}

.harmony-practices h4 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
  font-size: 1.4rem;
}

.harmony-techniques {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.technique-item {
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 0.75rem;
  border: 1px solid var(--border-color);
}

.technique-item h5 {
  margin-bottom: 0.75rem;
  color: var(--text-accent);
  font-size: 1.1rem;
}

.technique-item p {
  color: var(--text-secondary);
  line-height: 1.6;
  margin-bottom: 1rem;
}

.technique-steps ol {
  padding-left: 1.5rem;
  color: var(--text-secondary);
}

.technique-steps li {
  margin-bottom: 0.5rem;
  line-height: 1.5;
}

.technique-examples ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.technique-examples li {
  color: var(--text-secondary);
  font-size: 0.95rem;
  line-height: 1.5;
  margin-bottom: 0.5rem;
  padding-left: 1.5rem;
  position: relative;
}

.technique-examples li::before {
  content: "💡";
  position: absolute;
  left: 0;
}

.technique-examples strong {
  color: var(--text-primary);
}

/* 継続的改善 */
.continuous-improvement {
  margin-bottom: 2rem;
}

.continuous-improvement h4 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
  font-size: 1.4rem;
}

.improvement-framework {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.framework-section {
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 0.75rem;
  border: 1px solid var(--border-color);
}

.framework-section h5 {
  margin-bottom: 1rem;
  color: var(--text-accent);
  font-size: 1.1rem;
}

.reflection-questions ul, .experiment-planning ol {
  color: var(--text-secondary);
  line-height: 1.6;
}

.reflection-questions li, .experiment-planning li {
  margin-bottom: 0.5rem;
}

.growth-areas {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.growth-item {
  padding: 1rem;
  background: rgba(124, 58, 237, 0.1);
  border-radius: 0.5rem;
  border: 1px solid rgba(124, 58, 237, 0.3);
}

.growth-item h6 {
  margin-bottom: 0.5rem;
  color: var(--level-4);
  font-size: 1rem;
}

.growth-item p {
  color: var(--text-secondary);
  line-height: 1.5;
  margin: 0;
}

/* 実践支援ツール */
.practice-tools {
  margin-bottom: 2rem;
}

.practice-tools h4 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
  font-size: 1.4rem;
}

.tools-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.5rem;
}

.tool-item {
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 0.75rem;
  border: 1px solid var(--border-color);
  text-align: center;
}

.tool-item h5 {
  margin-bottom: 0.75rem;
  color: var(--text-accent);
  font-size: 1.1rem;
}

.tool-item p {
  color: var(--text-secondary);
  line-height: 1.5;
  margin-bottom: 1rem;
}

.tool-button {
  background: linear-gradient(135deg, var(--level-4), #a855f7);
  color: white;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--transition-normal);
}

.tool-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(124, 58, 237, 0.3);
}

/* ========================================
 * アクションボタン
 * ======================================== */
.layer-actions {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin: 2rem 0;
  flex-wrap: wrap;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 0.5rem;
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--transition-normal);
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-primary {
  background: linear-gradient(135deg, var(--text-accent), #22d3ee);
  color: var(--primary-bg);
}

.btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
}

.btn-outline {
  background: transparent;
  color: var(--text-accent);
  border: 1px solid var(--text-accent);
}

.btn-premium {
  background: linear-gradient(135deg, #fbbf24, #f59e0b);
  color: var(--primary-bg);
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
}

.btn:focus {
  outline: 2px solid var(--text-accent);
  outline-offset: 2px;
}

/* ========================================
 * プレミアム移行
 * ======================================== */
.premium-transition {
  margin-top: 3rem;
}

.premium-transition-card {
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
  border: 2px solid rgba(251, 191, 36, 0.3);
  border-radius: 1rem;
  padding: 2rem;
  text-align: center;
}

.premium-header h3 {
  font-size: 1.8rem;
  margin-bottom: 1rem;
  color: #fbbf24;
}

.premium-subtitle {
  font-size: 1.1rem;
  color: var(--text-secondary);
  line-height: 1.6;
  margin-bottom: 2rem;
}

.premium-benefits {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-bottom: 2rem;
}

.benefit-item {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  padding: 0.75rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 0.5rem;
}

.benefit-icon {
  font-size: 1.2rem;
}

.benefit-text {
  color: var(--text-primary);
  font-weight: 500;
}

.premium-action {
  margin-top: 1.5rem;
}

/* ========================================
 * モーダルとダイアログ
 * ======================================== */
.dialogue-guide-modal, .insights-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(4px);
}

.modal-content {
  position: relative;
  background: var(--secondary-bg);
  border-radius: 1rem;
  max-width: 600px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  border: 1px solid var(--border-color);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.5rem;
  border-bottom: 1px solid var(--border-color);
}

.modal-header h3 {
  margin: 0;
  color: var(--text-primary);
  font-size: 1.3rem;
}

.modal-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 1.5rem;
  cursor: pointer;
  width: 2rem;
  height: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 0.25rem;
  transition: all var(--transition-fast);
}

.modal-close:hover {
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-primary);
}

.modal-body {
  padding: 1.5rem;
}

.modal-body h4 {
  margin-bottom: 1.5rem;
  color: var(--text-primary);
  text-align: center;
}

.dialogue-section, .integration-section {
  margin-bottom: 1.5rem;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 0.5rem;
}

.dialogue-section h5, .integration-section h5 {
  margin-bottom: 0.75rem;
  color: var(--text-accent);
  font-size: 1rem;
}

.dialogue-section ul, .integration-section ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.dialogue-section li, .integration-section li {
  color: var(--text-secondary);
  font-size: 0.9rem;
  line-height: 1.5;
  margin-bottom: 0.5rem;
  padding-left: 1.5rem;
  position: relative;
}

.dialogue-section li::before, .integration-section li::before {
  content: "?";
  position: absolute;
  left: 0;
  color: var(--text-accent);
  font-weight: bold;
}

.modal-footer {
  display: flex;
  justify-content: center;
  padding: 1.5rem;
  border-top: 1px solid var(--border-color);
}

/* ========================================
 * エラーと通知
 * ======================================== */
.layered-error {
  text-align: center;
  padding: 3rem 2rem;
  color: var(--text-secondary);
}

.error-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  display: block;
}

.error-message {
  font-size: 1.2rem;
  margin-bottom: 2rem;
  color: var(--text-primary);
}

.error-retry {
  background: var(--text-accent);
  color: var(--primary-bg);
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  cursor: pointer;
  font-weight: 500;
}

.content-error {
  text-align: center;
  padding: 2rem;
  color: var(--text-secondary);
}

.error-icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.retry-btn {
  background: var(--text-accent);
  color: var(--primary-bg);
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 0.25rem;
  cursor: pointer;
  font-size: 0.9rem;
  margin-top: 0.5rem;
}

.notification {
  border-radius: 0.5rem;
  font-size: 0.9rem;
  animation: slideInRight 0.3s ease;
}

@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* ========================================
 * bunenjin特化ExpandableSection統合
 * ======================================== */
.bunenjin-section {
  position: relative;
}

.bunenjin-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  border-radius: 2px;
  transition: all var(--transition-normal);
}

.engine-bunenjin.bunenjin-section::before {
  background: var(--bunenjin-engine);
}

.interface-bunenjin.bunenjin-section::before {
  background: var(--bunenjin-interface);
}

.safe-bunenjin.bunenjin-section::before {
  background: var(--bunenjin-safe);
}

.bunenjin-header {
  padding-left: 2rem;
}

.bunenjin-icon {
  font-size: 1.5rem;
  margin-right: 0.5rem;
}

.section-meta {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.balance-indicator {
  font-size: 1rem;
  opacity: 0.7;
}

.bunenjin-content-wrapper {
  padding-left: 1rem;
  border-left: 2px solid rgba(255, 255, 255, 0.1);
  margin-left: 1rem;
}

.balance-indicator-section {
  margin-top: 1rem;
  padding: 0.75rem;
  background: rgba(16, 185, 129, 0.1);
  border-radius: 0.5rem;
  border: 1px solid rgba(16, 185, 129, 0.2);
}

.balance-note {
  font-size: 0.85rem;
  color: var(--text-secondary);
  text-align: center;
  font-style: italic;
}

/* ========================================
 * レスポンシブデザイン
 * ======================================== */
@media (max-width: 768px) {
  .layered-results-container {
    margin: 0.25rem;
    padding: 1rem;
    border-radius: 0.5rem;
  }

  .results-title {
    font-size: 1.5rem;
  }

  .intro-subtitle {
    font-size: 1rem;
  }

  .bunenjin-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  .bunenjin-detailed-grid {
    grid-template-columns: 1fr;
  }

  .strengths-challenges-grid {
    grid-template-columns: 1fr;
  }

  .strategy-content {
    grid-template-columns: 1fr;
  }

  .layer-actions {
    flex-direction: column;
    align-items: stretch;
  }

  .btn {
    justify-content: center;
  }

  .tools-list {
    grid-template-columns: 1fr;
  }

  .growth-areas {
    grid-template-columns: 1fr;
  }

  .limitations-content {
    grid-template-columns: 1fr;
  }

  .modal-content {
    margin: 1rem;
    max-height: calc(100vh - 2rem);
  }

  .balance-bars {
    gap: 1rem;
  }

  .balance-item {
    flex-direction: column;
    align-items: stretch;
    gap: 0.5rem;
  }

  .balance-label {
    min-width: auto;
    text-align: center;
  }

  .balance-value {
    text-align: center;
  }

  /* モバイル用の横スクロール対応 */
  .interaction-metrics {
    flex-direction: column;
    gap: 0.5rem;
  }

  .confidence-item {
    flex-direction: column;
    gap: 0.5rem;
    text-align: center;
  }

  .confidence-label {
    min-width: auto;
  }

  .confidence-value {
    text-align: center;
  }
}

@media (max-width: 480px) {
  .bunenjin-card {
    padding: 1rem;
  }

  .bunenjin-icon {
    font-size: 2rem;
  }

  .bunenjin-name {
    font-size: 1.1rem;
  }

  .layer-toggle {
    padding: 1rem;
    font-size: 1rem;
  }

  .detailed-header {
    flex-direction: column;
    text-align: center;
    gap: 0.5rem;
  }

  .bunenjin-icon-large {
    font-size: 1.5rem;
  }

  .technique-steps ol {
    padding-left: 1rem;
  }

  .daily-practices li, .micro-experiments li {
    padding-left: 1rem;
    font-size: 0.85rem;
  }
}

/* ========================================
 * アクセシビリティ強化
 * ======================================== */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

@media (prefers-contrast: high) {
  :root {
    --text-primary: #ffffff;
    --text-secondary: #e5e5e5;
    --border-color: rgba(255, 255, 255, 0.3);
  }

  .bunenjin-card, .result-layer, .strategy-section {
    border-width: 2px;
  }
}

/* フォーカス可視性の向上 */
.layer-toggle:focus-visible,
.btn:focus-visible,
.tool-button:focus-visible {
  outline: 3px solid var(--text-accent);
  outline-offset: 2px;
}

/* ========================================
 * アニメーション効果
 * ======================================== */
.fade-in {
  animation: fadeIn 0.6s ease forwards;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.slide-up {
  animation: slideUp 0.5s ease forwards;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.scale-in {
  animation: scaleIn 0.3s ease forwards;
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* バランスバーのアニメーション */
.balance-fill, .confidence-fill {
  animation: fillBar 1.5s ease forwards;
  animation-delay: 0.3s;
  width: 0;
}

@keyframes fillBar {
  to {
    width: var(--target-width, 0%);
  }
}

/* ホバーエフェクト */
.bunenjin-card:hover, .tool-item:hover, .strategy-section:hover {
  animation: subtle-bounce 0.6s ease;
}

@keyframes subtle-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}

/* ========================================
 * ダークモード対応（将来拡張用）
 * ======================================== */
@media (prefers-color-scheme: light) {
  /* ライトモード変数は現在未実装 */
  /* 将来的にライトモードサポートを追加する場合の準備 */
}

/* ========================================
 * 印刷スタイル
 * ======================================== */
@media print {
  .layered-results-container {
    background: white;
    color: black;
    box-shadow: none;
  }

  .layer-toggle {
    display: none;
  }

  .layer-content {
    display: block !important;
    max-height: none !important;
    opacity: 1 !important;
  }

  .btn, .tool-button {
    display: none;
  }

  .modal-overlay, .dialogue-guide-modal, .insights-modal {
    display: none;
  }
}