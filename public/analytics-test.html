<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¹æœæ¸¬å®šã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ | HaQei</title>
    
    <!-- Styles -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 2rem;
        }

        .section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .section h2 {
            color: #4f46e5;
            margin-bottom: 1rem;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #4338ca;
            transform: translateY(-1px);
        }

        button.secondary {
            background: #6b7280;
        }

        button.secondary:hover {
            background: #4b5563;
        }

        button.danger {
            background: #ef4444;
        }

        button.danger:hover {
            background: #dc2626;
        }

        .metrics-display {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
            border: 1px solid #e5e7eb;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .metric-item:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #6b7280;
            font-weight: 500;
        }

        .metric-value {
            color: #111827;
            font-weight: 600;
        }

        .event-log {
            background: #1f2937;
            color: #d1d5db;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.875rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .event-log-item {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .timestamp {
            color: #9ca3af;
            font-size: 0.75rem;
        }

        .success {
            color: #10b981;
        }

        .error {
            color: #ef4444;
        }

        .info {
            color: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” åŠ¹æœæ¸¬å®šã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h1>

        <!-- ã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ -->
        <div class="section">
            <h2>ã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°</h2>
            <div class="button-group">
                <button onclick="testPageView()">ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼é€ä¿¡</button>
                <button onclick="testDiagnosisStart()">è¨ºæ–­é–‹å§‹</button>
                <button onclick="testDiagnosisComplete()">è¨ºæ–­å®Œäº†</button>
                <button onclick="testConversion()">ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³</button>
                <button onclick="testError()">ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ</button>
                <button onclick="testCustomMetric()">ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹</button>
            </div>
        </div>

        <!-- ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚µãƒãƒªãƒ¼ -->
        <div class="section">
            <h2>ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚µãƒãƒªãƒ¼</h2>
            <button onclick="showMetricsSummary()">ã‚µãƒãƒªãƒ¼è¡¨ç¤º</button>
            <div id="metricsSummary" class="metrics-display" style="display: none;"></div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
        <div class="section">
            <h2>ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
            <div class="button-group">
                <button onclick="exportAnalyticsData()" class="secondary">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                <button onclick="clearAnalyticsData()" class="danger">ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
            </div>
        </div>

        <!-- ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚° -->
        <div class="section">
            <h2>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°</h2>
            <div id="eventLog" class="event-log"></div>
        </div>
    </div>

    <!-- åŠ¹æœæ¸¬å®šã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿ -->
    <script src="js/analytics/EffectMeasurementSystem.js"></script>

    <!-- ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        // ãƒ­ã‚°è¡¨ç¤ºé–¢æ•°
        function logEvent(message, type = 'info') {
            const logContainer = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            
            const logItem = document.createElement('div');
            logItem.className = 'event-log-item';
            logItem.innerHTML = `
                <span class="timestamp">[${timestamp}]</span>
                <span class="${type}">${message}</span>
            `;
            
            logContainer.insertBefore(logItem, logContainer.firstChild);
            
            // æœ€å¤§20ä»¶ã¾ã§è¡¨ç¤º
            while (logContainer.children.length > 20) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚¹ãƒˆ
        function testPageView() {
            effectMeasurement.trackPageView('Analytics Test Page');
            logEvent('ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã‚’é€ä¿¡ã—ã¾ã—ãŸ', 'success');
        }

        // è¨ºæ–­é–‹å§‹ãƒ†ã‚¹ãƒˆ
        function testDiagnosisStart() {
            effectMeasurement.trackDiagnosisStart('quick_analyzer');
            logEvent('è¨ºæ–­é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸ (quick_analyzer)', 'success');
        }

        // è¨ºæ–­å®Œäº†ãƒ†ã‚¹ãƒˆ
        function testDiagnosisComplete() {
            const mockResult = {
                primaryOS: 'Engine OS',
                score: 85
            };
            effectMeasurement.trackDiagnosisComplete('quick_analyzer', mockResult);
            logEvent('è¨ºæ–­å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸ (Engine OS, 85%)', 'success');
        }

        // ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
        function testConversion() {
            effectMeasurement.trackConversion('purchase', 2980);
            logEvent('ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸ (è³¼å…¥: Â¥2,980)', 'success');
        }

        // ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ
        function testError() {
            effectMeasurement.trackError('test_error', 'This is a test error message');
            logEvent('ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸ', 'error');
        }

        // ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ
        function testCustomMetric() {
            const loadTime = Math.floor(Math.random() * 3000) + 500;
            effectMeasurement.trackMetric('page_load_time', loadTime, 'ms');
            logEvent(`ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’é€ä¿¡ã—ã¾ã—ãŸ (ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚é–“: ${loadTime}ms)`, 'success');
        }

        // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚µãƒãƒªãƒ¼è¡¨ç¤º
        function showMetricsSummary() {
            const summary = effectMeasurement.getMetricsSummary();
            const summaryContainer = document.getElementById('metricsSummary');
            
            summaryContainer.innerHTML = `
                <div class="metric-item">
                    <span class="metric-label">ç·ã‚¤ãƒ™ãƒ³ãƒˆæ•°</span>
                    <span class="metric-value">${summary.totalEvents}</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">ç·ã‚¨ãƒ©ãƒ¼æ•°</span>
                    <span class="metric-value">${summary.totalErrors}</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°</span>
                    <span class="metric-value">${summary.sessionCount}</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">Quick â†’ OSåˆ†æè»¢æ›ç‡</span>
                    <span class="metric-value">${summary.conversionRate.quickToOSAnalysis.toFixed(1)}%</span>
                </div>
                <div class="metric-item">
                    <span class="metric-label">æœ€çµ‚æ›´æ–°</span>
                    <span class="metric-value">${new Date(summary.lastUpdate).toLocaleString()}</span>
                </div>
            `;
            
            summaryContainer.style.display = 'block';
            logEvent('ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ', 'info');
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportAnalyticsData() {
            const data = effectMeasurement.exportData();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `haqei_analytics_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            logEvent('åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        function clearAnalyticsData() {
            effectMeasurement.clearData();
            logEvent('åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'error');
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆæœŸãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼é€ä¿¡
            effectMeasurement.trackPageView();
            logEvent('åŠ¹æœæ¸¬å®šã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ', 'info');
            logEvent('ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'info');
        });
    </script>
</body>
</html>