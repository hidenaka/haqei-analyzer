<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaQei Triple OS Analyzer</title>
    <!-- ãƒ¢ãƒ€ãƒ³CSSã‚’ç¢ºå®Ÿã«èª­ã¿è¾¼ã‚€ -->
    <link rel="stylesheet" href="styles-modern.css">
    
    <!-- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã§ç¢ºå®Ÿã«é©ç”¨ -->
    <style>
        /* ç”»é¢åˆ‡ã‚Šæ›¿ãˆã®æœ€å°é™ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block !important;
        }
        
        /* bodyã®å¤ã„ç´«èƒŒæ™¯ã‚’ä¸Šæ›¸ã */
        body {
            background: linear-gradient(180deg, #fafafa 0%, #f4f4f5 100%) !important;
        }
    </style>
    
    <!-- é€šçŸ¥ã‚¹ã‚¿ãƒ–ï¼ˆæœ€åˆæœŸã«å®šç¾©ï¼‰ -->
    <script>
      if (!window.notifications) {
        (function(){
          function log(level, message) {
            try {
              if (level === 'error' && window.ErrorDisplayUI && typeof window.ErrorDisplayUI.displayError === 'function') {
                window.ErrorDisplayUI.displayError(message);
                return;
              }
            } catch (e) {}
            var prefixMap = { error: '[NOTIFICATION ERROR]:', warning: '[NOTIFICATION WARNING]:', info: '[NOTIFICATION INFO]:', success: '[NOTIFICATION SUCCESS]:' };
            var logger = (level === 'error') ? console.error : (level === 'warning') ? console.warn : console.log;
            logger(prefixMap[level] + ' ' + message);
            if (level === 'error' && typeof alert !== 'undefined') {
              alert('ã‚¨ãƒ©ãƒ¼: ' + message);
            }
          }
          window.notifications = {
            showError: function(message){ log('error', message); },
            showWarning: function(message){ log('warning', message); },
            showInfo: function(message){ log('info', message); },
            showSuccess: function(message){ log('success', message); }
          };
        })();
      }
    </script>
    
    <!-- å¿…é ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆheadå†…ï¼‰ -->
    <script src="assets/H384H64database.js"></script>
    <script src="js/core/phrasing.js"></script>
    <script src="js/core/phase-description.js"></script>
    <script src="js/core/ExpressionGenerator.js"></script>
    <script src="js/core/KeywordAnalyzer.js"></script>
    <script src="js/core/TripleOSInteractionAnalyzer.js"></script>
</head>
<body>
    <!-- ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢ -->
    <section id="welcome-screen" class="screen welcome-screen active">
        <h1>HaQei Triple OS Analyzer</h1>
        <div class="welcome-content">
            <p>ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ã‚ãªãŸã®æ€è€ƒãƒ»è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’3ã¤ã®OSï¼ˆã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã¨ã—ã¦åˆ†æã—ã¾ã™ã€‚</p>
            <ul>
                <li><strong>Engine OS</strong>: ã‚ãªãŸã®åŸå‹•åŠ›ã¨ãªã‚‹æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³</li>
                <li><strong>Interface OS</strong>: ã‚ãªãŸã®å¯¾äººé–¢ä¿‚ã«ãŠã‘ã‚‹ç‰¹å¾´</li>
                <li><strong>Safe Mode OS</strong>: ã‚ãªãŸã®å®‰å®šæ€§ã¨å—å®¹æ€§</li>
            </ul>
            <p>36ã®è³ªå•ã«ç­”ãˆã‚‹ã“ã¨ã§ã€ã‚ãªãŸç‹¬è‡ªã®Triple OSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>
        </div>
        <button id="start-btn">åˆ†æã‚’é–‹å§‹</button>
    </section>
    
    <!-- è³ªå•ç”»é¢ -->
    <section id="question-screen" class="screen question-screen" style="display:none;">
        <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’è¿½åŠ  -->
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
        
        <div id="question-container">
            <div id="question-number"></div>
            <div id="question-title"></div>
        </div>
        <div id="options-container">
            <!-- é¸æŠè‚¢ãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
        </div>
        <div class="navigation-buttons">
            <button id="prev-btn">å‰ã¸</button>
            <button id="next-btn" disabled style="opacity: 0.5; cursor: not-allowed;">æ¬¡ã¸</button>
        </div>
    </section>
    
    <!-- çµæœç”»é¢ -->
    <section id="results-screen" class="screen results-screen" style="display:none;">
        <h2>ã‚ãªãŸã®Triple OSåˆ†æçµæœ</h2>
        <div id="os-cards-container"></div>
        <div id="summary-view"></div>
        <div id="hexagram-display"></div>
    </section>
    
    <!-- ã‚¨ãƒ©ãƒ¼ç”»é¢ -->
    <section id="error-screen" class="screen error-screen" style="display:none;">
        <div class="error-container">
            <h2>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>
            <p id="error-message"></p>
            <button id="error-retry-btn" class="btn btn-primary" onclick="location.reload()">å†è©¦è¡Œ</button>
        </div>
    </section>
    
    <!-- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ç”¨ã®é€šçŸ¥è¦ç´  -->
    <div id="aria-live-region" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    <div id="aria-announce" class="sr-only" aria-live="assertive" aria-atomic="true"></div>
    
    <!-- UI/UXä¿®æ­£ç”¨ã‚¹ã‚¿ã‚¤ãƒ« -->
    <style>
    /* ç”»é¢ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
    .screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        min-height: 100vh;
        background: white;
        padding: 20px;
        box-sizing: border-box;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    /* éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç”»é¢ã‚’éš ã™ */
    .screen:not(.active) {
        display: none !important;
    }
    
    /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç”»é¢ã‚’è¡¨ç¤º */
    .screen.active {
        display: block !important;
        opacity: 1;
    }
    
    /* æ—§ã‚¯ãƒ©ã‚¹åã¨ã®äº’æ›æ€§ - styles-modern.cssã«å§”è­² */
    .welcome-screen, .question-screen, .results-screen {
        /* styles-modern.cssã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã“ã§ã¯å‰Šé™¤ */
    }
    
    .welcome-screen.active, .question-screen.active, .results-screen.active {
        /* styles-modern.cssã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã“ã§ã¯å‰Šé™¤ */
    }
    
    /* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
    button {
        background: #6366f1;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.2s;
    }
    
    button:hover:not(:disabled) {
        background: #4f46e5;
        transform: translateY(-2px);
    }
    
    button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    /* é¸æŠè‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯styles-modern.cssã§å®šç¾©ã•ã‚ŒãŸoption-labelã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ */
    
    /* è³ªå•ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #question-container {
        margin-bottom: 30px;
    }
    
    #question-title {
        font-size: 20px;
        font-weight: bold;
        color: #1f2937;
        margin-bottom: 10px;
    }
    
    #question-number {
        display: inline-block;
        background: #6366f1;
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
        margin-bottom: 15px;
    }
    
    /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
    .progress-bar {
        width: 100%;
        height: 8px;
        background: #e5e7eb;
        border-radius: 4px;
        margin: 20px 0;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: #6366f1;
        border-radius: 4px;
        transition: width 0.3s ease;
    }
    
    /* ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ç”¨ã®éè¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0,0,0,0);
        white-space: nowrap;
        border: 0;
    }
    
    .error-screen {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.95);
        z-index: 9999;
        justify-content: center;
        align-items: center;
    }
    
    .error-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        padding: 2rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    </style>
    
    <!-- å¿…é ˆJavaScriptï¼ˆbodyæœ«å°¾ï¼‰ -->
    <script src="assets/js/questions-unified-complete.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="js/ScreenManager.js"></script>
    <script src="js/QuestionManager.js"></script>
    <script src="js/persona-enhancer/VirtualPersonaEnhancer.js"></script>
    <script src="js/os-analyzer/os-analyzer-main.js"></script>
    <script>
        // åˆæœŸåŒ–å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ DOM Content Loaded - Starting initialization');
            
            // åˆæœŸç”»é¢çŠ¶æ…‹ã‚’ç¢ºå®Ÿã«è¨­å®š
            const welcomeScreen = document.getElementById('welcome-screen');
            const questionScreen = document.getElementById('question-screen');
            const resultsScreen = document.getElementById('results-screen');
            
            // ã™ã¹ã¦ã®ç”»é¢ã‚’éè¡¨ç¤ºã«ã™ã‚‹
            [welcomeScreen, questionScreen, resultsScreen].forEach(screen => {
                if (screen) {
                    screen.style.display = 'none';
                    screen.classList.remove('active');
                }
            });
            
            // ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢ã®ã¿ã‚’è¡¨ç¤º
            if (welcomeScreen) {
                welcomeScreen.style.display = 'block';
                welcomeScreen.classList.add('active');
                console.log('âœ… Welcome screen displayed');
            } else {
                console.error('âŒ Welcome screen not found');
            }
            
            // ScreenManagerãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            if (!window.ScreenManager) {
                console.error('ScreenManager not loaded');
                return;
            }
            
            // QuestionManagerãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            if (!window.QuestionManager) {
                console.error('QuestionManager not loaded');
                return;
            }
            
            // VirtualPersonaEnhancerãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            if (!window.VirtualPersonaEnhancer) {
                console.error('VirtualPersonaEnhancer not loaded');
                return;
            }
            
            // æ¬¡ã¸ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
             const nextBtn = document.getElementById('next-btn');
             if (nextBtn && window.QuestionManager) {
                 nextBtn.addEventListener('click', function() {
                     console.log('ğŸ”„ Next button clicked');
                     window.QuestionManager.handleNextButtonClick();
                 });
                 console.log('âœ… Next button event listener added');
             } else {
                 console.error('âŒ Next button or QuestionManager not found');
             }
             
             // å‰ã¸ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
             const prevBtn = document.getElementById('prev-btn');
             if (prevBtn && window.QuestionManager) {
                 prevBtn.addEventListener('click', function() {
                     console.log('ğŸ”„ Previous button clicked');
                     window.QuestionManager.showPreviousQuestion();
                 });
                 console.log('âœ… Previous button event listener added');
             }
             
             // åˆ†æé–‹å§‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
             const startBtn = document.getElementById('start-btn');
             if (startBtn && window.ScreenManager && window.QuestionManager) {
                 startBtn.addEventListener('click', function() {
                     console.log('ğŸš€ Start button clicked');
                     window.ScreenManager.switchTo('question');
                     window.QuestionManager.displayQuestion(0);
                 });
                 console.log('âœ… Start button event listener added');
             }
             
             console.log('âœ… OS Analyzer initialized successfully');
        });
    </script>
</body>
</html>