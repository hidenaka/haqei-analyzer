<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="HaQei Analyzer - 古代の叡智と現代のテクノロジーが融合した、深い自己洞察体験"
    />
    <title>HaQei Analyzer - 深い自己洞察への入り口</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Shippori+Mincho:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- 統合済みスタイルシート -->
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/animations.css" />
    <link rel="stylesheet" href="css/interactive-ui.css" />
    <link rel="stylesheet" href="css/strategic-dashboard.css" />
    <link rel="stylesheet" href="css/premium-integration.css" />
    <link rel="stylesheet" href="css/critical-productive-card.css" />
    <link rel="stylesheet" href="css/behavioral-insights.css" />
    <link rel="stylesheet" href="css/constellation-view.css" />
    <link rel="stylesheet" href="css/behavioral-flow-timeline.css" />
    <link rel="stylesheet" href="css/unified-design.css" />
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  </head>
  <body>
    <!-- 初期スクロール位置修正スクリプト -->
    <script>
      // ページ読み込み時に必ず上部にスクロールを設定
      window.addEventListener('load', function() {
        window.scrollTo(0, 0);
        document.documentElement.scrollTop = 0;
        document.body.scrollTop = 0;
      });
      
      // DOM読み込み完了時にも実行
      document.addEventListener('DOMContentLoaded', function() {
        window.scrollTo(0, 0);
        document.documentElement.scrollTop = 0;
        document.body.scrollTop = 0;
      });
    </script>
    
    <!-- Global Progress Indicator -->
    <div class="global-progress">
      <div class="progress-bar" style="width: var(--progress, 0%)"></div>
    </div>

    <!-- Main Application Container -->
    <div id="app" class="app-container">
      <!-- Welcome Screen -->
      <section id="welcome-container" class="screen-container">
        <!-- WelcomeScreen component will render here -->
      </section>

      <!-- Questions Flow -->
      <section
        id="questions-container"
        class="screen-container"
        style="display: none"
      >
        <!-- QuestionFlow component will render here -->
      </section>

      <!-- Analysis View -->
      <section
        id="analysis-container"
        class="screen-container"
        style="display: none"
      >
        <!-- AnalysisView component will render here -->
      </section>

      <!-- Results View -->
      <section
        id="results-container"
        class="screen-container"
        style="display: none"
      >
        <!-- ResultsView component will render here -->
      </section>

      <!-- Deep Insights Panel -->
      <section
        id="insights-container"
        class="screen-container"
        style="display: none"
      >
        <!-- InsightPanel component will render here -->
      </section>
    </div>

    <!-- Error Display Container -->
    <div id="data-manager-errors" class="error-container" style="display: none;">
      <!-- ErrorHandler will render error messages here -->
    </div>

    <!-- 🚀 Ultra Critical Path - 絶対必要最小限のみ (50KB以下目標) -->
    <script src="./js/shared/core/BaseComponent.js"></script>
    <script src="./js/shared/core/MicroStorageManager.js"></script>
    <script src="./js/shared/core/BridgeStorageManager.js"></script>
    <script src="./js/shared/core/MicroDataManager.js"></script>
    <script src="./js/shared/data/questions.js"></script>
    <script src="./js/os-analyzer/core/PrecompiledQuestions.js"></script>
    
    <!-- 🚀 Core UI - 超高速コンポーネント -->
    <script src="js/os-analyzer/components/WelcomeScreen.js"></script>
    <script src="js/os-analyzer/components/HaqeiQuestionElement.js"></script>
    <script src="js/os-analyzer/components/VirtualQuestionFlow.js"></script>
    
    <!-- ⏳ ALL OTHER SCRIPTS - 設問完了後に動的読み込み -->
    <!-- 以下は全て設問完了後またはオンデマンドで読み込み -->
    
    <!-- 🚫 全ての非必須スクリプトをオンデマンドロードに変更 -->
    <!-- これらは全てapp.jsの動的ロードに移行 -->

    <!-- Service Worker 登録 -->
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/haqei-sw.js')
          .then(registration => console.log('✅ Service Worker registered'))
          .catch(error => console.log('❌ Service Worker registration failed:', error));
      }
    </script>
    
    <!-- アプリケーション初期化 -->
    <script src="js/app.js"></script>

  </body>
</html>
