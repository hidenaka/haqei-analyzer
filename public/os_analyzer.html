<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HaQei ãƒ™ãƒ¼ã‚·ãƒƒã‚¯OSåˆ†æ V12.3</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>æ˜“</text></svg>"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&family=Shippori+Mincho:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", "Noto Sans JP", sans-serif;
      }
      .brand-text {
        background: -webkit-linear-gradient(45deg, #a5b4fc, #e0e7ff);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .prose-custom {
        color: #d1d5db;
        line-height: 1.8;
      }
      .prose-custom p {
        margin-top: 1em;
        margin-bottom: 1em;
      }
      .prose-custom strong {
        color: #facc15;
      }
      .diagnostic-item {
        background-color: rgba(31, 41, 55, 0.7);
        border: 1px solid #374151;
        border-radius: 1rem;
        padding: 1.5rem;
        backdrop-filter: blur(10px);
        margin-bottom: 2rem;
      }
      .option-label {
        display: flex;
        align-items: center;
        text-align: left;
        padding: 0.75rem 1rem;
        border: 1px solid #4b5563;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
        height: 100%;
        background-color: #374151;
        font-size: 0.875rem;
        line-height: 1.5;
      }
      .option-label:hover {
        background-color: #4b5563;
        border-color: #6366f1;
      }
      input[type="radio"]:checked + .option-label {
        border-color: #a5b4fc;
        background-color: #4338ca;
        box-shadow: 0 0 10px rgba(165, 180, 252, 0.4);
      }
      .report-section h3,
      .report-section h4 {
        font-family: "Shippori Mincho", serif;
      }

      .energy-card {
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.75rem;
        cursor: pointer;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 1.25rem;
        background-color: #1f2937;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2), 0 1px 3px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
        min-height: 200px;
      }
      .energy-card::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle at 30% 107%,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0) 40%
        );
        transform: rotate(0deg);
        transition: transform 0.5s ease-out, opacity 0.5s ease-out;
        opacity: 0;
        z-index: 1;
      }

      .energy-card:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.4);
        border-color: rgba(255, 255, 255, 0.2);
      }
      .energy-card:hover::before {
        opacity: 1;
        transform: rotate(15deg);
      }
      .energy-card.selected {
        border-color: #facc15;
        box-shadow: 0 0 25px rgba(250, 204, 21, 0.4),
          0 0 0 2px rgba(250, 204, 21, 0.7);
        transform: translateY(-5px) scale(1.05);
        background-color: #374151;
      }
      .card-content {
        position: relative;
        z-index: 2;
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      .energy-card-header {
        text-align: left;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      .energy-card-header .archetype-icon {
        font-size: 1.75rem;
        line-height: 1;
      }
      .energy-card-header .archetype-name {
        font-family: "Shippori Mincho", serif;
        font-weight: 700;
        font-size: 1.125rem;
      }
      .energy-card-body {
        font-size: 0.8rem;
        line-height: 1.6;
        color: #d1d5db;
        margin-top: 0.75rem;
        flex-grow: 1;
      }
      .energy-card-footer {
        text-align: center;
        font-size: 0.7rem;
        font-weight: 500;
        color: #9ca3af;
        margin-top: 0.75rem;
        padding-top: 0.5rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }
      .lock-in-btn:hover {
        transform: scale(1.05);
      }
      /* ä¾¡å€¤è¦³é¸æŠã‚«ãƒ¼ãƒ‰ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      .value-proposition-card {
        background-color: #1f2937;
        border: 1px solid #374151;
        border-radius: 0.5rem;
        padding: 1.25rem;
        transition: all 0.2s ease-in-out;
        cursor: pointer;
      }
      .value-proposition-card:hover {
        background-color: #374151;
        border-color: #818cf8;
      }
      .value-proposition-card.selected-for-lock-in {
        background-color: #4d7c0f; /* locked-in color */
        border-color: #a3e635;
        box-shadow: 0 0 15px rgba(163, 230, 53, 0.4);
      }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-200 min-h-screen p-4 sm:p-6">
    <div
      class="w-full max-w-4xl mx-auto bg-gray-800 shadow-2xl rounded-2xl p-6 sm:p-10"
    >
      <header class="text-center mb-10">
        <a
          href="./"
          class="text-indigo-400 hover:text-indigo-300 mb-4 inline-block text-sm"
          >â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹</a
        >
        <h1 class="text-3xl sm:text-4xl font-bold brand-text tracking-wider">
          ãƒ™ãƒ¼ã‚·ãƒƒã‚¯OSåˆ†æ
        </h1>
        <p class="text-gray-400 mt-2">
          ã‚ãªãŸã¨ã„ã†å­˜åœ¨ã®æ ¸ã¨ãªã‚‹ã€3ã¤ã®äººæ ¼OSã‚’ç‰¹å®šã—ã¾ã™ã€‚
        </p>
      </header>
      <div id="diagnostic-container"></div>
    </div>

    <script type="module">
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          const response = await fetch("/api/data");
          if (!response.ok)
            throw new Error("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
          const { HAQEI_DATA } = await response.json();
          const HDB = HAQEI_DATA;
          if (
            !HDB ||
            !HDB.TRIGRAM_INTERACTIONS ||
            !HDB.os_manual ||
            !HDB.bible
          ) {
            throw new Error("å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä¸€éƒ¨ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚");
          }
          const TRIGRAM_INTERACTIONS = HDB.TRIGRAM_INTERACTIONS;

          const diagnosticContainer = document.getElementById(
            "diagnostic-container"
          );
          let lockedEngineOs = null;

          const WORLDVIEW_QUESTIONS = [
            {
              id: "wvq1",
              text: "ãƒãƒ¼ãƒ ã‚’ç‡ã„ã‚‹æ™‚ã€ã‚ãªãŸã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯ï¼Ÿ",
              options: [
                {
                  text: "æ˜ç¢ºãªãƒ“ã‚¸ãƒ§ãƒ³ã¨å¼·ã„ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã§ã€è‡ªã‚‰å…ˆé ­ã«ç«‹ã£ã¦å…¨ä½“ã‚’å¼•ã£å¼µã£ã¦ã„ãã€‚",
                  scores: { 1: 2 },
                },
                {
                  text: "ãƒ¡ãƒ³ãƒãƒ¼ä¸€äººã²ã¨ã‚Šã®æ„è¦‹ã«è€³ã‚’å‚¾ã‘ã€çš†ãŒèƒ½åŠ›ã‚’ç™ºæ®ã§ãã‚‹åœŸå°ã‚„ç’°å¢ƒã‚’æ•´ãˆã‚‹ã€‚",
                  scores: { 8: 2 },
                },
              ],
            },
            {
              id: "wvq2",
              text: "è¤‡é›‘ã§ã€ç­”ãˆã®ãªã„å•é¡Œã«ç›´é¢ã—ãŸæ™‚ã€ã©ã†ã™ã‚‹ï¼Ÿ",
              options: [
                {
                  text: "ã¾ãšæƒ…å ±ã‚’é›†ã‚ã€è«–ç†çš„ã«åˆ†æã™ã‚‹ã“ã¨ã§ã€å•é¡Œã®æ§‹é€ ã‚„æœ¬è³ªã‚’æ˜ã‚‰ã‹ã«ã™ã‚‹ã€‚",
                  scores: { 3: 2 },
                },
                {
                  text: "ç„¦ã‚‰ãšã€å›°é›£ãªçŠ¶æ³ã‚’è€ãˆãªãŒã‚‰ã€ç‰©äº‹ã®çœŸç†ã‚„æ ¸å¿ƒãŒè¦‹ãˆã¦ãã‚‹ã®ã‚’å¾…ã¤ã€‚",
                  scores: { 6: 2 },
                },
              ],
            },
            {
              id: "wvq3",
              text: "ãƒãƒ¼ãƒ ãŒåœæ»ã—ã€æ´»æ°—ã‚’å¤±ã£ã¦ã„ã‚‹æ™‚ã€ã©ã†ã™ã‚‹ï¼Ÿ",
              options: [
                {
                  text: "ã¾ãšã€ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã®ã‚ã‚‹ã€Œè¡Œå‹•ã€ã‚’èµ·ã“ã™ã“ã¨ã§ã€åœæ»ã—ãŸç©ºæ°—ã‚’æ‰“ã¡ç ´ã‚Šã€ãƒãƒ¼ãƒ ã«åˆºæ¿€ã‚’ä¸ãˆã‚‹ã€‚",
                  scores: { 4: 2 },
                },
                {
                  text: "ã¾ãšã€ãªãœåœæ»ã—ã¦ã„ã‚‹ã®ã‹ã€ãã®æ ¹æœ¬åŸå› ã‚’ä¸€äººã§é™ã‹ã«è€ƒãˆã€å†…çœã™ã‚‹æ™‚é–“ã‚’ã¨ã‚‹ã€‚",
                  scores: { 7: 2 },
                },
              ],
            },
            {
              id: "wvq4",
              text: "æ–°ã—ã„äººã¨ã®é–¢ä¿‚ã‚’ç¯‰ãæ™‚ã€ã‚ãªãŸã®å¾—æ„ãªæ–¹æ³•ã¯ï¼Ÿ",
              options: [
                {
                  text: "ç›¸æ‰‹ã®å¿ƒã«å¯„ã‚Šæ·»ã„ã€ä¸å¯§ãªå¯¾è©±ã‚’é‡ã­ã‚‹ã“ã¨ã§ã€æ™‚é–“ã‚’ã‹ã‘ã¦å¾ã€…ã«ä¿¡é ¼ã‚’æµ¸é€ã•ã›ã¦ã„ãã€‚",
                  scores: { 5: 2 },
                },
                {
                  text: "ãƒ¦ãƒ¼ãƒ¢ã‚¢ã‚’äº¤ãˆã€å–œã³ã‚„æ¥½ã—ã¿ã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã«åˆ†ã‹ã¡åˆã†ã“ã¨ã§ã€ä¸€æ°—ã«å¿ƒã®è·é›¢ã‚’ç¸®ã‚ã‚‹ã€‚",
                  scores: { 2: 2 },
                },
              ],
            },
            {
              id: "wvq5",
              text: "ã‚ãªãŸã¯ã©ã¡ã‚‰ã‹ã¨è¨€ãˆã°â€¦",
              options: [
                {
                  text: "å¤§ããªå¤‰é©ã‚’ä¸»å°ã™ã‚‹ã‚¿ã‚¤ãƒ—ã ã€‚",
                  scores: { 49: 1 },
                },
                {
                  text: "å®‰å®šã—ãŸæ–‡åŒ–ã‚„çµ„ç¹”ã‚’è‚²ã‚€ã‚¿ã‚¤ãƒ—ã ã€‚",
                  scores: { 50: 1 },
                },
              ],
            },
          ];

          const SCENARIO_QUESTIONS = [
            {
              id: "q1",
              scenario:
                "å‹äººãŸã¡ã¨ã®æ¥½ã—ã„æ—…è¡Œè¨ˆç”»ãŒã€äºˆæœŸã›ã¬ãƒˆãƒ©ãƒ–ãƒ«ã§å®Œå…¨ã«ç™½ç´™ã«æˆ»ã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚",
              inner_q:
                "ã“ã®æ™‚ã€ã‚ãªãŸã®ã€Œå¿ƒã®ä¸­ã€ã§ã€æœ€åˆã«å¼·ãæ¹§ãä¸ŠãŒã‚‹æ„Ÿæƒ…ã‚„æ€è€ƒã¯ï¼Ÿ",
              outer_q: "ãã—ã¦ã€ã‚ãªãŸãŒã€Œå®Ÿéš›ã«ã¨ã‚‹è¡Œå‹•ã€ã«ã€æœ€ã‚‚è¿‘ã„ã®ã¯ï¼Ÿ",
              options: {
                inner: [
                  {
                    text: "ã€Œæ®‹å¿µã™ãã‚‹â€¦ã€ã¨ã„ã†å–ªå¤±æ„Ÿã‚„æ‚²ã—ã¿ã«æ²ˆã‚€",
                    scores: { 2: -2, 6: 2, 7: 1 },
                  },
                  {
                    text: "ã€Œãªãœã“ã†ãªã£ãŸï¼Ÿã€ã¨åŸå› ã‚’åˆ†æã—ã€çŠ¶æ³ã‚’çŸ¥çš„ã«ç†è§£ã—ã‚ˆã†ã¨ã™ã‚‹",
                    scores: { 3: 2, 7: 1, 8: -1 },
                  },
                  {
                    text: "ã€Œã¾ã‚ä»•æ–¹ãªã„ã€æ¬¡ã©ã†ã™ã‚‹ã‹è€ƒãˆã‚ˆã†ã€ã¨ã€ã™ãã«æ°—æŒã¡ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹",
                    scores: { 4: 2, 1: 1, 6: -1 },
                  },
                ],
                outer: [
                  {
                    text: "ã€Œç§ãŒæ–°ã—ã„è¨ˆç”»ã‚’ç«‹ã¦ã‚‹ï¼ã€ã¨ç‡å…ˆã—ã¦ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã™ã‚‹",
                    scores: { 1: 3, 4: 1, 8: -2 },
                  },
                  {
                    text: "ã€Œçš†ãŒã£ã‹ã‚Šã—ã¦ã‚‹ã ã‚ã†ã€ã¨ã€ã¾ãšãƒ¡ãƒ³ãƒãƒ¼ã®ã‚±ã‚¢ã‚„æ…°ã‚ã‚’å„ªå…ˆã™ã‚‹",
                    scores: { 8: 2, 5: 2, 1: -1 },
                  },
                  {
                    text: "ä¸€æ—¦ã€Œã©ã†ã™ã‚‹ã‹ã¯ã€ã¾ãŸå¾Œã§è€ƒãˆã‚ˆã†ã€ã¨ã€çŠ¶æ³ã‚’é™è¦³ã™ã‚‹",
                    scores: { 7: 3, 6: 1, 4: -2 },
                  },
                ],
              },
            },
            {
              id: "q2",
              scenario:
                "ã‚ãªãŸã¯å…¨ãæ–°ã—ã„åˆ†é‡ã®ã‚¹ã‚­ãƒ«ã‚’ã€ã‚¼ãƒ­ã‹ã‚‰å­¦ã¶ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚",
              inner_q:
                "ã“ã®æ™‚ã€ã‚ãªãŸã®ã€Œå¿ƒã®ä¸­ã€ã§ã€æœ€åˆã«å¼·ãæ¹§ãä¸ŠãŒã‚‹æ„Ÿæƒ…ã‚„æ€è€ƒã¯ï¼Ÿ",
              outer_q: "ãã—ã¦ã€ã‚ãªãŸãŒã€Œå®Ÿéš›ã«ã¨ã‚‹å­¦ã³æ–¹ã€ã«ã€æœ€ã‚‚è¿‘ã„ã®ã¯ï¼Ÿ",
              options: {
                inner: [
                  {
                    text: "ã€Œé¢ç™½ãã†ï¼ã€ã¨ã„ã†å¥½å¥‡å¿ƒã¨ã€æ–°ã—ã„è‡ªåˆ†ã«ãªã‚Œã‚‹ã“ã¨ã¸ã®æœŸå¾…æ„Ÿ",
                    scores: { 4: 2, 3: 2, 7: -1 },
                  },
                  {
                    text: "ã€Œæœ¬å½“ã«è‡ªåˆ†ã«ã§ãã‚‹ã ã‚ã†ã‹â€¦ã€ã¨ã„ã†ä¸å®‰ã¨ã€å¤±æ•—ã¸ã®æã‚Œ",
                    scores: { 6: 2, 7: 1, 1: -2 },
                  },
                  {
                    text: "ã€Œã©ã†ã›ã‚„ã‚‹ãªã‚‰å®Œç’§ã«ã€ã¨ã„ã†ã€çŸ¥çš„ãªæ¢æ±‚å¿ƒã¨å‘ä¸Šå¿ƒ",
                    scores: { 1: 2, 6: 1, 2: -1 },
                  },
                ],
                outer: [
                  {
                    text: "ã¾ãšå…¨ä½“åƒã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã€é–¢é€£æ›¸ç±ã‚’ä½•å†Šã‚‚èª­ã‚“ã§ä½“ç³»çš„ã«å­¦ã¶",
                    scores: { 7: 2, 3: 1, 4: -1 },
                  },
                  {
                    text: "ã¨ã«ã‹ãå®Ÿè·µï¼å°‚é–€å®¶ã‚„çµŒé¨“è€…ã«ç©æ¥µçš„ã«è³ªå•ã—ã€è©¦è¡ŒéŒ¯èª¤ã—ãªãŒã‚‰å­¦ã¶",
                    scores: { 4: 3, 2: 1, 7: -2 },
                  },
                  {
                    text: "åŒã˜ç›®æ¨™ã‚’æŒã¤ä»²é–“ã‚’è¦‹ã¤ã‘ã€å‹‰å¼·ä¼šã‚’é–‹ããªã©ã€å”èª¿ã—ãªãŒã‚‰å­¦ã¶",
                    scores: { 5: 2, 8: 2, 1: -1 },
                  },
                ],
              },
            },
          ];

          function showIntro() {
            diagnosticContainer.innerHTML = `<div class="text-center bg-gray-900/50 p-6 rounded-xl prose-custom max-w-none text-gray-300"><p class="text-lg">ã‚ˆã†ã“ãã€‚ã“ã‚Œã‹ã‚‰ã€ã‚ãªãŸã ã‘ã®ã€ŒOSè¨­è¨ˆå›³ã€ã‚’å‰µã‚‹ãŸã‚ã®ã€å¯¾è©±ã‚’å§‹ã‚ã¾ã™ã€‚</p><p class="mt-6">HaQeiã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã¯ã€3ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã€ã‚ãªãŸã®é­‚ã®è¨­è¨ˆå›³ã‚’å…±åŒã§æ§‹ç¯‰ã—ã¾ã™ã€‚</p><div class="grid md:grid-cols-3 gap-6 my-6 text-left"><div class="bg-gray-800/70 p-4 rounded-lg border border-gray-700"><h4 class="font-bold text-amber-300 flex items-center"><span class="text-xl mr-2">1</span>ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®å¯è¦–åŒ–</h4><p class="text-xs mt-2">ã¾ãšã€ã„ãã¤ã‹ã®å•ã„ã‹ã‚‰ã€ã‚ãªãŸã®æ ¸ã¨ãªã‚‹8ã¤ã®åŸºæœ¬ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®ãƒãƒ©ãƒ³ã‚¹ã‚’AIãŒåˆ†æã—ã¾ã™ã€‚</p></div><div class="bg-gray-800/70 p-4 rounded-lg border border-gray-700"><h4 class="font-bold text-indigo-300 flex items-center"><span class="text-xl mr-2">2</span>ã‚³ã‚¢ã®é¸æŠ</h4><p class="text-xs mt-2">æ¬¡ã«ã€æç¤ºã•ã‚ŒãŸ8ã¤ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®ä¸­ã‹ã‚‰ã€ã‚ãªãŸã®æ„Ÿè¦šã«æœ€ã‚‚è¿‘ã„<strong class="text-white">ã€Œã‚³ã‚¢ãƒ»ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ã€ã‚’2ã¤ã¾ãŸã¯3ã¤ã€ã‚ãªãŸè‡ªèº«ãŒé¸æŠ</strong>ã—ã¾ã™ã€‚</p></div><div class="bg-gray-800/70 p-4 rounded-lg border border-gray-700"><h4 class="font-bold text-green-300 flex items-center"><span class="text-xl mr-2">3</span>OSã®å…±åŒæ§‹ç¯‰</h4><p class="text-xs mt-2">ã‚ãªãŸã®é¸æŠã‚’åŸºã«ã€AIãŒã‚ãªãŸã ã‘ã®OSã‚’å…±åŒã§æ§‹ç¯‰ã—ã€<strong class="text-white">æˆ¦ç•¥ãƒ¬ãƒãƒ¼ãƒˆ</strong>ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p></div></div><p>ã‚ãªãŸã®æ„Ÿè¦šã“ããŒã€æœ€ã‚‚ä¿¡é ¼ã§ãã‚‹ç¾…é‡ç›¤ã§ã™ã€‚ã©ã†ãã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦ã€å¯¾è©±ã‚’æ¥½ã—ã‚“ã§ãã ã•ã„ã€‚</p></div><div class="mt-8 pt-8 border-t border-gray-700 text-center"><button id="startBtn" class="w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-300 transform hover:scale-105">å¯¾è©±ã‚’é–‹å§‹ã™ã‚‹</button></div>`;
            document
              .getElementById("startBtn")
              .addEventListener("click", showWorldviewQuestions);
          }

          function showWorldviewQuestions() {
            let html = `<h3 class="text-xl font-bold text-amber-300 mb-6 text-center">Step 1ï¼šã‚ãªãŸã®ä¾¡å€¤è¦³ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„</h3>`;
            WORLDVIEW_QUESTIONS.forEach((q, index) => {
              const worldviewOpts = q.options
                .map(
                  (opt, i) =>
                    `<div><input type="radio" name="${q.id}" value="${i}" id="${q.id}_${i}" class="hidden"><label for="${q.id}_${i}" class="option-label">${opt.text}</label></div>`
                )
                .join("");
              html += `<div class="diagnostic-item worldview-item"><div class="question-block"><p class="question-text">${
                index + 1
              }. ${
                q.text
              }</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">${worldviewOpts}</div></div></div>`;
            });
            html += `<div class="mt-8 text-center"><button id="analyzeEnergyBtn" class="w-full sm:w-auto bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-300">ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒãƒ©ãƒ³ã‚¹ã‚’åˆ†æã™ã‚‹</button></div>`;
            diagnosticContainer.innerHTML = html;
            document
              .getElementById("analyzeEnergyBtn")
              .addEventListener("click", handleEnergyAnalysis);
          }

          function handleEnergyAnalysis() {
            let allAnswered = true;
            WORLDVIEW_QUESTIONS.forEach((q) => {
              if (!document.querySelector(`input[name="${q.id}"]:checked`)) {
                allAnswered = false;
              }
            });
            if (!allAnswered) {
              alert("ã™ã¹ã¦ã®è³ªå•ã«å›ç­”ã—ã¦ãã ã•ã„ã€‚");
              return;
            }
            const trigramScores = runTrigramAnalysis();
            showEnergyVisualizationAndSelection(trigramScores);
          }

          function runTrigramAnalysis() {
            const scores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0 };
            WORLDVIEW_QUESTIONS.forEach((q) => {
              const node = document.querySelector(
                `input[name="${q.id}"]:checked`
              );
              if (node) {
                const choice = q.options[node.value];
                for (const id in choice.scores) {
                  scores[id] = (scores[id] || 0) + choice.scores[id];
                }
              }
            });
            return scores;
          }

          function getTrigramStylingAndArchetype(trigramId) {
            const data = {
              1: { archetype: "ãƒªãƒ¼ãƒ€ãƒ¼", icon: "ğŸ‘‘" },
              2: { archetype: "ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒŠãƒ¼", icon: "ğŸ‰" },
              3: { archetype: "ã‚¢ãƒŠãƒªã‚¹ãƒˆ", icon: "ğŸ”¬" },
              4: { archetype: "ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼", icon: "âš¡ï¸" },
              5: { archetype: "ãƒãƒ¼ãƒ¢ãƒŠã‚¤ã‚¶ãƒ¼", icon: "ğŸŒ¿" },
              6: { archetype: "ã‚·ãƒ¼ã‚«ãƒ¼", icon: "ğŸŒŠ" },
              7: { archetype: "ãƒ“ãƒ«ãƒ€ãƒ¼", icon: "ğŸ”ï¸" },
              8: { archetype: "ã‚µãƒãƒ¼ã‚¿ãƒ¼", icon: "ğŸŒ" },
            };
            return data[trigramId] || { archetype: "ä¸æ˜", icon: "â“" };
          }

          function renderRadarChart(trigramScores) {
            const canvasElement = document.getElementById("energyRadarChart");
            if (!canvasElement) return;
            const existingChart = Chart.getChart(canvasElement);
            if (existingChart) existingChart.destroy();

            const ctx = canvasElement.getContext("2d");
            const chartData = { labels: [], scores: [] };

            HDB.trigrams_master
              .slice()
              .sort((a, b) => a.trigram_id - b.trigram_id)
              .forEach((trigram) => {
                if (trigram) {
                  chartData.labels.push(
                    `${trigram.name_jp} (${trigram.name_en})`
                  );
                  chartData.scores.push(trigramScores[trigram.trigram_id] || 0);
                }
              });

            new Chart(ctx, {
              type: "radar",
              data: {
                labels: chartData.labels,
                datasets: [
                  {
                    label: "ã‚¨ãƒãƒ«ã‚®ãƒ¼å¼·åº¦",
                    data: chartData.scores,
                    fill: true,
                    backgroundColor: "rgba(165, 180, 252, 0.2)",
                    borderColor: "#a5b4fc",
                    pointBackgroundColor: "#a5b4fc",
                    pointBorderColor: "#fff",
                    pointHoverBackgroundColor: "#fff",
                    pointHoverBorderColor: "#a5b4fc",
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                  r: {
                    angleLines: { color: "rgba(255, 255, 255, 0.2)" },
                    grid: { color: "rgba(255, 255, 255, 0.2)" },
                    pointLabels: { font: { size: 12 }, color: "#e5e7eb" },
                    ticks: {
                      color: "rgba(255,255,255,0.7)",
                      backdropColor: "rgba(0,0,0,0)",
                    },
                    suggestedMin: 0,
                  },
                },
                plugins: { legend: { display: false } },
              },
            });
          }

          function showEnergyVisualizationAndSelection(trigramScores) {
            let html = `
                <div class="text-center">
                  <h3 class="text-xl font-bold text-indigo-300 mb-4">Step 2ï¼šã‚ãªãŸã®ã‚³ã‚¢ãƒ»ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
                  <div class="bg-gray-900/50 p-6 rounded-xl prose-custom max-w-none text-gray-300">
                    <p>ã¾ãšã€ã‚ãªãŸã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒãƒ©ãƒ³ã‚¹ã®å…¨ä½“åƒã‚’ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã§è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã¯ã‚ãªãŸã®æ€è€ƒã‚„è¡Œå‹•ã®å‚¾å‘ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚</p>
                    <div class="relative mx-auto my-6" style="height: 350px; max-width: 450px;">
                        <canvas id="energyRadarChart"></canvas>
                    </div>
                    <p>æ¬¡ã«ã€ã“ã®åˆ†æçµæœã¨ã”è‡ªèº«ã®æ„Ÿè¦šã‚’é ¼ã‚Šã«ã€8ã¤ã®ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ã®ä¸­ã‹ã‚‰ã€<strong>ã€Œã“ã‚Œã“ããŒè‡ªåˆ†ã‚’å‹•ã‹ã™ä¸­å¿ƒçš„ãªåŠ›ã ã€</strong>ã¨æœ€ã‚‚å¼·ãå…±æ„Ÿã™ã‚‹ã‚‚ã®ã‚’ã€<strong>2ã¤ã¾ãŸã¯3ã¤</strong>é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                  </div>
                  <div id="core-selection-wrapper" class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">`;

            HDB.trigrams_master.forEach((trigram) => {
              const { archetype, icon } = getTrigramStylingAndArchetype(
                trigram.trigram_id
              );
              const desc = trigram.strength_description || "è§£èª¬æº–å‚™ä¸­";
              const keywords = trigram.keywords || "ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æœªè¨­å®š";

              html += `
                    <div id="card-${trigram.trigram_id}" data-id="${trigram.trigram_id}" class="energy-card">
                       <div class="card-content">
                          <div class="energy-card-header">
                              <span class="archetype-icon">${icon}</span>
                              <span class="archetype-name">${archetype}</span>
                          </div>
                          <div class="energy-card-body">
                              <p>${desc}</p>
                          </div>
                          <div class="energy-card-footer">
                            <span>${keywords}</span>
                          </div>
                       </div>
                    </div>`;
            });
            html += `</div>`;
            html += `<div id="candidate-preview" class="mt-8 transition-opacity duration-500 opacity-0"></div>`;
            diagnosticContainer.innerHTML = html;

            renderRadarChart(trigramScores);

            document.querySelectorAll(".energy-card").forEach((card) => {
              card.addEventListener("click", () => {
                const selectedCount = document.querySelectorAll(
                  ".energy-card.selected"
                ).length;
                if (card.classList.contains("selected")) {
                  card.classList.remove("selected");
                } else if (selectedCount < 3) {
                  card.classList.add("selected");
                }
                updateCandidatePreview(trigramScores);
              });
            });
          }

          function updateCandidatePreview(trigramScores) {
            const selectedCards = document.querySelectorAll(
              ".energy-card.selected"
            );
            const selectedCores = Array.from(selectedCards).map((c) =>
              parseInt(c.dataset.id)
            );
            const previewContainer =
              document.getElementById("candidate-preview");

            if (selectedCores.length < 2) {
              previewContainer.classList.add("opacity-0");
              setTimeout(() => {
                previewContainer.innerHTML = "";
              }, 500);
              return;
            }

            const candidates = [];
            const processedPairs = new Set();

            const addCandidatesForPair = (id1, id2) => {
              const pairKey = [id1, id2].sort().join("-");
              if (processedPairs.has(pairKey)) return;

              const os1 = HDB.hexagrams_master.find(
                (hex) =>
                  hex.upper_trigram_id === id1 && hex.lower_trigram_id === id2
              );
              if (
                os1 &&
                !candidates.some((c) => c.hexagram_id === os1.hexagram_id)
              )
                candidates.push(os1);

              const os2 = HDB.hexagrams_master.find(
                (hex) =>
                  hex.upper_trigram_id === id2 && hex.lower_trigram_id === id1
              );
              if (
                os2 &&
                !candidates.some((c) => c.hexagram_id === os2.hexagram_id)
              )
                candidates.push(os2);

              processedPairs.add(pairKey);
            };

            if (selectedCores.length === 2) {
              addCandidatesForPair(selectedCores[0], selectedCores[1]);
            } else if (selectedCores.length === 3) {
              addCandidatesForPair(selectedCores[0], selectedCores[1]);
              addCandidatesForPair(selectedCores[0], selectedCores[2]);
              addCandidatesForPair(selectedCores[1], selectedCores[2]);
            }

            let previewHtml = `<div class="bg-gray-900/50 p-6 rounded-xl"><h4 class="text-lg font-bold text-amber-300 mb-4">ã‚ãªãŸã®ä¾¡å€¤è¦³ã¯ã€ã©ã¡ã‚‰ã«è¿‘ã„ã§ã™ã‹ï¼Ÿ</h4><p class="text-sm text-gray-400 mb-4">ã‚ãªãŸã®é¸æŠã‹ã‚‰ã€ä»¥ä¸‹ã®OSã®ã€Œä¾¡å€¤è¦³ã€ãŒã‚¨ãƒ³ã‚¸ãƒ³å€™è£œã¨ã—ã¦ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚æœ€ã‚‚ã€Œã“ã‚Œã“ããŒè‡ªåˆ†ã‚’å‹•ã‹ã™ä¸­å¿ƒçš„ãªåŠ›ã ã€ã¨ç´å¾—ã§ãã‚‹ã‚‚ã®ã‚’1ã¤é¸ã³ã€ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚</p><div class="space-y-4">`;
            if (candidates.length > 0) {
              candidates.forEach((os) => {
                const osManual = HDB.os_manual[os.hexagram_id] || {};
                previewHtml += `<div class="value-proposition-card" data-os-id="${
                  os.hexagram_id
                }">
                                  <p class="font-semibold text-indigo-300 text-base">${
                                    osManual.summary || os.catchphrase
                                  }</p>
                                </div>`;
              });
            } else {
              previewHtml += `<p class="text-gray-400">æœ‰åŠ¹ãªOSã®çµ„ã¿åˆã‚ã›ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚2ã¤ã¾ãŸã¯3ã¤ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>`;
            }
            previewHtml += `</div></div>`;
            previewContainer.innerHTML = previewHtml;
            setTimeout(() => {
              previewContainer.classList.remove("opacity-0");
            }, 10);

            document
              .querySelectorAll(".value-proposition-card")
              .forEach((button) => {
                button.addEventListener("click", (e) => {
                  const selectedId = parseInt(e.currentTarget.dataset.osId, 10);
                  lockedEngineOs = HDB.hexagrams_master.find(
                    (os) => os.hexagram_id === selectedId
                  );

                  // UIãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                  document
                    .querySelectorAll(".value-proposition-card")
                    .forEach((c) => c.classList.remove("selected-for-lock-in"));
                  e.currentTarget.classList.add("selected-for-lock-in");

                  // 2æ®µéšç›®ã®è¨ºæ–­ã¸é€²ã‚€
                  showScenarioQuestions(trigramScores);
                });
              });
          }

          function showScenarioQuestions(trigramScores) {
            let html = `<h3 class="text-xl font-bold text-indigo-300 mb-6 text-center">Step 3ï¼šã‚ãªãŸã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„</h3>`;
            SCENARIO_QUESTIONS.forEach((q, index) => {
              const innerOpts = q.options.inner
                .map(
                  (opt, i) =>
                    `<div><input type="radio" name="${q.id}_inner" value="${i}" id="${q.id}_inner_${i}" class="hidden"><label for="${q.id}_inner_${i}" class="option-label">${opt.text}</label></div>`
                )
                .join("");
              const outerOpts = q.options.outer
                .map(
                  (opt, i) =>
                    `<div><input type="radio" name="${q.id}_outer" value="${i}" id="${q.id}_outer_${i}" class="hidden"><label for="${q.id}_outer_${i}" class="option-label">${opt.text}</label></div>`
                )
                .join("");
              html += `<div class="diagnostic-item"><p class="text-gray-400 text-sm">ã‚·ãƒŠãƒªã‚ª ${
                index + 1
              }/${
                SCENARIO_QUESTIONS.length
              }</p><p class="font-semibold text-gray-200 mb-4">${
                q.scenario
              }</p><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="question-block"><p class="question-text">${
                q.inner_q
              }</p><div class="space-y-3">${innerOpts}</div></div><div class="question-block"><p class="question-text">${
                q.outer_q
              }</p><div class="space-y-3">${outerOpts}</div></div></div></div>`;
            });
            html += `<div class="mt-8 pt-8 border-t border-gray-700"><button id="finalAnalyzeBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-300 transform hover:scale-105">æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹</button></div>`;
            diagnosticContainer.innerHTML = html;
            document
              .getElementById("finalAnalyzeBtn")
              .addEventListener("click", () =>
                handleFinalAnalysis(trigramScores)
              );
          }

          function handleFinalAnalysis(baseScores) {
            let allAnswered = true;
            SCENARIO_QUESTIONS.forEach((q) => {
              if (
                !document.querySelector(
                  `input[name="${q.id}_inner"]:checked`
                ) ||
                !document.querySelector(`input[name="${q.id}_outer"]:checked`)
              ) {
                allAnswered = false;
              }
            });
            if (!allAnswered) {
              alert("ã™ã¹ã¦ã®ã‚·ãƒŠãƒªã‚ªã«å›ç­”ã—ã¦ãã ã•ã„ã€‚");
              return;
            }

            const finalTrigramScores = { ...baseScores };
            SCENARIO_QUESTIONS.forEach((q) => {
              const innerNode = document.querySelector(
                `input[name="${q.id}_inner"]:checked`
              );
              const outerNode = document.querySelector(
                `input[name="${q.id}_outer"]:checked`
              );
              if (innerNode && outerNode) {
                const innerChoice = q.options.inner[innerNode.value];
                const outerChoice = q.options.outer[outerNode.value];
                for (const id in innerChoice.scores) {
                  finalTrigramScores[id] =
                    (finalTrigramScores[id] || 0) + innerChoice.scores[id];
                }
                for (const id in outerChoice.scores) {
                  finalTrigramScores[id] =
                    (finalTrigramScores[id] || 0) + outerChoice.scores[id];
                }
              }
            });

            const hexagramRanking = HDB.hexagrams_master
              .map((hex) => {
                const upperId = hex.upper_trigram_id;
                const lowerId = hex.lower_trigram_id;
                const score =
                  (finalTrigramScores[upperId] || 0) +
                  (finalTrigramScores[lowerId] || 0);
                return { ...hex, score };
              })
              .sort((a, b) => b.score - a.score);

            const candidates = hexagramRanking.filter(
              (os) => os.hexagram_id !== lockedEngineOs.hexagram_id
            );
            const interfaceOs =
              candidates[0] ||
              HDB.hexagrams_master.find(
                (h) => h.hexagram_id !== lockedEngineOs.hexagram_id
              );
            const safemodeOs =
              candidates[1] ||
              HDB.hexagrams_master.find(
                (h) =>
                  h.hexagram_id !== lockedEngineOs.hexagram_id &&
                  h.hexagram_id !== interfaceOs.hexagram_id
              );

            displayReport({
              engineOs: lockedEngineOs,
              interfaceOs,
              safemodeOs,
            });
          }

          function displayReport(analysisResult) {
            const { engineOs, interfaceOs, safemodeOs } = analysisResult;
            diagnosticContainer.innerHTML = "";
            const triadName = generateTriadName(
              engineOs,
              interfaceOs,
              safemodeOs
            );
            const strategySummary = generateStrategySummary(
              engineOs,
              interfaceOs,
              safemodeOs
            );
            const osSectionHtml = (os, type) => {
              const osManual = HDB.os_manual[os.hexagram_id] || {};
              return `<div class="p-5 rounded-xl shadow-lg flex flex-col bg-gray-900/50 border border-gray-700"><h4 class="text-lg font-bold text-indigo-300 flex items-center mb-2"><span class="text-2xl mr-2">${
                type.icon
              }</span>${type.title}ï¼š${
                os.name_jp
              }</h4><p class="text-gray-400">${
                os.catchphrase
              }</p><p class="prose-custom text-sm mt-2">${
                osManual.summary || "è©³ç´°ãªèª¬æ˜ã¯æº–å‚™ä¸­ã§ã™ã€‚"
              }</p></div>`;
            };
            diagnosticContainer.innerHTML = `<div class="report-container text-center space-y-12"><div class="report-section"><h3 class="text-3xl font-bold text-indigo-300">ã‚ãªãŸã®OSä¸‰ä½ä¸€ä½“ï¼ˆãƒˆãƒªã‚¢ãƒƒãƒ‰ï¼‰ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹</h3><p class="mt-4 text-gray-300 max-w-2xl mx-auto">ã‚ãªãŸã®å›ç­”ã‹ã‚‰ã€äººæ ¼ã‚’å½¢æˆã™ã‚‹3ã¤ã®OSã®åŠ›å­¦ï¼ˆãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹ï¼‰ãŒæ˜ã‚‰ã‹ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯ã€ã‚ãªãŸã¨ã„ã†å”¯ä¸€ç„¡äºŒã®ã‚·ã‚¹ãƒ†ãƒ ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®ã€æˆ¦ç•¥çš„ãªè¨­è¨ˆå›³ã§ã™ã€‚</p><p class="text-lg font-bold brand-text mt-4">${triadName}</p></div><div class="space-y-8 text-left"><div class="p-6 bg-gray-900/50 rounded-xl border-t-4 border-amber-400">${osSectionHtml(
              engineOs,
              { icon: "ğŸ”¥", title: "ã‚¨ãƒ³ã‚¸ãƒ³OS" }
            )}</div><div class="p-6 bg-gray-900/50 rounded-xl border-t-4 border-indigo-400">${osSectionHtml(
              interfaceOs,
              { icon: "ğŸ­", title: "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹OS" }
            )}</div><div class="p-6 bg-gray-900/50 rounded-xl border-t-4 border-gray-500">${osSectionHtml(
              safemodeOs,
              { icon: "ğŸ›¡ï¸", title: "ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰OS" }
            )}</div><div class="p-6 bg-gray-700/50 rounded-xl"><h4 class="text-xl font-bold text-center text-amber-300 mb-4">OSã®é€£æºåŠ›å­¦ã¨ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°æˆ¦ç•¥</h4>${strategySummary}</div></div><div class="mt-16 pt-8 border-t-2 border-dashed border-gray-700"><h3 class="text-xl font-bold text-amber-300 mb-4">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸</h3><div class="mt-8"><a href="future_simulator.html" class="bg-amber-500 hover:bg-amber-600 text-gray-900 font-bold py-2 px-6 rounded-lg transition duration-300">æœªæ¥åˆ†å²ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã€å…·ä½“çš„ãªèª²é¡Œã‚’åˆ†æã™ã‚‹ &rarr;</a></div></div></div>`;
          }

          function generateTriadName(engineOs, interfaceOs, safemodeOs) {
            const engineKeyword =
              engineOs.catchphrase.split("ã€")[0] || engineOs.name_jp;
            const interfaceKeyword =
              interfaceOs.catchphrase.split("ã€")[0] || interfaceOs.name_jp;
            const safemodeKeyword =
              safemodeOs.catchphrase.split("ã€")[0] || safemodeOs.name_jp;
            const patterns = [
              `ã€${engineKeyword}ã€ã®é­‚ã‚’æŒã¤ã€${interfaceKeyword}ã€‚ãã®æœ¬è³ªã¯ã€${safemodeKeyword}ã€ã®å¡æ™ºã«æ”¯ãˆã‚‰ã‚Œã¦ã„ã‚‹ã€‚`,
              `${interfaceKeyword}ã®ä»®é¢ã‚’ã¤ã‘ãŸã€ã€${engineKeyword}ã€ã®æ¢æ±‚è€…ã€‚å±æ©Ÿã«ç€•ã—ãŸæ™‚ã€ã€${safemodeKeyword}ã€ãŒé“ã‚’ç¤ºã™ã€‚`,
              `æ ¸ã¨ãªã‚‹åŠ›ã¯ã€${engineKeyword}ã€ã€‚ä¸–ç•Œã¨ã®å¯¾è©±ã¯ã€${interfaceKeyword}ã€ã€‚ãã—ã¦ã€ã‚ãªãŸã‚’å®ˆã‚‹å®‰å…¨è£…ç½®ã¯ã€${safemodeKeyword}ã€ã€‚`,
            ];
            return patterns[engineOs.hexagram_id % patterns.length];
          }

          function generateStrategySummary(engineOs, interfaceOs, safemodeOs) {
            const getInteraction = (id1, id2) => {
              return (
                TRIGRAM_INTERACTIONS?.[id1]?.[id2] || {
                  synergy: "...",
                  conflict: "...",
                }
              );
            };
            const innerInteraction = getInteraction(
              engineOs.lower_trigram_id,
              interfaceOs.lower_trigram_id
            );
            const outerInteraction = getInteraction(
              engineOs.upper_trigram_id,
              interfaceOs.upper_trigram_id
            );
            const synergySummary = `ã‚ãªãŸã®OSã®æœ€å¤§ã®å¼·ã¿ã¯ã€ã‚¨ãƒ³ã‚¸ãƒ³OSã€${engineOs.name_jp}ã€‘ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹OSã€${interfaceOs.name_jp}ã€‘ã®é€£æºã‹ã‚‰ç”Ÿã¾ã‚Œã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€<strong>${innerInteraction.synergy}</strong> ã¾ãŸã€<strong>${outerInteraction.synergy}</strong> ã“ã‚ŒãŒã€ã‚ãªãŸãŒè‡ªç„¶ä½“ã§ã„ã‚‹æ™‚ã«ç™ºæ®ã•ã‚Œã‚‹ã€ç‹¬è‡ªã®ä¾¡å€¤å‰µé€ ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚`;
            const conflictSummary = `ä¸€æ–¹ã§ã€ã“ã®å¼·åŠ›ãªé€£æºã¯ã€æ™‚ã«å†…é¢çš„ãªè‘›è—¤ã‚’ç”Ÿã¿å‡ºã—ã¾ã™ã€‚<strong>${innerInteraction.conflict}</strong> ã•ã‚‰ã«ã€<strong>${outerInteraction.conflict}</strong> ã“ã®è‘›è—¤ãŒã€ã‚ãªãŸã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æ¶ˆè€—ã•ã›ãŸã‚Šã€è¡Œå‹•ã‚’ãŸã‚ã‚‰ã‚ã›ãŸã‚Šã™ã‚‹åŸå› ã¨ãªã‚Šã¾ã™ã€‚`;
            const contrastTheme =
              HDB.bible?.zatsu_ka_den?.[engineOs.hexagram_id]?.contrast_theme ||
              "é–¢ä¿‚æ€§";
            const finalStrategy = `ã—ãŸãŒã£ã¦ã€ã‚ãªãŸã®ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚’æœ€å¤§åŒ–ã™ã‚‹ãŸã‚ã®åŸºæœ¬æˆ¦ç•¥ã¯ã€<strong>ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹OSã®ç‰¹æ€§ã‚’æ„è­˜çš„ã«ä½¿ã„ã€ã‚¨ãƒ³ã‚¸ãƒ³OSã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æœ€é©ã«æ–¹å‘ä»˜ã‘ã‚‹ã“ã¨ã€</strong>ã§ã™ã€‚ã“ã®äºŒã¤ã®OSã®ã€${contrastTheme}ã€ãŒã‚‚ãŸã‚‰ã™èª²é¡Œã«ç›´é¢ã—ã€å¼·ã„ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æ„Ÿã˜ãŸæ™‚ã€ã‚ãªãŸã‚’å®ˆã‚‹å®‰å…¨è£…ç½®ã¨ã—ã¦<strong>ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰OSã€${safemodeOs.name_jp}ã€‘</strong>ãŒèµ·å‹•ã—ã¾ã™ã€‚ã“ã®åŸç‚¹ã«å®šæœŸçš„ã«ç«‹ã¡è¿”ã‚‹ã“ã¨ã§ã€OSã¯æœ€é©ã«ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚`;
            return `<div class="prose-custom space-y-6 text-left"><div class="p-4 bg-gray-900 rounded-lg border-l-2 border-green-400"><p class="font-semibold text-green-300">ã‚·ãƒŠã‚¸ãƒ¼ï¼ˆå¼·ã¿ï¼‰:</p><p class="text-sm">${synergySummary}</p></div><div class="p-4 bg-gray-900 rounded-lg border-l-2 border-red-400"><p class="font-semibold text-red-300">æˆé•·èª²é¡Œï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼‰:</p><p class="text-sm">${conflictSummary}</p></div><div class="mt-6 pt-6 border-t border-dashed border-gray-700"><h5 class="font-bold text-amber-300">OSãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°æˆ¦ç•¥</h5><p>${finalStrategy}</p></div></div>`;
          }

          showIntro();
        } catch (error) {
          console.error("åˆæœŸåŒ–ã«å¤±æ•—:", error);
          document.body.innerHTML = `<div class="text-center text-red-400 p-8">ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}</div>`;
        }
      });
    </script>
  </body>
</html>
