<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="HaQei Analyzer - å¤ä»£ã®å¡æ™ºã¨ç¾ä»£ã®ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ãŒèåˆã—ãŸã€æ·±ã„è‡ªå·±æ´å¯Ÿä½“é¨“"
    />
    <title>HaQei Analyzer - æ·±ã„è‡ªå·±æ´å¯Ÿã¸ã®å…¥ã‚Šå£</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Shippori+Mincho:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- çµ±åˆæ¸ˆã¿ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ -->
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/animations.css" />
    <link rel="stylesheet" href="css/interactive-ui.css" />
    <link rel="stylesheet" href="css/strategic-dashboard.css" />
    <link rel="stylesheet" href="css/premium-integration.css" />
    <link rel="stylesheet" href="css/critical-productive-card.css" />
    <link rel="stylesheet" href="css/behavioral-insights.css" />
    <link rel="stylesheet" href="css/constellation-view.css" />
    <link rel="stylesheet" href="css/behavioral-flow-timeline.css" />
    <link rel="stylesheet" href="css/unified-design.css" />
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  </head>
  <body>
    <!-- åˆæœŸã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å¿…ãšä¸Šéƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®š
      window.addEventListener('load', function() {
        window.scrollTo(0, 0);
        document.documentElement.scrollTop = 0;
        document.body.scrollTop = 0;
      });
      
      // DOMèª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«ã‚‚å®Ÿè¡Œ
      document.addEventListener('DOMContentLoaded', function() {
        window.scrollTo(0, 0);
        document.documentElement.scrollTop = 0;
        document.body.scrollTop = 0;
      });
    </script>
    
    <!-- Global Progress Indicator -->
    <div class="global-progress">
      <div class="progress-bar" style="width: var(--progress, 0%)"></div>
    </div>

    <!-- Main Application Container -->
    <div id="app" class="app-container">
      <!-- Welcome Screen -->
      <section id="welcome-container" class="screen-container">
        <!-- WelcomeScreen component will render here -->
      </section>

      <!-- Questions Flow -->
      <section
        id="questions-container"
        class="screen-container"
        style="display: none"
      >
        <!-- QuestionFlow component will render here -->
      </section>

      <!-- Analysis View -->
      <section
        id="analysis-container"
        class="screen-container"
        style="display: none"
      >
        <!-- AnalysisView component will render here -->
      </section>

      <!-- Results View -->
      <section
        id="results-container"
        class="screen-container"
        style="display: none"
      >
        <!-- ResultsView component will render here -->
      </section>

      <!-- Deep Insights Panel -->
      <section
        id="insights-container"
        class="screen-container"
        style="display: none"
      >
        <!-- InsightPanel component will render here -->
      </section>
    </div>

    <!-- Error Display Container -->
    <div id="data-manager-errors" class="error-container" style="display: none;">
      <!-- ErrorHandler will render error messages here -->
    </div>

    <!-- ğŸš€ Ultra Critical Path - çµ¶å¯¾å¿…è¦æœ€å°é™ã®ã¿ (50KBä»¥ä¸‹ç›®æ¨™) -->
    <script src="./js/shared/core/BaseComponent.js"></script>
    <script src="./js/shared/core/MicroStorageManager.js"></script>
    <script src="./js/shared/core/BridgeStorageManager.js"></script>
    <script src="./js/shared/core/SimpleStorageManager.js"></script>
    <script src="./js/shared/core/MicroDataManager.js"></script>
    <script src="./js/shared/data/questions.js"></script>
    <script src="./js/os-analyzer/core/PrecompiledQuestions.js"></script>
    
    <!-- ğŸš€ Core UI - è¶…é«˜é€Ÿã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ -->
    <script src="js/os-analyzer/components/WelcomeScreen.js"></script>
    <script src="js/os-analyzer/components/HaqeiQuestionElement.js"></script>
    <script src="js/os-analyzer/components/VirtualQuestionFlow.js"></script>
    
    <!-- â³ ALL OTHER SCRIPTS - è¨­å•å®Œäº†å¾Œã«å‹•çš„èª­ã¿è¾¼ã¿ -->
    <!-- ä»¥ä¸‹ã¯å…¨ã¦è¨­å•å®Œäº†å¾Œã¾ãŸã¯ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã§èª­ã¿è¾¼ã¿ -->
    
    <!-- ğŸš« å…¨ã¦ã®éå¿…é ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ãƒ­ãƒ¼ãƒ‰ã«å¤‰æ›´ -->
    <!-- ã“ã‚Œã‚‰ã¯å…¨ã¦app.jsã®å‹•çš„ãƒ­ãƒ¼ãƒ‰ã«ç§»è¡Œ -->

    <!-- ãƒ‡ãƒãƒƒã‚°ç”¨ãƒœã‚¿ãƒ³ -->
    <div id="debug-panel" style="position: fixed; top: 10px; right: 10px; z-index: 9999; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 5px; display: none;">
      <button onclick="debugTripleOS()" style="background: #444; color: #fff; border: 1px solid #666; padding: 5px 10px; margin: 2px; cursor: pointer;">Triple OS ãƒ‡ãƒãƒƒã‚°</button>
      <button onclick="checkAnswerFormat()" style="background: #444; color: #fff; border: 1px solid #666; padding: 5px 10px; margin: 2px; cursor: pointer;">å›ç­”ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç¢ºèª</button>
      <button onclick="toggleDebugPanel()" style="background: #600; color: #fff; border: 1px solid #800; padding: 5px 10px; margin: 2px; cursor: pointer;">é–‰ã˜ã‚‹</button>
    </div>
    
    <!-- Service Worker ç™»éŒ² -->
    <script>
      // ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«è¡¨ç¤ºï¼ˆCtrl+Shift+Dï¼‰
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.shiftKey && e.key === 'D') {
          document.getElementById('debug-panel').style.display = 'block';
        }
      });
      
      function toggleDebugPanel() {
        document.getElementById('debug-panel').style.display = 'none';
      }
      
      async function debugTripleOS() {
        console.log('ğŸ”¬ Triple OS ãƒ‡ãƒãƒƒã‚°é–‹å§‹');
        
        try {
          // ç¾åœ¨ã®å›ç­”ã‚’ç¢ºèª
          const answers = JSON.parse(localStorage.getItem('haqei_answers') || '[]');
          console.log('ğŸ“ ç¾åœ¨ã®å›ç­”æ•°:', answers.length);
          
          if (answers.length > 0) {
            console.log('ğŸ“„ å›ç­”ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¾‹:', answers[0]);
            
            // å›ç­”ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ä¿®æ­£
            const fixedAnswers = answers.map(answer => {
              if (!answer.selectedChoice && answer.selectedValue) {
                return {
                  ...answer,
                  selectedChoice: `${answer.questionId}${answer.selectedValue.toLowerCase()}`,
                  choiceText: answer.choiceText || `é¸æŠè‚¢${answer.selectedValue}`
                };
              }
              return answer;
            });
            
            console.log('ğŸ”§ ä¿®æ­£å¾Œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¾‹:', fixedAnswers[0]);
            localStorage.setItem('haqei_answers', JSON.stringify(fixedAnswers));
            
            // ç›´æ¥åˆ†æã‚’å®Ÿè¡Œ
            if (window.proceedToAnalysis) {
              console.log('ğŸš€ åˆ†æã‚’ç›´æ¥å®Ÿè¡Œ...');
              window.proceedToAnalysis(fixedAnswers);
            } else {
              console.log('âš ï¸ proceedToAnalysis ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
          } else {
            console.log('âš ï¸ å›ç­”ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
          }
        } catch (error) {
          console.error('âŒ ãƒ‡ãƒãƒƒã‚°ã‚¨ãƒ©ãƒ¼:', error);
        }
      }
      
      function checkAnswerFormat() {
        const answers = JSON.parse(localStorage.getItem('haqei_answers') || '[]');
        console.log('ğŸ“Š å›ç­”ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆåˆ†æ:');
        console.log('ç·æ•°:', answers.length);
        
        if (answers.length > 0) {
          const sample = answers[0];
          console.log('ã‚µãƒ³ãƒ—ãƒ«:', sample);
          console.log('å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰:');
          console.log('- questionId:', !!sample.questionId);
          console.log('- selectedValue:', !!sample.selectedValue);
          console.log('- selectedChoice:', !!sample.selectedChoice);
          console.log('- choiceText:', !!sample.choiceText);
        }
      }
      
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/haqei-sw.js')
          .then(registration => console.log('âœ… Service Worker registered'))
          .catch(error => console.log('âŒ Service Worker registration failed:', error));
      }
    </script>
    
    <!-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ– -->
    <script src="js/app.js"></script>

  </body>
</html>
