<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最小限の偶数質問テスト</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .question-box { 
            border: 3px solid #333; 
            padding: 20px; 
            margin: 10px 0; 
            min-height: 200px; 
            background: #f9f9f9; 
        }
        .btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            margin: 5px; 
            border-radius: 3px; 
            cursor: pointer; 
        }
        .log { 
            background: #f0f0f0; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 3px; 
            font-family: monospace; 
            max-height: 300px; 
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>🔍 最小限の偶数質問テスト</h1>
    
    <div>
        <button class="btn" onclick="testQuestion(0)">Q1をテスト</button>
        <button class="btn" onclick="testQuestion(1)">Q2をテスト（偶数）</button>
        <button class="btn" onclick="testQuestion(2)">Q3をテスト</button>
        <button class="btn" onclick="testQuestion(3)">Q4をテスト（偶数）</button>
        <button class="btn" onclick="clearLog()">ログクリア</button>
    </div>

    <div id="questionContainer" class="question-box">
        質問がここに表示されます
    </div>

    <div id="logOutput" class="log">ログ出力...</div>

    <!-- スクリプト読み込み -->
    <script src="js/data/questions.js"></script>
    <script src="js/data/vectors.js"></script>
    <script src="js/data/data_box.js"></script>
    <script src="js/core/BaseComponent.js"></script>
    <script src="js/core/StorageManager.js"></script>

    <script>
        let questions = [];
        let logEl = document.getElementById('logOutput');

        function log(message) {
            const time = new Date().toLocaleTimeString();
            logEl.textContent += `[${time}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            logEl.textContent = '';
        }

        // 質問データを直接読み込み
        function loadQuestions() {
            log('質問データ読み込み開始...');
            
            if (typeof WORLDVIEW_QUESTIONS === 'undefined') {
                log('❌ WORLDVIEW_QUESTIONSが未定義');
                return false;
            }
            
            if (typeof SCENARIO_QUESTIONS === 'undefined') {
                log('❌ SCENARIO_QUESTIONSが未定義');
                return false;
            }
            
            questions = [...WORLDVIEW_QUESTIONS, ...SCENARIO_QUESTIONS];
            log(`✅ 質問読み込み完了: ${questions.length}問`);
            log(`価値観質問: ${WORLDVIEW_QUESTIONS.length}問`);
            log(`シナリオ質問: ${SCENARIO_QUESTIONS.length}問`);
            
            return true;
        }

        function testQuestion(index) {
            log(`\n=== 質問${index + 1}のテスト開始 ===`);
            
            if (questions.length === 0) {
                log('質問データが読み込まれていません');
                return;
            }
            
            if (index >= questions.length) {
                log(`質問インデックス${index}は範囲外です（最大: ${questions.length - 1}）`);
                return;
            }
            
            const question = questions[index];
            const isEven = (index + 1) % 2 === 0;
            
            log(`質問番号: ${index + 1} ${isEven ? '(偶数)' : '(奇数)'}`);
            log(`質問ID: ${question.id}`);
            log(`質問テキスト: ${question.text || question.scenario || 'なし'}`);
            log(`選択肢数: ${question.options ? question.options.length : 0}`);
            
            // 質問を直接表示してみる
            renderQuestionDirectly(question, index + 1);
        }

        function renderQuestionDirectly(question, questionNum) {
            const container = document.getElementById('questionContainer');
            
            log('質問の直接レンダリングを試行...');
            
            try {
                // シナリオ質問かどうかチェック
                const isScenario = question.scenario && question.inner_q && question.outer_q;
                
                let html = `<h3>質問 ${questionNum} ${isScenario ? '(シナリオ)' : '(通常)'}</h3>`;
                
                if (isScenario) {
                    html += `
                        <div style="background: #e8f4ff; padding: 15px; margin: 10px 0; border-radius: 5px;">
                            <h4>状況設定</h4>
                            <p>${question.scenario}</p>
                            <h4>${question.inner_q}</h4>
                            <div>
                                ${question.options.inner.map((opt, i) => 
                                    `<div style="margin: 5px 0;">
                                        <input type="radio" name="inner" value="${opt.value}" id="inner${i}">
                                        <label for="inner${i}">${opt.text}</label>
                                    </div>`
                                ).join('')}
                            </div>
                            <h4>${question.outer_q}</h4>
                            <div>
                                ${question.options.outer.map((opt, i) => 
                                    `<div style="margin: 5px 0;">
                                        <input type="radio" name="outer" value="${opt.value}" id="outer${i}">
                                        <label for="outer${i}">${opt.text}</label>
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    html += `
                        <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px;">
                            <p style="font-size: 16px; margin-bottom: 15px;">${question.text}</p>
                            <div>
                                ${question.options.map((opt, i) => 
                                    `<div style="margin: 8px 0;">
                                        <input type="radio" name="answer" value="${opt.value}" id="opt${i}">
                                        <label for="opt${i}" style="margin-left: 8px;">${opt.text}</label>
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = html;
                
                log(`✅ 質問${questionNum}の直接レンダリング成功`);
                log(`レンダリング後のHTML長: ${html.length}文字`);
                
                return true;
                
            } catch (error) {
                log(`❌ 質問${questionNum}の直接レンダリング失敗: ${error.message}`);
                container.innerHTML = `<div style="color: red;">レンダリングエラー: ${error.message}</div>`;
                return false;
            }
        }

        // ページ読み込み時に質問データを読み込み
        window.addEventListener('load', () => {
            log('ページ読み込み完了');
            
            if (loadQuestions()) {
                log('質問データ読み込み完了 - テストボタンをクリックしてください');
                
                // 最初の4問の基本情報を表示
                for (let i = 0; i < Math.min(4, questions.length); i++) {
                    const q = questions[i];
                    const isEven = (i + 1) % 2 === 0;
                    log(`Q${i + 1}${isEven ? '(偶数)' : '(奇数)'}: ${q.id} - ${q.text ? q.text.substring(0, 30) + '...' : 'シナリオ質問'}`);
                }
            } else {
                log('質問データ読み込み失敗');
            }
        });
    </script>
</body>
</html>