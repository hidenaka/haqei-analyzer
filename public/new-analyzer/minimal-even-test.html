<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€å°é™ã®å¶æ•°è³ªå•ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .question-box { 
            border: 3px solid #333; 
            padding: 20px; 
            margin: 10px 0; 
            min-height: 200px; 
            background: #f9f9f9; 
        }
        .btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            margin: 5px; 
            border-radius: 3px; 
            cursor: pointer; 
        }
        .log { 
            background: #f0f0f0; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 3px; 
            font-family: monospace; 
            max-height: 300px; 
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ” æœ€å°é™ã®å¶æ•°è³ªå•ãƒ†ã‚¹ãƒˆ</h1>
    
    <div>
        <button class="btn" onclick="testQuestion(0)">Q1ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <button class="btn" onclick="testQuestion(1)">Q2ã‚’ãƒ†ã‚¹ãƒˆï¼ˆå¶æ•°ï¼‰</button>
        <button class="btn" onclick="testQuestion(2)">Q3ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <button class="btn" onclick="testQuestion(3)">Q4ã‚’ãƒ†ã‚¹ãƒˆï¼ˆå¶æ•°ï¼‰</button>
        <button class="btn" onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>

    <div id="questionContainer" class="question-box">
        è³ªå•ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
    </div>

    <div id="logOutput" class="log">ãƒ­ã‚°å‡ºåŠ›...</div>

    <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ -->
    <script src="js/data/questions.js"></script>
    <script src="js/data/vectors.js"></script>
    <script src="js/data/data_box.js"></script>
    <script src="js/core/BaseComponent.js"></script>
    <script src="js/core/StorageManager.js"></script>

    <script>
        let questions = [];
        let logEl = document.getElementById('logOutput');

        function log(message) {
            const time = new Date().toLocaleTimeString();
            logEl.textContent += `[${time}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            logEl.textContent = '';
        }

        // è³ªå•ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥èª­ã¿è¾¼ã¿
        function loadQuestions() {
            log('è³ªå•ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹...');
            
            if (typeof WORLDVIEW_QUESTIONS === 'undefined') {
                log('âŒ WORLDVIEW_QUESTIONSãŒæœªå®šç¾©');
                return false;
            }
            
            if (typeof SCENARIO_QUESTIONS === 'undefined') {
                log('âŒ SCENARIO_QUESTIONSãŒæœªå®šç¾©');
                return false;
            }
            
            questions = [...WORLDVIEW_QUESTIONS, ...SCENARIO_QUESTIONS];
            log(`âœ… è³ªå•èª­ã¿è¾¼ã¿å®Œäº†: ${questions.length}å•`);
            log(`ä¾¡å€¤è¦³è³ªå•: ${WORLDVIEW_QUESTIONS.length}å•`);
            log(`ã‚·ãƒŠãƒªã‚ªè³ªå•: ${SCENARIO_QUESTIONS.length}å•`);
            
            return true;
        }

        function testQuestion(index) {
            log(`\n=== è³ªå•${index + 1}ã®ãƒ†ã‚¹ãƒˆé–‹å§‹ ===`);
            
            if (questions.length === 0) {
                log('è³ªå•ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            if (index >= questions.length) {
                log(`è³ªå•ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹${index}ã¯ç¯„å›²å¤–ã§ã™ï¼ˆæœ€å¤§: ${questions.length - 1}ï¼‰`);
                return;
            }
            
            const question = questions[index];
            const isEven = (index + 1) % 2 === 0;
            
            log(`è³ªå•ç•ªå·: ${index + 1} ${isEven ? '(å¶æ•°)' : '(å¥‡æ•°)'}`);
            log(`è³ªå•ID: ${question.id}`);
            log(`è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ: ${question.text || question.scenario || 'ãªã—'}`);
            log(`é¸æŠè‚¢æ•°: ${question.options ? question.options.length : 0}`);
            
            // è³ªå•ã‚’ç›´æ¥è¡¨ç¤ºã—ã¦ã¿ã‚‹
            renderQuestionDirectly(question, index + 1);
        }

        function renderQuestionDirectly(question, questionNum) {
            const container = document.getElementById('questionContainer');
            
            log('è³ªå•ã®ç›´æ¥ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è©¦è¡Œ...');
            
            try {
                // ã‚·ãƒŠãƒªã‚ªè³ªå•ã‹ã©ã†ã‹ãƒã‚§ãƒƒã‚¯
                const isScenario = question.scenario && question.inner_q && question.outer_q;
                
                let html = `<h3>è³ªå• ${questionNum} ${isScenario ? '(ã‚·ãƒŠãƒªã‚ª)' : '(é€šå¸¸)'}</h3>`;
                
                if (isScenario) {
                    html += `
                        <div style="background: #e8f4ff; padding: 15px; margin: 10px 0; border-radius: 5px;">
                            <h4>çŠ¶æ³è¨­å®š</h4>
                            <p>${question.scenario}</p>
                            <h4>${question.inner_q}</h4>
                            <div>
                                ${question.options.inner.map((opt, i) => 
                                    `<div style="margin: 5px 0;">
                                        <input type="radio" name="inner" value="${opt.value}" id="inner${i}">
                                        <label for="inner${i}">${opt.text}</label>
                                    </div>`
                                ).join('')}
                            </div>
                            <h4>${question.outer_q}</h4>
                            <div>
                                ${question.options.outer.map((opt, i) => 
                                    `<div style="margin: 5px 0;">
                                        <input type="radio" name="outer" value="${opt.value}" id="outer${i}">
                                        <label for="outer${i}">${opt.text}</label>
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    html += `
                        <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px;">
                            <p style="font-size: 16px; margin-bottom: 15px;">${question.text}</p>
                            <div>
                                ${question.options.map((opt, i) => 
                                    `<div style="margin: 8px 0;">
                                        <input type="radio" name="answer" value="${opt.value}" id="opt${i}">
                                        <label for="opt${i}" style="margin-left: 8px;">${opt.text}</label>
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = html;
                
                log(`âœ… è³ªå•${questionNum}ã®ç›´æ¥ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æˆåŠŸ`);
                log(`ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã®HTMLé•·: ${html.length}æ–‡å­—`);
                
                return true;
                
            } catch (error) {
                log(`âŒ è³ªå•${questionNum}ã®ç›´æ¥ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¤±æ•—: ${error.message}`);
                container.innerHTML = `<div style="color: red;">ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                return false;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è³ªå•ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        window.addEventListener('load', () => {
            log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            
            if (loadQuestions()) {
                log('è³ªå•ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº† - ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„');
                
                // æœ€åˆã®4å•ã®åŸºæœ¬æƒ…å ±ã‚’è¡¨ç¤º
                for (let i = 0; i < Math.min(4, questions.length); i++) {
                    const q = questions[i];
                    const isEven = (i + 1) % 2 === 0;
                    log(`Q${i + 1}${isEven ? '(å¶æ•°)' : '(å¥‡æ•°)'}: ${q.id} - ${q.text ? q.text.substring(0, 30) + '...' : 'ã‚·ãƒŠãƒªã‚ªè³ªå•'}`);
                }
            } else {
                log('è³ªå•ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—');
            }
        });
    </script>
</body>
</html>