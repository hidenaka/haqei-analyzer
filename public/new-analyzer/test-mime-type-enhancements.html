<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIME Type Enhancement System Test</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background-color: #0d1117;
            color: #c9d1d9;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-header {
            background: #21262d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #58a6ff;
        }
        .test-section {
            background: #161b22;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #30363d;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid;
            font-size: 12px;
        }
        .test-pass {
            background: #0d4429;
            border-color: #238636;
            color: #2ea043;
        }
        .test-fail {
            background: #490202;
            border-color: #da3633;
            color: #f85149;
        }
        .test-warn {
            background: #333017;
            border-color: #d29922;
            color: #f0c674;
        }
        .test-info {
            background: #0c2d6b;
            border-color: #1f6feb;
            color: #58a6ff;
        }
        .btn {
            background: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #2ea043;
        }
        .btn.secondary {
            background: #21262d;
            border: 1px solid #30363d;
        }
        .btn.secondary:hover {
            background: #30363d;
        }
        .json-display {
            background: #010409;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #30363d;
            max-height: 400px;
            overflow-y: auto;
            font-size: 11px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #21262d;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #238636, #2ea043);
            width: 0%;
            transition: width 0.3s ease;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .stat-card {
            background: #21262d;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #58a6ff;
        }
        .stat-label {
            font-size: 12px;
            color: #8b949e;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ”§ MIME Type Enhancement System Test</h1>
            <p>æ‹¡å¼µã•ã‚ŒãŸMIMEã‚¿ã‚¤ãƒ—æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ã‚µãƒ¼ãƒãƒ¼è¨­å®šæ¤œå‡ºæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ</p>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="testSystemInitialization()">ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</button>
            <button class="btn secondary" onclick="clearResults('system-results')">ã‚¯ãƒªã‚¢</button>
            <div id="system-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š MIME ã‚¿ã‚¤ãƒ—æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="testMimeTypeValidation()">MIME ã‚¿ã‚¤ãƒ—æ¤œè¨¼å®Ÿè¡Œ</button>
            <button class="btn secondary" onclick="testBulkValidation()">ä¸€æ‹¬æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</button>
            <button class="btn secondary" onclick="clearResults('mime-results')">ã‚¯ãƒªã‚¢</button>
            
            <div class="progress-bar">
                <div class="progress-fill" id="mime-progress"></div>
            </div>
            
            <div id="mime-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ” ã‚µãƒ¼ãƒãƒ¼è¨­å®šæ¤œå‡ºãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="testServerDetection()">ã‚µãƒ¼ãƒãƒ¼æ¤œå‡ºå®Ÿè¡Œ</button>
            <button class="btn secondary" onclick="testConfigurationGuide()">è¨­å®šã‚¬ã‚¤ãƒ‰ç”Ÿæˆ</button>
            <button class="btn secondary" onclick="clearResults('server-results')">ã‚¯ãƒªã‚¢</button>
            <div id="server-results"></div>
        </div>

        <div class="test-section">
            <h2>âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="testErrorHandling()">ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè¡Œ</button>
            <button class="btn secondary" onclick="testGracefulDegradation()">ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ« ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</button>
            <button class="btn secondary" onclick="clearResults('error-results')">ã‚¯ãƒªã‚¢</button>
            <div id="error-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ çµ±åˆãƒ¬ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ</h2>
            <button class="btn" onclick="generateIntegratedReport()">çµ±åˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
            <button class="btn secondary" onclick="showTroubleshootingGuide()">ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰</button>
            <button class="btn secondary" onclick="clearResults('report-results')">ã‚¯ãƒªã‚¢</button>
            <div id="report-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ</h2>
            <div class="stats-grid" id="performance-stats">
                <div class="stat-card">
                    <div class="stat-value" id="total-tests">0</div>
                    <div class="stat-label">å®Ÿè¡Œã•ã‚ŒãŸãƒ†ã‚¹ãƒˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="success-rate">0%</div>
                    <div class="stat-label">æˆåŠŸç‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="error-count">0</div>
                    <div class="stat-label">ã‚¨ãƒ©ãƒ¼æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avg-time">0ms</div>
                    <div class="stat-label">å¹³å‡å®Ÿè¡Œæ™‚é–“</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ”¬ è©³ç´°çµæœ</h2>
            <div class="json-display" id="detailed-results">
                ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„...
            </div>
        </div>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ -->
    <script src="js/core/MimeTypeErrorHandler.js"></script>
    <script src="js/core/ServerConfigurationDetector.js"></script>
    <script src="js/core/ScriptPathValidator.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let testStats = {
            totalTests: 0,
            successfulTests: 0,
            failedTests: 0,
            totalTime: 0
        };

        let mimeTypeErrorHandler;
        let serverConfigDetector;
        let scriptPathValidator;

        // çµæœè¡¨ç¤ºãƒ˜ãƒ«ãƒ‘ãƒ¼
        function addResult(containerId, testName, success, message, details = null) {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'test-pass' : 'test-fail'}`;
            
            const icon = success ? 'âœ…' : 'âŒ';
            resultDiv.innerHTML = `${icon} <strong>${testName}</strong>: ${message}`;
            
            container.appendChild(resultDiv);
            
            // çµ±è¨ˆæ›´æ–°
            testStats.totalTests++;
            if (success) {
                testStats.successfulTests++;
            } else {
                testStats.failedTests++;
            }
            updatePerformanceStats();
            
            // è©³ç´°çµæœè¡¨ç¤º
            if (details) {
                updateDetailedResults(testName, details);
            }
        }

        function addInfo(containerId, message) {
            const container = document.getElementById(containerId);
            const infoDiv = document.createElement('div');
            infoDiv.className = 'test-result test-info';
            infoDiv.innerHTML = `â„¹ï¸ ${message}`;
            container.appendChild(infoDiv);
        }

        function clearResults(containerId) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = '';
            }
        }

        function updatePerformanceStats() {
            document.getElementById('total-tests').textContent = testStats.totalTests;
            const successRate = testStats.totalTests > 0 ? 
                Math.round((testStats.successfulTests / testStats.totalTests) * 100) : 0;
            document.getElementById('success-rate').textContent = successRate + '%';
            document.getElementById('error-count').textContent = testStats.failedTests;
            const avgTime = testStats.totalTests > 0 ? 
                Math.round(testStats.totalTime / testStats.totalTests) : 0;
            document.getElementById('avg-time').textContent = avgTime + 'ms';
        }

        function updateDetailedResults(testName, details) {
            const detailsContainer = document.getElementById('detailed-results');
            const timestamp = new Date().toISOString();
            const entry = `[${timestamp}] ${testName}:\n${JSON.stringify(details, null, 2)}\n\n`;
            detailsContainer.textContent += entry;
            detailsContainer.scrollTop = detailsContainer.scrollHeight;
        }

        function updateProgress(containerId, percent) {
            const progressBar = document.getElementById(containerId);
            if (progressBar) {
                progressBar.style.width = percent + '%';
            }
        }

        // ãƒ†ã‚¹ãƒˆé–¢æ•°ç¾¤
        async function testSystemInitialization() {
            const startTime = Date.now();
            
            addInfo('system-results', 'ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆæœŸåŒ–ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™...');

            try {
                // MimeTypeErrorHandler ã®åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
                if (typeof MimeTypeErrorHandler !== 'undefined') {
                    mimeTypeErrorHandler = new MimeTypeErrorHandler({
                        developmentMode: true,
                        enableGracefulDegradation: true,
                        groupSimilarErrors: true
                    });
                    addResult('system-results', 'MimeTypeErrorHandleråˆæœŸåŒ–', true, 
                        'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
                } else {
                    addResult('system-results', 'MimeTypeErrorHandleråˆæœŸåŒ–', false, 
                        'MimeTypeErrorHandlerã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }

                // ServerConfigurationDetector ã®åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
                if (typeof ServerConfigurationDetector !== 'undefined') {
                    serverConfigDetector = new ServerConfigurationDetector({
                        enableAutoDetection: true,
                        includeConfigTemplates: true
                    });
                    addResult('system-results', 'ServerConfigurationDetectoråˆæœŸåŒ–', true, 
                        'ã‚µãƒ¼ãƒãƒ¼è¨­å®šæ¤œå‡ºå™¨ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
                } else {
                    addResult('system-results', 'ServerConfigurationDetectoråˆæœŸåŒ–', false, 
                        'ServerConfigurationDetectorã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }

                // ScriptPathValidator ã®åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
                if (typeof ScriptPathValidator !== 'undefined') {
                    scriptPathValidator = new ScriptPathValidator({
                        developmentMode: true,
                        enableGracefulDegradation: true,
                        enableErrorGrouping: true
                    });
                    addResult('system-results', 'ScriptPathValidatoråˆæœŸåŒ–', true, 
                        'æ‹¡å¼µã‚¹ã‚¯ãƒªãƒ—ãƒˆæ¤œè¨¼å™¨ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
                } else {
                    addResult('system-results', 'ScriptPathValidatoråˆæœŸåŒ–', false, 
                        'ScriptPathValidatorã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }

                const endTime = Date.now();
                testStats.totalTime += (endTime - startTime);
                
            } catch (error) {
                addResult('system-results', 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–', false, 
                    `åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, { error: error.message });
            }
        }

        async function testMimeTypeValidation() {
            const startTime = Date.now();
            const testFiles = [
                'js/core/ScriptPathValidator.js',
                'js/core/MimeTypeErrorHandler.js',
                'js/core/ServerConfigurationDetector.js',
                'nonexistent-file.js' // å­˜åœ¨ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«
            ];

            addInfo('mime-results', `${testFiles.length}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§MIME ã‚¿ã‚¤ãƒ—æ¤œè¨¼ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™...`);

            let validatedCount = 0;
            
            for (const file of testFiles) {
                try {
                    updateProgress('mime-progress', (validatedCount / testFiles.length) * 100);
                    
                    if (scriptPathValidator) {
                        const result = await scriptPathValidator.validateScriptPath(file);
                        
                        const isValid = result.isValid || result.canContinue !== false;
                        addResult('mime-results', `MIMEæ¤œè¨¼: ${file}`, isValid, 
                            isValid ? `æ¤œè¨¼æˆåŠŸ (${result.mimeType || 'No MIME'})` : 
                                     `æ¤œè¨¼å¤±æ•—: ${result.errors.join(', ')}`, result);
                    } else {
                        addResult('mime-results', `MIMEæ¤œè¨¼: ${file}`, false, 
                            'ScriptPathValidatorãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }
                } catch (error) {
                    addResult('mime-results', `MIMEæ¤œè¨¼: ${file}`, false, 
                        `ã‚¨ãƒ©ãƒ¼: ${error.message}`, { error: error.message });
                }
                
                validatedCount++;
            }

            updateProgress('mime-progress', 100);
            
            const endTime = Date.now();
            testStats.totalTime += (endTime - startTime);
        }

        async function testBulkValidation() {
            if (!scriptPathValidator) {
                addResult('mime-results', 'ä¸€æ‹¬æ¤œè¨¼', false, 
                    'ScriptPathValidatorãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            const testFiles = [
                'js/core/DataManager.js',
                'js/core/Calculator.js', 
                'js/components/WelcomeScreen.js',
                'js/components/QuestionFlow.js'
            ];

            const startTime = Date.now();
            
            try {
                addInfo('mime-results', `${testFiles.length}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ä¸€æ‹¬æ¤œè¨¼ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™...`);
                
                // ä¸€æ‹¬æ¤œè¨¼ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const results = [];
                for (const file of testFiles) {
                    try {
                        const result = await scriptPathValidator.validateScriptPath(file);
                        results.push({ file, result });
                    } catch (error) {
                        results.push({ file, error: error.message });
                    }
                }

                const successCount = results.filter(r => r.result && (r.result.isValid || r.result.canContinue !== false)).length;
                
                addResult('mime-results', 'ä¸€æ‹¬æ¤œè¨¼', true, 
                    `${successCount}/${results.length}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ¤œè¨¼æˆåŠŸ`, 
                    { results, summary: { total: results.length, success: successCount } });

            } catch (error) {
                addResult('mime-results', 'ä¸€æ‹¬æ¤œè¨¼', false, 
                    `ä¸€æ‹¬æ¤œè¨¼ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }

            const endTime = Date.now();
            testStats.totalTime += (endTime - startTime);
        }

        async function testServerDetection() {
            if (!serverConfigDetector) {
                addResult('server-results', 'ã‚µãƒ¼ãƒãƒ¼æ¤œå‡º', false, 
                    'ServerConfigurationDetectorãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            const startTime = Date.now();
            
            try {
                addInfo('server-results', 'ã‚µãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ—ã®è‡ªå‹•æ¤œå‡ºã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™...');
                
                const serverType = await serverConfigDetector.detectServerType();
                addResult('server-results', 'ã‚µãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ—æ¤œå‡º', true, 
                    `æ¤œå‡ºã•ã‚ŒãŸã‚µãƒ¼ãƒãƒ¼: ${serverType}`, { serverType });

                const confidence = serverConfigDetector.getDetectionConfidence(serverType);
                addResult('server-results', 'æ¤œå‡ºä¿¡é ¼åº¦', confidence > 50, 
                    `ä¿¡é ¼åº¦: ${confidence}%`, { confidence });

                const validation = await serverConfigDetector.validateServerConfiguration();
                addResult('server-results', 'ã‚µãƒ¼ãƒãƒ¼è¨­å®šæ¤œè¨¼', validation.isConfigured, 
                    validation.isConfigured ? 
                        `è¨­å®šæ¸ˆã¿ (MIME: ${validation.currentMimeType})` : 
                        `æœªè¨­å®š (${validation.error || 'è¨­å®šãŒå¿…è¦'})`, validation);
                        
            } catch (error) {
                addResult('server-results', 'ã‚µãƒ¼ãƒãƒ¼æ¤œå‡º', false, 
                    `æ¤œå‡ºã‚¨ãƒ©ãƒ¼: ${error.message}`, { error: error.message });
            }

            const endTime = Date.now();
            testStats.totalTime += (endTime - startTime);
        }

        async function testConfigurationGuide() {
            if (!serverConfigDetector) {
                addResult('server-results', 'è¨­å®šã‚¬ã‚¤ãƒ‰ç”Ÿæˆ', false, 
                    'ServerConfigurationDetectorãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            try {
                const serverType = await serverConfigDetector.detectServerType();
                const guide = serverConfigDetector.generateConfigurationGuide(serverType);
                
                addResult('server-results', 'è¨­å®šã‚¬ã‚¤ãƒ‰ç”Ÿæˆ', true, 
                    `${guide.serverName}ç”¨ã®ã‚¬ã‚¤ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ`, guide);

                const recommendations = await serverConfigDetector.getCurrentEnvironmentRecommendations();
                addResult('server-results', 'ç’°å¢ƒåˆ¥æ¨å¥¨äº‹é …', true, 
                    `æ¨å¥¨äº‹é …ã‚’ç”Ÿæˆã—ã¾ã—ãŸ (ä¿¡é ¼åº¦: ${recommendations.confidence}%)`, recommendations);
                    
            } catch (error) {
                addResult('server-results', 'è¨­å®šã‚¬ã‚¤ãƒ‰ç”Ÿæˆ', false, 
                    `ã‚¬ã‚¤ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        async function testErrorHandling() {
            if (!mimeTypeErrorHandler) {
                addResult('error-results', 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°', false, 
                    'MimeTypeErrorHandlerãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            try {
                addInfo('error-results', 'å„ç¨®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™...');

                // MIME ã‚¿ã‚¤ãƒ—ã‚¨ãƒ©ãƒ¼ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const mimeError = {
                    message: 'ä¸æ­£ãª MIME ã‚¿ã‚¤ãƒ—: text/html',
                    actualMimeType: 'text/html; charset=utf-8',
                    expectedMimeType: 'application/javascript'
                };

                const result1 = mimeTypeErrorHandler.handleMimeTypeError(mimeError, {
                    url: 'test-file.js',
                    serverType: 'DEVELOPMENT_SERVER'
                });

                addResult('error-results', 'MIME ã‚¿ã‚¤ãƒ—ã‚¨ãƒ©ãƒ¼å‡¦ç†', result1.canContinue, 
                    `ã‚¨ãƒ©ãƒ¼åˆ†é¡: ${result1.category}, ç¶™ç¶šå¯èƒ½: ${result1.canContinue}`, result1);

                // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³  
                const networkError = {
                    message: 'Failed to fetch',
                    errorType: 'NETWORK_ERROR'
                };

                const result2 = mimeTypeErrorHandler.handleMimeTypeError(networkError, {
                    url: 'missing-file.js'
                });

                addResult('error-results', 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼å‡¦ç†', !result2.canContinue, 
                    `ã‚¨ãƒ©ãƒ¼åˆ†é¡: ${result2.category}, ç¶™ç¶šå¯èƒ½: ${result2.canContinue}`, result2);

                // ã‚¨ãƒ©ãƒ¼ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
                const summaryReport = mimeTypeErrorHandler.generateErrorSummaryReport();
                addResult('error-results', 'ã‚¨ãƒ©ãƒ¼ã‚µãƒãƒªãƒ¼ç”Ÿæˆ', true, 
                    `çµ±åˆãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ: ${summaryReport.totalErrors}å€‹ã®ã‚¨ãƒ©ãƒ¼`, summaryReport);

            } catch (error) {
                addResult('error-results', 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°', false, 
                    `ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        async function testGracefulDegradation() {
            addInfo('error-results', 'ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ« ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™...');

            try {
                // å­˜åœ¨ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆ
                if (scriptPathValidator) {
                    const result = await scriptPathValidator.validateScriptPath('nonexistent-critical-file.js');
                    
                    const canContinue = result.canContinue !== false;
                    addResult('error-results', 'ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ« ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³', canContinue, 
                        canContinue ? 'å¤±æ•—ã—ã¦ã‚‚å‡¦ç†ã‚’ç¶™ç¶šã§ãã¾ã™' : 'å‡¦ç†ç¶™ç¶šãŒå›°é›£ã§ã™', result);
                } else {
                    addResult('error-results', 'ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ« ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³', false, 
                        'ãƒ†ã‚¹ãƒˆå¯¾è±¡ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
            } catch (error) {
                // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ãƒ†ã‚¹ãƒˆã¯ç¶™ç¶šï¼ˆã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ« ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
                addResult('error-results', 'ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ« ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³', true, 
                    `ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸãŒå‡¦ç†ã‚’ç¶™ç¶š: ${error.message}`);
            }
        }

        async function generateIntegratedReport() {
            try {
                addInfo('report-results', 'çµ±åˆãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™...');

                const report = {
                    timestamp: new Date().toISOString(),
                    testStats: testStats,
                    systemStatus: {
                        mimeTypeErrorHandler: !!mimeTypeErrorHandler,
                        serverConfigDetector: !!serverConfigDetector,
                        scriptPathValidator: !!scriptPathValidator
                    }
                };

                // å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã®çµ±è¨ˆæƒ…å ±ã‚’å–å¾—
                if (scriptPathValidator && scriptPathValidator.getValidationStats) {
                    report.validationStats = scriptPathValidator.getValidationStats();
                }

                if (mimeTypeErrorHandler && mimeTypeErrorHandler.getStatistics) {
                    report.errorHandlerStats = mimeTypeErrorHandler.getStatistics();
                }

                if (serverConfigDetector && serverConfigDetector.getStatistics) {
                    report.serverDetectionStats = serverConfigDetector.getStatistics();
                }

                addResult('report-results', 'çµ±åˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ', true, 
                    'ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæƒ…å ±ã‚’çµ±åˆã—ãŸãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ', report);

                // ã‚µãƒ¼ãƒãƒ¼è¨­å®šæ¨å¥¨äº‹é …ã®ç”Ÿæˆ
                if (serverConfigDetector) {
                    const detailedReport = await serverConfigDetector.generateDetailedReport();
                    addResult('report-results', 'è©³ç´°ã‚µãƒ¼ãƒãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ', true, 
                        'ã‚µãƒ¼ãƒãƒ¼è¨­å®šã®è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ', detailedReport);
                }

            } catch (error) {
                addResult('report-results', 'çµ±åˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ', false, 
                    `ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        function showTroubleshootingGuide() {
            if (!scriptPathValidator || !scriptPathValidator.generateTroubleshootingGuide) {
                addResult('report-results', 'ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰', false, 
                    'ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                return;
            }

            try {
                const guide = scriptPathValidator.generateTroubleshootingGuide();
                addResult('report-results', 'ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰', true, 
                    'åŒ…æ‹¬çš„ãªãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ', guide);

            } catch (error) {
                addResult('report-results', 'ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰', false, 
                    `ã‚¬ã‚¤ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª MIME Type Enhancement System Test initialized');
            updatePerformanceStats();
        });
    </script>
</body>
</html>