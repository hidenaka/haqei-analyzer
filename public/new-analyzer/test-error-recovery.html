<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¨ãƒ©ãƒ¼å›å¾©å‹•ä½œãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background-color: #0d1117;
            color: #c9d1d9;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-header {
            background: #21262d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f85149;
        }
        .test-section {
            background: #161b22;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #30363d;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        .test-pass {
            background: #0d4429;
            border-color: #238636;
            color: #2ea043;
        }
        .test-fail {
            background: #490202;
            border-color: #da3633;
            color: #f85149;
        }
        .test-warn {
            background: #333017;
            border-color: #d29922;
            color: #f0c674;
        }
        .test-info {
            background: #0c2d6b;
            border-color: #1f6feb;
            color: #58a6ff;
        }
        .error-simulation {
            background: #2d1b1e;
            border: 1px solid #da3633;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #21262d;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #30363d;
            min-width: 200px;
        }
        .btn {
            background: #238636;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
            width: 100%;
        }
        .btn:hover {
            background: #2ea043;
        }
        .btn-danger {
            background: #da3633;
        }
        .btn-danger:hover {
            background: #f85149;
        }
        .btn-secondary {
            background: #21262d;
            border: 1px solid #30363d;
        }
        .btn-secondary:hover {
            background: #30363d;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-pass { background-color: #2ea043; }
        .status-fail { background-color: #f85149; }
        .status-warn { background-color: #f0c674; }
        .status-pending { background-color: #6e7681; }
        .log-section {
            background: #010409;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #30363d;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .scenario-card {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        .scenario-active {
            border-color: #d29922;
            background: #2d2613;
        }
        .recovery-status {
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 12px;
        }
        .recovery-success {
            background: #0d4429;
            color: #2ea043;
        }
        .recovery-failed {
            background: #490202;
            color: #f85149;
        }
        .recovery-partial {
            background: #333017;
            color: #f0c674;
        }
    </style>
</head>
<body>
    <div class="control-panel">
        <h3>ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆåˆ¶å¾¡</h3>
        <button class="btn" onclick="startErrorRecoveryTests()">ã‚¨ãƒ©ãƒ¼å›å¾©ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
        <button class="btn btn-danger" onclick="simulateScriptFailure()">ã‚¹ã‚¯ãƒªãƒ—ãƒˆéšœå®³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        <button class="btn btn-danger" onclick="simulateDataCorruption()">ãƒ‡ãƒ¼ã‚¿ç ´æã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        <button class="btn btn-danger" onclick="simulateNetworkError()">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼</button>
        <button class="btn btn-secondary" onclick="resetEnvironment()">ç’°å¢ƒãƒªã‚»ãƒƒãƒˆ</button>
        <button class="btn btn-secondary" onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        <div style="margin-top: 15px;">
            <div>çŠ¶æ…‹: <span id="test-status">å¾…æ©Ÿä¸­</span></div>
            <div>å®Ÿè¡Œä¸­ã‚·ãƒŠãƒªã‚ª: <span id="current-scenario">ãªã—</span></div>
        </div>
    </div>

    <div class="test-container">
        <div class="test-header">
            <h1>ğŸš¨ ã‚¨ãƒ©ãƒ¼å›å¾©å‹•ä½œãƒ†ã‚¹ãƒˆ</h1>
            <p>HaQei Analyzerã®å„ç¨®ã‚¨ãƒ©ãƒ¼çŠ¶æ³ã«ãŠã‘ã‚‹å›å¾©å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã—ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚</p>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª</h2>
            <div id="test-scenarios"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š å›å¾©å‹•ä½œçµæœ</h2>
            <div id="recovery-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ” ã‚¨ãƒ©ãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            <div class="error-simulation">
                <h3>ç¾åœ¨ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹</h3>
                <div id="simulation-status">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾…æ©Ÿä¸­</div>
                <div id="active-errors"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ å®Ÿè¡Œãƒ­ã‚°</h2>
            <div class="log-section" id="error-log">
                <pre>ã‚¨ãƒ©ãƒ¼å›å¾©ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã™ã‚‹ã«ã¯åˆ¶å¾¡ãƒ‘ãƒãƒ«ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</pre>
            </div>
        </div>
    </div>

    <script>
        let errorTestState = {
            isRunning: false,
            currentScenario: null,
            startTime: 0,
            simulatedErrors: [],
            recoveryResults: [],
            logs: []
        };

        const errorScenarios = [
            {
                id: 'script_loading_failure',
                name: 'ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å¤±æ•—',
                description: 'é‡è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãŒå¤±æ•—ã—ãŸå ´åˆã®å›å¾©å‹•ä½œ',
                severity: 'critical',
                test: testScriptLoadingFailureRecovery
            },
            {
                id: 'data_corruption',
                name: 'ãƒ‡ãƒ¼ã‚¿ç ´æ',
                description: 'JSON ãƒ‡ãƒ¼ã‚¿ãŒç ´æã—ã¦ã„ã‚‹å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ',
                severity: 'high',
                test: testDataCorruptionRecovery
            },
            {
                id: 'network_timeout',
                name: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ',
                description: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚‹ãƒªã‚½ãƒ¼ã‚¹èª­ã¿è¾¼ã¿å¤±æ•—',
                severity: 'medium',
                test: testNetworkTimeoutRecovery
            },
            {
                id: 'memory_exhaustion',
                name: 'ãƒ¡ãƒ¢ãƒªä¸è¶³',
                description: 'å¤§é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªä¸è¶³çŠ¶æ³',
                severity: 'high',
                test: testMemoryExhaustionRecovery
            },
            {
                id: 'class_initialization_failure',
                name: 'ã‚¯ãƒ©ã‚¹åˆæœŸåŒ–å¤±æ•—',
                description: 'é‡è¦ãªã‚¯ãƒ©ã‚¹ã®åˆæœŸåŒ–ãŒå¤±æ•—ã—ãŸå ´åˆ',
                severity: 'critical',
                test: testClassInitializationFailureRecovery
            },
            {
                id: 'localstorage_quota_exceeded',
                name: 'LocalStorageå®¹é‡è¶…é',
                description: 'ãƒ–ãƒ©ã‚¦ã‚¶ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å®¹é‡åˆ¶é™ã«é”ã—ãŸå ´åˆ',
                severity: 'medium',
                test: testLocalStorageQuotaRecovery
            },
            {
                id: 'mime_type_error',
                name: 'MIMEã‚¿ã‚¤ãƒ—ã‚¨ãƒ©ãƒ¼',
                description: 'ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®MIMEã‚¿ã‚¤ãƒ—ãŒæ­£ã—ããªã„å ´åˆ',
                severity: 'high',
                test: testMimeTypeErrorRecovery
            },
            {
                id: 'concurrent_loading_conflict',
                name: 'ä¸¦è¡Œèª­ã¿è¾¼ã¿ç«¶åˆ',
                description: 'è¤‡æ•°ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¸¦è¡Œèª­ã¿è¾¼ã¿æ™‚ã®ç«¶åˆçŠ¶æ…‹',
                severity: 'medium',
                test: testConcurrentLoadingConflictRecovery
            }
        ];

        function logError(message, type = 'error') {
            const timestamp = new Date().toISOString().substr(11, 8);
            const logEntry = `[${timestamp}] ${message}`;
            errorTestState.logs.push({ timestamp, message, type });
            
            const logSection = document.getElementById('error-log');
            const logElement = document.createElement('div');
            logElement.textContent = logEntry;
            logElement.className = `log-${type}`;
            logSection.appendChild(logElement);
            logSection.scrollTop = logSection.scrollHeight;
        }

        function updateTestStatus(status) {
            document.getElementById('test-status').textContent = status;
        }

        function updateCurrentScenario(scenario) {
            document.getElementById('current-scenario').textContent = scenario || 'ãªã—';
            errorTestState.currentScenario = scenario;
        }

        function renderTestScenarios() {
            const scenariosDiv = document.getElementById('test-scenarios');
            scenariosDiv.innerHTML = '';

            errorScenarios.forEach(scenario => {
                const card = document.createElement('div');
                card.className = 'scenario-card';
                card.id = `scenario-${scenario.id}`;
                
                const severityColor = {
                    critical: '#f85149',
                    high: '#d29922',
                    medium: '#58a6ff'
                }[scenario.severity];

                card.innerHTML = `
                    <h4 style="margin: 0 0 10px 0; color: ${severityColor};">
                        ${scenario.name} <span style="font-size: 12px;">[${scenario.severity}]</span>
                    </h4>
                    <p style="margin: 0 0 10px 0; font-size: 14px; color: #8b949e;">
                        ${scenario.description}
                    </p>
                    <button class="btn btn-secondary" onclick="runSingleScenario('${scenario.id}')" style="font-size: 11px; padding: 4px 8px; width: auto;">
                        å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                    </button>
                    <div id="scenario-status-${scenario.id}" class="recovery-status" style="display: none;"></div>
                `;

                scenariosDiv.appendChild(card);
            });
        }

        function addRecoveryResult(scenarioId, success, message, details = {}) {
            const result = {
                scenarioId,
                success,
                message,
                details,
                timestamp: Date.now()
            };

            errorTestState.recoveryResults.push(result);

            const resultsDiv = document.getElementById('recovery-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'test-pass' : 'test-fail'}`;
            
            const scenario = errorScenarios.find(s => s.id === scenarioId);
            const statusIcon = success ? 'âœ…' : 'âŒ';
            
            resultDiv.innerHTML = `
                <span class="status-indicator ${success ? 'status-pass' : 'status-fail'}"></span>
                ${statusIcon} <strong>${scenario?.name || scenarioId}</strong>: ${message}
                ${Object.keys(details).length > 0 ? `<br><small><pre>${JSON.stringify(details, null, 2)}</pre></small>` : ''}
            `;
            
            resultsDiv.appendChild(resultDiv);

            // ã‚·ãƒŠãƒªã‚ªã‚«ãƒ¼ãƒ‰ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚‚æ›´æ–°
            const statusDiv = document.getElementById(`scenario-status-${scenarioId}`);
            if (statusDiv) {
                statusDiv.style.display = 'block';
                statusDiv.className = `recovery-status ${success ? 'recovery-success' : 'recovery-failed'}`;
                statusDiv.textContent = message;
            }
        }

        async function startErrorRecoveryTests() {
            if (errorTestState.isRunning) {
                logError('ã‚¨ãƒ©ãƒ¼å›å¾©ãƒ†ã‚¹ãƒˆã¯æ—¢ã«å®Ÿè¡Œä¸­ã§ã™', 'warn');
                return;
            }

            errorTestState.isRunning = true;
            errorTestState.startTime = Date.now();
            errorTestState.recoveryResults = [];
            updateTestStatus('å®Ÿè¡Œä¸­');
            
            logError('ã‚¨ãƒ©ãƒ¼å›å¾©ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            clearResults();

            try {
                for (const scenario of errorScenarios) {
                    updateCurrentScenario(scenario.name);
                    
                    // ã‚·ãƒŠãƒªã‚ªã‚«ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«
                    const card = document.getElementById(`scenario-${scenario.id}`);
                    if (card) card.classList.add('scenario-active');
                    
                    logError(`ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œ: ${scenario.name}`, 'info');
                    
                    try {
                        const result = await scenario.test();
                        addRecoveryResult(
                            scenario.id,
                            result.success,
                            result.message,
                            result.details
                        );
                        
                        logError(
                            `${result.success ? 'âœ…' : 'âŒ'} ${scenario.name}: ${result.message}`,
                            result.success ? 'success' : 'error'
                        );
                    } catch (error) {
                        addRecoveryResult(
                            scenario.id,
                            false,
                            `å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`,
                            { error: error.stack }
                        );
                        logError(`âŒ ${scenario.name}: å®Ÿè¡Œã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
                    }
                    
                    // ã‚·ãƒŠãƒªã‚ªã‚«ãƒ¼ãƒ‰ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’è§£é™¤
                    if (card) card.classList.remove('scenario-active');
                    
                    // çŸ­ã„é…å»¶ã‚’å…¥ã‚Œã‚‹
                    await new Promise(resolve => setTimeout(resolve, 500));
                }

                updateTestStatus('å®Œäº†');
                updateCurrentScenario(null);
                logError('ã‚¨ãƒ©ãƒ¼å›å¾©ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                generateRecoveryReport();
                
            } catch (error) {
                updateTestStatus('ã‚¨ãƒ©ãƒ¼');
                logError(`ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ: ${error.message}`, 'error');
            } finally {
                errorTestState.isRunning = false;
            }
        }

        async function runSingleScenario(scenarioId) {
            const scenario = errorScenarios.find(s => s.id === scenarioId);
            if (!scenario) return;

            updateCurrentScenario(scenario.name);
            logError(`å˜ä½“ã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œ: ${scenario.name}`, 'info');

            const card = document.getElementById(`scenario-${scenario.id}`);
            if (card) card.classList.add('scenario-active');

            try {
                const result = await scenario.test();
                addRecoveryResult(
                    scenario.id,
                    result.success,
                    result.message,
                    result.details
                );
                
                logError(
                    `${result.success ? 'âœ…' : 'âŒ'} ${scenario.name}: ${result.message}`,
                    result.success ? 'success' : 'error'
                );
            } catch (error) {
                addRecoveryResult(
                    scenario.id,
                    false,
                    `å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`,
                    { error: error.stack }
                );
                logError(`âŒ ${scenario.name}: å®Ÿè¡Œã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
            } finally {
                if (card) card.classList.remove('scenario-active');
                updateCurrentScenario(null);
            }
        }

        function generateRecoveryReport() {
            const successful = errorTestState.recoveryResults.filter(r => r.success).length;
            const failed = errorTestState.recoveryResults.filter(r => !r.success).length;
            const total = errorTestState.recoveryResults.length;
            const elapsed = Date.now() - errorTestState.startTime;
            
            logError(`ğŸ“Š å›å¾©ãƒ†ã‚¹ãƒˆçµæœ: ${successful}/${total} æˆåŠŸ (${elapsed}ms)`, 'info');
            
            if (failed > 0) {
                logError(`âš ï¸ ${failed} ã‚·ãƒŠãƒªã‚ªã§å›å¾©ã«å•é¡Œ`, 'warn');
            } else {
                logError('ğŸ‰ ã™ã¹ã¦ã®ã‚·ãƒŠãƒªã‚ªã§é©åˆ‡ãªå›å¾©å‹•ä½œã‚’ç¢ºèª', 'success');
            }
        }

        function clearResults() {
            document.getElementById('recovery-results').innerHTML = '';
        }

        function clearLogs() {
            document.getElementById('error-log').innerHTML = '<pre>ãƒ­ã‚°ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸã€‚</pre>';
            errorTestState.logs = [];
        }

        function resetEnvironment() {
            // ç’°å¢ƒã‚’ãƒªã‚»ãƒƒãƒˆ
            errorTestState.simulatedErrors = [];
            updateSimulationStatus();
            logError('ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'info');
        }

        function simulateScriptFailure() {
            errorTestState.simulatedErrors.push({
                type: 'script_failure',
                timestamp: Date.now(),
                description: 'ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å¤±æ•—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ'
            });
            updateSimulationStatus();
            logError('ğŸš¨ ã‚¹ã‚¯ãƒªãƒ—ãƒˆéšœå®³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã—ãŸ', 'warn');
        }

        function simulateDataCorruption() {
            errorTestState.simulatedErrors.push({
                type: 'data_corruption',
                timestamp: Date.now(),
                description: 'ãƒ‡ãƒ¼ã‚¿ç ´æã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ'
            });
            updateSimulationStatus();
            logError('ğŸš¨ ãƒ‡ãƒ¼ã‚¿ç ´æã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã—ãŸ', 'warn');
        }

        function simulateNetworkError() {
            errorTestState.simulatedErrors.push({
                type: 'network_error',
                timestamp: Date.now(),
                description: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ'
            });
            updateSimulationStatus();
            logError('ğŸš¨ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã—ãŸ', 'warn');
        }

        function updateSimulationStatus() {
            const statusDiv = document.getElementById('simulation-status');
            const errorsDiv = document.getElementById('active-errors');
            
            if (errorTestState.simulatedErrors.length === 0) {
                statusDiv.textContent = 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾…æ©Ÿä¸­';
                errorsDiv.innerHTML = '';
            } else {
                statusDiv.textContent = `${errorTestState.simulatedErrors.length} å€‹ã®ã‚¨ãƒ©ãƒ¼ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆä¸­`;
                errorsDiv.innerHTML = errorTestState.simulatedErrors.map(error => 
                    `<div style="color: #f85149; font-size: 12px; margin: 5px 0;">
                        â€¢ ${error.description} (${new Date(error.timestamp).toLocaleTimeString()})
                    </div>`
                ).join('');
            }
        }

        // å„ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã®å®Ÿè£…

        async function testScriptLoadingFailureRecovery() {
            // ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å¤±æ•—ã®å›å¾©å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆ
            logError('ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å¤±æ•—å›å¾©ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã®å­˜åœ¨ç¢ºèª
            const hasFallbackData = typeof createFallbackHaqeiData === 'function';
            const hasErrorDetection = typeof ErrorDetectionReporter !== 'undefined';
            
            if (!hasFallbackData) {
                return {
                    success: false,
                    message: 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆæ©Ÿèƒ½ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                    details: { hasFallbackData, hasErrorDetection }
                };
            }

            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆãƒ†ã‚¹ãƒˆ
            try {
                const fallbackData = createFallbackHaqeiData();
                const isValidFallback = fallbackData && 
                                       fallbackData.hexagrams_master && 
                                       Array.isArray(fallbackData.hexagrams_master) &&
                                       fallbackData.hexagrams_master.length > 0;

                return {
                    success: isValidFallback,
                    message: isValidFallback ? 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ç”ŸæˆæˆåŠŸ' : 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãŒç„¡åŠ¹',
                    details: {
                        hasFallbackData,
                        hasErrorDetection,
                        fallbackDataValid: isValidFallback,
                        fallbackHexagramCount: fallbackData.hexagrams_master?.length || 0
                    }
                };
            } catch (error) {
                return {
                    success: false,
                    message: `ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`,
                    details: { error: error.message }
                };
            }
        }

        async function testDataCorruptionRecovery() {
            logError('ãƒ‡ãƒ¼ã‚¿ç ´æå›å¾©ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            // å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
            const originalHaqeiData = window.HAQEI_DATA;
            
            try {
                // ãƒ‡ãƒ¼ã‚¿ã‚’æ„å›³çš„ã«ç ´æ
                window.HAQEI_DATA = { corrupted: true };
                
                // ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ãŒã‚ã‚‹ã‹ãƒ†ã‚¹ãƒˆ
                const hasDataValidation = typeof DataManager !== 'undefined';
                
                if (hasDataValidation) {
                    try {
                        const dataManager = new DataManager();
                        // ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                        const hasValidationMethod = typeof dataManager.validateData === 'function';
                        
                        return {
                            success: true,
                            message: 'ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½',
                            details: {
                                hasDataManager: true,
                                hasValidationMethod
                            }
                        };
                    } catch (error) {
                        return {
                            success: false,
                            message: `DataManageråˆæœŸåŒ–å¤±æ•—: ${error.message}`,
                            details: { error: error.message }
                        };
                    }
                } else {
                    return {
                        success: false,
                        message: 'DataManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                        details: { hasDataManager: false }
                    };
                }
            } finally {
                // ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                window.HAQEI_DATA = originalHaqeiData;
            }
        }

        async function testNetworkTimeoutRecovery() {
            logError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå›å¾©ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            // ãƒ‘ã‚¹æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å­˜åœ¨ç¢ºèª
            const hasPathValidator = typeof ScriptPathValidator !== 'undefined';
            
            if (!hasPathValidator) {
                return {
                    success: false,
                    message: 'ScriptPathValidatorãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                    details: { hasPathValidator: false }
                };
            }

            try {
                const validator = new ScriptPathValidator({ timeout: 1000 });
                const hasValidateMethod = typeof validator.validatePath === 'function';
                
                return {
                    success: hasValidateMethod,
                    message: hasValidateMethod ? 'ãƒ‘ã‚¹æ¤œè¨¼æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½' : 'ãƒ‘ã‚¹æ¤œè¨¼ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                    details: {
                        hasPathValidator: true,
                        hasValidateMethod
                    }
                };
            } catch (error) {
                return {
                    success: false,
                    message: `ScriptPathValidatoråˆæœŸåŒ–å¤±æ•—: ${error.message}`,
                    details: { error: error.message }
                };
            }
        }

        async function testMemoryExhaustionRecovery() {
            logError('ãƒ¡ãƒ¢ãƒªä¸è¶³å›å¾©ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–æ©Ÿèƒ½ã®å­˜åœ¨ç¢ºèª
            const hasPerformanceMonitor = typeof PerformanceMonitor !== 'undefined';
            
            if (!hasPerformanceMonitor) {
                return {
                    success: false,
                    message: 'PerformanceMonitorãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                    details: { hasPerformanceMonitor: false }
                };
            }

            try {
                const monitor = new PerformanceMonitor({ enableMemoryMonitoring: true });
                const hasMemorySnapshot = typeof monitor.takeMemorySnapshot === 'function';
                
                // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æ¸¬å®šãƒ†ã‚¹ãƒˆ
                if (hasMemorySnapshot) {
                    monitor.takeMemorySnapshot('test');
                }

                return {
                    success: hasMemorySnapshot,
                    message: hasMemorySnapshot ? 'ãƒ¡ãƒ¢ãƒªç›£è¦–æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½' : 'ãƒ¡ãƒ¢ãƒªç›£è¦–ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                    details: {
                        hasPerformanceMonitor: true,
                        hasMemorySnapshot,
                        memoryAPI: typeof performance.memory !== 'undefined'
                    }
                };
            } catch (error) {
                return {
                    success: false,
                    message: `PerformanceMonitoråˆæœŸåŒ–å¤±æ•—: ${error.message}`,
                    details: { error: error.message }
                };
            }
        }

        async function testClassInitializationFailureRecovery() {
            logError('ã‚¯ãƒ©ã‚¹åˆæœŸåŒ–å¤±æ•—å›å¾©ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            // é‡è¦ãªã‚¯ãƒ©ã‚¹ã®å­˜åœ¨ç¢ºèª
            const criticalClasses = {
                BaseComponent: typeof BaseComponent !== 'undefined',
                DataManager: typeof DataManager !== 'undefined',
                Calculator: typeof Calculator !== 'undefined'
            };

            const missingClasses = Object.keys(criticalClasses).filter(key => !criticalClasses[key]);
            
            if (missingClasses.length > 0) {
                return {
                    success: false,
                    message: `é‡è¦ãªã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${missingClasses.join(', ')}`,
                    details: { criticalClasses, missingClasses }
                };
            }

            // ã‚¯ãƒ©ã‚¹ã®åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
            try {
                if (typeof DataManager !== 'undefined') {
                    const dm = new DataManager();
                    const hasRequiredMethods = typeof dm.initialize === 'function';
                    
                    return {
                        success: true,
                        message: 'ã‚¯ãƒ©ã‚¹åˆæœŸåŒ–æ©Ÿèƒ½ãŒæ­£å¸¸',
                        details: {
                            criticalClasses,
                            hasRequiredMethods
                        }
                    };
                }
            } catch (error) {
                return {
                    success: false,
                    message: `ã‚¯ãƒ©ã‚¹åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`,
                    details: { error: error.message, criticalClasses }
                };
            }
        }

        async function testLocalStorageQuotaRecovery() {
            logError('LocalStorageå®¹é‡è¶…éå›å¾©ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            // StorageManagerã®å­˜åœ¨ç¢ºèª
            const hasStorageManager = typeof StorageManager !== 'undefined';
            
            if (!hasStorageManager) {
                return {
                    success: false,
                    message: 'StorageManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                    details: { hasStorageManager: false }
                };
            }

            try {
                const storage = new StorageManager();
                const hasQuotaHandling = typeof storage.handleQuotaExceeded === 'function';
                
                // LocalStorageã®åˆ©ç”¨å¯èƒ½æ€§ãƒ†ã‚¹ãƒˆ
                const isLocalStorageAvailable = (() => {
                    try {
                        const test = '__localStorage_test__';
                        localStorage.setItem(test, test);
                        localStorage.removeItem(test);
                        return true;
                    } catch (e) {
                        return false;
                    }
                })();

                return {
                    success: isLocalStorageAvailable,
                    message: isLocalStorageAvailable ? 'ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½' : 'LocalStorageãŒåˆ©ç”¨ã§ãã¾ã›ã‚“',
                    details: {
                        hasStorageManager: true,
                        hasQuotaHandling,
                        isLocalStorageAvailable
                    }
                };
            } catch (error) {
                return {
                    success: false,
                    message: `StorageManageråˆæœŸåŒ–å¤±æ•—: ${error.message}`,
                    details: { error: error.message }
                };
            }
        }

        async function testMimeTypeErrorRecovery() {
            logError('MIMEã‚¿ã‚¤ãƒ—ã‚¨ãƒ©ãƒ¼å›å¾©ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            // ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ ã®å­˜åœ¨ç¢ºèª
            const hasErrorReporter = typeof ErrorDetectionReporter !== 'undefined';
            
            if (!hasErrorReporter) {
                return {
                    success: false,
                    message: 'ErrorDetectionReporterãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                    details: { hasErrorReporter: false }
                };
            }

            try {
                const reporter = new ErrorDetectionReporter({ enableAutoDetection: true });
                const hasMimeDetection = typeof reporter.detectMimeTypeError === 'function';
                
                return {
                    success: true,
                    message: 'MIMEã‚¿ã‚¤ãƒ—ã‚¨ãƒ©ãƒ¼æ¤œå‡ºæ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½',
                    details: {
                        hasErrorReporter: true,
                        hasMimeDetection
                    }
                };
            } catch (error) {
                return {
                    success: false,
                    message: `ErrorDetectionReporteråˆæœŸåŒ–å¤±æ•—: ${error.message}`,
                    details: { error: error.message }
                };
            }
        }

        async function testConcurrentLoadingConflictRecovery() {
            logError('ä¸¦è¡Œèª­ã¿è¾¼ã¿ç«¶åˆå›å¾©ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            // ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿çŠ¶æ…‹ç®¡ç†ã®å­˜åœ¨ç¢ºèª
            const hasLoadingStatus = typeof window.scriptLoadingStatus !== 'undefined';
            
            if (!hasLoadingStatus) {
                return {
                    success: false,
                    message: 'ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿çŠ¶æ…‹ç®¡ç†ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                    details: { hasLoadingStatus: false }
                };
            }

            const loadingStatus = window.scriptLoadingStatus;
            const hasDetailedStatus = typeof loadingStatus.detailedStatus !== 'undefined';
            const hasLoadAttempts = typeof loadingStatus.loadAttempts !== 'undefined';
            
            return {
                success: hasDetailedStatus && hasLoadAttempts,
                message: (hasDetailedStatus && hasLoadAttempts) ? 
                    'ä¸¦è¡Œèª­ã¿è¾¼ã¿çŠ¶æ…‹ç®¡ç†ãŒæ­£å¸¸' : 
                    'èª­ã¿è¾¼ã¿çŠ¶æ…‹ç®¡ç†ã«ä¸è¶³',
                details: {
                    hasLoadingStatus: true,
                    hasDetailedStatus,
                    hasLoadAttempts,
                    loadAttempts: loadingStatus.loadAttempts || 0
                }
            };
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            renderTestScenarios();
            updateSimulationStatus();
            logError('ã‚¨ãƒ©ãƒ¼å›å¾©ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'info');
            updateTestStatus('å¾…æ©Ÿä¸­');
        });
    </script>
</body>
</html>