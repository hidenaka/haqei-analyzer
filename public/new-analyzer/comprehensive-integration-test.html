<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HaQei Analyzer - åŒ…æ‹¬çš„çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #007bff;
      }
      .test-result {
        margin: 8px 0;
        padding: 12px;
        border-radius: 6px;
        font-size: 14px;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      .info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .critical {
        background-color: #f5c6cb;
        color: #721c24;
        border: 2px solid #dc3545;
        font-weight: bold;
      }

      pre {
        background-color: #f8f9fa;
        padding: 12px;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 12px;
        border: 1px solid #e9ecef;
      }

      button {
        padding: 12px 24px;
        margin: 8px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
      }
      .test-btn {
        background-color: #007bff;
        color: white;
      }
      .test-btn:hover {
        background-color: #0056b3;
      }
      .reset-btn {
        background-color: #6c757d;
        color: white;
      }
      .reset-btn:hover {
        background-color: #545b62;
      }
      .success-btn {
        background-color: #28a745;
        color: white;
      }
      .success-btn:hover {
        background-color: #1e7e34;
      }

      .progress-bar {
        width: 100%;
        height: 20px;
        background-color: #e9ecef;
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
      }
      .progress-fill {
        height: 100%;
        background-color: #007bff;
        transition: width 0.3s ease;
        border-radius: 10px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 15px 0;
      }
      .stat-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        border: 1px solid #dee2e6;
      }
      .stat-number {
        font-size: 24px;
        font-weight: bold;
        color: #007bff;
      }
      .stat-label {
        font-size: 12px;
        color: #6c757d;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ§ª HaQei Analyzer - åŒ…æ‹¬çš„çµ±åˆãƒ†ã‚¹ãƒˆ</h1>

      <div class="test-section">
        <h2>ãƒ†ã‚¹ãƒˆåˆ¶å¾¡</h2>
        <button class="test-btn" onclick="runFullIntegrationTest()">
          ğŸš€ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        </button>
        <button class="test-btn" onclick="runLoadingTest()">
          ğŸ“ èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        </button>
        <button class="test-btn" onclick="runFallbackTest()">
          ğŸ›¡ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
        </button>
        <button class="success-btn" onclick="runPerformanceTest()">
          âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        </button>
        <button class="reset-btn" onclick="resetAllTests()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
      </div>

      <div class="test-section">
        <h2>ãƒ†ã‚¹ãƒˆé€²æ—</h2>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
        <div id="progress-text">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
      </div>

      <div class="test-section">
        <h2>çµ±è¨ˆæƒ…å ±</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="total-tests">0</div>
            <div class="stat-label">ç·ãƒ†ã‚¹ãƒˆæ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="passed-tests">0</div>
            <div class="stat-label">æˆåŠŸ</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="failed-tests">0</div>
            <div class="stat-label">å¤±æ•—</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="load-time">0ms</div>
            <div class="stat-label">èª­ã¿è¾¼ã¿æ™‚é–“</div>
          </div>
        </div>
      </div>

      <div id="test-results"></div>
    </div>

    <!-- å®Ÿéš›ã®analyzer.htmlã¨åŒã˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿é †åºã§ãƒ†ã‚¹ãƒˆ -->
    <!-- 1. ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script src="js/utils/validators.js"></script>
    <script src="js/utils/animations.js"></script>

    <!-- 2. ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="../js/data/data_box.js"></script>
    <script src="../js/data/questions.js"></script>
    <script src="../js/data/vectors.js"></script>
    <script src="../js/data/hexagrams.js"></script>
    <script src="../js/data/hexagram_details.js"></script>
    <script src="../js/data/compatibility_definition.js"></script>
    <script src="../js/data/compatibility_matrix.js"></script>
    <script src="../js/data/action_plans.js"></script>

    <!-- 3. åŸºåº•ã‚¯ãƒ©ã‚¹ -->
    <script src="js/core/BaseComponent.js"></script>

    <!-- 4. ã‚³ã‚¢ã‚¯ãƒ©ã‚¹ -->
    <script src="js/core/DataManager.js"></script>
    <script src="js/core/Calculator.js"></script>
    <script src="js/core/StorageManager.js"></script>

    <!-- 5. ã‚¨ãƒ³ã‚¸ãƒ³ã‚¯ãƒ©ã‚¹ -->
    <script src="js/core/Engine.js"></script>
    <script src="js/core/TripleOSEngine.js"></script>
    <script src="js/core/EightDimensionAnalysisEngine.js"></script>
    <script src="js/core/RelationshipVisualizationEngine.js"></script>

    <!-- 5.5. ç‰¹æ®Šæ©Ÿèƒ½ -->
    <script src="js/core/CompatibilityDataLoader.js"></script>

    <!-- 6. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ -->
    <script src="js/components/WelcomeScreen.js"></script>
    <script src="js/components/QuestionFlow.js"></script>
    <script src="js/components/AnalysisView.js"></script>
    <script src="js/components/ResultsView.js"></script>
    <script src="js/components/TripleOSResultsView.js"></script>
    <script src="js/components/InsightPanel.js"></script>

    <!-- ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
      // ãƒ†ã‚¹ãƒˆçµ±è¨ˆ
      let testStats = {
        total: 0,
        passed: 0,
        failed: 0,
        startTime: 0,
        endTime: 0,
      };

      // ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤º
      function addTestResult(message, type = "info", section = "general") {
        const resultsDiv = document.getElementById("test-results");

        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
        let sectionDiv = document.getElementById(`section-${section}`);
        if (!sectionDiv) {
          sectionDiv = document.createElement("div");
          sectionDiv.id = `section-${section}`;
          sectionDiv.className = "test-section";
          sectionDiv.innerHTML = `<h3>ğŸ“‹ ${section.toUpperCase()} ãƒ†ã‚¹ãƒˆçµæœ</h3>`;
          resultsDiv.appendChild(sectionDiv);
        }

        const resultDiv = document.createElement("div");
        resultDiv.className = `test-result ${type}`;
        resultDiv.innerHTML = message;
        sectionDiv.appendChild(resultDiv);

        // çµ±è¨ˆæ›´æ–°
        if (type === "success") testStats.passed++;
        if (type === "error" || type === "critical") testStats.failed++;
        testStats.total++;

        updateStats();
      }

      // çµ±è¨ˆæƒ…å ±æ›´æ–°
      function updateStats() {
        document.getElementById("total-tests").textContent = testStats.total;
        document.getElementById("passed-tests").textContent = testStats.passed;
        document.getElementById("failed-tests").textContent = testStats.failed;

        if (testStats.endTime > testStats.startTime) {
          document.getElementById("load-time").textContent = `${
            testStats.endTime - testStats.startTime
          }ms`;
        }
      }

      // é€²æ—æ›´æ–°
      function updateProgress(percentage, text) {
        document.getElementById("progress-fill").style.width = `${percentage}%`;
        document.getElementById("progress-text").textContent = text;
      }

      // ãƒ†ã‚¹ãƒˆãƒªã‚»ãƒƒãƒˆ
      function resetAllTests() {
        document.getElementById("test-results").innerHTML = "";
        testStats = {
          total: 0,
          passed: 0,
          failed: 0,
          startTime: 0,
          endTime: 0,
        };
        updateStats();
        updateProgress(0, "ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...");
        addTestResult(
          "ğŸ”„ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸ",
          "info",
          "system"
        );
      }

      // 1. èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
      function runLoadingTest() {
        addTestResult(
          "<h4>ğŸ“ ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ»ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆé–‹å§‹</h4>",
          "info",
          "loading"
        );
        testStats.startTime = Date.now();
        updateProgress(10, "èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...");

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ†ã‚¹ãƒˆ
        const utilityTests = [
          {
            name: "validators.js",
            check: () =>
              typeof window.validators !== "undefined" ||
              typeof validateEmail !== "undefined",
          },
          {
            name: "animations.js",
            check: () =>
              typeof window.animations !== "undefined" ||
              typeof fadeIn !== "undefined",
          },
        ];

        utilityTests.forEach((test) => {
          try {
            if (test.check()) {
              addTestResult(
                `âœ… ${test.name} ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ`,
                "success",
                "loading"
              );
            } else {
              addTestResult(
                `âš ï¸ ${test.name} ã®èª­ã¿è¾¼ã¿ç¢ºèªãŒã§ãã¾ã›ã‚“ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰`,
                "warning",
                "loading"
              );
            }
          } catch (error) {
            addTestResult(
              `âŒ ${test.name} ãƒ†ã‚¹ãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼: ${error.message}`,
              "error",
              "loading"
            );
          }
        });

        updateProgress(30, "ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèªä¸­...");

        // ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ
        const dataTests = [
          { name: "HAQEI_DATA", var: window.HAQEI_DATA, critical: true },
          {
            name: "WORLDVIEW_QUESTIONS",
            var: window.WORLDVIEW_QUESTIONS,
            critical: true,
          },
          {
            name: "SCENARIO_QUESTIONS",
            var: window.SCENARIO_QUESTIONS,
            critical: true,
          },
          {
            name: "H64_8D_VECTORS",
            var: window.H64_8D_VECTORS,
            critical: true,
          },
          {
            name: "HEXAGRAM_DETAILS",
            var: window.HEXAGRAM_DETAILS,
            critical: false,
          },
          {
            name: "hexagrams_master",
            var: window.hexagrams_master,
            critical: false,
          },
        ];

        dataTests.forEach((test) => {
          if (typeof test.var !== "undefined") {
            addTestResult(
              `âœ… ${test.name} ãŒæ­£å¸¸ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™`,
              "success",
              "loading"
            );

            // ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®è©³ç´°ãƒã‚§ãƒƒã‚¯
            if (
              test.name === "HAQEI_DATA" &&
              test.var &&
              typeof test.var === "object"
            ) {
              const keys = Object.keys(test.var);
              addTestResult(
                `ğŸ“Š HAQEI_DATA æ§‹é€ : ${keys.join(", ")}`,
                "info",
                "loading"
              );
            }
            if (
              test.name === "WORLDVIEW_QUESTIONS" &&
              Array.isArray(test.var)
            ) {
              addTestResult(
                `ğŸ“Š ä¾¡å€¤è¦³è³ªå•æ•°: ${test.var.length}`,
                "info",
                "loading"
              );
            }
            if (
              test.name === "H64_8D_VECTORS" &&
              test.var &&
              typeof test.var === "object"
            ) {
              const vectorCount = Object.keys(test.var).length;
              addTestResult(
                `ğŸ“Š ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿æ•°: ${vectorCount}`,
                "info",
                "loading"
              );
            }
          } else {
            const resultType = test.critical ? "critical" : "warning";
            addTestResult(
              `${test.critical ? "ğŸš¨" : "âš ï¸"} ${
                test.name
              } ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“`,
              resultType,
              "loading"
            );
          }
        });

        updateProgress(60, "ã‚¯ãƒ©ã‚¹å®šç¾©ç¢ºèªä¸­...");

        // ã‚¯ãƒ©ã‚¹å®šç¾©ãƒ†ã‚¹ãƒˆ
        const classTests = [
          { name: "BaseComponent", critical: true },
          { name: "DataManager", critical: true },
          { name: "Calculator", critical: true },
          { name: "TripleOSEngine", critical: true },
          { name: "StorageManager", critical: true },
          { name: "WelcomeScreen", critical: true },
          { name: "QuestionFlow", critical: true },
          { name: "Engine", critical: false },
          { name: "CompatibilityDataLoader", critical: false },
        ];

        classTests.forEach((test) => {
          if (typeof window[test.name] !== "undefined") {
            addTestResult(
              `âœ… ${test.name} ã‚¯ãƒ©ã‚¹ãŒæ­£å¸¸ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™`,
              "success",
              "loading"
            );
          } else {
            const resultType = test.critical ? "critical" : "warning";
            addTestResult(
              `${test.critical ? "ğŸš¨" : "âš ï¸"} ${
                test.name
              } ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“`,
              resultType,
              "loading"
            );
          }
        });

        testStats.endTime = Date.now();
        updateProgress(100, "èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå®Œäº†");
        addTestResult(
          `ğŸ¯ èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå®Œäº† - å®Ÿè¡Œæ™‚é–“: ${
            testStats.endTime - testStats.startTime
          }ms`,
          "success",
          "loading"
        );
      }

      // 2. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
      function runFallbackTest() {
        addTestResult(
          "<h4>ğŸ›¡ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹</h4>",
          "info",
          "fallback"
        );
        updateProgress(10, "ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...");

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®å­˜åœ¨ç¢ºèª
        const fallbackFunctions = [
          "createFallbackHaqeiData",
          "createFallbackQuestions",
          "createFallbackVectors",
          "createFallbackHexagramDetails",
        ];

        fallbackFunctions.forEach((funcName) => {
          if (typeof window[funcName] === "function") {
            addTestResult(
              `âœ… ${funcName} é–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™`,
              "success",
              "fallback"
            );

            // å®Ÿéš›ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦ãƒ†ã‚¹ãƒˆ
            try {
              const testData = window[funcName]();
              if (testData && typeof testData === "object") {
                addTestResult(
                  `âœ… ${funcName} ãŒæ­£å¸¸ãªãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¾ã—ãŸ`,
                  "success",
                  "fallback"
                );
              } else {
                addTestResult(
                  `âš ï¸ ${funcName} ãŒç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¾ã—ãŸ`,
                  "warning",
                  "fallback"
                );
              }
            } catch (error) {
              addTestResult(
                `âŒ ${funcName} å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼: ${error.message}`,
                "error",
                "fallback"
              );
            }
          } else {
            addTestResult(
              `âŒ ${funcName} é–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“`,
              "error",
              "fallback"
            );
          }
        });

        updateProgress(100, "ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Œäº†");
        addTestResult(
          "ğŸ¯ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Œäº†",
          "success",
          "fallback"
        );
      }

      // 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
      function runPerformanceTest() {
        addTestResult(
          "<h4>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹</h4>",
          "info",
          "performance"
        );
        updateProgress(10, "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...");

        const startTime = performance.now();

        // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯
        if (performance.memory) {
          const memory = performance.memory;
          const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024);
          const totalMB = Math.round(memory.totalJSHeapSize / 1024 / 1024);
          const limitMB = Math.round(memory.jsHeapSizeLimit / 1024 / 1024);

          addTestResult(
            `ğŸ’¾ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${usedMB}MB / ${totalMB}MB (åˆ¶é™: ${limitMB}MB)`,
            "info",
            "performance"
          );

          if (usedMB < 50) {
            addTestResult(
              "âœ… ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã¯è‰¯å¥½ã§ã™",
              "success",
              "performance"
            );
          } else if (usedMB < 100) {
            addTestResult(
              "âš ï¸ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã¯æ™®é€šã§ã™",
              "warning",
              "performance"
            );
          } else {
            addTestResult(
              "âŒ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå¤šã™ãã¾ã™",
              "error",
              "performance"
            );
          }
        }

        // DOMè¦ç´ æ•°ãƒã‚§ãƒƒã‚¯
        const domElements = document.querySelectorAll("*").length;
        addTestResult(`ğŸ—ï¸ DOMè¦ç´ æ•°: ${domElements}`, "info", "performance");

        // ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¿ã‚°æ•°ãƒã‚§ãƒƒã‚¯
        const scriptTags = document.querySelectorAll("script").length;
        addTestResult(
          `ğŸ“œ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¿ã‚°æ•°: ${scriptTags}`,
          "info",
          "performance"
        );

        const endTime = performance.now();
        const testDuration = Math.round(endTime - startTime);

        addTestResult(
          `â±ï¸ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“: ${testDuration}ms`,
          "info",
          "performance"
        );

        updateProgress(100, "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†");
        addTestResult("ğŸ¯ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†", "success", "performance");
      }

      // 4. å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆ
      function runFullIntegrationTest() {
        resetAllTests();
        addTestResult("<h2>ğŸš€ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹</h2>", "info", "integration");

        testStats.startTime = Date.now();

        // é †æ¬¡ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        setTimeout(() => {
          runLoadingTest();
          setTimeout(() => {
            runFallbackTest();
            setTimeout(() => {
              runPerformanceTest();

              // æœ€çµ‚çµæœ
              testStats.endTime = Date.now();
              const totalTime = testStats.endTime - testStats.startTime;

              addTestResult(
                `<h3>ğŸ‰ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†</h3>`,
                "success",
                "integration"
              );
              addTestResult(
                `â±ï¸ ç·å®Ÿè¡Œæ™‚é–“: ${totalTime}ms`,
                "info",
                "integration"
              );
              addTestResult(
                `ğŸ“Š æˆåŠŸç‡: ${Math.round(
                  (testStats.passed / testStats.total) * 100
                )}%`,
                "info",
                "integration"
              );

              if (testStats.failed === 0) {
                addTestResult(
                  "ğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸï¼",
                  "success",
                  "integration"
                );
              } else {
                addTestResult(
                  `âš ï¸ ${testStats.failed}å€‹ã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ`,
                  "warning",
                  "integration"
                );
              }

              updateProgress(100, "å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†");
            }, 500);
          }, 500);
        }, 100);
      }

      // åˆæœŸåŒ–
      document.addEventListener("DOMContentLoaded", function () {
        addTestResult("ğŸ“‹ åŒ…æ‹¬çš„çµ±åˆãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†", "info", "system");
        addTestResult(
          "ğŸ’¡ å„ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€HaQei Analyzerã®å‹•ä½œã‚’ç¢ºèªã§ãã¾ã™",
          "info",
          "system"
        );
        updateProgress(0, "ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...");
      });
    </script>
  </body>
</html>
