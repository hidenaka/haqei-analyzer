<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-result {
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      .info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      pre {
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .test-btn {
        background-color: #007bff;
        color: white;
      }
      .reset-btn {
        background-color: #6c757d;
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h1>
    <div>
      <button class="test-btn" onclick="testNormalLoading()">
        é€šå¸¸èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
      </button>
      <button class="test-btn" onclick="testFallbackSystem()">
        ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
      </button>
      <button class="reset-btn" onclick="resetTest()">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    <div id="test-results"></div>

    <!-- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®ã¿ã‚’èª­ã¿è¾¼ã¿ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ„å›³çš„ã«èª­ã¿è¾¼ã¾ãªã„ï¼‰ -->
    <script>
      // ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½œæˆé–¢æ•°
      function createFallbackHaqeiData() {
        console.warn("âš ï¸ [Fallback] ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆä¸­...");

        return {
          hexagrams: {},
          hexagrams_master: [
            {
              hexagram_id: 1,
              name_jp: "ä¹¾ç‚ºå¤©",
              reading: "ã‘ã‚“ã„ã¦ã‚“",
              catchphrase: "å¤©ç¿”ã‘ã‚‹é¾ã®ã‚ˆã†ãªã€å¤©æ€§ã®ãƒªãƒ¼ãƒ€ãƒ¼",
              upper_trigram_id: 1,
              lower_trigram_id: 1,
              description: "ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ - åŸºæœ¬çš„ãªå¦æƒ…å ±",
              keywords: "å‰µé€ ,ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—,åŠ›",
            },
          ],
          os_manual: {},
          trigrams_master: [],
          element_relationships: [],
          action_plans: {},
          sho_den: {},
          tai_sho_den: {},
          jo_ka_den: {},
          zatsu_ka_den: {},
          tuan_den: {},
        };
      }

      // ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è³ªå•ãƒ‡ãƒ¼ã‚¿ä½œæˆé–¢æ•°
      function createFallbackQuestions() {
        console.warn("âš ï¸ [Fallback] ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è³ªå•ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆä¸­...");

        return [
          {
            id: "q1",
            text: "ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è³ªå•: ã‚ãªãŸã®åŸºæœ¬çš„ãªä¾¡å€¤è¦³ã¯ï¼Ÿ",
            options: [
              {
                value: "A",
                text: "å‰µé€ æ€§ã‚’é‡è¦–ã™ã‚‹",
                scoring_tags: [{ key: "ä¹¾_å‰µé€ æ€§", value: 3.0 }],
              },
              {
                value: "B",
                text: "å®‰å®šæ€§ã‚’é‡è¦–ã™ã‚‹",
                scoring_tags: [{ key: "è‰®_å®‰å®šæ€§", value: 3.0 }],
              },
            ],
          },
        ];
      }

      // ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ä½œæˆé–¢æ•°
      function createFallbackVectors() {
        console.warn(
          "âš ï¸ [Fallback] ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆä¸­..."
        );

        const fallbackVectors = {};
        for (let i = 1; i <= 64; i++) {
          fallbackVectors[i] = {
            ä¹¾_å‰µé€ æ€§: 5,
            éœ‡_è¡Œå‹•æ€§: 5,
            å_æ¢æ±‚æ€§: 5,
            è‰®_å®‰å®šæ€§: 5,
            å¤_å—å®¹æ€§: 5,
            å·½_é©å¿œæ€§: 5,
            é›¢_è¡¨ç¾æ€§: 5,
            å…Œ_èª¿å’Œæ€§: 5,
          };
        }
        return fallbackVectors;
      }

      function addTestResult(message, type = "info") {
        const resultsDiv = document.getElementById("test-results");
        const resultDiv = document.createElement("div");
        resultDiv.className = `test-result ${type}`;
        resultDiv.innerHTML = message;
        resultsDiv.appendChild(resultDiv);
      }

      function resetTest() {
        document.getElementById("test-results").innerHTML = "";
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ã‚¯ãƒªã‚¢
        delete window.HAQEI_DATA;
        delete window.WORLDVIEW_QUESTIONS;
        delete window.SCENARIO_QUESTIONS;
        delete window.H64_8D_VECTORS;
        delete window.HEXAGRAM_DETAILS;
        addTestResult("ğŸ”„ ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ", "info");
      }

      function testNormalLoading() {
        addTestResult("<h3>é€šå¸¸èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆé–‹å§‹</h3>", "info");

        // å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‹•çš„ã«èª­ã¿è¾¼ã¿
        const dataFiles = [
          "../js/data/data_box.js",
          "../js/data/questions.js",
          "../js/data/vectors.js",
          "../js/data/hexagram_details.js",
        ];

        let loadedCount = 0;
        const totalFiles = dataFiles.length;

        dataFiles.forEach((file, index) => {
          const script = document.createElement("script");
          script.src = file;
          script.onload = () => {
            loadedCount++;
            addTestResult(`âœ… ${file} ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ`, "success");

            if (loadedCount === totalFiles) {
              // ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã®æ¤œè¨¼
              setTimeout(() => {
                validateNormalLoading();
              }, 100);
            }
          };
          script.onerror = () => {
            addTestResult(`âŒ ${file} ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ`, "error");
          };
          document.head.appendChild(script);
        });
      }

      function validateNormalLoading() {
        addTestResult("<h4>é€šå¸¸èª­ã¿è¾¼ã¿æ¤œè¨¼çµæœ</h4>", "info");

        const requiredData = [
          { name: "HAQEI_DATA", var: window.HAQEI_DATA },
          { name: "WORLDVIEW_QUESTIONS", var: window.WORLDVIEW_QUESTIONS },
          { name: "SCENARIO_QUESTIONS", var: window.SCENARIO_QUESTIONS },
          { name: "H64_8D_VECTORS", var: window.H64_8D_VECTORS },
          { name: "HEXAGRAM_DETAILS", var: window.HEXAGRAM_DETAILS },
        ];

        let successCount = 0;
        requiredData.forEach((data) => {
          if (typeof data.var !== "undefined") {
            addTestResult(
              `âœ… ${data.name} ãŒæ­£å¸¸ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™`,
              "success"
            );
            successCount++;
          } else {
            addTestResult(`âŒ ${data.name} ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“`, "error");
          }
        });

        if (successCount === requiredData.length) {
          addTestResult(
            `ğŸ‰ é€šå¸¸èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆæˆåŠŸ (${successCount}/${requiredData.length})`,
            "success"
          );
        } else {
          addTestResult(
            `âš ï¸ é€šå¸¸èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆéƒ¨åˆ†çš„æˆåŠŸ (${successCount}/${requiredData.length})`,
            "warning"
          );
        }
      }

      function testFallbackSystem() {
        addTestResult("<h3>ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹</h3>", "info");

        // ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ãªã„çŠ¶æ…‹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        const missingData = [];

        if (typeof window.HAQEI_DATA === "undefined") {
          missingData.push("HAQEI_DATA");
        }
        if (typeof window.WORLDVIEW_QUESTIONS === "undefined") {
          missingData.push("WORLDVIEW_QUESTIONS");
        }
        if (typeof window.SCENARIO_QUESTIONS === "undefined") {
          missingData.push("SCENARIO_QUESTIONS");
        }
        if (typeof window.H64_8D_VECTORS === "undefined") {
          missingData.push("H64_8D_VECTORS");
        }

        addTestResult(
          `ğŸ“Š ä¸è¶³ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿: ${missingData.join(", ")}`,
          "info"
        );

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œ
        if (missingData.includes("HAQEI_DATA")) {
          addTestResult(
            "ğŸ”§ HAQEI_DATA ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œä¸­...",
            "warning"
          );
          window.HAQEI_DATA = createFallbackHaqeiData();
          addTestResult(
            "âœ… HAQEI_DATA ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãŒä½œæˆã•ã‚Œã¾ã—ãŸ",
            "success"
          );
        }

        if (missingData.includes("WORLDVIEW_QUESTIONS")) {
          addTestResult(
            "ğŸ”§ WORLDVIEW_QUESTIONS ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œä¸­...",
            "warning"
          );
          window.WORLDVIEW_QUESTIONS = createFallbackQuestions();
          addTestResult(
            "âœ… WORLDVIEW_QUESTIONS ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãŒä½œæˆã•ã‚Œã¾ã—ãŸ",
            "success"
          );
        }

        if (missingData.includes("SCENARIO_QUESTIONS")) {
          addTestResult(
            "ğŸ”§ SCENARIO_QUESTIONS ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œä¸­...",
            "warning"
          );
          window.SCENARIO_QUESTIONS = createFallbackQuestions();
          addTestResult(
            "âœ… SCENARIO_QUESTIONS ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãŒä½œæˆã•ã‚Œã¾ã—ãŸ",
            "success"
          );
        }

        if (missingData.includes("H64_8D_VECTORS")) {
          addTestResult(
            "ğŸ”§ H64_8D_VECTORS ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œä¸­...",
            "warning"
          );
          window.H64_8D_VECTORS = createFallbackVectors();
          addTestResult(
            "âœ… H64_8D_VECTORS ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãŒä½œæˆã•ã‚Œã¾ã—ãŸ",
            "success"
          );
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯çµæœã®æ¤œè¨¼
        setTimeout(() => {
          validateFallbackData();
        }, 100);
      }

      function validateFallbackData() {
        addTestResult("<h4>ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼çµæœ</h4>", "info");

        // HAQEI_DATA ã®æ¤œè¨¼
        if (window.HAQEI_DATA && typeof window.HAQEI_DATA === "object") {
          const keys = Object.keys(window.HAQEI_DATA);
          addTestResult(
            `âœ… HAQEI_DATA æ§‹é€ ç¢ºèª: ${keys.join(", ")}`,
            "success"
          );

          if (
            window.HAQEI_DATA.hexagrams_master &&
            Array.isArray(window.HAQEI_DATA.hexagrams_master)
          ) {
            addTestResult(
              `ğŸ“Š hexagrams_master è¦ç´ æ•°: ${window.HAQEI_DATA.hexagrams_master.length}`,
              "info"
            );
          }
        }

        // WORLDVIEW_QUESTIONS ã®æ¤œè¨¼
        if (
          window.WORLDVIEW_QUESTIONS &&
          Array.isArray(window.WORLDVIEW_QUESTIONS)
        ) {
          addTestResult(
            `âœ… WORLDVIEW_QUESTIONS é…åˆ—ç¢ºèª: ${window.WORLDVIEW_QUESTIONS.length} å•`,
            "success"
          );
        }

        // H64_8D_VECTORS ã®æ¤œè¨¼
        if (
          window.H64_8D_VECTORS &&
          typeof window.H64_8D_VECTORS === "object"
        ) {
          const vectorKeys = Object.keys(window.H64_8D_VECTORS);
          addTestResult(
            `âœ… H64_8D_VECTORS ç¢ºèª: ${vectorKeys.length} å¦ã®ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿`,
            "success"
          );

          // ã‚µãƒ³ãƒ—ãƒ«ãƒ™ã‚¯ãƒˆãƒ«ã®ç¢ºèª
          if (window.H64_8D_VECTORS[1]) {
            const sampleVector = window.H64_8D_VECTORS[1];
            const dimensions = Object.keys(sampleVector);
            addTestResult(`ğŸ“Š ãƒ™ã‚¯ãƒˆãƒ«æ¬¡å…ƒ: ${dimensions.join(", ")}`, "info");
          }
        }

        addTestResult("ğŸ‰ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Œäº†", "success");
      }

      // åˆæœŸçŠ¶æ…‹ã®è¡¨ç¤º
      document.addEventListener("DOMContentLoaded", function () {
        addTestResult("ğŸ“‹ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†", "info");
        addTestResult(
          "ğŸ’¡ ã€Œé€šå¸¸èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆã€ã§ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ã€Œãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆã€ã§ä¸è¶³ãƒ‡ãƒ¼ã‚¿ã®è£œå®Œã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™",
          "info"
        );
      });
    </script>
  </body>
</html>
