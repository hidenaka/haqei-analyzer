<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyzeræº–å‚™å®Œäº†ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background-color: #0d1117;
            color: #c9d1d9;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .test-header {
            background: #21262d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #58a6ff;
        }
        .test-section {
            background: #161b22;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #30363d;
        }
        .status-card {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        .status-ready {
            border-color: #2ea043;
            background: #0d2818;
        }
        .status-pending {
            border-color: #d29922;
            background: #2d2613;
        }
        .status-error {
            border-color: #f85149;
            background: #2d1b1e;
        }
        .btn {
            background: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #2ea043;
        }
        .btn-secondary {
            background: #21262d;
            border: 1px solid #30363d;
        }
        .btn-secondary:hover {
            background: #30363d;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-pass { background-color: #2ea043; }
        .status-fail { background-color: #f85149; }
        .status-warn { background-color: #f0c674; }
        .status-unknown { background-color: #6e7681; }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .info-item {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 4px;
            padding: 10px;
            font-size: 12px;
        }
        .log-section {
            background: #010409;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #30363d;
            max-height: 300px;
            overflow-y: auto;
            font-size: 11px;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ¯ Analyzeræº–å‚™å®Œäº†ãƒ†ã‚¹ãƒˆ</h1>
            <p>analyzer.html ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ãŸã‚ã«å¿…è¦ãªè¦ç´ ã‚’äº‹å‰ç¢ºèªã—ã¾ã™ã€‚</p>
            <div>
                <button class="btn" onclick="checkAnalyzerReadiness()">æº–å‚™çŠ¶æ³ç¢ºèª</button>
                <button class="btn btn-secondary" onclick="openAnalyzer()">analyzer.html ã‚’é–‹ã</button>
                <button class="btn btn-secondary" onclick="openOSAnalyzer()">os_analyzer.html ã‚’é–‹ã</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ æº–å‚™å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h2>
            <div id="readiness-checklist"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ç¢ºèª</h2>
            <div class="info-grid" id="file-structure"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ”§ ç’°å¢ƒæƒ…å ±</h2>
            <div class="info-grid" id="environment-info"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ’¡ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
            <div id="recommendations"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ ç¢ºèªãƒ­ã‚°</h2>
            <div class="log-section" id="check-log">
                <pre>ã€Œæº–å‚™çŠ¶æ³ç¢ºèªã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€analyzer.htmlã®å‹•ä½œæº–å‚™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</pre>
            </div>
        </div>
    </div>

    <script>
        let checkState = {
            logs: [],
            fileChecks: {},
            environmentInfo: {},
            recommendations: []
        };

        function log(message, type = 'info') {
            const timestamp = new Date().toISOString().substr(11, 8);
            const logEntry = `[${timestamp}] ${message}`;
            checkState.logs.push({ timestamp, message, type });
            
            const logSection = document.getElementById('check-log');
            const logElement = document.createElement('div');
            logElement.textContent = logEntry;
            logElement.className = `log-${type}`;
            logSection.appendChild(logElement);
            logSection.scrollTop = logSection.scrollHeight;
        }

        async function checkAnalyzerReadiness() {
            log('Analyzeræº–å‚™çŠ¶æ³ç¢ºèªã‚’é–‹å§‹', 'info');
            
            // ç’°å¢ƒæƒ…å ±åé›†
            await collectEnvironmentInfo();
            
            // ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ç¢ºèª
            await checkFileStructure();
            
            // æº–å‚™å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆæ›´æ–°
            updateReadinessChecklist();
            
            // æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ
            generateRecommendations();
            
            log('Analyzeræº–å‚™çŠ¶æ³ç¢ºèªå®Œäº†', 'success');
        }

        async function collectEnvironmentInfo() {
            log('ç’°å¢ƒæƒ…å ±ã‚’åé›†ä¸­...', 'info');
            
            checkState.environmentInfo = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                localStorage: (() => {
                    try {
                        const test = '__test__';
                        localStorage.setItem(test, test);
                        localStorage.removeItem(test);
                        return 'available';
                    } catch (e) {
                        return 'unavailable';
                    }
                })(),
                currentUrl: window.location.href,
                protocol: window.location.protocol,
                hostname: window.location.hostname,
                pathname: window.location.pathname
            };

            updateEnvironmentInfo();
        }

        async function checkFileStructure() {
            log('ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã‚’ç¢ºèªä¸­...', 'info');
            
            const checks = [
                {
                    name: 'analyzer.html',
                    path: './analyzer.html',
                    description: 'é–‹ç™ºç”¨ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«'
                },
                {
                    name: 'os_analyzer.html',
                    path: '../os_analyzer.html',
                    description: 'æœ¬ç•ªç”¨ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«'
                },
                {
                    name: 'Chart.js CDN',
                    path: 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js',
                    description: 'ã‚°ãƒ©ãƒ•ãƒ©ã‚¤ãƒ–ãƒ©ãƒª'
                }
            ];

            checkState.fileChecks = {};

            for (const check of checks) {
                try {
                    const result = await checkFileExists(check.path);
                    checkState.fileChecks[check.name] = {
                        status: result ? 'available' : 'missing',
                        path: check.path,
                        description: check.description
                    };
                    
                    log(`${check.name}: ${result ? 'ç¢ºèª' : 'æœªç¢ºèª'}`, result ? 'success' : 'warn');
                } catch (error) {
                    checkState.fileChecks[check.name] = {
                        status: 'error',
                        path: check.path,
                        description: check.description,
                        error: error.message
                    };
                    log(`${check.name}: ã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
                }
            }

            updateFileStructureInfo();
        }

        async function checkFileExists(path) {
            if (path.startsWith('http')) {
                // å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®ç¢ºèª
                try {
                    const response = await fetch(path, { method: 'HEAD', mode: 'no-cors' });
                    return true; // no-corsãƒ¢ãƒ¼ãƒ‰ã§ã¯è©³ç´°ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¯å–å¾—ã§ããªã„ãŒã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå®Œäº†ã™ã‚Œã°å­˜åœ¨ã™ã‚‹
                } catch (error) {
                    return false;
                }
            } else {
                // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªï¼ˆåˆ¶é™ã‚ã‚Šï¼‰
                try {
                    const response = await fetch(path, { method: 'HEAD' });
                    return response.ok;
                } catch (error) {
                    return false;
                }
            }
        }

        function updateEnvironmentInfo() {
            const infoDiv = document.getElementById('environment-info');
            infoDiv.innerHTML = Object.entries(checkState.environmentInfo).map(([key, value]) => `
                <div class="info-item">
                    <strong>${key}:</strong><br>
                    <span style="color: #8b949e;">${value}</span>
                </div>
            `).join('');
        }

        function updateFileStructureInfo() {
            const structureDiv = document.getElementById('file-structure');
            structureDiv.innerHTML = Object.entries(checkState.fileChecks).map(([name, info]) => {
                const statusClass = {
                    'available': 'status-pass',
                    'missing': 'status-warn',
                    'error': 'status-fail'
                }[info.status];

                return `
                    <div class="info-item">
                        <span class="status-indicator ${statusClass}"></span>
                        <strong>${name}</strong><br>
                        <span style="color: #8b949e; font-size: 10px;">${info.description}</span><br>
                        <span style="color: #6e7681; font-size: 10px;">${info.path}</span>
                        ${info.error ? `<br><span style="color: #f85149; font-size: 10px;">ã‚¨ãƒ©ãƒ¼: ${info.error}</span>` : ''}
                    </div>
                `;
            }).join('');
        }

        function updateReadinessChecklist() {
            const checklistItems = [
                {
                    name: 'HTTPã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒ',
                    check: () => checkState.environmentInfo.protocol === 'http:' || checkState.environmentInfo.protocol === 'https:',
                    importance: 'critical',
                    message: 'HTTPã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹'
                },
                {
                    name: 'LocalStorageåˆ©ç”¨å¯èƒ½',
                    check: () => checkState.environmentInfo.localStorage === 'available',
                    importance: 'high',
                    message: 'ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½'
                },
                {
                    name: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š',
                    check: () => checkState.environmentInfo.onLine,
                    importance: 'medium',
                    message: 'å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹èª­ã¿è¾¼ã¿å¯èƒ½'
                },
                {
                    name: 'Cookieæœ‰åŠ¹',
                    check: () => checkState.environmentInfo.cookieEnabled,
                    importance: 'low',
                    message: 'ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãŒå¯èƒ½'
                },
                {
                    name: 'Chart.js ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½',
                    check: () => checkState.fileChecks['Chart.js CDN']?.status === 'available',
                    importance: 'high',
                    message: 'ã‚°ãƒ©ãƒ•æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½'
                }
            ];

            const checklistDiv = document.getElementById('readiness-checklist');
            checklistDiv.innerHTML = checklistItems.map(item => {
                const passed = item.check();
                const statusClass = passed ? 'status-ready' : 'status-error';
                const importanceColor = {
                    'critical': '#f85149',
                    'high': '#d29922',
                    'medium': '#58a6ff',
                    'low': '#8b949e'
                }[item.importance];

                return `
                    <div class="status-card ${statusClass}">
                        <span class="status-indicator ${passed ? 'status-pass' : 'status-fail'}"></span>
                        <strong>${item.name}</strong>
                        <span style="color: ${importanceColor}; font-size: 12px; margin-left: 10px;">[${item.importance}]</span>
                        <div style="margin-top: 8px; font-size: 12px; color: #8b949e;">
                            ${item.message}: ${passed ? 'âœ… OK' : 'âŒ NG'}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function generateRecommendations() {
            checkState.recommendations = [];

            // HTTPã‚µãƒ¼ãƒãƒ¼ãƒã‚§ãƒƒã‚¯
            if (checkState.environmentInfo.protocol === 'file:') {
                checkState.recommendations.push({
                    priority: 'high',
                    title: 'HTTPã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„',
                    description: 'ãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã¯CORSã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼š',
                    commands: [
                        'python -m http.server 8000',
                        'npx http-server -p 8000',
                        'php -S localhost:8000'
                    ]
                });
            }

            // LocalStorageãƒã‚§ãƒƒã‚¯
            if (checkState.environmentInfo.localStorage === 'unavailable') {
                checkState.recommendations.push({
                    priority: 'medium',
                    title: 'LocalStorageãŒåˆ©ç”¨ã§ãã¾ã›ã‚“',
                    description: 'ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã‹ã€åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚'
                });
            }

            // Chart.jsãƒã‚§ãƒƒã‚¯
            if (checkState.fileChecks['Chart.js CDN']?.status !== 'available') {
                checkState.recommendations.push({
                    priority: 'medium',
                    title: 'Chart.jsã«æ¥ç¶šã§ãã¾ã›ã‚“',
                    description: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã™ã‚‹ã‹ã€CDNã®ä»£æ›¿URLã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚'
                });
            }

            // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒã‚§ãƒƒã‚¯
            if (!checkState.environmentInfo.onLine) {
                checkState.recommendations.push({
                    priority: 'low',
                    title: 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã§ã™',
                    description: 'å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿ã«å½±éŸ¿ãŒå‡ºã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚'
                });
            }

            updateRecommendations();
        }

        function updateRecommendations() {
            const recommendationsDiv = document.getElementById('recommendations');
            
            if (checkState.recommendations.length === 0) {
                recommendationsDiv.innerHTML = `
                    <div class="status-card status-ready">
                        <span class="status-indicator status-pass"></span>
                        <strong>ã™ã¹ã¦æº–å‚™å®Œäº†ï¼</strong>
                        <div style="margin-top: 8px; font-size: 12px; color: #8b949e;">
                            analyzer.htmlã‚’å®‰å…¨ã«å®Ÿè¡Œã§ãã¾ã™ã€‚
                        </div>
                    </div>
                `;
                return;
            }

            recommendationsDiv.innerHTML = checkState.recommendations.map(rec => {
                const priorityColor = {
                    'high': '#f85149',
                    'medium': '#d29922',
                    'low': '#58a6ff'
                }[rec.priority];

                return `
                    <div class="status-card status-pending">
                        <span class="status-indicator status-warn"></span>
                        <strong>${rec.title}</strong>
                        <span style="color: ${priorityColor}; font-size: 12px; margin-left: 10px;">[${rec.priority}]</span>
                        <div style="margin-top: 8px; font-size: 12px; color: #8b949e;">
                            ${rec.description}
                        </div>
                        ${rec.commands ? `
                            <div style="margin-top: 8px; font-size: 11px; background: #161b22; padding: 8px; border-radius: 4px;">
                                ${rec.commands.map(cmd => `<div style="color: #f0c674;">$ ${cmd}</div>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function openAnalyzer() {
            log('analyzer.html ã‚’é–‹ã„ã¦ã„ã¾ã™...', 'info');
            window.open('./analyzer.html', '_blank');
        }

        function openOSAnalyzer() {
            log('os_analyzer.html ã‚’é–‹ã„ã¦ã„ã¾ã™...', 'info');
            window.open('../os_analyzer.html', '_blank');
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('Analyzeræº–å‚™å®Œäº†ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'info');
            log('ã€Œæº–å‚™çŠ¶æ³ç¢ºèªã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‹å§‹ã—ã¦ãã ã•ã„', 'info');
        });
    </script>
</body>
</html>