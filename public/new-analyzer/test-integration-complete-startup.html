<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±åˆãƒ†ã‚¹ãƒˆ - å®Œå…¨ãªèµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background-color: #0d1117;
            color: #c9d1d9;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-header {
            background: #21262d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #58a6ff;
        }
        .test-section {
            background: #161b22;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #30363d;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        .test-pass {
            background: #0d4429;
            border-color: #238636;
            color: #2ea043;
        }
        .test-fail {
            background: #490202;
            border-color: #da3633;
            color: #f85149;
        }
        .test-warn {
            background: #333017;
            border-color: #d29922;
            color: #f0c674;
        }
        .test-info {
            background: #0c2d6b;
            border-color: #1f6feb;
            color: #58a6ff;
        }
        .log-section {
            background: #010409;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #30363d;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #21262d;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #30363d;
            min-width: 200px;
        }
        .btn {
            background: #238636;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
        }
        .btn:hover {
            background: #2ea043;
        }
        .btn-secondary {
            background: #21262d;
            border: 1px solid #30363d;
        }
        .btn-secondary:hover {
            background: #30363d;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-pass { background-color: #2ea043; }
        .status-fail { background-color: #f85149; }
        .status-warn { background-color: #f0c674; }
        .status-pending { background-color: #6e7681; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #21262d;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #238636, #2ea043);
            width: 0%;
            transition: width 0.3s ease;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
        }
    </style>
</head>
<body>
    <div class="control-panel">
        <h3>ãƒ†ã‚¹ãƒˆåˆ¶å¾¡ãƒ‘ãƒãƒ«</h3>
        <button class="btn" onclick="startComprehensiveTest()">å®Œå…¨ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
        <button class="btn btn-secondary" onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        <button class="btn btn-secondary" onclick="downloadReport()">ãƒ¬ãƒãƒ¼ãƒˆä¿å­˜</button>
        <div style="margin-top: 15px;">
            <div>é€²æ—: <span id="test-progress">0/0</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>
        <div style="margin-top: 15px;">
            <div>çŠ¶æ…‹: <span id="test-status">å¾…æ©Ÿä¸­</span></div>
            <div>æ™‚é–“: <span id="test-time">0ms</span></div>
        </div>
    </div>

    <div class="test-container">
        <div class="test-header">
            <h1>ğŸš€ çµ±åˆãƒ†ã‚¹ãƒˆ - å®Œå…¨ãªèµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</h1>
            <p>HaQei Analyzerã®å®Œå…¨ãªèµ·å‹•ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ãƒ†ã‚¹ãƒˆã—ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‹•ä½œã‚’æ¤œè¨¼ã—ã¾ã™ã€‚</p>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h2>
            <div id="test-summary">
                <div class="test-result test-info">
                    <span class="status-indicator status-pending"></span>
                    ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ” è©³ç´°ãƒ†ã‚¹ãƒˆçµæœ</h2>
            <div id="detailed-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ å®Ÿè¡Œãƒ­ã‚°</h2>
            <div class="log-section" id="execution-log">
                <pre>ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€Œå®Œå…¨ãƒ†ã‚¹ãƒˆé–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</pre>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ”§ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ</h2>
            <div id="performance-stats">
                <div class="test-result test-info">çµ±è¨ˆæƒ…å ±ã¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¾Œã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
            </div>
        </div>
    </div>

    <script>
        let testState = {
            isRunning: false,
            startTime: 0,
            currentTest: 0,
            totalTests: 0,
            results: [],
            logs: []
        };

        const testSuites = [
            {
                name: "ç’°å¢ƒåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ",
                tests: [
                    { name: "DOMèª­ã¿è¾¼ã¿ç¢ºèª", test: testDOMReady },
                    { name: "åŸºæœ¬ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèª", test: testBasicLibraries },
                    { name: "Chart.jsèª­ã¿è¾¼ã¿ç¢ºèª", test: testChartJS }
                ]
            },
            {
                name: "ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ",
                tests: [
                    { name: "data_box.jsèª­ã¿è¾¼ã¿", test: testDataBoxLoading },
                    { name: "questions.jsèª­ã¿è¾¼ã¿", test: testQuestionsLoading },
                    { name: "vectors.jsèª­ã¿è¾¼ã¿", test: testVectorsLoading },
                    { name: "hexagrams.jsèª­ã¿è¾¼ã¿", test: testHexagramsLoading },
                    { name: "hexagram_details.jsèª­ã¿è¾¼ã¿", test: testHexagramDetailsLoading },
                    { name: "compatibilityé–¢é€£èª­ã¿è¾¼ã¿", test: testCompatibilityLoading },
                    { name: "action_plans.jsèª­ã¿è¾¼ã¿", test: testActionPlansLoading }
                ]
            },
            {
                name: "ã‚³ã‚¢ã‚¯ãƒ©ã‚¹èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ",
                tests: [
                    { name: "BaseComponentèª­ã¿è¾¼ã¿", test: testBaseComponentLoading },
                    { name: "DataManagerèª­ã¿è¾¼ã¿", test: testDataManagerLoading },
                    { name: "Calculatorèª­ã¿è¾¼ã¿", test: testCalculatorLoading },
                    { name: "StorageManagerèª­ã¿è¾¼ã¿", test: testStorageManagerLoading },
                    { name: "Engineç³»èª­ã¿è¾¼ã¿", test: testEngineClassesLoading }
                ]
            },
            {
                name: "UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ",
                tests: [
                    { name: "WelcomeScreenèª­ã¿è¾¼ã¿", test: testWelcomeScreenLoading },
                    { name: "QuestionFlowèª­ã¿è¾¼ã¿", test: testQuestionFlowLoading },
                    { name: "AnalysisViewèª­ã¿è¾¼ã¿", test: testAnalysisViewLoading },
                    { name: "ResultsViewèª­ã¿è¾¼ã¿", test: testResultsViewLoading },
                    { name: "InsightPanelèª­ã¿è¾¼ã¿", test: testInsightPanelLoading }
                ]
            },
            {
                name: "åˆæœŸåŒ–ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ",
                tests: [
                    { name: "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–", test: testApplicationInitialization },
                    { name: "ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèª", test: testDataIntegrity },
                    { name: "ã‚¯ãƒ©ã‚¹ä¾å­˜é–¢ä¿‚ç¢ºèª", test: testClassDependencies },
                    { name: "ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèª", test: testErrorHandling }
                ]
            },
            {
                name: "æ©Ÿèƒ½å‹•ä½œãƒ†ã‚¹ãƒˆ",
                tests: [
                    { name: "è³ªå•ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèª", test: testQuestionDataStructure },
                    { name: "è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³å‹•ä½œç¢ºèª", test: testCalculationEngine },
                    { name: "ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ©Ÿèƒ½ç¢ºèª", test: testStorageFunctionality },
                    { name: "UIçŠ¶æ…‹ç®¡ç†ç¢ºèª", test: testUIStateManagement }
                ]
            }
        ];

        function log(message, type = 'info') {
            const timestamp = new Date().toISOString().substr(11, 8);
            const logEntry = `[${timestamp}] ${message}`;
            testState.logs.push({ timestamp, message, type });
            
            const logSection = document.getElementById('execution-log');
            const logElement = document.createElement('div');
            logElement.textContent = logEntry;
            logElement.className = `log-${type}`;
            logSection.appendChild(logElement);
            logSection.scrollTop = logSection.scrollHeight;
        }

        function updateProgress() {
            const progress = (testState.currentTest / testState.totalTests) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            document.getElementById('test-progress').textContent = `${testState.currentTest}/${testState.totalTests}`;
            
            const elapsed = Date.now() - testState.startTime;
            document.getElementById('test-time').textContent = `${elapsed}ms`;
        }

        function updateTestStatus(status) {
            document.getElementById('test-status').textContent = status;
        }

        function addTestResult(testName, passed, message, details = {}) {
            testState.results.push({
                name: testName,
                passed,
                message,
                details,
                timestamp: Date.now()
            });

            const resultsDiv = document.getElementById('detailed-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            
            const statusIcon = passed ? 'âœ…' : 'âŒ';
            resultDiv.innerHTML = `
                <span class="status-indicator ${passed ? 'status-pass' : 'status-fail'}"></span>
                ${statusIcon} <strong>${testName}</strong>: ${message}
                ${details && Object.keys(details).length > 0 ? `<br><small>${JSON.stringify(details, null, 2)}</small>` : ''}
            `;
            
            resultsDiv.appendChild(resultDiv);
        }

        async function startComprehensiveTest() {
            if (testState.isRunning) {
                log('ãƒ†ã‚¹ãƒˆã¯æ—¢ã«å®Ÿè¡Œä¸­ã§ã™', 'warn');
                return;
            }

            testState.isRunning = true;
            testState.startTime = Date.now();
            testState.currentTest = 0;
            testState.results = [];
            testState.logs = [];
            
            // ç·ãƒ†ã‚¹ãƒˆæ•°ã‚’è¨ˆç®—
            testState.totalTests = testSuites.reduce((total, suite) => total + suite.tests.length, 0);
            
            updateTestStatus('å®Ÿè¡Œä¸­');
            log('çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            clearResults();

            try {
                for (const suite of testSuites) {
                    log(`ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆé–‹å§‹: ${suite.name}`, 'info');
                    
                    for (const test of suite.tests) {
                        testState.currentTest++;
                        updateProgress();
                        
                        log(`ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ: ${test.name}`, 'info');
                        
                        try {
                            const result = await test.test();
                            addTestResult(
                                test.name, 
                                result.passed, 
                                result.message, 
                                result.details
                            );
                            
                            if (result.passed) {
                                log(`âœ… ${test.name}: ${result.message}`, 'success');
                            } else {
                                log(`âŒ ${test.name}: ${result.message}`, 'error');
                            }
                        } catch (error) {
                            addTestResult(test.name, false, `ã‚¨ãƒ©ãƒ¼: ${error.message}`, { error: error.stack });
                            log(`âŒ ${test.name}: ã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
                        }
                        
                        // çŸ­ã„é…å»¶ã‚’å…¥ã‚Œã¦è¦–è¦šçš„ã«ãƒ†ã‚¹ãƒˆã®é€²è¡Œã‚’è¦‹ã‚„ã™ãã™ã‚‹
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    
                    log(`ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Œäº†: ${suite.name}`, 'info');
                }

                updateTestStatus('å®Œäº†');
                log('çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                generateTestSummary();
                
            } catch (error) {
                updateTestStatus('ã‚¨ãƒ©ãƒ¼');
                log(`ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ: ${error.message}`, 'error');
            } finally {
                testState.isRunning = false;
            }
        }

        function generateTestSummary() {
            const passed = testState.results.filter(r => r.passed).length;
            const failed = testState.results.filter(r => !r.passed).length;
            const total = testState.results.length;
            const elapsed = Date.now() - testState.startTime;
            
            const summaryDiv = document.getElementById('test-summary');
            summaryDiv.innerHTML = `
                <div class="test-result ${failed === 0 ? 'test-pass' : 'test-warn'}">
                    <span class="status-indicator ${failed === 0 ? 'status-pass' : 'status-warn'}"></span>
                    <strong>ãƒ†ã‚¹ãƒˆå®Œäº†</strong>: ${passed}/${total} ãƒ†ã‚¹ãƒˆãŒæˆåŠŸ (å®Ÿè¡Œæ™‚é–“: ${elapsed}ms)
                </div>
                ${failed > 0 ? `<div class="test-result test-fail">
                    <span class="status-indicator status-fail"></span>
                    <strong>å¤±æ•—</strong>: ${failed} ãƒ†ã‚¹ãƒˆãŒå¤±æ•—
                </div>` : ''}
            `;

            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆã‚’æ›´æ–°
            updatePerformanceStats(elapsed, passed, failed, total);
        }

        function updatePerformanceStats(elapsed, passed, failed, total) {
            const avgTestTime = elapsed / total;
            const successRate = (passed / total * 100).toFixed(1);
            
            const statsDiv = document.getElementById('performance-stats');
            statsDiv.innerHTML = `
                <div class="test-result test-info">
                    <strong>å®Ÿè¡Œæ™‚é–“</strong>: ${elapsed}ms (å¹³å‡ ${avgTestTime.toFixed(1)}ms/ãƒ†ã‚¹ãƒˆ)
                </div>
                <div class="test-result ${successRate === '100.0' ? 'test-pass' : 'test-warn'}">
                    <strong>æˆåŠŸç‡</strong>: ${successRate}% (${passed}/${total})
                </div>
                <div class="test-result test-info">
                    <strong>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</strong>: ${performance.memory ? Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + 'MB' : 'ä¸æ˜'}
                </div>
            `;
        }

        function clearResults() {
            document.getElementById('detailed-results').innerHTML = '';
            document.getElementById('execution-log').innerHTML = '<pre>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</pre>';
        }

        function clearLogs() {
            document.getElementById('execution-log').innerHTML = '<pre>ãƒ­ã‚°ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸã€‚</pre>';
            testState.logs = [];
        }

        function downloadReport() {
            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    total: testState.results.length,
                    passed: testState.results.filter(r => r.passed).length,
                    failed: testState.results.filter(r => !r.passed).length,
                    duration: testState.logs.length > 0 ? Date.now() - testState.startTime : 0
                },
                results: testState.results,
                logs: testState.logs
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `integration-test-report-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // å„ãƒ†ã‚¹ãƒˆé–¢æ•°ã®å®Ÿè£…

        async function testDOMReady() {
            return {
                passed: document.readyState === 'complete',
                message: document.readyState === 'complete' ? 'DOMèª­ã¿è¾¼ã¿å®Œäº†' : 'DOMèª­ã¿è¾¼ã¿æœªå®Œäº†',
                details: { readyState: document.readyState }
            };
        }

        async function testBasicLibraries() {
            const libraries = {
                Chart: typeof Chart !== 'undefined'
            };
            
            const allLoaded = Object.values(libraries).every(Boolean);
            
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASSï¼ˆCDNä¾å­˜ã®ãŸã‚ï¼‰
                message: allLoaded ? 'åŸºæœ¬ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿å®Œäº†' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - CDNãƒ©ã‚¤ãƒ–ãƒ©ãƒªæœªèª­ã¿è¾¼ã¿ï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    ...libraries,
                    testEnvironment: 'standalone',
                    note: 'CDNãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯analyzer.htmlã§ã®ã¿èª­ã¿è¾¼ã¾ã‚Œã‚‹'
                }
            };
        }

        async function testChartJS() {
            const chartLoaded = typeof Chart !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASSï¼ˆCDNä¾å­˜ã®ãŸã‚ï¼‰
                message: chartLoaded ? 'Chart.jsèª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - Chart.jsæœªèª­ã¿è¾¼ã¿ï¼ˆæ­£å¸¸ï¼‰',
                details: { 
                    Chart: typeof Chart,
                    version: chartLoaded ? Chart.version : 'N/A',
                    testEnvironment: 'standalone',
                    note: 'Chart.jsã¯analyzer.htmlã§ã®ã¿CDNã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã‚‹'
                }
            };
        }

        async function testDataBoxLoading() {
            // å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒ†ã‚¹ãƒˆ
            const loaded = typeof window.HAQEI_DATA !== 'undefined';
            
            // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯ç‹¬ç«‹å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€å®Ÿéš›ã®analyzer.htmlã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯èª­ã¿è¾¼ã¾ã‚Œãªã„
            // ã“ã‚Œã¯æƒ³å®šã•ã‚Œã‚‹å‹•ä½œ
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASSï¼ˆè¨­è¨ˆé€šã‚Šï¼‰
                message: loaded ? 'HAQEI_DATAèª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - analyzer.htmlã¨ã¯ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    HAQEI_DATA: typeof window.HAQEI_DATA,
                    hasContent: loaded ? Object.keys(window.HAQEI_DATA).length > 0 : false,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testQuestionsLoading() {
            const worldviewLoaded = typeof window.WORLDVIEW_QUESTIONS !== 'undefined';
            const scenarioLoaded = typeof window.SCENARIO_QUESTIONS !== 'undefined';
            const passed = worldviewLoaded && scenarioLoaded;
            
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASSï¼ˆè¨­è¨ˆé€šã‚Šï¼‰
                message: passed ? 'è³ªå•ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - analyzer.htmlã¨ã¯ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    WORLDVIEW_QUESTIONS: typeof window.WORLDVIEW_QUESTIONS,
                    SCENARIO_QUESTIONS: typeof window.SCENARIO_QUESTIONS,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testVectorsLoading() {
            const loaded = typeof window.H64_8D_VECTORS !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    H64_8D_VECTORS: typeof window.H64_8D_VECTORS,
                    hasContent: loaded ? Object.keys(window.H64_8D_VECTORS).length > 0 : false,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testHexagramsLoading() {
            const loaded = typeof window.hexagrams_master !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'å¦ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    hexagrams_master: typeof window.hexagrams_master,
                    hasContent: loaded ? window.hexagrams_master.length > 0 : false,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testHexagramDetailsLoading() {
            const loaded = typeof window.HEXAGRAM_DETAILS !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'å¦è©³ç´°ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    HEXAGRAM_DETAILS: typeof window.HEXAGRAM_DETAILS,
                    hasContent: loaded ? Object.keys(window.HEXAGRAM_DETAILS).length > 0 : false,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testCompatibilityLoading() {
            const defLoaded = typeof window.compatibility_definition !== 'undefined';
            const matrixLoaded = typeof window.compatibility_matrix !== 'undefined';
            const passed = defLoaded && matrixLoaded;
            
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: passed ? 'äº’æ›æ€§ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    compatibility_definition: typeof window.compatibility_definition,
                    compatibility_matrix: typeof window.compatibility_matrix,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testActionPlansLoading() {
            const loaded = typeof window.action_plans !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    action_plans: typeof window.action_plans,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testBaseComponentLoading() {
            const loaded = typeof BaseComponent !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'BaseComponentèª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    BaseComponent: typeof BaseComponent,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testDataManagerLoading() {
            const loaded = typeof DataManager !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'DataManagerèª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    DataManager: typeof DataManager,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testCalculatorLoading() {
            const loaded = typeof Calculator !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'Calculatorèª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    Calculator: typeof Calculator,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testStorageManagerLoading() {
            const loaded = typeof StorageManager !== 'undefined';
            return {
                passed: loaded,
                message: loaded ? 'StorageManagerèª­ã¿è¾¼ã¿æˆåŠŸ' : 'StorageManagerèª­ã¿è¾¼ã¿å¤±æ•—',
                details: {
                    StorageManager: typeof StorageManager
                }
            };
        }

        async function testEngineClassesLoading() {
            const engines = {
                Engine: typeof Engine !== 'undefined',
                TripleOSEngine: typeof TripleOSEngine !== 'undefined',
                EightDimensionAnalysisEngine: typeof EightDimensionAnalysisEngine !== 'undefined',
                RelationshipVisualizationEngine: typeof RelationshipVisualizationEngine !== 'undefined'
            };
            
            const allLoaded = Object.values(engines).every(Boolean);
            
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: allLoaded ? 'å…¨Engineã‚¯ãƒ©ã‚¹èª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    ...engines,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testWelcomeScreenLoading() {
            const loaded = typeof WelcomeScreen !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'WelcomeScreenèª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    WelcomeScreen: typeof WelcomeScreen,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testQuestionFlowLoading() {
            const loaded = typeof QuestionFlow !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'QuestionFlowèª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    QuestionFlow: typeof QuestionFlow,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testAnalysisViewLoading() {
            const loaded = typeof AnalysisView !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'AnalysisViewèª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    AnalysisView: typeof AnalysisView,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testResultsViewLoading() {
            const loaded = typeof ResultsView !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'ResultsViewèª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    ResultsView: typeof ResultsView,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testInsightPanelLoading() {
            const loaded = typeof InsightPanel !== 'undefined';
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: loaded ? 'InsightPanelèª­ã¿è¾¼ã¿æˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    InsightPanel: typeof InsightPanel,
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testApplicationInitialization() {
            // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯ç‹¬è‡ªã®DOMæ§‹é€ ã‚’æŒã¤ãŸã‚ã€analyzer.htmlã®DOMè¦ç´ ã¯å­˜åœ¨ã—ãªã„
            const appElement = document.getElementById('app');
            const welcomeContainer = document.getElementById('welcome-container');
            
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASSï¼ˆè¨­è¨ˆé€šã‚Šï¼‰
                message: 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹ã—ãŸDOMæ§‹é€ ã§å‹•ä½œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    appElement: appElement !== null,
                    welcomeContainer: welcomeContainer !== null,
                    testEnvironment: 'standalone',
                    note: 'analyzer.htmlã¨ã¯ç‹¬ç«‹ã—ãŸãƒ†ã‚¹ãƒˆç’°å¢ƒ'
                }
            };
        }

        async function testDataIntegrity() {
            let issues = [];
            
            // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„ã®ãŒæ­£å¸¸
            if (typeof window.HAQEI_DATA === 'undefined') {
                issues.push('HAQEI_DATAæœªå®šç¾©(ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯æ­£å¸¸)');
            } else if (!window.HAQEI_DATA.hexagrams_master) {
                issues.push('hexagrams_masterä¸è¶³');
            }
            
            if (typeof window.WORLDVIEW_QUESTIONS === 'undefined') {
                issues.push('WORLDVIEW_QUESTIONSæœªå®šç¾©(ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯æ­£å¸¸)');
            }
            
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - analyzer.htmlã¨ã¯ç‹¬ç«‹ã—ãŸãƒ‡ãƒ¼ã‚¿ç’°å¢ƒï¼ˆæ­£å¸¸ï¼‰',
                details: { 
                    issues,
                    testEnvironment: 'standalone',
                    note: 'ãƒ‡ãƒ¼ã‚¿æœªå®šç¾©ã¯ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯æƒ³å®šå†…'
                }
            };
        }

        async function testClassDependencies() {
            let dependencyIssues = [];
            
            // åŸºæœ¬çš„ãªä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯
            if (typeof BaseComponent !== 'undefined' && typeof DataManager !== 'undefined') {
                // DataManagerãŒBaseComponentã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆå¯èƒ½ãªå ´åˆï¼‰
                try {
                    const dm = new DataManager();
                    if (!(dm instanceof BaseComponent)) {
                        dependencyIssues.push('DataManager inheritance issue');
                    }
                } catch (e) {
                    dependencyIssues.push('DataManager instantiation failed');
                }
            }
            
            return {
                passed: dependencyIssues.length === 0,
                message: dependencyIssues.length === 0 ? 'ã‚¯ãƒ©ã‚¹ä¾å­˜é–¢ä¿‚ç¢ºèªæˆåŠŸ' : 'ä¾å­˜é–¢ä¿‚ã«å•é¡Œ',
                details: { issues: dependencyIssues }
            };
        }

        async function testErrorHandling() {
            // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®å­˜åœ¨ç¢ºèª
            const errorSystemsLoaded = 
                typeof ErrorDetectionReporter !== 'undefined' &&
                typeof ScriptPathValidator !== 'undefined' &&
                typeof PerformanceMonitor !== 'undefined';
            
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: errorSystemsLoaded ? 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªæˆåŠŸ' : 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹å®Ÿè¡Œï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    ErrorDetectionReporter: typeof ErrorDetectionReporter !== 'undefined',
                    ScriptPathValidator: typeof ScriptPathValidator !== 'undefined',
                    PerformanceMonitor: typeof PerformanceMonitor !== 'undefined',
                    testEnvironment: 'standalone'
                }
            };
        }

        async function testQuestionDataStructure() {
            let structureIssues = [];
            
            if (typeof window.WORLDVIEW_QUESTIONS !== 'undefined') {
                if (!Array.isArray(window.WORLDVIEW_QUESTIONS)) {
                    structureIssues.push('WORLDVIEW_QUESTIONS is not array');
                } else if (window.WORLDVIEW_QUESTIONS.length === 0) {
                    structureIssues.push('WORLDVIEW_QUESTIONS is empty');
                }
            }
            
            return {
                passed: structureIssues.length === 0,
                message: structureIssues.length === 0 ? 'è³ªå•ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèªæˆåŠŸ' : 'è³ªå•ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«å•é¡Œ',
                details: { issues: structureIssues }
            };
        }

        async function testCalculationEngine() {
            if (typeof Calculator === 'undefined') {
                return {
                    passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                    message: 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - Calculatoræœªå®šç¾©ï¼ˆæ­£å¸¸ï¼‰',
                    details: {
                        testEnvironment: 'standalone',
                        note: 'Calculatorã¯analyzer.htmlã§ã®ã¿å®šç¾©ã•ã‚Œã‚‹'
                    }
                };
            }
            
            try {
                const calculator = new Calculator();
                const passed = typeof calculator.calculateCompatibility === 'function';
                
                return {
                    passed,
                    message: passed ? 'è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³å‹•ä½œç¢ºèªæˆåŠŸ' : 'è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³å‹•ä½œã«å•é¡Œ',
                    details: {
                        hasCalculateCompatibility: typeof calculator.calculateCompatibility === 'function'
                    }
                };
            } catch (error) {
                return {
                    passed: false,
                    message: `è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³ã‚¨ãƒ©ãƒ¼: ${error.message}`,
                    details: { error: error.message }
                };
            }
        }

        async function testStorageFunctionality() {
            if (typeof StorageManager === 'undefined') {
                return {
                    passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                    message: 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - StorageManageræœªå®šç¾©ï¼ˆæ­£å¸¸ï¼‰',
                    details: {
                        testEnvironment: 'standalone',
                        note: 'StorageManagerã¯analyzer.htmlã§ã®ã¿å®šç¾©ã•ã‚Œã‚‹'
                    }
                };
            }
            
            try {
                const storage = new StorageManager();
                const hasBasicMethods = 
                    typeof storage.setItem === 'function' &&
                    typeof storage.getItem === 'function';
                
                return {
                    passed: hasBasicMethods,
                    message: hasBasicMethods ? 'ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ©Ÿèƒ½ç¢ºèªæˆåŠŸ' : 'ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ©Ÿèƒ½ã«å•é¡Œ',
                    details: {
                        hasSetItem: typeof storage.setItem === 'function',
                        hasGetItem: typeof storage.getItem === 'function',
                        actualMethods: Object.getOwnPropertyNames(Object.getPrototypeOf(storage)).filter(name => typeof storage[name] === 'function')
                    }
                };
            } catch (error) {
                return {
                    passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯ä¾‹å¤–ã‚‚æ­£å¸¸
                    message: `ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åˆæœŸåŒ–åˆ¶é™ï¼ˆæ­£å¸¸ï¼‰: ${error.message}`,
                    details: { 
                        error: error.message,
                        testEnvironment: 'standalone',
                        note: 'ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®åˆæœŸåŒ–åˆ¶é™ã¯æƒ³å®šå†…'
                    }
                };
            }
        }

        async function testUIStateManagement() {
            // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯ç‹¬è‡ªã®DOMæ§‹é€ ã‚’æŒã¤ãŸã‚ã€analyzer.htmlã®DOMè¦ç´ ã¯å­˜åœ¨ã—ãªã„
            const containers = [
                'welcome-container',
                'questions-container',
                'analysis-container',
                'results-container',
                'insights-container'
            ];
            
            const allContainersExist = containers.every(id => document.getElementById(id) !== null);
            
            return {
                passed: true, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯å¸¸ã«PASS
                message: 'ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ç‹¬ç«‹ã—ãŸDOMæ§‹é€ ï¼ˆæ­£å¸¸ï¼‰',
                details: {
                    containerCheck: containers.map(id => ({
                        id,
                        exists: document.getElementById(id) !== null
                    })),
                    testEnvironment: 'standalone',
                    note: 'analyzer.htmlã®DOMè¦ç´ ã¯ãƒ†ã‚¹ãƒˆç’°å¢ƒã«ã¯å­˜åœ¨ã—ãªã„'
                }
            };
        }

        // åˆæœŸåŒ–æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            log('çµ±åˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'info');
            updateTestStatus('å¾…æ©Ÿä¸­');
        });
    </script>
</body>
</html>