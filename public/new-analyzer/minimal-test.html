<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minimal Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      .status {
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
      }
      .info {
        background-color: #d1ecf1;
        color: #0c5460;
      }
      button {
        padding: 10px 20px;
        margin: 10px 5px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>HaQei Analyzer - Minimal Test</h1>
      <div id="status-container"></div>
      <div id="controls">
        <button onclick="testDataLoading()">データ読み込みテスト</button>
        <button onclick="testClassLoading()">クラス読み込みテスト</button>
        <button onclick="testInitialization()">初期化テスト</button>
        <button onclick="showWelcomeScreen()">ウェルカム画面テスト</button>
      </div>
      <div
        id="welcome-container"
        style="
          display: none;
          margin-top: 20px;
          padding: 20px;
          border: 1px solid #ccc;
          border-radius: 5px;
        "
      >
        <!-- WelcomeScreen will render here -->
      </div>
    </div>

    <script>
      function addStatus(message, type = "info") {
        const container = document.getElementById("status-container");
        const div = document.createElement("div");
        div.className = `status ${type}`;
        div.textContent = message;
        container.appendChild(div);
        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      addStatus("テスト環境準備完了", "info");
    </script>

    <!-- データファイル -->
    <script src="../js/data/data_box.js"></script>
    <script src="../js/data/questions.js"></script>
    <script src="../js/data/vectors.js"></script>
    <script src="../js/data/hexagrams.js"></script>
    <script src="../js/data/hexagram_details.js"></script>

    <!-- コアクラス -->
    <script src="js/core/BaseComponent.js"></script>
    <script src="js/core/StorageManager.js"></script>
    <script src="js/core/DataManager.js"></script>
    <script src="js/core/Calculator.js"></script>
    <script src="js/core/TripleOSEngine.js"></script>

    <!-- コンポーネント -->
    <script src="js/components/WelcomeScreen.js"></script>
    <script src="js/components/QuestionFlow.js"></script>

    <script>
      function testDataLoading() {
        addStatus("データ読み込みテスト開始...", "info");

        const tests = [
          { name: "HAQEI_DATA", value: window.HAQEI_DATA },
          { name: "WORLDVIEW_QUESTIONS", value: window.WORLDVIEW_QUESTIONS },
          { name: "SCENARIO_QUESTIONS", value: window.SCENARIO_QUESTIONS },
          { name: "H64_8D_VECTORS", value: window.H64_8D_VECTORS },
          { name: "HEXAGRAMS_MASTER", value: window.HEXAGRAMS_MASTER },
          { name: "HEXAGRAM_DETAILS", value: window.HEXAGRAM_DETAILS },
        ];

        tests.forEach((test) => {
          if (test.value) {
            const size = Array.isArray(test.value)
              ? test.value.length
              : typeof test.value === "object"
              ? Object.keys(test.value).length
              : "OK";
            addStatus(`${test.name}: ${size}`, "success");
          } else {
            addStatus(`${test.name}: 未定義`, "error");
          }
        });
      }

      function testClassLoading() {
        addStatus("クラス読み込みテスト開始...", "info");

        const classes = [
          "BaseComponent",
          "StorageManager",
          "DataManager",
          "Calculator",
          "TripleOSEngine",
          "WelcomeScreen",
          "QuestionFlow",
        ];

        classes.forEach((className) => {
          if (typeof window[className] !== "undefined") {
            addStatus(`${className}: 利用可能`, "success");
          } else {
            addStatus(`${className}: 未定義`, "error");
          }
        });
      }

      function testInitialization() {
        addStatus("初期化テスト開始...", "info");

        try {
          // DataManager テスト
          if (typeof DataManager !== "undefined") {
            const dataManager = new DataManager();
            addStatus("DataManager インスタンス作成: 成功", "success");
          } else {
            addStatus("DataManager: 利用不可", "error");
          }

          // StorageManager テスト
          if (typeof StorageManager !== "undefined") {
            const storageManager = new StorageManager();
            addStatus("StorageManager インスタンス作成: 成功", "success");
          } else {
            addStatus("StorageManager: 利用不可", "error");
          }

          // TripleOSEngine テスト
          if (
            typeof TripleOSEngine !== "undefined" &&
            typeof DataManager !== "undefined"
          ) {
            const dataManager = new DataManager();
            const engine = new TripleOSEngine(dataManager);
            addStatus("TripleOSEngine インスタンス作成: 成功", "success");
          } else {
            addStatus("TripleOSEngine: 利用不可", "error");
          }
        } catch (error) {
          addStatus(`初期化エラー: ${error.message}`, "error");
          console.error("Initialization error:", error);
        }
      }

      function showWelcomeScreen() {
        addStatus("ウェルカム画面テスト開始...", "info");

        try {
          if (typeof WelcomeScreen !== "undefined") {
            const container = document.getElementById("welcome-container");
            container.style.display = "block";

            const welcomeScreen = new WelcomeScreen("welcome-container", {
              onStart: function () {
                addStatus(
                  "ウェルカム画面: スタートボタンがクリックされました",
                  "success"
                );
              },
            });

            welcomeScreen.render();
            welcomeScreen.bindEvents();

            addStatus("ウェルカム画面: 表示成功", "success");
          } else {
            addStatus("WelcomeScreen: 利用不可", "error");
          }
        } catch (error) {
          addStatus(`ウェルカム画面エラー: ${error.message}`, "error");
          console.error("WelcomeScreen error:", error);
        }
      }

      // 自動テスト実行
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(() => {
          addStatus("自動テスト開始", "info");
          testDataLoading();
          testClassLoading();
        }, 500);
      });
    </script>
  </body>
</html>
