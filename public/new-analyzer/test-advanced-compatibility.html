<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdvancedCompatibilityEngine ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .result { margin: 10px 0; padding: 10px; background: #f0f8ff; border-radius: 4px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ¯ AdvancedCompatibilityEngine çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-container">
        <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
        <button id="run-basic-test">åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
        <button id="run-advanced-test">é«˜åº¦åˆ†æãƒ†ã‚¹ãƒˆ</button>
        <button id="run-integration-test">çµ±åˆãƒ†ã‚¹ãƒˆ</button>
        <div id="test-results"></div>
    </div>

    <!-- åŸºæœ¬ã‚¯ãƒ©ã‚¹èª­ã¿è¾¼ã¿ -->
    <script src="js/core/BaseComponent.js"></script>
    <script src="js/core/DataManager.js"></script>
    <script src="js/core/Calculator.js"></script>
    <script src="js/core/Engine.js"></script>
    <script src="js/core/TripleOSEngine.js"></script>
    <script src="js/core/InternalCompatibilityEngine.js"></script>
    <script src="js/core/AdvancedCompatibilityEngine.js"></script>
    <script src="js/core/StorageManager.js"></script>

    <!-- ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="js/data/data_box.js"></script>
    <script src="js/data/questions.js"></script>
    <script src="js/data/vectors.js"></script>
    <script src="js/data/hexagrams.js"></script>
    <script src="js/data/hexagram_details.js"></script>
    <script src="js/data/compatibility_definition.js"></script>

    <script>
        class AdvancedCompatibilityTester {
            constructor() {
                this.results = [];
                this.setupTestEnvironment();
            }

            async setupTestEnvironment() {
                this.log('ğŸ”§ ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­...');
                
                try {
                    // å¿…è¦ãªã‚¯ãƒ©ã‚¹ã®åˆæœŸåŒ–
                    this.dataManager = new DataManager();
                    this.internalCompatibilityEngine = new InternalCompatibilityEngine(this.dataManager);
                    this.advancedCompatibilityEngine = new AdvancedCompatibilityEngine(this.internalCompatibilityEngine);
                    
                    this.log('âœ… ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†', 'success');
                } catch (error) {
                    this.log(`âŒ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const color = type === 'success' ? 'green' : type === 'error' ? 'red' : type === 'warning' ? 'orange' : 'black';
                
                console.log(`[${timestamp}] ${message}`);
                
                const resultsDiv = document.getElementById('test-results');
                const logElement = document.createElement('div');
                logElement.style.color = color;
                logElement.textContent = `[${timestamp}] ${message}`;
                resultsDiv.appendChild(logElement);
            }

            async runBasicTest() {
                this.log('ğŸ§ª åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
                
                try {
                    // ã‚¯ãƒ©ã‚¹ã®å­˜åœ¨ç¢ºèª
                    if (!this.advancedCompatibilityEngine) {
                        throw new Error('AdvancedCompatibilityEngine ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }
                    
                    this.log('âœ… AdvancedCompatibilityEngine åˆæœŸåŒ–ç¢ºèª', 'success');
                    
                    // ãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨ç¢ºèª
                    const requiredMethods = [
                        'analyzeInternalTeamComposition',
                        'detectSpecialPatterns',
                        'findHistoricalMatches',
                        'evaluateContextualFactors'
                    ];
                    
                    for (const method of requiredMethods) {
                        if (typeof this.advancedCompatibilityEngine[method] !== 'function') {
                            throw new Error(`å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ ${method} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                        }
                    }
                    
                    this.log('âœ… å¿…è¦ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨ç¢ºèªå®Œäº†', 'success');
                    
                } catch (error) {
                    this.log(`âŒ åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }

            async runAdvancedTest() {
                this.log('ğŸš€ é«˜åº¦åˆ†æãƒ†ã‚¹ãƒˆé–‹å§‹');
                
                try {
                    // ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿
                    const testEngineOS = 1;  // ä¹¾ç‚ºå¤©
                    const testInterfaceOS = 2; // å¤ç‚ºåœ°
                    const testSafeModeOS = 3;  // æ°´é›·å±¯
                    
                    const testUserContext = {
                        lifeStage: 'developing',
                        goals: ['personal_growth', 'career_growth'],
                        challenges: ['stress_management'],
                        environment: { type: 'corporate' }
                    };

                    this.log(`ğŸ“Š ãƒ†ã‚¹ãƒˆåˆ†æå®Ÿè¡Œ: Engine(${testEngineOS}) Interface(${testInterfaceOS}) SafeMode(${testSafeModeOS})`);
                    
                    const result = await this.advancedCompatibilityEngine.analyzeInternalTeamComposition(
                        testEngineOS, 
                        testInterfaceOS, 
                        testSafeModeOS, 
                        testUserContext
                    );
                    
                    if (!result) {
                        throw new Error('åˆ†æçµæœãŒ null ã§ã™');
                    }
                    
                    // çµæœã®æ§‹é€ ç¢ºèª
                    const expectedKeys = [
                        'basicCompatibility',
                        'detailedData',
                        'specialPattern',
                        'historicalMatches',
                        'contextualAdjustment',
                        'optimizationHints',
                        'overallAssessment'
                    ];
                    
                    for (const key of expectedKeys) {
                        if (!(key in result)) {
                            this.log(`âš ï¸ çµæœã« ${key} ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“`, 'warning');
                        } else {
                            this.log(`âœ… ${key} ç¢ºèª`, 'success');
                        }
                    }
                    
                    // ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºçµæœè¡¨ç¤º
                    if (result.specialPattern) {
                        this.log(`ğŸ¯ ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º: ${result.specialPattern.name}`, 'success');
                    }
                    
                    // æ­´å²äººç‰©ãƒãƒƒãƒãƒ³ã‚°çµæœè¡¨ç¤º
                    if (result.historicalMatches && result.historicalMatches.length > 0) {
                        this.log(`ğŸ‘‘ æ­´å²äººç‰©ãƒãƒƒãƒãƒ³ã‚°: ${result.historicalMatches.length}ä»¶`, 'success');
                        result.historicalMatches.forEach(match => {
                            this.log(`  - ${match.name} (é¡ä¼¼åº¦: ${Math.round(match.similarity * 100)}%)`, 'success');
                        });
                    }
                    
                    // æœ€é©åŒ–ãƒ’ãƒ³ãƒˆç¢ºèª
                    if (result.optimizationHints) {
                        const totalHints = Object.values(result.optimizationHints).reduce((sum, hints) => sum + hints.length, 0);
                        this.log(`ğŸ’¡ æœ€é©åŒ–ãƒ’ãƒ³ãƒˆ: ${totalHints}ä»¶`, 'success');
                    }
                    
                    this.log('âœ… é«˜åº¦åˆ†æãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                    
                } catch (error) {
                    this.log(`âŒ é«˜åº¦åˆ†æãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    console.error('è©³ç´°ã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            async runIntegrationTest() {
                this.log('ğŸ”„ çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹');
                
                try {
                    // è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®ãƒ†ã‚¹ãƒˆ
                    const testCases = [
                        { engine: 1, interface: 49, safeMode: 33 }, // ãƒ€ãƒ»ãƒ´ã‚£ãƒ³ãƒã‚¿ã‚¤ãƒ—
                        { engine: 11, interface: 45, safeMode: 15 }, // è–å¾³å¤ªå­ã‚¿ã‚¤ãƒ—
                        { engine: 1, interface: 43, safeMode: 51 }   // ã‚¸ãƒ§ãƒ–ã‚ºã‚¿ã‚¤ãƒ—
                    ];
                    
                    for (let i = 0; i < testCases.length; i++) {
                        const testCase = testCases[i];
                        this.log(`ğŸ“‹ çµ±åˆãƒ†ã‚¹ãƒˆ ${i + 1}/${testCases.length}: Engine(${testCase.engine}) Interface(${testCase.interface}) SafeMode(${testCase.safeMode})`);
                        
                        const result = await this.advancedCompatibilityEngine.analyzeInternalTeamComposition(
                            testCase.engine,
                            testCase.interface,
                            testCase.safeMode
                        );
                        
                        if (result && result.overallAssessment) {
                            const effectiveness = Math.round(result.overallAssessment.teamEffectiveness * 100);
                            this.log(`  âœ… ãƒãƒ¼ãƒ åŠ¹æœæ€§: ${effectiveness}%`, 'success');
                        } else {
                            this.log(`  âš ï¸ çµæœãŒä¸å®Œå…¨ã§ã™`, 'warning');
                        }
                    }
                    
                    this.log('âœ… çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                    
                } catch (error) {
                    this.log(`âŒ çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            const tester = new AdvancedCompatibilityTester();
            
            // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
            document.getElementById('run-basic-test').addEventListener('click', () => {
                tester.runBasicTest();
            });
            
            document.getElementById('run-advanced-test').addEventListener('click', () => {
                tester.runAdvancedTest();
            });
            
            document.getElementById('run-integration-test').addEventListener('click', () => {
                tester.runIntegrationTest();
            });
            
            // è‡ªå‹•çš„ã«åŸºæœ¬ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
            setTimeout(() => {
                tester.runBasicTest();
            }, 1000);
        });
    </script>
</body>
</html>