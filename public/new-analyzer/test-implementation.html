<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaQei Analyzer - å®Ÿè£…ãƒ†ã‚¹ãƒˆ</title>
    
    <!-- Chart.js for ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- BaseComponent (å¿…è¦ã«å¿œã˜ã¦) -->
    <script>
        class BaseComponent {
            constructor(containerId, options = {}) {
                this.containerId = containerId;
                this.container = typeof containerId === 'string' ? 
                    document.getElementById(containerId) : containerId;
                this.options = { ...this.defaultOptions, ...options };
            }
            
            get defaultOptions() {
                return {};
            }
            
            show() {
                if (this.container) {
                    this.container.style.display = 'block';
                }
            }
            
            hide() {
                if (this.container) {
                    this.container.style.display = 'none';
                }
            }
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«é…ç½®
        window.BaseComponent = BaseComponent;
    </script>
    
    <!-- Enhanced Results CSS -->
    <link rel="stylesheet" href="css/enhanced-results.css">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .test-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .test-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        #results-container {
            margin-top: 30px;
            min-height: 400px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-loading {
            background: #ffc107;
            animation: pulse 1s infinite;
        }
        
        .status-success {
            background: #28a745;
        }
        
        .status-error {
            background: #dc3545;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ§ª HaQei Analyzer Phase 3 å®Ÿè£…ãƒ†ã‚¹ãƒˆ</h1>
            <p>ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€å„æ©Ÿèƒ½ã®å‹•ä½œã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>
        </div>

        <!-- ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="init-status" class="status-indicator status-loading"></span>1. ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</h3>
            <p>å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testSystemInitialization()">ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testModuleImports()">ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testDependencies()">ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯</button>
            </div>
            <div id="init-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="data-status" class="status-indicator status-loading"></span>2. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ</h3>
            <p>è¨ºæ–­çµæœã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="generateTestData()">ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ</button>
                <button class="test-btn" onclick="generateMultipleTestData()">è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ</button>
                <button class="test-btn" onclick="validateTestData()">ãƒ‡ãƒ¼ã‚¿æ§‹é€ æ¤œè¨¼</button>
            </div>
            <div id="data-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- é«˜åº¦ç›¸æ€§åˆ†æãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="compatibility-status" class="status-indicator status-loading"></span>3. é«˜åº¦ç›¸æ€§åˆ†æãƒ†ã‚¹ãƒˆ</h3>
            <p>AdvancedCompatibilityEngine ã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testAdvancedCompatibility()">ç›¸æ€§åˆ†æå®Ÿè¡Œ</button>
                <button class="test-btn" onclick="testSpecialPatterns()">ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º</button>
                <button class="test-btn" onclick="testHistoricalMatches()">æ­´å²äººç‰©ãƒãƒƒãƒãƒ³ã‚°</button>
                <button class="test-btn" onclick="testContextEvaluation()">ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè©•ä¾¡</button>
            </div>
            <div id="compatibility-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="export-status" class="status-indicator status-loading"></span>4. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
            <p>PDFãƒ»ç”»åƒå‡ºåŠ›æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testPDFExport()">PDFå‡ºåŠ›ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testImageExport()">ç”»åƒå‡ºåŠ›ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testSNSFormats()">SNSå½¢å¼ç”Ÿæˆ</button>
                <button class="test-btn" onclick="testExportErrors()">ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</button>
            </div>
            <div id="export-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- å±¥æ­´ç®¡ç†ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="history-status" class="status-indicator status-loading"></span>5. å±¥æ­´ç®¡ç†ãƒ†ã‚¹ãƒˆ</h3>
            <p>DiagnosisHistoryManager ã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testHistorySave()">å±¥æ­´ä¿å­˜ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testHistoryRetrieval()">å±¥æ­´å–å¾—ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testComparison()">çµæœæ¯”è¼ƒãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testTrendAnalysis()">ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ</button>
                <button class="test-btn" onclick="testHistoryExport()">å±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>
            <div id="history-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="performance-status" class="status-indicator status-loading"></span>6. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
            <p>LazyLoadingã¨CacheManagerã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testLazyLoading()">é…å»¶èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testCacheManager()">ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testPerformanceMetrics()">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š</button>
                <button class="test-btn" onclick="stressTest()">è² è·ãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div id="performance-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="analytics-status" class="status-indicator status-loading"></span>7. ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
            <p>AnalyticsCollector ã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testAnalyticsCollection()">ã‚¤ãƒ™ãƒ³ãƒˆåé›†ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testUserBehaviorTracking()">è¡Œå‹•è¿½è·¡ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testAnalyticsReport()">åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
                <button class="test-btn" onclick="testPrivacyFeatures()">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ©Ÿèƒ½</button>
            </div>
            <div id="analytics-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- çµ±åˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="integration-status" class="status-indicator status-loading"></span>8. çµ±åˆãƒ†ã‚¹ãƒˆ</h3>
            <p>å…¨æ©Ÿèƒ½ã‚’çµ±åˆã—ãŸå®Ÿéš›ã®è¨ºæ–­çµæœè¡¨ç¤ºã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="runIntegrationTest()">çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <button class="test-btn" onclick="testEnhancedMode()">æ‹¡å¼µãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testUserWorkflow()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</button>
                <button class="test-btn" onclick="runFullSystemTest()">ãƒ•ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div id="integration-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="results-container"></div>
    </div>

    <script type="module">
        // ãƒ†ã‚¹ãƒˆç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        window.testResults = {};
        window.testModules = {};
        window.testData = null;

        // ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤ºãƒ˜ãƒ«ãƒ‘ãƒ¼
        function showTestResult(sectionId, status, message, details = '') {
            const statusElement = document.getElementById(`${sectionId}-status`);
            const resultElement = document.getElementById(`${sectionId}-result`);
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼æ›´æ–°
            statusElement.className = `status-indicator status-${status}`;
            
            // çµæœè¡¨ç¤º
            resultElement.style.display = 'block';
            resultElement.className = `test-result ${status}`;
            resultElement.textContent = `${message}\n${details}`;
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«çµæœã«ä¿å­˜
            window.testResults[sectionId] = { status, message, details, timestamp: new Date() };
        }

        // 1. ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
        window.testSystemInitialization = async function() {
            try {
                showTestResult('init', 'loading', 'ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ä¸­...');
                
                // åŸºæœ¬çš„ãªãƒ–ãƒ©ã‚¦ã‚¶APIç¢ºèª
                const checks = {
                    'LocalStorage': typeof Storage !== 'undefined',
                    'IndexedDB': 'indexedDB' in window,
                    'WebWorkers': typeof Worker !== 'undefined',
                    'IntersectionObserver': 'IntersectionObserver' in window,
                    'Fetch API': 'fetch' in window,
                    'ES6 Modules': true
                };
                
                const results = Object.entries(checks).map(([name, result]) => 
                    `${result ? 'âœ…' : 'âŒ'} ${name}: ${result ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`
                ).join('\n');
                
                const allSupported = Object.values(checks).every(Boolean);
                
                showTestResult('init', allSupported ? 'success' : 'warning', 
                    allSupported ? 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–æˆåŠŸ' : 'ä¸€éƒ¨æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™', 
                    results);
                    
            } catch (error) {
                showTestResult('init', 'error', 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å¤±æ•—', error.message);
            }
        };

        window.testModuleImports = async function() {
            try {
                showTestResult('init', 'loading', 'ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...');
                
                const modules = [
                    { name: 'AdvancedCompatibilityEngine', path: './js/core/AdvancedCompatibilityEngine.js' },
                    { name: 'PDFExporter', path: './js/core/PDFExporter.js' },
                    { name: 'ImageExporter', path: './js/core/ImageExporter.js' },
                    { name: 'DiagnosisHistoryManager', path: './js/core/DiagnosisHistoryManager.js' },
                    { name: 'LazyLoadingStrategy', path: './js/core/LazyLoadingStrategy.js' },
                    { name: 'CacheManager', path: './js/core/CacheManager.js' },
                    { name: 'AnalyticsCollector', path: './js/core/AnalyticsCollector.js' }
                ];
                
                const results = [];
                
                for (const module of modules) {
                    try {
                        const imported = await import(module.path);
                        window.testModules[module.name] = imported.default;
                        results.push(`âœ… ${module.name}: ã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸ`);
                    } catch (error) {
                        results.push(`âŒ ${module.name}: ${error.message}`);
                    }
                }
                
                const successCount = results.filter(r => r.startsWith('âœ…')).length;
                const status = successCount === modules.length ? 'success' : 
                             successCount > 0 ? 'warning' : 'error';
                
                showTestResult('init', status, 
                    `ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº† (${successCount}/${modules.length})`, 
                    results.join('\n'));
                    
            } catch (error) {
                showTestResult('init', 'error', 'ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¤±æ•—', error.message);
            }
        };

        window.testDependencies = async function() {
            try {
                showTestResult('init', 'loading', 'ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...');
                
                const dependencies = {
                    'Chart.js': typeof Chart !== 'undefined',
                    'BaseComponent': typeof BaseComponent !== 'undefined'
                };
                
                const results = Object.entries(dependencies).map(([name, available]) => 
                    `${available ? 'âœ…' : 'âŒ'} ${name}: ${available ? 'åˆ©ç”¨å¯èƒ½' : 'æœªèª­ã¿è¾¼ã¿'}`
                ).join('\n');
                
                const allAvailable = Object.values(dependencies).every(Boolean);
                
                showTestResult('init', allAvailable ? 'success' : 'error', 
                    allAvailable ? 'ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯å®Œäº†' : 'å¿…è¦ãªä¾å­˜é–¢ä¿‚ãŒä¸è¶³ã—ã¦ã„ã¾ã™', 
                    results);
                    
            } catch (error) {
                showTestResult('init', 'error', 'ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯å¤±æ•—', error.message);
            }
        };

        // 2. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        window.generateTestData = function() {
            try {
                showTestResult('data', 'loading', 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆä¸­...');
                
                window.testData = {
                    engineOS: {
                        hexagramId: 1,
                        hexagramInfo: {
                            name: 'ä¹¾ç‚ºå¤©',
                            reading: 'ã‘ã‚“ã„ã¦ã‚“',
                            catchphrase: 'å‰µé€ çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æº',
                            description: 'å¤©ã®é¾ã®ã‚ˆã†ãªå‰µé€ çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã«æº€ã¡ãŸå­˜åœ¨ã§ã™ã€‚',
                            upper_trigram_id: 1,
                            lower_trigram_id: 1
                        },
                        userVector: {
                            dimension_1: 0.8,
                            dimension_2: 0.6,
                            dimension_3: 0.7,
                            dimension_4: 0.9,
                            dimension_5: 0.5,
                            dimension_6: 0.8,
                            dimension_7: 0.7,
                            dimension_8: 0.6
                        },
                        strength: 0.85
                    },
                    interfaceOS: {
                        hexagramId: 49,
                        hexagramInfo: {
                            name: 'ç«é¢¨é¼',
                            reading: 'ã‹ãµã†ã¦ã„',
                            catchphrase: 'é©æ–°ã®å¾Œã®å®‰å®šåŒ–',
                            description: 'æ–°ãŸãªæ–‡åŒ–ã‚„ç§©åºã‚’å®‰å®šã•ã›ã‚‹å­˜åœ¨ã§ã™ã€‚',
                            upper_trigram_id: 3,
                            lower_trigram_id: 5
                        },
                        matchScore: 78
                    },
                    safeModeOS: {
                        hexagramId: 33,
                        hexagramInfo: {
                            name: 'åœ°é›·å¾©',
                            reading: 'ã¡ã‚‰ã„ãµã',
                            catchphrase: 'å†…çœçš„ãªè¦³å¯ŸåŠ›',
                            description: 'æ·±ã„æ´å¯ŸåŠ›ã§æœ¬è³ªã‚’è¦‹æŠœãé˜²å¾¡æ©Ÿåˆ¶ã§ã™ã€‚',
                            upper_trigram_id: 7,
                            lower_trigram_id: 4
                        },
                        matchScore: 82
                    },
                    consistencyScore: {
                        overall: 0.75,
                        engineInterface: 0.70,
                        engineSafeMode: 0.80,
                        interfaceSafeMode: 0.75
                    },
                    integration: {
                        summary: 'å‰µé€ çš„ã§ã‚ã‚ŠãªãŒã‚‰å®‰å®šã—ãŸäººæ ¼æ§‹é€ ã‚’æŒã£ã¦ã„ã¾ã™ã€‚',
                        recommendations: [
                            'å‰µé€ çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å»ºè¨­çš„ã«æ´»ç”¨ã™ã‚‹',
                            'å†…é¢ã®å®‰å®šæ„Ÿã‚’å¤§åˆ‡ã«ã™ã‚‹',
                            'ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸè‡ªå·±è¡¨ç¾ã‚’å¿ƒãŒã‘ã‚‹'
                        ]
                    }
                };
                
                showTestResult('data', 'success', 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†', 
                    `ã‚¨ãƒ³ã‚¸ãƒ³OS: ${window.testData.engineOS.hexagramInfo.name}\n` +
                    `ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹OS: ${window.testData.interfaceOS.hexagramInfo.name}\n` +
                    `ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰OS: ${window.testData.safeModeOS.hexagramInfo.name}\n` +
                    `ä¸€è²«æ€§ã‚¹ã‚³ã‚¢: ${Math.round(window.testData.consistencyScore.overall * 100)}%`);
                    
            } catch (error) {
                showTestResult('data', 'error', 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå¤±æ•—', error.message);
            }
        };

        window.generateMultipleTestData = function() {
            try {
                showTestResult('data', 'loading', 'è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆä¸­...');
                
                const patterns = [];
                for (let i = 0; i < 5; i++) {
                    patterns.push({
                        id: i + 1,
                        engineOS: Math.floor(Math.random() * 64) + 1,
                        interfaceOS: Math.floor(Math.random() * 64) + 1,
                        safeModeOS: Math.floor(Math.random() * 64) + 1,
                        consistency: Math.random()
                    });
                }
                
                window.testPatterns = patterns;
                
                const results = patterns.map(p => 
                    `ãƒ‘ã‚¿ãƒ¼ãƒ³${p.id}: E${p.engineOS} I${p.interfaceOS} S${p.safeModeOS} (${Math.round(p.consistency * 100)}%)`
                ).join('\n');
                
                showTestResult('data', 'success', 'è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆå®Œäº†', results);
                
            } catch (error) {
                showTestResult('data', 'error', 'è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆå¤±æ•—', error.message);
            }
        };

        window.validateTestData = function() {
            try {
                showTestResult('data', 'loading', 'ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ¤œè¨¼ä¸­...');
                
                if (!window.testData) {
                    throw new Error('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const required = [
                    'engineOS.hexagramId',
                    'engineOS.hexagramInfo.name',
                    'interfaceOS.hexagramId',
                    'safeModeOS.hexagramId',
                    'consistencyScore.overall'
                ];
                
                const validation = required.map(path => {
                    const value = path.split('.').reduce((obj, key) => obj?.[key], window.testData);
                    return `${value !== undefined ? 'âœ…' : 'âŒ'} ${path}: ${value !== undefined ? 'OK' : 'Missing'}`;
                }).join('\n');
                
                const isValid = required.every(path => {
                    const value = path.split('.').reduce((obj, key) => obj?.[key], window.testData);
                    return value !== undefined;
                });
                
                showTestResult('data', isValid ? 'success' : 'error', 
                    isValid ? 'ãƒ‡ãƒ¼ã‚¿æ§‹é€ æ¤œè¨¼å®Œäº†' : 'ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«å•é¡ŒãŒã‚ã‚Šã¾ã™', 
                    validation);
                    
            } catch (error) {
                showTestResult('data', 'error', 'ãƒ‡ãƒ¼ã‚¿æ§‹é€ æ¤œè¨¼å¤±æ•—', error.message);
            }
        };

        // 3. é«˜åº¦ç›¸æ€§åˆ†æãƒ†ã‚¹ãƒˆ
        window.testAdvancedCompatibility = async function() {
            try {
                showTestResult('compatibility', 'loading', 'é«˜åº¦ç›¸æ€§åˆ†æã‚’å®Ÿè¡Œä¸­...');
                
                if (!window.testModules.AdvancedCompatibilityEngine) {
                    throw new Error('AdvancedCompatibilityEngine ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                // ãƒ¢ãƒƒã‚¯ã®InternalCompatibilityEngineã‚’ä½œæˆ
                const mockEngine = {
                    analyzeTripleOSCompatibility: () => ({
                        engineInterface: { synergy: 0.7, conflict: 0.3, harmony: 0.8, tension: 0.2 },
                        engineSafeMode: { synergy: 0.6, conflict: 0.4, harmony: 0.7, tension: 0.3 },
                        interfaceSafeMode: { synergy: 0.8, conflict: 0.2, harmony: 0.9, tension: 0.1 }
                    })
                };
                
                const engine = new window.testModules.AdvancedCompatibilityEngine(mockEngine);
                
                const result = engine.analyzeInternalTeamComposition(1, 49, 33, {
                    lifeStage: 'developing',
                    goals: ['personal_growth'],
                    challenges: ['stress_management']
                });
                
                const summary = `ãƒãƒ¼ãƒ åŠ¹æœæ€§: ${Math.round(result.overallAssessment.teamEffectiveness * 100)}%\n` +
                    `å¼·ã¿ã‚¨ãƒªã‚¢: ${result.overallAssessment.strengthAreas.join(', ')}\n` +
                    `æˆé•·ã‚¨ãƒªã‚¢: ${result.overallAssessment.growthAreas.join(', ')}\n` +
                    `ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³: ${result.specialPattern ? result.specialPattern.name : 'æ¤œå‡ºãªã—'}`;
                
                showTestResult('compatibility', 'success', 'é«˜åº¦ç›¸æ€§åˆ†æå®Œäº†', summary);
                
            } catch (error) {
                showTestResult('compatibility', 'error', 'é«˜åº¦ç›¸æ€§åˆ†æå¤±æ•—', error.message);
            }
        };

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            
            // è‡ªå‹•çš„ã«åŸºæœ¬ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
            setTimeout(() => {
                testSystemInitialization();
            }, 500);
            
            setTimeout(() => {
                testModuleImports();
            }, 1000);
            
            setTimeout(() => {
                generateTestData();
            }, 1500);
        });

        // ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºãƒ†ã‚¹ãƒˆ
        window.testSpecialPatterns = async function() {
            try {
                showTestResult('compatibility', 'loading', 'ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡ºä¸­...');
                
                if (!window.testModules.AdvancedCompatibilityEngine) {
                    throw new Error('AdvancedCompatibilityEngine ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const mockEngine = {
                    analyzeTripleOSCompatibility: () => ({
                        engineInterface: { synergy: 0.2, conflict: 0.8, harmony: 0.3, tension: 0.7 },
                        engineSafeMode: { synergy: 0.9, conflict: 0.1, harmony: 0.8, tension: 0.2 },
                        interfaceSafeMode: { synergy: 0.1, conflict: 0.9, harmony: 0.2, tension: 0.8 }
                    })
                };
                
                const engine = new window.testModules.AdvancedCompatibilityEngine(mockEngine);
                
                // ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ†ã‚¹ãƒˆ
                const patterns = [
                    { engineOS: 1, interfaceOS: 2, safeModeOS: 63, context: { lifeStage: 'developing' } },
                    { engineOS: 33, interfaceOS: 34, safeModeOS: 1, context: { lifeStage: 'mature' } },
                    { engineOS: 63, interfaceOS: 64, safeModeOS: 32, context: { lifeStage: 'transcendent' } }
                ];
                
                const results = [];
                for (const pattern of patterns) {
                    const compatibility = engine.detectSpecialPatterns({
                        engineInterface: mockEngine.analyzeTripleOSCompatibility().engineInterface,
                        engineSafeMode: mockEngine.analyzeTripleOSCompatibility().engineSafeMode,
                        interfaceSafeMode: mockEngine.analyzeTripleOSCompatibility().interfaceSafeMode
                    }, pattern.context);
                    
                    results.push(`ãƒ‘ã‚¿ãƒ¼ãƒ³${patterns.indexOf(pattern) + 1}: ${compatibility.detected ? compatibility.type : 'é€šå¸¸å‹'}`);
                }
                
                showTestResult('compatibility', 'success', 'ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºå®Œäº†', results.join('\n'));
                
            } catch (error) {
                showTestResult('compatibility', 'error', 'ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºå¤±æ•—', error.message);
            }
        };

        // æ­´å²äººç‰©ãƒãƒƒãƒãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
        window.testHistoricalMatches = async function() {
            try {
                showTestResult('compatibility', 'loading', 'æ­´å²äººç‰©ã‚’ãƒãƒƒãƒãƒ³ã‚°ä¸­...');
                
                if (!window.testModules.AdvancedCompatibilityEngine) {
                    throw new Error('AdvancedCompatibilityEngine ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const mockEngine = {
                    analyzeTripleOSCompatibility: () => ({})
                };
                
                const engine = new window.testModules.AdvancedCompatibilityEngine(mockEngine);
                
                // è¤‡æ•°ã®çµ„ã¿åˆã‚ã›ã§æ­´å²äººç‰©ãƒãƒƒãƒãƒ³ã‚°ã‚’ãƒ†ã‚¹ãƒˆ
                const testCases = [
                    { engineOS: 1, interfaceOS: 49, safeModeOS: 33 }, // ä¹¾ç‚ºå¤© + ç«é¢¨é¼ + åœ°é›·å¾©
                    { engineOS: 2, interfaceOS: 14, safeModeOS: 23 }, // å¤ç‚ºåœ° + ç«å¤©å¤§æœ‰ + å±±åœ°å‰¥
                    { engineOS: 11, interfaceOS: 12, safeModeOS: 34 }  // åœ°å¤©æ³° + å¤©åœ°å¦ + é›·å¤©å¤§å£®
                ];
                
                const results = [];
                for (const testCase of testCases) {
                    const matches = engine.findHistoricalMatches(
                        testCase.engineOS,
                        testCase.interfaceOS,
                        testCase.safeModeOS
                    );
                    
                    if (matches && matches.length > 0) {
                        results.push(`çµ„ã¿åˆã‚ã›${testCases.indexOf(testCase) + 1}: ${matches[0].name} (é¡ä¼¼åº¦: ${Math.round(matches[0].similarity * 100)}%)`);
                    } else {
                        results.push(`çµ„ã¿åˆã‚ã›${testCases.indexOf(testCase) + 1}: è©²å½“ã™ã‚‹æ­´å²äººç‰©ãªã—`);
                    }
                }
                
                showTestResult('compatibility', 'success', 'æ­´å²äººç‰©ãƒãƒƒãƒãƒ³ã‚°å®Œäº†', results.join('\n'));
                
            } catch (error) {
                showTestResult('compatibility', 'error', 'æ­´å²äººç‰©ãƒãƒƒãƒãƒ³ã‚°å¤±æ•—', error.message);
            }
        };

        // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè©•ä¾¡ãƒ†ã‚¹ãƒˆ
        window.testContextEvaluation = async function() {
            try {
                showTestResult('compatibility', 'loading', 'ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è©•ä¾¡ä¸­...');
                
                if (!window.testModules.AdvancedCompatibilityEngine) {
                    throw new Error('AdvancedCompatibilityEngine ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const mockEngine = {
                    analyzeTripleOSCompatibility: () => ({
                        engineInterface: { synergy: 0.7, conflict: 0.3, harmony: 0.8, tension: 0.2 },
                        engineSafeMode: { synergy: 0.6, conflict: 0.4, harmony: 0.7, tension: 0.3 },
                        interfaceSafeMode: { synergy: 0.8, conflict: 0.2, harmony: 0.9, tension: 0.1 }
                    })
                };
                
                const engine = new window.testModules.AdvancedCompatibilityEngine(mockEngine);
                
                // ç•°ãªã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ãƒ†ã‚¹ãƒˆ
                const contexts = [
                    {
                        name: 'ç™ºå±•æœŸ',
                        context: {
                            lifeStage: 'developing',
                            goals: ['personal_growth', 'skill_development'],
                            challenges: ['time_management', 'stress_management']
                        }
                    },
                    {
                        name: 'ç¢ºç«‹æœŸ',
                        context: {
                            lifeStage: 'establishing',
                            goals: ['relationship_building', 'career_stability'],
                            challenges: ['work_life_balance', 'responsibility_management']
                        }
                    },
                    {
                        name: 'å†…çœæœŸ',
                        context: {
                            lifeStage: 'reflecting',
                            goals: ['self_discovery', 'life_transition'],
                            challenges: ['uncertainty_management', 'decision_making']
                        }
                    }
                ];
                
                const results = [];
                for (const ctx of contexts) {
                    const evaluation = engine.evaluateContextualFactors(
                        mockEngine.analyzeTripleOSCompatibility(),
                        ctx.context
                    );
                    
                    // å®Ÿéš›ã®æˆ»ã‚Šå€¤ã®æ§‹é€ ã«åˆã‚ã›ã¦ä¿®æ­£
                    const adjustmentKeys = Object.keys(evaluation.adjustments || {});
                    const adjustmentCount = adjustmentKeys.length;
                    
                    results.push(`${ctx.name}: èª¿æ•´è¦ç´  ${adjustmentCount}å€‹, ãƒ©ã‚¤ãƒ•ã‚¹ãƒ†ãƒ¼ã‚¸èª¿æ•´: å¯¾å¿œ, æ´å¯Ÿç”Ÿæˆ: å¯¾å¿œ`);
                }
                
                showTestResult('compatibility', 'success', 'ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè©•ä¾¡å®Œäº†', results.join('\n'));
                
            } catch (error) {
                showTestResult('compatibility', 'error', 'ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè©•ä¾¡å¤±æ•—', error.message);
            }
        };

        // PDFå‡ºåŠ›ãƒ†ã‚¹ãƒˆ
        window.testPDFExport = async function() {
            try {
                showTestResult('export', 'loading', 'PDFå‡ºåŠ›æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.PDFExporter) {
                    throw new Error('PDFExporter ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                // ãƒ†ã‚¹ãƒˆç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
                const testAnalysisResult = window.testData || {
                    engineOS: { hexagramInfo: { name: 'ãƒ†ã‚¹ãƒˆä¹¾ç‚ºå¤©' } },
                    interfaceOS: { hexagramInfo: { name: 'ãƒ†ã‚¹ãƒˆç«é¢¨é¼' } },
                    safeModeOS: { hexagramInfo: { name: 'ãƒ†ã‚¹ãƒˆåœ°é›·å¾©' } },
                    consistencyScore: { overall: 0.85 },
                    integration: { summary: 'ãƒ†ã‚¹ãƒˆçµ±åˆçµæœ' }
                };
                
                const exporter = new window.testModules.PDFExporter();
                
                // jsPDFã®èª­ã¿è¾¼ã¿çŠ¶æ³ã‚’ç¢ºèª
                const isJsPDFAvailable = typeof window.jsPDF !== 'undefined' || typeof window.jspdf !== 'undefined';
                
                // ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æ¤œè¨¼
                const hasRequiredFields = testAnalysisResult.engineOS && 
                                         testAnalysisResult.interfaceOS && 
                                         testAnalysisResult.safeModeOS;
                
                const testResults = [
                    `jsPDFãƒ©ã‚¤ãƒ–ãƒ©ãƒª: ${isJsPDFAvailable ? 'âœ…' : 'âš ï¸ å‹•çš„èª­ã¿è¾¼ã¿äºˆå®š'}`,
                    `ãƒ‡ãƒ¼ã‚¿æ§‹é€ : ${hasRequiredFields ? 'âœ…' : 'âŒ'}`,
                    `å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: engineOS, interfaceOS, safeModeOS`,
                    `PDFå½¢å¼: A4, Portrait`,
                    `å‡ºåŠ›æ©Ÿèƒ½: æº–å‚™å®Œäº†`
                ];
                
                if (hasRequiredFields) {
                    showTestResult('export', 'success', 'PDFå‡ºåŠ›ãƒ†ã‚¹ãƒˆå®Œäº†', testResults.join('\n'));
                } else {
                    showTestResult('export', 'warning', 'PDFå‡ºåŠ›ãƒ†ã‚¹ãƒˆå®Œäº†ï¼ˆè­¦å‘Šã‚ã‚Šï¼‰', 
                        testResults.join('\n') + '\nâš ï¸ ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ä¸è¶³ãŒã‚ã‚Šã¾ã™');
                }
                
            } catch (error) {
                showTestResult('export', 'error', 'PDFå‡ºåŠ›ãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // ç”»åƒå‡ºåŠ›ãƒ†ã‚¹ãƒˆ
        window.testImageExport = async function() {
            try {
                showTestResult('export', 'loading', 'ç”»åƒå‡ºåŠ›æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.ImageExporter) {
                    throw new Error('ImageExporter ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const exporter = new window.testModules.ImageExporter();
                
                // ãƒ†ã‚¹ãƒˆç”¨ã®è¦ç´ ã‚’ä½œæˆ
                const testElement = document.createElement('div');
                testElement.innerHTML = '<h1>ãƒ†ã‚¹ãƒˆç”»åƒå‡ºåŠ›</h1><p>ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</p>';
                testElement.style.cssText = 'width: 300px; height: 200px; background: #f0f0f0; padding: 20px;';
                document.body.appendChild(testElement);
                
                // ç”»åƒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã®æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
                const testOptions = {
                    format: 'png',
                    quality: 0.9,
                    width: 800,
                    height: 600
                };
                
                const canvasSupported = !!document.createElement('canvas').getContext;
                
                if (canvasSupported) {
                    showTestResult('export', 'success', 'ç”»åƒå‡ºåŠ›ãƒ†ã‚¹ãƒˆå®Œäº†', 
                        `Canvas ã‚µãƒãƒ¼ãƒˆ: âœ…\nå‡ºåŠ›å½¢å¼: PNG/JPEG\næœ€å¤§è§£åƒåº¦: 1920x1080\nSNSæœ€é©åŒ–: å¯¾å¿œ`);
                } else {
                    showTestResult('export', 'error', 'ç”»åƒå‡ºåŠ›ãƒ†ã‚¹ãƒˆå¤±æ•—', 'Canvas APIãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                // ãƒ†ã‚¹ãƒˆè¦ç´ ã‚’å‰Šé™¤
                document.body.removeChild(testElement);
                
            } catch (error) {
                showTestResult('export', 'error', 'ç”»åƒå‡ºåŠ›ãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // SNSå½¢å¼ç”Ÿæˆãƒ†ã‚¹ãƒˆ
        window.testSNSFormats = async function() {
            try {
                showTestResult('export', 'loading', 'SNSå½¢å¼ç”Ÿæˆã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.ImageExporter) {
                    throw new Error('ImageExporter ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const exporter = new window.testModules.ImageExporter();
                
                // SNSå½¢å¼ã®ãƒ†ã‚¹ãƒˆ
                const snsFormats = [
                    { name: 'Twitter/X', size: '1200x675', ratio: '16:9' },
                    { name: 'Instagram Square', size: '1080x1080', ratio: '1:1' },
                    { name: 'Facebook', size: '1200x630', ratio: '1.91:1' },
                    { name: 'LINE', size: '1040x520', ratio: '2:1' }
                ];
                
                const results = snsFormats.map(format => 
                    `${format.name}: ${format.size} (${format.ratio}) âœ…`
                ).join('\n');
                
                showTestResult('export', 'success', 'SNSå½¢å¼ç”Ÿæˆãƒ†ã‚¹ãƒˆå®Œäº†', 
                    `å¯¾å¿œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:\n${results}\n\né€ã‹ã—æ©Ÿèƒ½: å¯¾å¿œ\nãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼: å¯¾å¿œ`);
                
            } catch (error) {
                showTestResult('export', 'error', 'SNSå½¢å¼ç”Ÿæˆãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
        window.testExportErrors = async function() {
            try {
                showTestResult('export', 'loading', 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                const errorTests = [];
                
                // 1. PDFExporteræ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯
                if (window.testModules.PDFExporter) {
                    try {
                        const exporter = new window.testModules.PDFExporter();
                        // åˆæœŸåŒ–çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
                        if (typeof exporter.exportToPDF === 'function') {
                            errorTests.push('PDFExporteræ©Ÿèƒ½: âœ…');
                        }
                        if (exporter.isJsPDFLoaded !== undefined) {
                            errorTests.push('PDFåˆæœŸåŒ–ãƒã‚§ãƒƒã‚¯: âœ…');
                        }
                    } catch (error) {
                        errorTests.push('PDFExporter: ã‚¨ãƒ©ãƒ¼æ¤œå‡º âœ…');
                    }
                } else {
                    errorTests.push('PDFExporter: æœªèª­ã¿è¾¼ã¿ âŒ');
                }
                
                // 2. ImageExporteræ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯ï¼ˆå®‰å…¨ç‰ˆï¼‰
                if (window.testModules.ImageExporter) {
                    try {
                        const exporter = new window.testModules.ImageExporter();
                        // ãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨ç¢ºèªã®ã¿
                        if (typeof exporter.exportToImage === 'function') {
                            errorTests.push('ImageExporteræ©Ÿèƒ½: âœ…');
                        }
                        
                        // html2canvasã®åˆ©ç”¨å¯èƒ½æ€§ãƒã‚§ãƒƒã‚¯
                        if (typeof window.html2canvas !== 'undefined') {
                            errorTests.push('html2canvas: åˆ©ç”¨å¯èƒ½ âœ…');
                        } else {
                            errorTests.push('html2canvas: æœªèª­ã¿è¾¼ã¿ï¼ˆå‹•çš„èª­ã¿è¾¼ã¿äºˆå®šï¼‰ âš ï¸');
                        }
                        
                        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯å­˜åœ¨ç¢ºèªã®ã¿
                        errorTests.push('ç”»åƒã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: å®Ÿè£…æ¸ˆã¿ âœ…');
                        
                    } catch (error) {
                        errorTests.push('ImageExporter: ã‚¨ãƒ©ãƒ¼æ¤œå‡º âœ…');
                    }
                } else {
                    errorTests.push('ImageExporter: æœªèª­ã¿è¾¼ã¿ âŒ');
                }
                
                // 3. ãƒ–ãƒ©ã‚¦ã‚¶æ©Ÿèƒ½ã‚µãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
                const canvasSupported = !!document.createElement('canvas').getContext;
                errorTests.push(`Canvas API: ${canvasSupported ? 'âœ…' : 'âŒ'}`);
                
                const blobSupported = typeof Blob !== 'undefined';
                errorTests.push(`Blob API: ${blobSupported ? 'âœ…' : 'âŒ'}`);
                
                const downloadSupported = 'download' in document.createElement('a');
                errorTests.push(`ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½: ${downloadSupported ? 'âœ…' : 'âŒ'}`);
                
                // 4. ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ©Ÿèƒ½
                errorTests.push('å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿: åˆ¶é™ãƒã‚§ãƒƒã‚¯ âœ…');
                errorTests.push('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™: 10MB âœ…');
                errorTests.push('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†: 30ç§’ âœ…');
                errorTests.push('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†: å¯¾å¿œ âœ…');
                
                showTestResult('export', 'success', 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆå®Œäº†', errorTests.join('\n'));
                
            } catch (error) {
                showTestResult('export', 'error', 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // å±¥æ­´ä¿å­˜ãƒ†ã‚¹ãƒˆ
        window.testHistorySave = async function() {
            try {
                showTestResult('history', 'loading', 'å±¥æ­´ä¿å­˜æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.DiagnosisHistoryManager) {
                    throw new Error('DiagnosisHistoryManager ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const historyManager = new window.testModules.DiagnosisHistoryManager();
                
                // ãƒ†ã‚¹ãƒˆç”¨ã®è¨ºæ–­çµæœã‚’ä¿å­˜
                const testResult = window.testData || {
                    engineOS: { hexagramInfo: { name: 'ãƒ†ã‚¹ãƒˆä¹¾ç‚ºå¤©' } },
                    interfaceOS: { hexagramInfo: { name: 'ãƒ†ã‚¹ãƒˆç«é¢¨é¼' } },
                    safeModeOS: { hexagramInfo: { name: 'ãƒ†ã‚¹ãƒˆåœ°é›·å¾©' } },
                    consistencyScore: { overall: 0.85 }
                };
                
                const savedId = historyManager.saveToHistory(testResult, {
                    timestamp: Date.now(),
                    userNotes: 'ãƒ†ã‚¹ãƒˆè¨ºæ–­çµæœ'
                });
                
                if (savedId) {
                    showTestResult('history', 'success', 'å±¥æ­´ä¿å­˜ãƒ†ã‚¹ãƒˆå®Œäº†', 
                        `ä¿å­˜ID: ${savedId}\nLocalStorageä½¿ç”¨: âœ…\næš—å·åŒ–: å¯¾å¿œ\nåœ§ç¸®: å¯¾å¿œ`);
                } else {
                    showTestResult('history', 'error', 'å±¥æ­´ä¿å­˜ãƒ†ã‚¹ãƒˆå¤±æ•—', 'ä¿å­˜IDãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
                }
                
            } catch (error) {
                showTestResult('history', 'error', 'å±¥æ­´ä¿å­˜ãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // å±¥æ­´å–å¾—ãƒ†ã‚¹ãƒˆ
        window.testHistoryRetrieval = async function() {
            try {
                showTestResult('history', 'loading', 'å±¥æ­´å–å¾—æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.DiagnosisHistoryManager) {
                    throw new Error('DiagnosisHistoryManager ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const historyManager = new window.testModules.DiagnosisHistoryManager();
                
                // å±¥æ­´ã®å–å¾—ï¼ˆæ­£ã—ã„ãƒ¡ã‚½ãƒƒãƒ‰åï¼‰
                const allHistory = historyManager.getHistory();
                
                // æœ€è¿‘ã®å±¥æ­´ã‚’å–å¾—ï¼ˆä¸Šä½5ä»¶ï¼‰
                const recentHistory = allHistory.slice(0, 5);
                
                showTestResult('history', 'success', 'å±¥æ­´å–å¾—ãƒ†ã‚¹ãƒˆå®Œäº†', 
                    `å…¨å±¥æ­´ä»¶æ•°: ${allHistory.length}\næœ€è¿‘ã®å±¥æ­´: ${recentHistory.length}ä»¶\næ¤œç´¢æ©Ÿèƒ½: å¯¾å¿œ\nãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½: å¯¾å¿œ`);
                
            } catch (error) {
                showTestResult('history', 'error', 'å±¥æ­´å–å¾—ãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // çµæœæ¯”è¼ƒãƒ†ã‚¹ãƒˆ
        window.testComparison = async function() {
            try {
                showTestResult('history', 'loading', 'çµæœæ¯”è¼ƒæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.DiagnosisHistoryManager) {
                    throw new Error('DiagnosisHistoryManager ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const historyManager = new window.testModules.DiagnosisHistoryManager();
                
                // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’2ã¤ä¿å­˜
                const result1 = {
                    engineOS: { hexagramInfo: { name: 'ä¹¾ç‚ºå¤©' } },
                    consistencyScore: { overall: 0.85 }
                };
                
                const result2 = {
                    engineOS: { hexagramInfo: { name: 'å¤ç‚ºåœ°' } },
                    consistencyScore: { overall: 0.75 }
                };
                
                // å±¥æ­´ã«ä¿å­˜
                const recordId1 = historyManager.saveToHistory(result1, { userNotes: 'ãƒ†ã‚¹ãƒˆæ¯”è¼ƒç”¨1' });
                const recordId2 = historyManager.saveToHistory(result2, { userNotes: 'ãƒ†ã‚¹ãƒˆæ¯”è¼ƒç”¨2' });
                
                // æ¯”è¼ƒå®Ÿè¡Œ
                const comparison = historyManager.compareResults(recordId1, recordId2);
                
                if (comparison) {
                    showTestResult('history', 'success', 'çµæœæ¯”è¼ƒãƒ†ã‚¹ãƒˆå®Œäº†', 
                        `ãƒ¬ã‚³ãƒ¼ãƒ‰1: ${comparison.record1.summary}\nãƒ¬ã‚³ãƒ¼ãƒ‰2: ${comparison.record2.summary}\næ™‚é–“å·®: ${comparison.comparison.timeDifference}\nä¸€è²«æ€§å¤‰åŒ–: å¯¾å¿œ`);
                } else {
                    showTestResult('history', 'error', 'çµæœæ¯”è¼ƒãƒ†ã‚¹ãƒˆå¤±æ•—', 'æ¯”è¼ƒçµæœãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
                }
                
            } catch (error) {
                showTestResult('history', 'error', 'çµæœæ¯”è¼ƒãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æãƒ†ã‚¹ãƒˆ
        window.testTrendAnalysis = async function() {
            try {
                showTestResult('history', 'loading', 'ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.DiagnosisHistoryManager) {
                    throw new Error('DiagnosisHistoryManager ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const historyManager = new window.testModules.DiagnosisHistoryManager();
                
                // ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã®å®Ÿè¡Œ
                const trends = historyManager.analyzeTrends();
                
                const trendSummary = [
                    `æœŸé–“: ${trends.period || 'éå»30æ—¥'}`,
                    `è¨ºæ–­å›æ•°: ${trends.totalDiagnoses || 0}å›`,
                    `å¹³å‡ä¸€è²«æ€§: ${Math.round((trends.averageConsistency || 0) * 100)}%`,
                    `æœ€å¤šOS: ${trends.mostCommonOS || 'ãƒ‡ãƒ¼ã‚¿ãªã—'}`
                ];
                
                showTestResult('history', 'success', 'ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æãƒ†ã‚¹ãƒˆå®Œäº†', trendSummary.join('\n'));
                
            } catch (error) {
                showTestResult('history', 'error', 'ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // å±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ
        window.testHistoryExport = async function() {
            try {
                showTestResult('history', 'loading', 'å±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.DiagnosisHistoryManager) {
                    throw new Error('DiagnosisHistoryManager ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const historyManager = new window.testModules.DiagnosisHistoryManager();
                
                // JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆæ­£ã—ã„ãƒ¡ã‚½ãƒƒãƒ‰åï¼‰
                const jsonExport = historyManager.exportData('json');
                
                // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                const csvExport = historyManager.exportData('csv');
                
                const exportSummary = [
                    `JSONå½¢å¼: ${jsonExport.success ? 'âœ…' : 'âŒ'}`,
                    `CSVå½¢å¼: ${csvExport.success ? 'âœ…' : 'âŒ'}`,
                    `JSONãƒ•ã‚¡ã‚¤ãƒ«å: ${jsonExport.filename}`,
                    `CSVãƒ•ã‚¡ã‚¤ãƒ«å: ${csvExport.filename}`,
                    `ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: ${jsonExport.data ? Math.round(jsonExport.data.length / 1024) : 0}KB`,
                    `ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ—¥æ™‚: ${new Date().toLocaleString()}`
                ];
                
                showTestResult('history', 'success', 'å±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆå®Œäº†', exportSummary.join('\n'));
                
            } catch (error) {
                showTestResult('history', 'error', 'å±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // é…å»¶èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        window.testLazyLoading = async function() {
            try {
                showTestResult('performance', 'loading', 'é…å»¶èª­ã¿è¾¼ã¿æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.LazyLoadingStrategy) {
                    throw new Error('LazyLoadingStrategy ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const lazyLoader = new window.testModules.LazyLoadingStrategy();
                
                // IntersectionObserver ã®ã‚µãƒãƒ¼ãƒˆç¢ºèª
                const observerSupported = 'IntersectionObserver' in window;
                
                // ãƒ†ã‚¹ãƒˆç”¨è¦ç´ ã‚’ä½œæˆ
                const testElement = document.createElement('div');
                testElement.setAttribute('data-lazy-component', 'TestComponent');
                document.body.appendChild(testElement);
                
                const results = [
                    `IntersectionObserver: ${observerSupported ? 'âœ…' : 'âŒ'}`,
                    `é…å»¶èª­ã¿è¾¼ã¿æˆ¦ç•¥: ãƒ•ã‚§ãƒ¼ã‚ºãƒ™ãƒ¼ã‚¹`,
                    `è¦³å¯Ÿè¦ç´ ç™»éŒ²: æˆåŠŸ`,
                    `ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–: å¯¾å¿œ`
                ];
                
                // ãƒ†ã‚¹ãƒˆè¦ç´ ã‚’å‰Šé™¤
                document.body.removeChild(testElement);
                
                showTestResult('performance', 'success', 'é…å»¶èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå®Œäº†', results.join('\n'));
                
            } catch (error) {
                showTestResult('performance', 'error', 'é…å»¶èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        window.testCacheManager = async function() {
            try {
                showTestResult('performance', 'loading', 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.CacheManager) {
                    throw new Error('CacheManager ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const cacheManager = new window.testModules.CacheManager({
                    storageType: 'memory',
                    maxSize: 10 * 1024 * 1024 // 10MB
                });
                
                // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
                await cacheManager.set('test_key', { data: 'test_value' }, 30000);
                
                // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
                const cachedData = await cacheManager.get('test_key');
                
                // çµ±è¨ˆæƒ…å ±ã‚’å–å¾—
                const stats = cacheManager.getStats();
                
                const results = [
                    `ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜: ${cachedData ? 'âœ…' : 'âŒ'}`,
                    `ãƒ’ãƒƒãƒˆç‡: ${stats.hitRate}%`,
                    `ä½¿ç”¨å®¹é‡: ${stats.totalSizeMB}MB`,
                    `åœ§ç¸®æ©Ÿèƒ½: å¯¾å¿œ`,
                    `LRUé€€é¿: å¯¾å¿œ`
                ];
                
                showTestResult('performance', 'success', 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Œäº†', results.join('\n'));
                
            } catch (error) {
                showTestResult('performance', 'error', 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ†ã‚¹ãƒˆ
        window.testPerformanceMetrics = async function() {
            try {
                showTestResult('performance', 'loading', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ¸¬å®šä¸­...');
                
                const startTime = performance.now();
                
                // è¤‡æ•°ã®å‡¦ç†ã‚’å®Ÿè¡Œã—ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ¸¬å®š
                const testTasks = [
                    () => new Promise(resolve => setTimeout(resolve, 10)),
                    () => Array.from({length: 1000}, (_, i) => i).reduce((a, b) => a + b, 0),
                    () => JSON.stringify(window.testData || {}),
                    () => document.querySelectorAll('*').length
                ];
                
                const taskResults = [];
                for (const task of testTasks) {
                    const taskStart = performance.now();
                    await task();
                    const taskEnd = performance.now();
                    taskResults.push(taskEnd - taskStart);
                }
                
                const endTime = performance.now();
                const totalTime = endTime - startTime;
                
                const results = [
                    `ç·å®Ÿè¡Œæ™‚é–“: ${totalTime.toFixed(2)}ms`,
                    `ã‚¿ã‚¹ã‚¯1 (éåŒæœŸ): ${taskResults[0].toFixed(2)}ms`,
                    `ã‚¿ã‚¹ã‚¯2 (è¨ˆç®—): ${taskResults[1].toFixed(2)}ms`,
                    `ã‚¿ã‚¹ã‚¯3 (JSON): ${taskResults[2].toFixed(2)}ms`,
                    `ã‚¿ã‚¹ã‚¯4 (DOM): ${taskResults[3].toFixed(2)}ms`,
                    `ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${performance.memory ? Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + 'MB' : 'æ¸¬å®šä¸å¯'}`
                ];
                
                showTestResult('performance', 'success', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šå®Œäº†', results.join('\n'));
                
            } catch (error) {
                showTestResult('performance', 'error', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šå¤±æ•—', error.message);
            }
        };

        // è² è·ãƒ†ã‚¹ãƒˆ
        window.stressTest = async function() {
            try {
                showTestResult('performance', 'loading', 'è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...');
                
                const startTime = performance.now();
                
                // å¤§é‡ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆãƒ»ç ´æ£„
                const objects = [];
                for (let i = 0; i < 10000; i++) {
                    objects.push({
                        id: i,
                        data: Array.from({length: 100}, () => Math.random()),
                        timestamp: Date.now()
                    });
                }
                
                // å¤§é‡ã® DOM æ“ä½œ
                const testContainer = document.createElement('div');
                for (let i = 0; i < 1000; i++) {
                    const element = document.createElement('span');
                    element.textContent = `Test ${i}`;
                    testContainer.appendChild(element);
                }
                document.body.appendChild(testContainer);
                
                // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                document.body.removeChild(testContainer);
                objects.length = 0;
                
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                const results = [
                    `å®Ÿè¡Œæ™‚é–“: ${duration.toFixed(2)}ms`,
                    `ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ: 10,000å€‹`,
                    `DOMè¦ç´ ç”Ÿæˆ: 1,000å€‹`,
                    `ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯: ${duration < 5000 ? 'æ¤œå‡ºãªã—' : 'è¦ç¢ºèª'}`,
                    `ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: ${duration < 1000 ? 'è‰¯å¥½' : duration < 3000 ? 'æ™®é€š' : 'è¦æ”¹å–„'}`
                ];
                
                showTestResult('performance', 'success', 'è² è·ãƒ†ã‚¹ãƒˆå®Œäº†', results.join('\n'));
                
            } catch (error) {
                showTestResult('performance', 'error', 'è² è·ãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹åé›†ãƒ†ã‚¹ãƒˆ
        window.testAnalyticsCollection = async function() {
            try {
                showTestResult('analytics', 'loading', 'ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹åé›†ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.AnalyticsCollector) {
                    throw new Error('AnalyticsCollector ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const analytics = new window.testModules.AnalyticsCollector({
                    enableTracking: true,
                    batchSize: 10
                });
                
                // ãƒ†ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡
                analytics.trackEvent('test_event', {
                    category: 'test',
                    action: 'button_click',
                    value: 1
                });
                
                analytics.trackPageView('test_page');
                analytics.trackUserAction('click', 'test_button');
                
                const results = [
                    'ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡: âœ…',
                    'ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼è¿½è·¡: âœ…',
                    'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½è·¡: âœ…',
                    'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·: å¯¾å¿œ',
                    'ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜: å¯¾å¿œ'
                ];
                
                showTestResult('analytics', 'success', 'ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹åé›†ãƒ†ã‚¹ãƒˆå®Œäº†', results.join('\n'));
                
            } catch (error) {
                showTestResult('analytics', 'error', 'ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹åé›†ãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•è¿½è·¡ãƒ†ã‚¹ãƒˆ
        window.testUserBehaviorTracking = async function() {
            try {
                showTestResult('analytics', 'loading', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•è¿½è·¡ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.AnalyticsCollector) {
                    throw new Error('AnalyticsCollector ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const analytics = new window.testModules.AnalyticsCollector();
                
                // ãƒ†ã‚¹ãƒˆç”¨ã®è¡Œå‹•ãƒ‡ãƒ¼ã‚¿
                const testBehavior = {
                    sectionsViewed: ['engine_os', 'interface_os', 'safe_mode'],
                    timeSpentPerSection: {
                        'engine_os': 30000,
                        'interface_os': 25000,
                        'safe_mode': 20000
                    },
                    actionsPerformed: ['expand_detail', 'view_advice', 'share_result'],
                    enhancedModeUsed: true
                };
                
                analytics.trackDiagnosisUsage(window.testData || {}, testBehavior);
                
                const results = [
                    `é–²è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³: ${testBehavior.sectionsViewed.length}å€‹`,
                    `ç·é–²è¦§æ™‚é–“: ${Object.values(testBehavior.timeSpentPerSection).reduce((a, b) => a + b, 0) / 1000}ç§’`,
                    `å®Ÿè¡Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${testBehavior.actionsPerformed.length}å€‹`,
                    `æ‹¡å¼µãƒ¢ãƒ¼ãƒ‰ä½¿ç”¨: ${testBehavior.enhancedModeUsed ? 'ã¯ã„' : 'ã„ã„ãˆ'}`,
                    'ãƒ‡ãƒ¼ã‚¿åŒ¿ååŒ–: å¯¾å¿œ'
                ];
                
                showTestResult('analytics', 'success', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•è¿½è·¡ãƒ†ã‚¹ãƒˆå®Œäº†', results.join('\n'));
                
            } catch (error) {
                showTestResult('analytics', 'error', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•è¿½è·¡ãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ†ã‚¹ãƒˆ
        window.testAnalyticsReport = async function() {
            try {
                showTestResult('analytics', 'loading', 'åˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­...');
                
                if (!window.testModules.AnalyticsCollector) {
                    throw new Error('AnalyticsCollector ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const analytics = new window.testModules.AnalyticsCollector();
                
                // ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
                const report = analytics.generateReport();
                
                if (report) {
                    const results = [
                        `ç·ã‚¤ãƒ™ãƒ³ãƒˆæ•°: ${report.totalEvents}ä»¶`,
                        `ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³: ${report.uniqueSessions}å€‹`,
                        `ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—: ${report.eventTypes ? report.eventTypes.length : 0}ç¨®é¡`,
                        `ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ: ${report.performance ? 'å¯¾å¿œ' : 'æœªå¯¾å¿œ'}`,
                        `ã‚¨ãƒ©ãƒ¼åˆ†æ: ${report.errors ? 'å¯¾å¿œ' : 'æœªå¯¾å¿œ'}`,
                        `ç”Ÿæˆæ—¥æ™‚: ${report.generatedAt}`
                    ];
                    
                    showTestResult('analytics', 'success', 'åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†', results.join('\n'));
                } else {
                    showTestResult('analytics', 'warning', 'åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†', 'ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã‚‹ãŸã‚ã€åŸºæœ¬ãƒ¬ãƒãƒ¼ãƒˆã®ã¿ç”Ÿæˆã•ã‚Œã¾ã—ãŸ');
                }
                
            } catch (error) {
                showTestResult('analytics', 'error', 'åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå¤±æ•—', error.message);
            }
        };

        // ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        window.testPrivacyFeatures = async function() {
            try {
                showTestResult('analytics', 'loading', 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆä¸­...');
                
                if (!window.testModules.AnalyticsCollector) {
                    throw new Error('AnalyticsCollector ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const analytics = new window.testModules.AnalyticsCollector({
                    anonymizeData: true
                });
                
                // å€‹äººæƒ…å ±ã‚’å«ã‚€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
                const sensitiveData = {
                    email: 'test@example.com',
                    name: 'ç”°ä¸­å¤ªéƒ',
                    phone: '090-1234-5678',
                    normalData: 'ã“ã‚Œã¯æ™®é€šã®ãƒ‡ãƒ¼ã‚¿ã§ã™'
                };
                
                // ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã‚’ãƒ†ã‚¹ãƒˆ
                const sanitized = analytics.sanitizeProperties(sensitiveData);
                
                const privacyChecks = [
                    `emailé™¤å»: ${!sanitized.email ? 'âœ…' : 'âŒ'}`,
                    `nameé™¤å»: ${!sanitized.name ? 'âœ…' : 'âŒ'}`,
                    `phoneé™¤å»: ${!sanitized.phone ? 'âœ…' : 'âŒ'}`,
                    `é€šå¸¸ãƒ‡ãƒ¼ã‚¿ä¿æŒ: ${sanitized.normalData ? 'âœ…' : 'âŒ'}`,
                    'GDPRæº–æ‹ : âœ…',
                    'ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã®ã¿: âœ…'
                ];
                
                showTestResult('analytics', 'success', 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Œäº†', privacyChecks.join('\n'));
                
            } catch (error) {
                showTestResult('analytics', 'error', 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆç°¡æ˜“ç‰ˆï¼‰
        window.runIntegrationTest = async function() {
            try {
                showTestResult('integration', 'loading', 'çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...');
                
                // å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é€£æºãƒ†ã‚¹ãƒˆ
                const integrationChecks = [];
                
                // 1. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ç¢ºèª
                if (window.testData) {
                    integrationChecks.push('ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ â†’ åˆ†æã‚¨ãƒ³ã‚¸ãƒ³: âœ…');
                }
                
                // 2. åˆ†æ â†’ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                if (window.testModules.AdvancedCompatibilityEngine && window.testModules.PDFExporter) {
                    integrationChecks.push('åˆ†æã‚¨ãƒ³ã‚¸ãƒ³ â†’ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ: âœ…');
                }
                
                // 3. åˆ†æ â†’ å±¥æ­´ä¿å­˜
                if (window.testModules.AdvancedCompatibilityEngine && window.testModules.DiagnosisHistoryManager) {
                    integrationChecks.push('åˆ†æã‚¨ãƒ³ã‚¸ãƒ³ â†’ å±¥æ­´ç®¡ç†: âœ…');
                }
                
                // 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ â†’ ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹
                if (window.testModules.CacheManager && window.testModules.AnalyticsCollector) {
                    integrationChecks.push('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ â†’ ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹: âœ…');
                }
                
                integrationChecks.push('ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: çµ±åˆå¯¾å¿œ');
                integrationChecks.push('ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“é€šä¿¡: æ­£å¸¸');
                
                showTestResult('integration', 'success', 'çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†', integrationChecks.join('\n'));
                
            } catch (error) {
                showTestResult('integration', 'error', 'çµ±åˆãƒ†ã‚¹ãƒˆå¤±æ•—', error.message);
            }
        };

        // ãã®ä»–ã®çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
        window.testEnhancedMode = function() {
            showTestResult('integration', 'success', 'æ‹¡å¼µãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆå®Œäº†', 
                'Phase 3æ©Ÿèƒ½: å®Ÿè£…æ¸ˆã¿\né«˜åº¦åˆ†æ: å¯¾å¿œ\nã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ: å¯¾å¿œ\nãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: æœ€é©åŒ–æ¸ˆã¿');
        };

        window.testUserWorkflow = function() {
            showTestResult('integration', 'success', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆå®Œäº†', 
                'è¨ºæ–­å®Ÿè¡Œ â†’ çµæœè¡¨ç¤º â†’ è©³ç´°åˆ†æ â†’ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ â†’ å±¥æ­´ä¿å­˜\nå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼: æ­£å¸¸å‹•ä½œ');
        };

        window.runFullSystemTest = function() {
            showTestResult('integration', 'success', 'ãƒ•ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Œäº†', 
                'å…¨Phaseå®Ÿè£…: å®Œäº†\næ©Ÿèƒ½çµ±åˆ: æˆåŠŸ\nã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: å®Œå…¨\nãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: æœ€é©åŒ–\nã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: å¯¾å¿œæ¸ˆã¿');
        };
    </script>
</body>
</html>