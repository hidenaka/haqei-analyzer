<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaQei Analyzer - å®Ÿè£…ãƒ†ã‚¹ãƒˆ</title>
    
    <!-- Chart.js for ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- BaseComponent (å¿…è¦ã«å¿œã˜ã¦) -->
    <script>
        class BaseComponent {
            constructor(containerId, options = {}) {
                this.containerId = containerId;
                this.container = typeof containerId === 'string' ? 
                    document.getElementById(containerId) : containerId;
                this.options = { ...this.defaultOptions, ...options };
            }
            
            get defaultOptions() {
                return {};
            }
            
            show() {
                if (this.container) {
                    this.container.style.display = 'block';
                }
            }
            
            hide() {
                if (this.container) {
                    this.container.style.display = 'none';
                }
            }
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«é…ç½®
        window.BaseComponent = BaseComponent;
    </script>
    
    <!-- Enhanced Results CSS -->
    <link rel="stylesheet" href="css/enhanced-results.css">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .test-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .test-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        #results-container {
            margin-top: 30px;
            min-height: 400px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-loading {
            background: #ffc107;
            animation: pulse 1s infinite;
        }
        
        .status-success {
            background: #28a745;
        }
        
        .status-error {
            background: #dc3545;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ§ª HaQei Analyzer Phase 3 å®Ÿè£…ãƒ†ã‚¹ãƒˆ</h1>
            <p>ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€å„æ©Ÿèƒ½ã®å‹•ä½œã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>
        </div>

        <!-- ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="init-status" class="status-indicator status-loading"></span>1. ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</h3>
            <p>å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testSystemInitialization()">ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testModuleImports()">ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testDependencies()">ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯</button>
            </div>
            <div id="init-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="data-status" class="status-indicator status-loading"></span>2. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ</h3>
            <p>è¨ºæ–­çµæœã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="generateTestData()">ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ</button>
                <button class="test-btn" onclick="generateMultipleTestData()">è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ</button>
                <button class="test-btn" onclick="validateTestData()">ãƒ‡ãƒ¼ã‚¿æ§‹é€ æ¤œè¨¼</button>
            </div>
            <div id="data-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- é«˜åº¦ç›¸æ€§åˆ†æãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="compatibility-status" class="status-indicator status-loading"></span>3. é«˜åº¦ç›¸æ€§åˆ†æãƒ†ã‚¹ãƒˆ</h3>
            <p>AdvancedCompatibilityEngine ã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testAdvancedCompatibility()">ç›¸æ€§åˆ†æå®Ÿè¡Œ</button>
                <button class="test-btn" onclick="testSpecialPatterns()">ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º</button>
                <button class="test-btn" onclick="testHistoricalMatches()">æ­´å²äººç‰©ãƒãƒƒãƒãƒ³ã‚°</button>
                <button class="test-btn" onclick="testContextEvaluation()">ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè©•ä¾¡</button>
            </div>
            <div id="compatibility-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="export-status" class="status-indicator status-loading"></span>4. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
            <p>PDFãƒ»ç”»åƒå‡ºåŠ›æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testPDFExport()">PDFå‡ºåŠ›ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testImageExport()">ç”»åƒå‡ºåŠ›ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testSNSFormats()">SNSå½¢å¼ç”Ÿæˆ</button>
                <button class="test-btn" onclick="testExportErrors()">ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</button>
            </div>
            <div id="export-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- å±¥æ­´ç®¡ç†ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="history-status" class="status-indicator status-loading"></span>5. å±¥æ­´ç®¡ç†ãƒ†ã‚¹ãƒˆ</h3>
            <p>DiagnosisHistoryManager ã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testHistorySave()">å±¥æ­´ä¿å­˜ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testHistoryRetrieval()">å±¥æ­´å–å¾—ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testComparison()">çµæœæ¯”è¼ƒãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testTrendAnalysis()">ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ</button>
                <button class="test-btn" onclick="testHistoryExport()">å±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>
            <div id="history-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="performance-status" class="status-indicator status-loading"></span>6. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
            <p>LazyLoadingã¨CacheManagerã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testLazyLoading()">é…å»¶èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testCacheManager()">ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testPerformanceMetrics()">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š</button>
                <button class="test-btn" onclick="stressTest()">è² è·ãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div id="performance-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="analytics-status" class="status-indicator status-loading"></span>7. ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
            <p>AnalyticsCollector ã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="testAnalyticsCollection()">ã‚¤ãƒ™ãƒ³ãƒˆåé›†ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testUserBehaviorTracking()">è¡Œå‹•è¿½è·¡ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testAnalyticsReport()">åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
                <button class="test-btn" onclick="testPrivacyFeatures()">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ©Ÿèƒ½</button>
            </div>
            <div id="analytics-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- çµ±åˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h3><span id="integration-status" class="status-indicator status-loading"></span>8. çµ±åˆãƒ†ã‚¹ãƒˆ</h3>
            <p>å…¨æ©Ÿèƒ½ã‚’çµ±åˆã—ãŸå®Ÿéš›ã®è¨ºæ–­çµæœè¡¨ç¤ºã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
            <div class="test-buttons">
                <button class="test-btn" onclick="runIntegrationTest()">çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <button class="test-btn" onclick="testEnhancedMode()">æ‹¡å¼µãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ</button>
                <button class="test-btn" onclick="testUserWorkflow()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</button>
                <button class="test-btn" onclick="runFullSystemTest()">ãƒ•ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div id="integration-result" class="test-result info" style="display: none;"></div>
        </div>

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="results-container"></div>
    </div>

    <script type="module">
        // ãƒ†ã‚¹ãƒˆç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        window.testResults = {};
        window.testModules = {};
        window.testData = null;

        // ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤ºãƒ˜ãƒ«ãƒ‘ãƒ¼
        function showTestResult(sectionId, status, message, details = '') {
            const statusElement = document.getElementById(`${sectionId}-status`);
            const resultElement = document.getElementById(`${sectionId}-result`);
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼æ›´æ–°
            statusElement.className = `status-indicator status-${status}`;
            
            // çµæœè¡¨ç¤º
            resultElement.style.display = 'block';
            resultElement.className = `test-result ${status}`;
            resultElement.textContent = `${message}\n${details}`;
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«çµæœã«ä¿å­˜
            window.testResults[sectionId] = { status, message, details, timestamp: new Date() };
        }

        // 1. ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
        window.testSystemInitialization = async function() {
            try {
                showTestResult('init', 'loading', 'ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ä¸­...');
                
                // åŸºæœ¬çš„ãªãƒ–ãƒ©ã‚¦ã‚¶APIç¢ºèª
                const checks = {
                    'LocalStorage': typeof Storage !== 'undefined',
                    'IndexedDB': 'indexedDB' in window,
                    'WebWorkers': typeof Worker !== 'undefined',
                    'IntersectionObserver': 'IntersectionObserver' in window,
                    'Fetch API': 'fetch' in window,
                    'ES6 Modules': true
                };
                
                const results = Object.entries(checks).map(([name, result]) => 
                    `${result ? 'âœ…' : 'âŒ'} ${name}: ${result ? 'ã‚µãƒãƒ¼ãƒˆ' : 'éã‚µãƒãƒ¼ãƒˆ'}`
                ).join('\n');
                
                const allSupported = Object.values(checks).every(Boolean);
                
                showTestResult('init', allSupported ? 'success' : 'warning', 
                    allSupported ? 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–æˆåŠŸ' : 'ä¸€éƒ¨æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™', 
                    results);
                    
            } catch (error) {
                showTestResult('init', 'error', 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å¤±æ•—', error.message);
            }
        };

        window.testModuleImports = async function() {
            try {
                showTestResult('init', 'loading', 'ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...');
                
                const modules = [
                    { name: 'AdvancedCompatibilityEngine', path: './js/core/AdvancedCompatibilityEngine.js' },
                    { name: 'PDFExporter', path: './js/core/PDFExporter.js' },
                    { name: 'ImageExporter', path: './js/core/ImageExporter.js' },
                    { name: 'DiagnosisHistoryManager', path: './js/core/DiagnosisHistoryManager.js' },
                    { name: 'LazyLoadingStrategy', path: './js/core/LazyLoadingStrategy.js' },
                    { name: 'CacheManager', path: './js/core/CacheManager.js' },
                    { name: 'AnalyticsCollector', path: './js/core/AnalyticsCollector.js' }
                ];
                
                const results = [];
                
                for (const module of modules) {
                    try {
                        const imported = await import(module.path);
                        window.testModules[module.name] = imported.default;
                        results.push(`âœ… ${module.name}: ã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸ`);
                    } catch (error) {
                        results.push(`âŒ ${module.name}: ${error.message}`);
                    }
                }
                
                const successCount = results.filter(r => r.startsWith('âœ…')).length;
                const status = successCount === modules.length ? 'success' : 
                             successCount > 0 ? 'warning' : 'error';
                
                showTestResult('init', status, 
                    `ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº† (${successCount}/${modules.length})`, 
                    results.join('\n'));
                    
            } catch (error) {
                showTestResult('init', 'error', 'ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¤±æ•—', error.message);
            }
        };

        window.testDependencies = async function() {
            try {
                showTestResult('init', 'loading', 'ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...');
                
                const dependencies = {
                    'Chart.js': typeof Chart !== 'undefined',
                    'BaseComponent': typeof BaseComponent !== 'undefined'
                };
                
                const results = Object.entries(dependencies).map(([name, available]) => 
                    `${available ? 'âœ…' : 'âŒ'} ${name}: ${available ? 'åˆ©ç”¨å¯èƒ½' : 'æœªèª­ã¿è¾¼ã¿'}`
                ).join('\n');
                
                const allAvailable = Object.values(dependencies).every(Boolean);
                
                showTestResult('init', allAvailable ? 'success' : 'error', 
                    allAvailable ? 'ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯å®Œäº†' : 'å¿…è¦ãªä¾å­˜é–¢ä¿‚ãŒä¸è¶³ã—ã¦ã„ã¾ã™', 
                    results);
                    
            } catch (error) {
                showTestResult('init', 'error', 'ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯å¤±æ•—', error.message);
            }
        };

        // 2. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        window.generateTestData = function() {
            try {
                showTestResult('data', 'loading', 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆä¸­...');
                
                window.testData = {
                    engineOS: {
                        hexagramId: 1,
                        hexagramInfo: {
                            name: 'ä¹¾ç‚ºå¤©',
                            reading: 'ã‘ã‚“ã„ã¦ã‚“',
                            catchphrase: 'å‰µé€ çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æº',
                            description: 'å¤©ã®é¾ã®ã‚ˆã†ãªå‰µé€ çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã«æº€ã¡ãŸå­˜åœ¨ã§ã™ã€‚',
                            upper_trigram_id: 1,
                            lower_trigram_id: 1
                        },
                        userVector: {
                            dimension_1: 0.8,
                            dimension_2: 0.6,
                            dimension_3: 0.7,
                            dimension_4: 0.9,
                            dimension_5: 0.5,
                            dimension_6: 0.8,
                            dimension_7: 0.7,
                            dimension_8: 0.6
                        },
                        strength: 0.85
                    },
                    interfaceOS: {
                        hexagramId: 49,
                        hexagramInfo: {
                            name: 'ç«é¢¨é¼',
                            reading: 'ã‹ãµã†ã¦ã„',
                            catchphrase: 'é©æ–°ã®å¾Œã®å®‰å®šåŒ–',
                            description: 'æ–°ãŸãªæ–‡åŒ–ã‚„ç§©åºã‚’å®‰å®šã•ã›ã‚‹å­˜åœ¨ã§ã™ã€‚',
                            upper_trigram_id: 3,
                            lower_trigram_id: 5
                        },
                        matchScore: 78
                    },
                    safeModeOS: {
                        hexagramId: 33,
                        hexagramInfo: {
                            name: 'åœ°é›·å¾©',
                            reading: 'ã¡ã‚‰ã„ãµã',
                            catchphrase: 'å†…çœçš„ãªè¦³å¯ŸåŠ›',
                            description: 'æ·±ã„æ´å¯ŸåŠ›ã§æœ¬è³ªã‚’è¦‹æŠœãé˜²å¾¡æ©Ÿåˆ¶ã§ã™ã€‚',
                            upper_trigram_id: 7,
                            lower_trigram_id: 4
                        },
                        matchScore: 82
                    },
                    consistencyScore: {
                        overall: 0.75,
                        engineInterface: 0.70,
                        engineSafeMode: 0.80,
                        interfaceSafeMode: 0.75
                    },
                    integration: {
                        summary: 'å‰µé€ çš„ã§ã‚ã‚ŠãªãŒã‚‰å®‰å®šã—ãŸäººæ ¼æ§‹é€ ã‚’æŒã£ã¦ã„ã¾ã™ã€‚',
                        recommendations: [
                            'å‰µé€ çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å»ºè¨­çš„ã«æ´»ç”¨ã™ã‚‹',
                            'å†…é¢ã®å®‰å®šæ„Ÿã‚’å¤§åˆ‡ã«ã™ã‚‹',
                            'ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸè‡ªå·±è¡¨ç¾ã‚’å¿ƒãŒã‘ã‚‹'
                        ]
                    }
                };
                
                showTestResult('data', 'success', 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†', 
                    `ã‚¨ãƒ³ã‚¸ãƒ³OS: ${window.testData.engineOS.hexagramInfo.name}\n` +
                    `ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹OS: ${window.testData.interfaceOS.hexagramInfo.name}\n` +
                    `ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰OS: ${window.testData.safeModeOS.hexagramInfo.name}\n` +
                    `ä¸€è²«æ€§ã‚¹ã‚³ã‚¢: ${Math.round(window.testData.consistencyScore.overall * 100)}%`);
                    
            } catch (error) {
                showTestResult('data', 'error', 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå¤±æ•—', error.message);
            }
        };

        window.generateMultipleTestData = function() {
            try {
                showTestResult('data', 'loading', 'è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆä¸­...');
                
                const patterns = [];
                for (let i = 0; i < 5; i++) {
                    patterns.push({
                        id: i + 1,
                        engineOS: Math.floor(Math.random() * 64) + 1,
                        interfaceOS: Math.floor(Math.random() * 64) + 1,
                        safeModeOS: Math.floor(Math.random() * 64) + 1,
                        consistency: Math.random()
                    });
                }
                
                window.testPatterns = patterns;
                
                const results = patterns.map(p => 
                    `ãƒ‘ã‚¿ãƒ¼ãƒ³${p.id}: E${p.engineOS} I${p.interfaceOS} S${p.safeModeOS} (${Math.round(p.consistency * 100)}%)`
                ).join('\n');
                
                showTestResult('data', 'success', 'è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆå®Œäº†', results);
                
            } catch (error) {
                showTestResult('data', 'error', 'è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆå¤±æ•—', error.message);
            }
        };

        window.validateTestData = function() {
            try {
                showTestResult('data', 'loading', 'ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ¤œè¨¼ä¸­...');
                
                if (!window.testData) {
                    throw new Error('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const required = [
                    'engineOS.hexagramId',
                    'engineOS.hexagramInfo.name',
                    'interfaceOS.hexagramId',
                    'safeModeOS.hexagramId',
                    'consistencyScore.overall'
                ];
                
                const validation = required.map(path => {
                    const value = path.split('.').reduce((obj, key) => obj?.[key], window.testData);
                    return `${value !== undefined ? 'âœ…' : 'âŒ'} ${path}: ${value !== undefined ? 'OK' : 'Missing'}`;
                }).join('\n');
                
                const isValid = required.every(path => {
                    const value = path.split('.').reduce((obj, key) => obj?.[key], window.testData);
                    return value !== undefined;
                });
                
                showTestResult('data', isValid ? 'success' : 'error', 
                    isValid ? 'ãƒ‡ãƒ¼ã‚¿æ§‹é€ æ¤œè¨¼å®Œäº†' : 'ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«å•é¡ŒãŒã‚ã‚Šã¾ã™', 
                    validation);
                    
            } catch (error) {
                showTestResult('data', 'error', 'ãƒ‡ãƒ¼ã‚¿æ§‹é€ æ¤œè¨¼å¤±æ•—', error.message);
            }
        };

        // 3. é«˜åº¦ç›¸æ€§åˆ†æãƒ†ã‚¹ãƒˆ
        window.testAdvancedCompatibility = async function() {
            try {
                showTestResult('compatibility', 'loading', 'é«˜åº¦ç›¸æ€§åˆ†æã‚’å®Ÿè¡Œä¸­...');
                
                if (!window.testModules.AdvancedCompatibilityEngine) {
                    throw new Error('AdvancedCompatibilityEngine ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                // ãƒ¢ãƒƒã‚¯ã®InternalCompatibilityEngineã‚’ä½œæˆ
                const mockEngine = {
                    analyzeTripleOSCompatibility: () => ({
                        engineInterface: { synergy: 0.7, conflict: 0.3, harmony: 0.8, tension: 0.2 },
                        engineSafeMode: { synergy: 0.6, conflict: 0.4, harmony: 0.7, tension: 0.3 },
                        interfaceSafeMode: { synergy: 0.8, conflict: 0.2, harmony: 0.9, tension: 0.1 }
                    })
                };
                
                const engine = new window.testModules.AdvancedCompatibilityEngine(mockEngine);
                
                const result = engine.analyzeInternalTeamComposition(1, 49, 33, {
                    lifeStage: 'developing',
                    goals: ['personal_growth'],
                    challenges: ['stress_management']
                });
                
                const summary = `ãƒãƒ¼ãƒ åŠ¹æœæ€§: ${Math.round(result.overallAssessment.teamEffectiveness * 100)}%\n` +
                    `å¼·ã¿ã‚¨ãƒªã‚¢: ${result.overallAssessment.strengthAreas.join(', ')}\n` +
                    `æˆé•·ã‚¨ãƒªã‚¢: ${result.overallAssessment.growthAreas.join(', ')}\n` +
                    `ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³: ${result.specialPattern ? result.specialPattern.name : 'æ¤œå‡ºãªã—'}`;
                
                showTestResult('compatibility', 'success', 'é«˜åº¦ç›¸æ€§åˆ†æå®Œäº†', summary);
                
            } catch (error) {
                showTestResult('compatibility', 'error', 'é«˜åº¦ç›¸æ€§åˆ†æå¤±æ•—', error.message);
            }
        };

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            
            // è‡ªå‹•çš„ã«åŸºæœ¬ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
            setTimeout(() => {
                testSystemInitialization();
            }, 500);
            
            setTimeout(() => {
                testModuleImports();
            }, 1000);
            
            setTimeout(() => {
                generateTestData();
            }, 1500);
        });

        // ãã®ä»–ã®ãƒ†ã‚¹ãƒˆé–¢æ•°ã¯ç¶šãã§å®Ÿè£…ã—ã¾ã™...
        window.testSpecialPatterns = function() {
            showTestResult('compatibility', 'info', 'ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testHistoricalMatches = function() {
            showTestResult('compatibility', 'info', 'æ­´å²äººç‰©ãƒãƒƒãƒãƒ³ã‚°ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testContextEvaluation = function() {
            showTestResult('compatibility', 'info', 'ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè©•ä¾¡ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testPDFExport = function() {
            showTestResult('export', 'info', 'PDFå‡ºåŠ›ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testImageExport = function() {
            showTestResult('export', 'info', 'ç”»åƒå‡ºåŠ›ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testSNSFormats = function() {
            showTestResult('export', 'info', 'SNSå½¢å¼ç”Ÿæˆãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testExportErrors = function() {
            showTestResult('export', 'info', 'ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testHistorySave = function() {
            showTestResult('history', 'info', 'å±¥æ­´ä¿å­˜ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testHistoryRetrieval = function() {
            showTestResult('history', 'info', 'å±¥æ­´å–å¾—ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testComparison = function() {
            showTestResult('history', 'info', 'çµæœæ¯”è¼ƒãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testTrendAnalysis = function() {
            showTestResult('history', 'info', 'ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testHistoryExport = function() {
            showTestResult('history', 'info', 'å±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testLazyLoading = function() {
            showTestResult('performance', 'info', 'é…å»¶èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testCacheManager = function() {
            showTestResult('performance', 'info', 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testPerformanceMetrics = function() {
            showTestResult('performance', 'info', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.stressTest = function() {
            showTestResult('performance', 'info', 'è² è·ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testAnalyticsCollection = function() {
            showTestResult('analytics', 'info', 'ã‚¤ãƒ™ãƒ³ãƒˆåé›†ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testUserBehaviorTracking = function() {
            showTestResult('analytics', 'info', 'è¡Œå‹•è¿½è·¡ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testAnalyticsReport = function() {
            showTestResult('analytics', 'info', 'åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testPrivacyFeatures = function() {
            showTestResult('analytics', 'info', 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.runIntegrationTest = function() {
            showTestResult('integration', 'info', 'çµ±åˆãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testEnhancedMode = function() {
            showTestResult('integration', 'info', 'æ‹¡å¼µãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.testUserWorkflow = function() {
            showTestResult('integration', 'info', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };

        window.runFullSystemTest = function() {
            showTestResult('integration', 'info', 'ãƒ•ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ', 'å®Ÿè£…æº–å‚™ä¸­...');
        };
    </script>
</body>
</html>