<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TripleOS Results Enhancement - å˜ä½“ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .test-pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-summary {
            background: #e9ecef;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
        }
        button:hover {
            background: #0056b3;
        }
        .test-details {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª TripleOS Results Enhancement - å˜ä½“ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-container">
        <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>
        <button id="run-all-tests">ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
        <button id="run-osdetail-tests">OSDetailEngine ãƒ†ã‚¹ãƒˆ</button>
        <button id="run-integration-tests">çµ±åˆã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚¨ãƒ³ã‚¸ãƒ³ ãƒ†ã‚¹ãƒˆ</button>
        <button id="run-error-tests">ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° ãƒ†ã‚¹ãƒˆ</button>
        <button id="run-compatibility-tests">å¤šæ¬¡å…ƒè©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯ ãƒ†ã‚¹ãƒˆ</button>
        <button id="run-advanced-compatibility-tests">å®Œå…¨ç›¸æ€§åˆ†æã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆ</button>
    </div>

    <div id="test-results"></div>
    
    <div id="test-summary" class="test-summary" style="display: none;">
        <h3>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h3>
        <div id="summary-content"></div>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ -->
    <script src="../js/core/BaseComponent.js"></script>
    <script src="../js/core/DataManager.js"></script>
    <script src="../js/core/Calculator.js"></script>
    <script src="../js/core/Engine.js"></script>
    <script src="../js/core/TripleOSEngine.js"></script>
    <script src="../js/core/EightDimensionAnalysisEngine.js"></script>
    <script src="../js/core/OSDetailEngine.js"></script>
    <script src="../js/core/InternalCompatibilityEngine.js"></script>
    <script src="../js/core/ErrorHandler.js"></script>
    <script src="../js/core/IntegrationAdviceEngine.js"></script>
    <script src="../js/core/StorageManager.js"></script>
    <script src="../js/core/CompatibilityDataLoader.js"></script>

    <!-- ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="../js/data/data_box.js"></script>
    <script src="../js/data/questions.js"></script>
    <script src="../js/data/vectors.js"></script>
    <script src="../js/data/hexagrams.js"></script>
    <script src="../js/data/hexagram_details.js"></script>
    <script src="../js/data/compatibility_definition.js"></script>

    <script>
        class UnitTestRunner {
            constructor() {
                this.testResults = [];
                this.setupTestEnvironment();
                this.bindEvents();
            }

            setupTestEnvironment() {
                console.log('ğŸ”§ å˜ä½“ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’åˆæœŸåŒ–ä¸­...');
                this.resultsContainer = document.getElementById('test-results');
                this.summaryContainer = document.getElementById('test-summary');
                this.summaryContent = document.getElementById('summary-content');
            }

            bindEvents() {
                document.getElementById('run-all-tests').addEventListener('click', () => {
                    this.runAllTests();
                });
                
                document.getElementById('run-osdetail-tests').addEventListener('click', () => {
                    this.runOSDetailEngineTests();
                });
                
                document.getElementById('run-integration-tests').addEventListener('click', () => {
                    this.runIntegrationAdviceTests();
                });
                
                document.getElementById('run-error-tests').addEventListener('click', () => {
                    this.runErrorHandlingTests();
                });
                
                document.getElementById('run-compatibility-tests').addEventListener('click', () => {
                    this.runCompatibilityTests();
                });
                
                document.getElementById('run-advanced-compatibility-tests').addEventListener('click', () => {
                    this.runAdvancedCompatibilityTests();
                });
            }

            async runAllTests() {
                this.clearResults();
                this.addTestSection('ğŸ§ª å…¨å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹');
                
                await this.runOSDetailEngineTests();
                await this.runIntegrationAdviceTests();
                await this.runErrorHandlingTests();
                await this.runCompatibilityTests();
                await this.runAdvancedCompatibilityTests();
                
                this.showSummary();
            }

            async runOSDetailEngineTests() {
                this.addTestSection('ğŸ”§ OSDetailEngine ãƒ†ã‚¹ãƒˆ');
                
                // ãƒ†ã‚¹ãƒˆ1: OSDetailEngineåˆæœŸåŒ–
                this.runTest('OSDetailEngineåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ', () => {
                    if (typeof OSDetailEngine === 'undefined') {
                        throw new Error('OSDetailEngine ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }
                    
                    const dataManager = new DataManager();
                    const osDetailEngine = new OSDetailEngine(dataManager);
                    
                    if (!osDetailEngine) {
                        throw new Error('OSDetailEngine ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    return 'OSDetailEngine ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ';
                });

                // ãƒ†ã‚¹ãƒˆ2: 64å¦è©³ç´°ãƒ‡ãƒ¼ã‚¿å–å¾—
                this.runTest('64å¦è©³ç´°ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ', () => {
                    const dataManager = new DataManager();
                    const osDetailEngine = new OSDetailEngine(dataManager);
                    
                    const hexagramId = 1; // ä¹¾ç‚ºå¤©
                    const details = osDetailEngine.getHexagramDetails(hexagramId);
                    
                    if (!details || !details.name) {
                        throw new Error('64å¦è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    if (!details.description || !details.keywords) {
                        throw new Error('å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä¸è¶³ã—ã¦ã„ã¾ã™');
                    }
                    
                    return `64å¦è©³ç´°ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ: ${details.name}`;
                });

                // ãƒ†ã‚¹ãƒˆ3: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ©Ÿèƒ½
                this.runTest('è¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ', () => {
                    const dataManager = new DataManager();
                    const osDetailEngine = new OSDetailEngine(dataManager);
                    
                    const mockData = {
                        name: 'ä¹¾ç‚ºå¤©',
                        description: 'ãƒ†ã‚¹ãƒˆèª¬æ˜',
                        keywords: ['å‰µé€ ', 'ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—']
                    };
                    
                    const formatted = osDetailEngine.formatForDisplay(mockData);
                    
                    if (!formatted || typeof formatted !== 'object') {
                        throw new Error('ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã›ã‚“');
                    }
                    
                    return 'ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™';
                });
            }

            async runIntegrationAdviceTests() {
                this.addTestSection('ğŸ¯ çµ±åˆã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚¨ãƒ³ã‚¸ãƒ³ ãƒ†ã‚¹ãƒˆ');
                
                // ãƒ†ã‚¹ãƒˆ1: IntegrationAdviceEngineåˆæœŸåŒ–
                this.runTest('çµ±åˆã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ', () => {
                    if (typeof IntegrationAdviceEngine === 'undefined') {
                        throw new Error('IntegrationAdviceEngine ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }
                    
                    const adviceEngine = new IntegrationAdviceEngine();
                    
                    if (!adviceEngine) {
                        throw new Error('IntegrationAdviceEngine ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    return 'IntegrationAdviceEngine ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ';
                });

                // ãƒ†ã‚¹ãƒˆ2: çµ±åˆæ‰‹æ³•ç”Ÿæˆ
                this.runTest('çµ±åˆæ‰‹æ³•ç”Ÿæˆãƒ†ã‚¹ãƒˆ', () => {
                    const adviceEngine = new IntegrationAdviceEngine();
                    
                    const mockTripleOS = {
                        engineOS: { hexagramId: 1, name: 'ä¹¾ç‚ºå¤©' },
                        interfaceOS: { hexagramId: 2, name: 'å¤ç‚ºåœ°' },
                        safeModeOS: { hexagramId: 3, name: 'æ°´é›·å±¯' }
                    };
                    
                    const advice = adviceEngine.generateIntegrationAdvice(mockTripleOS);
                    
                    if (!advice || !advice.immediate || !advice.longTerm) {
                        throw new Error('çµ±åˆã‚¢ãƒ‰ãƒã‚¤ã‚¹ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    return `çµ±åˆã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”ŸæˆæˆåŠŸ: ${advice.immediate.length}ä»¶ã®å³åº§ã‚¢ãƒ‰ãƒã‚¤ã‚¹`;
                });

                // ãƒ†ã‚¹ãƒˆ3: æˆé•·ãƒ—ãƒ©ãƒ³ç”Ÿæˆ
                this.runTest('æˆé•·ãƒ—ãƒ©ãƒ³ç”Ÿæˆãƒ†ã‚¹ãƒˆ', () => {
                    const adviceEngine = new IntegrationAdviceEngine();
                    
                    const mockCompatibility = {
                        engineInterface: { synergy: 0.7, tension: 0.3 },
                        engineSafeMode: { harmony: 0.6, conflict: 0.4 },
                        interfaceSafeMode: { synergy: 0.8, chaos: 0.2 }
                    };
                    
                    const growthPlan = adviceEngine.generateGrowthPlan(mockCompatibility);
                    
                    if (!growthPlan || !growthPlan.shortTerm || !growthPlan.longTerm) {
                        throw new Error('æˆé•·ãƒ—ãƒ©ãƒ³ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    return `æˆé•·ãƒ—ãƒ©ãƒ³ç”ŸæˆæˆåŠŸ: çŸ­æœŸ${growthPlan.shortTerm.length}ä»¶ã€é•·æœŸ${growthPlan.longTerm.length}ä»¶`;
                });
            }

            async runErrorHandlingTests() {
                this.addTestSection('âŒ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° ãƒ†ã‚¹ãƒˆ');
                
                // ãƒ†ã‚¹ãƒˆ1: ErrorHandleråˆæœŸåŒ–
                this.runTest('ErrorHandleråˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ', () => {
                    if (typeof ErrorHandler === 'undefined') {
                        throw new Error('ErrorHandler ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }
                    
                    const errorHandler = new ErrorHandler();
                    
                    if (!errorHandler) {
                        throw new Error('ErrorHandler ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    return 'ErrorHandler ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ';
                });

                // ãƒ†ã‚¹ãƒˆ2: ã‚¨ãƒ©ãƒ¼å‡¦ç†æ©Ÿèƒ½
                this.runTest('ã‚¨ãƒ©ãƒ¼å‡¦ç†æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ', () => {
                    const errorHandler = new ErrorHandler();
                    
                    const testError = new Error('ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼');
                    const result = errorHandler.handleError(testError, 'test');
                    
                    if (!result || !result.userMessage) {
                        throw new Error('ã‚¨ãƒ©ãƒ¼å‡¦ç†æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã›ã‚“');
                    }
                    
                    return `ã‚¨ãƒ©ãƒ¼å‡¦ç†æˆåŠŸ: ${result.userMessage}`;
                });

                // ãƒ†ã‚¹ãƒˆ3: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
                this.runTest('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ', () => {
                    const errorHandler = new ErrorHandler();
                    
                    const fallback = errorHandler.getFallbackData('hexagram');
                    
                    if (!fallback || typeof fallback !== 'object') {
                        throw new Error('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã›ã‚“');
                    }
                    
                    return 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™';
                });
            }

            async runCompatibilityTests() {
                this.addTestSection('ğŸ”„ å¤šæ¬¡å…ƒè©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯ ãƒ†ã‚¹ãƒˆ');
                
                // ãƒ†ã‚¹ãƒˆ1: InternalCompatibilityEngineåˆæœŸåŒ–
                this.runTest('InternalCompatibilityEngineåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ', () => {
                    if (typeof InternalCompatibilityEngine === 'undefined') {
                        throw new Error('InternalCompatibilityEngine ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }
                    
                    const dataManager = new DataManager();
                    const compatibilityEngine = new InternalCompatibilityEngine(dataManager);
                    
                    if (!compatibilityEngine) {
                        throw new Error('InternalCompatibilityEngine ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    return 'InternalCompatibilityEngine ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ';
                });

                // ãƒ†ã‚¹ãƒˆ2: ç›¸æ€§åˆ†ææ©Ÿèƒ½
                this.runTest('ç›¸æ€§åˆ†ææ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ', () => {
                    const dataManager = new DataManager();
                    const compatibilityEngine = new InternalCompatibilityEngine(dataManager);
                    
                    const compatibility = compatibilityEngine.analyzeCompatibility(1, 2);
                    
                    if (!compatibility || typeof compatibility.synergy !== 'number') {
                        throw new Error('ç›¸æ€§åˆ†ææ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã›ã‚“');
                    }
                    
                    if (compatibility.synergy < 0 || compatibility.synergy > 1) {
                        throw new Error('ç›¸æ€§ã‚¹ã‚³ã‚¢ãŒé©åˆ‡ãªç¯„å›²ã«ã‚ã‚Šã¾ã›ã‚“');
                    }
                    
                    return `ç›¸æ€§åˆ†ææˆåŠŸ: ã‚·ãƒŠã‚¸ãƒ¼${Math.round(compatibility.synergy * 100)}%`;
                });

                // ãƒ†ã‚¹ãƒˆ3: ãƒˆãƒªãƒ—ãƒ«OSç›¸æ€§åˆ†æ
                this.runTest('ãƒˆãƒªãƒ—ãƒ«OSç›¸æ€§åˆ†æãƒ†ã‚¹ãƒˆ', () => {
                    const dataManager = new DataManager();
                    const compatibilityEngine = new InternalCompatibilityEngine(dataManager);
                    
                    const tripleCompatibility = compatibilityEngine.analyzeTripleOSCompatibility(1, 2, 3);
                    
                    if (!tripleCompatibility || !tripleCompatibility.engineInterface) {
                        throw new Error('ãƒˆãƒªãƒ—ãƒ«OSç›¸æ€§åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    const requiredKeys = ['engineInterface', 'engineSafeMode', 'interfaceSafeMode'];
                    for (const key of requiredKeys) {
                        if (!tripleCompatibility[key]) {
                            throw new Error(`å¿…é ˆã‚­ãƒ¼ ${key} ãŒä¸è¶³ã—ã¦ã„ã¾ã™`);
                        }
                    }
                    
                    return 'ãƒˆãƒªãƒ—ãƒ«OSç›¸æ€§åˆ†æãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™';
                });

                // ãƒ†ã‚¹ãƒˆ4: ç›¸æ€§ã‚¿ã‚¤ãƒ—åˆ†é¡ãƒ†ã‚¹ãƒˆ
                this.runTest('ç›¸æ€§ã‚¿ã‚¤ãƒ—åˆ†é¡ãƒ†ã‚¹ãƒˆ', () => {
                    const dataManager = new DataManager();
                    const compatibilityEngine = new InternalCompatibilityEngine(dataManager);
                    
                    // è¤‡æ•°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ†ã‚¹ãƒˆ
                    const testCases = [
                        { os1: 1, os2: 1, expectedType: 'chaos_or_conflict' },
                        { os1: 1, os2: 2, expectedType: 'synergy_or_harmony' },
                        { os1: 1, os2: 32, expectedType: 'varies' }
                    ];
                    
                    let successCount = 0;
                    for (const testCase of testCases) {
                        const compatibility = compatibilityEngine.analyzeCompatibility(testCase.os1, testCase.os2);
                        if (compatibility && compatibility.type) {
                            successCount++;
                        }
                    }
                    
                    if (successCount < testCases.length) {
                        throw new Error(`ç›¸æ€§ã‚¿ã‚¤ãƒ—åˆ†é¡ã«å¤±æ•—: ${successCount}/${testCases.length}`);
                    }
                    
                    return `ç›¸æ€§ã‚¿ã‚¤ãƒ—åˆ†é¡ãƒ†ã‚¹ãƒˆæˆåŠŸ: ${successCount}/${testCases.length}`;
                });
            }

            async runAdvancedCompatibilityTests() {
                this.addTestSection('ğŸ¯ å®Œå…¨ç›¸æ€§åˆ†æã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆ');
                
                // ãƒ†ã‚¹ãƒˆ1: CompatibilityDataLoaderåˆæœŸåŒ–
                this.runTest('CompatibilityDataLoaderåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ', () => {
                    if (typeof CompatibilityDataLoader === 'undefined') {
                        throw new Error('CompatibilityDataLoader ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }
                    
                    const loader = new CompatibilityDataLoader();
                    
                    if (!loader) {
                        throw new Error('CompatibilityDataLoader ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    if (!loader.options || !loader.cache) {
                        throw new Error('å¿…è¦ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä¸è¶³ã—ã¦ã„ã¾ã™');
                    }
                    
                    return 'CompatibilityDataLoader ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ';
                });

                // ãƒ†ã‚¹ãƒˆ2: ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¹è¨­å®šç¢ºèª
                this.runTest('ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¹è¨­å®šç¢ºèªãƒ†ã‚¹ãƒˆ', () => {
                    const loader = new CompatibilityDataLoader();
                    
                    const expectedBasePath = '../../js/data/compatibility/';
                    if (loader.options.basePath !== expectedBasePath) {
                        throw new Error(`ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¹ãŒé–“é•ã£ã¦ã„ã¾ã™: ${loader.options.basePath}`);
                    }
                    
                    return `ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¹è¨­å®šæ­£å¸¸: ${loader.options.basePath}`;
                });

                // ãƒ†ã‚¹ãƒˆ3: Engine-Interfaceäº’æ›æ€§ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ†ã‚¹ãƒˆï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
                this.runTest('Engine-Interfaceäº’æ›æ€§ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ†ã‚¹ãƒˆ', () => {
                    const loader = new CompatibilityDataLoader();
                    
                    // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§ãƒ†ã‚¹ãƒˆ
                    const mockData = {
                        hexagram_id: 1,
                        internal_team_analysis: {
                            engine_os_name: "ä¹¾ç‚ºå¤©",
                            interface_combinations: [{
                                interface_id: 2,
                                interface_name: "å¤ç‚ºåœ°",
                                type: "SYNERGY",
                                overall_score: 0.85,
                                summary: "ãƒ†ã‚¹ãƒˆã‚µãƒãƒªãƒ¼",
                                evaluation: {},
                                advice: {}
                            }]
                        }
                    };
                    
                    // ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
                    const isValid = loader.validateCompatibilityData(mockData, 'test-file.json');
                    
                    if (!isValid) {
                        throw new Error('ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    return 'Engine-Interfaceäº’æ›æ€§ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒæ­£ã—ãæ¤œè¨¼ã•ã‚Œã¾ã—ãŸ';
                });

                // ãƒ†ã‚¹ãƒˆ4: ç›¸æ€§ã‚¿ã‚¤ãƒ—åˆ¤å®šãƒ†ã‚¹ãƒˆ
                this.runTest('ç›¸æ€§ã‚¿ã‚¤ãƒ—åˆ¤å®šãƒ†ã‚¹ãƒˆ', () => {
                    const loader = new CompatibilityDataLoader();
                    
                    const testCases = [
                        { score: 0.95, expectedType: 'SYNERGY' },
                        { score: 0.75, expectedType: 'HARMONY' },
                        { score: 0.5, expectedType: 'TENSION' },
                        { score: 0.3, expectedType: 'CONFLICT' },
                        { score: 0.1, expectedType: 'CHAOS' }
                    ];
                    
                    let passedCases = 0;
                    for (const testCase of testCases) {
                        const type = loader.determineCompatibilityType(testCase.score);
                        if (type === testCase.expectedType) {
                            passedCases++;
                        }
                    }
                    
                    if (passedCases !== testCases.length) {
                        throw new Error(`ç›¸æ€§ã‚¿ã‚¤ãƒ—åˆ¤å®šå¤±æ•—: ${passedCases}/${testCases.length}`);
                    }
                    
                    return `ç›¸æ€§ã‚¿ã‚¤ãƒ—åˆ¤å®šãƒ†ã‚¹ãƒˆæˆåŠŸ: ${passedCases}/${testCases.length}`;
                });

                // ãƒ†ã‚¹ãƒˆ5: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
                this.runTest('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ', () => {
                    const loader = new CompatibilityDataLoader();
                    
                    const testError = new Error('ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼');
                    const fallbackData = loader.generateFallbackCompatibility('engine-interface', 1, 2, testError);
                    
                    if (!fallbackData || !fallbackData.type || !fallbackData.overallScore) {
                        throw new Error('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
                    }
                    
                    if (fallbackData.overallScore < 0 || fallbackData.overallScore > 1) {
                        throw new Error('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¹ã‚³ã‚¢ãŒé©åˆ‡ãªç¯„å›²ã«ã‚ã‚Šã¾ã›ã‚“');
                    }
                    
                    return `ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½æ­£å¸¸: ${fallbackData.type} (${Math.round(fallbackData.overallScore * 100)}%)`;
                });

                // ãƒ†ã‚¹ãƒˆ6: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
                this.runTest('ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ', () => {
                    const loader = new CompatibilityDataLoader();
                    
                    const testKey = 'test-cache-key';
                    const testData = { test: 'data', timestamp: Date.now() };
                    
                    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
                    loader.cache.set(testKey, { data: testData, timestamp: Date.now() });
                    
                    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
                    const cached = loader.cache.get(testKey);
                    
                    if (!cached || !cached.data || cached.data.test !== 'data') {
                        throw new Error('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä¿å­˜ãƒ»å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
                    loader.clearCache();
                    
                    if (loader.cache.size !== 0) {
                        throw new Error('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    return 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™';
                });

                // ãƒ†ã‚¹ãƒˆ7: çµ±è¨ˆæƒ…å ±å–å¾—ãƒ†ã‚¹ãƒˆ
                this.runTest('çµ±è¨ˆæƒ…å ±å–å¾—ãƒ†ã‚¹ãƒˆ', () => {
                    const loader = new CompatibilityDataLoader();
                    
                    const stats = loader.getStats();
                    
                    if (!stats || typeof stats.cacheSize !== 'number') {
                        throw new Error('çµ±è¨ˆæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                    
                    const requiredProps = ['cacheSize', 'loadedFiles', 'validationCacheSize', 'loadingInProgress'];
                    for (const prop of requiredProps) {
                        if (!(prop in stats)) {
                            throw new Error(`çµ±è¨ˆæƒ…å ±ã«å¿…é ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ ${prop} ãŒã‚ã‚Šã¾ã›ã‚“`);
                        }
                    }
                    
                    return `çµ±è¨ˆæƒ…å ±å–å¾—æˆåŠŸ: ã‚­ãƒ£ãƒƒã‚·ãƒ¥${stats.cacheSize}ä»¶ã€èª­ã¿è¾¼ã¿æ¸ˆã¿${stats.loadedFiles}ä»¶`;
                });

                // ãƒ†ã‚¹ãƒˆ8: Triple OSçµ±åˆåˆ†æãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
                this.runTest('Triple OSçµ±åˆåˆ†æãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ', () => {
                    const loader = new CompatibilityDataLoader();
                    
                    const mockCompatibilities = [
                        { type: 'SYNERGY', overallScore: 0.8, metadata: { dataSource: 'engine-interface' } },
                        { type: 'HARMONY', overallScore: 0.7, metadata: { dataSource: 'engine-safemode' } },
                        { type: 'TENSION', overallScore: 0.6, metadata: { dataSource: 'interface-safemode' } }
                    ];
                    
                    const integration = loader.analyzeTripleOSIntegration(...mockCompatibilities);
                    
                    if (!integration || typeof integration.overallScore !== 'number') {
                        throw new Error('çµ±åˆåˆ†æçµæœãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                    }
                    
                    const requiredProps = ['overallScore', 'stability', 'balance', 'dominantPattern'];
                    for (const prop of requiredProps) {
                        if (!(prop in integration)) {
                            throw new Error(`çµ±åˆåˆ†æã«å¿…é ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ ${prop} ãŒã‚ã‚Šã¾ã›ã‚“`);
                        }
                    }
                    
                    return `Triple OSçµ±åˆåˆ†ææˆåŠŸ: ç·åˆã‚¹ã‚³ã‚¢${Math.round(integration.overallScore * 100)}%`;
                });
            }

            runTest(testName, testFunction) {
                try {
                    const result = testFunction();
                    this.addTestResult(testName, true, result);
                    this.testResults.push({ name: testName, passed: true, message: result });
                } catch (error) {
                    this.addTestResult(testName, false, error.message);
                    this.testResults.push({ name: testName, passed: false, message: error.message });
                }
            }

            addTestSection(sectionName) {
                const section = document.createElement('div');
                section.className = 'test-container';
                section.innerHTML = `<h3>${sectionName}</h3>`;
                this.resultsContainer.appendChild(section);
            }

            addTestResult(testName, passed, message) {
                const result = document.createElement('div');
                result.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
                result.innerHTML = `
                    <strong>${passed ? 'âœ…' : 'âŒ'} ${testName}</strong>
                    <div class="test-details">${message}</div>
                `;
                this.resultsContainer.appendChild(result);
            }

            clearResults() {
                this.resultsContainer.innerHTML = '';
                this.testResults = [];
                this.summaryContainer.style.display = 'none';
            }

            showSummary() {
                const totalTests = this.testResults.length;
                const passedTests = this.testResults.filter(test => test.passed).length;
                const failedTests = totalTests - passedTests;
                const successRate = Math.round((passedTests / totalTests) * 100);

                this.summaryContent.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><strong>ç·ãƒ†ã‚¹ãƒˆæ•°:</strong> ${totalTests}</div>
                        <div style="color: #28a745;"><strong>æˆåŠŸ:</strong> ${passedTests}</div>
                        <div style="color: #dc3545;"><strong>å¤±æ•—:</strong> ${failedTests}</div>
                        <div><strong>æˆåŠŸç‡:</strong> ${successRate}%</div>
                    </div>
                    <div style="margin-top: 15px;">
                        <strong>çµæœ:</strong> 
                        ${successRate >= 90 ? 'ğŸ‰ å„ªç§€' : successRate >= 70 ? 'âœ… è‰¯å¥½' : 'âš ï¸ æ”¹å–„ãŒå¿…è¦'}
                    </div>
                `;
                
                this.summaryContainer.style.display = 'block';
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            new UnitTestRunner();
        });
    </script>
</body>
</html>