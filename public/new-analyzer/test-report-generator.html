<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HaQei Analyzer - ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f8f9fa;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
      }
      .test-section {
        margin: 20px 0;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #007bff;
        background: #f8f9fa;
      }
      .status-good {
        color: #28a745;
        font-weight: bold;
      }
      .status-warning {
        color: #ffc107;
        font-weight: bold;
      }
      .status-error {
        color: #dc3545;
        font-weight: bold;
      }
      .report-content {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin: 10px 0;
      }
      button {
        padding: 12px 24px;
        margin: 10px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }
      .btn-primary {
        background: #007bff;
        color: white;
      }
      .btn-success {
        background: #28a745;
        color: white;
      }
      .btn-secondary {
        background: #6c757d;
        color: white;
      }
      pre {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
        font-size: 12px;
      }
      .timestamp {
        color: #6c757d;
        font-size: 12px;
      }
      .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .summary-card {
        background: #e9ecef;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }
      .summary-number {
        font-size: 24px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ“‹ HaQei Analyzer - ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</h1>
        <p class="timestamp">ç”Ÿæˆæ—¥æ™‚: <span id="timestamp"></span></p>
      </div>

      <div class="test-section">
        <h2>ğŸ¯ ãƒ†ã‚¹ãƒˆåˆ¶å¾¡</h2>
        <button class="btn-primary" onclick="runAllTests()">
          ğŸš€ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        </button>
        <button class="btn-success" onclick="generateReport()">
          ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        </button>
        <button class="btn-secondary" onclick="downloadReport()">
          ğŸ’¾ ãƒ¬ãƒãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        </button>
        <button class="btn-secondary" onclick="clearResults()">
          ğŸ—‘ï¸ çµæœã‚¯ãƒªã‚¢
        </button>
      </div>

      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-number" id="total-tests">0</div>
          <div>ç·ãƒ†ã‚¹ãƒˆæ•°</div>
        </div>
        <div class="summary-card">
          <div class="summary-number status-good" id="passed-tests">0</div>
          <div>æˆåŠŸ</div>
        </div>
        <div class="summary-card">
          <div class="summary-number status-error" id="failed-tests">0</div>
          <div>å¤±æ•—</div>
        </div>
        <div class="summary-card">
          <div class="summary-number" id="test-duration">0ms</div>
          <div>å®Ÿè¡Œæ™‚é–“</div>
        </div>
      </div>

      <div id="test-results"></div>
      <div id="generated-report" style="display: none"></div>
    </div>

    <!-- åŒã˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿é †åº -->
    <script src="js/utils/validators.js"></script>
    <script src="js/utils/animations.js"></script>
    <script src="../js/data/data_box.js"></script>
    <script src="../js/data/questions.js"></script>
    <script src="../js/data/vectors.js"></script>
    <script src="../js/data/hexagrams.js"></script>
    <script src="../js/data/hexagram_details.js"></script>
    <script src="../js/data/compatibility_definition.js"></script>
    <script src="../js/data/compatibility_matrix.js"></script>
    <script src="../js/data/action_plans.js"></script>
    <script src="js/core/BaseComponent.js"></script>
    <script src="js/core/DataManager.js"></script>
    <script src="js/core/Calculator.js"></script>
    <script src="js/core/StorageManager.js"></script>
    <script src="js/core/Engine.js"></script>
    <script src="js/core/TripleOSEngine.js"></script>
    <script src="js/core/EightDimensionAnalysisEngine.js"></script>
    <script src="js/core/RelationshipVisualizationEngine.js"></script>
    <script src="js/core/CompatibilityDataLoader.js"></script>
    <script src="js/components/WelcomeScreen.js"></script>

    <!-- WelcomeScreenèª­ã¿è¾¼ã¿ç¢ºèªç”¨ãƒ‡ãƒãƒƒã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
      // WelcomeScreenèª­ã¿è¾¼ã¿ç¢ºèª
      document.addEventListener("DOMContentLoaded", function () {
        console.log("ğŸ” [Debug] BaseComponent:", typeof BaseComponent);
        console.log("ğŸ” [Debug] WelcomeScreen:", typeof WelcomeScreen);

        if (typeof BaseComponent === "undefined") {
          console.error("âŒ BaseComponent ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“");
        }

        if (typeof WelcomeScreen === "undefined") {
          console.error("âŒ WelcomeScreen ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“");

          // æ‰‹å‹•ã§WelcomeScreenã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ï¼ˆç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
          if (typeof BaseComponent !== "undefined") {
            console.warn("âš ï¸ WelcomeScreenç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œ");
            window.WelcomeScreen = class WelcomeScreen extends BaseComponent {
              get defaultOptions() {
                return {
                  ...super.defaultOptions,
                  onStart: null,
                };
              }

              render() {
                this.container.innerHTML = `
                                <div class="welcome-content">
                                    <h1>ğŸ¯ HaQei Analyzer</h1>
                                    <p>ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‰ˆã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢</p>
                                    <button id="start-analysis-btn">æ·±ã„æ´å¯Ÿã‚’å§‹ã‚ã‚‹</button>
                                </div>
                            `;
              }

              bindEvents() {
                const startBtn = this.container.querySelector(
                  "#start-analysis-btn"
                );
                if (startBtn) {
                  startBtn.addEventListener("click", () => {
                    if (this.options.onStart) {
                      this.options.onStart();
                    }
                  });
                }
              }
            };
            console.log("âœ… WelcomeScreenç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œäº†");
          }
        } else {
          console.log("âœ… WelcomeScreen ãŒæ­£å¸¸ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™");
        }
      });
    </script>
    <script src="js/components/QuestionFlow.js"></script>
    <script src="js/components/AnalysisView.js"></script>
    <script src="js/components/ResultsView.js"></script>
    <script src="js/components/TripleOSResultsView.js"></script>
    <script src="js/components/InsightPanel.js"></script>

    <!-- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’è¿½åŠ  -->
    <script>
      // ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½œæˆé–¢æ•°
      function createFallbackHaqeiData() {
        console.warn("âš ï¸ [Fallback] ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆä¸­...");

        return {
          hexagrams: {},
          hexagrams_master: [
            {
              hexagram_id: 1,
              name_jp: "ä¹¾ç‚ºå¤©",
              reading: "ã‘ã‚“ã„ã¦ã‚“",
              catchphrase: "å¤©ç¿”ã‘ã‚‹é¾ã®ã‚ˆã†ãªã€å¤©æ€§ã®ãƒªãƒ¼ãƒ€ãƒ¼",
              upper_trigram_id: 1,
              lower_trigram_id: 1,
              description: "ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ - åŸºæœ¬çš„ãªå¦æƒ…å ±",
              keywords: "å‰µé€ ,ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—,åŠ›",
            },
          ],
          os_manual: {},
          trigrams_master: [],
          element_relationships: [],
          action_plans: {},
          sho_den: {},
          tai_sho_den: {},
          jo_ka_den: {},
          zatsu_ka_den: {},
          tuan_den: {},
        };
      }

      // ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è³ªå•ãƒ‡ãƒ¼ã‚¿ä½œæˆé–¢æ•°
      function createFallbackQuestions() {
        console.warn("âš ï¸ [Fallback] ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è³ªå•ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆä¸­...");

        return [
          {
            id: "q1",
            text: "ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è³ªå•: ã‚ãªãŸã®åŸºæœ¬çš„ãªä¾¡å€¤è¦³ã¯ï¼Ÿ",
            options: [
              {
                value: "A",
                text: "å‰µé€ æ€§ã‚’é‡è¦–ã™ã‚‹",
                scoring_tags: [{ key: "ä¹¾_å‰µé€ æ€§", value: 3.0 }],
              },
              {
                value: "B",
                text: "å®‰å®šæ€§ã‚’é‡è¦–ã™ã‚‹",
                scoring_tags: [{ key: "è‰®_å®‰å®šæ€§", value: 3.0 }],
              },
            ],
          },
        ];
      }

      // ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ä½œæˆé–¢æ•°
      function createFallbackVectors() {
        console.warn(
          "âš ï¸ [Fallback] ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆä¸­..."
        );

        const fallbackVectors = {};
        for (let i = 1; i <= 64; i++) {
          fallbackVectors[i] = {
            ä¹¾_å‰µé€ æ€§: 5,
            éœ‡_è¡Œå‹•æ€§: 5,
            å_æ¢æ±‚æ€§: 5,
            è‰®_å®‰å®šæ€§: 5,
            å¤_å—å®¹æ€§: 5,
            å·½_é©å¿œæ€§: 5,
            é›¢_è¡¨ç¾æ€§: 5,
            å…Œ_èª¿å’Œæ€§: 5,
          };
        }
        return fallbackVectors;
      }
    </script>

    <script>
      let testResults = {
        timestamp: new Date().toISOString(),
        environment: {
          userAgent: navigator.userAgent,
          url: window.location.href,
          screen: `${screen.width}x${screen.height}`,
          memory: performance.memory
            ? Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + "MB"
            : "N/A",
        },
        tests: [],
        summary: {
          total: 0,
          passed: 0,
          failed: 0,
          warnings: 0,
          duration: 0,
        },
      };

      function addTestResult(name, status, message, details = null) {
        const result = {
          name,
          status, // 'pass', 'fail', 'warning'
          message,
          details,
          timestamp: new Date().toISOString(),
        };

        testResults.tests.push(result);
        testResults.summary.total++;

        if (status === "pass") testResults.summary.passed++;
        else if (status === "fail") testResults.summary.failed++;
        else if (status === "warning") testResults.summary.warnings++;

        updateSummaryDisplay();
        displayTestResult(result);
      }

      function updateSummaryDisplay() {
        document.getElementById("total-tests").textContent =
          testResults.summary.total;
        document.getElementById("passed-tests").textContent =
          testResults.summary.passed;
        document.getElementById("failed-tests").textContent =
          testResults.summary.failed;
      }

      function displayTestResult(result) {
        const resultsDiv = document.getElementById("test-results");
        const div = document.createElement("div");
        div.className = "report-content";

        const statusClass =
          result.status === "pass"
            ? "status-good"
            : result.status === "fail"
            ? "status-error"
            : "status-warning";
        const statusIcon =
          result.status === "pass"
            ? "âœ…"
            : result.status === "fail"
            ? "âŒ"
            : "âš ï¸";

        div.innerHTML = `
                <div class="${statusClass}">${statusIcon} ${result.name}</div>
                <div>${result.message}</div>
                ${
                  result.details
                    ? `<pre>${JSON.stringify(result.details, null, 2)}</pre>`
                    : ""
                }
                <div class="timestamp">${new Date(
                  result.timestamp
                ).toLocaleString()}</div>
            `;

        resultsDiv.appendChild(div);
      }

      function runAllTests() {
        clearResults();
        const startTime = performance.now();

        addTestResult(
          "ãƒ†ã‚¹ãƒˆé–‹å§‹",
          "pass",
          "HaQei Analyzer çµ±åˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™"
        );

        // ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ
        testDataFiles();

        // ã‚¯ãƒ©ã‚¹å®šç¾©ãƒ†ã‚¹ãƒˆ
        testClassDefinitions();

        // æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        testFunctionality();

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        testPerformance();

        const endTime = performance.now();
        testResults.summary.duration = Math.round(endTime - startTime);
        document.getElementById("test-duration").textContent =
          testResults.summary.duration + "ms";

        addTestResult(
          "ãƒ†ã‚¹ãƒˆå®Œäº†",
          "pass",
          `å…¨ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚å®Ÿè¡Œæ™‚é–“: ${testResults.summary.duration}ms`
        );
      }

      function testDataFiles() {
        const dataTests = [
          { name: "HAQEI_DATA", var: window.HAQEI_DATA, critical: true },
          {
            name: "WORLDVIEW_QUESTIONS",
            var: window.WORLDVIEW_QUESTIONS,
            critical: true,
          },
          {
            name: "SCENARIO_QUESTIONS",
            var: window.SCENARIO_QUESTIONS,
            critical: true,
          },
          {
            name: "H64_8D_VECTORS",
            var: window.H64_8D_VECTORS,
            critical: true,
          },
          {
            name: "HEXAGRAM_DETAILS",
            var: window.HEXAGRAM_DETAILS,
            critical: false,
          },
        ];

        dataTests.forEach((test) => {
          if (typeof test.var !== "undefined") {
            let details = null;
            if (test.name === "HAQEI_DATA" && test.var) {
              details = { keys: Object.keys(test.var), type: typeof test.var };
            } else if (Array.isArray(test.var)) {
              details = { length: test.var.length, type: "array" };
            } else if (typeof test.var === "object") {
              details = { keys: Object.keys(test.var).length, type: "object" };
            }

            addTestResult(
              `ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«: ${test.name}`,
              "pass",
              `${test.name} ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ`,
              details
            );
          } else {
            addTestResult(
              `ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«: ${test.name}`,
              test.critical ? "fail" : "warning",
              `${test.name} ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“`
            );
          }
        });
      }

      function testClassDefinitions() {
        const classTests = [
          { name: "BaseComponent", critical: true },
          { name: "DataManager", critical: true },
          { name: "Calculator", critical: true },
          { name: "TripleOSEngine", critical: true },
          { name: "WelcomeScreen", critical: true },
          { name: "QuestionFlow", critical: true },
        ];

        classTests.forEach((test) => {
          if (typeof window[test.name] !== "undefined") {
            addTestResult(
              `ã‚¯ãƒ©ã‚¹å®šç¾©: ${test.name}`,
              "pass",
              `${test.name} ã‚¯ãƒ©ã‚¹ãŒæ­£å¸¸ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™`,
              { type: typeof window[test.name] }
            );
          } else {
            addTestResult(
              `ã‚¯ãƒ©ã‚¹å®šç¾©: ${test.name}`,
              test.critical ? "fail" : "warning",
              `${test.name} ã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“`
            );
          }
        });
      }

      function testFunctionality() {
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ
        const fallbackFunctions = [
          "createFallbackHaqeiData",
          "createFallbackQuestions",
          "createFallbackVectors",
        ];

        fallbackFunctions.forEach((funcName) => {
          if (typeof window[funcName] === "function") {
            try {
              const result = window[funcName]();
              addTestResult(
                `ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½: ${funcName}`,
                "pass",
                `${funcName} ãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã—ãŸ`,
                { resultType: typeof result }
              );
            } catch (error) {
              addTestResult(
                `ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½: ${funcName}`,
                "fail",
                `${funcName} å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`
              );
            }
          } else {
            addTestResult(
              `ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½: ${funcName}`,
              "warning",
              `${funcName} é–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“`
            );
          }
        });
      }

      function testPerformance() {
        const performanceData = {
          memory: performance.memory
            ? {
                used: Math.round(
                  performance.memory.usedJSHeapSize / 1024 / 1024
                ),
                total: Math.round(
                  performance.memory.totalJSHeapSize / 1024 / 1024
                ),
                limit: Math.round(
                  performance.memory.jsHeapSizeLimit / 1024 / 1024
                ),
              }
            : null,
          domElements: document.querySelectorAll("*").length,
          scripts: document.querySelectorAll("script").length,
        };

        addTestResult(
          "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š",
          "pass",
          "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æƒ…å ±ã‚’åé›†ã—ã¾ã—ãŸ",
          performanceData
        );

        if (performanceData.memory && performanceData.memory.used > 100) {
          addTestResult(
            "ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯",
            "warning",
            `ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå¤šã‚ã§ã™: ${performanceData.memory.used}MB`
          );
        }
      }

      function generateReport() {
        const reportDiv = document.getElementById("generated-report");
        const report = `
# HaQei Analyzer ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ

## å®Ÿè¡Œæƒ…å ±
- **å®Ÿè¡Œæ—¥æ™‚**: ${new Date(testResults.timestamp).toLocaleString()}
- **å®Ÿè¡Œæ™‚é–“**: ${testResults.summary.duration}ms
- **ãƒ–ãƒ©ã‚¦ã‚¶**: ${testResults.environment.userAgent}
- **ç”»é¢è§£åƒåº¦**: ${testResults.environment.screen}
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: ${testResults.environment.memory}

## ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼
- **ç·ãƒ†ã‚¹ãƒˆæ•°**: ${testResults.summary.total}
- **æˆåŠŸ**: ${testResults.summary.passed}
- **å¤±æ•—**: ${testResults.summary.failed}
- **è­¦å‘Š**: ${testResults.summary.warnings}
- **æˆåŠŸç‡**: ${Math.round(
          (testResults.summary.passed / testResults.summary.total) * 100
        )}%

## è©³ç´°çµæœ

${testResults.tests
  .map(
    (test) => `
### ${test.name}
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ${
      test.status === "pass"
        ? "âœ… æˆåŠŸ"
        : test.status === "fail"
        ? "âŒ å¤±æ•—"
        : "âš ï¸ è­¦å‘Š"
    }
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: ${test.message}
- **å®Ÿè¡Œæ™‚åˆ»**: ${new Date(test.timestamp).toLocaleString()}
${
  test.details
    ? `- **è©³ç´°**: \`\`\`json\n${JSON.stringify(test.details, null, 2)}\n\`\`\``
    : ""
}
`
  )
  .join("\n")}

## æ¨å¥¨äº‹é …

${
  testResults.summary.failed > 0
    ? "âš ï¸ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š\n- ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ãŒæ­£ã—ã„ã‹\n- å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹\n- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ãªã„ã‹\n"
    : ""
}

${
  testResults.summary.warnings > 0
    ? "ğŸ’¡ è­¦å‘ŠãŒã‚ã‚Šã¾ã™ã€‚ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãªæ©Ÿèƒ½ãŒä¸è¶³ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n"
    : ""
}

${
  testResults.summary.failed === 0 && testResults.summary.warnings === 0
    ? "ğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸï¼HaQei Analyzerã¯æ­£å¸¸ã«å‹•ä½œã™ã‚‹æº–å‚™ãŒã§ãã¦ã„ã¾ã™ã€‚"
    : ""
}

---
*ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯ HaQei Analyzer ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã£ã¦è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ*
            `;

        reportDiv.innerHTML = `<pre>${report}</pre>`;
        reportDiv.style.display = "block";
      }

      function downloadReport() {
        generateReport();
        const reportContent = document.querySelector(
          "#generated-report pre"
        ).textContent;
        const blob = new Blob([reportContent], { type: "text/markdown" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `haqei-analyzer-test-report-${new Date()
          .toISOString()
          .slice(0, 19)
          .replace(/:/g, "-")}.md`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function clearResults() {
        document.getElementById("test-results").innerHTML = "";
        document.getElementById("generated-report").style.display = "none";
        testResults = {
          timestamp: new Date().toISOString(),
          environment: {
            userAgent: navigator.userAgent,
            url: window.location.href,
            screen: `${screen.width}x${screen.height}`,
            memory: performance.memory
              ? Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) +
                "MB"
              : "N/A",
          },
          tests: [],
          summary: { total: 0, passed: 0, failed: 0, warnings: 0, duration: 0 },
        };
        updateSummaryDisplay();
      }

      // åˆæœŸåŒ–
      document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("timestamp").textContent =
          new Date().toLocaleString();
      });
    </script>
  </body>
</html>
