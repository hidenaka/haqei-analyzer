<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="HaQei Analyzer - å¤ä»£ã®å¡æ™ºã¨ç¾ä»£ã®ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ãŒèåˆã—ãŸã€æ·±ã„è‡ªå·±æ´å¯Ÿä½“é¨“"
    />
    <title>HaQei Analyzer - æ·±ã„è‡ªå·±æ´å¯Ÿã¸ã®å…¥ã‚Šå£</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/animations.css" />
    <link rel="stylesheet" href="css/compatibility-details.css" />

    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  </head>
  <body>
    <!-- Global Progress Indicator -->
    <div class="global-progress">
      <div class="progress-bar" style="width: var(--progress, 0%)"></div>
    </div>

    <!-- Main Application Container -->
    <div id="app" class="app-container">
      <!-- Welcome Screen -->
      <section id="welcome-container" class="screen-container">
        <!-- WelcomeScreen component will render here -->
      </section>

      <!-- Questions Flow -->
      <section
        id="questions-container"
        class="screen-container"
        style="display: none"
      >
        <!-- QuestionFlow component will render here -->
      </section>

      <!-- Analysis View -->
      <section
        id="analysis-container"
        class="screen-container"
        style="display: none"
      >
        <!-- AnalysisView component will render here -->
      </section>

      <!-- Results View -->
      <section
        id="results-container"
        class="screen-container"
        style="display: none"
      >
        <!-- ResultsView component will render here -->
      </section>

      <!-- Deep Insights Panel -->
      <section
        id="insights-container"
        class="screen-container"
        style="display: none"
      >
        <!-- InsightPanel component will render here -->
      </section>
    </div>

    <!-- 1. ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæœ€å„ªå…ˆ - ä»–ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒä¾å­˜ã™ã‚‹å¯èƒ½æ€§ï¼‰ -->
    <script src="js/utils/validators.js"></script>
    <script src="js/utils/animations.js"></script>

    <!-- 2. ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾å­˜é–¢ä¿‚é †ã«é…ç½®ï¼‰ -->
    <!-- 2.1. åŸºç›¤ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæœ€å„ªå…ˆ - ä»–ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®åŸºç›¤ï¼‰ -->
    <script src="../js/data/data_box.js"></script>

    <!-- 2.2. è³ªå•ãƒ»ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆåŸºç›¤ãƒ‡ãƒ¼ã‚¿ã«ä¾å­˜ï¼‰ -->
    <script src="../js/data/questions.js"></script>
    <script src="../js/data/vectors.js"></script>

    <!-- 2.3. å¦é–¢é€£ãƒ‡ãƒ¼ã‚¿ï¼ˆè³ªå•ãƒ»ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã«ä¾å­˜ï¼‰ -->
    <script src="../js/data/hexagrams.js"></script>
    <script src="../js/data/hexagram_details.js"></script>

    <!-- 2.4. äº’æ›æ€§ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é–¢é€£ãƒ‡ãƒ¼ã‚¿ï¼ˆå¦ãƒ‡ãƒ¼ã‚¿ã«ä¾å­˜ï¼‰ -->
    <script src="../js/data/compatibility_definition.js"></script>
    <script src="../js/data/compatibility_matrix.js"></script>
    <script src="../js/data/action_plans.js"></script>

    <!-- 3. åŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«å¾Œã«èª­ã¿è¾¼ã¿ï¼‰ -->
    <script src="js/core/BaseComponent.js"></script>

    <!-- 4. ã‚³ã‚¢ã‚¯ãƒ©ã‚¹ï¼ˆåŸºåº•ã‚¯ãƒ©ã‚¹å¾Œã«èª­ã¿è¾¼ã¿ï¼‰ -->
    <script src="js/core/PerformanceMonitor.js"></script>
    <script src="js/core/ScriptPathValidator.js"></script>
    <script src="js/core/ErrorDetectionReporter.js"></script>
    <script src="js/core/DataManager.js"></script>
    <script src="js/core/Calculator.js"></script>
    <script src="js/core/StorageManager.js"></script>

    <!-- 5. ã‚¨ãƒ³ã‚¸ãƒ³ã‚¯ãƒ©ã‚¹ï¼ˆã‚³ã‚¢ã‚¯ãƒ©ã‚¹å¾Œã«èª­ã¿è¾¼ã¿ï¼‰ -->
    <script src="js/core/Engine.js"></script>
    <script src="js/core/TripleOSEngine.js"></script>
    <script src="js/core/EightDimensionAnalysisEngine.js"></script>
    <script src="js/core/RelationshipVisualizationEngine.js"></script>

    <!-- 5.5. ç‰¹æ®Šæ©Ÿèƒ½ï¼ˆã‚¨ãƒ³ã‚¸ãƒ³å¾Œã«èª­ã¿è¾¼ã¿ï¼‰ -->
    <script src="js/core/CompatibilityDataLoader.js"></script>

    <!-- 6. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆã™ã¹ã¦ã®ã‚³ã‚¢æ©Ÿèƒ½å¾Œã«èª­ã¿è¾¼ã¿ï¼‰ -->
    <script src="js/components/WelcomeScreen.js"></script>
    <script src="js/components/QuestionFlow.js"></script>
    <script src="js/components/AnalysisView.js"></script>
    <script src="js/components/ResultsView.js"></script>
    <script src="js/components/TripleOSResultsView.js"></script>
    <script src="js/components/InsightPanel.js"></script>

    <!-- 7. ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæœ€å¾Œã«èª­ã¿è¾¼ã¿ï¼‰ -->
    <script src="js/app.js"></script>

    <!-- ğŸ”§ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½œæˆé–¢æ•° -->
    <script>
      // ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½œæˆé–¢æ•°
      function createFallbackHaqeiData() {
        console.warn("âš ï¸ [Fallback] ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆä¸­...");

        return {
          hexagrams: {},
          hexagrams_master: [
            {
              hexagram_id: 1,
              name_jp: "ä¹¾ç‚ºå¤©",
              reading: "ã‘ã‚“ã„ã¦ã‚“",
              catchphrase: "å¤©ç¿”ã‘ã‚‹é¾ã®ã‚ˆã†ãªã€å¤©æ€§ã®ãƒªãƒ¼ãƒ€ãƒ¼",
              upper_trigram_id: 1,
              lower_trigram_id: 1,
              description: "ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ - åŸºæœ¬çš„ãªå¦æƒ…å ±",
              keywords: "å‰µé€ ,ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—,åŠ›",
            },
          ],
          os_manual: {},
          trigrams_master: [],
          element_relationships: [],
          action_plans: {},
          sho_den: {},
          tai_sho_den: {},
          jo_ka_den: {},
          zatsu_ka_den: {},
          tuan_den: {},
        };
      }

      // ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è³ªå•ãƒ‡ãƒ¼ã‚¿ä½œæˆé–¢æ•°
      function createFallbackQuestions() {
        console.warn("âš ï¸ [Fallback] ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è³ªå•ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆä¸­...");

        return [
          {
            id: "q1",
            text: "ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è³ªå•: ã‚ãªãŸã®åŸºæœ¬çš„ãªä¾¡å€¤è¦³ã¯ï¼Ÿ",
            options: [
              {
                value: "A",
                text: "å‰µé€ æ€§ã‚’é‡è¦–ã™ã‚‹",
                scoring_tags: [{ key: "ä¹¾_å‰µé€ æ€§", value: 3.0 }],
              },
              {
                value: "B",
                text: "å®‰å®šæ€§ã‚’é‡è¦–ã™ã‚‹",
                scoring_tags: [{ key: "è‰®_å®‰å®šæ€§", value: 3.0 }],
              },
            ],
          },
        ];
      }

      // ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ä½œæˆé–¢æ•°
      function createFallbackVectors() {
        console.warn(
          "âš ï¸ [Fallback] ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆä¸­..."
        );

        const fallbackVectors = {};
        for (let i = 1; i <= 64; i++) {
          fallbackVectors[i] = {
            ä¹¾_å‰µé€ æ€§: 5,
            éœ‡_è¡Œå‹•æ€§: 5,
            å_æ¢æ±‚æ€§: 5,
            è‰®_å®‰å®šæ€§: 5,
            å¤_å—å®¹æ€§: 5,
            å·½_é©å¿œæ€§: 5,
            é›¢_è¡¨ç¾æ€§: 5,
            å…Œ_èª¿å’Œæ€§: 5,
          };
        }
        return fallbackVectors;
      }

      // ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¦è©³ç´°ãƒ‡ãƒ¼ã‚¿ä½œæˆé–¢æ•°
      function createFallbackHexagramDetails() {
        console.warn("âš ï¸ [Fallback] ç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¦è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆä¸­...");

        return {
          1: {
            name_jp: "ä¹¾ç‚ºå¤©ï¼ˆã‘ã‚“ã„ã¦ã‚“ï¼‰",
            catchphrase: "å¤©ã®å‰µé€ æ€§ã€‚ç„¡é™ã®å¯èƒ½æ€§ã‚’ç§˜ã‚ãŸãƒªãƒ¼ãƒ€ãƒ¼ã€‚",
            description: "ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ - åŸºæœ¬çš„ãªå¦è©³ç´°æƒ…å ±",
            keywords: [
              "å‰µé€ ",
              "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—",
              "çˆ¶æ€§",
              "ç„¡é™",
              "è¡Œå‹•",
              "æ±ºæ–­åŠ›",
            ],
            engine: {
              strength_meter: 95,
              core_drive: "æ–°ã—ã„ã‚‚ã®ã‚’å‰µé€ ã—ã€ä¸–ç•Œã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ã€‚",
              potential_strengths: ["å“è¶Šã—ãŸãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã¨ã‚«ãƒªã‚¹ãƒæ€§"],
              potential_weaknesses: ["è‡ªå·±ä¸­å¿ƒçš„ã§ã€ä»–è€…ã®æ„è¦‹ã‚’èã‹ãªã„å‚¾å‘"],
            },
            interface: {
              how_it_appears: "è‡ªä¿¡ã«æº€ã¡ã€å ‚ã€…ã¨ã—ãŸæŒ¯ã‚‹èˆã„ã€‚",
              behavioral_patterns: ["ä¼šè­°ã‚„è­°è«–ã§ç©æ¥µçš„ã«æ„è¦‹ã‚’è¿°ã¹ã‚‹"],
              impression_on_others:
                "é ¼ã‚Šã«ãªã‚‹ãƒªãƒ¼ãƒ€ãƒ¼ã ãŒã€å°‘ã—è¿‘å¯„ã‚ŠãŒãŸã„ã€‚",
            },
            safe_mode: {
              trigger_situations: ["è‡ªåˆ†ã®æ¨©å¨ã‚„èƒ½åŠ›ãŒè„…ã‹ã•ã‚ŒãŸã¨æ„Ÿã˜ãŸæ™‚"],
              defensive_patterns: ["ç‹¬æ–­ã§ç‰©äº‹ã‚’æ±ºå®šã—ã€ä»–è€…ã®ä»‹å…¥ã‚’æ‹’çµ¶ã™ã‚‹"],
              internal_state: "ã€Œãªãœèª°ã‚‚ç†è§£ã§ããªã„ã‚“ã ã€ã¨ã„ã†å­¤ç‹¬æ„Ÿ",
            },
          },
        };
      }
    </script>

    <!-- ğŸ”§ å¼·åŒ–ã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ç¢ºèª -->
    <script>
      // ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿çŠ¶æ…‹ã‚’è¿½è·¡
      window.scriptLoadingStatus = {
        dataBoxLoaded: false,
        coreClassesLoaded: false,
        dataFilesLoaded: false,
        componentsLoaded: false,
        allLoaded: false,
        loadAttempts: 0,
        maxAttempts: 50,
        startTime: Date.now(),
        lastCheckTime: Date.now(),
        detailedStatus: {},
        pathValidator: null,
        errorReporter: null,
        performanceMonitor: null,
      };

      // ã‚¨ãƒ©ãƒ¼æ¤œå‡ºãƒ»å ±å‘Šã‚·ã‚¹ãƒ†ãƒ ã¨ãƒ‘ã‚¹æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–
      function initializeErrorDetectionSystems() {
        try {
          // PerformanceMonitor ã®åˆæœŸåŒ–
          if (typeof PerformanceMonitor !== "undefined") {
            window.scriptLoadingStatus.performanceMonitor =
              new PerformanceMonitor({
                enableScriptTiming: true,
                enableMemoryMonitoring: true,
                enableDetailedLogging: true,
                reportingInterval: 1000,
                maxHistorySize: 100,
              });

            // åˆæœŸåŒ–ãƒ•ã‚§ãƒ¼ã‚ºã®é–‹å§‹ã‚’ãƒãƒ¼ã‚¯
            window.scriptLoadingStatus.performanceMonitor.startInitializationPhase(
              "error_systems_init"
            );

            console.log(
              "âœ… [ErrorSystems] PerformanceMonitor ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ"
            );
          } else {
            console.warn(
              "âš ï¸ [ErrorSystems] PerformanceMonitor ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“"
            );
          }

          // ErrorDetectionReporter ã®åˆæœŸåŒ–
          if (typeof ErrorDetectionReporter !== "undefined") {
            window.scriptLoadingStatus.errorReporter =
              new ErrorDetectionReporter({
                enableAutoDetection: true,
                enableConsoleReporting: true,
                enableDetailedLogging: true,
                reportingLevel: "detailed",
              });
            console.log(
              "âœ… [ErrorSystems] ErrorDetectionReporter ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ"
            );
          } else {
            console.warn(
              "âš ï¸ [ErrorSystems] ErrorDetectionReporter ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“"
            );
          }

          // ScriptPathValidator ã®åˆæœŸåŒ–
          if (typeof ScriptPathValidator !== "undefined") {
            window.scriptLoadingStatus.pathValidator = new ScriptPathValidator({
              baseUrl:
                location.origin + location.pathname.replace(/\/[^\/]*$/, ""),
              timeout: 5000,
              strictMode: false, // é–‹ç™ºç’°å¢ƒã§ã¯ç·©ã„è¨­å®š
            });
            console.log(
              "âœ… [ErrorSystems] ScriptPathValidator ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ"
            );
          } else {
            console.warn(
              "âš ï¸ [ErrorSystems] ScriptPathValidator ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“"
            );
          }

          // åˆæœŸåŒ–ãƒ•ã‚§ãƒ¼ã‚ºã®å®Œäº†ã‚’ãƒãƒ¼ã‚¯
          if (window.scriptLoadingStatus.performanceMonitor) {
            window.scriptLoadingStatus.performanceMonitor.endInitializationPhase(
              "error_systems_init",
              true
            );
          }

          // ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ã®äº‹å‰æ¤œè¨¼ã‚’å®Ÿè¡Œ
          performScriptPathValidation();
        } catch (error) {
          console.error(
            "âŒ [ErrorSystems] ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—:",
            error
          );

          // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã‚’çµ‚äº†
          if (window.scriptLoadingStatus.performanceMonitor) {
            window.scriptLoadingStatus.performanceMonitor.endInitializationPhase(
              "error_systems_init",
              false
            );
          }
        }
      }

      // ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ã®äº‹å‰æ¤œè¨¼
      async function performScriptPathValidation() {
        if (!window.scriptLoadingStatus.pathValidator) {
          console.warn(
            "âš ï¸ [PathValidation] PathValidator ãŒåˆ©ç”¨ã§ããªã„ãŸã‚ã€æ¤œè¨¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™"
          );
          return;
        }

        console.log("ğŸ” [PathValidation] ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ã®äº‹å‰æ¤œè¨¼ã‚’é–‹å§‹");

        // æ¤œè¨¼å¯¾è±¡ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ä¸€è¦§
        const scriptPaths = [
          // ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«
          "../js/data/data_box.js",
          "../js/data/questions.js",
          "../js/data/vectors.js",
          "../js/data/hexagrams.js",
          "../js/data/hexagram_details.js",
          "../js/data/compatibility_definition.js",
          "../js/data/compatibility_matrix.js",
          "../js/data/action_plans.js",

          // ã‚³ã‚¢ã‚¯ãƒ©ã‚¹
          "js/core/BaseComponent.js",
          "js/core/DataManager.js",
          "js/core/Calculator.js",
          "js/core/StorageManager.js",
          "js/core/Engine.js",
          "js/core/TripleOSEngine.js",
          "js/core/EightDimensionAnalysisEngine.js",
          "js/core/RelationshipVisualizationEngine.js",
          "js/core/CompatibilityDataLoader.js",

          // UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
          "js/components/WelcomeScreen.js",
          "js/components/QuestionFlow.js",
          "js/components/AnalysisView.js",
          "js/components/ResultsView.js",
          "js/components/TripleOSResultsView.js",
          "js/components/InsightPanel.js",

          // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
          "js/app.js",
        ];

        try {
          const validationResults =
            await window.scriptLoadingStatus.pathValidator.validateMultiplePaths(
              scriptPaths
            );

          // æ¤œè¨¼çµæœã®åˆ†æ
          const issues = validationResults.filter(
            (result) => !result.isValid || result.warnings.length > 0
          );

          if (issues.length > 0) {
            console.group("âš ï¸ [PathValidation] ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ã®å•é¡Œã‚’æ¤œå‡º:");
            issues.forEach((issue) => {
              console.warn(`ğŸ“ ${issue.path}:`);
              if (issue.errors.length > 0) {
                console.error("  ã‚¨ãƒ©ãƒ¼:", issue.errors);
              }
              if (issue.warnings.length > 0) {
                console.warn("  è­¦å‘Š:", issue.warnings);
              }
            });
            console.groupEnd();

            // é‡è¦ãªå•é¡ŒãŒã‚ã‚‹å ´åˆã®å¯¾å‡¦æ³•ææ¡ˆ
            const criticalIssues = issues.filter(
              (issue) => issue.errors.length > 0
            );
            if (criticalIssues.length > 0) {
              console.group("ğŸ’¡ [PathValidation] æ¨å¥¨å¯¾å‡¦æ³•:");
              console.log(
                "1. HTTPã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ä¿¡ã—ã¦ãã ã•ã„:"
              );
              console.log("   python -m http.server 8000");
              console.log("   ã¾ãŸã¯");
              console.log("   npx http-server -p 8000");
              console.log("2. ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã¨å­˜åœ¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„");
              console.log("3. ã‚µãƒ¼ãƒãƒ¼ã®MIMEã‚¿ã‚¤ãƒ—è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„");
              console.groupEnd();
            }
          } else {
            console.log("âœ… [PathValidation] ã™ã¹ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ãŒæ­£å¸¸ã§ã™");
          }

          // æ¤œè¨¼çµæœã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ä¿å­˜
          window.scriptLoadingStatus.pathValidationResults = validationResults;
        } catch (error) {
          console.error("âŒ [PathValidation] ãƒ‘ã‚¹æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ:", error);
        }
      }

      // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†ãƒã‚§ãƒƒã‚¯é–¢æ•°
      function checkDataLoadingComplete() {
        const status = window.scriptLoadingStatus;
        status.loadAttempts++;
        status.lastCheckTime = Date.now();

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–: ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒã‚§ãƒƒã‚¯ãƒ•ã‚§ãƒ¼ã‚ºã®é–‹å§‹
        if (status.performanceMonitor && status.loadAttempts === 1) {
          status.performanceMonitor.startInitializationPhase(
            "data_loading_check"
          );
        }

        console.log(
          `ğŸ” [LoadingCheck] ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ç¢ºèª (${status.loadAttempts}/${
            status.maxAttempts
          }) - çµŒéæ™‚é–“: ${status.lastCheckTime - status.startTime}ms`
        );

        // è©³ç´°ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼æ¤œå‡º
        const scriptErrors = [];
        const expectedScripts = [
          "BaseComponent",
          "DataManager",
          "Calculator",
          "TripleOSEngine",
          "StorageManager",
          "WelcomeScreen",
          "QuestionFlow",
        ];

        expectedScripts.forEach((scriptName) => {
          if (typeof window[scriptName] === "undefined") {
            scriptErrors.push(`${scriptName}.js ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“`);
          }
        });

        if (scriptErrors.length > 0) {
          console.error(
            "âŒ [LoadingCheck] ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",
            scriptErrors
          );
          status.detailedStatus.scriptErrors = scriptErrors;
        }

        // data_box.jsã®èª­ã¿è¾¼ã¿ç¢ºèªï¼ˆè©³ç´°ãƒã‚§ãƒƒã‚¯ï¼‰
        status.dataBoxLoaded = typeof window.HAQEI_DATA !== "undefined";
        status.detailedStatus.haqeiDataContent = status.dataBoxLoaded
          ? window.HAQEI_DATA && typeof window.HAQEI_DATA === "object"
            ? "valid"
            : "invalid"
          : "undefined";

        // hexagrams_masterã®ç¢ºèªï¼ˆdata_box.jsã¨hexagrams.jsã®ä¸¡æ–¹ã§å®šç¾©ã•ã‚Œã‚‹å¯èƒ½æ€§ï¼‰
        status.detailedStatus.hexagramsMaster =
          typeof window.hexagrams_master !== "undefined" ? "loaded" : "missing";

        // ã‚³ã‚¢ã‚¯ãƒ©ã‚¹ã®èª­ã¿è¾¼ã¿ç¢ºèª
        status.coreClassesLoaded =
          typeof DataManager !== "undefined" &&
          typeof Calculator !== "undefined" &&
          typeof TripleOSEngine !== "undefined";

        // ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ç¢ºèª
        status.dataFilesLoaded =
          typeof window.WORLDVIEW_QUESTIONS !== "undefined" &&
          typeof window.SCENARIO_QUESTIONS !== "undefined" &&
          typeof window.H64_8D_VECTORS !== "undefined" &&
          typeof window.HEXAGRAM_DETAILS !== "undefined";

        // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®èª­ã¿è¾¼ã¿ç¢ºèª
        status.componentsLoaded =
          typeof WelcomeScreen !== "undefined" &&
          typeof QuestionFlow !== "undefined";

        // å…¨ä½“ã®èª­ã¿è¾¼ã¿å®Œäº†åˆ¤å®š
        status.allLoaded =
          status.dataBoxLoaded &&
          status.coreClassesLoaded &&
          status.dataFilesLoaded &&
          status.componentsLoaded;

        // è©³ç´°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°
        status.detailedStatus = {
          ...status.detailedStatus,
          dataBox: status.dataBoxLoaded,
          coreClasses: status.coreClassesLoaded,
          dataFiles: status.dataFilesLoaded,
          components: status.componentsLoaded,
          allLoaded: status.allLoaded,
          globalDataCheck: {
            HAQEI_DATA: typeof window.HAQEI_DATA !== "undefined",
            WORLDVIEW_QUESTIONS:
              typeof window.WORLDVIEW_QUESTIONS !== "undefined",
            SCENARIO_QUESTIONS:
              typeof window.SCENARIO_QUESTIONS !== "undefined",
            H64_8D_VECTORS: typeof window.H64_8D_VECTORS !== "undefined",
            HEXAGRAM_DETAILS: typeof window.HEXAGRAM_DETAILS !== "undefined",
          },
        };

        console.log("ğŸ” [LoadingCheck] èª­ã¿è¾¼ã¿çŠ¶æ…‹:", status.detailedStatus);

        if (status.allLoaded) {
          const totalLoadTime = status.lastCheckTime - status.startTime;

          // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–: ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒã‚§ãƒƒã‚¯ãƒ•ã‚§ãƒ¼ã‚ºã®å®Œäº†
          if (status.performanceMonitor) {
            status.performanceMonitor.endInitializationPhase(
              "data_loading_check",
              true
            );
            status.performanceMonitor.takeMemorySnapshot(
              "data_loading_complete"
            );
          }

          console.log(
            `âœ… [LoadingCheck] ã™ã¹ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒèª­ã¿è¾¼ã¿å®Œäº†ã—ã¾ã—ãŸ (${totalLoadTime}ms)`
          );
          return true;
        }

        if (status.loadAttempts >= status.maxAttempts) {
          const totalLoadTime = status.lastCheckTime - status.startTime;

          // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–: ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒã‚§ãƒƒã‚¯ãƒ•ã‚§ãƒ¼ã‚ºã®å¤±æ•—
          if (status.performanceMonitor) {
            status.performanceMonitor.endInitializationPhase(
              "data_loading_check",
              false
            );
            status.performanceMonitor.takeMemorySnapshot(
              "data_loading_timeout"
            );
          }

          console.warn(
            `âš ï¸ [LoadingCheck] èª­ã¿è¾¼ã¿ç¢ºèªãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ (${totalLoadTime}ms)`
          );
          console.warn("âš ï¸ [LoadingCheck] æœªèª­ã¿è¾¼ã¿è¦ç´ :", {
            dataBox: !status.dataBoxLoaded,
            coreClasses: !status.coreClassesLoaded,
            dataFiles: !status.dataFilesLoaded,
            components: !status.componentsLoaded,
          });
          return false;
        }

        return false;
      }

      // DOMèª­ã¿è¾¼ã¿å®Œäº†å¾Œã®å‡¦ç†
      document.addEventListener("DOMContentLoaded", function () {
        console.log(
          "ğŸ” [DOMContentLoaded] DOMèª­ã¿è¾¼ã¿å®Œäº†ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¢ºèªã‚’é–‹å§‹"
        );

        // ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–
        setTimeout(() => {
          initializeErrorDetectionSystems();
        }, 100);

        // åˆå›ãƒã‚§ãƒƒã‚¯
        if (checkDataLoadingComplete()) {
          initializeApplication();
          return;
        }

        // å‹•çš„é–“éš”ã§ã®å®šæœŸçš„ãªãƒã‚§ãƒƒã‚¯
        let checkIntervalMs = 50; // åˆæœŸé–“éš”: 50ms
        const maxIntervalMs = 500; // æœ€å¤§é–“éš”: 500ms

        const checkInterval = setInterval(() => {
          if (checkDataLoadingComplete()) {
            clearInterval(checkInterval);
            console.log("ğŸ¯ [LoadingCheck] èª­ã¿è¾¼ã¿ç¢ºèªå‡¦ç†ã‚’åœæ­¢ã—ã¾ã—ãŸ");
            initializeApplication();
          } else {
            // æ™‚é–“ãŒçµŒã¤ã«ã¤ã‚Œã¦ç¢ºèªé–“éš”ã‚’é•·ãã™ã‚‹ï¼ˆåŠ¹ç‡åŒ–ï¼‰
            if (window.scriptLoadingStatus.loadAttempts > 10) {
              checkIntervalMs = Math.min(checkIntervalMs * 1.2, maxIntervalMs);
            }
          }
        }, checkIntervalMs);

        // 5ç§’å¾Œã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
        setTimeout(() => {
          clearInterval(checkInterval);
          console.error("âŒ [LoadingCheck] ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ");
          initializeApplication(); // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§ã‚‚åˆæœŸåŒ–ã‚’è©¦è¡Œ
        }, 5000);
      });

      // çµ±è¨ˆæƒ…å ±è¡¨ç¤ºé–¢æ•°
      function displayInitializationStats(initSummary) {
        console.group("ğŸ“Š [InitStats] åˆæœŸåŒ–çµ±è¨ˆæƒ…å ±");

        // åŸºæœ¬çµ±è¨ˆ
        console.log(`â±ï¸ åˆæœŸåŒ–æ™‚é–“: ${initSummary.initializationTime}ms`);
        console.log(`â±ï¸ ç·èª­ã¿è¾¼ã¿æ™‚é–“: ${initSummary.totalLoadTime}ms`);

        // ã‚¨ãƒ©ãƒ¼æƒ…å ±
        if (initSummary.missingClasses.length > 0) {
          console.warn(`âš ï¸ ä¸è¶³ã‚¯ãƒ©ã‚¹æ•°: ${initSummary.missingClasses.length}`);
          console.warn(
            `ğŸ“‹ ä¸è¶³ã‚¯ãƒ©ã‚¹: ${initSummary.missingClasses.join(", ")}`
          );
        } else {
          console.log("âœ… ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¹ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ");
        }

        if (initSummary.missingData.length > 0) {
          console.warn(`âš ï¸ ä¸è¶³ãƒ‡ãƒ¼ã‚¿æ•°: ${initSummary.missingData.length}`);
          console.warn(`ğŸ“‹ ä¸è¶³ãƒ‡ãƒ¼ã‚¿: ${initSummary.missingData.join(", ")}`);
        } else {
          console.log("âœ… ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ");
        }

        // é‡è¦ãªã‚¨ãƒ©ãƒ¼
        if (initSummary.criticalError) {
          console.error(`ğŸš¨ é‡è¦ãªã‚¨ãƒ©ãƒ¼: ${initSummary.criticalError}`);
        }

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡
        const performanceRating =
          initSummary.totalLoadTime < 1000
            ? "å„ªç§€"
            : initSummary.totalLoadTime < 3000
            ? "è‰¯å¥½"
            : initSummary.totalLoadTime < 5000
            ? "æ™®é€š"
            : "æ”¹å–„ãŒå¿…è¦";
        console.log(`ğŸ¯ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡: ${performanceRating}`);

        // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ï¼ˆå¯èƒ½ãªå ´åˆï¼‰
        if (performance.memory) {
          const memoryMB = Math.round(
            performance.memory.usedJSHeapSize / 1024 / 1024
          );
          console.log(`ğŸ’¾ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${memoryMB}MB`);
        }

        console.groupEnd();

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        if (initSummary.criticalError) {
          console.warn(
            "âš ï¸ ä¸€éƒ¨æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯å‹•ä½œã—ã¾ã™"
          );
        } else if (
          initSummary.missingClasses.length === 0 &&
          initSummary.missingData.length === 0
        ) {
          console.log("ğŸ‰ ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸï¼");
        }
      }

      // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–é–¢æ•°
      function initializeApplication() {
        const initStartTime = Date.now();
        console.log("ğŸš€ [InitializeApp] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–é–‹å§‹");

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ãƒ•ã‚§ãƒ¼ã‚ºã®é–‹å§‹
        if (window.scriptLoadingStatus.performanceMonitor) {
          window.scriptLoadingStatus.performanceMonitor.startInitializationPhase(
            "application_initialization"
          );
          window.scriptLoadingStatus.performanceMonitor.takeMemorySnapshot(
            "app_init_start"
          );
        }

        try {
          // å¿…é ˆã‚¯ãƒ©ã‚¹ã®å­˜åœ¨ç¢ºèª
          const requiredClasses = {
            BaseComponent: typeof BaseComponent !== "undefined",
            DataManager: typeof DataManager !== "undefined",
            Calculator: typeof Calculator !== "undefined",
            TripleOSEngine: typeof TripleOSEngine !== "undefined",
            StorageManager: typeof StorageManager !== "undefined",
            WelcomeScreen: typeof WelcomeScreen !== "undefined",
            QuestionFlow: typeof QuestionFlow !== "undefined",
          };

          console.log("ğŸ” [InitializeApp] ã‚¯ãƒ©ã‚¹å®šç¾©ç¢ºèª:", requiredClasses);

          // å¿…é ˆãƒ‡ãƒ¼ã‚¿ã®å­˜åœ¨ç¢ºèª
          const requiredData = {
            HAQEI_DATA: typeof window.HAQEI_DATA !== "undefined",
            WORLDVIEW_QUESTIONS:
              typeof window.WORLDVIEW_QUESTIONS !== "undefined",
            SCENARIO_QUESTIONS:
              typeof window.SCENARIO_QUESTIONS !== "undefined",
            H64_8D_VECTORS: typeof window.H64_8D_VECTORS !== "undefined",
            HEXAGRAM_DETAILS: typeof window.HEXAGRAM_DETAILS !== "undefined",
          };

          console.log("ğŸ” [InitializeApp] ãƒ‡ãƒ¼ã‚¿å­˜åœ¨ç¢ºèª:", requiredData);

          // ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
          const missingClasses = Object.keys(requiredClasses).filter(
            (key) => !requiredClasses[key]
          );
          const missingData = Object.keys(requiredData).filter(
            (key) => !requiredData[key]
          );

          if (missingClasses.length > 0) {
            console.error(
              "âŒ [InitializeApp] ä¸è¶³ã—ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¹:",
              missingClasses
            );

            // é‡è¦ãªã‚¯ãƒ©ã‚¹ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã®å‡¦ç†
            if (missingClasses.includes("DataManager")) {
              console.error(
                "âŒ [InitializeApp] DataManagerãŒä¸è¶³ã—ã¦ã„ã¾ã™ - é‡è¦ãªã‚¨ãƒ©ãƒ¼"
              );
              window.scriptLoadingStatus.criticalError = "DataManager missing";
            }
          }

          if (missingData.length > 0) {
            console.error(
              "âŒ [InitializeApp] ä¸è¶³ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿:",
              missingData
            );

            // å„ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®å€‹åˆ¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
            if (missingData.includes("HAQEI_DATA")) {
              console.error(
                "âŒ [InitializeApp] HAQEI_DATAãŒä¸è¶³ã—ã¦ã„ã¾ã™ - é‡è¦ãªã‚¨ãƒ©ãƒ¼"
              );
              window.scriptLoadingStatus.criticalError = "HAQEI_DATA missing";
              console.warn(
                "âš ï¸ [InitializeApp] HAQEI_DATAç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œ"
              );
              window.HAQEI_DATA = createFallbackHaqeiData();
            }

            if (missingData.includes("WORLDVIEW_QUESTIONS")) {
              console.warn(
                "âš ï¸ [InitializeApp] WORLDVIEW_QUESTIONSç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œ"
              );
              window.WORLDVIEW_QUESTIONS = createFallbackQuestions();
            }

            if (missingData.includes("SCENARIO_QUESTIONS")) {
              console.warn(
                "âš ï¸ [InitializeApp] SCENARIO_QUESTIONSç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œ"
              );
              window.SCENARIO_QUESTIONS = createFallbackQuestions();
            }

            if (missingData.includes("H64_8D_VECTORS")) {
              console.warn(
                "âš ï¸ [InitializeApp] H64_8D_VECTORSç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œ"
              );
              window.H64_8D_VECTORS = createFallbackVectors();
            }

            if (missingData.includes("HEXAGRAM_DETAILS")) {
              console.warn(
                "âš ï¸ [InitializeApp] HEXAGRAM_DETAILSç·Šæ€¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œ"
              );
              window.HEXAGRAM_DETAILS = createFallbackHexagramDetails();
            }
          }

          // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ãƒ•ã‚§ãƒ¼ã‚ºã®å®Œäº†
          if (window.scriptLoadingStatus.performanceMonitor) {
            window.scriptLoadingStatus.performanceMonitor.endInitializationPhase(
              "application_initialization",
              missingClasses.length === 0 &&
                !window.scriptLoadingStatus.criticalError
            );
            window.scriptLoadingStatus.performanceMonitor.takeMemorySnapshot(
              "app_init_complete"
            );
          }

          // åˆæœŸåŒ–å®Œäº†ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
          window.scriptLoadingStatus.initializationComplete = true;
          window.scriptLoadingStatus.initializationTime =
            Date.now() - initStartTime;

          const initSummary = {
            initializationTime: window.scriptLoadingStatus.initializationTime,
            missingClasses: missingClasses,
            missingData: missingData,
            totalLoadTime: Date.now() - window.scriptLoadingStatus.startTime,
            criticalError: window.scriptLoadingStatus.criticalError || null,
          };

          console.log(
            "âœ… [InitializeApp] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–å®Œäº†",
            initSummary
          );

          // çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤º
          displayInitializationStats(initSummary);

          // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã®æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
          if (window.scriptLoadingStatus.performanceMonitor) {
            console.log(
              "ğŸ“Š [PerformanceMonitor] æœ€çµ‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­..."
            );
            const finalReport =
              window.scriptLoadingStatus.performanceMonitor.finalize();

            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ä¿å­˜ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
            window.performanceReport = finalReport;

            console.log(
              "âœ… [PerformanceMonitor] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ"
            );
            console.log(
              "ğŸ’¡ [PerformanceMonitor] è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã¯ window.performanceReport ã§ç¢ºèªã§ãã¾ã™"
            );
          }

          // App.jsã®åˆæœŸåŒ–ã‚’å‘¼ã³å‡ºã™æº–å‚™ãŒæ•´ã£ãŸ
          console.log("ğŸ”§ [InitializeApp] App.jsã®åˆæœŸåŒ–æº–å‚™å®Œäº†");
        } catch (error) {
          console.error("âŒ [InitializeApp] åˆæœŸåŒ–ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ:", error);
          window.scriptLoadingStatus.initializationError = error.message;

          // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã‚’çµ‚äº†
          if (window.scriptLoadingStatus.performanceMonitor) {
            window.scriptLoadingStatus.performanceMonitor.endInitializationPhase(
              "application_initialization",
              false
            );
            window.scriptLoadingStatus.performanceMonitor.takeMemorySnapshot(
              "app_init_error"
            );

            // ã‚¨ãƒ©ãƒ¼æ™‚ã§ã‚‚æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
            const errorReport =
              window.scriptLoadingStatus.performanceMonitor.finalize();
            window.performanceReport = errorReport;
          }
        }
      }
    </script>

    <!-- ğŸ”§ ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ‡ãƒãƒƒã‚°ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹å­˜ï¼‰ -->
    <script>
      // æ—§å½¢å¼ã®ãƒ‡ãƒãƒƒã‚°ç¢ºèªï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ï¼‰
      document.addEventListener("DOMContentLoaded", function () {
        console.log("ğŸ” [Legacy] Class definitions check:");
        console.log("BaseComponent:", typeof BaseComponent);
        console.log("DataManager:", typeof DataManager);
        console.log("Calculator:", typeof Calculator);
        console.log("DiagnosisEngine:", typeof DiagnosisEngine);
        console.log("TripleOSEngine:", typeof TripleOSEngine);
        console.log("StorageManager:", typeof StorageManager);

        // ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆã¯è­¦å‘Šè¡¨ç¤º
        if (typeof DiagnosisEngine === "undefined") {
          console.error("âŒ DiagnosisEngine is not defined!");
        }
        if (typeof TripleOSEngine === "undefined") {
          console.error("âŒ TripleOSEngine is not defined!");
        }

        // ãƒ‡ãƒ¼ã‚¿ã®å­˜åœ¨ç¢ºèª
        console.log("WORLDVIEW_QUESTIONS:", typeof WORLDVIEW_QUESTIONS);
        console.log("SCENARIO_QUESTIONS:", typeof SCENARIO_QUESTIONS);
        console.log("H64_8D_VECTORS:", typeof H64_8D_VECTORS);
      });
    </script>
  </body>
</html>
