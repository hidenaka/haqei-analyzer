<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compatibility Analysis Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 4px; 
            background: #f8f9fa;
            border-left: 4px solid #28a745;
        }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>🔍 Compatibility Analysis System Test</h1>
    
    <button onclick="testCompatibilitySystem()">Test Compatibility System</button>
    <button onclick="testDataLoading()">Test Data Loading</button>
    
    <div id="results"></div>

    <script src="js/core/CompatibilityDataLoader.js"></script>
    
    <script>
        let results = document.getElementById('results');
        
        function addResult(message, isError = false) {
            const div = document.createElement('div');
            div.className = `test-result ${isError ? 'error' : ''}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        async function testDataLoading() {
            addResult('🧪 Starting data loading test...');
            
            try {
                const loader = new CompatibilityDataLoader();
                addResult('✅ CompatibilityDataLoader initialized successfully');
                
                // Test loading a specific file
                const engineData = await loader.loadEngineInterfaceFile(1);
                addResult(`✅ Engine-Interface file loaded: ${JSON.stringify(engineData).substring(0, 100)}...`);
                
                const safeModeData = await loader.loadEngineSafeModeFile(1);
                addResult(`✅ Engine-SafeMode file loaded: ${JSON.stringify(safeModeData).substring(0, 100)}...`);
                
            } catch (error) {
                addResult(`❌ Data loading test failed: ${error.message}`, true);
            }
        }
        
        async function testCompatibilitySystem() {
            addResult('🧪 Starting compatibility system test...');
            
            try {
                const loader = new CompatibilityDataLoader();
                addResult('✅ CompatibilityDataLoader initialized');
                
                // Test Engine-Interface compatibility
                const engineInterface = await loader.getEngineInterfaceCompatibility(1, 2);
                addResult(`✅ Engine-Interface compatibility: ${engineInterface.type} (Score: ${Math.round(engineInterface.overallScore * 100)}%)`);
                
                // Test Engine-SafeMode compatibility
                const engineSafeMode = await loader.getEngineSafeModeCompatibility(1, 3);
                addResult(`✅ Engine-SafeMode compatibility: ${engineSafeMode.type} (Score: ${Math.round(engineSafeMode.overallScore * 100)}%)`);
                
                // Test Triple OS compatibility
                const tripleOS = await loader.getTripleOSCompatibility(1, 2, 3);
                addResult(`✅ Triple OS compatibility analysis completed`);
                addResult(`   - Integration score: ${Math.round(tripleOS.integration.overallScore * 100)}%`);
                addResult(`   - Stability: ${Math.round(tripleOS.integration.stability * 100)}%`);
                
                addResult('🎉 All compatibility tests passed!');
                
            } catch (error) {
                addResult(`❌ Compatibility test failed: ${error.message}`, true);
                console.error('Full error:', error);
            }
        }
    </script>
</body>
</html>