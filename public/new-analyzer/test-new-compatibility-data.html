<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°ã—ã„äº’æ›æ€§ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background-color: #0d1117;
            color: #c9d1d9;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-header {
            background: #21262d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #58a6ff;
        }
        .test-section {
            background: #161b22;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #30363d;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid;
            font-size: 12px;
        }
        .test-pass {
            background: #0d4429;
            border-color: #238636;
            color: #2ea043;
        }
        .test-fail {
            background: #490202;
            border-color: #da3633;
            color: #f85149;
        }
        .test-warn {
            background: #333017;
            border-color: #d29922;
            color: #f0c674;
        }
        .test-info {
            background: #0c2d6b;
            border-color: #1f6feb;
            color: #58a6ff;
        }
        .btn {
            background: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #2ea043;
        }
        .json-display {
            background: #010409;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #30363d;
            max-height: 400px;
            overflow-y: auto;
            font-size: 11px;
            margin: 10px 0;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        input[type="number"] {
            background: #21262d;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 8px;
            border-radius: 4px;
            width: 80px;
        }
        label {
            font-size: 12px;
            color: #8b949e;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ”„ æ–°ã—ã„äº’æ›æ€§ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ†ã‚¹ãƒˆ</h1>
            <p>ãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«ã•ã‚ŒãŸäº’æ›æ€§ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã®å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚</p>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h2>
            <div class="controls">
                <label>ã‚¨ãƒ³ã‚¸ãƒ³ID:</label>
                <input type="number" id="engineId" value="46" min="1" max="64">
                
                <label>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ID:</label>
                <input type="number" id="interfaceId" value="1" min="1" max="64">
                
                <label>ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰ID:</label>
                <input type="number" id="safeModeId" value="1" min="1" max="64">
                
                <button class="btn" onclick="testEngineInterfaceData()">Engine-Interfaceèª­ã¿è¾¼ã¿</button>
                <button class="btn" onclick="testEngineSafeModeData()">Engine-SafeModeèª­ã¿è¾¼ã¿</button>
                <button class="btn" onclick="clearResults()">ã‚¯ãƒªã‚¢</button>
            </div>
            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š èª­ã¿è¾¼ã¿çµæœ</h2>
            <div class="json-display" id="data-display">
                <pre>ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„...</pre>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ” ãƒ‡ãƒ¼ã‚¿æ§‹é€ åˆ†æ</h2>
            <div id="structure-analysis"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ ãƒ­ã‚°</h2>
            <div class="json-display" id="log-display">
                <pre>ãƒ­ã‚°ã‚’è¡¨ç¤º...</pre>
            </div>
        </div>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ -->
    <script src="js/core/CompatibilityDataLoader.js"></script>

    <script>
        let compatibilityLoader;
        let logs = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toISOString().substr(11, 12);
            const logEntry = `[${timestamp}] ${message}`;
            logs.push({ timestamp, message, type });
            
            const logDisplay = document.getElementById('log-display');
            logDisplay.innerHTML = '<pre>' + logs.map(l => l.timestamp + ' ' + l.message).join('\n') + '</pre>';
            logDisplay.scrollTop = logDisplay.scrollHeight;
        }

        function addResult(testName, success, message, data = null) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'test-pass' : 'test-fail'}`;
            
            const icon = success ? 'âœ…' : 'âŒ';
            resultDiv.innerHTML = `${icon} <strong>${testName}</strong>: ${message}`;
            
            resultsDiv.appendChild(resultDiv);
            
            if (data) {
                displayData(data);
                analyzeStructure(data);
            }
        }

        function displayData(data) {
            const dataDisplay = document.getElementById('data-display');
            dataDisplay.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }

        function analyzeStructure(data) {
            const analysisDiv = document.getElementById('structure-analysis');
            
            const analysis = {
                hasEngineId: 'engineId' in data,
                hasInterfaceId: 'interfaceId' in data,
                hasSafeModeId: 'safeModeId' in data,
                hasOverallScore: 'overallScore' in data,
                hasSummary: 'summary' in data,
                hasEvaluation: 'evaluation' in data,
                hasAdvice: 'advice' in data,
                hasCompatibility: 'compatibility' in data,
                compatibilityType: data.compatibilityType || 'N/A'
            };

            analysisDiv.innerHTML = Object.entries(analysis).map(([key, value]) => {
                const status = typeof value === 'boolean' ? (value ? 'âœ…' : 'âŒ') : 'ğŸ“‹';
                return `<div class="test-result test-info">${status} ${key}: ${value}</div>`;
            }).join('');
        }

        async function testEngineInterfaceData() {
            const engineId = parseInt(document.getElementById('engineId').value);
            const interfaceId = parseInt(document.getElementById('interfaceId').value);
            
            log(`Engine-Interface ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹: ${engineId}-${interfaceId}`);
            
            try {
                if (!compatibilityLoader) {
                    compatibilityLoader = new CompatibilityDataLoader();
                    log('CompatibilityDataLoaderåˆæœŸåŒ–å®Œäº†');
                }
                
                const startTime = Date.now();
                const data = await compatibilityLoader.getEngineInterfaceCompatibility(engineId, interfaceId);
                const loadTime = Date.now() - startTime;
                
                log(`ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº† (${loadTime}ms)`);
                addResult(
                    `Engine-Interface (${engineId}-${interfaceId})`,
                    true,
                    `èª­ã¿è¾¼ã¿æˆåŠŸ (${loadTime}ms) - ã‚¹ã‚³ã‚¢: ${data.overallScore}`,
                    data
                );
                
            } catch (error) {
                log(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                addResult(
                    `Engine-Interface (${engineId}-${interfaceId})`,
                    false,
                    `èª­ã¿è¾¼ã¿å¤±æ•—: ${error.message}`
                );
            }
        }

        async function testEngineSafeModeData() {
            const engineId = parseInt(document.getElementById('engineId').value);
            const safeModeId = parseInt(document.getElementById('safeModeId').value);
            
            log(`Engine-SafeMode ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹: ${engineId}-${safeModeId}`);
            
            try {
                if (!compatibilityLoader) {
                    compatibilityLoader = new CompatibilityDataLoader();
                    log('CompatibilityDataLoaderåˆæœŸåŒ–å®Œäº†');
                }
                
                const startTime = Date.now();
                const data = await compatibilityLoader.getEngineSafeModeCompatibility(engineId, safeModeId);
                const loadTime = Date.now() - startTime;
                
                log(`ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº† (${loadTime}ms)`);
                addResult(
                    `Engine-SafeMode (${engineId}-${safeModeId})`,
                    true,
                    `èª­ã¿è¾¼ã¿æˆåŠŸ (${loadTime}ms) - ã‚¹ã‚³ã‚¢: ${data.overallScore}`,
                    data
                );
                
            } catch (error) {
                log(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                addResult(
                    `Engine-SafeMode (${engineId}-${safeModeId})`,
                    false,
                    `èª­ã¿è¾¼ã¿å¤±æ•—: ${error.message}`
                );
            }
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('data-display').innerHTML = '<pre>ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ...</pre>';
            document.getElementById('structure-analysis').innerHTML = '';
            logs = [];
            document.getElementById('log-display').innerHTML = '<pre>ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ...</pre>';
            log('çµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('æ–°ã—ã„äº’æ›æ€§ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            
            // Console error handling
            const originalError = console.error;
            console.error = function(...args) {
                log(`Console Error: ${args.join(' ')}`, 'error');
                originalError.apply(console, args);
            };
        });
    </script>
</body>
</html>