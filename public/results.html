<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI - ä»®æƒ³äººæ ¼å¯¾è©±å‹è‡ªå·±ç†è§£ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </title>
    <meta name="description" content="ã‚ãªãŸã®å†…ãªã‚‹3ã¤ã®OSï¼ˆä¾¡å€¤è¦³ãƒ»ç¤¾ä¼šçš„å´é¢ãƒ»é˜²å¾¡çš„å´é¢ï¼‰ã¨ã®å¯¾è©±ã‚’é€šã˜ã¦ã€æ·±ã„è‡ªå·±ç†è§£ã‚’ä¿ƒé€²ã™ã‚‹é©æ–°çš„ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Shippori+Mincho:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSSèª­ã¿è¾¼ã¿é †åºä¿®æ­£ -->
    <link rel="stylesheet" href="css/haqei-unified-design.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/results.css">
    <link rel="stylesheet" href="css/detailed-analysis.css">
    <link rel="stylesheet" href="css/insights-enhanced.css">
    <link rel="stylesheet" href="css/export-mobile.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/results-personality.css">
    <link rel="stylesheet" href="css/psychological-safety.css">
    <!-- é’åŸºèª¿ãƒ‡ã‚¶ã‚¤ãƒ³å¾©æ´» -->
    <link rel="stylesheet" href="css/results-blue-theme.css">
    
    <!-- Chart.js CDN for Phase 2 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- Image Size Validator -->
    <script src="js/utils/ImageSizeValidator.js"></script>
    
    <!-- V3çµ±åˆãƒ‡ã‚¶ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« -->
    <style>
        /* ==========================================
           Figmaãƒ©ã‚¤ã‚¯ãªç¾ã—ã„ãƒ‡ã‚¶ã‚¤ãƒ³ - V3çµ±åˆç‰ˆ
           ========================================== */
        
        :root {
            /* ã‚«ãƒ©ãƒ¼ã‚·ã‚¹ãƒ†ãƒ  */
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
            --primary-bg: #eff6ff;
            
            --engine: #ef4444;
            --engine-light: #fca5a5;
            --engine-bg: #fef2f2;
            
            --interface: #3b82f6;
            --interface-light: #93c5fd;
            --interface-bg: #eff6ff;
            
            --safemode: #10b981;
            --safemode-light: #86efac;
            --safemode-bg: #f0fdf4;
            
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            /* å½± */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            
            /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
            --ease: cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(180deg, #f0f9ff 0%, #ffffff 50%, #f8fafc 100%);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 80px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .hero-title {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.2);
            letter-spacing: -0.02em;
        }
        
        .hero-subtitle {
            font-size: 1.25rem;
            opacity: 0.95;
            font-weight: 300;
        }
        
        .hero-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        /* ã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        /* ã‚µãƒãƒªãƒ¼ã‚°ãƒªãƒƒãƒ‰ */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }
        
        .summary-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s var(--ease);
            cursor: pointer;
        }
        
        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
        }
        
        .summary-card.engine::before {
            background: linear-gradient(90deg, var(--engine) 0%, var(--engine-light) 100%);
        }
        
        .summary-card.interface::before {
            background: linear-gradient(90deg, var(--interface) 0%, var(--interface-light) 100%);
        }
        
        .summary-card.safemode::before {
            background: linear-gradient(90deg, var(--safemode) 0%, var(--safemode-light) 100%);
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-2xl);
        }
        
        .summary-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .summary-emoji {
            font-size: 2.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-50);
            border-radius: 15px;
        }
        
        .summary-info h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 5px;
        }
        
        .summary-info p {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--gray-900);
        }
        
        .summary-card h2 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .summary-card p {
            color: var(--gray-600);
            margin-bottom: 20px;
        }
        
        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠ */
        .error-message-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .error-content {
            background: white;
            padding: 40px;
            border-radius: 16px;
            max-width: 500px;
            text-align: center;
            box-shadow: var(--shadow-2xl);
        }
        
        .error-content h2 {
            color: var(--engine);
            margin-bottom: 20px;
        }
        
        .error-content p {
            color: var(--gray-600);
            margin-bottom: 30px;
        }
        
        .btn-primary {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s var(--ease);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .hero-title { font-size: 2rem; }
            .container { padding: 20px 15px; }
            .summary-grid { grid-template-columns: 1fr; }
        }
        
        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .summary-card {
            animation: slideIn 0.6s var(--ease) forwards;
            opacity: 0;
        }
        
        .summary-card:nth-child(1) { animation-delay: 0.1s; }
        .summary-card:nth-child(2) { animation-delay: 0.2s; }
        .summary-card:nth-child(3) { animation-delay: 0.3s; }
        
        /* V3è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .os-details-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid rgba(0,0,0,0.08);
        }
        
        .detail-item {
            margin-bottom: 20px;
        }
        
        .detail-item:last-child {
            margin-bottom: 0;
        }
        
        .detail-item h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .detail-content {
            font-size: 14px;
            line-height: 1.6;
            color: var(--gray-600);
            background: var(--gray-50);
            padding: 12px;
            border-radius: 8px;
        }
        
        .detail-content strong {
            color: var(--gray-800);
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
        }
        
        /* OSãƒãƒ©ãƒ³ã‚¹è¡¨ç¤º */
        .balance-chart {
            margin: 15px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.03);
            border-radius: 8px;
        }
        
        .simple-chart {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .chart-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-label {
            width: 60px;
            font-size: 12px;
            color: var(--gray-600);
        }
        
        .chart-value {
            height: 20px;
            background: linear-gradient(90deg, #4a90e2, #357abd);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .chart-percent {
            font-size: 12px;
            color: var(--gray-600);
            margin-left: 5px;
        }
        
        .balance-info p {
            margin: 8px 0;
            line-height: 1.6;
        }
        
        .balance-info strong {
            color: var(--primary);
            margin-right: 8px;
        }
        
        /* èª¬æ˜å¯èƒ½æ€§UI ã‚¹ã‚¿ã‚¤ãƒ« */
        .explainability-section {
            border: 1px solid rgba(79, 70, 229, 0.2);
            border-radius: 8px;
            padding: 12px;
            background: rgba(79, 70, 229, 0.05);
        }
        
        .explainability-section summary {
            outline: none;
            user-select: none;
        }
        
        .explainability-section summary:hover {
            color: #3730a3;
        }
        
        .contributions-display {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .contribution-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .contribution-label {
            font-weight: 600;
            font-size: 13px;
            color: var(--gray-700);
        }
        
        .contribution-values {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .contribution-tag {
            background: rgba(79, 70, 229, 0.1);
            color: #4f46e5;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid rgba(79, 70, 229, 0.2);
        }
        
        .contribution-tag.high {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border-color: rgba(239, 68, 68, 0.2);
        }
        
        .contribution-tag.medium {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border-color: rgba(245, 158, 11, 0.2);
        }
        
        .contribution-tag.low {
            background: rgba(34, 197, 94, 0.1);
            color: #059669;
            border-color: rgba(34, 197, 94, 0.2);
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
        @media (max-width: 768px) {
            .os-details-section {
                margin-top: 20px;
                padding-top: 20px;
            }
            
            .detail-item h4 {
                font-size: 13px;
            }
            
            .detail-content {
                font-size: 13px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- æ–°å®Ÿè£…: V3çµ±åˆãƒ‡ã‚¶ã‚¤ãƒ³ -->
    <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="hero">
        <div class="hero-content">
            <div class="hero-badge">HAQEI Triple OS è¨ºæ–­çµæœ</div>
            <h1 class="hero-title">ã‚ãªãŸã®å€‹æ€§ã‚’æ§‹æˆã™ã‚‹<br>3ã¤ã®OSã‚’å®Œå…¨è§£æ</h1>
            <p class="hero-subtitle">64å¦ã®å¡æ™ºãŒæ˜ã‚‰ã‹ã«ã™ã‚‹ã€ã‚ãªãŸã ã‘ã®å€‹æ€§ãƒ‘ã‚¿ãƒ¼ãƒ³</p>
        </div>
    </div>
    
    <div class="container">
        <!-- ã‚µãƒãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="summary-grid" id="summary-grid">
            <!-- Engine OS Card -->
            <div class="summary-card engine" id="engine-os-card">
                <div class="summary-header">
                    <div class="summary-emoji" id="engine-emoji">ğŸš€</div>
                    <div class="summary-info">
                        <h3>ENGINE OS</h3>
                        <p id="engine-hexagram-name">èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>
                <h2 id="engine-nickname">èª­ã¿è¾¼ã¿ä¸­...</h2>
                <p id="engine-description">èª­ã¿è¾¼ã¿ä¸­...</p>
                
                <!-- â­ï¸ V3è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â­ï¸ -->
                <div class="os-details-section">
                    <!-- é€šå¸¸çŠ¶æ…‹ -->
                    <div class="detail-item">
                        <h4>ğŸ’¡ é€šå¸¸çŠ¶æ…‹</h4>
                        <div id="engine-normal-state" class="detail-content"></div>
                    </div>
                    
                    <!-- ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¢ãƒ¼ãƒ‰ -->
                    <div class="detail-item">
                        <h4>ğŸš€ ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¢ãƒ¼ãƒ‰</h4>
                        <div id="engine-super-mode" class="detail-content"></div>
                    </div>
                    
                    <!-- ä¼‘æ¯ãƒ¢ãƒ¼ãƒ‰ -->
                    <div class="detail-item">
                        <h4>ğŸ˜´ ä¼‘æ¯ãƒ¢ãƒ¼ãƒ‰</h4>
                        <div id="engine-rest-mode" class="detail-content"></div>
                    </div>
                    
                    <!-- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ -->
                    <div class="detail-item">
                        <h4>ğŸ”§ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹</h4>
                        <div id="engine-maintenance" class="detail-content"></div>
                    </div>
                    
                    <!-- èª¬æ˜å¯èƒ½æ€§UI: Top-3å¯„ä¸å†…è¨³ -->
                    <div class="detail-item">
                        <h4>ğŸ” èª¬æ˜å¯èƒ½æ€§åˆ†æ</h4>
                        <div class="detail-content">
                            <details class="explainability-section">
                                <summary style="cursor: pointer; font-weight: 600; color: #4f46e5; margin-bottom: 8px;">Top-3å¯„ä¸å†…è¨³ã‚’è¡¨ç¤º</summary>
                                <div id="engine-top3-contributions" class="contributions-display">
                                    <div class="contribution-item">
                                        <span class="contribution-label">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¯„ä¸:</span>
                                        <div id="engine-keyword-contributions" class="contribution-values"></div>
                                    </div>
                                    <div class="contribution-item">
                                        <span class="contribution-label">å“è©å¯„ä¸:</span>
                                        <div id="engine-pos-contributions" class="contribution-values"></div>
                                    </div>
                                    <div class="contribution-item">
                                        <span class="contribution-label">ã‚«ãƒ†ã‚´ãƒªå¯„ä¸:</span>
                                        <div id="engine-category-contributions" class="contribution-values"></div>
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>
                    
                    <!-- OSãƒãƒ©ãƒ³ã‚¹åˆ†æ -->
                    <div class="detail-item">
                        <h4>âš–ï¸ OSãƒãƒ©ãƒ³ã‚¹åˆ†æ</h4>
                        <div id="engine-os-balance" class="detail-content">
                            <div class="balance-chart" id="engine-balance-chart">
                                <!-- OSã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã®è¨ˆç®—çµæœã‚’å¯è¦–åŒ– -->
                            </div>
                            <div class="balance-info">
                                <p><strong>ç†æƒ³çš„ãªãƒãƒ©ãƒ³ã‚¹ï¼š</strong><span id="engine-ideal-balance"></span></p>
                                <p><strong>ç¾åœ¨ã®çŠ¶æ…‹ï¼š</strong><span id="engine-current-balance"></span></p>
                                <p><strong>ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã‚‹æ™‚ï¼š</strong><span id="engine-when-balanced"></span></p>
                                <p><strong>ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œã¦ã„ã‚‹æ™‚ï¼š</strong><span id="engine-when-imbalanced"></span></p>
                                <p><strong>èª¿æ•´ã®ãƒ’ãƒ³ãƒˆï¼š</strong><span id="engine-balance-tip"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Interface OS Card -->
            <div class="summary-card interface" id="interface-os-card">
                <div class="summary-header">
                    <div class="summary-emoji" id="interface-emoji">ğŸŒ</div>
                    <div class="summary-info">
                        <h3>INTERFACE OS</h3>
                        <p id="interface-hexagram-name">èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>
                <h2 id="interface-nickname">èª­ã¿è¾¼ã¿ä¸­...</h2>
                <p id="interface-description">èª­ã¿è¾¼ã¿ä¸­...</p>
                
                <!-- â­ï¸ V3è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â­ï¸ -->
                <div class="os-details-section">
                    <!-- ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« -->
                    <div class="detail-item">
                        <h4>ğŸ’¬ ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«</h4>
                        <div id="interface-how-to-talk" class="detail-content"></div>
                    </div>
                    
                    <!-- æœ€é©ç’°å¢ƒ -->
                    <div class="detail-item">
                        <h4>ğŸŒŸ æœ€é©ç’°å¢ƒ</h4>
                        <div id="interface-best-environment" class="detail-content"></div>
                    </div>
                    
                    <!-- å¯¾äººãƒ¢ãƒ¼ãƒ‰ -->
                    <div class="detail-item">
                        <h4>ğŸ‘¥ å¯¾äººãƒ¢ãƒ¼ãƒ‰</h4>
                        <div id="interface-social-mode" class="detail-content"></div>
                    </div>
                    
                    <!-- èª¬æ˜å¯èƒ½æ€§UI: Top-3å¯„ä¸å†…è¨³ -->
                    <div class="detail-item">
                        <h4>ğŸ” èª¬æ˜å¯èƒ½æ€§åˆ†æ</h4>
                        <div class="detail-content">
                            <details class="explainability-section">
                                <summary style="cursor: pointer; font-weight: 600; color: #4f46e5; margin-bottom: 8px;">Top-3å¯„ä¸å†…è¨³ã‚’è¡¨ç¤º</summary>
                                <div id="interface-top3-contributions" class="contributions-display">
                                    <div class="contribution-item">
                                        <span class="contribution-label">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¯„ä¸:</span>
                                        <div id="interface-keyword-contributions" class="contribution-values"></div>
                                    </div>
                                    <div class="contribution-item">
                                        <span class="contribution-label">å“è©å¯„ä¸:</span>
                                        <div id="interface-pos-contributions" class="contribution-values"></div>
                                    </div>
                                    <div class="contribution-item">
                                        <span class="contribution-label">ã‚«ãƒ†ã‚´ãƒªå¯„ä¸:</span>
                                        <div id="interface-category-contributions" class="contribution-values"></div>
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>
                    
                    <!-- OSãƒãƒ©ãƒ³ã‚¹åˆ†æ -->
                    <div class="detail-item">
                        <h4>âš–ï¸ OSãƒãƒ©ãƒ³ã‚¹åˆ†æ</h4>
                        <div id="interface-os-balance" class="detail-content">
                            <div class="balance-chart" id="interface-balance-chart">
                                <!-- OSã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã®è¨ˆç®—çµæœã‚’å¯è¦–åŒ– -->
                            </div>
                            <div class="balance-info">
                                <p><strong>ç†æƒ³çš„ãªãƒãƒ©ãƒ³ã‚¹ï¼š</strong><span id="interface-ideal-balance"></span></p>
                                <p><strong>ç¾åœ¨ã®çŠ¶æ…‹ï¼š</strong><span id="interface-current-balance"></span></p>
                                <p><strong>ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã‚‹æ™‚ï¼š</strong><span id="interface-when-balanced"></span></p>
                                <p><strong>ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œã¦ã„ã‚‹æ™‚ï¼š</strong><span id="interface-when-imbalanced"></span></p>
                                <p><strong>èª¿æ•´ã®ãƒ’ãƒ³ãƒˆï¼š</strong><span id="interface-balance-tip"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Safe Mode OS Card -->
            <div class="summary-card safemode" id="safemode-os-card">
                <div class="summary-header">
                    <div class="summary-emoji" id="safemode-emoji">ğŸ›¡ï¸</div>
                    <div class="summary-info">
                        <h3>SAFE MODE OS</h3>
                        <p id="safemode-hexagram-name">èª­ã¿è¾¼ã¿ä¸­...</p>
                    </div>
                </div>
                <h2 id="safemode-nickname">èª­ã¿è¾¼ã¿ä¸­...</h2>
                <p id="safemode-description">èª­ã¿è¾¼ã¿ä¸­...</p>
                
                <!-- â­ï¸ V3è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â­ï¸ -->
                <div class="os-details-section">
                    <!-- ã‚¹ãƒˆãƒ¬ã‚¹åå¿œ -->
                    <div class="detail-item">
                        <h4>âš¡ ã‚¹ãƒˆãƒ¬ã‚¹åå¿œ</h4>
                        <div id="safemode-stress-response" class="detail-content"></div>
                    </div>
                    
                    <!-- ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰ -->
                    <div class="detail-item">
                        <h4>ğŸš¨ ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰</h4>
                        <div id="safemode-emergency" class="detail-content"></div>
                    </div>
                    
                    <!-- å›å¾©æ–¹æ³• -->
                    <div class="detail-item">
                        <h4>ğŸ’š å›å¾©æ–¹æ³•</h4>
                        <div id="safemode-recovery" class="detail-content"></div>
                    </div>
                    
                    <!-- èª¬æ˜å¯èƒ½æ€§UI: Top-3å¯„ä¸å†…è¨³ -->
                    <div class="detail-item">
                        <h4>ğŸ” èª¬æ˜å¯èƒ½æ€§åˆ†æ</h4>
                        <div class="detail-content">
                            <details class="explainability-section">
                                <summary style="cursor: pointer; font-weight: 600; color: #4f46e5; margin-bottom: 8px;">Top-3å¯„ä¸å†…è¨³ã‚’è¡¨ç¤º</summary>
                                <div id="safemode-top3-contributions" class="contributions-display">
                                    <div class="contribution-item">
                                        <span class="contribution-label">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¯„ä¸:</span>
                                        <div id="safemode-keyword-contributions" class="contribution-values"></div>
                                    </div>
                                    <div class="contribution-item">
                                        <span class="contribution-label">å“è©å¯„ä¸:</span>
                                        <div id="safemode-pos-contributions" class="contribution-values"></div>
                                    </div>
                                    <div class="contribution-item">
                                        <span class="contribution-label">ã‚«ãƒ†ã‚´ãƒªå¯„ä¸:</span>
                                        <div id="safemode-category-contributions" class="contribution-values"></div>
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>
                    
                    <!-- OSãƒãƒ©ãƒ³ã‚¹åˆ†æ -->
                    <div class="detail-item">
                        <h4>âš–ï¸ OSãƒãƒ©ãƒ³ã‚¹åˆ†æ</h4>
                        <div id="safemode-os-balance" class="detail-content">
                            <div class="balance-chart" id="safemode-balance-chart">
                                <!-- OSã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã®è¨ˆç®—çµæœã‚’å¯è¦–åŒ– -->
                            </div>
                            <div class="balance-info">
                                <p><strong>ç†æƒ³çš„ãªãƒãƒ©ãƒ³ã‚¹ï¼š</strong><span id="safemode-ideal-balance"></span></p>
                                <p><strong>ç¾åœ¨ã®çŠ¶æ…‹ï¼š</strong><span id="safemode-current-balance"></span></p>
                                <p><strong>ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã‚‹æ™‚ï¼š</strong><span id="safemode-when-balanced"></span></p>
                                <p><strong>ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œã¦ã„ã‚‹æ™‚ï¼š</strong><span id="safemode-when-imbalanced"></span></p>
                                <p><strong>èª¿æ•´ã®ãƒ’ãƒ³ãƒˆï¼š</strong><span id="safemode-balance-tip"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="detail-sections">
            <!-- å„OSã®è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="detail-section" id="engine-detail" style="display: none;">
                <h3>Engine OS è©³ç´°åˆ†æ</h3>
                <div class="detail-content">
                    <p>è©³ç´°ãªåˆ†æçµæœã‚’ã“ã“ã«è¡¨ç¤º</p>
                </div>
            </div>
            
            <div class="detail-section" id="interface-detail" style="display: none;">
                <h3>Interface OS è©³ç´°åˆ†æ</h3>
                <div class="detail-content">
                    <p>è©³ç´°ãªåˆ†æçµæœã‚’ã“ã“ã«è¡¨ç¤º</p>
                </div>
            </div>
            
            <div class="detail-section" id="safemode-detail" style="display: none;">
                <h3>Safe Mode OS è©³ç´°åˆ†æ</h3>
                <div class="detail-content">
                    <p>è©³ç´°ãªåˆ†æçµæœã‚’ã“ã“ã«è¡¨ç¤º</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å¿…è¦ãªJavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ -->
    <script src="js/data/data_box.js"></script>
    <script src="js/shared/data/vectors.js"></script>
    <script src="js/os-analyzer/data/iching_relationships.js"></script>
    <script src="js/shared/core/StorageManager.js"></script>
    <script src="js/core/TripleOSInteractionAnalyzer.js"></script>
    <script src="js/core/AuthenticIChingEngine.js"></script>
    <script src="js/core/InsightEngine.js"></script>
    <script src="js/core/ComprehensiveReportGenerator.js"></script>
    
    <!-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="assets/H384H64database.js"></script>
    <script src="js/data/hexagram-human-traits.js"></script>
    <!-- V3ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ -->
    <script src="js/data/hexagram-human-traits-v3.js"></script>
    
    <!-- HexagramExtractor -->
    <script src="js/core/HexagramExtractor.js"></script>
    <script src="js/core/SummaryGenerator.js"></script>
    
    <!-- ã‚¿ãƒ–ã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="js/components/TabNavigator.js"></script>
    <script src="js/components/BaseTabView.js"></script>
    <script src="js/tabs/BasicResultsTab.js"></script>
    <!-- VirtualPersonaResultsView -->
    <script src="js/components/VirtualPersonaResultsView.js"></script>
    
    <!-- é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ -->
    <script src="js/dev-mode-manager.js"></script>
    
    <!-- é–‹ç™ºç”¨ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¨­å®šï¼ˆæœ€çµ‚çš„ã«å‰Šé™¤ï¼‰ -->
    <script>
        // é–‹ç™ºç’°å¢ƒã§ã®ã¿å®Ÿè¡Œ
        if (!localStorage.getItem('osAnalysisResult')) {
            const devTestData = {
                engineOS: "ä¹¾ç‚ºå¤©",      // é©æ–°çš„ãªã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼
                interfaceOS: "å¤ç‚ºåœ°",    // ã‚µãƒãƒ¼ã‚¿ãƒ¼å‹
                safeModeOS: "æ°´é›·å±¯",     // æ–°ãŸãªå§‹ã¾ã‚Šã‚’æ¨¡ç´¢
                timestamp: new Date().toISOString(),
                // 36å•ã®å›ç­”ãƒ‡ãƒ¼ã‚¿ï¼ˆçœç•¥å¯ï¼‰
                answers: []
            };
            localStorage.setItem('osAnalysisResult', JSON.stringify(devTestData));
            console.log('ğŸ”§ é–‹ç™ºç”¨ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã—ãŸ:', devTestData);
            console.log('â„¹ï¸ ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„');
        }
    </script>
    
    <!-- V3ãƒ‡ãƒ¼ã‚¿é€£æºå‡¦ç† -->
    <script>
        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºé–¢æ•°
        function showErrorMessage(message) {
            const errorContainer = document.createElement('div');
            errorContainer.className = 'error-message-container';
            errorContainer.innerHTML = `
                <div class="error-content">
                    <h2>âš ï¸ ã‚¨ãƒ©ãƒ¼</h2>
                    <p>${message}</p>
                    <a href="os_analyzer.html" class="btn-primary">OS Analyzerã¸ç§»å‹•</a>
                </div>
            `;
            document.body.appendChild(errorContainer);
        }
        
        // OSãƒãƒ©ãƒ³ã‚¹è¡¨ç¤ºï¼ˆOSã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã®è¨ˆç®—çµæœã‚’åŸºã«ï¼‰
        function displayOSBalance(osType, hexagramName, calculationVector) {
            const osData = HexagramHumanTraitsV3[hexagramName];
            if (!osData || !osData.osBalance) return;
            
            const prefix = osType === 'engine' ? 'engine' : 
                          osType === 'interface' ? 'interface' : 'safemode';
            
            // V3ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æƒ…å ±å–å¾—
            const balanceData = osData.osBalance;
            
            // ç†æƒ³çš„ãªãƒãƒ©ãƒ³ã‚¹
            const idealBalanceEl = document.getElementById(`${prefix}-ideal-balance`);
            if (idealBalanceEl) {
                idealBalanceEl.textContent = balanceData.idealBalance || 'æƒ…å ±ã‚’æº–å‚™ä¸­...';
            }
            
            // ç¾åœ¨ã®ãƒãƒ©ãƒ³ã‚¹ï¼ˆOSã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã®è¨ˆç®—çµæœã‹ã‚‰ç”Ÿæˆï¼‰
            const currentBalanceEl = document.getElementById(`${prefix}-current-balance`);
            if (currentBalanceEl && calculationVector) {
                // è¨ˆç®—çµæœã‚’è¦‹ã‚„ã™ã„å½¢å¼ã«å¤‰æ›
                const topThree = Object.entries(calculationVector)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3)
                    .map(([key, value]) => `${key.split('_')[1]} ${Math.round(value * 100)}%`)
                    .join(' : ');
                currentBalanceEl.textContent = topThree;
            }
            
            // ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã‚‹æ™‚
            const whenBalancedEl = document.getElementById(`${prefix}-when-balanced`);
            if (whenBalancedEl) {
                whenBalancedEl.textContent = balanceData.whenBalanced || 'æƒ…å ±ã‚’æº–å‚™ä¸­...';
            }
            
            // ãƒãƒ©ãƒ³ã‚¹ãŒå´©ã‚Œã¦ã„ã‚‹æ™‚
            const whenImbalancedEl = document.getElementById(`${prefix}-when-imbalanced`);
            if (whenImbalancedEl) {
                whenImbalancedEl.textContent = balanceData.whenImbalanced || 'æƒ…å ±ã‚’æº–å‚™ä¸­...';
            }
            
            // èª¿æ•´ã®ãƒ’ãƒ³ãƒˆ
            const tipEl = document.getElementById(`${prefix}-balance-tip`);
            if (tipEl) {
                tipEl.textContent = balanceData.tip || 'æƒ…å ±ã‚’æº–å‚™ä¸­...';
            }
            
            // ç°¡æ˜“ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º
            displayBalanceChart(`${prefix}-balance-chart`, calculationVector);
        }
        
        // ç°¡æ˜“ãƒãƒ©ãƒ³ã‚¹ãƒãƒ£ãƒ¼ãƒˆ
        function displayBalanceChart(elementId, vector) {
            const chartEl = document.getElementById(elementId);
            if (!chartEl || !vector) return;
            
            // ç°¡æ˜“çš„ãªãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º
            const maxValue = Math.max(...Object.values(vector));
            let chartHTML = '<div class="simple-chart">';
            
            Object.entries(vector).forEach(([key, value]) => {
                const percentage = (value / maxValue) * 100;
                const label = key.split('_')[1];
                chartHTML += `
                    <div class="chart-bar">
                        <span class="chart-label">${label}</span>
                        <div class="chart-value" style="width: ${percentage}%"></div>
                        <span class="chart-percent">${Math.round(value * 100)}%</span>
                    </div>
                `;
            });
            
            chartHTML += '</div>';
            chartEl.innerHTML = chartHTML;
        }
        
        // Engine OSã®è¡¨ç¤ºæ›´æ–°
        function updateEngineOSDisplay(hexagramName, data) {
            // åŸºæœ¬æƒ…å ±ã®æ›´æ–°
            document.getElementById('engine-hexagram-name').textContent = hexagramName;
            document.getElementById('engine-emoji').textContent = data.emoji || 'ğŸš€';
            document.getElementById('engine-nickname').textContent = data.nickname || 'åˆ†æä¸­...';
            
            // Engine OSå›ºæœ‰ã®èª¬æ˜ã‚’è¡¨ç¤º
            if (data.asEngineOS && data.asEngineOS.profile) {
                document.getElementById('engine-description').textContent = 
                    data.asEngineOS.profile.description || 'è©³ç´°æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...';
            } else {
                document.getElementById('engine-description').textContent = 'è©³ç´°æƒ…å ±ã‚’æº–å‚™ä¸­...';
            }
            
            // â­ï¸ V3è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºã‚’è¿½åŠ  â­ï¸
            if (data.asEngineOS) {
                const os = data.asEngineOS;
                
                // é€šå¸¸çŠ¶æ…‹
                if (os.normalState) {
                    const normalStateEl = document.getElementById('engine-normal-state');
                    if (normalStateEl) {
                        normalStateEl.innerHTML = `
                            ${os.normalState.whatHappens ? `<strong>ã©ã‚“ãªæ™‚ï¼š</strong>${os.normalState.whatHappens}<br>` : ''}
                            ${os.normalState.example ? `<strong>å…·ä½“ä¾‹ï¼š</strong>${os.normalState.example}<br>` : ''}
                            ${os.normalState.energyLevel ? `<strong>ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼š</strong>${os.normalState.energyLevel}` : ''}
                        `.trim() || '<span style="color: #999;">æƒ…å ±ã‚’æº–å‚™ä¸­...</span>';
                    }
                }
                
                // ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¢ãƒ¼ãƒ‰
                if (os.superMode) {
                    const superModeEl = document.getElementById('engine-super-mode');
                    if (superModeEl) {
                        superModeEl.innerHTML = `
                            ${os.superMode.when ? `<strong>ç™ºå‹•æ¡ä»¶ï¼š</strong>${os.superMode.when}<br>` : ''}
                            ${os.superMode.whatHappens ? `<strong>ã©ã†ãªã‚‹ï¼š</strong>${os.superMode.whatHappens}<br>` : ''}
                            ${os.superMode.example ? `<strong>å…·ä½“ä¾‹ï¼š</strong>${os.superMode.example}<br>` : ''}
                            ${os.superMode.energyLevel ? `<strong>ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼š</strong>${os.superMode.energyLevel}` : ''}
                        `.trim() || '<span style="color: #999;">æƒ…å ±ã‚’æº–å‚™ä¸­...</span>';
                    }
                }
                
                // ä¼‘æ¯ãƒ¢ãƒ¼ãƒ‰
                if (os.restMode) {
                    const restModeEl = document.getElementById('engine-rest-mode');
                    if (restModeEl) {
                        restModeEl.innerHTML = `
                            ${os.restMode.whatHappens ? `<strong>çŠ¶æ…‹ï¼š</strong>${os.restMode.whatHappens}<br>` : ''}
                            ${os.restMode.howToRest ? `<strong>ä¼‘æ¯æ–¹æ³•ï¼š</strong>${os.restMode.howToRest}<br>` : ''}
                            ${os.restMode.note ? `<strong>æ³¨æ„ï¼š</strong>${os.restMode.note}` : ''}
                        `.trim() || '<span style="color: #999;">æƒ…å ±ã‚’æº–å‚™ä¸­...</span>';
                    }
                }
                
                // ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
                if (os.maintenance) {
                    const maintenanceEl = document.getElementById('engine-maintenance');
                    if (maintenanceEl) {
                        maintenanceEl.innerHTML = `
                            ${os.maintenance.whatYouNeed ? `<strong>å¿…è¦ãªã‚‚ã®ï¼š</strong>${os.maintenance.whatYouNeed}<br>` : ''}
                            ${os.maintenance.howToCharge ? `<strong>å……é›»æ–¹æ³•ï¼š</strong>${os.maintenance.howToCharge}<br>` : ''}
                            ${os.maintenance.warning ? `<strong>è­¦å‘Šï¼š</strong>${os.maintenance.warning}<br>` : ''}
                            ${os.maintenance.tip ? `<strong>ãƒ’ãƒ³ãƒˆï¼š</strong>${os.maintenance.tip}` : ''}
                        `.trim() || '<span style="color: #999;">æƒ…å ±ã‚’æº–å‚™ä¸­...</span>';
                    }
                }
                
                // OSãƒãƒ©ãƒ³ã‚¹è¡¨ç¤ºã‚’è¿½åŠ 
                const calculationData = JSON.parse(localStorage.getItem('osCalculationVectors') || '{}');
                if (calculationData.engine) {
                    displayOSBalance('engine', hexagramName, calculationData.engine);
                    displayExplainabilityAnalysis('engine', hexagramName, calculationData.engine);
                }
            }
        }
        
        // Interface OSã®è¡¨ç¤ºæ›´æ–°
        function updateInterfaceOSDisplay(hexagramName, data) {
            // åŸºæœ¬æƒ…å ±ã®æ›´æ–°
            document.getElementById('interface-hexagram-name').textContent = hexagramName;
            document.getElementById('interface-emoji').textContent = data.emoji || 'ğŸŒ';
            document.getElementById('interface-nickname').textContent = data.nickname || 'åˆ†æä¸­...';
            
            // Interface OSå›ºæœ‰ã®èª¬æ˜ã‚’è¡¨ç¤º
            if (data.asInterfaceOS && data.asInterfaceOS.profile) {
                document.getElementById('interface-description').textContent = 
                    data.asInterfaceOS.profile.description || 'è©³ç´°æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...';
            } else {
                document.getElementById('interface-description').textContent = 'è©³ç´°æƒ…å ±ã‚’æº–å‚™ä¸­...';
            }
            
            // â­ï¸ V3è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºã‚’è¿½åŠ  â­ï¸
            if (data.asInterfaceOS) {
                const os = data.asInterfaceOS;
                
                // ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«
                if (os.howToTalk) {
                    const howToTalkEl = document.getElementById('interface-how-to-talk');
                    if (howToTalkEl) {
                        howToTalkEl.innerHTML = `
                            ${os.howToTalk.style ? `<strong>ã‚¹ã‚¿ã‚¤ãƒ«ï¼š</strong>${os.howToTalk.style}<br>` : ''}
                            ${os.howToTalk.example ? `<strong>å…·ä½“ä¾‹ï¼š</strong>${os.howToTalk.example}<br>` : ''}
                            ${os.howToTalk.goodAt ? `<strong>å¾—æ„åˆ†é‡ï¼š</strong>${os.howToTalk.goodAt}<br>` : ''}
                            ${os.howToTalk.notGoodAt ? `<strong>è‹¦æ‰‹åˆ†é‡ï¼š</strong>${os.howToTalk.notGoodAt}` : ''}
                        `.trim() || '<span style="color: #999;">æƒ…å ±ã‚’æº–å‚™ä¸­...</span>';
                    }
                }
                
                // æœ€é©ç’°å¢ƒï¼ˆä¿®æ­£ç‰ˆï¼‰
                if (os.bestEnvironment) {
                    const bestEnvEl = document.getElementById('interface-best-environment');
                    if (bestEnvEl) {
                        bestEnvEl.innerHTML = `
                            ${os.bestEnvironment.where ? `<strong>ç†æƒ³çš„ãªç’°å¢ƒï¼š</strong>${os.bestEnvironment.where}<br>` : ''}
                            ${os.bestEnvironment.example ? `<strong>å…·ä½“ä¾‹ï¼š</strong>${os.bestEnvironment.example}<br>` : ''}
                            ${os.bestEnvironment.withWho ? `<strong>ç›¸æ€§ã®è‰¯ã„äººï¼š</strong>${os.bestEnvironment.withWho}<br>` : ''}
                            ${os.bestEnvironment.avoid ? `<strong>é¿ã‘ãŸã„ç’°å¢ƒï¼š</strong>${os.bestEnvironment.avoid}` : ''}
                            ${os.bestEnvironment.workplace ? `<strong>è·å ´ç’°å¢ƒï¼š</strong>${os.bestEnvironment.workplace}<br>` : ''}
                            ${os.bestEnvironment.relationships ? `<strong>äººé–“é–¢ä¿‚ï¼š</strong>${os.bestEnvironment.relationships}<br>` : ''}
                            ${os.bestEnvironment.communication ? `<strong>ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼š</strong>${os.bestEnvironment.communication}` : ''}
                        `.trim() || '<span style="color: #999;">æƒ…å ±ã‚’æº–å‚™ä¸­...</span>';
                    }
                }
                
                // å¯¾äººãƒ¢ãƒ¼ãƒ‰ï¼ˆä¿®æ­£ç‰ˆï¼‰
                if (os.socialMode) {
                    const socialModeEl = document.getElementById('interface-social-mode');
                    if (socialModeEl) {
                        socialModeEl.innerHTML = `
                            ${os.socialMode.inGroup ? `<strong>ã‚°ãƒ«ãƒ¼ãƒ—å†…ï¼š</strong>${os.socialMode.inGroup}<br>` : ''}
                            ${os.socialMode.oneOnOne ? `<strong>1å¯¾1ï¼š</strong>${os.socialMode.oneOnOne}<br>` : ''}
                            ${os.socialMode.publicSpeaking ? `<strong>å…¬ã®å ´ï¼š</strong>${os.socialMode.publicSpeaking}` : ''}
                        `.trim() || '<span style="color: #999;">æƒ…å ±ã‚’æº–å‚™ä¸­...</span>';
                    }
                } else if (os.relationshipTips) {
                    // socialModeãŒãªã„å ´åˆã¯relationshipTipsã‚’è¡¨ç¤º
                    const socialModeEl = document.getElementById('interface-social-mode');
                    if (socialModeEl) {
                        socialModeEl.innerHTML = `
                            ${os.relationshipTips.strength ? `<strong>å¼·ã¿ï¼š</strong>${os.relationshipTips.strength}<br>` : ''}
                            ${os.relationshipTips.weakness ? `<strong>å¼±ã¿ï¼š</strong>${os.relationshipTips.weakness}<br>` : ''}
                            ${os.relationshipTips.advice ? `<strong>ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼š</strong>${os.relationshipTips.advice}` : ''}
                        `.trim() || '<span style="color: #999;">æƒ…å ±ã‚’æº–å‚™ä¸­...</span>';
                    }
                }
                
                // OSãƒãƒ©ãƒ³ã‚¹è¡¨ç¤ºã‚’è¿½åŠ 
                const calculationData = JSON.parse(localStorage.getItem('osCalculationVectors') || '{}');
                if (calculationData.interface) {
                    displayOSBalance('interface', hexagramName, calculationData.interface);
                    displayExplainabilityAnalysis('interface', hexagramName, calculationData.interface);
                }
            }
        }
        
        // Safe Mode OSã®è¡¨ç¤ºæ›´æ–°
        function updateSafeModeOSDisplay(hexagramName, data) {
            // åŸºæœ¬æƒ…å ±ã®æ›´æ–°
            document.getElementById('safemode-hexagram-name').textContent = hexagramName;
            document.getElementById('safemode-emoji').textContent = data.emoji || 'ğŸ›¡ï¸';
            document.getElementById('safemode-nickname').textContent = data.nickname || 'åˆ†æä¸­...';
            
            // Safe Mode OSå›ºæœ‰ã®èª¬æ˜ã‚’è¡¨ç¤º
            if (data.asSafeModeOS && data.asSafeModeOS.profile) {
                document.getElementById('safemode-description').textContent = 
                    data.asSafeModeOS.profile.description || 'è©³ç´°æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...';
            } else {
                document.getElementById('safemode-description').textContent = 'è©³ç´°æƒ…å ±ã‚’æº–å‚™ä¸­...';
            }
            
            // â­ï¸ V3è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºã‚’è¿½åŠ  â­ï¸
            if (data.asSafeModeOS) {
                const os = data.asSafeModeOS;
                
                // ã‚¹ãƒˆãƒ¬ã‚¹åå¿œï¼ˆä¿®æ­£ç‰ˆï¼‰
                if (os.stressResponse) {
                    const stressEl = document.getElementById('safemode-stress-response');
                    if (stressEl) {
                        // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®é•ã„ã«å¯¾å¿œ
                        const initial = os.stressResponse.initial || os.stressResponse.whatYouDo;
                        const continued = os.stressResponse.continued || os.stressResponse.goodPoint;
                        const example = os.stressResponse.example || os.stressResponse.badPoint;
                        
                        stressEl.innerHTML = `
                            ${initial ? `<strong>åˆæœŸåå¿œï¼š</strong>${initial}<br>` : ''}
                            ${continued ? `<strong>ç¶™ç¶šã™ã‚‹ã¨ï¼š</strong>${continued}<br>` : ''}
                            ${example ? `<strong>å…·ä½“ä¾‹ï¼š</strong>${example}` : ''}
                        `.trim() || '<span style="color: #999;">æƒ…å ±ã‚’æº–å‚™ä¸­...</span>';
                    }
                }
                
                // ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰ï¼ˆä¿®æ­£ç‰ˆï¼‰
                if (os.emergencyMode) {
                    const emergencyEl = document.getElementById('safemode-emergency');
                    if (emergencyEl) {
                        // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®é•ã„ã«å¯¾å¿œ
                        const trigger = os.emergencyMode.trigger || os.emergencyMode.whatHappens;
                        const behavior = os.emergencyMode.behavior || os.emergencyMode.example;
                        const impact = os.emergencyMode.impact || os.emergencyMode.recovery;
                        const timeToRecover = os.emergencyMode.timeToRecover;
                        
                        emergencyEl.innerHTML = `
                            ${trigger ? `<strong>ç™ºå‹•æ¡ä»¶ï¼š</strong>${trigger}<br>` : ''}
                            ${behavior ? `<strong>è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š</strong>${behavior}<br>` : ''}
                            ${impact ? `<strong>å½±éŸ¿ï¼š</strong>${impact}` : ''}
                            ${timeToRecover ? `<br><strong>å›å¾©æ™‚é–“ï¼š</strong>${timeToRecover}` : ''}
                        `.trim() || '<span style="color: #999;">æƒ…å ±ã‚’æº–å‚™ä¸­...</span>';
                    }
                }
                
                // å›å¾©æ–¹æ³•ï¼ˆä¿®æ­£ç‰ˆï¼‰
                if (os.howToRecover) {
                    const recoveryEl = document.getElementById('safemode-recovery');
                    if (recoveryEl) {
                        // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®é•ã„ã«å¯¾å¿œ
                        const shortTerm = os.howToRecover.shortTerm || os.howToRecover.bestWay;
                        const longTerm = os.howToRecover.longTerm || os.howToRecover.example;
                        const support = os.howToRecover.support || os.howToRecover.environment;
                        
                        recoveryEl.innerHTML = `
                            ${shortTerm ? `<strong>çŸ­æœŸçš„ï¼š</strong>${shortTerm}<br>` : ''}
                            ${longTerm ? `<strong>é•·æœŸçš„ï¼š</strong>${longTerm}<br>` : ''}
                            ${support ? `<strong>ã‚µãƒãƒ¼ãƒˆï¼š</strong>${support}` : ''}
                        `.trim() || '<span style="color: #999;">æƒ…å ±ã‚’æº–å‚™ä¸­...</span>';
                    }
                }
                
                // OSãƒãƒ©ãƒ³ã‚¹è¡¨ç¤ºã‚’è¿½åŠ 
                const calculationData = JSON.parse(localStorage.getItem('osCalculationVectors') || '{}');
                if (calculationData.safemode) {
                    displayOSBalance('safemode', hexagramName, calculationData.safemode);
                    displayExplainabilityAnalysis('safemode', hexagramName, calculationData.safemode);
                }
            }
        }
        
        // Triple OSã®çµæœè¡¨ç¤º
        function displayTripleOSResults(analysisData) {
            console.log('åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º:', analysisData);
            
            // V3ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            if (typeof HexagramHumanTraitsV3 === 'undefined') {
                console.error('V3ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                showErrorMessage('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // Engine OS ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
            if (analysisData.engineOS) {
                const engineData = HexagramHumanTraitsV3[analysisData.engineOS];
                if (engineData) {
                    updateEngineOSDisplay(analysisData.engineOS, engineData);
                } else {
                    console.warn('Engine OS ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', analysisData.engineOS);
                    updateEngineOSDisplay(analysisData.engineOS, {
                        nickname: 'æƒ…å ±å–å¾—ä¸­...',
                        emoji: 'ğŸš€'
                    });
                }
            }
            
            // Interface OS ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
            if (analysisData.interfaceOS) {
                const interfaceData = HexagramHumanTraitsV3[analysisData.interfaceOS];
                if (interfaceData) {
                    updateInterfaceOSDisplay(analysisData.interfaceOS, interfaceData);
                } else {
                    console.warn('Interface OS ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', analysisData.interfaceOS);
                    updateInterfaceOSDisplay(analysisData.interfaceOS, {
                        nickname: 'æƒ…å ±å–å¾—ä¸­...',
                        emoji: 'ğŸŒ'
                    });
                }
            }
            
            // Safe Mode OS ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
            if (analysisData.safeModeOS) {
                const safeModeData = HexagramHumanTraitsV3[analysisData.safeModeOS];
                if (safeModeData) {
                    updateSafeModeOSDisplay(analysisData.safeModeOS, safeModeData);
                } else {
                    console.warn('Safe Mode OS ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', analysisData.safeModeOS);
                    updateSafeModeOSDisplay(analysisData.safeModeOS, {
                        nickname: 'æƒ…å ±å–å¾—ä¸­...',
                        emoji: 'ğŸ›¡ï¸'
                    });
                }
            }
            
            // æ”¹å–„ç‰ˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
            if (window.location.hash === '#debug') {
                console.group('ğŸ” V3ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ»è¨ˆç®—çµæœç¢ºèª');
                
                // localStorageã‹ã‚‰OSæƒ…å ±å–å¾—
                const osResult = JSON.parse(localStorage.getItem('osAnalysisResult') || '{}');
                const calculationData = JSON.parse(localStorage.getItem('osCalculationVectors') || '{}');
                
                // OSåã®ä¸€è¦§
                const osNames = {
                    engine: osResult.engineOS,
                    interface: osResult.interfaceOS,
                    safemode: osResult.safeModeOS
                };
                
                // å„OSã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨è¨ˆç®—çµæœã‚’ç¢ºèª
                Object.entries(osNames).forEach(([osType, hexName]) => {
                    if (!hexName) return;
                    
                    const data = HexagramHumanTraitsV3[hexName];
                    const calcVector = calculationData[osType];
                    
                    console.group(`ğŸ“Š ${osType.toUpperCase()} OS: ${hexName}`);
                    
                    // V3ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ç¢ºèª
                    console.log('V3ãƒ‡ãƒ¼ã‚¿æ§‹é€ :', {
                        profile: data?.profile ? 'âœ…' : 'âŒ',
                        asEngineOS: data?.asEngineOS ? 'âœ…' : 'âŒ',
                        asInterfaceOS: data?.asInterfaceOS ? 'âœ…' : 'âŒ',
                        asSafeModeOS: data?.asSafeModeOS ? 'âœ…' : 'âŒ',
                        osBalance: data?.osBalance ? 'âœ…' : 'âŒ'
                    });
                    
                    // è¨ˆç®—ãƒ™ã‚¯ãƒˆãƒ«ã®ç¢ºèª
                    if (calcVector) {
                        console.log('è¨ˆç®—ãƒ™ã‚¯ãƒˆãƒ«:', calcVector);
                        console.log('ä¸Šä½3è¦ç´ :', 
                            Object.entries(calcVector)
                                .sort((a, b) => b[1] - a[1])
                                .slice(0, 3)
                                .map(([k, v]) => `${k}: ${(v * 100).toFixed(1)}%`)
                        );
                    } else {
                        console.warn('âš ï¸ è¨ˆç®—ãƒ™ã‚¯ãƒˆãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                    
                    // æœŸå¾…å€¤ã¨å®Ÿéš›ã®è¡¨ç¤ºå€¤ã®æ¯”è¼ƒ
                    const osSpecificData = osType === 'engine' ? data?.asEngineOS :
                                           osType === 'interface' ? data?.asInterfaceOS :
                                           data?.asSafeModeOS;
                    
                    if (osSpecificData) {
                        console.log('è©³ç´°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰çŠ¶æ…‹:', {
                            normalState: osSpecificData.normalState ? 'âœ…' : 'âŒ',
                            superMode: osSpecificData.superMode ? 'âœ…' : 'âŒ',
                            bestEnvironment: osSpecificData.bestEnvironment ? 'âœ…' : 'âŒ',
                            stressResponse: osSpecificData.stressResponse ? 'âœ…' : 'âŒ',
                            osBalance: data?.osBalance ? 'âœ…' : 'âŒ'
                        });
                    }
                    
                    console.groupEnd();
                });
                
                // ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
                console.group('ğŸ” ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯');
                if (!calculationData || Object.keys(calculationData).length === 0) {
                    console.warn('âš ï¸ OSã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã®è¨ˆç®—çµæœãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    console.log('â†’ OS Analyzerã‚’å®Ÿè¡Œã—ã¦è¨ˆç®—çµæœã‚’ä¿å­˜ã—ã¦ãã ã•ã„');
                } else {
                    console.log('âœ… è¨ˆç®—çµæœãŒæ­£å¸¸ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™');
                }
                console.groupEnd();
                
                console.groupEnd();
            }
        }
        
        // Top-3å¯„ä¸å†…è¨³ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function displayExplainabilityAnalysis(osType, hexagramName, calculationVector) {
            const explainabilityEl = document.getElementById(`${osType}-explainability`);
            if (!explainabilityEl || !calculationVector) {
                return;
            }
            
            // è¨ˆç®—ãƒ™ã‚¯ãƒˆãƒ«ã‹ã‚‰ä¸Šä½3ã¤ã‚’æŠ½å‡º
            const top3 = Object.entries(calculationVector)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);
            
            // å¯„ä¸åº¦ã®åˆ†é¡
            const getContributionLevel = (value) => {
                if (value > 0.15) return 'high';
                if (value > 0.08) return 'medium';
                return 'low';
            };
            
            // å¯„ä¸å†…è¨³ã®è¡¨ç¤º
            const contributionsHtml = `
                <div class="contributions-display">
                    <div class="contribution-item">
                        <div class="contribution-label">ä¸»è¦å¯„ä¸è¦ç´ ï¼ˆTop-3ï¼‰</div>
                        <div class="contribution-values">
                            ${top3.map(([key, value]) => {
                                const level = getContributionLevel(value);
                                const percentage = (value * 100).toFixed(1);
                                return `<span class="contribution-tag ${level}">${key}: ${percentage}%</span>`;
                            }).join('')}
                        </div>
                    </div>
                    <div class="contribution-item">
                        <div class="contribution-label">å¯„ä¸åº¦åˆ†æ</div>
                        <div class="contribution-values">
                            <span class="contribution-tag">ç·è¨ˆç®—è¦ç´ : ${Object.keys(calculationVector).length}å€‹</span>
                            <span class="contribution-tag">æœ€å¤§å¯„ä¸: ${(Math.max(...Object.values(calculationVector)) * 100).toFixed(1)}%</span>
                            <span class="contribution-tag">å¹³å‡å¯„ä¸: ${(Object.values(calculationVector).reduce((a, b) => a + b, 0) / Object.keys(calculationVector).length * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                </div>
            `;
            
            explainabilityEl.innerHTML = contributionsHtml;
        }
        
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®å‡¦ç†
        window.addEventListener('DOMContentLoaded', function() {
            console.log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº† - ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹');
            
            // localStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
            const savedDataStr = localStorage.getItem('osAnalysisResult');
            
            if (!savedDataStr) {
                console.error('åˆ†æçµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                showErrorMessage('åˆ†æçµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚OS Analyzerã§åˆ†æã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            try {
                const analysisData = JSON.parse(savedDataStr);
                console.log('å–å¾—ã—ãŸåˆ†æãƒ‡ãƒ¼ã‚¿:', analysisData);
                
                // V3ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿ã‚’å¾…ã¤
                if (typeof HexagramHumanTraitsV3 === 'undefined') {
                    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
                    let retryCount = 0;
                    const maxRetries = 10;
                    const checkInterval = setInterval(() => {
                        retryCount++;
                        if (typeof HexagramHumanTraitsV3 !== 'undefined') {
                            clearInterval(checkInterval);
                            displayTripleOSResults(analysisData);
                        } else if (retryCount >= maxRetries) {
                            clearInterval(checkInterval);
                            console.error('V3ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ');
                            showErrorMessage('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                        }
                    }, 200);
                } else {
                    // ã™ãã«è¡¨ç¤º
                    displayTripleOSResults(analysisData);
                }
                
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—:', error);
                showErrorMessage('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        });
    </script>
</body>
</html>