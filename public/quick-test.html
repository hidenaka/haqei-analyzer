<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Quick Triple OS Test</title>
    <style>
        body { background: #222; color: #fff; font-family: monospace; padding: 20px; }
        button { background: #444; color: #fff; border: 1px solid #666; padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #111; padding: 10px; border: 1px solid #444; overflow: auto; max-height: 400px; }
        .success { color: #0f0; }
        .error { color: #f00; }
    </style>
</head>
<body>
    <h1>ğŸ”¬ Quick Triple OS Test</h1>
    <button onclick="testTripleOS()">Triple OS ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    <button onclick="checkStorage()">LocalStorageç¢ºèª</button>
    <pre id="output"></pre>

    <script>
        function log(msg, type = 'info') {
            const output = document.getElementById('output');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            output.innerHTML += `<span class="${className}">${msg}</span>\n`;
        }

        async function testTripleOS() {
            document.getElementById('output').innerHTML = '';
            log('ğŸš€ Triple OS ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            try {
                // å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‹•çš„ã«èª­ã¿è¾¼ã¿
                await loadScript('js/shared/core/SimpleStorageManager.js');
                await loadScript('js/shared/core/DataManager.js');
                await loadScript('js/os-analyzer/core/TripleOSEngine.js');
                
                log('âœ… ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å®Œäº†');
                
                // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                const dataManager = new DataManager();
                await dataManager.loadAllData();
                log('âœ… DataManageråˆæœŸåŒ–å®Œäº†');
                
                const tripleOSEngine = new TripleOSEngine(dataManager);
                log('âœ… TripleOSEngineåˆæœŸåŒ–å®Œäº†');
                
                // ãƒ†ã‚¹ãƒˆå›ç­”
                const answers = [];
                for (let i = 1; i <= 30; i++) {
                    answers.push({
                        questionId: `q${i}`,
                        selectedChoice: `q${i}a`,
                        choiceText: 'ãƒ†ã‚¹ãƒˆé¸æŠè‚¢',
                        selectedValue: 'A'
                    });
                }
                
                log('ğŸ”„ åˆ†æå®Ÿè¡Œä¸­...');
                const result = await tripleOSEngine.analyzeUser(answers);
                
                log('âœ… åˆ†æå®Œäº†!', 'success');
                log(`Engine OS: ${result?.engineOS ? 'âœ…' : 'âŒ'}`, result?.engineOS ? 'success' : 'error');
                log(`Interface OS: ${result?.interfaceOS ? 'âœ…' : 'âŒ'}`, result?.interfaceOS ? 'success' : 'error');
                log(`SafeMode OS: ${result?.safeModeOS ? 'âœ…' : 'âŒ'}`, result?.safeModeOS ? 'success' : 'error');
                
                // ä¿å­˜ãƒ†ã‚¹ãƒˆ
                const storage = new SimpleStorageManager();
                const saved = storage.saveAnalysisResult(result);
                log(`ä¿å­˜: ${saved ? 'âœ…' : 'âŒ'}`, saved ? 'success' : 'error');
                
            } catch (error) {
                log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function checkStorage() {
            document.getElementById('output').innerHTML = '';
            log('ğŸ’¾ LocalStorageç¢ºèªä¸­...');
            
            const keys = ['haqei_analysis_result', 'haqei_simple_analysis_result'];
            
            keys.forEach(key => {
                const data = localStorage.getItem(key);
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        log(`âœ… ${key}: ã‚ã‚Š`, 'success');
                        log(`  - Engine OS: ${parsed.engineOS ? 'âœ…' : 'âŒ'}`);
                        log(`  - Interface OS: ${parsed.interfaceOS ? 'âœ…' : 'âŒ'}`);
                        log(`  - SafeMode OS: ${parsed.safeModeOS ? 'âœ…' : 'âŒ'}`);
                    } catch (e) {
                        log(`âš ï¸ ${key}: JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼`);
                    }
                } else {
                    log(`âŒ ${key}: ãªã—`, 'error');
                }
            });
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
    </script>
</body>
</html>