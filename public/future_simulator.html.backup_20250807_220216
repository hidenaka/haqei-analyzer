<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    
    <title>HaQei ãƒãƒ«ãƒãƒãƒ¼ã‚¹ãƒ»ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>æ˜“</text></svg>"
    />
    
    
    <!-- Load critical path scripts -->
    <link href="./css/tailwind.css" rel="stylesheet">
    
    
    
    <!-- Quality Enhancement System -->
    <link rel="stylesheet" href="./css/quality-grade-enhancement.css">
    <!-- Future Branching Visual Design System -->
    <link rel="stylesheet" href="./css/future-branching-design.css">
    <!-- ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç¾åœ¨é–‹ç™ºä¸­ã®ãŸã‚ä¸€æ™‚çš„ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ -->
    <!-- <script src="./js/quality-enhancement-ui.js" defer></script> -->
    <!-- <script src="./js/dynamic-quality-optimizer.js" defer></script> -->
    <!-- <script src="./js/quality-integration-manager.js" defer></script> -->
    <!-- <script src="./js/quality-system-validator.js" defer></script> -->
    
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+JP:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Basic Reset and Body Styles for file:// protocol compatibility */
      * {
        box-sizing: border-box;
      }
      
      body {
        margin: 0;
        padding: 0;
        background-color: #0f172a;
        color: #ffffff;
        font-family: "Inter", "Noto Sans JP", sans-serif;
        line-height: 1.6;
        min-height: 100vh;
      }
      
      /* HAQEI Card Styles */
      .haqei-card {
        background-color: #1e293b;
        border: 1px solid #334155;
        border-radius: 0.5rem;
        padding: 1rem;
        margin: 0.5rem 0;
        transition: all 0.3s ease;
      }
      
      .haqei-card:hover {
        border-color: #6366f1;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
      }
      
      /* HAQEI Button Styles */
      .haqei-button,
      button {
        background-color: #2563eb;
        color: #ffffff;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1rem;
        font-weight: 500;
      }
      
      .haqei-button:hover,
      button:hover {
        background-color: #1d4ed8;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      }
      
      /* HAQEI Input Styles */
      .haqei-input,
      input,
      textarea {
        background-color: #334155;
        border: 1px solid #475569;
        color: #ffffff;
        padding: 0.5rem;
        border-radius: 0.5rem;
        width: 100%;
        font-size: 1rem;
        line-height: 1.5;
      }
      
      .haqei-input:focus,
      input:focus,
      textarea:focus {
        outline: none;
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }
      
      /* Container and Layout */
      .max-w-7xl {
        max-width: 80rem;
      }
      
      .mx-auto {
        margin-left: auto;
        margin-right: auto;
      }
      
      .w-full {
        width: 100%;
      }
      
      /* Background Colors */
      .bg-gray-900 {
        background-color: #111827;
      }
      
      .bg-gray-800 {
        background-color: #1f2937;
      }
      
      .bg-gray-700 {
        background-color: #374151;
      }
      
      .bg-teal-600 {
        background-color: #0d9488;
      }
      
      .bg-teal-700 {
        background-color: #0f766e;
      }
      
      /* Text Colors */
      .text-gray-200 {
        color: #e5e7eb;
      }
      
      .text-gray-300 {
        color: #d1d5db;
      }
      
      .text-gray-400 {
        color: #9ca3af;
      }
      
      .text-white {
        color: #ffffff;
      }
      
      .text-indigo-300 {
        color: #a5b4fc;
      }
      
      .text-yellow-300 {
        color: #fde047;
      }
      
      .text-blue-300 {
        color: #93c5fd;
      }
      
      .text-emerald-300 {
        color: #6ee7b7;
      }
      
      /* Padding and Margins */
      .p-4 {
        padding: 1rem;
      }
      
      .p-6 {
        padding: 1.5rem;
      }
      
      .p-8 {
        padding: 2rem;
      }
      
      .py-3 {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
      }
      
      .px-6 {
        padding-left: 1.5rem;
        padding-right: 1.5rem;
      }
      
      .mb-2 {
        margin-bottom: 0.5rem;
      }
      
      .mb-3 {
        margin-bottom: 0.75rem;
      }
      
      .mb-4 {
        margin-bottom: 1rem;
      }
      
      .mb-6 {
        margin-bottom: 1.5rem;
      }
      
      .mb-8 {
        margin-bottom: 2rem;
      }
      
      .mt-2 {
        margin-top: 0.5rem;
      }
      
      /* Border Radius */
      .rounded-lg {
        border-radius: 0.5rem;
      }
      
      .rounded-xl {
        border-radius: 0.75rem;
      }
      
      .rounded-2xl {
        border-radius: 1rem;
      }
      
      /* Shadows */
      .shadow-2xl {
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      }
      
      /* Flexbox */
      .flex {
        display: flex;
      }
      
      .items-center {
        align-items: center;
      }
      
      .justify-center {
        justify-content: center;
      }
      
      .gap-2 {
        gap: 0.5rem;
      }
      
      /* Grid */
      .grid {
        display: grid;
      }
      
      .grid-cols-1 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
      
      .grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      
      .grid-cols-4 {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
      
      .gap-4 {
        gap: 1rem;
      }
      
      .gap-8 {
        gap: 2rem;
      }
      
      /* Typography */
      .text-sm {
        font-size: 0.875rem;
      }
      
      .text-base {
        font-size: 1rem;
      }
      
      .text-lg {
        font-size: 1.125rem;
      }
      
      .text-xl {
        font-size: 1.25rem;
      }
      
      .text-2xl {
        font-size: 1.5rem;
      }
      
      .text-3xl {
        font-size: 1.875rem;
      }
      
      .text-4xl {
        font-size: 2.25rem;
      }
      
      .font-bold {
        font-weight: 700;
      }
      
      .font-semibold {
        font-weight: 600;
      }
      
      .text-center {
        text-align: center;
      }
      
      /* Positioning */
      .relative {
        position: relative;
      }
      
      .absolute {
        position: absolute;
      }
      
      .fixed {
        position: fixed;
      }
      
      .top-0 {
        top: 0;
      }
      
      .right-0 {
        right: 0;
      }
      
      .left-0 {
        left: 0;
      }
      
      .bottom-0 {
        bottom: 0;
      }
      
      /* Display */
      .hidden {
        display: none;
      }
      
      .block {
        display: block;
      }
      
      /* Opacity */
      .opacity-0 {
        opacity: 0;
      }
      
      .opacity-50 {
        opacity: 0.5;
      }
      
      /* Transitions */
      .transition {
        transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 150ms;
      }
      
      .duration-300 {
        transition-duration: 300ms;
      }
      
      /* Animation keyframes */
      .animate-spin {
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      
      /* Card hover effects */
      .card {
        transition: all 0.3s ease-in-out;
        cursor: pointer;
      }
      
      .card:hover {
        transform: scale(1.03);
        box-shadow: 0 0 30px rgba(165, 180, 252, 0.4);
      }
      
      /* Gradients */
      .bg-gradient-to-br {
        background-image: linear-gradient(to bottom right, var(--tw-gradient-stops));
      }
      
      .from-blue-900\/20 {
        --tw-gradient-from: rgba(30, 58, 138, 0.2);
        --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(30, 58, 138, 0));
      }
      
      .to-indigo-900\/20 {
        --tw-gradient-to: rgba(49, 46, 129, 0.2);
      }
      
      .from-emerald-900\/20 {
        --tw-gradient-from: rgba(6, 78, 59, 0.2);
        --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(6, 78, 59, 0));
      }
      
      .to-teal-900\/20 {
        --tw-gradient-to: rgba(19, 78, 74, 0.2);
      }
      
      /* Border styles */
      .border {
        border-width: 1px;
      }
      
      .border-gray-600 {
        border-color: #4b5563;
      }
      
      .border-gray-700 {
        border-color: #374151;
      }
      
      .border-blue-500\/30 {
        border-color: rgba(59, 130, 246, 0.3);
      }
      
      .border-emerald-500\/30 {
        border-color: rgba(16, 185, 129, 0.3);
      }
      
      .hover\:border-blue-400:hover {
        border-color: #60a5fa;
      }
      
      .hover\:border-emerald-400:hover {
        border-color: #34d399;
      }
      
      /* Responsive design */
      @media (max-width: 640px) {
        .sm\:p-6 {
          padding: 1.5rem;
        }
        
        .sm\:text-4xl {
          font-size: 2.25rem;
        }
        
        .sm\:grid-cols-2 {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }
      
      @media (min-width: 1024px) {
        .lg\:col-span-1 {
          grid-column: span 1 / span 1;
        }
        
        .lg\:col-span-2 {
          grid-column: span 2 / span 2;
        }
        
        .lg\:grid-cols-3 {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
        
        .lg\:grid-cols-4 {
          grid-template-columns: repeat(4, minmax(0, 1fr));
        }
      }
      
      /* Specific component styles */
      .tracking-wider {
        letter-spacing: 0.05em;
      }
      
      .inline-block {
        display: inline-block;
      }
      
      .space-y-4 > * + * {
        margin-top: 1rem;
      }
      
      .space-y-3 > * + * {
        margin-top: 0.75rem;
      }
      
      /* SVG icon sizing */
      .h-6 {
        height: 1.5rem;
      }
      
      .w-6 {
        width: 1.5rem;
      }
      
      .h-5 {
        height: 1.25rem;
      }
      
      .w-5 {
        width: 1.25rem;
      }
      
      .h-4 {
        height: 1rem;
      }
      
      .w-4 {
        width: 1rem;
      }
      
      /* Focus styles */
      .focus\:ring-indigo-500:focus {
        --tw-ring-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }
      
      .focus\:border-indigo-500:focus {
        border-color: #6366f1;
      }
      
      /* Utility classes */
      .min-h-screen {
        min-height: 100vh;
      }
      
      .items-start {
        align-items: flex-start;
      }
      
      /* Text truncation */
      .truncate {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      
      /* Background opacity utilities */
      .bg-gray-900\/50 {
        background-color: rgba(17, 24, 39, 0.5);
      }
      
      .bg-gray-900\/30 {
        background-color: rgba(17, 24, 39, 0.3);
      }
      
      .bg-gray-800\/50 {
        background-color: rgba(31, 41, 55, 0.5);
      }
      
      /* Border opacity utilities */
      .border-gray-600\/50 {
        border-color: rgba(75, 85, 99, 0.5);
      }
      
      .border-gray-700\/50 {
        border-color: rgba(55, 65, 81, 0.5);
      }
      
      /* Backdrop utilities for loading screen */
      .backdrop-filter {
        backdrop-filter: blur(10px);
      }
      
      /* Z-index utilities */
      .z-50 {
        z-index: 50;
      }
      
      .z-1000 {
        z-index: 1000;
      }
      
      .z-9999 {
        z-index: 9999;
      }
      
      /* Flex utilities */
      .flex-wrap {
        flex-wrap: wrap;
      }
      
      .gap-3 {
        gap: 0.75rem;
      }
      
      /* Hover effects for buttons */
      .hover\:bg-teal-700:hover {
        background-color: #0f766e;
      }
      
      .hover\:text-white:hover {
        color: #ffffff;
      }
      
      /* Transform utilities */
      .transform {
        transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));
      }
      
      .-translate-x-1\/2 {
        --tw-translate-x: -50%;
      }
      
      .translate-x-1\/2 {
        --tw-translate-x: 50%;
      }
      
      /* Additional specific styles for the application */
      .brand-text {
        background: linear-gradient(45deg, #a5b4fc, #e0e7ff);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        color: transparent;
      }
      
      /* Additional HAQEI component styles */
      
      /* Enhanced Progressive Loading Styles */
      .skeleton {
        background: linear-gradient(90deg, rgba(55, 65, 81, 0.1) 25%, rgba(75, 85, 99, 0.2) 37%, rgba(55, 65, 81, 0.1) 63%);
        background-size: 400% 100%;
        animation: skeleton-loading 1.5s ease-in-out infinite;
      }
      
      @keyframes skeleton-loading {
        0% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      
      .skeleton-text {
        height: 1em;
        border-radius: 4px;
        margin: 0.5em 0;
      }
      
      .skeleton-button {
        height: 3em;
        border-radius: 8px;
        width: 100%;
      }
      
      .skeleton-card {
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1rem 0;
      }
      
      .skeleton-chart {
        height: 300px;
        border-radius: 8px;
      }
      
      .fade-in {
        animation: fadeIn 0.6s ease-in-out;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(17, 24, 39, 0.95);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.3s ease;
        backdrop-filter: blur(10px);
      }
      
      .loading-content {
        text-align: center;
        max-width: 400px;
        padding: 2rem;
        background: rgba(30, 41, 59, 0.8);
        border-radius: 16px;
        border: 1px solid rgba(99, 102, 241, 0.3);
      }
      
      .loading-spinner {
        width: 48px;
        height: 48px;
        border: 4px solid rgba(165, 180, 252, 0.3);
        border-left: 4px solid #a5b4fc;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }
      
      .loading-text {
        color: #a5b4fc;
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 1rem;
      }
      
      .progress-container {
        margin-top: 1rem;
      }
      
      .progress-bar {
        width: 100%;
        height: 8px;
        background: rgba(55, 65, 81, 0.5);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 0.5rem;
      }
      
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #6366f1, #a855f7);
        border-radius: 4px;
        transition: width 0.3s ease;
        position: relative;
      }
      
      .progress-percentage {
        color: #cbd5e1;
        font-size: 0.875rem;
        text-align: center;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* Enhanced Mobile Optimizations */
      @media (max-width: 768px) {
        .loading-content {
          margin: 1rem;
          padding: 1.5rem;
        }
        
        .loading-text {
          font-size: 1rem;
        }
      }
      
      /* Accessibility Enhancements */
      @media (prefers-reduced-motion: reduce) {
        .skeleton {
          animation: none;
        }
        
        .loading-spinner {
          animation: none;
          border-left-color: rgba(165, 180, 252, 0.8);
        }
        
        .fade-in {
          animation: none;
        }
      }
      
      .brand-text {
        background: -webkit-linear-gradient(45deg, #a5b4fc, #e0e7ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      
      .card {
        transition: all 0.3s ease-in-out;
        cursor: pointer;
      }
      .card:hover,
      .card.highlighted {
        transform: scale(1.03);
        box-shadow: 0 0 30px rgba(165, 180, 252, 0.4);
      }
      .rank-badge {
        font-size: 0.75rem;
        font-weight: bold;
        padding: 2px 8px;
        border-radius: 9999px;
        line-height: 1;
      }
      .rank-s,
      .rank-a,
      .rank-b,
      .rank-c {
        background-color: rgba(74, 222, 128, 0.2);
        color: #86efac;
        border: 1px solid #22c55e;
      }
      .rank-d {
        background-color: rgba(251, 191, 36, 0.2);
        color: #fcd34d;
        border: 1px solid #fbbf24;
      }
      .rank-e,
      .rank-f,
      .rank-g {
        background-color: rgba(248, 113, 113, 0.2);
        color: #fca5a5;
        border: 1px solid #f87171;
      }
      .rank-h {
        background-color: rgba(185, 28, 28, 0.2);
        color: #fca5a5;
        border: 1px solid #dc2626;
      }

      /* Data Export Styles removed as per user request */
      
      .progressive-load {
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.6s ease;
      }
      
      .progressive-load.loaded {
        opacity: 1;
        transform: translateY(0);
      }

      /* ğŸŒŸ New Result Page Styles (2025-08-07 Renewal) */
      .result-container {
        padding: 2rem;
        background: #1a1f2e;
        min-height: 100vh;
      }
      
      .result-layout {
        display: grid;
        grid-template-columns: 30% 70%;
        gap: 2rem;
        max-width: 1400px;
        margin: 0 auto;
      }
      
      /* Left Panel Styles */
      .analysis-summary-panel {
        background: #2d3748;
        border-radius: 12px;
        padding: 1.5rem;
        color: #f7fafc;
      }
      
      .current-position-card {
        background: rgba(45, 55, 72, 0.5);
        border: 2px solid #ffd700;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1.5rem;
      }
      
      .hexagram-highlight {
        color: #ffd700;
        font-weight: bold;
      }
      
      .panel-title {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: #cbd5e0;
      }
      
      .theme-description {
        margin-top: 0.5rem;
      }
      
      .theme-description p {
        margin: 0.5rem 0;
        font-size: 0.9rem;
        line-height: 1.5;
      }
      
      .theme-detail {
        color: #a0aec0;
        font-size: 0.85rem;
      }
      
      /* Score Display */
      .score-display {
        margin: 1.5rem 0;
      }
      
      .score-item {
        background: rgba(45, 55, 72, 0.3);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .score-item label {
        display: block;
        font-size: 0.9rem;
        color: #a0aec0;
        margin-bottom: 0.5rem;
      }
      
      .score-value {
        display: flex;
        align-items: baseline;
        gap: 0.5rem;
      }
      
      .score-number {
        font-size: 2rem;
        font-weight: bold;
        color: #f7fafc;
      }
      
      .score-label {
        font-size: 1rem;
        color: #cbd5e0;
      }
      
      .score-note {
        font-size: 0.8rem;
        color: #718096;
        margin-top: 0.5rem;
      }
      
      /* Current Graph */
      .current-graph-container {
        margin: 1.5rem 0;
      }
      
      .current-graph-container h4 {
        font-size: 1rem;
        margin-bottom: 1rem;
        color: #cbd5e0;
      }
      
      /* I Ching Interpretation */
      .iching-interpretation {
        background: rgba(45, 55, 72, 0.3);
        border-radius: 8px;
        padding: 1rem;
        margin-top: 1.5rem;
      }
      
      .iching-interpretation h4 {
        font-size: 0.9rem;
        color: #ffd700;
        margin-bottom: 1rem;
      }
      
      .interpretation-content {
        font-size: 0.85rem;
        line-height: 1.6;
        color: #cbd5e0;
      }
      
      .stage-title {
        font-weight: bold;
        color: #f7fafc;
        margin-bottom: 0.5rem;
      }
      
      .stage-advice {
        margin-top: 0.75rem;
        padding: 0.5rem 0.75rem;
        background-color: rgba(99, 102, 241, 0.1);
        border-left: 3px solid #6366f1;
        color: #e0e7ff;
        font-size: 0.9rem;
        border-radius: 0.25rem;
      }
      
      /* Right Area Styles */
      .detailed-results-area {
        background: #2d3748;
        border-radius: 12px;
        padding: 1.5rem;
      }
      
      .section-title {
        font-size: 1.2rem;
        color: #e2e8f0;
        margin-bottom: 1rem;
      }
      
      /* Future Branching Graph */
      .future-branching-graph {
        margin-bottom: 2rem;
      }
      
      .graph-container {
        background: rgba(26, 31, 46, 0.5);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      /* Theme Boxes */
      .theme-boxes {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 2rem;
      }
      
      .theme-box {
        border-radius: 8px;
        padding: 1rem;
      }
      
      .progress-theme {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
        border: 1px solid #10b981;
      }
      
      .change-theme {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.1));
        border: 1px solid #8b5cf6;
      }
      
      .theme-box h4 {
        color: #f7fafc;
        font-size: 1rem;
        margin-bottom: 0.5rem;
      }
      
      .theme-content {
        font-size: 0.85rem;
        line-height: 1.5;
        color: #cbd5e0;
      }
      
      /* Eight Scenarios Grid */
      .eight-scenarios-grid {
        margin-top: 2rem;
      }
      
      .scenarios-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 1rem;
      }
      
      .scenario-card-new {
        background: rgba(45, 55, 72, 0.5);
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 8px;
        padding: 1rem;
        transition: all 0.3s ease;
      }
      
      .scenario-card-new:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }
      
      .scenario-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      }
      
      .scenario-rank {
        font-size: 1.5rem;
        font-weight: bold;
      }
      
      .rank-s { color: #ffd700; }
      .rank-a { color: #10b981; }
      .rank-b { color: #3b82f6; }
      .rank-c { color: #f59e0b; }
      .rank-d { color: #ef4444; }
      .rank-e { color: #8b5cf6; }
      .rank-f { color: #6b7280; }
      
      .scenario-score {
        font-size: 1.2rem;
        font-weight: bold;
        color: #f7fafc;
      }
      
      .scenario-name {
        font-size: 0.9rem;
        color: #cbd5e0;
        margin: 0.5rem 0;
      }
      
      .scenario-steps {
        font-size: 0.8rem;
        color: #a0aec0;
        margin: 0.5rem 0;
      }
      
      .scenario-mini-graph {
        margin-top: 0.5rem;
        height: 40px;
      }
      
      /* Responsive Design */
      @media (max-width: 1024px) {
        .result-layout {
          grid-template-columns: 1fr;
        }
        
        .scenarios-grid {
          grid-template-columns: repeat(2, 1fr);
          grid-template-rows: repeat(4, 1fr);
        }
      }
      
      @media (max-width: 640px) {
        .theme-boxes {
          grid-template-columns: 1fr;
        }
        
        .scenarios-grid {
          grid-template-columns: 1fr;
        }
      }
      
      /* ğŸŒŸ Authentic I Ching System Styles */
      .authentic-scenarios-container,
      .authentic-choice-container,
      .current-position-container {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(99, 102, 241, 0.1));
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1rem 0;
      }

      .scenario-card, .choice-card {
        background: rgba(17, 24, 39, 0.8);
        border: 1px solid rgba(75, 85, 99, 0.5);
        border-radius: 8px;
        padding: 1.5rem;
        margin: 1rem 0;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .scenario-card:hover, .choice-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        border-color: rgba(99, 102, 241, 0.7);
      }

      .scenario-card.selected, .choice-card.selected {
        border-color: #6366f1;
        background: rgba(99, 102, 241, 0.2);
      }

      .hexagram-line {
        display: flex;
        align-items: center;
        margin: 0.25rem 0;
        font-family: monospace;
      }

      .hexagram-line.yang .line-symbol {
        color: #fbbf24;
      }

      .hexagram-line.yin .line-symbol {
        color: #93c5fd;
      }

      .hexagram-line.current {
        background: rgba(245, 101, 101, 0.2);
        border-radius: 4px;
        padding: 0.25rem;
      }

      .transformation-visual {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 1rem 0;
      }

      .transformation-arrow {
        font-size: 1.5rem;
        color: #6366f1;
        margin: 0 1rem;
      }

      .HaQei-analysis .persona-analysis {
        background: rgba(31, 41, 55, 0.5);
        border-radius: 8px;
        padding: 1rem;
        margin: 0.5rem 0;
      }

      .fade-in {
        opacity: 0;
        animation: fadeInUp 0.6s ease forwards;
      }

      .fade-in.visible {
        opacity: 1;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      /* Phase 6-10 Enhancement Styles */
      .choice-selected {
        border-color: #10b981 !important;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.3)) !important;
        transform: scale(1.02) !important;
      }
      
      .animate-fade-in {
        animation: fadeIn 0.3s ease-in-out;
      }
      
      .animate-slide-up {
        animation: slideUp 0.3s ease-out;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      
      @keyframes slideUp {
        from { 
          opacity: 0; 
          transform: translate(-50%, 20px); 
        }
        to { 
          opacity: 1; 
          transform: translate(-50%, 0); 
        }
      }
      
      #char-counter {
        transition: color 0.3s ease;
      }
      
      .export-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
      }
      
      .export-button:active {
        transform: translateY(0);
      }
      
      /* Input validation styles */
      .input-valid {
        border-color: #10b981;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
      }
      
      .input-invalid {
        border-color: #ef4444;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
      }
      
      /* Loading state improvements */
      .loading button {
        pointer-events: none;
        opacity: 0.7;
      }
      
      /* Scenario generation animations */
      .scenario-card {
        transition: all 0.3s ease;
      }
      
      .scenario-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 32px rgba(99, 102, 241, 0.2);
      }
      
      /* Progress indicators */
      .progress-indicator {
        width: 100%;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        overflow: hidden;
      }
      
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #6366f1, #8b5cf6, #06b6d4);
        border-radius: 2px;
        transition: width 0.3s ease;
      }
    </style>
    
    <!-- Core System Assets - æœ€é©åŒ–èª­ã¿è¾¼ã¿é †åº -->
    <script src="./assets/H384H64database.js"></script>
    <script src="./js/core/H384DatabaseConnector.js"></script>
    <script src="./js/core/IChingChoiceLogic.js"></script>
    <script src="./js/core/DynamicScenarioColorSystem.js"></script>
    <script src="./js/core/IChingGuidanceEngine.js"></script>
    <script src="./js/components/ThreeStageVisualizer.js"></script>
    <script src="./js/components/EightScenariosDisplay.js"></script>
    <script src="./js/components/ResultPageController.js"></script>
    <script src="./js/future-simulator-integration.js"></script>
    <script src="./js/core/PerformanceOptimizer.js"></script>
    <script src="./js/core/IChingTransformationEngine.js"></script>
    <script src="./js/core/FutureBranchingSystem.js"></script>
    <script src="./js/core/DataPersistenceManager.js"></script>
    <script src="./js/core/DataExportAPI.js"></script>
    
    <!-- H384_DATAèª­ã¿è¾¼ã¿é †åºç¢ºèª -->
    <script>
        (function() {
            console.log('ğŸ” H384_DATAèª­ã¿è¾¼ã¿é †åºç¢ºèªã‚’é–‹å§‹...');
            
            if (typeof H384_DATA === 'undefined') {
                console.error('âŒ H384_DATAå¤‰æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                console.warn('âš ï¸  ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã‚’è©¦è¡Œä¸­...');
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: window.H384_DATAã‚’ç¢ºèª
                if (typeof window.H384_DATA !== 'undefined') {
                    console.log('âœ… window.H384_DATAã‹ã‚‰ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆåŠŸ');
                    window.H384_DATA = window.H384_DATA;
                } else {
                    console.error('âŒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã‚‚åˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
            } else {
                console.log('âœ… H384_DATAå¤‰æ•°ã®å­˜åœ¨ç¢ºèª: æˆåŠŸ');
                
                // window.H384_DATAã¸ã®ä»£å…¥ç¢ºèª
                if (typeof window.H384_DATA === 'undefined') {
                    console.warn('âš ï¸  window.H384_DATAãŒæœªè¨­å®š - è‡ªå‹•è¨­å®šã‚’è©¦è¡Œ');
                    try {
                        window.H384_DATA = H384_DATA;
                        console.log('âœ… window.H384_DATAè‡ªå‹•è¨­å®š: æˆåŠŸ');
                    } catch (error) {
                        console.error('âŒ window.H384_DATAè¨­å®šã‚¨ãƒ©ãƒ¼:', error);
                    }
                }
                
                // ãƒ‡ãƒ¼ã‚¿å®Œå…¨æ€§ã®åŸºæœ¬ç¢ºèª
                if (Array.isArray(window.H384_DATA) && window.H384_DATA.length === 386) {
                    console.log('âœ… H384_DATAãƒ‡ãƒ¼ã‚¿å®Œå…¨æ€§ç¢ºèª: æˆåŠŸ (386ã‚¨ãƒ³ãƒˆãƒª)');
                    
                    // ç”¨ä¹ãƒ»ç”¨å…­ã‚¨ãƒ³ãƒˆãƒªã®ç¢ºèª
                    const youkuu = window.H384_DATA.find(item => item['é€šã—ç•ªå·'] === 7);
                    const yourikuu = window.H384_DATA.find(item => item['é€šã—ç•ªå·'] === 14);
                    
                    if (youkuu && yourikuu) {
                        console.log('âœ… ç”¨ä¹ãƒ»ç”¨å…­ã‚¨ãƒ³ãƒˆãƒªç¢ºèª: æˆåŠŸ');
                        console.log(`   - ç”¨ä¹: ${youkuu['å¦å']} (${youkuu['çˆ»']})`);
                        console.log(`   - ç”¨å…­: ${yourikuu['å¦å']} (${yourikuu['çˆ»']})`);
                    } else {
                        console.warn('âš ï¸  ç”¨ä¹ãƒ»ç”¨å…­ã‚¨ãƒ³ãƒˆãƒªã«å•é¡ŒãŒã‚ã‚Šã¾ã™');
                    }
                } else {
                    console.error('âŒ H384_DATAãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚¨ãƒ©ãƒ¼:', {
                        isArray: Array.isArray(window.H384_DATA),
                        length: window.H384_DATA?.length
                    });
                }
            }
            
            console.log('ğŸ H384_DATAèª­ã¿è¾¼ã¿é †åºç¢ºèªå®Œäº†');
        })();
    </script>
    <script src="./js/keyword_expansion_engine.js"></script>
    <script src="./js/ml-integration.js" async defer></script>
    <!-- Offline-First Dictionary System -->
    <script src="./js/core/DictionaryManager.js" defer></script>
    <script src="./js/core/OfflineDetector.js" defer></script>
    <script src="./js/core/OfflineKuromojiInitializer.js" defer></script>
    <script src="./js/core/offline-kuromoji-integration.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/build/kuromoji.js" defer></script>
    <!-- Advanced Analysis Dependencies -->
    <!-- ğŸš¨ CRITICAL FIX: Chart.js Library Loading -->
    <script src="./js/lib/chart.min.js"></script>
    <script src="./js/lib/chartjs-plugin-annotation.min.js"></script>
    <script src="./js/lib/ml-matrix.min.js"></script>
    <!-- Dynamic Analysis Components -->
    <script src="./js/pages/future-simulator/DynamicKeywordGenerator.js"></script>
    <script src="./js/pages/future-simulator/IntegratedAnalysisEngine.js"></script>
    <script src="./js/pages/future-simulator/MultiDimensionalContextAnalyzer.js"></script>
    <script src="./js/pages/future-simulator/SituationalContextEngine.js"></script>
    <script src="./js/pages/future-simulator/HexagramMappingEngine.js"></script>
    <script src="./js/pages/future-simulator/MetaphorGenerationEngine.js"></script>
    
    <!-- ğŸŒŸ Authentic I Ching System Components -->
    <script src="./js/core/AuthenticIChingEngine.js"></script>
    <script src="./js/components/CurrentPositionDisplay.js"></script>
    <script src="./js/components/AuthenticChoiceSystem.js"></script>
    <script src="./js/components/Authentic8ScenariosSystem.js"></script>
    
    <!-- I Ching Integration System -->
    <script src="./js/iching-situation-analyzer.js"></script>
    <script src="./js/yao-transformation-simulator.js"></script>
    <script src="./js/iching-metaphor-display.js"></script>
    <script src="./js/iching-future-simulator.js"></script>
    
    <!-- Global I Ching Simulator Factory -->
    <script>
      function getIChingSimulator() {
        if (window.ichingSimulator && window.ichingSimulator.isReady && window.ichingSimulator.isReady()) {
          return window.ichingSimulator;
        }
        return null;
      }
      window.getIChingSimulator = getIChingSimulator;
    </script>
    
    <!-- Future Simulator Core & Binary Tree System -->
    <script src="./js/future-simulator-core.js"></script>
    <script src="./js/core/BinaryTreeFutureEngine.js"></script>
    <script src="./js/binary-tree-complete-display.js"></script>
    
    <!-- ç·Šæ€¥ä¿®æ­£: 8ã‚·ãƒŠãƒªã‚ªãƒ»Binary Treeçµ±åˆã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="./js/pages/future-simulator/EightScenariosGenerator.js"></script>
    <script src="./js/pages/future-simulator/ScenariosDisplayUI.js"></script>
    
    <!-- Future Simulator UI Enhancement System -->
    <script src="./js/future-simulator-ui-enhancements.js" defer></script>
  </head>
  <body class="bg-gray-900 text-gray-200 min-h-screen p-4 sm:p-6" data-progressive-load>
    <!-- Loading Screen Completely Removed -->
    
    <div
      class="w-full max-w-7xl mx-auto bg-gray-800 shadow-2xl rounded-2xl p-6 sm:p-8"
      id="main-container"
      style="opacity: 1;"
    >
      <header class="text-center mb-8 relative">
        <a href="./" class="inline-block">
          <h1 class="text-3xl sm:text-4xl font-bold brand-text tracking-wider">
            HaQei
          </h1>
          <p class="text-gray-400 mt-2 text-lg">ãƒãƒ«ãƒãƒãƒ¼ã‚¹ãƒ»ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼</p>
        </a>
        <button
          id="helpBtn"
          class="absolute top-0 right-0 p-2 text-gray-400 hover:text-white transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.79 4 4 0 .863-.27 1.66-.744 2.25l-2.536 2.39c-.832.786-1.464 1.49-1.464 2.36h.001M12 18h.01"
            />
          </svg>
        </button>
      </header>

      <!-- Input Section with Skeleton -->      
      <div class="bg-gray-900/50 p-6 rounded-xl mb-4 relative progressive-load" id="input-section">
        <!-- Skeleton for Input Section -->
        <div class="skeleton-input" id="input-skeleton">
          <div class="skeleton skeleton-text" style="width: 60%; height: 1.5rem; margin-bottom: 1rem;"></div>
          <div class="skeleton skeleton-card">
            <div class="skeleton skeleton-text" style="width: 100%; margin-bottom: 0.5rem;"></div>
            <div class="skeleton skeleton-text" style="width: 80%; margin-bottom: 0.5rem;"></div>
            <div class="skeleton skeleton-text" style="width: 90%;"></div>
          </div>
          <div class="skeleton skeleton-text" style="width: 100%; height: 4rem; margin: 1rem 0;"></div>
          <div class="skeleton skeleton-button"></div>
        </div>
        
        <!-- Actual Input Content -->
        <div class="input-content" id="input-content" style="display: block;">
          <h2 class="text-lg font-bold text-indigo-300 mb-3">
            1. AIã«ã‚ˆã‚‹çŠ¶æ³æ¨æ¸¬
          </h2>
        <div
          class="border border-gray-700 rounded-lg p-4 mb-4 text-sm text-gray-300 space-y-3"
        >
          <p class="text-base font-bold text-center text-indigo-300">
            AIã¸ã®æœ€é«˜ã®ã€Œå‘ªæ–‡ã€ã¯ã€ã‚ãªãŸã®ã€Œã‚ã‚Šã®ã¾ã¾ã®è¨€è‘‰ã€ã§ã™
          </p>
          <p class="text-xs text-center text-gray-400">
            æœªæ¥åˆ†å²å›³ã®ç²¾åº¦ã‚’é«˜ã‚ã‚‹ã€ãŸã£ãŸä¸€ã¤ã®ç§˜è¨£
          </p>
          <p>
            ã“ã‚Œã‹ã‚‰ã€ã‚ãªãŸã®ç¾çŠ¶ã¨èª²é¡Œã‚’AIã«å…¥åŠ›ã—ã¦ã„ãŸã ãã¾ã™ã€‚ãã®éš›ã€ã©ã†ã‹<strong>ã€Œä¸Šæ‰‹ãªæ–‡ç« ã‚’æ›¸ã“ã†ã€ã¨ã—ãªã„ã§ãã ã•ã„ã€‚</strong>AIã¯ã€æ•´ãˆã‚‰ã‚ŒãŸæ–‡ç« ã‚ˆã‚Šã‚‚ã€ã‚ãªãŸã®<strong>ã€Œç”Ÿã®è¨€è‘‰ã€</strong>ã‚’æ±‚ã‚ã¦ã„ã¾ã™ã€‚
          </p>
          <p>
            ç®‡æ¡æ›¸ãã§ã‚‚ã€å¿ƒã®ã¤ã¶ã‚„ãã§ã‚‚ã€èª°ã‹ã«æ„šç—´ã‚’ã“ã¼ã™ã‚ˆã†ãªè¨€è‘‰ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚ä»–äººã«è¦‹ã›ã‚‹ãŸã‚ã®æ–‡ç« ã§ã¯ãªãã€<strong>ã‚ãªãŸè‡ªèº«ã®ãŸã‚ã®ã€Œæ€è€ƒã®ãƒ¡ãƒ¢ã€</strong>ã¨ã—ã¦ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
          </p>
          <p>
            ãªãœãªã‚‰ã€AIã¯ã‚ãªãŸãŒé¸ã¶ä¸€ã¤ä¸€ã¤ã®å˜èªã€è¡¨ç¾ã®æºã‚Œã€æ„Ÿæƒ…ã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã‹ã‚‰ã€ã‚ãªãŸã ã‘ã®ã€Œæ€è€ƒã®ã‚¯ã‚»ã€ã‚„ã€Œå¿ƒã®å‹•ãã€ã‚’èª­ã¿å–ã‚‹ã‹ã‚‰ã§ã™ã€‚
          </p>
          <div class="pt-2">
            <p class="font-bold text-gray-200">ã€å…¥åŠ›ã®ãƒ’ãƒ³ãƒˆã€‘</p>
            <div
              class="mt-2 p-3 rounded-lg bg-red-900/20 border border-red-800/50"
            >
              <p class="font-bold">æ‚ªã„ä¾‹ âŒ</p>
              <p class="text-xs italic mt-1">
                ã€Œæ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã«ãŠã„ã¦ã€äººçš„ãƒªã‚½ãƒ¼ã‚¹ã®ä¸è¶³ãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¨ãªã‚Šã€è¨ˆç”»ã«é…å»¶ãŒç”Ÿã˜ã¦ã„ã¾ã™ã€‚ã€
              </p>
              <p class="text-xs text-gray-400 mt-1">
                ï¼ˆã“ã‚Œã§ã¯ã€AIã¯ä¸€èˆ¬çš„ãªãƒ“ã‚¸ãƒã‚¹èª²é¡Œã¨ã—ã¦ã—ã‹åˆ†æã§ãã¾ã›ã‚“ï¼‰
              </p>
            </div>
            <div
              class="mt-2 p-3 rounded-lg bg-emerald-900/20 border border-emerald-800/50"
            >
              <p class="font-bold">è‰¯ã„ä¾‹ â­•</p>
              <p class="text-xs italic mt-1">
                ã€Œæ–°ã—ã„ä»•äº‹ã€ãƒã‚¸ã§äººè¶³ã‚Šã¦ãªã„ï¼Aã•ã‚“ã¯é ‘å¼µã£ã¦ãã‚Œã¦ã‚‹ã‘ã©ã€Bã•ã‚“ã¯å…¨ç„¶ã‚„ã‚‹æ°—ãªã„ã—â€¦ã€‚ã“ã®ã¾ã¾ã ã¨çµ¶å¯¾é–“ã«åˆã‚ãªã„ã€‚ã©ã†ã™ã‚Šã‚ƒã„ã„ã‚“ã â€¦ã€‚ç„¦ã‚‹ã€‚ã€
              </p>
              <p class="text-xs text-gray-400 mt-1">
                ï¼ˆã“ã®æ–¹ãŒã€ã‚ãªãŸã®æ„Ÿæƒ…ã€äººé–“é–¢ä¿‚ã¸ã®èªè­˜ã€åˆ‡è¿«æ„ŸãŒä¼ã‚ã‚Šã€ã‚ˆã‚Šãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸåˆ†æãŒå¯èƒ½ã«ãªã‚Šã¾ã™ï¼‰
              </p>
            </div>
          </div>
          <p class="font-bold text-center pt-2">
            ã‚ãªãŸã®ã€Œã‚ã‚Šã®ã¾ã¾ã®è¨€è‘‰ã€ã“ããŒã€ã‚ãªãŸã ã‘ã®æœªæ¥ã‚’èª­ã¿è§£ãã€æœ€ã‚‚å¼·åŠ›ãªéµã¨ãªã‚Šã¾ã™ã€‚<br />ã©ã†ãã€ã‚ãªãŸã®å¿ƒã‚’ãã®ã¾ã¾ã€AIã«ã¶ã¤ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚
          </p>
        </div>
        
        <!-- ã‚ãªãŸã®æœªæ¥ã‚’èª­ã¿è§£ãã¾ã™ -->
        <div class="mb-6 text-center">
          <h3 class="text-xl font-bold text-indigo-300 mb-2">
            âœ¨ ã‚ãªãŸã®æœªæ¥ã‚’èª­ã¿è§£ãã¾ã™
          </h3>
          <p class="text-sm text-gray-400">
            å¤å…¸æ˜“çµŒã®æ™ºæ…§ã§ã€8ã¤ã®å¯èƒ½æ€§ã‚’æ¢ã£ã¦ã¿ã¾ã—ã‚‡ã†
          </p>
        </div>
        
        <textarea
          id="worryInput"
          class="bg-gray-700 border border-gray-600 text-white text-base rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-3 mb-4"
          rows="4"
          placeholder="ã“ã“ã«ã‚ãªãŸã®ã€Œç”Ÿã®è¨€è‘‰ã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."
        ></textarea>
        <button
            id="aiGuessBtn"
            class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition duration-300 flex items-center justify-center gap-2"
          >
            <svg class="animate-spin h-5 w-5 text-white hidden" id="loadingSpinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <svg
              id="originalIcon"
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"
                clip-rule="evenodd"
              />
            </svg>
            <span id="buttonText">åˆ†æå®Ÿè¡Œ</span>
          </button>
        </div>
      </div>

      <!-- I Ching Integrated Future Simulator -->
      <div class="progressive-load" id="iching-simulator-section" style="display: none;">
        <div class="bg-gray-900/50 p-6 rounded-xl mb-4">
          <h2 class="text-xl font-bold text-indigo-300 mb-4 text-center">
            ğŸ”® æ˜“çµŒçµ±åˆæœªæ¥ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
          </h2>
          <p class="text-gray-400 text-center mb-6">
            æ˜“çµŒã®çŸ¥æµã¨AIæŠ€è¡“ã‚’çµ„ã¿åˆã‚ã›ãŸã€ã‚ˆã‚Šæ·±ã„æœªæ¥æ´å¯Ÿã‚·ã‚¹ãƒ†ãƒ 
          </p>
          
          <!-- I Ching Metaphor Display Container -->
          <div id="iching-metaphor-container">
            <!-- I Ching system will be initialized here -->
          </div>
          
          <!-- Future Branching Integration -->
          <div id="future-branching-container" style="margin-top: 2rem;">
            <!-- Future branching visualizer will appear here after transformation -->
          </div>
        </div>
      </div>

      <!-- Data Export Section removed as per user request -->

      <!-- æ—§ç‰ˆUIå®Œå…¨å‰Šé™¤å®Œäº† (2025-08-07) -->
      
      <!-- New Results Section (2025-08-07 Renewal) -->
      <div id="resultArea" class="result-container" style="display: none;">
        <!-- 2-Column Layout -->
        <div class="result-layout">
          <!-- Left Panel: Analysis Summary (30%) -->
          <div class="analysis-summary-panel">
            <!-- Current Position Card -->
            <div class="current-position-card">
              <h3 class="panel-title">ç¾åœ¨åœ°ï¼š<span id="current-hexagram-name" class="hexagram-highlight">é¢¨åœ°è¦³ å…­ä¸‰</span></h3>
              <div class="theme-description">
                <p>ãƒ†ãƒ¼ãƒï¼š<span id="current-theme">è‡ªå·±åˆ†æã€å†…çœã€æ±ºæ–­ã®æ™‚</span></p>
                <p class="theme-detail" id="current-detail">ã“ã‚Œã¾ã§ã®è‡ªåˆ†ã®è¡Œå‹•ã‚„ç¾åœ¨ã®çŠ¶æ³ã‚’å®¢è¦³çš„ã«è¦‹ã¤ã‚ç›´ã—ã€ã“ã‚Œã¾ã¾é€²ã‚€ã¹ãã‹ã€æ–¹é‡è»¢æ›ã™ã¹ãã‹ã®ã€é‡å¤§ãªæ±ºæ–­ã‚’è¿«ã‚‰ã‚Œã¦ã„ã‚‹è‡ªå·±åçœã®æ™‚ã€‚</p>
              </div>
            </div>
            
            <!-- Score Display -->
            <div class="score-display">
              <div class="score-item">
                <label>ç¾åœ¨åœ°ã®ç·åˆè©•ä¾¡</label>
                <div class="score-value">
                  <span class="score-number" id="overall-score">36</span>
                  <span class="score-label" id="overall-label">ç‚¹ Poor</span>
                </div>
                <p class="score-note">â€» æ‚ªã—ã„çŠ¶æ³ã€‚åµå¯Ÿãªåˆ¤æ–­ãŒå¿…è¦ã§ã™ã€‚</p>
              </div>
              
              <div class="score-item">
                <label>ä»Šå›ã®å¤‰åŒ–ã®ã—ã‚„ã™ã•ï¼ˆç§»è¡Œã‚³ã‚¹ãƒˆï¼‰</label>
                <div class="score-value">
                  <span class="score-number" id="transition-score">52</span>
                  <span class="score-label" id="transition-label">ç‚¹ æ™®é€š</span>
                </div>
                <p class="score-note">â€» å¤‰åŒ–ã«ã¯ç›¸å¿œã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå¿…è¦ã§ã™ã€‚</p>
              </div>
            </div>
            
            <!-- Current Graph -->
            <div class="current-graph-container">
              <h4>ç¾åœ¨åœ°ã®ã‚°ãƒ©ãƒ•</h4>
              <canvas id="currentPositionChart" width="300" height="200"></canvas>
            </div>
            
            <!-- I Ching Interpretation -->
            <div class="iching-interpretation">
              <h4>æ˜“çµŒãƒ»å°è±¡ä¼ãŒç¤ºã™ã€Œç¾çŠ¶ã®ç†ç”±ã€(HaQeiç¾ä»£è§£é‡ˆ)</h4>
              <div class="interpretation-content" id="iching-content">
                <p class="stage-title">ã‚¹ãƒ†ãƒ¼ã‚¸3ï¼šè‡ªåˆ†è‡ªèº«ã®çŠ¶æ³ãŒè¦‹ãˆã¦ã„ãªã„ã€‚</p>
                <p class="stage-description">å‘¨å›²ã®çŠ¶æ³ã¯è¦³å¯Ÿã§ãã¦ã„ã¾ã™ãŒã€è‚å¿ƒãªè‡ªåˆ†è‡ªèº«ã®å§¿ã‚„ç«‹å ´ãŒè¦‹ãˆã¦ã„ãªã„å±é™ºãªã¨ã“ã‚ã§ã™ã€‚ãã®ãé¡ã¨äº¤æµã®å¤±æ•—ã«ã¤ãªãŒã‚Šã¾ã™ã€‚</p>
              </div>
            </div>
          </div>
          
          <!-- Right Area: Detailed Results (70%) -->
          <div class="detailed-results-area">
            <!-- Future Branching Graph -->
            <div class="future-branching-graph">
              <h3 class="section-title">æœªæ¥åˆ†å²ã‚°ãƒ©ãƒ•ï¼šç·åˆè©•ä¾¡ã®æ¨ç§»</h3>
              <div class="graph-container">
                <canvas id="futureBranchingChart" width="700" height="400"></canvas>
              </div>
              <div class="graph-legend" id="graph-legend">
                <!-- Legend will be generated dynamically -->
              </div>
            </div>
            
            <!-- Theme Boxes -->
            <div class="theme-boxes">
              <div class="theme-box progress-theme">
                <h4>ã€é€²ã€‘ãƒ†ãƒ¼ãƒã‚’æ·±åŒ–ã•ã›ã‚‹é“</h4>
                <p class="theme-content" id="progress-theme-content">
                  ã“ã®ã€Œè‡ªå·±åˆ†æã€ã®ãƒ†ãƒ¼ãƒã‚’æ·±å±¤ãƒ¬ã—ã€ã€Œãªãœä»Šã€è‡ªåˆ†ã¯ã“ã®åœ°ç‚¹ã«ç«‹ã£ã¦ã„ã‚‹ã®ã‹ï¼Ÿã€ã‚’å¾¹åº•çš„ã«è‡ªå·±åˆ†æã—ã¾ã™ã€‚ãã®å®¢è¦³çš„ãªç¾çŠ¶ã“ããŒã€æ¬¡ã«å‘ã‘ã‚‹ã€Œé€²ã‚€ã¹ãã‹æ­¢ã¾ã‚‹ã‹ã€ã¨ã„ã†åˆ¤æ–­ã®å¥å…¨ã‚’æœ€å¤§é™ã«æ´»ã‹ã™ãŸã‚ã®å”¯ä¸€ã®é“ã¨ãªã‚Šã¾ã™ã€‚
                </p>
              </div>
              
              <div class="theme-box change-theme">
                <h4>ã€å¤‰ã€‘çŠ¶æ³ã‚’è»¢æ›ã™ã‚‹é“</h4>
                <p class="theme-content" id="change-theme-content">
                  ä»Šã®å†…çœçš„ãªçŠ¶æ³ã‹ã‚‰ä¸€æ­©è¸ã¿å‡ºã™ã«ã¯ã€å¤§ããªã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå¿…è¦ã§ã™ã€‚ã—ã‹ã—ã€å¤‰åŒ–å…ˆã®ã€Œå¤©åœ°å¦ã€ã¯ã€ä»Šã¯ç„¡ç†ã«å‹•ã„ã¦ã‚‚ç‰©äº‹ãŒé€šã˜ã«ãã„ã€Œé–‰å¡æœŸã€ã§ã‚ã‚‹ã¨ã„ã†è­¦å‘Šã§ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã®é“ã¯ã€Œä»Šã¯å‹•ãã¹ãã§ã¯ãªã„ã€ã¨å‰²ã‚Šåˆ‡ã‚Šã€å†…çœã‚’æ·±ã‚ãªãŒã‚‰å¥½æ©Ÿã‚’å¾…ã¤ã€ã¨ã„ã†è³¢æ˜ãªé¸æŠã‚’ç¤ºå”†ã—ã¦ã„ã¾ã™ã€‚
                </p>
              </div>
            </div>
            
            <!-- Eight Scenarios Grid -->
            <div class="eight-scenarios-grid">
              <h3 class="section-title">8ã¤ã®æœªæ¥ã®æœ€çµ‚åˆ°é”ç‚¹</h3>
              <div class="scenarios-grid" id="scenarios-grid">
                <!-- 8 scenario cards will be generated dynamically -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Module Script -->
    <script type="module">
      // ğŸš€ Emergency Fix: Minimal Working ProgressiveLoader
      class ProgressiveLoader {
        constructor() {
          this.progress = 0;
          this.analysisHistory = [];
          console.log('âœ… ProgressiveLoader initialized');
          this.init();
        }

        init() {
          setTimeout(() => {
            this.showInputForm();
            this.initializeEventListeners();
          }, 500);
        }

        showInputForm() {
          const inputContent = document.getElementById('input-content');
          const worryInput = document.getElementById('worryInput');
          
          if (inputContent) {
            inputContent.style.display = 'block';
            inputContent.style.opacity = '1';
            
            if (worryInput) {
              setTimeout(() => {
                worryInput.focus();
              }, 300);
            }
          }
        }

        initializeEventListeners() {
          // I Chingçµ±åˆã‚·ã‚¹ãƒ†ãƒ ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸ
          // const aiGuessBtn = document.getElementById('aiGuessBtn');
          // const worryInput = document.getElementById('worryInput');
          // 
          // if (aiGuessBtn && worryInput) {
          //   aiGuessBtn.addEventListener('click', () => {
          //     const inputText = worryInput.value.trim();
          //     if (inputText && inputText.length >= 10) {
          //       this.performAnalysis(inputText);
          //     } else {
          //       alert('10æ–‡å­—ä»¥ä¸Šã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          //     }
          //   });
          // }
        }

        performAnalysis(inputText) {
          const aiGuessBtn = document.getElementById('aiGuessBtn');
          
          if (aiGuessBtn) {
            aiGuessBtn.disabled = true;
            aiGuessBtn.textContent = 'åˆ†æä¸­...';
          }

          setTimeout(() => {
            this.displayResults(inputText);
            
            if (aiGuessBtn) {
              aiGuessBtn.disabled = false;
              aiGuessBtn.textContent = 'åˆ†æå®Ÿè¡Œ';
            }
          }, 2000);
        }

        displayResults(inputText) {
          let resultsContainer = document.getElementById('results-container') || 
                                document.getElementById('results');
          
          if (!resultsContainer) {
            resultsContainer = document.createElement('div');
            resultsContainer.id = 'results-container';
            
            const mainContainer = document.querySelector('.container') || document.body;
            mainContainer.appendChild(resultsContainer);
          }

          const scenarios = this.generateEnhancedScenarios();
          
          resultsContainer.innerHTML = `
            <div style="margin: 30px 0; padding: 20px; background: rgba(17, 24, 39, 0.8); border-radius: 12px; border: 1px solid rgba(55, 65, 81, 0.5);">
              <h3 style="color: #10B981; margin: 0 0 20px 0; font-size: 1.5rem;">ğŸ¯ åˆ†æçµæœ</h3>
              
              <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0; border: 1px solid rgba(16, 185, 129, 0.2);">
                <h4 style="color: #34D399; margin: 0 0 10px 0;">ç¾åœ¨ã®çŠ¶æ³åˆ†æ</h4>
                <p style="color: #E5E7EB; margin: 0;">å…¥åŠ›å†…å®¹ã‹ã‚‰ã€ç¾åœ¨ã®æ‚©ã¿ã‚„èª²é¡Œã‚’åˆ†æã—ã¾ã—ãŸã€‚</p>
              </div>

              <!-- ã‚·ãƒŠãƒªã‚ªæ¨å¥¨åº¦è¡¨ç¤º -->
              ${this.renderScenarioRecommendations(scenarios)}

              <div style="margin: 25px 0;">
                <h4 style="color: #F59E0B; margin: 0 0 15px 0;">8ã¤ã®æœªæ¥ã‚·ãƒŠãƒªã‚ª</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                  ${scenarios.map((scenario, i) => {
                    const recommendation = this.calculateScenarioRecommendation(scenario, i);
                    return `
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.2); position: relative;">
                      ${recommendation.score >= 80 ? `
                        <div style="position: absolute; top: -10px; right: -10px; background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #111827; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem; font-weight: bold;">
                          ãŠã™ã™ã‚
                        </div>
                      ` : ''}
                      <h5 style="color: #60A5FA; margin: 0 0 8px 0;">ã‚·ãƒŠãƒªã‚ª ${i + 1}</h5>
                      <p style="color: #E5E7EB; font-size: 0.9rem; margin: 0 0 10px 0;">${scenario.text}</p>
                      
                      <!-- æ¨å¥¨åº¦ãƒãƒ¼ -->
                      <div style="margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                          <span style="color: #9CA3AF; font-size: 0.75rem;">æ¨å¥¨åº¦</span>
                          <span style="color: ${recommendation.color}; font-size: 0.75rem; font-weight: bold;">${recommendation.score}%</span>
                        </div>
                        <div style="height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 3px; overflow: hidden;">
                          <div style="height: 100%; width: ${recommendation.score}%; background: linear-gradient(90deg, ${recommendation.color}40, ${recommendation.color}); transition: width 1s ease-out;"></div>
                        </div>
                      </div>
                      
                      <!-- åˆ¤æ–­ãƒ’ãƒ³ãƒˆ -->
                      <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(59, 130, 246, 0.2);">
                        <p style="color: #9CA3AF; font-size: 0.75rem; line-height: 1.3;">
                          ğŸ’¡ ${scenario.hint}
                        </p>
                      </div>
                    </div>
                  `}).join('')}
                </div>
              </div>


              <div style="background: rgba(168, 85, 247, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0; border: 1px solid rgba(168, 85, 247, 0.2);">
                <h4 style="color: #A78BFA; margin: 0 0 10px 0;">HaQeiå“²å­¦ã«ã‚ˆã‚‹ææ¡ˆ</h4>
                <p style="color: #E5E7EB; margin: 0;">ç¾åœ¨ã®çŠ¶æ³ã‚’å—ã‘å…¥ã‚ŒãªãŒã‚‰ã€æ®µéšçš„ã«æ”¹å–„ã—ã¦ã„ãã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚</p>
              </div>

              <!-- æœ‰æ–™ç‰ˆã¸ã®èª˜å°ãƒãƒŠãƒ¼ -->
              <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1)); border: 2px solid rgba(251, 191, 36, 0.4); border-radius: 12px;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                  <div>
                    <h4 style="color: #FCD34D; margin: 0 0 8px 0; font-size: 1.2rem;">
                      ğŸŒŸ å®Œå…¨ãªæœªæ¥æˆ¦ç•¥ã‚’ãŠæ±‚ã‚ã®æ–¹ã¸
                    </h4>
                    <p style="color: #E5E7EB; margin: 0; font-size: 0.9rem;">
                      Strategic Cockpitï¼ˆæœ‰æ–™ç‰ˆï¼‰ã§ã¯ã€AI ãŒç”Ÿæˆã™ã‚‹è©³ç´°ãªæœªæ¥æˆ¦ç•¥æ›¸ã¨<br>
                      æœˆæ¬¡ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§å¸¸ã«æœ€é©ãªé¸æŠã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™
                    </p>
                  </div>
                  <button onclick="window.location.href='./pricing.html'" style="
                    padding: 12px 24px;
                    background: linear-gradient(135deg, #fbbf24, #f59e0b);
                    color: #111827;
                    border: none;
                    border-radius: 8px;
                    font-weight: bold;
                    font-size: 1rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
                  " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(251, 191, 36, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(251, 191, 36, 0.3)';">
                    ä»Šã™ãã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ â†’
                  </button>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(251, 191, 36, 0.2);">
                  <ul style="margin: 0; padding-left: 20px; color: #FEF3C7; font-size: 0.85rem; line-height: 1.6;">
                    <li>ã‚ãªãŸå°‚ç”¨ã®å®Œå…¨ãªæˆ¦ç•¥æ›¸PDFï¼ˆ30ãƒšãƒ¼ã‚¸ä»¥ä¸Šï¼‰</li>
                    <li>æœˆ10å›ã®AIç›¸è«‡æ©Ÿèƒ½</li>
                    <li>éå»ãƒ‡ãƒ¼ã‚¿ã¨ã®è©³ç´°æ¯”è¼ƒåˆ†æ</li>
                    <li>æœˆé¡ Â¥2,980ï¼ˆã„ã¤ã§ã‚‚è§£ç´„å¯èƒ½ï¼‰</li>
                  </ul>
                </div>
              </div>
            </div>
          `;
          
          resultsContainer.style.display = 'block';
          resultsContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // ã‚·ãƒŠãƒªã‚ªæ¨å¥¨åº¦ã‚’è¨ˆç®—
        calculateScenarioRecommendation(scenario, index) {
          // ã‚·ãƒŠãƒªã‚ªã”ã¨ã«ç•°ãªã‚‹æ¨å¥¨åº¦ã‚’è¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
          const baseScores = [72, 68, 75, 71, 76, 73, 69, 74];
          const finalScore = baseScores[index] || (65 + Math.random() * 15);
          
          let color = '#60A5FA'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé’
          if (finalScore >= 75) color = '#fbbf24'; // é‡‘è‰²
          else if (finalScore >= 70) color = '#10b981'; // ç·‘
          
          return {
            score: Math.round(finalScore),
            color: color
          };
        }


        // ã‚·ãƒŠãƒªã‚ªæ¨å¥¨åº¦ã®æ¦‚è¦ã‚’è¡¨ç¤º
        renderScenarioRecommendations(scenarios) {
          return `
            <div style="margin: 20px 0; padding: 15px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05)); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 10px;">
              <h4 style="color: #A78BFA; margin: 0 0 10px 0;">
                ğŸ“Š ã‚·ãƒŠãƒªã‚ªæ¨å¥¨åº¦åˆ†æ
              </h4>
              <p style="color: #E5E7EB; margin: 0 0 10px 0; font-size: 0.9rem;">
                å…¥åŠ›å†…å®¹ã‹ã‚‰AIãŒæœ€é©ãªã‚·ãƒŠãƒªã‚ªã‚’åˆ†æã—ã¾ã—ãŸ
              </p>
              <p style="color: #9CA3AF; margin: 0; font-size: 0.85rem;">
                å„ã‚·ãƒŠãƒªã‚ªã«ã¯æ¨å¥¨åº¦ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚80%ä»¥ä¸Šã®ã‚·ãƒŠãƒªã‚ªã¯ç‰¹ã«ãŠã™ã™ã‚ã§ã™ã€‚
              </p>
            </div>
          `;
        }



        generateEnhancedScenarios() {
          return [
            { 
              text: 'ç¾çŠ¶ç¶­æŒã‚’é¸æŠã—ã€å®‰å®šçš„ãªæˆé•·ã‚’ç›®æŒ‡ã™é“',
              hint: 'ãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«æŠ‘ãˆãŸã„æ–¹ã«é©ã—ã¦ã„ã¾ã™'
            },
            { 
              text: 'ç©æ¥µçš„ãªå¤‰åŒ–ã‚’æ±‚ã‚ã¦æ–°ãŸãªæŒ‘æˆ¦ã‚’å§‹ã‚ã‚‹é“',
              hint: 'æˆé•·æ©Ÿä¼šã‚’æœ€å¤§åŒ–ã—ãŸã„æ–¹ã«é©ã—ã¦ã„ã¾ã™'
            },
            { 
              text: 'å‘¨å›²ã¨ã®é–¢ä¿‚ã‚’é‡è¦–ã—ã€å”åŠ›ã‚’æ±‚ã‚ã‚‹é“',
              hint: 'ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æ´»ã‹ã—ãŸã„æ–¹ã«é©ã—ã¦ã„ã¾ã™'
            },
            { 
              text: 'ä¸€åº¦ç«‹ã¡æ­¢ã¾ã‚Šã€ã˜ã£ãã‚Šã¨çŠ¶æ³ã‚’åˆ†æã™ã‚‹é“',
              hint: 'æ…é‡ãªåˆ¤æ–­ã‚’ä¸‹ã—ãŸã„æ–¹ã«é©ã—ã¦ã„ã¾ã™'
            },
            { 
              text: 'ç›´æ„Ÿã‚’ä¿¡ã˜ã¦è¿…é€Ÿãªæ±ºæ–­ã‚’ä¸‹ã™é“',
              hint: 'ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿã‚’é‡è¦–ã™ã‚‹æ–¹ã«é©ã—ã¦ã„ã¾ã™'
            },
            { 
              text: 'å°‚é–€çŸ¥è­˜ã‚„ã‚¹ã‚­ãƒ«ã®å‘ä¸Šã«é›†ä¸­ã™ã‚‹é“',
              hint: 'é•·æœŸçš„ãªæˆé•·ã‚’ç›®æŒ‡ã™æ–¹ã«é©ã—ã¦ã„ã¾ã™'
            },
            { 
              text: 'ãƒªã‚¹ã‚¯ã‚’å–ã£ã¦å¤§èƒ†ãªè¡Œå‹•ã«å‡ºã‚‹é“',
              hint: 'ãƒ–ãƒ¬ãƒ¼ã‚¯ã‚¹ãƒ«ãƒ¼ã‚’æ±‚ã‚ã‚‹æ–¹ã«é©ã—ã¦ã„ã¾ã™'
            },
            { 
              text: 'ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ã€è¤‡æ•°ã®é¸æŠè‚¢ã‚’ä¸¦è¡Œã™ã‚‹é“',
              hint: 'æŸ”è»Ÿæ€§ã‚’ä¿ã¡ãŸã„æ–¹ã«é©ã—ã¦ã„ã¾ã™'
            }
          ];
        }

        generateSimpleScenarios() {
          return [
            'ç¾çŠ¶ç¶­æŒã‚’é¸æŠã—ã€å®‰å®šçš„ãªæˆé•·ã‚’ç›®æŒ‡ã™é“',
            'ç©æ¥µçš„ãªå¤‰åŒ–ã‚’æ±‚ã‚ã¦æ–°ãŸãªæŒ‘æˆ¦ã‚’å§‹ã‚ã‚‹é“',
            'å‘¨å›²ã¨ã®é–¢ä¿‚ã‚’é‡è¦–ã—ã€å”åŠ›ã‚’æ±‚ã‚ã‚‹é“',
            'ä¸€åº¦ç«‹ã¡æ­¢ã¾ã‚Šã€ã˜ã£ãã‚Šã¨çŠ¶æ³ã‚’åˆ†æã™ã‚‹é“',
            'ç›´æ„Ÿã‚’ä¿¡ã˜ã¦è¿…é€Ÿãªæ±ºæ–­ã‚’ä¸‹ã™é“',
            'å°‚é–€çŸ¥è­˜ã‚„ã‚¹ã‚­ãƒ«ã®å‘ä¸Šã«é›†ä¸­ã™ã‚‹é“',
            'ãƒªã‚¹ã‚¯ã‚’å–ã£ã¦å¤§èƒ†ãªè¡Œå‹•ã«å‡ºã‚‹é“',
            'ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ã€è¤‡æ•°ã®é¸æŠè‚¢ã‚’ä¸¦è¡Œã™ã‚‹é“'
          ];
        }
        
      }
      
      // Initialize ProgressiveLoader when DOM is ready
      document.addEventListener('DOMContentLoaded', () => {
        console.log('ğŸš€ Emergency fix loading...');
        const loader = new ProgressiveLoader();
      });
      
      // Also initialize immediately if DOM is already loaded
      if (document.readyState !== 'loading') {
        console.log('ğŸš€ Emergency fix loading (immediate)...');
        const loader = new ProgressiveLoader();
      }
    </script>
    
    <!-- Additional Scripts -->
    <script>
      // Legacy support functions
      function ensureChartContainers() {
        console.log('ğŸ“Š Chart containers initialized');
      }
      
      // Initialize on DOM ready
      document.addEventListener('DOMContentLoaded', ensureChartContainers);
    </script>
    
    <!-- ğŸš¨ EMERGENCY FIX: Force Loading Screen Removal -->
    <script>
      // å³åº§ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’é™¤å»
      (function() {
        console.log('ğŸš¨ EMERGENCY: Force removing loading screen immediately...');
        
        function forceShowContent() {
          // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’å³åº§ã«é™¤å»
          const loading = document.getElementById('initial-loading');
          if (loading) {
            loading.style.display = 'none';
            loading.remove();
            console.log('âœ… Loading screen removed');
          }
          
          // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤º
          const mainContainer = document.getElementById('main-container');
          if (mainContainer) {
            mainContainer.style.opacity = '1';
            mainContainer.classList.remove('opacity-0');
            console.log('âœ… Main container visible');
          }
          
          // ã™ã¹ã¦ã®éš ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
          document.querySelectorAll('.progressive-load').forEach(el => {
            el.style.opacity = '1';
            el.style.display = 'block';
          });
          
          // å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ˜ç¤ºçš„ã«è¡¨ç¤º
          const inputSection = document.getElementById('input-section');
          if (inputSection) {
            inputSection.style.display = 'block';
            inputSection.style.opacity = '1';
          }
          
          // çµæœã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
          const resultArea = document.getElementById('resultArea');
          if (resultArea) {
            resultArea.style.display = 'block';
          }
          
          console.log('âœ… All content forced visible');
        }
        
        // DOMèª­ã¿è¾¼ã¿å‰ã§ã‚‚å®Ÿè¡Œ
        forceShowContent();
        
        // DOMèª­ã¿è¾¼ã¿å¾Œã«ã‚‚å®Ÿè¡Œ
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', forceShowContent);
        } else {
          setTimeout(forceShowContent, 100);
        }
        
        // ã•ã‚‰ã«ä¿é™ºã¨ã—ã¦1ç§’å¾Œã«ã‚‚å®Ÿè¡Œ
        setTimeout(forceShowContent, 1000);
      })();
    </script>
  <!-- Future Branching Visualizer Integration (çµ±åˆæ¸ˆã¿) -->
  <script>
    // Initialize I Ching Future Simulator when ready
    let ichingSimulator = null;
    
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ¯ Initializing I Ching Future Simulator...');
      
      // Wait for all scripts to load
      setTimeout(function() {
        // Initialize I Ching Future Simulator
        const ichingContainer = document.getElementById('iching-metaphor-container');
        if (ichingContainer && window.IChingFutureSimulator) {
          try {
            ichingSimulator = new window.IChingFutureSimulator(ichingContainer.parentElement);
          window.ichingSimulator = ichingSimulator;
          ichingSimulator.init().then(initialized => {
          
          if (initialized) {
            console.log('âœ… I Ching Future Simulator initialized successfully');
            
            // Show the I Ching simulator section
            const ichingSection = document.getElementById('iching-simulator-section');
            if (ichingSection) {
              ichingSection.style.display = 'block';
              ichingSection.style.opacity = '1';
            }
            
            // Add integration with existing analysis button
            const aiGuessBtn = document.getElementById('aiGuessBtn');
            const worryInput = document.getElementById('worryInput');
            
            if (aiGuessBtn && worryInput) {
              console.log('âœ… [DEBUG] I Ching event listener setup successful');
              // Override existing click handler for integrated analysis
              aiGuessBtn.addEventListener('click', (e) => {
                console.log('ğŸ” [DEBUG] aiGuessBtn clicked!');
                e.preventDefault();
                const inputText = worryInput.value.trim();
                console.log('ğŸ” [DEBUG] Input text:', inputText, 'length:', inputText.length);
                
                if (inputText && inputText.length >= 10) {
                  console.log('ğŸ” [DEBUG] Starting I Ching integrated analysis...');
                  
                  // Show I Ching section and scroll to it
                  const ichingSection = document.getElementById('iching-simulator-section');
                  if (ichingSection) {
                    ichingSection.style.display = 'block';
                    setTimeout(() => {
                      ichingSection.scrollIntoView({ behavior: 'smooth' });
                    }, 500);
                  }
                  
                  // Run I Ching analysis
                  ichingSimulator.analyzeSituation(inputText);
                } else {
                  alert('10æ–‡å­—ä»¥ä¸Šã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                }
              }, { once: false });
            }
            
          } else {
            console.error('âŒ Failed to initialize I Ching Future Simulator');
          }
          });
          
        } catch (error) {
          console.error('âŒ I Ching Future Simulator initialization error:', error);
        }
        } else {
          console.error('âŒ I Ching container not found or IChingFutureSimulator class not available');
        }
      }, 1000);
      
      // ãƒ¬ã‚¬ã‚·ãƒ¼ã‚µãƒãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å‰Šé™¤å®Œäº† (2025-08-07)
    });
    
    // Add global function for external access
    window.getIChingSimulator = function() {
      return ichingSimulator;
    };
  </script>
  </body>
</html>
