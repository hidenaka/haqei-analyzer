<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Results Test</title>
    
    <style>
        body {
            margin: 0;
            padding: 2rem;
            background: #111827;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .result-container {
            background: rgba(31, 41, 55, 0.8);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .os-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(17, 24, 39, 0.5);
            border-radius: 0.5rem;
        }
        
        .os-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #60a5fa;
        }
        
        .os-description {
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .traits {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .trait {
            background: rgba(59, 130, 246, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            border: 1px solid rgba(59, 130, 246, 0.5);
        }
        
        .error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            margin-right: 0.5rem;
        }
        
        button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <h1>シンプル結果表示テスト</h1>
    
    <div id="status"></div>
    
    <div id="results-display" class="result-container" style="display: none;">
        <h2>あなたの3つのOS</h2>
        
        <div id="engine-os" class="os-section">
            <h3 class="os-title">エンジンOS</h3>
            <p class="os-description"></p>
            <div class="traits"></div>
        </div>
        
        <div id="interface-os" class="os-section">
            <h3 class="os-title">インターフェースOS</h3>
            <p class="os-description"></p>
            <div class="traits"></div>
        </div>
        
        <div id="safemode-os" class="os-section">
            <h3 class="os-title">セーフモードOS</h3>
            <p class="os-description"></p>
            <div class="traits"></div>
        </div>
    </div>
    
    <div style="margin-top: 2rem; text-align: center;">
        <button onclick="loadResults()">結果を読み込む</button>
        <button onclick="createTestData()">テストデータ作成</button>
        <button onclick="clearData()">データクリア</button>
        <button onclick="goToFullResults()">完全版結果ページへ</button>
    </div>
    
    <script>
        const statusEl = document.getElementById('status');
        const resultsDisplay = document.getElementById('results-display');
        
        function showStatus(message, type = 'info') {
            const colors = {
                info: '#60a5fa',
                success: '#4ade80',
                error: '#f87171',
                warning: '#fbbf24'
            };
            
            statusEl.innerHTML = `<div style="color: ${colors[type]}; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 0.5rem; margin-bottom: 1rem;">${message}</div>`;
        }
        
        function loadResults() {
            showStatus('結果を読み込み中...', 'info');
            
            // LocalStorageから様々な形式で取得を試みる
            const keys = ['haqei_analysis_result', 'haqei_emergency_result', 'haqei_virtual_personality'];
            let analysisResult = null;
            
            for (const key of keys) {
                const data = localStorage.getItem(key);
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        
                        // データの形式を確認
                        if (parsed.engineOS && parsed.interfaceOS && parsed.safeModeOS) {
                            analysisResult = parsed;
                            showStatus(`${key}から結果を取得成功`, 'success');
                            break;
                        } else if (parsed.result && parsed.result.engineOS) {
                            analysisResult = parsed.result;
                            showStatus(`${key}のresultから結果を取得成功`, 'success');
                            break;
                        }
                    } catch (e) {
                        console.error(`${key}のパースエラー:`, e);
                    }
                }
            }
            
            if (analysisResult) {
                displayResults(analysisResult);
            } else {
                showStatus('結果データが見つかりません。診断を完了してください。', 'error');
                resultsDisplay.style.display = 'none';
            }
        }
        
        function displayResults(data) {
            // エンジンOS
            const engineSection = document.getElementById('engine-os');
            engineSection.querySelector('.os-description').textContent = 
                data.engineOS.description || 'あなたの内なる原動力となるOS';
            displayTraits(engineSection.querySelector('.traits'), data.engineOS.traits || []);
            
            // インターフェースOS
            const interfaceSection = document.getElementById('interface-os');
            interfaceSection.querySelector('.os-description').textContent = 
                data.interfaceOS.description || '外界との接点となるOS';
            displayTraits(interfaceSection.querySelector('.traits'), data.interfaceOS.traits || []);
            
            // セーフモードOS
            const safemodeSection = document.getElementById('safemode-os');
            safemodeSection.querySelector('.os-description').textContent = 
                data.safeModeOS.description || 'あなたを守る防御的なOS';
            displayTraits(safemodeSection.querySelector('.traits'), data.safeModeOS.traits || []);
            
            resultsDisplay.style.display = 'block';
        }
        
        function displayTraits(container, traits) {
            container.innerHTML = '';
            traits.forEach(trait => {
                const traitEl = document.createElement('span');
                traitEl.className = 'trait';
                traitEl.textContent = trait;
                container.appendChild(traitEl);
            });
        }
        
        function createTestData() {
            const testData = {
                engineOS: {
                    name: "革新的エンジンOS",
                    description: "新しいアイデアと可能性を追求し、常に前進する創造的な原動力",
                    traits: ["創造性", "革新性", "柔軟性", "好奇心"],
                    hexagram: 1,
                    score: 85
                },
                interfaceOS: {
                    name: "調和的インターフェースOS",
                    description: "人との繋がりを大切にし、調和的な関係性を築く社会的な側面",
                    traits: ["共感性", "協調性", "コミュニケーション", "包容力"],
                    hexagram: 2,
                    score: 78
                },
                safeModeOS: {
                    name: "守護的セーフモードOS",
                    description: "リスクを管理し、安全と安定を確保する防御的な側面",
                    traits: ["慎重さ", "分析力", "リスク管理", "堅実性"],
                    hexagram: 3,
                    score: 72
                },
                timestamp: new Date().toISOString()
            };
            
            // 複数の形式で保存
            localStorage.setItem('haqei_analysis_result', JSON.stringify(testData));
            localStorage.setItem('haqei_virtual_personality', JSON.stringify(testData));
            
            showStatus('テストデータを作成しました', 'success');
            loadResults();
        }
        
        function clearData() {
            if (confirm('本当にデータをクリアしますか？')) {
                const keys = Object.keys(localStorage).filter(k => k.includes('haqei'));
                keys.forEach(key => localStorage.removeItem(key));
                showStatus('データをクリアしました', 'warning');
                resultsDisplay.style.display = 'none';
            }
        }
        
        function goToFullResults() {
            window.location.href = 'results.html';
        }
        
        // 初期読み込み
        loadResults();
    </script>
</body>
</html>