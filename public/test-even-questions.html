<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>偶数番設問表示確認テスト</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a2e;
            color: #f1f5f9;
        }
        .test-info {
            background: rgba(99, 102, 241, 0.2);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #6366f1;
            border-radius: 8px;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <h1>偶数番設問表示確認テスト</h1>
    
    <div class="test-info">
        <h3>修正内容</h3>
        <ol>
            <li>showCurrentQuestionメソッドを改善（現在の要素以外のみ非表示）</li>
            <li>!importantを使用して強制表示</li>
            <li>表示失敗時の緊急CSS上書き機能</li>
            <li>Web Component側の:hostスタイル強化</li>
        </ol>
    </div>
    
    <iframe src="os_analyzer.html" id="test-frame"></iframe>
    
    <div class="status" id="status">
        <h3>テスト状況</h3>
        <p>読み込み中...</p>
    </div>
    
    <script>
        const statusEl = document.getElementById('status');
        const frame = document.getElementById('test-frame');
        
        frame.onload = () => {
            setTimeout(() => {
                try {
                    const frameWindow = frame.contentWindow;
                    const frameDoc = frame.contentDocument;
                    
                    // アプリケーションが初期化されているか確認
                    if (frameWindow.app && frameWindow.app.questionFlow) {
                        statusEl.innerHTML = `
                            <h3 class="success">✅ アプリケーション初期化完了</h3>
                            <p>OS Analyzerが正常に起動しました。</p>
                            <p>以下の手順でテスト：</p>
                            <ol>
                                <li>設問を進めてq2（偶数番）に到達</li>
                                <li>コンソールで「✅ q2 successfully displayed」を確認</li>
                                <li>q2が実際に表示されているか確認</li>
                                <li>もし表示されない場合は「🚨 Applied emergency CSS override」が出力される</li>
                            </ol>
                        `;
                        
                        // コンソールログを監視
                        const originalLog = frameWindow.console.log;
                        const originalError = frameWindow.console.error;
                        
                        frameWindow.console.log = function(...args) {
                            originalLog.apply(frameWindow.console, args);
                            const msg = args.join(' ');
                            if (msg.includes('successfully displayed')) {
                                statusEl.innerHTML += `<p class="success">✅ ${msg}</p>`;
                            }
                        };
                        
                        frameWindow.console.error = function(...args) {
                            originalError.apply(frameWindow.console, args);
                            const msg = args.join(' ');
                            if (msg.includes('CRITICAL')) {
                                statusEl.innerHTML += `<p class="error">❌ ${msg}</p>`;
                            }
                        };
                        
                    } else {
                        statusEl.innerHTML = `
                            <h3 class="error">❌ エラー</h3>
                            <p>アプリケーションが初期化されていません。</p>
                        `;
                    }
                } catch (e) {
                    statusEl.innerHTML = `
                        <h3 class="error">❌ エラー</h3>
                        <p>${e.message}</p>
                    `;
                }
            }, 3000);
        };
    </script>
</body>
</html>