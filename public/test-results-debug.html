<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results Debug Test</title>
    
    <!-- Base CSS -->
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/components.css">
    
    <style>
        body {
            margin: 0;
            padding: 2rem;
            background: #111827;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .debug-section {
            background: rgba(31, 41, 55, 0.8);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .debug-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #60a5fa;
        }
        
        .debug-item {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(17, 24, 39, 0.5);
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.875rem;
            overflow-x: auto;
        }
        
        .status-ok {
            color: #4ade80;
        }
        
        .status-error {
            color: #f87171;
        }
        
        .status-warning {
            color: #fbbf24;
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>Results.html ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="debug-section">
        <h2 class="debug-title">ğŸ” LocalStorage è¨ºæ–­</h2>
        <div id="storage-check"></div>
    </div>
    
    <div class="debug-section">
        <h2 class="debug-title">ğŸ“Š åˆ†æçµæœãƒ‡ãƒ¼ã‚¿æ§‹é€ </h2>
        <div id="data-structure"></div>
    </div>
    
    <div class="debug-section">
        <h2 class="debug-title">ğŸ§ª ãƒ†ã‚¹ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
        <button onclick="createMockData()">ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½œæˆ</button>
        <button onclick="testVirtualPersonaView()">VirtualPersonaView ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="clearAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
        <button onclick="goToAnalyzer()">è¨ºæ–­ãƒšãƒ¼ã‚¸ã¸</button>
        <button onclick="goToResults()">çµæœãƒšãƒ¼ã‚¸ã¸</button>
    </div>
    
    <div class="debug-section">
        <h2 class="debug-title">ğŸ“ ãƒ­ã‚°å‡ºåŠ›</h2>
        <div id="log-output" style="max-height: 400px; overflow-y: auto;"></div>
    </div>
    
    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ -->
    <script src="./js/shared/core/BaseComponent.js"></script>
    <script src="./js/shared/core/StorageManager.js"></script>
    <script src="./js/shared/core/SimpleStorageManager.js"></script>
    
    <script>
        const logOutput = document.getElementById('log-output');
        
        function log(message, type = 'info') {
            const colors = {
                info: '#60a5fa',
                success: '#4ade80',
                error: '#f87171',
                warning: '#fbbf24'
            };
            
            const logItem = document.createElement('div');
            logItem.className = 'debug-item';
            logItem.style.color = colors[type] || colors.info;
            logItem.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logOutput.appendChild(logItem);
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        function checkLocalStorage() {
            const storageCheck = document.getElementById('storage-check');
            storageCheck.innerHTML = '';
            
            const haqeiKeys = Object.keys(localStorage).filter(k => k.includes('haqei'));
            
            if (haqeiKeys.length === 0) {
                storageCheck.innerHTML = '<div class="debug-item status-error">âŒ HAQEIãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                log('LocalStorageã«HAQEIãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            log(`LocalStorageã«${haqeiKeys.length}å€‹ã®HAQEIã‚­ãƒ¼ã‚’ç™ºè¦‹`, 'info');
            
            haqeiKeys.forEach(key => {
                const value = localStorage.getItem(key);
                const itemDiv = document.createElement('div');
                itemDiv.className = 'debug-item';
                
                let status = 'âœ…';
                let info = '';
                
                try {
                    if (value) {
                        const parsed = JSON.parse(value);
                        if (key === 'haqei_analysis_result') {
                            const hasTripleOS = !!(parsed.engineOS && parsed.interfaceOS && parsed.safeModeOS);
                            const hasResult = !!parsed.result;
                            
                            if (hasTripleOS) {
                                status = 'âœ…';
                                info = 'Triple OS ãƒ‡ãƒ¼ã‚¿æ¤œå‡º';
                            } else if (hasResult && parsed.result.engineOS) {
                                status = 'âœ…';
                                info = 'resultå†…ã«Triple OS ãƒ‡ãƒ¼ã‚¿æ¤œå‡º';
                            } else {
                                status = 'âš ï¸';
                                info = 'Triple OS ãƒ‡ãƒ¼ã‚¿ä¸å®Œå…¨';
                            }
                        }
                        
                        const size = new Blob([value]).size;
                        itemDiv.innerHTML = `
                            <strong>${status} ${key}</strong><br>
                            ã‚¿ã‚¤ãƒ—: ${typeof parsed}<br>
                            ã‚µã‚¤ã‚º: ${(size / 1024).toFixed(2)} KB<br>
                            ${info ? `çŠ¶æ…‹: ${info}<br>` : ''}
                            ã‚­ãƒ¼: ${Object.keys(parsed).slice(0, 5).join(', ')}...
                        `;
                    } else {
                        itemDiv.innerHTML = `<strong>âŒ ${key}</strong><br>å€¤: null`;
                    }
                } catch (e) {
                    itemDiv.innerHTML = `<strong>âš ï¸ ${key}</strong><br>JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${e.message}`;
                }
                
                storageCheck.appendChild(itemDiv);
            });
        }
        
        function analyzeDataStructure() {
            const dataStructure = document.getElementById('data-structure');
            dataStructure.innerHTML = '';
            
            try {
                // StorageManagerã§å–å¾—ã‚’è©¦ã¿ã‚‹
                const storageManager = new StorageManager();
                const analysisResult = storageManager.getAnalysisResult();
                
                if (analysisResult) {
                    log('StorageManagerã§åˆ†æçµæœã‚’å–å¾—æˆåŠŸ', 'success');
                    
                    const structureDiv = document.createElement('div');
                    structureDiv.className = 'debug-item';
                    
                    // ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®è©³ç´°åˆ†æ
                    let html = '<strong>åˆ†æçµæœãƒ‡ãƒ¼ã‚¿æ§‹é€ :</strong><br>';
                    
                    if (analysisResult.engineOS) {
                        html += '<span class="status-ok">âœ… engineOS ãŒå­˜åœ¨</span><br>';
                        html += `  - name: ${analysisResult.engineOS.name || 'æœªè¨­å®š'}<br>`;
                        html += `  - description: ${analysisResult.engineOS.description?.substring(0, 50) || 'æœªè¨­å®š'}...<br>`;
                    } else {
                        html += '<span class="status-error">âŒ engineOS ãŒä¸è¶³</span><br>';
                    }
                    
                    if (analysisResult.interfaceOS) {
                        html += '<span class="status-ok">âœ… interfaceOS ãŒå­˜åœ¨</span><br>';
                        html += `  - name: ${analysisResult.interfaceOS.name || 'æœªè¨­å®š'}<br>`;
                        html += `  - description: ${analysisResult.interfaceOS.description?.substring(0, 50) || 'æœªè¨­å®š'}...<br>`;
                    } else {
                        html += '<span class="status-error">âŒ interfaceOS ãŒä¸è¶³</span><br>';
                    }
                    
                    if (analysisResult.safeModeOS) {
                        html += '<span class="status-ok">âœ… safeModeOS ãŒå­˜åœ¨</span><br>';
                        html += `  - name: ${analysisResult.safeModeOS.name || 'æœªè¨­å®š'}<br>`;
                        html += `  - description: ${analysisResult.safeModeOS.description?.substring(0, 50) || 'æœªè¨­å®š'}...<br>`;
                    } else {
                        html += '<span class="status-error">âŒ safeModeOS ãŒä¸è¶³</span><br>';
                    }
                    
                    structureDiv.innerHTML = html;
                    dataStructure.appendChild(structureDiv);
                    
                    // è©³ç´°ãªJSONãƒ“ãƒ¥ãƒ¼
                    const detailDiv = document.createElement('div');
                    detailDiv.className = 'debug-item';
                    detailDiv.innerHTML = '<strong>JSONæ§‹é€ ï¼ˆæœ€åˆã®100æ–‡å­—ï¼‰:</strong><br><pre>' + 
                        JSON.stringify(analysisResult, null, 2).substring(0, 500) + '...</pre>';
                    dataStructure.appendChild(detailDiv);
                    
                } else {
                    dataStructure.innerHTML = '<div class="debug-item status-error">âŒ åˆ†æçµæœãŒå–å¾—ã§ãã¾ã›ã‚“</div>';
                    log('StorageManagerã§åˆ†æçµæœã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', 'error');
                }
                
            } catch (error) {
                dataStructure.innerHTML = `<div class="debug-item status-error">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                log(`ãƒ‡ãƒ¼ã‚¿æ§‹é€ åˆ†æã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        function createMockData() {
            log('ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½œæˆé–‹å§‹...', 'info');
            
            const mockAnalysisResult = {
                engineOS: {
                    name: "é©æ–°çš„ã‚¨ãƒ³ã‚¸ãƒ³OS",
                    description: "æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã¨å¯èƒ½æ€§ã‚’è¿½æ±‚ã™ã‚‹å‰µé€ çš„ãªOS",
                    traits: ["å‰µé€ æ€§", "é©æ–°æ€§", "æŸ”è»Ÿæ€§"],
                    hexagram: 1
                },
                interfaceOS: {
                    name: "èª¿å’Œçš„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹OS",
                    description: "äººã¨ã®ç¹‹ãŒã‚Šã¨èª¿å’Œã‚’é‡è¦–ã™ã‚‹ç¤¾ä¼šçš„ãªOS",
                    traits: ["å…±æ„Ÿæ€§", "å”èª¿æ€§", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³"],
                    hexagram: 2
                },
                safeModeOS: {
                    name: "å®ˆè­·çš„ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰OS",
                    description: "å®‰å…¨ã¨å®‰å®šã‚’ç¢ºä¿ã™ã‚‹é˜²å¾¡çš„ãªOS",
                    traits: ["æ…é‡ã•", "åˆ†æåŠ›", "ãƒªã‚¹ã‚¯ç®¡ç†"],
                    hexagram: 3
                },
                timestamp: new Date().toISOString()
            };
            
            const mockInsights = {
                overall: "ã‚ãªãŸã®3ã¤ã®OSã¯ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸé–¢ä¿‚ã«ã‚ã‚Šã¾ã™ã€‚",
                relationships: [
                    "ã‚¨ãƒ³ã‚¸ãƒ³OSã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹OSã®èª¿å’Œ",
                    "ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰OSã«ã‚ˆã‚‹é©åˆ‡ãªåˆ¶å¾¡"
                ],
                recommendations: [
                    "å‰µé€ æ€§ã‚’æ´»ã‹ã—ã¤ã¤ã€äººã¨ã®èª¿å’Œã‚’å¤§åˆ‡ã«",
                    "ãƒªã‚¹ã‚¯ç®¡ç†ã‚’å¿˜ã‚Œãšã«æ–°ã—ã„æŒ‘æˆ¦ã‚’"
                ]
            };
            
            // ä¸¡æ–¹ã®å½¢å¼ã§ä¿å­˜ï¼ˆäº’æ›æ€§ã®ãŸã‚ï¼‰
            localStorage.setItem('haqei_analysis_result', JSON.stringify(mockAnalysisResult));
            localStorage.setItem('haqei_emergency_result', JSON.stringify({
                result: mockAnalysisResult,
                insights: mockInsights
            }));
            localStorage.setItem('haqei_insights', JSON.stringify({ insights: mockInsights }));
            
            log('ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½œæˆå®Œäº†', 'success');
            
            // ç”»é¢ã‚’æ›´æ–°
            checkLocalStorage();
            analyzeDataStructure();
        }
        
        function testVirtualPersonaView() {
            log('VirtualPersonaView ãƒ†ã‚¹ãƒˆé–‹å§‹...', 'info');
            window.open('results.html', '_blank');
        }
        
        function clearAllData() {
            if (confirm('æœ¬å½“ã«å…¨ã¦ã®HAQEIãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                const keys = Object.keys(localStorage).filter(k => k.includes('haqei'));
                keys.forEach(key => {
                    localStorage.removeItem(key);
                    log(`å‰Šé™¤: ${key}`, 'warning');
                });
                log('å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢å®Œäº†', 'success');
                checkLocalStorage();
                analyzeDataStructure();
            }
        }
        
        function goToAnalyzer() {
            window.location.href = 'os_analyzer.html';
        }
        
        function goToResults() {
            window.location.href = 'results.html';
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«èµ·å‹•', 'info');
            checkLocalStorage();
            analyzeDataStructure();
        });
    </script>
</body>
</html>