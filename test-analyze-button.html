<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分析開始ボタンテスト</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #f8fafc;
            padding: 2rem;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        h1 {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 2rem;
        }
        .status {
            padding: 1rem;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        .error {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }
        .button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 1rem;
            transition: all 0.3s ease;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
        }
        .test-results {
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>OS Analyzer 分析開始ボタン動作テスト</h1>
        
        <div class="test-section">
            <h2>テスト概要</h2>
            <p>このテストでは、OS Analyzerの最後の設問（q30）で「分析開始」ボタンが正しく表示され、動作するかを確認します。</p>
        </div>

        <div class="test-section">
            <h2>テスト手順</h2>
            <ol>
                <li>OS Analyzerを開く</li>
                <li>設問に順番に回答していく（テスト用に高速で進める）</li>
                <li>q30に到達したときにボタンが「分析開始 →」に変わることを確認</li>
                <li>q30に回答後、「分析開始」ボタンをクリック</li>
                <li>分析が開始されることを確認</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>テスト実行</h2>
            <button class="button" onclick="openOSAnalyzer()">OS Analyzerを開く</button>
            <button class="button" onclick="testNavigationButtons()">ナビゲーションボタンテスト</button>
            <button class="button" onclick="checkLocalStorage()">LocalStorage確認</button>
            
            <div class="test-results" id="testResults"></div>
        </div>

        <div class="test-section">
            <h2>実装確認項目</h2>
            <ul>
                <li>✅ VirtualQuestionFlow.js の updateNavigationButtons() メソッドが修正済み</li>
                <li>✅ 最後の設問でボタンテキストが「分析開始 →」に変更される</li>
                <li>✅ analyze-button クラスが追加される</li>
                <li>✅ bindEvents() でクリックハンドラーが適切に設定されている</li>
                <li>✅ CSSでanalyze-buttonのスタイルが定義されている（パルスアニメーション付き）</li>
            </ul>
        </div>
    </div>

    <script>
        function openOSAnalyzer() {
            window.open('http://localhost:3000/os_analyzer.html', '_blank');
        }

        function testNavigationButtons() {
            const results = document.getElementById('testResults');
            results.innerHTML = `
                <div class="status">
                    <h3>ナビゲーションボタンのコード確認</h3>
                    <pre>// 最後の設問かチェック
const isLastQuestion = this.currentQuestionIndex === this.questions.length - 1;

if (isLastQuestion) {
  // 最後の設問の場合、ボタンテキストを「分析開始」に変更
  nextBtn.textContent = '分析開始 →';
  nextBtn.classList.add('analyze-button');
  nextBtn.disabled = !hasAnswer;
  
  console.log('🎯 Last question reached - showing "分析開始" button');
} else {
  // それ以外は通常の「次の質問」
  nextBtn.textContent = '次の質問 →';
  nextBtn.classList.remove('analyze-button');
  nextBtn.disabled = !hasAnswer;
}</pre>
                    <p>✅ コードは正しく実装されています</p>
                </div>
            `;
        }

        function checkLocalStorage() {
            const results = document.getElementById('testResults');
            const session = localStorage.getItem('haqei_session');
            const answers = localStorage.getItem('haqei_answers');
            
            let html = '<div class="status"><h3>LocalStorage状態</h3>';
            
            if (session) {
                const sessionData = JSON.parse(session);
                html += `<p><strong>セッション:</strong></p><pre>${JSON.stringify(sessionData, null, 2)}</pre>`;
            } else {
                html += '<p class="error">セッションデータが見つかりません</p>';
            }
            
            if (answers) {
                const answersData = JSON.parse(answers);
                html += `<p><strong>回答数:</strong> ${answersData.length}</p>`;
                if (answersData.length === 30) {
                    html += '<p>✅ 全30問の回答が保存されています</p>';
                } else {
                    html += `<p>⚠️ ${answersData.length}/30問が回答済みです</p>`;
                }
            } else {
                html += '<p class="error">回答データが見つかりません</p>';
            }
            
            html += '</div>';
            results.innerHTML = html;
        }

        // ページ読み込み時に自動でLocalStorageをチェック
        window.addEventListener('load', () => {
            setTimeout(checkLocalStorage, 1000);
        });
    </script>
</body>
</html>