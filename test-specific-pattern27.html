<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>パターン27具体的デバッグ</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
            line-height: 1.6;
        }
        .debug-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #444; 
            border-radius: 8px; 
            background: rgba(0,0,0,0.3);
        }
        .highlight { 
            color: #22d3ee; 
            font-weight: bold; 
        }
        button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>🔍 パターン27 vs 他パターンの詳細比較</h1>
    <p>なぜパターン27だけが特殊表現になるかを具体的に調査</p>
    
    <button onclick="comparePatterns()">🎯 パターン比較実行</button>
    
    <div id="results"></div>

    <script src="./public/assets/H384H64database.js"></script>
    <script src="./public/js/core/TripleOSInteractionAnalyzer.js"></script>
    <script>
        function comparePatterns() {
            const results = document.getElementById('results');
            results.innerHTML = '<div>🔄 比較分析中...</div>';
            
            try {
                const analyzer = new TripleOSInteractionAnalyzer();
                
                // パターン27 (実際は28番目) = [45, 62, 53]
                // パターン1 = [51, 59, 53]
                // パターン2 = [56, 9, 59]
                
                const comparePatterns = [
                    { name: 'Pattern 1', pattern: [51, 59, 53] },
                    { name: 'Pattern 2', pattern: [56, 9, 59] },
                    { name: 'Pattern 27 (実際28)', pattern: [45, 62, 53] },
                ];
                
                let html = '<h2>🔍 詳細比較結果</h2>';
                
                comparePatterns.forEach(({ name, pattern: [e, iface, s] }) => {
                    const engineOS = { hexagramId: e, name: `第${e}卦`, score: 0.5 };
                    const interfaceOS = { hexagramId: iface, name: `第${iface}卦`, score: 0.5 };
                    const safeModeOS = { hexagramId: s, name: `第${s}卦`, score: 0.5 };
                    
                    // 卦の特徴取得
                    const char1 = analyzer.getHexagramCharacteristics(e);
                    const char2 = analyzer.getHexagramCharacteristics(iface);
                    const char3 = analyzer.getHexagramCharacteristics(s);
                    
                    // Engine-Interface間のキーワード組み合わせ分析
                    console.log(`${name} - Engine(${e}): ${char1.name}`, char1.keywords);
                    console.log(`${name} - Interface(${iface}): ${char2.name}`, char2.keywords);
                    console.log(`${name} - Safe(${s}): ${char3.name}`, char3.keywords);
                    
                    const combinations = analyzer.analyzeKeywordCombination(char1, char2);
                    console.log(`${name} - Keyword combinations:`, combinations);
                    
                    // 実際の表現生成をテスト
                    const summary = analyzer.generateHumanRelatableDescription(char1, char2, 'engine-interface');
                    console.log(`${name} - Generated summary:`, summary);
                    
                    // 実際のanalyzeのパイプラインをテスト
                    const analysisResult = analyzer.analyzePair('engine-interface', engineOS, interfaceOS);
                    
                    html += `
                        <div class="debug-section">
                            <h3>${name}: Engine(${e}: ${char1.name}) × Interface(${iface}: ${char2.name})</h3>
                            
                            <div><strong>Engine キーワード:</strong> ${char1.keywords.join(', ')}</div>
                            <div><strong>Interface キーワード:</strong> ${char2.keywords.join(', ')}</div>
                            
                            <div><strong>Keyword Conflict Detection:</strong></div>
                            <ul>
                                <li>Speed Conflict: <span class="highlight">${combinations.speedConflict}</span></li>
                                <li>Value Conflict: <span class="highlight">${combinations.valueConflict}</span></li>
                                <li>Time Conflict: <span class="highlight">${combinations.timeConflict}</span></li>
                                <li>Direction Conflict: <span class="highlight">${combinations.directionConflict}</span></li>
                            </ul>
                            
                            <div><strong>生成された表現:</strong> 「${analysisResult.summary}」</div>
                            <div><strong>カテゴリ:</strong> ${analysisResult.category}</div>
                            <div><strong>シナジー値:</strong> ${analysisResult.synergy?.toFixed(3)}</div>
                        </div>
                    `;
                });
                
                results.innerHTML = html;
                
            } catch (error) {
                results.innerHTML = `
                    <div style="color: #ef4444; padding: 20px;">
                        ❌ 分析エラー: ${error.message}
                        <br>スタック: ${error.stack}
                    </div>
                `;
                console.error('比較分析エラー:', error);
            }
        }
    </script>
</body>
</html>