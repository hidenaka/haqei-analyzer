<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI Help System Integration Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }
        .demo-elements {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .demo-card {
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
        }
        .demo-card h4 {
            margin-top: 0;
            color: #495057;
        }
        #console-output {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
            border: 2px solid #444;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ†˜ HAQEI Help System Integration Test</h1>
        <p>HAQEIãƒ˜ãƒ«ãƒ—ã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆçŠ¶æ³ã‚’ãƒ†ã‚¹ãƒˆã—ã€ã™ã¹ã¦ã®æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
        
        <div id="test-results"></div>
        
        <div class="test-section">
            <h3>ğŸ§ª ãƒ˜ãƒ«ãƒ—ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="testHelpSystemIntegration()">çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button onclick="testHelpSystemFiles()">ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª</button>
            <button onclick="testHelpButtonFunctionality()">ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testTooltipSystem()">ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testModalSystem()">ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ¯ ãƒ‡ãƒ¢è¦ç´ </h3>
            <p>ä»¥ä¸‹ã®è¦ç´ ã¯ãƒ˜ãƒ«ãƒ—ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã£ã¦è‡ªå‹•å¼·åŒ–ã•ã‚Œã¾ã™ï¼š</p>
            <div class="demo-elements">
                <div class="demo-card">
                    <h4 data-help-key="bunenjin">åˆ†äºº (Bunenjin)</h4>
                    <p>ä¸€äººã²ã¨ã‚Šã®äººé–“ãŒæŒã¤ã€è¤‡æ•°ã®ã€Œäººæ ¼ã€ã‚„ã€Œå´é¢ã€ã®æ¦‚å¿µã§ã™ã€‚</p>
                </div>
                
                <div class="demo-card">
                    <h4 data-help-key="triple-os">Triple OS</h4>
                    <p>Engine OSã€Interface OSã€SafeMode OSã®3ã¤ã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã€‚</p>
                </div>
                
                <div class="demo-card">
                    <h4 data-help-key="iching">æ˜“çµŒ (I Ching)</h4>
                    <p>å¤ä»£ä¸­å›½ã®å è¡“ãƒ»å“²å­¦ä½“ç³»ã€‚64å¦ã¨386çˆ»ã‹ã‚‰æ§‹æˆã•ã‚Œã¾ã™ã€‚</p>
                </div>
                
                <div class="demo-card">
                    <h4 data-help-key="hexagram">å¦ (Hexagram)</h4>
                    <p>æ˜“çµŒã®åŸºæœ¬å˜ä½ã€‚6ã¤ã®çˆ»ï¼ˆç·šï¼‰ã‹ã‚‰æ§‹æˆã•ã‚Œã‚‹64é€šã‚Šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚</p>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ® æ‰‹å‹•ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="showManualTestInstructions()">æ‰‹å‹•ãƒ†ã‚¹ãƒˆæ‰‹é †è¡¨ç¤º</button>
            <button onclick="openOriginalPage()">å…ƒã®os_analyzer.htmlã‚’é–‹ã</button>
        </div>
        
        <div id="console-output"></div>
    </div>

    <script>
        let consoleOutput = '';
        
        // Console capture
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function logToDisplay(level, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleOutput += `[${timestamp}] ${level.toUpperCase()}: ${message}\n`;
            updateConsoleDisplay();
        }
        
        console.log = (...args) => {
            originalLog(...args);
            logToDisplay('log', ...args);
        };
        
        console.error = (...args) => {
            originalError(...args);
            logToDisplay('error', ...args);
        };
        
        console.warn = (...args) => {
            originalWarn(...args);
            logToDisplay('warn', ...args);
        };
        
        function updateConsoleDisplay() {
            const consoleDiv = document.getElementById('console-output');
            consoleDiv.textContent = consoleOutput;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function addResult(type, title, message) {
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `
                <span class="status-indicator status-${type}"></span>
                <div>
                    <strong>${title}</strong><br>
                    ${message}
                </div>
            `;
            document.getElementById('test-results').appendChild(resultDiv);
            console.log(`[${type.toUpperCase()}] ${title}: ${message}`);
        }
        
        async function testHelpSystemIntegration() {
            console.log('ğŸ§ª Testing HAQEI Help System Integration...');
            addResult('info', 'ãƒ†ã‚¹ãƒˆé–‹å§‹', 'ãƒ˜ãƒ«ãƒ—ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™');
            
            // Test 1: Check if CSS files are loaded
            const cssFiles = ['help-system.css', 'help-animations.css'];
            let cssLoaded = 0;
            
            for (const cssFile of cssFiles) {
                const links = document.querySelectorAll('link[rel="stylesheet"]');
                const found = Array.from(links).some(link => link.href.includes(cssFile));
                if (found) {
                    addResult('success', `CSSç¢ºèª`, `${cssFile} ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™`);
                    cssLoaded++;
                } else {
                    addResult('warning', `CSSè­¦å‘Š`, `${cssFile} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                }
            }
            
            // Test 2: Check JavaScript dependencies
            const jsComponents = [
                { name: 'HelpSystemCore', obj: window.HelpSystemCore },
                { name: 'HelpSystemUI', obj: window.HelpSystemUI },
                { name: 'HelpButton', obj: window.HelpButton },
                { name: 'HelpModal', obj: window.HelpModal },
                { name: 'TooltipManager', obj: window.TooltipManager }
            ];
            
            let jsLoaded = 0;
            for (const component of jsComponents) {
                if (component.obj && typeof component.obj === 'function') {
                    addResult('success', `JSç¢ºèª`, `${component.name} ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã§ã™`);
                    jsLoaded++;
                } else {
                    addResult('warning', `JSè­¦å‘Š`, `${component.name} ã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                }
            }
            
            // Test 3: Check global help system instance
            if (window.haqeiHelpSystem) {
                addResult('success', 'ã‚·ã‚¹ãƒ†ãƒ ç¢ºèª', 'ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ˜ãƒ«ãƒ—ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå­˜åœ¨ã—ã¾ã™');
            } else {
                addResult('warning', 'ã‚·ã‚¹ãƒ†ãƒ è­¦å‘Š', 'ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ˜ãƒ«ãƒ—ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            // Summary
            const totalComponents = cssFiles.length + jsComponents.length + 1;
            const loadedComponents = cssLoaded + jsLoaded + (window.haqeiHelpSystem ? 1 : 0);
            
            if (loadedComponents === totalComponents) {
                addResult('success', 'çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†', `ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (${loadedComponents}/${totalComponents}) ãŒæ­£å¸¸ã«çµ±åˆã•ã‚Œã¦ã„ã¾ã™`);
            } else {
                addResult('warning', 'çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†', `ä¸€éƒ¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å•é¡ŒãŒã‚ã‚Šã¾ã™ (${loadedComponents}/${totalComponents})`);
            }
        }
        
        async function testHelpSystemFiles() {
            console.log('ğŸ“ Testing help system file structure...');
            
            const filesToTest = [
                '/js/help-system/core/HelpSystemCore.js',
                '/js/help-system/ui/HelpSystemUI.js',
                '/js/help-system/ui/HelpButton.js',
                '/js/help-system/ui/HelpModal.js',
                '/js/help-system/ui/TooltipManager.js',
                '/css/help-system.css',
                '/css/help-animations.css'
            ];
            
            for (const file of filesToTest) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        addResult('success', 'ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª', `${file} ãŒå­˜åœ¨ã—ã¾ã™`);
                    } else {
                        addResult('error', 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼', `${file} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (${response.status})`);
                    }
                } catch (error) {
                    addResult('error', 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼', `${file} ã®ç¢ºèªä¸­ã«ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
        }
        
        function testHelpButtonFunctionality() {
            console.log('ğŸ”˜ Testing help button functionality...');
            
            if (typeof showHaqeiHelp === 'function') {
                addResult('success', 'ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³', 'showHaqeiHelpé–¢æ•°ãŒåˆ©ç”¨å¯èƒ½ã§ã™');
                
                // Test help button call
                try {
                    showHaqeiHelp('bunenjin', 'concept');
                    addResult('success', 'ãƒ˜ãƒ«ãƒ—è¡¨ç¤º', 'ãƒ˜ãƒ«ãƒ—ã®è¡¨ç¤ºãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸ');
                } catch (error) {
                    addResult('error', 'ãƒ˜ãƒ«ãƒ—è¡¨ç¤ºã‚¨ãƒ©ãƒ¼', `ãƒ˜ãƒ«ãƒ—è¡¨ç¤ºã§ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            } else {
                addResult('warning', 'ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³', 'showHaqeiHelpé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        }
        
        function testTooltipSystem() {
            console.log('ğŸ’¬ Testing tooltip system...');
            
            if (typeof addHaqeiTooltip === 'function') {
                addResult('success', 'ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—', 'addHaqeiTooltipé–¢æ•°ãŒåˆ©ç”¨å¯èƒ½ã§ã™');
                
                // Test tooltip on demo elements
                const demoElements = document.querySelectorAll('[data-help-key]');
                if (demoElements.length > 0) {
                    addResult('success', 'ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¦ç´ ', `${demoElements.length}å€‹ã®ãƒ˜ãƒ«ãƒ—å¯¾è±¡è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`);
                    
                    // Test tooltip addition
                    try {
                        demoElements.forEach(element => {
                            const helpKey = element.getAttribute('data-help-key');
                            addHaqeiTooltip(element, helpKey, 'concept');
                        });
                        addResult('success', 'ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¿½åŠ ', 'ãƒ‡ãƒ¢è¦ç´ ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ');
                    } catch (error) {
                        addResult('error', 'ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚¨ãƒ©ãƒ¼', `ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¿½åŠ ã§ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    }
                } else {
                    addResult('warning', 'ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¦ç´ ', 'ãƒ˜ãƒ«ãƒ—å¯¾è±¡è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            } else {
                addResult('warning', 'ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—', 'addHaqeiTooltipé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        }
        
        function testModalSystem() {
            console.log('ğŸ—‚ï¸ Testing modal system...');
            
            if (window.haqeiHelpSystem && window.haqeiHelpSystem.showModal) {
                addResult('success', 'ãƒ¢ãƒ¼ãƒ€ãƒ«', 'ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ«æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã§ã™');
                
                try {
                    // Test modal display
                    window.haqeiHelpSystem.showModal('test', {
                        title: 'ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«',
                        content: 'ã“ã‚Œã¯ãƒ˜ãƒ«ãƒ—ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«ã§ã™ã€‚'
                    });
                    addResult('success', 'ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º', 'ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã¾ã—ãŸ');
                } catch (error) {
                    addResult('error', 'ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¨ãƒ©ãƒ¼', `ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºã§ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            } else {
                addResult('warning', 'ãƒ¢ãƒ¼ãƒ€ãƒ«', 'ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ«æ©Ÿèƒ½ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        }
        
        function showManualTestInstructions() {
            const instructions = `
ğŸ“‹ æ‰‹å‹•ãƒ†ã‚¹ãƒˆæ‰‹é †ï¼š

1. å³ä¸‹ã®ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦ãã ã•ã„
2. ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ãã‹ç¢ºèª
3. ãƒ‡ãƒ¢è¦ç´ ï¼ˆåˆ†äººã€Triple OSç­‰ï¼‰ã«ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ã—ã¦ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’ç¢ºèª
4. ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆTabã€Enterã€Escapeï¼‰ã‚’ãƒ†ã‚¹ãƒˆ
5. ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã®ç¢ºèªï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‚µã‚¤ã‚ºå¤‰æ›´ï¼‰

æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œï¼š
- ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- é©åˆ‡ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤º
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ©Ÿèƒ½ã®å‹•ä½œ
- ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„ã“ã¨
            `;
            
            addResult('info', 'æ‰‹å‹•ãƒ†ã‚¹ãƒˆæ‰‹é †', instructions);
            console.log(instructions);
        }
        
        function openOriginalPage() {
            window.open('/os_analyzer.html', '_blank');
            addResult('info', 'ãƒšãƒ¼ã‚¸ã‚ªãƒ¼ãƒ—ãƒ³', 'os_analyzer.htmlã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã¾ã—ãŸ');
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            consoleOutput = '';
            document.getElementById('console-output').textContent = '';
            addResult('info', 'çµæœã‚¯ãƒªã‚¢', 'ãƒ†ã‚¹ãƒˆçµæœãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ');
        }
        
        // Initialize
        window.addEventListener('load', () => {
            console.log('ğŸ†˜ HAQEI Help System Integration Test initialized');
            addResult('info', 'ãƒ†ã‚¹ãƒˆé–‹å§‹', 'HAQEIãƒ˜ãƒ«ãƒ—ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ');
        });
    </script>
</body>
</html>