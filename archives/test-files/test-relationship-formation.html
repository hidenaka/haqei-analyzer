<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relationship Formation Test - HAQEI Analyzer</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .test-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .test-btn:hover {
            background: #2980b9;
        }
        
        .test-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }
        
        #personality-construction-test {
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            background: #2c3e50;
            min-height: 400px;
        }
        
        .status-display {
            background: #34495e;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .status-item {
            margin: 5px 0;
            padding: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        .error-display {
            background: #e74c3c;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        
        .success-display {
            background: #27ae60;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ”— Relationship Formation Test</h1>
            <p>PersonalityConstructionView.js ã® showRelationshipFormation ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ†ã‚¹ãƒˆ</p>
        </div>
        
        <div class="test-controls">
            <button id="test-basic" class="test-btn">åŸºæœ¬ãƒ†ã‚¹ãƒˆ</button>
            <button id="test-with-data" class="test-btn">ãƒ‡ãƒ¼ã‚¿ä»˜ããƒ†ã‚¹ãƒˆ</button>
            <button id="test-error-handling" class="test-btn">ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</button>
            <button id="clear-test" class="test-btn">ã‚¯ãƒªã‚¢</button>
        </div>
        
        <div class="status-display">
            <h3>ğŸ“Š ãƒ†ã‚¹ãƒˆçŠ¶æ³</h3>
            <div id="test-status">
                <div class="status-item">æº–å‚™å®Œäº† - ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
            </div>
        </div>
        
        <div class="error-display" id="error-display"></div>
        <div class="success-display" id="success-display"></div>
        
        <div id="personality-construction-test">
            <!-- PersonalityConstructionView ãŒã“ã“ã«æç”»ã•ã‚Œã¾ã™ -->
        </div>
    </div>

    <!-- BaseComponent ã®ä»®å®Ÿè£… -->
    <script>
        class BaseComponent {
            constructor(containerId) {
                this.containerId = containerId;
                this.container = document.getElementById(containerId);
                if (!this.container) {
                    throw new Error(`Container with id '${containerId}' not found`);
                }
            }
        }

        // MCP ãƒ•ãƒƒã‚¯ ã®ä»®å®Ÿè£…
        window.mcpHooks = {
            logPhase: (phase, data) => {
                console.log(`ğŸ”— MCP Hook - Phase: ${phase}`, data);
                updateTestStatus(`MCP Hook: ${phase} - ${data.phase || 'N/A'}`);
            },
            logError: (errorType, data) => {
                console.error(`âŒ MCP Hook - Error: ${errorType}`, data);
                updateTestStatus(`MCP Error: ${errorType} - ${data.error || 'Unknown error'}`);
            }
        };

        function updateTestStatus(message) {
            const statusDiv = document.getElementById('test-status');
            const statusItem = document.createElement('div');
            statusItem.className = 'status-item';
            statusItem.innerHTML = `<span style="color: #3498db;">${new Date().toLocaleTimeString()}</span> - ${message}`;
            statusDiv.appendChild(statusItem);
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-display');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success-display');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        // ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
        const sampleVirtualPersonality = {
            id: 'test-personality-001',
            engineOS: {
                osName: 'Creative Engine',
                characteristics: {
                    primary_traits: ['å‰µé€ æ€§', 'è«–ç†æ€§', 'ä¾¡å€¤åˆ¤æ–­']
                },
                activation: 0.75
            },
            interfaceOS: {
                osName: 'Social Interface',
                characteristics: {
                    primary_traits: ['å”èª¿æ€§', 'ç¤¾äº¤æ€§', 'é©å¿œæ€§']
                },
                activation: 0.65
            },
            safeModeOS: {
                osName: 'Guardian SafeMode',
                characteristics: {
                    primary_traits: ['ä¿è­·æ€§', 'æ…é‡æ€§', 'å®‰å®šæ€§']
                },
                activation: 0.80
            },
            personalityState: {
                currentDominantOS: 'engine',
                balance: { engine: 0.4, interface: 0.35, safemode: 0.25 }
            },
            personalityMetadata: {
                personalityType: 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–çµ±åˆå‹',
                createdAt: new Date().toISOString()
            }
        };
    </script>

    <!-- PersonalityConstructionView.js ã‚’èª­ã¿è¾¼ã¿ -->
    <script src="js/os-analyzer/components/PersonalityConstructionView.js"></script>

    <script>
        let personalityView = null;

        // ãƒ†ã‚¹ãƒˆé–¢æ•°
        async function runBasicTest() {
            try {
                updateTestStatus('åŸºæœ¬ãƒ†ã‚¹ãƒˆé–‹å§‹...');
                
                if (personalityView) {
                    personalityView = null;
                }

                personalityView = new PersonalityConstructionView('personality-construction-test');
                updateTestStatus('PersonalityConstructionView ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆå®Œäº†');

                // showRelationshipFormation ãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨ç¢ºèª
                if (typeof personalityView.showRelationshipFormation === 'function') {
                    updateTestStatus('âœ… showRelationshipFormation ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ã¾ã™');
                    
                    // åŸºæœ¬çš„ãªä»®æƒ³äººæ ¼ãƒ‡ãƒ¼ã‚¿ã§å®Ÿè¡Œ
                    personalityView.virtualPersonality = sampleVirtualPersonality;
                    personalityView.animationSpeed = 3.0; // é«˜é€Ÿãƒ†ã‚¹ãƒˆ
                    
                    await personalityView.showRelationshipFormation();
                    showSuccess('âœ… åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Œäº† - showRelationshipFormation ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã¾ã—ãŸ');
                    
                } else {
                    throw new Error('showRelationshipFormation ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }

            } catch (error) {
                console.error('Basic test failed:', error);
                showError(`åŸºæœ¬ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateTestStatus(`âŒ åŸºæœ¬ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        async function runDataTest() {
            try {
                updateTestStatus('ãƒ‡ãƒ¼ã‚¿ä»˜ããƒ†ã‚¹ãƒˆé–‹å§‹...');
                
                if (!personalityView) {
                    personalityView = new PersonalityConstructionView('personality-construction-test');
                }

                // è¤‡é›‘ãªãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§å®Ÿè¡Œ
                personalityView.virtualPersonality = sampleVirtualPersonality;
                personalityView.animationSpeed = 2.0;
                
                await personalityView.showRelationshipFormation();
                showSuccess('âœ… ãƒ‡ãƒ¼ã‚¿ä»˜ããƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                console.error('Data test failed:', error);
                showError(`ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateTestStatus(`âŒ ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        async function runErrorHandlingTest() {
            try {
                updateTestStatus('ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆé–‹å§‹...');
                
                if (!personalityView) {
                    personalityView = new PersonalityConstructionView('personality-construction-test');
                }

                // æ„å›³çš„ã«å•é¡Œã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã§å®Ÿè¡Œ
                personalityView.virtualPersonality = null; // null ãƒ‡ãƒ¼ã‚¿ã§ãƒ†ã‚¹ãƒˆ
                personalityView.animationSpeed = 5.0;
                
                await personalityView.showRelationshipFormation();
                showSuccess('âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆå®Œäº† - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ãŒæ­£å¸¸ã«å‹•ä½œ');
                updateTestStatus('âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã—ãŸ');
                
            } catch (error) {
                console.error('Error handling test failed:', error);
                showError(`ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateTestStatus(`âŒ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        function clearTest() {
            const container = document.getElementById('personality-construction-test');
            container.innerHTML = '';
            
            const statusDiv = document.getElementById('test-status');
            statusDiv.innerHTML = '<div class="status-item">ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¢å®Œäº† - æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã§ãã¾ã™</div>';
            
            personalityView = null;
            updateTestStatus('ğŸ”„ ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        document.getElementById('test-basic').addEventListener('click', runBasicTest);
        document.getElementById('test-with-data').addEventListener('click', runDataTest);
        document.getElementById('test-error-handling').addEventListener('click', runErrorHandlingTest);
        document.getElementById('clear-test').addEventListener('click', clearTest);

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateTestStatus('ğŸš€ ãƒ†ã‚¹ãƒˆç’°å¢ƒåˆæœŸåŒ–å®Œäº†');
            updateTestStatus('PersonalityConstructionView.js èª­ã¿è¾¼ã¿å®Œäº†');
        });
    </script>
</body>
</html>