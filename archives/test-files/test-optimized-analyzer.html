<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none';">
    <title>æœ€é©åŒ–ç‰ˆ çŠ¶æ³åˆ†æã‚·ã‚¹ãƒ†ãƒ  - ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .control-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .mode-selector {
            margin-bottom: 15px;
        }
        
        .mode-selector label {
            margin-right: 20px;
            cursor: pointer;
        }
        
        .mode-selector input[type="radio"] {
            margin-right: 5px;
        }
        
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            resize: vertical;
        }
        
        .button-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        button.secondary {
            background-color: #2196F3;
        }
        
        button.secondary:hover {
            background-color: #1976D2;
        }
        
        .progress-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background-color: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .phase-info {
            text-align: center;
            color: #666;
            margin-top: 10px;
        }
        
        .results-container {
            margin-top: 30px;
        }
        
        .result-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .result-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .status-indicator.error {
            background: #ffebee;
            color: #c62828;
        }
        
        .status-indicator.warning {
            background: #fff3e0;
            color: #e65100;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #4CAF50;
        }
        
        .status-dot.error {
            background-color: #f44336;
        }
        
        .status-dot.warning {
            background-color: #ff9800;
        }
        
        .performance-stats {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .error-log {
            background: #ffebee;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <h1>ğŸš€ æœ€é©åŒ–ç‰ˆ çŠ¶æ³åˆ†æã‚·ã‚¹ãƒ†ãƒ  - ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="control-panel">
        <div class="mode-selector">
            <label>
                <input type="radio" name="mode" value="optimized" checked>
                æœ€é©åŒ–ç‰ˆï¼ˆWeb Workerä½¿ç”¨ï¼‰
            </label>
            <label>
                <input type="radio" name="mode" value="standard">
                æ¨™æº–ç‰ˆï¼ˆæ¯”è¼ƒç”¨ï¼‰
            </label>
        </div>
        
        <h2>ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›</h2>
        <textarea id="inputText" placeholder="ã‚ãªãŸã®çŠ¶æ³ã‚„æ‚©ã¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...">æœ€è¿‘ã€é•·å¹´å‹¤ã‚ãŸä¼šç¤¾ã§ã‚¿ã‚¯ã‚·ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¨ã—ã¦åƒããªãŒã‚‰ã€AIé–‹ç™ºã®å‹‰å¼·ã‚’å§‹ã‚ã¾ã—ãŸã€‚å°†æ¥ã¸ã®ä¸å®‰ã‚‚ã‚ã‚Šã¾ã™ãŒã€æ–°ã—ã„æŒ‘æˆ¦ã«ãƒ¯ã‚¯ãƒ¯ã‚¯ã—ã¦ã„ã¾ã™ã€‚å®¶æ—ã¯å¿ƒé…ã—ã¦ã„ã¾ã™ãŒã€è‡ªåˆ†ã®å¯èƒ½æ€§ã‚’ä¿¡ã˜ã¦é€²ã¿ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚</textarea>
        
        <div class="button-container">
            <button onclick="analyzeText()" id="analyzeButton">åˆ†æé–‹å§‹</button>
            <button onclick="checkHealth()" class="secondary">ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</button>
            <button onclick="showErrorLog()" class="secondary">ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°</button>
        </div>
    </div>
    
    <div class="status-indicator" id="statusIndicator">
        <span class="status-dot"></span>
        <span id="statusText">ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†</span>
    </div>
    
    <div class="progress-container" id="progressContainer">
        <h3>åˆ†æé€²è¡ŒçŠ¶æ³</h3>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
        </div>
        <div class="phase-info" id="phaseInfo">æº–å‚™ä¸­...</div>
    </div>
    
    <div class="results-container" id="results" style="display: none;">
        <!-- çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
    </div>
    
    <div class="performance-stats" id="performanceStats" style="display: none;">
        <h3>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ</h3>
        <div id="statsContent"></div>
    </div>
    
    <div class="error-log" id="errorLog" style="display: none;">
        <h3>ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°</h3>
        <pre id="errorLogContent"></pre>
    </div>

    <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ -->
    <script src="public/js/situation-analyzer/ErrorHandler.js"></script>
    <script src="public/js/situation-analyzer/HexagramDatabase.js"></script>
    <script src="public/js/situation-analyzer/TextVectorizer.js"></script>
    <script src="public/js/situation-analyzer/SituationClassifier.js"></script>
    <script src="public/js/situation-analyzer/DynamicIChingMapper.js"></script>
    <script src="public/js/situation-analyzer/UltraSituationAnalyzer.js"></script>
    <script src="public/js/situation-analyzer/OptimizedAnalyzer.js"></script>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let optimizedAnalyzer = null;
        let standardAnalyzer = null;
        let startTime = null;
        
        /**
         * åˆæœŸåŒ–
         * 
         * ç›®çš„ï¼š
         * - å„ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
         * - åˆæœŸçŠ¶æ…‹ã®è¨­å®š
         */
        function initialize() {
            try {
                // æœ€é©åŒ–ç‰ˆã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼
                optimizedAnalyzer = new OptimizedSituationAnalyzer();
                
                // æ¨™æº–ç‰ˆã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ï¼ˆæ¯”è¼ƒç”¨ï¼‰
                standardAnalyzer = new UltraSituationAnalyzer();
                
                updateStatus('ready', 'ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
                console.log('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
                
            } catch (error) {
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                updateStatus('error', 'åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        /**
         * ãƒ†ã‚­ã‚¹ãƒˆåˆ†æå®Ÿè¡Œ
         */
        async function analyzeText() {
            const inputText = document.getElementById('inputText').value.trim();
            
            if (!inputText) {
                alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // å…¥åŠ›æ¤œè¨¼
            if (!validateInput(inputText)) {
                alert('å…¥åŠ›ã«ä¸æ­£ãªæ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã¾ã™');
                return;
            }
            
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const button = document.getElementById('analyzeButton');
            const progressContainer = document.getElementById('progressContainer');
            const resultsContainer = document.getElementById('results');
            
            // UIåˆæœŸåŒ–
            button.disabled = true;
            button.textContent = 'åˆ†æä¸­...';
            progressContainer.style.display = 'block';
            resultsContainer.style.display = 'none';
            clearResults();
            
            startTime = performance.now();
            
            try {
                let result;
                
                if (mode === 'optimized') {
                    // æœ€é©åŒ–ç‰ˆï¼ˆãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ï¼‰
                    updateStatus('processing', 'Web Workerä½¿ç”¨ä¸­');
                    result = await optimizedAnalyzer.analyzeWithProgress(
                        inputText,
                        updateProgress,
                        { includeVector: false }
                    );
                } else {
                    // æ¨™æº–ç‰ˆ
                    updateStatus('processing', 'æ¨™æº–ç‰ˆã§åˆ†æä¸­');
                    updateProgress(0, 'starting');
                    result = await standardAnalyzer.analyze(inputText);
                    updateProgress(100, 'complete');
                }
                
                const endTime = performance.now();
                const processingTime = endTime - startTime;
                
                // çµæœè¡¨ç¤º
                displayResults(result, processingTime);
                updateStatus('ready', 'åˆ†æå®Œäº†');
                
            } catch (error) {
                console.error('åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                displayError(error);
                updateStatus('error', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                
            } finally {
                button.disabled = false;
                button.textContent = 'åˆ†æé–‹å§‹';
            }
        }
        
        /**
         * ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
         */
        function updateProgress(progress, phase) {
            const progressFill = document.getElementById('progressFill');
            const phaseInfo = document.getElementById('phaseInfo');
            
            progressFill.style.width = `${progress}%`;
            progressFill.textContent = `${progress}%`;
            
            const phaseTexts = {
                'starting': 'åˆ†æã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...',
                'vectorization': 'ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã¦ã„ã¾ã™...',
                'classification': 'çŠ¶æ³ã‚’åˆ†é¡ã—ã¦ã„ã¾ã™...',
                'mapping': 'æ˜“çµŒã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦ã„ã¾ã™...',
                'integration': 'çµæœã‚’çµ±åˆã—ã¦ã„ã¾ã™...',
                'complete': 'åˆ†æå®Œäº†ï¼'
            };
            
            phaseInfo.textContent = phaseTexts[phase] || phase;
        }
        
        /**
         * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
         */
        function updateStatus(status, text) {
            const indicator = document.getElementById('statusIndicator');
            const statusDot = indicator.querySelector('.status-dot');
            const statusText = document.getElementById('statusText');
            
            // ã‚¯ãƒ©ã‚¹ãƒªã‚»ãƒƒãƒˆ
            indicator.className = 'status-indicator';
            statusDot.className = 'status-dot';
            
            if (status === 'error') {
                indicator.classList.add('error');
                statusDot.classList.add('error');
            } else if (status === 'warning') {
                indicator.classList.add('warning');
                statusDot.classList.add('warning');
            }
            
            statusText.textContent = text;
        }
        
        /**
         * çµæœè¡¨ç¤º
         */
        function displayResults(result, processingTime) {
            const container = document.getElementById('results');
            
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æƒ…å ±
            const performanceHtml = `
                <div class="result-section fade-in">
                    <h3>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h3>
                    <p><strong>å‡¦ç†æ™‚é–“:</strong> ${processingTime.toFixed(0)}ms</p>
                    <p><strong>åˆ†æãƒ¢ãƒ¼ãƒ‰:</strong> ${document.querySelector('input[name="mode"]:checked').value === 'optimized' ? 'Web Workeræœ€é©åŒ–ç‰ˆ' : 'æ¨™æº–ç‰ˆ'}</p>
                </div>
            `;
            
            // æ—¢å­˜ã®çµæœè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨
            const sections = [
                createSituationElement(result.situation),
                createIChingElement(result.iching),
                createInsightsElement(result.insights || []),
                createRecommendationsElement(result.recommendations || [])
            ];
            
            container.innerHTML = performanceHtml;
            sections.forEach(section => {
                if (section) {
                    section.classList.add('fade-in');
                    container.appendChild(section);
                }
            });
            
            container.style.display = 'block';
            
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆæ›´æ–°
            updatePerformanceStats(processingTime);
        }
        
        /**
         * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆæ›´æ–°
         */
        function updatePerformanceStats(processingTime) {
            const statsContainer = document.getElementById('performanceStats');
            const statsContent = document.getElementById('statsContent');
            
            const mode = document.querySelector('input[name="mode"]:checked').value;
            
            statsContent.innerHTML = `
                <p><strong>æœ€æ–°ã®å‡¦ç†æ™‚é–“:</strong> ${processingTime.toFixed(0)}ms</p>
                <p><strong>ä½¿ç”¨ãƒ¢ãƒ¼ãƒ‰:</strong> ${mode === 'optimized' ? 'Web Workeræœ€é©åŒ–ç‰ˆ' : 'æ¨™æº–ç‰ˆ'}</p>
                <p><strong>WorkerçŠ¶æ…‹:</strong> ${optimizedAnalyzer && optimizedAnalyzer.workerReady ? 'æ­£å¸¸' : 'ä½¿ç”¨ä¸å¯'}</p>
            `;
            
            statsContainer.style.display = 'block';
        }
        
        /**
         * ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
         */
        async function checkHealth() {
            updateStatus('processing', 'ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ä¸­...');
            
            try {
                const isHealthy = await optimizedAnalyzer.checkHealth();
                
                if (isHealthy) {
                    updateStatus('ready', 'Workeræ­£å¸¸å‹•ä½œä¸­');
                    alert('Web Workerã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™');
                } else {
                    updateStatus('warning', 'WorkerãŒå¿œç­”ã—ã¾ã›ã‚“');
                    alert('Web WorkerãŒå¿œç­”ã—ã¾ã›ã‚“ã€‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¾ã™ã€‚');
                }
            } catch (error) {
                updateStatus('error', 'ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—');
                alert('ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        /**
         * ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¡¨ç¤º
         */
        function showErrorLog() {
            const errorLog = document.getElementById('errorLog');
            const errorLogContent = document.getElementById('errorLogContent');
            
            const logs = window.situationAnalysisErrorHandler.getErrorLog();
            
            if (logs.length === 0) {
                errorLogContent.textContent = 'ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã¯ã‚ã‚Šã¾ã›ã‚“';
            } else {
                errorLogContent.textContent = JSON.stringify(logs, null, 2);
            }
            
            errorLog.style.display = errorLog.style.display === 'none' ? 'block' : 'none';
        }
        
        /**
         * çµæœã‚¯ãƒªã‚¢
         */
        function clearResults() {
            const container = document.getElementById('results');
            container.innerHTML = '';
            container.style.display = 'none';
        }
        
        /**
         * ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
         */
        function displayError(error) {
            const container = document.getElementById('results');
            
            const errorDiv = createElement('div', 'result-section error fade-in');
            const errorTitle = createElement('h3', null, 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            const errorMsg = createElement('p', null, error.message || 'Unknown error');
            
            errorDiv.appendChild(errorTitle);
            errorDiv.appendChild(errorMsg);
            
            if (error.userMessage) {
                const userMsg = createElement('p', null, error.userMessage);
                errorDiv.appendChild(userMsg);
            }
            
            container.innerHTML = '';
            container.appendChild(errorDiv);
            container.style.display = 'block';
        }
        
        // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆå‰ã®ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‹ã‚‰ç§»æ¤ï¼‰
        function validateInput(text) {
            if (text.length > 5000) return false;
            
            const dangerousPatterns = [
                /<script/i,
                /<iframe/i,
                /javascript:/i,
                /on\w+\s*=/i,
                /<img.*?onerror/i
            ];
            
            for (const pattern of dangerousPatterns) {
                if (pattern.test(text)) return false;
            }
            
            return true;
        }
        
        function createElement(tag, className, textContent) {
            const element = document.createElement(tag);
            if (className) element.className = className;
            if (textContent) element.textContent = textContent;
            return element;
        }
        
        // çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆé–¢æ•°ï¼ˆå‰ã®ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‹ã‚‰ç§»æ¤ï¼‰
        function createSituationElement(situation) {
            const section = createElement('div', 'result-section');
            const title = createElement('h3', null, 'ğŸ“Š çŠ¶æ³åˆ†æ');
            section.appendChild(title);
            
            const details = [
                `çŠ¶æ³ã‚¿ã‚¤ãƒ—: ${situation.archetype.name}ï¼ˆã‚¹ã‚³ã‚¢: ${situation.archetype.score.toFixed(1)}ï¼‰`,
                `æ™‚é–“çš„çŠ¶æ…‹: éå»: ${situation.temporal.past}, ç¾åœ¨: ${situation.temporal.present}, æœªæ¥: ${situation.temporal.future}`,
                `æ„Ÿæƒ…çŠ¶æ…‹: ãƒã‚¸ãƒ†ã‚£ãƒ–: ${situation.emotions.positive}, ãƒã‚¬ãƒ†ã‚£ãƒ–: ${situation.emotions.negative}`,
                `ä¿¡é ¼åº¦: ${(situation.confidence * 100).toFixed(0)}%`
            ];
            
            details.forEach(detail => {
                const p = createElement('p', null, detail);
                section.appendChild(p);
            });
            
            return section;
        }
        
        function createIChingElement(iching) {
            const section = createElement('div', 'result-section');
            const title = createElement('h3', null, 'â˜¯ï¸ æ˜“çµŒè§£é‡ˆ');
            section.appendChild(title);
            
            const hexInfo = createElement('div', 'hexagram-info');
            const hexTitle = createElement('h4', null, `${iching.hexagram.number}. ${iching.hexagram.name}`);
            const hexEssence = createElement('p', null, `æœ¬è³ª: ${iching.hexagram.essence.essence}`);
            const hexLine = createElement('p', null, `çˆ»ä½ç½®: ${iching.line.name} - ${iching.line.meaning}`);
            
            hexInfo.appendChild(hexTitle);
            hexInfo.appendChild(hexEssence);
            hexInfo.appendChild(hexLine);
            section.appendChild(hexInfo);
            
            return section;
        }
        
        function createInsightsElement(insights) {
            if (!insights || insights.length === 0) return null;
            
            const section = createElement('div', 'result-section');
            const title = createElement('h3', null, 'ğŸ’¡ æ´å¯Ÿ');
            section.appendChild(title);
            
            insights.forEach(insight => {
                const p = createElement('p', null, insight.content || insight);
                section.appendChild(p);
            });
            
            return section;
        }
        
        function createRecommendationsElement(recommendations) {
            if (!recommendations || recommendations.length === 0) return null;
            
            const section = createElement('div', 'result-section');
            const title = createElement('h3', null, 'ğŸ¯ æ¨å¥¨äº‹é …');
            section.appendChild(title);
            
            recommendations.forEach(rec => {
                const p = createElement('p', null, rec.action || rec);
                section.appendChild(p);
            });
            
            return section;
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', initialize);
        
        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', () => {
            if (optimizedAnalyzer) {
                optimizedAnalyzer.destroy();
            }
        });
    </script>
</body>
</html>