<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI統一エラーハンドリングシステム テスト v2.0.0</title>
    
    <!-- HAQEI Error Handling CSS -->
    <link rel="stylesheet" href="css/error-handling.css">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .test-header h1 {
            font-size: 2.5rem;
            color: #4a90e2;
            margin-bottom: 10px;
        }
        
        .test-header p {
            font-size: 1.1rem;
            color: #e0e0e0;
            margin-bottom: 20px;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(74, 144, 226, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(8px);
        }
        
        .test-section h2 {
            color: #4a90e2;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .test-button {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            border: none;
            border-radius: 8px;
            color: white;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .test-button:hover {
            background: linear-gradient(135deg, #357abd, #2968a3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
        }
        
        .test-button.danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .test-button.danger:hover {
            background: linear-gradient(135deg, #c82333, #bd2130);
        }
        
        .test-button.warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
        }
        
        .test-button.warning:hover {
            background: linear-gradient(135deg, #e0a800, #d39e00);
        }
        
        .status-display {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            line-height: 1.4;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: rgba(74, 144, 226, 0.1);
            border: 1px solid rgba(74, 144, 226, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4a90e2;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #e0e0e0;
        }
        
        .philosophy-display {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .philosophy-display h3 {
            color: #ffd700;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>🛡️ HAQEI統一エラーハンドリングシステム v2.0.0</h1>
            <p>bunenjin哲学・易経・Triple OS Architecture完全対応テストスイート</p>
            <div id="system-status" class="philosophy-display">
                <h3>🔮 システム状態</h3>
                <p id="status-text">初期化中...</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>🚨 エラータイプテスト</h2>
            <div class="test-buttons">
                <button class="test-button danger" onclick="testNetworkError()">
                    📡 ネットワークエラー
                </button>
                <button class="test-button danger" onclick="testMemoryError()">
                    🧠 メモリエラー
                </button>
                <button class="test-button danger" onclick="testUIError()">
                    🖥️ UI表示エラー
                </button>
                <button class="test-button danger" onclick="testValidationError()">
                    ✅ 検証エラー
                </button>
                <button class="test-button danger" onclick="testIChingError()">
                    ☯️ 易経変換エラー
                </button>
                <button class="test-button danger" onclick="testBunenjinConflict()">
                    🎭 分人思想競合
                </button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>⚡ パフォーマンステスト</h2>
            <div class="test-buttons">
                <button class="test-button warning" onclick="testHighVolumeErrors()">
                    📊 大量エラー処理
                </button>
                <button class="test-button warning" onclick="testMemoryPressure()">
                    💾 メモリ圧迫テスト
                </button>
                <button class="test-button warning" onclick="testResponseTime()">
                    ⏱️ 応答時間テスト
                </button>
                <button class="test-button" onclick="testRecoveryStrategies()">
                    🔧 復旧戦略テスト
                </button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>🔮 哲学的機能テスト</h2>
            <div class="test-buttons">
                <button class="test-button" onclick="testHexagramGuidance()">
                    ☰ 易経ガイダンス
                </button>
                <button class="test-button" onclick="testBunenjinPersonas()">
                    👥 分人思想テスト
                </button>
                <button class="test-button" onclick="testTripleOSIntegration()">
                    🔺 Triple OS統合
                </button>
                <button class="test-button" onclick="testPhilosophicalAlignment()">
                    ⚖️ 哲学的調和度
                </button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>📊 システム監視</h2>
            <button class="test-button" onclick="updateMetrics()">🔄 メトリクス更新</button>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="errors-processed">0</div>
                    <div class="metric-label">処理済みエラー</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avg-response-time">0ms</div>
                    <div class="metric-label">平均応答時間</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="memory-usage">0MB</div>
                    <div class="metric-label">メモリ使用量</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="throughput">0/s</div>
                    <div class="metric-label">スループット</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="philosophical-alignment">0%</div>
                    <div class="metric-label">哲学的調和度</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="system-health">健全</div>
                    <div class="metric-label">システム健全性</div>
                </div>
            </div>
            <div class="status-display" id="metrics-log"></div>
        </div>
        
        <div class="test-section">
            <h2>🧹 システム管理</h2>
            <div class="test-buttons">
                <button class="test-button" onclick="clearErrorHistory()">
                    🗑️ エラー履歴クリア
                </button>
                <button class="test-button" onclick="optimizePerformance()">
                    ⚡ パフォーマンス最適化
                </button>
                <button class="test-button" onclick="exportStatistics()">
                    📁 統計データエクスポート
                </button>
                <button class="test-button danger" onclick="resetSystem()">
                    🔄 システムリセット
                </button>
            </div>
        </div>
    </div>
    
    <!-- Error display container -->
    <div id="error-container"></div>
    
    <!-- Scripts -->
    <script src="js/shared/core/HAQEIErrorManager.js"></script>
    <script src="js/components/ErrorDisplayUI.js"></script>
    <script src="js/shared/core/ErrorHandler.js"></script>
    
    <script>
        // Global error handler instance
        let errorHandler = null;
        let testCounter = 0;
        
        // Initialize system
        document.addEventListener('DOMContentLoaded', function() {\n            initializeSystem();\n        });\n        \n        async function initializeSystem() {\n            try {\n                console.log('🚀 Initializing HAQEI Error Handler Test System...');\n                \n                // Initialize error handler with enhanced config\n                errorHandler = new UnifiedErrorHandler({\n                    uiContainerId: 'error-container',\n                    performanceThreshold: 10, // 10ms\n                    memoryThreshold: 10485760, // 10MB\n                    throughputTarget: 1000, // 1000 errors/sec\n                    enablePhilosophicalGuidance: true,\n                    enableTripleOS: true,\n                    enableRealTimeMonitoring: true\n                });\n                \n                updateStatusDisplay('✅ システム初期化完了', 'success');\n                updateMetrics();\n                \n                // Start periodic metrics update\n                setInterval(updateMetrics, 5000);\n                \n            } catch (error) {\n                console.error('❌ System initialization failed:', error);\n                updateStatusDisplay('❌ システム初期化失敗: ' + error.message, 'error');\n            }\n        }\n        \n        // Error Test Functions\n        async function testNetworkError() {\n            const error = new Error('ネットワーク接続がタイムアウトしました');\n            error.name = 'NetworkError';\n            \n            await errorHandler.handleError(error, 'ネットワーク通信', {\n                url: 'https://api.example.com/data',\n                timeout: 5000,\n                retryCount: 3\n            });\n            \n            logTest('ネットワークエラーテスト実行');\n        }\n        \n        async function testMemoryError() {\n            const error = new Error('メモリ不足により処理を継続できません');\n            error.name = 'MemoryError';\n            \n            await errorHandler.handleError(error, 'メモリ管理', {\n                usedMemory: 15728640, // 15MB\n                availableMemory: 2097152, // 2MB\n                requestedMemory: 5242880 // 5MB\n            });\n            \n            logTest('メモリエラーテスト実行');\n        }\n        \n        async function testUIError() {\n            const error = new Error('UI要素のレンダリングに失敗しました');\n            error.name = 'UIRenderError';\n            \n            await errorHandler.handleError(error, 'UI表示システム', {\n                component: 'VirtualPersonaResultsView',\n                element: 'persona-analysis-chart',\n                renderingAttempts: 3\n            });\n            \n            logTest('UIエラーテスト実行');\n        }\n        \n        async function testValidationError() {\n            const error = new Error('入力値の検証に失敗しました');\n            error.name = 'ValidationError';\n            \n            await errorHandler.handleError(error, '入力検証システム', {\n                field: 'hexagram_number',\n                value: 'invalid_input',\n                expectedType: 'number',\n                range: '1-64'\n            });\n            \n            logTest('検証エラーテスト実行');\n        }\n        \n        async function testIChingError() {\n            const error = new Error('易経変換処理でエラーが発生しました');\n            error.name = 'IChingTransformationError';\n            \n            await errorHandler.handleError(error, 'I-Ching変換エラー', {\n                hexagram: 64,\n                transformation: 'comprehensive',\n                stage: 'five_elements_integration'\n            });\n            \n            logTest('易経変換エラーテスト実行');\n        }\n        \n        async function testBunenjinConflict() {\n            const error = new Error('分人思想の調和に不整合が発生しました');\n            error.name = 'BunenjinConflictError';\n            \n            await errorHandler.handleError(error, '分人思想調和システム', {\n                conflictingPersonas: ['analyticalSelf', 'intuitiveSelf'],\n                situation: 'decision_making',\n                severity: 'moderate'\n            });\n            \n            logTest('分人思想競合テスト実行');\n        }\n        \n        // Performance Tests\n        async function testHighVolumeErrors() {\n            updateStatusDisplay('📊 大量エラー処理テスト開始...', 'info');\n            \n            const startTime = performance.now();\n            const errorCount = 100;\n            \n            for (let i = 0; i < errorCount; i++) {\n                const error = new Error(`大量処理テストエラー #${i + 1}`);\n                error.name = 'HighVolumeTestError';\n                \n                // Don't await to test concurrent processing\n                errorHandler.handleError(error, '大量処理テスト', {\n                    testId: i + 1,\n                    batchSize: errorCount\n                });\n                \n                // Small delay to prevent browser freeze\n                if (i % 10 === 0) {\n                    await new Promise(resolve => setTimeout(resolve, 1));\n                }\n            }\n            \n            const endTime = performance.now();\n            const throughput = errorCount / ((endTime - startTime) / 1000);\n            \n            logTest(`大量エラー処理完了: ${errorCount}件 (${throughput.toFixed(2)} errors/sec)`);\n        }\n        \n        async function testMemoryPressure() {\n            updateStatusDisplay('💾 メモリ圧迫テスト開始...', 'warning');\n            \n            // Create memory pressure by generating large objects\n            const largeData = [];\n            for (let i = 0; i < 1000; i++) {\n                largeData.push(new Array(1000).fill(`memory_test_${i}`));\n            }\n            \n            const error = new Error('メモリ圧迫状態でのエラー処理テスト');\n            error.name = 'MemoryPressureTestError';\n            \n            await errorHandler.handleError(error, 'メモリ圧迫テスト', {\n                memoryObjects: largeData.length,\n                estimatedMemoryUsage: largeData.length * 1000 * 20 // rough estimate\n            });\n            \n            // Cleanup\n            largeData.length = 0;\n            \n            logTest('メモリ圧迫テスト完了');\n        }\n        \n        async function testResponseTime() {\n            updateStatusDisplay('⏱️ 応答時間テスト開始...', 'info');\n            \n            const iterations = 50;\n            const responseTimes = [];\n            \n            for (let i = 0; i < iterations; i++) {\n                const startTime = performance.now();\n                \n                const error = new Error(`応答時間テスト #${i + 1}`);\n                error.name = 'ResponseTimeTestError';\n                \n                await errorHandler.handleError(error, '応答時間テスト', {\n                    iteration: i + 1,\n                    targetResponseTime: 10 // 10ms target\n                });\n                \n                const responseTime = performance.now() - startTime;\n                responseTimes.push(responseTime);\n            }\n            \n            const avgResponseTime = responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length;\n            const maxResponseTime = Math.max(...responseTimes);\n            const minResponseTime = Math.min(...responseTimes);\n            \n            logTest(`応答時間テスト完了: 平均 ${avgResponseTime.toFixed(2)}ms, 最大 ${maxResponseTime.toFixed(2)}ms, 最小 ${minResponseTime.toFixed(2)}ms`);\n        }\n        \n        async function testRecoveryStrategies() {\n            updateStatusDisplay('🔧 復旧戦略テスト開始...', 'info');\n            \n            const testCases = [\n                { type: 'network', context: 'ネットワーク' },\n                { type: 'memory', context: 'メモリ管理' },\n                { type: 'ui', context: 'UI表示システム' },\n                { type: 'validation', context: '入力検証システム' }\n            ];\n            \n            for (const testCase of testCases) {\n                const error = new Error(`${testCase.type} recovery test`);\n                error.name = `${testCase.type}RecoveryTestError`;\n                \n                await errorHandler.handleError(error, testCase.context, {\n                    recoveryTest: true,\n                    expectedStrategy: testCase.type\n                });\n            }\n            \n            logTest('復旧戦略テスト完了');\n        }\n        \n        // Philosophy Tests\n        async function testHexagramGuidance() {\n            updateStatusDisplay('☰ 易経ガイダンステスト開始...', 'info');\n            \n            const hexagrams = [1, 2, 3, 5, 7, 11, 15, 30, 31, 32];\n            \n            for (const hexagram of hexagrams) {\n                const error = new Error(`易経ガイダンステスト - 第${hexagram}卦`);\n                error.name = 'HexagramGuidanceTestError';\n                \n                await errorHandler.handleError(error, '易経ガイダンステスト', {\n                    hexagram: hexagram,\n                    guidanceTest: true\n                });\n            }\n            \n            logTest('易経ガイダンステスト完了');\n        }\n        \n        async function testBunenjinPersonas() {\n            updateStatusDisplay('👥 分人思想テスト開始...', 'info');\n            \n            const personas = ['analyticalSelf', 'intuitiveSelf', 'socialSelf'];\n            \n            for (const persona of personas) {\n                const error = new Error(`分人思想テスト - ${persona}`);\n                error.name = 'BunenjinPersonaTestError';\n                \n                await errorHandler.handleError(error, `${persona}テスト`, {\n                    targetPersona: persona,\n                    personaTest: true\n                });\n            }\n            \n            logTest('分人思想テスト完了');\n        }\n        \n        async function testTripleOSIntegration() {\n            updateStatusDisplay('🔺 Triple OS統合テスト開始...', 'info');\n            \n            const osTypes = ['engineOS', 'interfaceOS', 'safeModeOS'];\n            \n            for (const osType of osTypes) {\n                const error = new Error(`Triple OS統合テスト - ${osType}`);\n                error.name = 'TripleOSIntegrationTestError';\n                \n                await errorHandler.handleError(error, `${osType}統合テスト`, {\n                    targetOS: osType,\n                    integrationTest: true\n                });\n            }\n            \n            logTest('Triple OS統合テスト完了');\n        }\n        \n        async function testPhilosophicalAlignment() {\n            updateStatusDisplay('⚖️ 哲学的調和度テスト開始...', 'info');\n            \n            // Generate diverse errors to test philosophical balance\n            const errorTypes = [\n                { context: 'network', severity: 'medium' },\n                { context: 'memory', severity: 'high' },\n                { context: 'ui', severity: 'low' },\n                { context: 'validation', severity: 'medium' },\n                { context: 'philosophical', severity: 'high' }\n            ];\n            \n            for (const errorType of errorTypes) {\n                const error = new Error(`哲学的調和度テスト - ${errorType.context}`);\n                error.name = 'PhilosophicalAlignmentTestError';\n                \n                await errorHandler.handleError(error, `${errorType.context}調和テスト`, {\n                    severity: errorType.severity,\n                    alignmentTest: true\n                });\n            }\n            \n            const alignment = errorHandler.calculatePhilosophicalAlignment();\n            logTest(`哲学的調和度テスト完了: ${alignment}%`);\n        }\n        \n        // System Management\n        function clearErrorHistory() {\n            if (errorHandler) {\n                errorHandler.errorHistory = [];\n                errorHandler.metrics.errorsProcessed = 0;\n                logTest('エラー履歴をクリアしました');\n                updateMetrics();\n            }\n        }\n        \n        function optimizePerformance() {\n            if (errorHandler) {\n                errorHandler.triggerPerformanceOptimization();\n                logTest('パフォーマンス最適化を実行しました');\n            }\n        }\n        \n        function exportStatistics() {\n            if (errorHandler) {\n                const stats = errorHandler.getEnhancedStatistics();\n                const blob = new Blob([JSON.stringify(stats, null, 2)], { type: 'application/json' });\n                const url = URL.createObjectURL(blob);\n                \n                const a = document.createElement('a');\n                a.href = url;\n                a.download = `haqei-error-stats-${new Date().toISOString().slice(0, 10)}.json`;\n                document.body.appendChild(a);\n                a.click();\n                document.body.removeChild(a);\n                URL.revokeObjectURL(url);\n                \n                logTest('統計データをエクスポートしました');\n            }\n        }\n        \n        function resetSystem() {\n            if (confirm('システムをリセットしますか？')) {\n                location.reload();\n            }\n        }\n        \n        // Utility Functions\n        function updateMetrics() {\n            if (!errorHandler) return;\n            \n            try {\n                const stats = errorHandler.getEnhancedStatistics();\n                \n                document.getElementById('errors-processed').textContent = stats.metrics?.errorsProcessed || 0;\n                document.getElementById('avg-response-time').textContent = `${Math.round(stats.metrics?.averageResponseTime || 0)}ms`;\n                \n                if (performance.memory) {\n                    const memoryMB = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);\n                    document.getElementById('memory-usage').textContent = `${memoryMB}MB`;\n                } else {\n                    document.getElementById('memory-usage').textContent = 'N/A';\n                }\n                \n                document.getElementById('throughput').textContent = `${Math.round(stats.metrics?.throughput || 0)}/s`;\n                document.getElementById('philosophical-alignment').textContent = `${stats.philosophicalAlignment || 0}%`;\n                \n                const health = stats.systemHealth;\n                document.getElementById('system-health').textContent = health?.overall || '不明';\n                \n            } catch (error) {\n                console.error('Metrics update failed:', error);\n            }\n        }\n        \n        function updateStatusDisplay(message, type = 'info') {\n            const statusText = document.getElementById('status-text');\n            if (statusText) {\n                statusText.textContent = message;\n                statusText.className = `status-${type}`;\n            }\n        }\n        \n        function logTest(message) {\n            testCounter++;\n            const timestamp = new Date().toLocaleTimeString();\n            const logEntry = `[${timestamp}] Test #${testCounter}: ${message}`;\n            \n            const metricsLog = document.getElementById('metrics-log');\n            if (metricsLog) {\n                metricsLog.innerHTML += logEntry + '\\n';\n                metricsLog.scrollTop = metricsLog.scrollHeight;\n            }\n            \n            console.log(logEntry);\n        }\n        \n        // Global error handling for testing\n        window.addEventListener('error', function(event) {\n            if (errorHandler) {\n                errorHandler.handleError(event.error, 'グローバルエラー', {\n                    filename: event.filename,\n                    lineno: event.lineno,\n                    colno: event.colno\n                });\n            }\n        });\n        \n        window.addEventListener('unhandledrejection', function(event) {\n            if (errorHandler) {\n                const error = event.reason instanceof Error ? event.reason : new Error(String(event.reason));\n                errorHandler.handleError(error, '未処理のPromise拒否', {\n                    promise: event.promise\n                });\n            }\n        });\n    </script>\n</body>\n</html>"