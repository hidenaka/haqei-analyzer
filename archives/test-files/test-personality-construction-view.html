<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PersonalityConstructionView Test - Phase 3 UI/UX Enhancement</title>
    
    <!-- PersonalityConstructionViewå°‚ç”¨CSS -->
    <link rel="stylesheet" href="./css/components/personality-construction.css">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .test-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 50000;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        
        .test-button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: transform 0.2s;
        }
        
        .test-button:hover {
            transform: translateY(-1px);
        }
        
        .test-log {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50000;
            background: rgba(0, 0, 0, 0.9);
            color: #00ff00;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            max-width: 300px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
    </style>
</head>
<body>
    <!-- PersonalityConstructionView ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="personality-construction-container"></div>
    
    <!-- ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
    <div class="test-controls">
        <button class="test-button" onclick="testBasicConstruction()">åŸºæœ¬æ§‹ç¯‰ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testFullConstruction()">å®Œå…¨æ§‹ç¯‰ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testQuickConstruction()">é«˜é€Ÿæ§‹ç¯‰ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testErrorHandling()">ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="clearTest()">ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¢</button>
        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #444;">
            <button class="test-button" onclick="toggleTestLog()">ãƒ­ã‚°è¡¨ç¤ºåˆ‡æ›¿</button>
        </div>
    </div>
    
    <!-- ãƒ†ã‚¹ãƒˆãƒ­ã‚° -->
    <div id="test-log" class="test-log"></div>

    <!-- JavaScript Dependencies -->
    <script src="./js/shared/core/BaseComponent.js"></script>
    <script src="./js/os-analyzer/components/PersonalityConstructionView.js"></script>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let personalityConstructionView = null;
        let testLog = document.getElementById('test-log');
        
        // ãƒ†ã‚¹ãƒˆãƒ­ã‚°æ©Ÿèƒ½
        function log(message) {
            console.log(message);
            if (testLog) {
                const timestamp = new Date().toLocaleTimeString();
                testLog.innerHTML += `[${timestamp}] ${message}\n`;
                testLog.scrollTop = testLog.scrollHeight;
            }
        }
    
        function toggleTestLog() {
            if (testLog.style.display === 'none' || !testLog.style.display) {
                testLog.style.display = 'block';
            } else {
                testLog.style.display = 'none';
            }
        }
        
        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateTestVirtualPersonality() {
            return {
                id: `test_personality_${Date.now()}`,
                createdAt: new Date(),
                
                engineOS: {
                    osType: 'engine',
                    osName: 'Engine OS (ä¾¡å€¤è¦³OS)',
                    hexagramId: 1,
                    hexagramName: 'ç¬¬1å¦ï¼ˆä¹¾ï¼‰',
                    activation: 0.85,
                    characteristics: {
                        primary_traits: ['å‰µé€ çš„', 'ç†æƒ³ä¸»ç¾©çš„', 'ç‹¬ç«‹å¿—å‘']
                    },
                    personality: {
                        voice: 'æƒ…ç†±çš„ã§ç†æƒ³ä¸»ç¾©çš„ãªèªã‚Šå£',
                        priorities: ['çœŸå®Ÿã®è¿½æ±‚', 'å‰µé€ çš„è¡¨ç¾', 'ç†æƒ³ã®å®Ÿç¾'],
                        strengths: ['å‰µé€ åŠ›', 'æƒ…ç†±', 'ä¿¡å¿µã®å¼·ã•']
                    }
                },
                
                interfaceOS: {
                    osType: 'interface',
                    osName: 'Interface OS (ç¤¾ä¼šçš„OS)',
                    hexagramId: 19,
                    hexagramName: 'ç¬¬19å¦ï¼ˆè‡¨ï¼‰',
                    activation: 0.72,
                    characteristics: {
                        primary_traits: ['å”èª¿çš„', 'æ€ã„ã‚„ã‚Šæ·±ã„', 'é©å¿œåŠ›ãŒã‚ã‚‹']
                    },
                    personality: {
                        voice: 'æ¸©ã‹ãé…æ…®æ·±ã„è©±ã—æ–¹',
                        priorities: ['äººé–“é–¢ä¿‚ã®ç¶­æŒ', 'èª¿å’Œã®å‰µé€ ', 'ä»–è€…ã¸ã®è²¢çŒ®'],
                        strengths: ['å…±æ„ŸåŠ›', 'å”èª¿æ€§', 'æ€ã„ã‚„ã‚Š']
                    }
                },
                
                safeModeOS: {
                    osType: 'safemode',
                    osName: 'SafeMode OS (é˜²å¾¡OS)',
                    hexagramId: 52,
                    hexagramName: 'ç¬¬52å¦ï¼ˆè‰®ï¼‰',
                    activation: 0.63,
                    characteristics: {
                        primary_traits: ['æ…é‡', 'å®‰å®šå¿—å‘', 'åˆ†æçš„']
                    },
                    personality: {
                        voice: 'æ…é‡ã§åˆ†æçš„ãªè¡¨ç¾',
                        priorities: ['å®‰å…¨ã®ç¢ºä¿', 'ãƒªã‚¹ã‚¯ã®å›é¿', 'å®‰å®šã®ç¶­æŒ'],
                        strengths: ['æ…é‡ã•', 'åˆ†æåŠ›', 'å±æ©Ÿç®¡ç†èƒ½åŠ›']
                    }
                },
                
                personalityState: {
                    currentDominantOS: 'engine',
                    osBalance: {
                        engine: 0.85 / 3,
                        interface: 0.72 / 3,
                        safemode: 0.63 / 3
                    },
                    overallCoherence: 0.78,
                    internalHarmony: 0.82,
                    adaptabilityIndex: 0.74
                },
                
                personalityMetadata: {
                    personalityType: 'å‰µé€ çš„æ€è€ƒå‹',
                    tags: ['å‰µé€ çš„', 'å”èª¿çš„', 'æ…é‡', 'æƒ…ç†±çš„', 'æ€ã„ã‚„ã‚Šæ·±ã„']
                }
            };
        }
        
        // åŸºæœ¬æ§‹ç¯‰ãƒ†ã‚¹ãƒˆ
        async function testBasicConstruction() {
            try {
                log('ğŸ§ª åŸºæœ¬æ§‹ç¯‰ãƒ†ã‚¹ãƒˆé–‹å§‹');
                
                // PersonalityConstructionViewåˆæœŸåŒ–
                if (personalityConstructionView) {
                    personalityConstructionView.destroy();
                }
                
                personalityConstructionView = new PersonalityConstructionView('personality-construction-container');
                log('âœ… PersonalityConstructionViewåˆæœŸåŒ–å®Œäº†');
                
                // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
                const testPersonality = generateTestVirtualPersonality();
                log('âœ… ãƒ†ã‚¹ãƒˆç”¨ä»®æƒ³äººæ ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†');
                
                // æ§‹ç¯‰ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œ
                await personalityConstructionView.showConstructionProcess(testPersonality, {
                    speed: 2.0 // 2å€é€Ÿã§ãƒ†ã‚¹ãƒˆ
                });
                
                log('ğŸ‰ åŸºæœ¬æ§‹ç¯‰ãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                log(`âŒ åŸºæœ¬æ§‹ç¯‰ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('Basic construction test error:', error);
            }
        }
        
        // å®Œå…¨æ§‹ç¯‰ãƒ†ã‚¹ãƒˆ
        async function testFullConstruction() {
            try {
                log('ğŸš€ å®Œå…¨æ§‹ç¯‰ãƒ†ã‚¹ãƒˆé–‹å§‹ï¼ˆå®Ÿé€Ÿåº¦ï¼‰');
                
                if (personalityConstructionView) {
                    personalityConstructionView.destroy();
                }
                
                personalityConstructionView = new PersonalityConstructionView('personality-construction-container');
                const testPersonality = generateTestVirtualPersonality();
                
                // ãƒªã‚¢ãƒ«é€Ÿåº¦ã§å®Ÿè¡Œ
                await personalityConstructionView.showConstructionProcess(testPersonality, {
                    speed: 1.0 // ç­‰å€é€Ÿ
                });
                
                log('ğŸ‰ å®Œå…¨æ§‹ç¯‰ãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                log(`âŒ å®Œå…¨æ§‹ç¯‰ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('Full construction test error:', error);
            }
        }
        
        // é«˜é€Ÿæ§‹ç¯‰ãƒ†ã‚¹ãƒˆ
        async function testQuickConstruction() {
            try {
                log('âš¡ é«˜é€Ÿæ§‹ç¯‰ãƒ†ã‚¹ãƒˆé–‹å§‹');
                
                if (personalityConstructionView) {
                    personalityConstructionView.destroy();
                }
                
                personalityConstructionView = new PersonalityConstructionView('personality-construction-container');
                const testPersonality = generateTestVirtualPersonality();
                
                // 5å€é€Ÿã§å®Ÿè¡Œ
                await personalityConstructionView.showConstructionProcess(testPersonality, {
                    speed: 5.0 // 5å€é€Ÿ
                });
                
                log('ğŸ‰ é«˜é€Ÿæ§‹ç¯‰ãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                log(`âŒ é«˜é€Ÿæ§‹ç¯‰ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('Quick construction test error:', error);
            }
        }
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
        async function testErrorHandling() {
            try {
                log('ğŸ› ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆé–‹å§‹');
                
                if (personalityConstructionView) {
                    personalityConstructionView.destroy();
                }
                
                personalityConstructionView = new PersonalityConstructionView('personality-construction-container');
                
                // ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿ã§ãƒ†ã‚¹ãƒˆ
                const invalidPersonality = null;
                
                await personalityConstructionView.showConstructionProcess(invalidPersonality, {
                    speed: 3.0
                });
                
                log('ğŸ‰ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                log(`âœ… æœŸå¾…ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ: ${error.message}`);
                console.log('Expected error handling test passed:', error);
            }
        }
        
        // ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¢
        function clearTest() {
            try {
                log('ğŸ§¹ ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¢é–‹å§‹');
                
                if (personalityConstructionView) {
                    personalityConstructionView.destroy();
                    personalityConstructionView = null;
                }
                
                const container = document.getElementById('personality-construction-container');
                if (container) {
                    container.innerHTML = '';
                }
                
                log('âœ… ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¢å®Œäº†');
                
            } catch (error) {
                log(`âŒ ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('Clear test error:', error);
            }
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ­ PersonalityConstructionView ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            log('ğŸ“ ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ©Ÿèƒ½ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
            
            // PersonalityConstructionViewã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            const container = document.getElementById('personality-construction-container');
            if (container) {
                container.addEventListener('constructionComplete', (event) => {
                    log(`ğŸ‰ æ§‹ç¯‰å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡: ${event.detail.duration}ms`);
                });
            }
        });
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', function(event) {
            if (event.altKey) {
                switch(event.key) {
                    case '1':
                        testBasicConstruction();
                        break;
                    case '2':
                        testFullConstruction(); 
                        break;
                    case '3':
                        testQuickConstruction();
                        break;
                    case '4':
                        testErrorHandling();
                        break;
                    case '0':
                        clearTest();
                        break;
                    case 'l':
                        toggleTestLog();
                        break;
                }
            }
        });
    </script>
</body>
</html>