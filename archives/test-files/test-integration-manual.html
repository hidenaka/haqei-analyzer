<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>çµ±åˆãƒ†ã‚¹ãƒˆ - æ‰‹å‹•ç¢ºèªç”¨</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #444;
      border-radius: 8px;
      background: #2a2a2a;
    }
    .test-input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      background: #333;
      color: #fff;
      border: 1px solid #555;
      border-radius: 4px;
    }
    .test-button {
      padding: 10px 20px;
      background: #4a9eff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    .test-button:hover {
      background: #357abd;
    }
    .result-area {
      margin-top: 20px;
      padding: 15px;
      background: #333;
      border-radius: 4px;
      min-height: 100px;
      white-space: pre-wrap;
      font-family: monospace;
    }
    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid #4a9eff;
      padding-left: 10px;
    }
    .error {
      color: #ff6b6b;
      border-left-color: #ff6b6b;
    }
    .success {
      color: #51cf66;
      border-left-color: #51cf66;
    }
    .warning {
      color: #ffd43b;
      border-left-color: #ffd43b;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆ</h1>
  
  <div class="test-section">
    <h2>1. ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</h2>
    <button class="test-button" onclick="testEngineInit()">ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–</button>
    <div id="engine-result" class="result-area">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
  </div>
  
  <div class="test-section">
    <h2>2. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ</h2>
    <textarea id="test-input" class="test-input" rows="3" placeholder="ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›...">æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ãŸã„ãŒã€ä»Šã®ä»•äº‹ã‚‚å¤§åˆ‡ã€‚ã©ã†ã™ã‚Œã°ã„ã„ã‹æ‚©ã‚“ã§ã„ã‚‹ã€‚</textarea>
    <button class="test-button" onclick="testDataFlow()">ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ç¢ºèª</button>
    <div id="flow-result" class="result-area">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
  </div>
  
  <div class="test-section">
    <h2>3. çµ±åˆåˆ†æãƒ†ã‚¹ãƒˆ</h2>
    <button class="test-button" onclick="testIntegratedAnalysis()">çµ±åˆåˆ†æå®Ÿè¡Œ</button>
    <div id="analysis-result" class="result-area">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
  </div>
  
  <div class="test-section">
    <h2>4. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçŠ¶æ…‹</h2>
    <button class="test-button" onclick="checkComponentStatus()">çŠ¶æ…‹ç¢ºèª</button>
    <div id="status-result" class="result-area">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
  </div>

  <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã¿ -->
  <script src="js/core/H384_DATABASE.js"></script>
  <script src="js/core/SituationalContextEngine.js"></script>
  <script src="js/engines/HexagramMappingEngine.js"></script>
  <script src="js/core/AuthenticIChingEngine.js"></script>
  <script src="js/components/Authentic8ScenariosSystem.js"></script>
  
  <script>
    // ãƒ­ã‚°è¨˜éŒ²ç”¨
    const testLog = [];
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = `[${timestamp}] ${message}`;
      testLog.push({ message: logEntry, type });
      console.log(logEntry);
    }
    
    function displayResults(elementId, logs) {
      const resultDiv = document.getElementById(elementId);
      resultDiv.innerHTML = logs.map(log => 
        `<div class="log-entry ${log.type}">${log.message}</div>`
      ).join('');
    }
    
    // 1. ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
    async function testEngineInit() {
      const logs = [];
      
      try {
        logs.push({ message: 'ğŸš€ AuthenticIChingEngineåˆæœŸåŒ–é–‹å§‹', type: 'info' });
        const engine = new AuthenticIChingEngine();
        
        logs.push({ message: 'âœ… AuthenticIChingEngineåˆæœŸåŒ–æˆåŠŸ', type: 'success' });
        
        // çµ±åˆã‚¨ãƒ³ã‚¸ãƒ³ã®ç¢ºèª
        if (engine.situationalEngine) {
          logs.push({ message: 'âœ… SituationalContextEngine: åˆæœŸåŒ–æ¸ˆã¿', type: 'success' });
        } else {
          logs.push({ message: 'âš ï¸ SituationalContextEngine: æœªåˆæœŸåŒ–ï¼ˆé…å»¶åˆæœŸåŒ–ï¼‰', type: 'warning' });
        }
        
        if (engine.hexagramEngine) {
          logs.push({ message: 'âœ… HexagramMappingEngine: åˆæœŸåŒ–æ¸ˆã¿', type: 'success' });
        } else {
          logs.push({ message: 'âš ï¸ HexagramMappingEngine: æœªåˆæœŸåŒ–ï¼ˆé…å»¶åˆæœŸåŒ–ï¼‰', type: 'warning' });
        }
        
        // H384ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
        if (engine.h384Data || engine.h384Database) {
          logs.push({ message: 'âœ… H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: åˆ©ç”¨å¯èƒ½', type: 'success' });
        } else {
          logs.push({ message: 'âŒ H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: åˆ©ç”¨ä¸å¯', type: 'error' });
        }
        
        window.testEngine = engine;
        
      } catch (error) {
        logs.push({ message: `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, type: 'error' });
      }
      
      displayResults('engine-result', logs);
    }
    
    // 2. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ
    async function testDataFlow() {
      const logs = [];
      const inputText = document.getElementById('test-input').value;
      
      try {
        if (!window.testEngine) {
          logs.push({ message: 'âš ï¸ ã‚¨ãƒ³ã‚¸ãƒ³æœªåˆæœŸåŒ–ã€‚å…ˆã«åˆæœŸåŒ–ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚', type: 'warning' });
          displayResults('flow-result', logs);
          return;
        }
        
        logs.push({ message: 'ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼é–‹å§‹', type: 'info' });
        logs.push({ message: `ğŸ“ å…¥åŠ›: "${inputText}"`, type: 'info' });
        
        // identifyCurrentSituationã‚’å®Ÿè¡Œ
        const result = await window.testEngine.identifyCurrentSituation(inputText);
        
        logs.push({ message: 'âœ… identifyCurrentSituationå®Œäº†', type: 'success' });
        
        // çµæœã®æ¤œè¨¼
        if (result.å¦ç•ªå·) {
          logs.push({ message: `âœ… å¦ç•ªå·: ${result.å¦ç•ªå·}`, type: 'success' });
        }
        if (result.å¦å) {
          logs.push({ message: `âœ… å¦å: ${result.å¦å}`, type: 'success' });
        }
        if (result.çˆ») {
          logs.push({ message: `âœ… çˆ»: ${result.çˆ»}`, type: 'success' });
        }
        if (result.çŠ¶æ³åˆ†æ) {
          logs.push({ message: 'âœ… çŠ¶æ³åˆ†æãƒ‡ãƒ¼ã‚¿: å«ã¾ã‚Œã¦ã„ã‚‹', type: 'success' });
        }
        if (result.æ˜“çµŒè§£é‡ˆ) {
          logs.push({ message: 'âœ… æ˜“çµŒè§£é‡ˆ: å«ã¾ã‚Œã¦ã„ã‚‹', type: 'success' });
        }
        if (result.bunenjinè¦–ç‚¹) {
          logs.push({ message: 'âœ… bunenjinè¦–ç‚¹: å«ã¾ã‚Œã¦ã„ã‚‹', type: 'success' });
        }
        
        // è©³ç´°çµæœè¡¨ç¤º
        logs.push({ message: '\nğŸ“Š è©³ç´°çµæœ:', type: 'info' });
        logs.push({ message: JSON.stringify(result, null, 2), type: 'info' });
        
        window.testResult = result;
        
      } catch (error) {
        logs.push({ message: `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, type: 'error' });
        console.error(error);
      }
      
      displayResults('flow-result', logs);
    }
    
    // 3. çµ±åˆåˆ†æãƒ†ã‚¹ãƒˆ
    async function testIntegratedAnalysis() {
      const logs = [];
      
      try {
        if (!window.testResult) {
          logs.push({ message: 'âš ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆã‚’å…ˆã«å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚', type: 'warning' });
          displayResults('analysis-result', logs);
          return;
        }
        
        logs.push({ message: 'ğŸ” çµ±åˆåˆ†æãƒ†ã‚¹ãƒˆé–‹å§‹', type: 'info' });
        
        // Authentic8ScenariosSystemã®ãƒ†ã‚¹ãƒˆ
        logs.push({ message: 'ğŸŒŠ 8ã‚·ãƒŠãƒªã‚ªç”Ÿæˆãƒ†ã‚¹ãƒˆ', type: 'info' });
        
        // ãƒ€ãƒŸãƒ¼ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ
        const container = document.createElement('div');
        const scenariosSystem = new Authentic8ScenariosSystem(container, window.testEngine);
        
        const scenarios = scenariosSystem.generate8TransformationPatterns(
          window.testResult.å¦ç•ªå·,
          window.testResult.çˆ»ä½ç½®,
          window.testResult
        );
        
        if (scenarios && scenarios.length === 8) {
          logs.push({ message: 'âœ… 8ã‚·ãƒŠãƒªã‚ªç”ŸæˆæˆåŠŸ', type: 'success' });
          
          scenarios.forEach((scenario, index) => {
            logs.push({ 
              message: `  ${index + 1}. ${scenario.pattern}: ${scenario.hexagram}`, 
              type: 'info' 
            });
          });
        } else {
          logs.push({ message: `âŒ ã‚·ãƒŠãƒªã‚ªç”Ÿæˆå¤±æ•—ï¼ˆ${scenarios?.length || 0}å€‹ï¼‰`, type: 'error' });
        }
        
      } catch (error) {
        logs.push({ message: `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, type: 'error' });
      }
      
      displayResults('analysis-result', logs);
    }
    
    // 4. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçŠ¶æ…‹ç¢ºèª
    function checkComponentStatus() {
      const logs = [];
      
      logs.push({ message: 'ğŸ” ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçŠ¶æ…‹ç¢ºèª', type: 'info' });
      
      // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç¢ºèª
      const components = [
        { name: 'H384_DATA', exists: typeof H384_DATA !== 'undefined' },
        { name: 'H384_DATABASE', exists: typeof H384_DATABASE !== 'undefined' },
        { name: 'SituationalContextEngine', exists: typeof SituationalContextEngine !== 'undefined' },
        { name: 'HexagramMappingEngine', exists: typeof HexagramMappingEngine !== 'undefined' },
        { name: 'AuthenticIChingEngine', exists: typeof AuthenticIChingEngine !== 'undefined' },
        { name: 'Authentic8ScenariosSystem', exists: typeof Authentic8ScenariosSystem !== 'undefined' }
      ];
      
      components.forEach(comp => {
        if (comp.exists) {
          logs.push({ message: `âœ… ${comp.name}: åˆ©ç”¨å¯èƒ½`, type: 'success' });
        } else {
          logs.push({ message: `âŒ ${comp.name}: åˆ©ç”¨ä¸å¯`, type: 'error' });
        }
      });
      
      // ã‚¨ãƒ³ã‚¸ãƒ³ã®çµ±åˆçŠ¶æ…‹
      if (window.testEngine) {
        logs.push({ message: '\nğŸ”§ ã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆçŠ¶æ…‹:', type: 'info' });
        logs.push({ 
          message: `  situationalEngine: ${window.testEngine.situationalEngine ? 'âœ…' : 'âŒ'}`, 
          type: window.testEngine.situationalEngine ? 'success' : 'error' 
        });
        logs.push({ 
          message: `  hexagramEngine: ${window.testEngine.hexagramEngine ? 'âœ…' : 'âŒ'}`, 
          type: window.testEngine.hexagramEngine ? 'success' : 'error' 
        });
      }
      
      displayResults('status-result', logs);
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ã§çŠ¶æ…‹ç¢ºèª
    window.addEventListener('load', () => {
      setTimeout(checkComponentStatus, 1000);
    });
  </script>
</body>
</html>