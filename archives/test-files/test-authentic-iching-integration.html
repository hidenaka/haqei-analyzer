<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­£çµ±æ˜“çµŒã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
        }
        .test-section {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
    </style>
</head>
<body>
    <h1>ğŸŒŸ æ­£çµ±æ˜“çµŒã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆçµæœ</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ ç¾åœ¨åœ°è¡¨ç¤ºãƒ†ã‚¹ãƒˆ</h2>
        <div id="current-position-test"></div>
    </div>

    <div class="test-section">
        <h2>âš¡ é¸æŠã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
        <div id="choice-system-test"></div>
    </div>

    <div class="test-section">
        <h2>ğŸŒŠ 8å¤‰åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
        <div id="scenarios-test"></div>
    </div>

    <!-- Load all required scripts in correct order -->
    <script src="./assets/H384H64data.js"></script>
    <script src="./js/core/AuthenticIChingEngine.js"></script>
    <script src="./js/components/CurrentPositionDisplay.js"></script>
    <script src="./js/components/AuthenticChoiceSystem.js"></script>
    <script src="./js/components/Authentic8ScenariosSystem.js"></script>

    <script>
        console.log('ğŸŒŸ æ­£çµ±æ˜“çµŒã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹');
        
        const testResults = document.getElementById('test-results');
        const tests = [];
        
        function addTest(name, result, message) {
            tests.push({ name, result, message });
            const div = document.createElement('div');
            div.className = result ? 'success' : 'error';
            div.innerHTML = `${result ? 'âœ…' : 'âŒ'} ${name}: ${message}`;
            testResults.appendChild(div);
        }

        // Test 1: H384_DATA Loading
        try {
            if (typeof window.H384_DATA !== 'undefined' && Array.isArray(window.H384_DATA)) {
                addTest('H384_DATAèª­ã¿è¾¼ã¿', true, `${window.H384_DATA.length}ã‚¨ãƒ³ãƒˆãƒªã®ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ`);
            } else {
                addTest('H384_DATAèª­ã¿è¾¼ã¿', false, 'H384_DATAãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€é…åˆ—ã§ã¯ã‚ã‚Šã¾ã›ã‚“');
            }
        } catch (error) {
            addTest('H384_DATAèª­ã¿è¾¼ã¿', false, `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        }

        // Test 2: AuthenticIChingEngine Initialization
        try {
            const engine = new AuthenticIChingEngine();
            const engineInfo = engine.getEngineInfo();
            addTest('æ­£çµ±æ˜“çµŒã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–', true, `ã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${engineInfo.version}`);
        } catch (error) {
            addTest('æ­£çµ±æ˜“çµŒã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–', false, `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        }

        // Test 3: Current Position Display Component
        try {
            const container1 = document.getElementById('current-position-test');
            const positionDisplay = new CurrentPositionDisplay(container1, new AuthenticIChingEngine());
            addTest('ç¾åœ¨åœ°è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ', true, 'æ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
        } catch (error) {
            addTest('ç¾åœ¨åœ°è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ', false, `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        }

        // Test 4: Authentic Choice System Component
        try {
            const container2 = document.getElementById('choice-system-test');
            const choiceSystem = new AuthenticChoiceSystem(container2, new AuthenticIChingEngine());
            addTest('æ­£çµ±é¸æŠã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ', true, 'æ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
        } catch (error) {
            addTest('æ­£çµ±é¸æŠã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ', false, `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        }

        // Test 5: Authentic 8 Scenarios System Component
        try {
            const container3 = document.getElementById('scenarios-test');
            const scenariosSystem = new Authentic8ScenariosSystem(container3, new AuthenticIChingEngine());
            addTest('8å¤‰åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ', true, 'æ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
        } catch (error) {
            addTest('8å¤‰åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ', false, `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        }

        // Test 6: Integration Test - Text Analysis
        try {
            const engine = new AuthenticIChingEngine();
            const testText = "æœ€è¿‘ã€ä»•äº‹ã§ã†ã¾ãã„ã‹ãªã„ã“ã¨ãŒå¤šãã€ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¨ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«æ‚©ã‚“ã§ã„ã¾ã™ã€‚è²¬ä»»è€…ã¨ã—ã¦çµæœã‚’å‡ºã™å¿…è¦ãŒã‚ã‚‹ã®ã«ã€æ€ã†ã‚ˆã†ã«é€²ã¾ãªã„çŠ¶æ³ã§ã™ã€‚ã©ã†æ”¹å–„ã—ã¦ã„ã‘ã°ã‚ˆã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ";
            const result = engine.identifyCurrentSituation(testText);
            
            if (result && result.å¦ç•ªå· && result.å¦å) {
                addTest('ãƒ†ã‚­ã‚¹ãƒˆåˆ†æçµ±åˆãƒ†ã‚¹ãƒˆ', true, `å¦: ç¬¬${result.å¦ç•ªå·}å¦ ${result.å¦å}`);
            } else {
                addTest('ãƒ†ã‚­ã‚¹ãƒˆåˆ†æçµ±åˆãƒ†ã‚¹ãƒˆ', false, 'åˆ†æçµæœã®å½¢å¼ãŒä¸æ­£ã§ã™');
            }
        } catch (error) {
            addTest('ãƒ†ã‚­ã‚¹ãƒˆåˆ†æçµ±åˆãƒ†ã‚¹ãƒˆ', false, `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        }

        // Summary
        setTimeout(() => {
            const successCount = tests.filter(t => t.result).length;
            const totalCount = tests.length;
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = successCount === totalCount ? 'success' : 'warning';
            summaryDiv.innerHTML = `<h3>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼: ${successCount}/${totalCount} ãƒ†ã‚¹ãƒˆé€šé</h3>`;
            testResults.appendChild(summaryDiv);
            
            if (successCount === totalCount) {
                console.log('ğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼');
            } else {
                console.log(`âš ï¸ ${totalCount - successCount}å€‹ã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ`);
            }
        }, 1000);
    </script>
</body>
</html>