<\!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VirtualQuestionFlow ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼åˆ†å‰²å“è³ªãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 20px; }
        .test-container { background: #f5f5f5; padding: 20px; margin: 10px 0; border-radius: 8px; }
        .success { color: #22c55e; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
    </style>
</head>
<body>
    <h1>ğŸ§ª VirtualQuestionFlow ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼åˆ†å‰²å“è³ªãƒ†ã‚¹ãƒˆ</h1>
    <div id="test-results"></div>

    <\!-- Base dependencies -->
    <script>
        // Mock BaseComponent for testing
        class BaseComponent {
            constructor(containerId, options = {}) {
                this.container = document.getElementById(containerId) || document.createElement('div');
                this.options = options;
            }
        }
        window.BaseComponent = BaseComponent;
    </script>

    <\!-- Load modular components in order -->
    <script src="/public/js/os-analyzer/components/VirtualQuestionFlow-core.js"></script>
    <script src="/public/js/os-analyzer/components/VirtualQuestionFlow-renderer.js"></script>
    <script src="/public/js/os-analyzer/components/VirtualQuestionFlow-navigator.js"></script>
    <script src="/public/js/os-analyzer/components/VirtualQuestionFlow-state.js"></script>
    <script src="/public/js/os-analyzer/components/VirtualQuestionFlow-utils.js"></script>
    <script src="/public/js/os-analyzer/components/VirtualQuestionFlow-v2.js"></script>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-container ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            document.getElementById('test-results').appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        async function runQualityTests() {
            log('ğŸš€ VirtualQuestionFlow ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼åˆ†å‰²å“è³ªãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');

            // Test 1: Module Loading Verification
            const modules = [
                'VirtualQuestionFlowCore',
                'VirtualQuestionFlowRenderer', 
                'VirtualQuestionFlowNavigator',
                'VirtualQuestionFlowState',
                'VirtualQuestionFlowUtils',
                'VirtualQuestionFlow'
            ];

            let loadedModules = 0;
            modules.forEach(moduleName => {
                if (typeof window[moduleName] \!== 'undefined') {
                    log(`âœ… ${moduleName} ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ`, 'success');
                    loadedModules++;
                } else {
                    log(`âŒ ${moduleName} ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—`, 'error');
                }
            });

            // Test 2: Module Integration Test
            try {
                const testContainer = document.createElement('div');
                testContainer.id = 'test-container';
                document.body.appendChild(testContainer);

                const mockQuestions = [
                    { id: 'q1', title: 'ãƒ†ã‚¹ãƒˆè¨­å•1', text: 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆè¨­å•ã§ã™', choices: [] },
                    { id: 'q2', title: 'ãƒ†ã‚¹ãƒˆè¨­å•2', text: 'ã“ã‚Œã‚‚ãƒ†ã‚¹ãƒˆè¨­å•ã§ã™', choices: [] }
                ];

                const vqf = new VirtualQuestionFlow('test-container', {
                    questions: mockQuestions,
                    onComplete: (answers) => {
                        log('ğŸ“ å®Œäº†ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œç¢ºèª', 'success');
                    }
                });

                if (vqf.core && vqf.renderer && vqf.navigator && vqf.state && vqf.utils) {
                    log('âœ… çµ±åˆVirtualQuestionFlowã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–æˆåŠŸ - å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é€£æºç¢ºèª', 'success');
                } else {
                    log('âš ï¸ ä¸€éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæ­£ã—ãé€£æºã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§', 'warning');
                }

                // Test 3: Core Functionality Test
                vqf.setQuestions(mockQuestions);
                const stats = vqf.getStats();
                if (stats && stats.navigation && stats.progress) {
                    log('âœ… çµ±è¨ˆæƒ…å ±å–å¾—æ©Ÿèƒ½æ­£å¸¸å‹•ä½œ', 'success');
                } else {
                    log('âŒ çµ±è¨ˆæƒ…å ±å–å¾—æ©Ÿèƒ½ã«å•é¡Œã‚ã‚Š', 'error');
                }

                // Test 4: State Management Test
                const currentState = vqf.getCurrentState();
                if (currentState && typeof currentState.currentQuestionIndex === 'number') {
                    log('âœ… çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½æ­£å¸¸å‹•ä½œ', 'success');
                } else {
                    log('âŒ çŠ¶æ…‹ç®¡ç†æ©Ÿèƒ½ã«å•é¡Œã‚ã‚Š', 'error');
                }

                // Test 5: Emergency Fix Integration Test
                const fixResult = vqf.applyEmergencyFixes();
                if (typeof fixResult === 'boolean') {
                    log('âœ… ç·Šæ€¥ä¿®æ­£æ©Ÿèƒ½çµ±åˆç¢ºèª', 'success');
                } else {
                    log('âŒ ç·Šæ€¥ä¿®æ­£æ©Ÿèƒ½çµ±åˆã«å•é¡Œã‚ã‚Š', 'error');
                }

                testContainer.remove();

            } catch (error) {
                log(`âŒ çµ±åˆãƒ†ã‚¹ãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('Integration test error:', error);
            }

            // Test Summary
            log('==========================================', 'info');
            log(`ğŸ“Š ãƒ†ã‚¹ãƒˆå®Œäº†: ${loadedModules}/${modules.length} ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ`, 'info');
            
            if (loadedModules === modules.length) {
                log('ğŸ‰ å…¨å“è³ªãƒ†ã‚¹ãƒˆåˆæ ¼ - ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼åˆ†å‰²å®Ÿè£…ã¯é©åˆ‡ã§ã™', 'success');
            } else {
                log('âš ï¸ ä¸€éƒ¨ãƒ†ã‚¹ãƒˆå¤±æ•— - å®Ÿè£…ç¢ºèªãŒå¿…è¦ã§ã™', 'warning');
            }
        }

        // Run tests when page loads
        window.addEventListener('load', runQualityTests);
    </script>
</body>
</html>
EOF < /dev/null