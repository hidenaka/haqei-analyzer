<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI Virtual Personality Phase 1 Test (Standalone)</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #ffffff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #4fc3f7;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4fc3f7;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: transform 0.2s;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
        }
        
        .result-area {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid #333;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            color: #4caf50;
        }
        
        .error {
            color: #f44336;
        }
        
        .info {
            color: #2196f3;
        }
        
        .warning {
            color: #ff9800;
        }
        
        .os-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid;
        }
        
        .engine-os {
            border-left-color: #e74c3c;
        }
        
        .interface-os {
            border-left-color: #3498db;
        }
        
        .safemode-os {
            border-left-color: #f39c12;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ­ HAQEI Virtual Personality System Phase 1 Test (Standalone)</h1>
        
        <div class="test-section" style="border-left-color: #4caf50;">
            <h3>ğŸŒ ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ç‰ˆãƒ†ã‚¹ãƒˆ</h3>
            <p><strong>èª¬æ˜:</strong> JavaScriptãƒ•ã‚¡ã‚¤ãƒ«åŸ‹ã‚è¾¼ã¿ç‰ˆã§MIMEã‚¿ã‚¤ãƒ—å•é¡Œã‚’å›é¿</p>
            <p><strong>æ¨å¥¨:</strong> ã€ŒRun Simple Testã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦åŸºæœ¬å‹•ä½œã‚’ç¢ºèª</p>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª åŸºæœ¬å‹•ä½œãƒ†ã‚¹ãƒˆ</h3>
            <button class="test-button" onclick="runSimpleTest()">Run Simple Test</button>
            <button class="test-button" onclick="runBasicPersonalityTest()">Test Basic Personality Creation</button>
            <div id="simple-test-result" class="result-area"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š ã‚¯ãƒ©ã‚¹å¯ç”¨æ€§ç¢ºèª</h3>
            <button class="test-button" onclick="checkClassAvailability()">Check Class Availability</button>
            <div id="class-check-result" class="result-area"></div>
        </div>
    </div>

    <script>
        // Simplified PersonalityOS for testing
        class PersonalityOS {
            constructor(osType, userAnswers) {
                this.osType = osType;
                this.osName = this.getOSDisplayName(osType);
                this.hexagramId = this.getDefaultHexagram(osType);
                this.hexagramName = `ç¬¬${this.hexagramId}å¦`;
                this.activation = Math.random() * 0.8 + 0.2; // 0.2-1.0
                
                this.characteristics = {
                    primary_traits: this.generateTraits(osType)
                };
                
                this.personality = {
                    voice: this.generateVoice(osType),
                    priorities: this.generatePriorities(osType),
                    strengths: this.generateStrengths(osType)
                };
                
                console.log(`ğŸ§  PersonalityOS [${this.osType}] initialized`);
            }
            
            getOSDisplayName(osType) {
                const osNames = {
                    'engine': 'Engine OS (ä¾¡å€¤è¦³OS)',
                    'interface': 'Interface OS (ç¤¾ä¼šçš„OS)', 
                    'safemode': 'SafeMode OS (é˜²å¾¡OS)'
                };
                return osNames[osType] || `Unknown OS (${osType})`;
            }
            
            getDefaultHexagram(osType) {
                const defaultHexagrams = {
                    'engine': 1,
                    'interface': 19,
                    'safemode': 52
                };
                return defaultHexagrams[osType] || 1;
            }
            
            generateTraits(osType) {
                const traits = {
                    'engine': ['å‰µé€ çš„', 'ç†æƒ³ä¸»ç¾©çš„', 'ç‹¬ç«‹å¿—å‘'],
                    'interface': ['å”èª¿çš„', 'æ€ã„ã‚„ã‚Šæ·±ã„', 'é©å¿œåŠ›ãŒã‚ã‚‹'],
                    'safemode': ['æ…é‡', 'å®‰å®šå¿—å‘', 'åˆ†æçš„']
                };
                return traits[osType] || ['æ¨™æº–çš„'];
            }
            
            generateVoice(osType) {
                const voices = {
                    'engine': 'æƒ…ç†±çš„ã§ç†æƒ³ä¸»ç¾©çš„ãªèªã‚Šå£',
                    'interface': 'æ¸©ã‹ãé…æ…®æ·±ã„è©±ã—æ–¹',
                    'safemode': 'æ…é‡ã§åˆ†æçš„ãªè¡¨ç¾'
                };
                return voices[osType] || 'æ¨™æº–çš„ãªè¡¨ç¾';
            }
            
            generatePriorities(osType) {
                const priorities = {
                    'engine': ['çœŸå®Ÿã®è¿½æ±‚', 'å‰µé€ çš„è¡¨ç¾', 'ç†æƒ³ã®å®Ÿç¾'],
                    'interface': ['äººé–“é–¢ä¿‚ã®ç¶­æŒ', 'èª¿å’Œã®å‰µé€ ', 'ä»–è€…ã¸ã®è²¢çŒ®'],
                    'safemode': ['å®‰å…¨ã®ç¢ºä¿', 'ãƒªã‚¹ã‚¯ã®å›é¿', 'å®‰å®šã®ç¶­æŒ']
                };
                return priorities[osType] || ['åŸºæœ¬çš„ãªç›®æ¨™'];
            }
            
            generateStrengths(osType) {
                const strengths = {
                    'engine': ['å‰µé€ åŠ›', 'æƒ…ç†±', 'ä¿¡å¿µã®å¼·ã•'],
                    'interface': ['å…±æ„ŸåŠ›', 'å”èª¿æ€§', 'æ€ã„ã‚„ã‚Š'],
                    'safemode': ['æ…é‡ã•', 'åˆ†æåŠ›', 'å±æ©Ÿç®¡ç†èƒ½åŠ›']
                };
                return strengths[osType] || ['åŸºæœ¬çš„ãªèƒ½åŠ›'];
            }
            
            makeDecision(context) {
                return {
                    osType: this.osType,
                    reasoning: `${this.osType}ã®è¦³ç‚¹ã‹ã‚‰ã€Œ${context}ã€ã«ã¤ã„ã¦åˆ¤æ–­ã—ã¾ã—ãŸ`,
                    confidence: Math.random() * 0.5 + 0.5,
                    alternatives: [`${this.osType}çš„ãªä»£æ›¿æ¡ˆ1`, `${this.osType}çš„ãªä»£æ›¿æ¡ˆ2`],
                    concerns: [`${this.osType}çš„ãªæ‡¸å¿µ1`, `${this.osType}çš„ãªæ‡¸å¿µ2`]
                };
            }
            
            expressOpinion(topic) {
                return {
                    osType: this.osType,
                    stance: `${this.osType}ã¨ã—ã¦ã€Œ${topic}ã€ã«ã¤ã„ã¦è€ƒãˆã¾ã™`,
                    reasoning: `${this.osType}ã®ç‰¹æ€§ã«åŸºã¥ãåˆ¤æ–­`,
                    emotion: 'neutral',
                    confidence: Math.random() * 0.5 + 0.5
                };
            }
        }

        // Simplified VirtualPersonality for testing
        class VirtualPersonality {
            constructor(userAnswers) {
                this.id = `personality_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                this.createdAt = new Date();
                
                this.engineOS = new PersonalityOS('engine', userAnswers);
                this.interfaceOS = new PersonalityOS('interface', userAnswers);
                this.safeModeOS = new PersonalityOS('safemode', userAnswers);
                
                this.personalityState = {
                    currentDominantOS: this.calculateDominantOS(),
                    osBalance: {
                        engine: this.engineOS.activation / 3,
                        interface: this.interfaceOS.activation / 3,
                        safemode: this.safeModeOS.activation / 3
                    },
                    overallCoherence: Math.random() * 0.5 + 0.5,
                    internalHarmony: Math.random() * 0.5 + 0.5,
                    adaptabilityIndex: Math.random() * 0.5 + 0.5
                };
                
                this.personalityMetadata = {
                    personalityType: this.generatePersonalityType(),
                    tags: this.generateTags()
                };
                
                console.log('ğŸ­ VirtualPersonality created successfully');
            }
            
            calculateDominantOS() {
                const activations = {
                    engine: this.engineOS.activation,
                    interface: this.interfaceOS.activation,
                    safemode: this.safeModeOS.activation
                };
                
                return Object.keys(activations).reduce((a, b) => 
                    activations[a] > activations[b] ? a : b);
            }
            
            generatePersonalityType() {
                const types = [
                    'å‰µé€ çš„æ€è€ƒå‹', 'èª¿å’Œé‡è¦–å‹', 'å®‰å®šå¿—å‘å‹',
                    'ãƒãƒ©ãƒ³ã‚¹å‹', 'ç›´æ„Ÿå‹', 'åˆ†æå‹'
                ];
                return types[Math.floor(Math.random() * types.length)];
            }
            
            generateTags() {
                const allTags = [
                    'å‰µé€ çš„', 'å”èª¿çš„', 'æ…é‡', 'æƒ…ç†±çš„', 'æ€ã„ã‚„ã‚Šæ·±ã„',
                    'åˆ†æçš„', 'ç†æƒ³ä¸»ç¾©', 'ç¾å®Ÿçš„', 'æŸ”è»Ÿ', 'å®‰å®šå¿—å‘'
                ];
                return allTags.slice(0, 3 + Math.floor(Math.random() * 3));
            }
            
            simulateInternalDialogue(scenario) {
                const engineDecision = this.engineOS.makeDecision(scenario);
                const interfaceDecision = this.interfaceOS.makeDecision(scenario);
                const safeModeDecision = this.safeModeOS.makeDecision(scenario);
                
                return {
                    scenario: scenario,
                    exchanges: [
                        {
                            speaker: 'Engine OS',
                            type: 'proposal',
                            content: engineDecision.reasoning
                        },
                        {
                            speaker: 'Interface OS',
                            type: 'consideration',
                            content: interfaceDecision.reasoning
                        },
                        {
                            speaker: 'SafeMode OS',
                            type: 'caution',
                            content: safeModeDecision.reasoning
                        }
                    ],
                    consensusLevel: Math.random() * 0.5 + 0.5,
                    outcome: 'ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸåˆ¤æ–­'
                };
            }
            
            predictBehavior(situation) {
                return {
                    situation: situation,
                    osDecisions: {
                        engine: this.engineOS.makeDecision(situation),
                        interface: this.interfaceOS.makeDecision(situation),
                        safemode: this.safeModeOS.makeDecision(situation)
                    },
                    integratedPrediction: `${situation}ã«å¯¾ã—ã¦${this.personalityState.currentDominantOS}çš„ã«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ`,
                    confidence: Math.random() * 0.5 + 0.5
                };
            }
            
            generatePersonalityNarrative() {
                return {
                    introduction: `ã‚ãªãŸã¯${this.personalityMetadata.personalityType}ã¨ã—ã¦ã€3ã¤ã®OSäººæ ¼ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æŒã£ã¦ã„ã¾ã™ã€‚`,
                    osPersonalities: {
                        engineOS: {
                            name: this.engineOS.osName,
                            hexagram: this.engineOS.hexagramName,
                            description: 'å‰µé€ æ€§ã¨ç†æƒ³ã‚’è¿½æ±‚ã™ã‚‹äººæ ¼',
                            voice: this.engineOS.personality.voice,
                            strengths: this.engineOS.personality.strengths
                        },
                        interfaceOS: {
                            name: this.interfaceOS.osName,
                            hexagram: this.interfaceOS.hexagramName,
                            description: 'ç¤¾ä¼šçš„èª¿å’Œã‚’é‡è¦–ã™ã‚‹äººæ ¼',
                            voice: this.interfaceOS.personality.voice,
                            strengths: this.interfaceOS.personality.strengths
                        },
                        safeModeOS: {
                            name: this.safeModeOS.osName,
                            hexagram: this.safeModeOS.hexagramName,
                            description: 'å®‰å…¨ã¨å®‰å®šã‚’ç¢ºä¿ã™ã‚‹äººæ ¼',
                            voice: this.safeModeOS.personality.voice,
                            strengths: this.safeModeOS.personality.strengths
                        }
                    }
                };
            }
            
            getFullState() {
                return {
                    personalityState: this.personalityState,
                    personalityMetadata: this.personalityMetadata,
                    osStates: {
                        engineOS: this.engineOS,
                        interfaceOS: this.interfaceOS,
                        safeModeOS: this.safeModeOS
                    }
                };
            }
        }

        // Test functions
        let testUserAnswers = [];
        let testVirtualPersonality = null;

        function runSimpleTest() {
            const result = document.getElementById('simple-test-result');
            
            try {
                result.innerHTML = '<div class="info">ğŸ”§ Running simple test...</div>';
                
                // Generate test data
                testUserAnswers = [
                    {
                        question: "ã‚ãªãŸã®ä¾¡å€¤è¦³ã«ã¤ã„ã¦æœ€ã‚‚é‡è¦ãªã®ã¯ï¼Ÿ",
                        selectedOption: "ç†æƒ³ã‚’è¿½æ±‚ã—ã€å‰µé€ çš„ãªè¡¨ç¾ã‚’ã™ã‚‹ã“ã¨",
                        intensity: 0.8,
                        category: "engine"
                    },
                    {
                        question: "äººé–“é–¢ä¿‚ã§æœ€ã‚‚å¤§åˆ‡ã«ã—ã¦ã„ã‚‹ã“ã¨ã¯ï¼Ÿ",
                        selectedOption: "èª¿å’Œã‚’ä¿ã¡ã€çš†ãŒå¹¸ã›ã«ãªã‚‹ã“ã¨",
                        intensity: 0.7,
                        category: "interface"
                    },
                    {
                        question: "å›°é›£ãªçŠ¶æ³ã«ç›´é¢ã—ãŸæ™‚ã€ã‚ãªãŸã¯ï¼Ÿ",
                        selectedOption: "æ…é‡ã«ãƒªã‚¹ã‚¯ã‚’è©•ä¾¡ã—ã€å®‰å…¨ãªé¸æŠã‚’ã™ã‚‹",
                        intensity: 0.9,
                        category: "safemode"
                    }
                ];
                
                // Test PersonalityOS creation
                const engineOS = new PersonalityOS('engine', testUserAnswers);
                const interfaceOS = new PersonalityOS('interface', testUserAnswers);
                const safeModeOS = new PersonalityOS('safemode', testUserAnswers);
                
                // Test VirtualPersonality creation
                testVirtualPersonality = new VirtualPersonality(testUserAnswers);
                
                let html = '<div class="success">âœ… Simple test completed successfully!</div>';
                html += '<div class="info">ğŸ“Š Test Results:</div>';
                html += `<p>â€¢ Engine OS: ${engineOS.osName} (æ´»æ€§åº¦: ${engineOS.activation.toFixed(3)})</p>`;
                html += `<p>â€¢ Interface OS: ${interfaceOS.osName} (æ´»æ€§åº¦: ${interfaceOS.activation.toFixed(3)})</p>`;
                html += `<p>â€¢ SafeMode OS: ${safeModeOS.osName} (æ´»æ€§åº¦: ${safeModeOS.activation.toFixed(3)})</p>`;
                html += `<p>â€¢ Virtual Personality ID: ${testVirtualPersonality.id}</p>`;
                html += `<p>â€¢ Personality Type: ${testVirtualPersonality.personalityMetadata.personalityType}</p>`;
                html += `<p>â€¢ Dominant OS: ${testVirtualPersonality.personalityState.currentDominantOS}</p>`;
                
                result.innerHTML = html;
                
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ Test failed: ${error.message}</div>`;
                console.error('Simple test error:', error);
            }
        }

        function runBasicPersonalityTest() {
            const result = document.getElementById('simple-test-result');
            
            if (!testVirtualPersonality) {
                result.innerHTML = '<div class="warning">âš ï¸ Run Simple Test first to create personality!</div>';
                return;
            }
            
            try {
                const scenario = "æ–°ã—ã„è·å ´ã§ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒ¼ãƒ€ãƒ¼å°±ä»»ã®ææ¡ˆ";
                const dialogue = testVirtualPersonality.simulateInternalDialogue(scenario);
                const prediction = testVirtualPersonality.predictBehavior(scenario);
                
                let html = '<div class="success">âœ… Basic personality test completed!</div>';
                html += `<div class="info">ğŸ—¨ï¸ Internal Dialogue Scenario: "${scenario}"</div>`;
                html += `<p><strong>Consensus Level:</strong> ${(dialogue.consensusLevel * 100).toFixed(1)}%</p>`;
                html += `<p><strong>Final Outcome:</strong> ${dialogue.outcome}</p>`;
                html += `<p><strong>Behavior Prediction:</strong> ${prediction.integratedPrediction}</p>`;
                html += `<p><strong>Prediction Confidence:</strong> ${(prediction.confidence * 100).toFixed(1)}%</p>`;
                
                result.innerHTML = html;
                
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ Personality test failed: ${error.message}</div>`;
                console.error('Personality test error:', error);
            }
        }

        function checkClassAvailability() {
            const result = document.getElementById('class-check-result');
            
            let html = '<div class="info">ğŸ” Class Availability Check:</div>';
            html += `<p>â€¢ PersonalityOS: ${typeof PersonalityOS !== 'undefined' ? 'âœ… Available' : 'âŒ Not Available'}</p>`;
            html += `<p>â€¢ VirtualPersonality: ${typeof VirtualPersonality !== 'undefined' ? 'âœ… Available' : 'âŒ Not Available'}</p>`;
            
            if (typeof PersonalityOS !== 'undefined' && typeof VirtualPersonality !== 'undefined') {
                html += '<div class="success">ğŸ‰ All classes are available and ready for testing!</div>';
            } else {
                html += '<div class="error">âš ï¸ Some classes are missing. Check console for errors.</div>';
            }
            
            result.innerHTML = html;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ­ Virtual Personality Phase 1 Test Page (Standalone) Loaded');
            checkClassAvailability();
        });
    </script>
</body>
</html>