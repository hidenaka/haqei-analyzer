<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .data-sample { 
            max-height: 200px; 
            overflow-y: auto; 
            background: #f8f9fa; 
            padding: 10px; 
            border-radius: 4px; 
        }
    </style>
</head>
<body>
    <h1>ğŸ” H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ</h1>
    <p>HAQEI Analyzer H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆ386çˆ»ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã®ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã§ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
    
    <div class="test-container">
        <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
        <button onclick="runAllTests()">ğŸš€ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="testDataIntegrity()">ğŸ“‹ ãƒ‡ãƒ¼ã‚¿å®Œå…¨æ€§ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testYaoEntries()">ğŸ¯ ç”¨ä¹ãƒ»ç”¨å…­ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testDataAccess()">ğŸ” ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="clearResults()">ğŸ§¹ çµæœã‚¯ãƒªã‚¢</button>
        
        <div id="test-results"></div>
    </div>
    
    <div class="test-container">
        <h2>ğŸ“ˆ ãƒ†ã‚¹ãƒˆè©³ç´°çµæœ</h2>
        <div id="detailed-results"></div>
    </div>
    
    <div class="test-container">
        <h2>ğŸ“ ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ«</h2>
        <div id="data-samples"></div>
    </div>

    <!-- H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èª­ã¿è¾¼ã¿ -->
    <script src="./assets/H384H64database.js"></script>
    
    <script>
        let testResults = [];
        
        /**
         * ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤ºã‚¨ãƒªã‚¢ã«è¿½åŠ 
         */
        function addTestResult(type, title, message, details = null) {
            const result = {
                type: type,
                title: title,
                message: message,
                details: details,
                timestamp: new Date().toISOString()
            };
            
            testResults.push(result);
            
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            
            let content = `<strong>${title}</strong>: ${message}`;
            if (details) {
                content += `<pre>${details}</pre>`;
            }
            
            resultDiv.innerHTML = content;
            resultsDiv.appendChild(resultDiv);
            
            // è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        /**
         * H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŸºæœ¬ãƒã‚§ãƒƒã‚¯
         */
        function testBasicAvailability() {
            console.log('ğŸ” H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŸºæœ¬ãƒã‚§ãƒƒã‚¯é–‹å§‹...');
            
            // window.H384_DATAã®å­˜åœ¨ç¢ºèª
            if (typeof window.H384_DATA === 'undefined') {
                addTestResult('error', 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å­˜åœ¨ç¢ºèª', 'window.H384_DATA ãŒæœªå®šç¾©ã§ã™');
                return false;
            }
            
            // é…åˆ—ã‹ã©ã†ã‹ç¢ºèª
            if (!Array.isArray(window.H384_DATA)) {
                addTestResult('error', 'ãƒ‡ãƒ¼ã‚¿å½¢å¼ç¢ºèª', 'H384_DATA ã¯é…åˆ—ã§ã¯ã‚ã‚Šã¾ã›ã‚“');
                return false;
            }
            
            // ãƒ‡ãƒ¼ã‚¿é•·ç¢ºèª
            const length = window.H384_DATA.length;
            if (length !== 386) {
                addTestResult('warning', 'ãƒ‡ãƒ¼ã‚¿é•·ç¢ºèª', `ãƒ‡ãƒ¼ã‚¿é•·: ${length} (æœŸå¾…å€¤: 386)`);
            } else {
                addTestResult('success', 'ãƒ‡ãƒ¼ã‚¿é•·ç¢ºèª', `âœ… æ­£ç¢ºã«386ã‚¨ãƒ³ãƒˆãƒªãŒå­˜åœ¨ã—ã¾ã™`);
            }
            
            addTestResult('success', 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å­˜åœ¨ç¢ºèª', 'âœ… H384_DATAæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™');
            return true;
        }
        
        /**
         * ãƒ‡ãƒ¼ã‚¿å®Œå…¨æ€§ãƒ†ã‚¹ãƒˆ
         */
        function testDataIntegrity() {
            console.log('ğŸ“‹ ãƒ‡ãƒ¼ã‚¿å®Œå…¨æ€§ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            if (!testBasicAvailability()) {
                return;
            }
            
            const data = window.H384_DATA;
            const requiredFields = ['é€šã—ç•ªå·', 'å¦ç•ªå·', 'å¦å', 'çˆ»', 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰', 'ç¾ä»£è§£é‡ˆã®è¦ç´„'];
            
            let validEntries = 0;
            let invalidEntries = [];
            
            data.forEach((entry, index) => {
                const missingFields = requiredFields.filter(field => !entry.hasOwnProperty(field));
                
                if (missingFields.length === 0) {
                    validEntries++;
                } else {
                    invalidEntries.push({
                        index: index,
                        entry: entry,
                        missingFields: missingFields
                    });
                }
            });
            
            if (invalidEntries.length === 0) {
                addTestResult('success', 'ãƒ‡ãƒ¼ã‚¿å®Œå…¨æ€§', `âœ… å…¨${data.length}ã‚¨ãƒ³ãƒˆãƒªã®å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå®Œå…¨ã§ã™`);
            } else {
                addTestResult('error', 'ãƒ‡ãƒ¼ã‚¿å®Œå…¨æ€§', 
                    `âŒ ${invalidEntries.length}å€‹ã®ã‚¨ãƒ³ãƒˆãƒªã«å•é¡ŒãŒã‚ã‚Šã¾ã™`, 
                    `ä¸æ­£ã‚¨ãƒ³ãƒˆãƒªã®ä¾‹:\n${JSON.stringify(invalidEntries.slice(0, 3), null, 2)}`
                );
            }
            
            // ã‚¹ã‚³ã‚¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç¢ºèª
            const scoreFields = ['S1_åŸºæœ¬ã‚¹ã‚³ã‚¢', 'S2_ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«', 'S3_å®‰å®šæ€§ã‚¹ã‚³ã‚¢', 'S4_ãƒªã‚¹ã‚¯', 'S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢'];
            let scoreValidEntries = 0;
            
            data.forEach(entry => {
                const hasAllScores = scoreFields.every(field => 
                    entry.hasOwnProperty(field) && typeof entry[field] === 'number'
                );
                if (hasAllScores) scoreValidEntries++;
            });
            
            addTestResult('info', 'ã‚¹ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿', 
                `ğŸ“Š ${scoreValidEntries}/${data.length}ã‚¨ãƒ³ãƒˆãƒªãŒã‚¹ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ã¾ã™`
            );
        }
        
        /**
         * ç”¨ä¹ãƒ»ç”¨å…­ã‚¨ãƒ³ãƒˆãƒªãƒ†ã‚¹ãƒˆ
         */
        function testYaoEntries() {
            console.log('ğŸ¯ ç”¨ä¹ãƒ»ç”¨å…­ã‚¨ãƒ³ãƒˆãƒªãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            if (!testBasicAvailability()) {
                return;
            }
            
            const data = window.H384_DATA;
            
            // ç”¨ä¹ã‚¨ãƒ³ãƒˆãƒªæ¤œç´¢ (é€šã—ç•ªå·7)
            const youkuu = data.find(entry => entry['é€šã—ç•ªå·'] === 7 && entry['çˆ»'] === 'ç”¨ä¹');
            if (youkuu) {
                addTestResult('success', 'ç”¨ä¹ã‚¨ãƒ³ãƒˆãƒª', 
                    `âœ… ç”¨ä¹ã‚¨ãƒ³ãƒˆãƒªãŒæ­£å¸¸ã«å­˜åœ¨ã—ã¾ã™ (${youkuu['å¦å']})`,
                    JSON.stringify(youkuu, null, 2)
                );
            } else {
                addTestResult('error', 'ç”¨ä¹ã‚¨ãƒ³ãƒˆãƒª', 'âŒ ç”¨ä¹ã‚¨ãƒ³ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            // ç”¨å…­ã‚¨ãƒ³ãƒˆãƒªæ¤œç´¢ (é€šã—ç•ªå·14)
            const yourikuu = data.find(entry => entry['é€šã—ç•ªå·'] === 14 && entry['çˆ»'] === 'ç”¨å…­');
            if (yourikuu) {
                addTestResult('success', 'ç”¨å…­ã‚¨ãƒ³ãƒˆãƒª', 
                    `âœ… ç”¨å…­ã‚¨ãƒ³ãƒˆãƒªãŒæ­£å¸¸ã«å­˜åœ¨ã—ã¾ã™ (${yourikuu['å¦å']})`,
                    JSON.stringify(yourikuu, null, 2)
                );
            } else {
                addTestResult('error', 'ç”¨å…­ã‚¨ãƒ³ãƒˆãƒª', 'âŒ ç”¨å…­ã‚¨ãƒ³ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            // 64å¦ç¢ºèª
            const hexagramCount = [...new Set(data.map(entry => entry['å¦ç•ªå·']))].length;
            addTestResult('info', 'å¦æ•°ç¢ºèª', `ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¯${hexagramCount}å€‹ã®ç•°ãªã‚‹å¦ãŒå«ã¾ã‚Œã¦ã„ã¾ã™`);
        }
        
        /**
         * ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ»æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
         */
        function testDataAccess() {
            console.log('ğŸ” ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            if (!testBasicAvailability()) {
                return;
            }
            
            const data = window.H384_DATA;
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã‚¨ãƒ³ãƒˆãƒªã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ
            const randomIndex = Math.floor(Math.random() * data.length);
            const randomEntry = data[randomIndex];
            
            addTestResult('success', 'ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ã‚¯ã‚»ã‚¹', 
                `âœ… ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹${randomIndex}ã®ãƒ‡ãƒ¼ã‚¿ã«æ­£å¸¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã—ãŸ`,
                `ã‚¨ãƒ³ãƒˆãƒªè©³ç´°:\né€šã—ç•ªå·: ${randomEntry['é€šã—ç•ªå·']}\nå¦å: ${randomEntry['å¦å']}\nçˆ»: ${randomEntry['çˆ»']}`
            );
            
            // æ¤œç´¢æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
            const searchResult = data.filter(entry => entry['å¦å'].includes('ä¹¾'));
            addTestResult('info', 'æ¤œç´¢æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ', 
                `ğŸ” ã€Œä¹¾ã€ã‚’å«ã‚€å¦: ${searchResult.length}å€‹è¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`
            );
            
            // ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ†ã‚¹ãƒˆ
            if (data.length > 0 && data[0]['S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢'] !== undefined) {
                const avgScore = data.reduce((sum, entry) => 
                    sum + (entry['S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢'] || 0), 0) / data.length;
                    
                addTestResult('info', 'ã‚¹ã‚³ã‚¢çµ±è¨ˆ', 
                    `ğŸ“ˆ ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢å¹³å‡: ${avgScore.toFixed(2)}ç‚¹`
                );
            }
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ãƒ†ã‚¹ãƒˆ
            if (typeof window.validateH384DataIntegrity === 'function') {
                try {
                    const validationResult = window.validateH384DataIntegrity();
                    addTestResult('success', 'ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°', 
                        `âœ… validateH384DataIntegrityé–¢æ•°ãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã—ãŸ`,
                        JSON.stringify(validationResult, null, 2)
                    );
                } catch (error) {
                    addTestResult('error', 'ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°', 
                        `âŒ validateH384DataIntegrityé–¢æ•°ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ: ${error.message}`
                    );
                }
            } else {
                addTestResult('warning', 'ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°', 
                    'âš ï¸ validateH384DataIntegrityé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'
                );
            }
        }
        
        /**
         * ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ«è¡¨ç¤º
         */
        function showDataSamples() {
            if (!window.H384_DATA || !Array.isArray(window.H384_DATA)) {
                return;
            }
            
            const samplesDiv = document.getElementById('data-samples');
            const data = window.H384_DATA;
            
            // æœ€åˆã®3ã‚¨ãƒ³ãƒˆãƒªã‚’è¡¨ç¤º
            const samples = data.slice(0, 3);
            
            let html = '<h3>ğŸ“ ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ« (æœ€åˆã®3ã‚¨ãƒ³ãƒˆãƒª)</h3>';
            samples.forEach((entry, index) => {
                html += `
                    <div class="data-sample">
                        <h4>ã‚¨ãƒ³ãƒˆãƒª ${index + 1}: ${entry['å¦å']} ${entry['çˆ»']}</h4>
                        <pre>${JSON.stringify(entry, null, 2)}</pre>
                    </div>
                `;
            });
            
            samplesDiv.innerHTML = html;
        }
        
        /**
         * è©³ç´°çµæœè¡¨ç¤º
         */
        function showDetailedResults() {
            const detailedDiv = document.getElementById('detailed-results');
            
            if (testResults.length === 0) {
                detailedDiv.innerHTML = '<p>ã¾ã ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>';
                return;
            }
            
            let html = '<h3>ğŸ“ˆ è©³ç´°ãƒ†ã‚¹ãƒˆçµæœ</h3>';
            html += `<p>å®Ÿè¡Œãƒ†ã‚¹ãƒˆæ•°: ${testResults.length}</p>`;
            
            const successCount = testResults.filter(r => r.type === 'success').length;
            const errorCount = testResults.filter(r => r.type === 'error').length;
            const warningCount = testResults.filter(r => r.type === 'warning').length;
            
            html += `
                <div class="test-summary">
                    <span class="success">âœ… æˆåŠŸ: ${successCount}</span>
                    <span class="error">âŒ ã‚¨ãƒ©ãƒ¼: ${errorCount}</span>
                    <span class="warning">âš ï¸ è­¦å‘Š: ${warningCount}</span>
                </div>
            `;
            
            detailedDiv.innerHTML = html;
        }
        
        /**
         * å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
         */
        function runAllTests() {
            clearResults();
            
            addTestResult('info', 'ãƒ†ã‚¹ãƒˆé–‹å§‹', 'ğŸš€ H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å…¨ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...');
            
            setTimeout(() => {
                testDataIntegrity();
                setTimeout(() => {
                    testYaoEntries();
                    setTimeout(() => {
                        testDataAccess();
                        setTimeout(() => {
                            showDataSamples();
                            showDetailedResults();
                            addTestResult('info', 'ãƒ†ã‚¹ãƒˆå®Œäº†', 'âœ… å…¨ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ');
                        }, 500);
                    }, 500);
                }, 500);
            }, 500);
        }
        
        /**
         * çµæœã‚¯ãƒªã‚¢
         */
        function clearResults() {
            testResults = [];
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('detailed-results').innerHTML = '';
            document.getElementById('data-samples').innerHTML = '';
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸãƒã‚§ãƒƒã‚¯
        window.addEventListener('load', function() {
            console.log('H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            
            // åŸºæœ¬å¯ç”¨æ€§ãƒã‚§ãƒƒã‚¯
            setTimeout(() => {
                addTestResult('info', 'ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†', 'H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
                testBasicAvailability();
            }, 1000);
        });
    </script>
</body>
</html>