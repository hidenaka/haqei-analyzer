<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>結果表示テスト</title>
    <style>
        body {
            background: #1a1a2e;
            color: #fff;
            padding: 20px;
            font-family: 'Inter', sans-serif;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        .os-card {
            margin: 10px;
            padding: 20px;
            background: rgba(99, 102, 241, 0.1);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 8px;
        }
        .success {
            color: #10b981;
        }
        .error {
            color: #ef4444;
        }
        button {
            padding: 10px 20px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #5558d9;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🔍 HAQEI OS Analyzer - 結果表示テスト</h1>
        
        <div class="test-section">
            <h2>📊 テストコントロール</h2>
            <button onclick="testTripleOSCalculation()">Triple OS計算テスト</button>
            <button onclick="testResultDisplay()">結果表示テスト</button>
            <button onclick="testEnergyDisplay()">エネルギー分布テスト</button>
            <button onclick="testOSInteraction()">相互関係テスト</button>
        </div>
        
        <div class="test-section">
            <h2>📝 テスト結果</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>🎯 Triple OS結果プレビュー</h2>
            <div id="os-cards-container" class="os-cards"></div>
        </div>
        
        <div class="test-section">
            <h2>📊 エネルギー分布</h2>
            <canvas id="energy-chart"></canvas>
        </div>
    </div>

    <!-- 必要なライブラリ -->
    <script src="/assets/H384H64database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <script>
        // テスト用のモックデータ
        const mockAnswers = Array(30).fill(null).map((_, i) => ({
            questionId: i + 1,
            value: Math.floor(Math.random() * 5),
            trigrams: ['乾', '兌', '離'].map((t, j) => j === i % 3 ? t : null).filter(Boolean)
        }));

        // Triple OS計算テスト
        function testTripleOSCalculation() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<h3>Triple OS計算テスト実行中...</h3>';
            
            try {
                // 簡易版のTriple OS計算
                const engineOS = {
                    hexagramId: 1,
                    hexagramName: '乾為天',
                    catchphrase: '「天の創造力そのもの」',
                    description: '純粋な創造エネルギーを持つ',
                    primaryTrigram: '乾',
                    secondaryTrigram: '乾',
                    trigramEnergies: { 乾: 80, 兌: 60, 離: 40, 震: 50, 巽: 30, 坎: 45, 艮: 35, 坤: 25 }
                };
                
                const interfaceOS = {
                    hexagramId: 11,
                    hexagramName: '地天泰',
                    catchphrase: '「天地が交わり平和をもたらす」',
                    description: '調和と平衡を重視する社会的システム',
                    upperTrigram: '坤',
                    lowerTrigram: '乾',
                    trigramEnergies: { 乾: 65, 兌: 55, 離: 45, 震: 40, 巽: 50, 坎: 35, 艮: 40, 坤: 70 }
                };
                
                const safeModeOS = {
                    hexagramId: 2,
                    hexagramName: '坤為地',
                    catchphrase: '「大地の包容力」',
                    description: '柔軟で適応的な防御システム',
                    primaryDefense: '坤',
                    secondaryDefense: '坤',
                    trigramEnergies: { 乾: 20, 兌: 30, 離: 25, 震: 35, 巽: 40, 坎: 50, 艮: 60, 坤: 85 }
                };
                
                results.innerHTML = `
                    <h3 class="success">✅ Triple OS計算成功</h3>
                    <p><strong>Engine OS:</strong> ${engineOS.hexagramName} - ${engineOS.catchphrase}</p>
                    <p><strong>Interface OS:</strong> ${interfaceOS.hexagramName} - ${interfaceOS.catchphrase}</p>
                    <p><strong>SafeMode OS:</strong> ${safeModeOS.hexagramName} - ${safeModeOS.catchphrase}</p>
                `;
                
                // グローバルに保存
                window.testTripleOS = { engineOS, interfaceOS, safeModeOS };
                
            } catch (error) {
                results.innerHTML = `<h3 class="error">❌ エラー: ${error.message}</h3>`;
            }
        }
        
        // 結果表示テスト
        function testResultDisplay() {
            const container = document.getElementById('os-cards-container');
            
            if (!window.testTripleOS) {
                testTripleOSCalculation();
            }
            
            const { engineOS, interfaceOS, safeModeOS } = window.testTripleOS;
            
            // OSカード作成
            container.innerHTML = `
                <div class="os-card" style="border-color: #6366f1;">
                    <h3>Engine OS</h3>
                    <p><strong>卦:</strong> ${engineOS.hexagramName}</p>
                    <p><strong>キャッチフレーズ:</strong> ${engineOS.catchphrase}</p>
                    <p><strong>説明:</strong> ${engineOS.description}</p>
                </div>
                <div class="os-card" style="border-color: #8b5cf6;">
                    <h3>Interface OS</h3>
                    <p><strong>卦:</strong> ${interfaceOS.hexagramName}</p>
                    <p><strong>キャッチフレーズ:</strong> ${interfaceOS.catchphrase}</p>
                    <p><strong>説明:</strong> ${interfaceOS.description}</p>
                </div>
                <div class="os-card" style="border-color: #10b981;">
                    <h3>Safe Mode OS</h3>
                    <p><strong>卦:</strong> ${safeModeOS.hexagramName}</p>
                    <p><strong>キャッチフレーズ:</strong> ${safeModeOS.catchphrase}</p>
                    <p><strong>説明:</strong> ${safeModeOS.description}</p>
                </div>
            `;
            
            const results = document.getElementById('test-results');
            results.innerHTML = '<h3 class="success">✅ 結果表示成功</h3>';
        }
        
        // エネルギー分布テスト
        function testEnergyDisplay() {
            if (!window.testTripleOS) {
                testTripleOSCalculation();
            }
            
            const ctx = document.getElementById('energy-chart').getContext('2d');
            
            // 既存のチャートを破棄
            if (window.energyChart) {
                window.energyChart.destroy();
            }
            
            const trigramLabels = ['乾', '兌', '離', '震', '巽', '坎', '艮', '坤'];
            const { engineOS, interfaceOS, safeModeOS } = window.testTripleOS;
            
            window.energyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: trigramLabels,
                    datasets: [
                        {
                            label: 'Engine OS',
                            data: trigramLabels.map(t => engineOS.trigramEnergies[t] || 0),
                            backgroundColor: 'rgba(99, 102, 241, 0.6)',
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Interface OS',
                            data: trigramLabels.map(t => interfaceOS.trigramEnergies[t] || 0),
                            backgroundColor: 'rgba(139, 92, 246, 0.6)',
                            borderColor: 'rgba(139, 92, 246, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Safe Mode OS',
                            data: trigramLabels.map(t => safeModeOS.trigramEnergies[t] || 0),
                            backgroundColor: 'rgba(16, 185, 129, 0.6)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            const results = document.getElementById('test-results');
            results.innerHTML = '<h3 class="success">✅ エネルギー分布表示成功</h3>';
        }
        
        // OS相互関係テスト
        function testOSInteraction() {
            const results = document.getElementById('test-results');
            
            if (!window.testTripleOS) {
                testTripleOSCalculation();
            }
            
            // 相互関係の計算（簡易版）
            const interaction = {
                consistency: 85,
                balance: 72,
                integration: 90,
                dominantOS: 'Engine OS',
                recommendation: '3つのOSがバランスよく機能しています'
            };
            
            results.innerHTML = `
                <h3 class="success">✅ OS相互関係分析成功</h3>
                <p><strong>整合性スコア:</strong> ${interaction.consistency}%</p>
                <p><strong>バランススコア:</strong> ${interaction.balance}%</p>
                <p><strong>統合度:</strong> ${interaction.integration}%</p>
                <p><strong>優勢OS:</strong> ${interaction.dominantOS}</p>
                <p><strong>推奨事項:</strong> ${interaction.recommendation}</p>
            `;
        }
        
        // ページ読み込み時に自動実行
        window.addEventListener('load', () => {
            testTripleOSCalculation();
            testResultDisplay();
        });
    </script>
</body>
</html>