<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentic Energy Balance Test - ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜äº‹ä¾‹æ¤œè¨¼</title>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; margin: 20px; background: #f8fafc; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .energy-input { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 15px 0; }
        .energy-item { text-align: center; }
        .energy-item label { display: block; margin-bottom: 5px; font-weight: bold; }
        .energy-item input { width: 80px; padding: 8px; text-align: center; border: 2px solid #e2e8f0; border-radius: 4px; }
        .high-energy { background: #fef5e7; border-color: #f59e0b !important; }
        .test-button { background: #6366f1; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        .test-button:hover { background: #5855eb; }
        .results { margin-top: 20px; }
        .result-card { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 15px; margin: 10px 0; }
        .legacy-result { border-color: #ef4444; background: #fef2f2; }
        .improved-result { border-color: #10b981; background: #f0fdf4; }
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .score { font-size: 18px; font-weight: bold; color: #374151; }
        .highlight { background: #fbbf24; color: #92400e; padding: 2px 6px; border-radius: 3px; }
        code { background: #f1f5f9; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ Authentic I-Ching Energy Balance Test</h1>
        <p><strong>ç›®çš„:</strong> ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜ã€Œå·½ã‚¨ãƒãƒ«ã‚®ãƒ¼85é«˜å€¤â†’å·½å«æœ‰å¦é¸æŠã€å•é¡Œã®è§£æ±ºæ¤œè¨¼</p>
        
        <div class="test-section">
            <h2>ğŸ“Š ã‚¨ãƒãƒ«ã‚®ãƒ¼åˆ†å¸ƒè¨­å®š</h2>
            <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜äº‹ä¾‹ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€å·½ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒé«˜å€¤ã®å ´åˆã‚’ãƒ†ã‚¹ãƒˆ</p>
            
            <div class="energy-input">
                <div class="energy-item">
                    <label>ä¹¾ (å‰µé€ )</label>
                    <input type="number" id="qian" value="45" min="0" max="100">
                </div>
                <div class="energy-item">
                    <label>å…Œ (èª¿å’Œ)</label>
                    <input type="number" id="dui" value="30" min="0" max="100">
                </div>
                <div class="energy-item">
                    <label>é›¢ (è¡¨ç¾)</label>
                    <input type="number" id="li" value="25" min="0" max="100">
                </div>
                <div class="energy-item">
                    <label>éœ‡ (è¡Œå‹•)</label>
                    <input type="number" id="zhen" value="35" min="0" max="100">
                </div>
                <div class="energy-item">
                    <label>å·½ (é©å¿œ)</label>
                    <input type="number" id="xun" value="85" min="0" max="100" class="high-energy">
                </div>
                <div class="energy-item">
                    <label>å (æ¢æ±‚)</label>
                    <input type="number" id="kan" value="40" min="0" max="100">
                </div>
                <div class="energy-item">
                    <label>è‰® (å®‰å®š)</label>
                    <input type="number" id="gen" value="20" min="0" max="100">
                </div>
                <div class="energy-item">
                    <label>å¤ (å—å®¹)</label>
                    <input type="number" id="kun" value="50" min="0" max="100">
                </div>
            </div>
            
            <button class="test-button" onclick="runComparison()">ğŸ” å¾“æ¥å¼ vs æ”¹å–„å¼ æ¯”è¼ƒãƒ†ã‚¹ãƒˆ</button>
            <button class="test-button" onclick="runTripleOSTest()">ğŸ”¯ Triple OS ç·åˆãƒ†ã‚¹ãƒˆ</button>
            <button class="test-button" onclick="resetToUserCase()">ğŸ”„ ãƒ¦ãƒ¼ã‚¶ãƒ¼äº‹ä¾‹ã«ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        
        <div id="results" class="results"></div>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ -->
    <script src="/assets/H384H64database.js"></script>
    <script src="/js/core/AuthenticEnergyBalanceEngine.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let authenticEngine;
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            try {
                authenticEngine = new AuthenticEnergyBalanceEngine();
                console.log('âœ… AuthenticEnergyBalanceEngine initialized for testing');
            } catch (error) {
                console.error('âŒ Failed to initialize AuthenticEnergyBalanceEngine:', error);
                document.getElementById('results').innerHTML = `
                    <div class="result-card legacy-result">
                        <h3>âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼</h3>
                        <p>AuthenticEnergyBalanceEngineã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}</p>
                    </div>
                `;
            }
        });

        // ã‚¨ãƒãƒ«ã‚®ãƒ¼å€¤å–å¾—
        function getEnergyValues() {
            return {
                'ä¹¾': parseInt(document.getElementById('qian').value) || 0,
                'å…Œ': parseInt(document.getElementById('dui').value) || 0,
                'é›¢': parseInt(document.getElementById('li').value) || 0,
                'éœ‡': parseInt(document.getElementById('zhen').value) || 0,
                'å·½': parseInt(document.getElementById('xun').value) || 0,
                'å': parseInt(document.getElementById('kan').value) || 0,
                'è‰®': parseInt(document.getElementById('gen').value) || 0,
                'å¤': parseInt(document.getElementById('kun').value) || 0
            };
        }
        
        // å¾“æ¥å¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateLegacyMethod(energies) {
            const sortedTrigrams = Object.entries(energies).sort(([, a], [, b]) => b - a);
            const upperTrigram = sortedTrigrams[0][0];
            const lowerTrigram = sortedTrigrams[1][0];
            
            // ç°¡æ˜“çš„ãª64å¦ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã«æº–æ‹ ï¼‰
            const trigramToNumber = {
                "ä¹¾": 1, "å…Œ": 2, "é›¢": 3, "éœ‡": 4,
                "å·½": 5, "å": 6, "è‰®": 7, "å¤": 8
            };
            
            const authenticHexagramMatrix = [
                [1, 43, 14, 34, 9, 5, 26, 11],   // ä¹¾ä¸Š
                [58, 60, 38, 54, 61, 59, 28, 19], // å…Œä¸Š
                [50, 64, 56, 62, 55, 63, 35, 8],  // é›¢ä¸Š
                [51, 16, 40, 32, 46, 48, 18, 7],  // éœ‡ä¸Š
                [57, 20, 53, 42, 37, 45, 22, 36], // å·½ä¸Š
                [6, 29, 4, 7, 59, 60, 3, 2],      // åä¸Š
                [33, 52, 39, 15, 53, 56, 31, 12], // è‰®ä¸Š
                [2, 47, 4, 7, 46, 29, 27, 24]     // å¤ä¸Š
            ];
            
            const upper = trigramToNumber[upperTrigram] || 1;
            const lower = trigramToNumber[lowerTrigram] || 1;
            const hexagramId = authenticHexagramMatrix[upper - 1][lower - 1];
            
            // HEXAGRAMSã‹ã‚‰åå‰å–å¾—
            const hexagramName = window.HEXAGRAMS ? 
                (window.HEXAGRAMS.find(h => h.hexagram_id === hexagramId) || {}).name_jp || `å¦${hexagramId}` :
                `å¦${hexagramId}`;
            
            return {
                method: 'legacy_highest_two',
                upperTrigram,
                lowerTrigram,
                hexagramId,
                hexagramName,
                energyUtilization: ((energies[upperTrigram] + energies[lowerTrigram]) / Object.values(energies).reduce((a,b) => a+b, 0) * 100).toFixed(1),
                problem: energies['å·½'] >= 80 && !hexagramName.includes('å·½') && upperTrigram !== 'å·½' && lowerTrigram !== 'å·½'
            };
        }
        
        // æ¯”è¼ƒãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function runComparison() {
            const energies = getEnergyValues();
            console.log('ğŸ” Running comparison test with energies:', energies);
            
            try {
                // 1. å¾“æ¥å¼çµæœ
                const legacyResult = simulateLegacyMethod(energies);
                
                // 2. æ”¹å–„å¼çµæœï¼ˆEngine OSç”¨ï¼‰
                const improvedResult = authenticEngine.selectOptimalHexagramByEnergyBalance(energies, 'Engine OS');
                
                // 3. çµæœè¡¨ç¤º
                displayComparison(legacyResult, improvedResult, energies);
                
            } catch (error) {
                console.error('âŒ Comparison test error:', error);
                document.getElementById('results').innerHTML = `
                    <div class="result-card legacy-result">
                        <h3>âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼</h3>
                        <p>æ¯”è¼ƒãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // æ¯”è¼ƒçµæœè¡¨ç¤º
        function displayComparison(legacy, improved, energies) {
            const xunsun = energies['å·½'];
            const isHighXun = xunsun >= 80;
            
            const html = `
                <div class="test-section">
                    <h2>ğŸ”¬ æ¯”è¼ƒãƒ†ã‚¹ãƒˆçµæœ</h2>
                    <div class="comparison">
                        <div class="result-card legacy-result">
                            <h3>âŒ å¾“æ¥å¼ï¼ˆå•é¡Œã®ã‚ã‚‹æ–¹å¼ï¼‰</h3>
                            <p><strong>æ‰‹æ³•:</strong> æœ€é«˜å€¤2ä¸‰çˆ»ã®å˜ç´”é¸æŠ</p>
                            <p><strong>é¸æŠ:</strong> ${legacy.upperTrigram}(ä¸Š) + ${legacy.lowerTrigram}(ä¸‹)</p>
                            <p><strong>64å¦:</strong> ${legacy.hexagramId}ç•ª ${legacy.hexagramName}</p>
                            <p><strong>ã‚¨ãƒãƒ«ã‚®ãƒ¼æ´»ç”¨åº¦:</strong> ${legacy.energyUtilization}%</p>
                            ${legacy.problem ? '<p class="highlight">âš ï¸ å•é¡Œ: å·½85é«˜å€¤ãªã®ã«å·½ã‚’å«ã¾ãªã„å¦ãŒé¸æŠ</p>' : ''}
                        </div>
                        
                        <div class="result-card improved-result">
                            <h3>âœ… æ”¹å–„å¼ï¼ˆå…¨ä½“èª¿å’Œé‡è¦–ï¼‰</h3>
                            <p><strong>æ‰‹æ³•:</strong> 5æ¬¡å…ƒèª¿å’Œåº¦ã«ã‚ˆã‚‹64å¦å…¨è©•ä¾¡</p>
                            <p><strong>é¸æŠ:</strong> ${improved.upperTrigram}(ä¸Š) + ${improved.lowerTrigram}(ä¸‹)</p>
                            <p><strong>64å¦:</strong> ${improved.hexagramId}ç•ª ${improved.hexagramName}</p>
                            <div class="score">èª¿å’Œåº¦: ${improved.harmonyScore.toFixed(1)}/100</div>
                            <p><strong>ã‚¨ãƒãƒ«ã‚®ãƒ¼æ´»ç”¨åº¦:</strong> ${improved.energyUtilization.toFixed(1)}%</p>
                            <p><strong>OSé©åˆåº¦:</strong> ${improved.osCompatibility.toFixed(1)}%</p>
                            ${isHighXun && (improved.upperTrigram === 'å·½' || improved.lowerTrigram === 'å·½') ? 
                                '<p class="highlight">âœ… æ”¹å–„: å·½é«˜å€¤ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒé©åˆ‡ã«æ´»ç”¨ã•ã‚Œã¾ã—ãŸ</p>' : ''}
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <h3>ğŸ“Š ã‚¨ãƒãƒ«ã‚®ãƒ¼åˆ†å¸ƒåˆ†æ</h3>
                        <p><strong>å…¥åŠ›ã‚¨ãƒãƒ«ã‚®ãƒ¼:</strong></p>
                        <code>${JSON.stringify(energies, null, 2)}</code>
                        
                        <h4>ğŸ” ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜å•é¡Œã®æ¤œè¨¼çµæœ:</h4>
                        <p><strong>å·½ã‚¨ãƒãƒ«ã‚®ãƒ¼å€¤:</strong> ${xunsun} ${isHighXun ? '(é«˜å€¤ âœ…)' : '(ä½å€¤)'}</p>
                        <p><strong>å¾“æ¥å¼ã§ã®å·½æ´»ç”¨:</strong> ${legacy.upperTrigram === 'å·½' || legacy.lowerTrigram === 'å·½' ? 'ã‚ã‚Š âœ…' : 'ãªã— âŒ'}</p>
                        <p><strong>æ”¹å–„å¼ã§ã®å·½æ´»ç”¨:</strong> ${improved.upperTrigram === 'å·½' || improved.lowerTrigram === 'å·½' ? 'ã‚ã‚Š âœ…' : 'ãªã—'}</p>
                        
                        ${improved.improvementRecommendations && improved.improvementRecommendations.length > 0 ? `
                            <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ:</h4>
                            ${improved.improvementRecommendations.map(rec => `<p>â€¢ ${rec.suggestion}</p>`).join('')}
                        ` : ''}
                    </div>
                </div>
            `;
            
            document.getElementById('results').innerHTML = html;
        }
        
        // Triple OSãƒ†ã‚¹ãƒˆ
        function runTripleOSTest() {
            const energies = getEnergyValues();
            console.log('ğŸ”¯ Running Triple OS test with energies:', energies);
            
            try {
                const engineResult = authenticEngine.selectOptimalHexagramByEnergyBalance(energies, 'Engine OS');
                const interfaceResult = authenticEngine.selectOptimalHexagramByEnergyBalance(energies, 'Interface OS');
                const safeModeResult = authenticEngine.selectOptimalHexagramByEnergyBalance(energies, 'Safe Mode OS');
                
                const html = `
                    <div class="test-section">
                        <h2>ğŸ”¯ Triple OS ç·åˆãƒ†ã‚¹ãƒˆçµæœ</h2>
                        
                        <div class="result-card improved-result">
                            <h3>ğŸ”¥ Engine OS (å†…çš„ä¾¡å€¤è¦³ã‚·ã‚¹ãƒ†ãƒ )</h3>
                            <p><strong>64å¦:</strong> ${engineResult.hexagramId}ç•ª ${engineResult.hexagramName}</p>
                            <p><strong>æ§‹æˆ:</strong> ${engineResult.upperTrigram}(ä¸Š) + ${engineResult.lowerTrigram}(ä¸‹)</p>
                            <div class="score">èª¿å’Œåº¦: ${engineResult.harmonyScore.toFixed(1)}/100</div>
                            <p><strong>ç‰¹å¾´:</strong> å‰µé€ -å®‰å®šé‡è¦–å‹ã€å†…çš„ä¸€è²«æ€§ã‚’é‡è¦–</p>
                        </div>
                        
                        <div class="result-card improved-result">
                            <h3>ğŸŒ Interface OS (ç¤¾ä¼šçš„ã‚·ã‚¹ãƒ†ãƒ )</h3>
                            <p><strong>64å¦:</strong> ${interfaceResult.hexagramId}ç•ª ${interfaceResult.hexagramName}</p>
                            <p><strong>æ§‹æˆ:</strong> ${interfaceResult.upperTrigram}(ä¸Š) + ${interfaceResult.lowerTrigram}(ä¸‹)</p>
                            <div class="score">èª¿å’Œåº¦: ${interfaceResult.harmonyScore.toFixed(1)}/100</div>
                            <p><strong>ç‰¹å¾´:</strong> èª¿å’Œ-è¡¨ç¾é‡è¦–å‹ã€ç¤¾ä¼šé©å¿œæ€§ã‚’é‡è¦–</p>
                        </div>
                        
                        <div class="result-card improved-result">
                            <h3>ğŸ›¡ï¸ Safe Mode OS (é˜²å¾¡ã‚·ã‚¹ãƒ†ãƒ )</h3>
                            <p><strong>64å¦:</strong> ${safeModeResult.hexagramId}ç•ª ${safeModeResult.hexagramName}</p>
                            <p><strong>æ§‹æˆ:</strong> ${safeModeResult.upperTrigram}(ä¸Š) + ${safeModeResult.lowerTrigram}(ä¸‹)</p>
                            <div class="score">èª¿å’Œåº¦: ${safeModeResult.harmonyScore.toFixed(1)}/100</div>
                            <p><strong>ç‰¹å¾´:</strong> å®‰å®š-å—å®¹é‡è¦–å‹ã€é˜²è­·çš„å®‰å®šæ€§ã‚’é‡è¦–</p>
                        </div>
                        
                        <div class="result-card">
                            <h3>ğŸ“ˆ Triple OS æ¯”è¼ƒåˆ†æ</h3>
                            <p><strong>æœ€é«˜èª¿å’Œåº¦:</strong> ${Math.max(engineResult.harmonyScore, interfaceResult.harmonyScore, safeModeResult.harmonyScore).toFixed(1)} 
                               (${engineResult.harmonyScore >= interfaceResult.harmonyScore && engineResult.harmonyScore >= safeModeResult.harmonyScore ? 'Engine OS' :
                                 interfaceResult.harmonyScore >= safeModeResult.harmonyScore ? 'Interface OS' : 'Safe Mode OS'})</p>
                            <p><strong>å¹³å‡èª¿å’Œåº¦:</strong> ${((engineResult.harmonyScore + interfaceResult.harmonyScore + safeModeResult.harmonyScore) / 3).toFixed(1)}/100</p>
                            <p><strong>å…¨OSå·½æ´»ç”¨:</strong> 
                               ${[engineResult, interfaceResult, safeModeResult].filter(r => r.upperTrigram === 'å·½' || r.lowerTrigram === 'å·½').length}/3 OS</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('results').innerHTML = html;
                
            } catch (error) {
                console.error('âŒ Triple OS test error:', error);
                document.getElementById('results').innerHTML = `
                    <div class="result-card legacy-result">
                        <h3>âŒ Triple OS ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼</h3>
                        <p>ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼äº‹ä¾‹ãƒªã‚»ãƒƒãƒˆ
        function resetToUserCase() {
            document.getElementById('qian').value = '45';
            document.getElementById('dui').value = '30';
            document.getElementById('li').value = '25';
            document.getElementById('zhen').value = '35';
            document.getElementById('xun').value = '85';
            document.getElementById('kan').value = '40';
            document.getElementById('gen').value = '20';
            document.getElementById('kun').value = '50';
            
            // å·½ã‚’å¼·èª¿
            document.getElementById('xun').focus();
        }
    </script>
</body>
</html>