<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI 30å•æ‰‹å‹•ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            padding: 20px;
            margin: 0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: #2a2a2a;
            padding: 30px;
            border-radius: 12px;
            border: 2px solid #6366f1;
        }
        .test-button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s;
        }
        .test-button:hover {
            background: #5855d6;
        }
        .status {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #6366f1;
        }
        .success { border-left-color: #10b981; }
        .warning { border-left-color: #f59e0b; }
        .error { border-left-color: #ef4444; }
        .log {
            background: #1f1f1f;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #444;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸš€ HAQEI 30å•æ‰‹å‹•ãƒ†ã‚¹ãƒˆ</h1>
        <p>ã“ã®ç”»é¢ã§HAQEIã®30å•å›ç­”ãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        
        <div class="test-controls">
            <button class="test-button" onclick="startTest()">ğŸ¯ ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
            <button class="test-button" onclick="checkElements()">ğŸ” è¦ç´ ç¢ºèª</button>
            <button class="test-button" onclick="forceVisibility()">ğŸ’ª è¦ç´ å¼·åˆ¶è¡¨ç¤º</button>
            <button class="test-button" onclick="openInNewTab()">ğŸ”— æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã</button>
        </div>
        
        <div id="status" class="status">
            ğŸ“‹ ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†ã€‚ã€Œãƒ†ã‚¹ãƒˆé–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
        </div>
        
        <div id="log" class="log">ãƒ†ã‚¹ãƒˆãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™...\n</div>
        
        <iframe id="testFrame" src="about:blank"></iframe>
    </div>

    <script>
        let testLog = '';
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            testLog += `[${timestamp}] ${message}\n`;
            document.getElementById('log').textContent = testLog;
            document.getElementById('log').scrollTop = document.getElementById('log').scrollHeight;
            console.log(message);
        }
        
        function updateStatus(message, type = 'status') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function startTest() {
            log('ğŸš€ HAQEI 30å•ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            updateStatus('ğŸ“± ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'warning');
            
            const iframe = document.getElementById('testFrame');
            iframe.src = 'http://localhost:8080/os_analyzer.html';
            
            iframe.onload = function() {
                log('âœ… ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
                updateStatus('âœ… ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº† - æ‰‹å‹•ã§ã€Œåˆ†æã‚’é–‹å§‹ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„', 'success');
                
                // iframeã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ç·Šæ€¥ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ³¨å…¥
                setTimeout(() => {
                    injectEmergencyFix();
                }, 2000);
            };
            
            iframe.onerror = function() {
                log('âŒ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼');
                updateStatus('âŒ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼', 'error');
            };
        }
        
        function injectEmergencyFix() {
            try {
                const iframe = document.getElementById('testFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                log('ğŸ”§ ç·Šæ€¥ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ³¨å…¥ä¸­...');
                
                const script = iframeDoc.createElement('script');
                script.textContent = `
                    (function() {
                        console.log('ğŸš¨ ç·Šæ€¥ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ');
                        
                        function forceQuestionVisibility() {
                            const haqeiQuestions = document.querySelectorAll('haqei-question');
                            console.log('ğŸ“ Found haqei-question elements:', haqeiQuestions.length);
                            
                            haqeiQuestions.forEach((element, index) => {
                                element.style.cssText = \`
                                    display: block !important;
                                    visibility: visible !important;
                                    opacity: 1 !important;
                                    position: relative !important;
                                    width: 100% !important;
                                    height: auto !important;
                                    min-height: 400px !important;
                                    margin: 20px auto !important;
                                    padding: 30px !important;
                                    background: #2a2a2a !important;
                                    border: 3px solid #6366f1 !important;
                                    border-radius: 12px !important;
                                    z-index: 9999 !important;
                                    pointer-events: auto !important;
                                \`;
                                
                                // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚‚ä¿®æ­£
                                const radios = element.querySelectorAll('input[type="radio"]');
                                radios.forEach(radio => {
                                    radio.style.cssText = \`
                                        display: inline-block !important;
                                        visibility: visible !important;
                                        opacity: 1 !important;
                                        pointer-events: auto !important;
                                        z-index: 10000 !important;
                                    \`;
                                });
                                
                                // ãƒ©ãƒ™ãƒ«ã‚‚ä¿®æ­£
                                const labels = element.querySelectorAll('label');
                                labels.forEach(label => {
                                    label.style.cssText = \`
                                        display: flex !important;
                                        visibility: visible !important;
                                        opacity: 1 !important;
                                        pointer-events: auto !important;
                                        z-index: 10000 !important;
                                        padding: 15px !important;
                                        margin: 10px 0 !important;
                                        background: #3a3a3a !important;
                                        border: 2px solid #555 !important;
                                        border-radius: 8px !important;
                                        color: #ffffff !important;
                                        cursor: pointer !important;
                                    \`;
                                });
                                
                                console.log(\`âœ… Fixed haqei-question \${index}\`);
                            });
                        }
                        
                        // å³åº§ã«å®Ÿè¡Œ
                        forceQuestionVisibility();
                        
                        // å®šæœŸçš„ã«å®Ÿè¡Œ
                        setInterval(forceQuestionVisibility, 1000);
                        
                        // DOMãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰å®Ÿè¡Œ
                        const observer = new MutationObserver(forceQuestionVisibility);
                        observer.observe(document.body, {
                            childList: true,
                            subtree: true,
                            attributes: true
                        });
                        
                        console.log('ğŸ” ç·Šæ€¥ä¿®æ­£ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å®Œäº†');
                    })();
                `;
                
                iframeDoc.head.appendChild(script);
                log('âœ… ç·Šæ€¥ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ³¨å…¥å®Œäº†');
                updateStatus('âœ… ç·Šæ€¥ä¿®æ­£é©ç”¨æ¸ˆã¿ - æ‰‹å‹•ã§è³ªå•ã«å›ç­”ã—ã¦ãã ã•ã„', 'success');
                
            } catch (error) {
                log(`âŒ ç·Šæ€¥ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ³¨å…¥ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateStatus('âš ï¸ ç·Šæ€¥ä¿®æ­£ã«å¤±æ•— - ç›´æ¥ãƒšãƒ¼ã‚¸ã§æ“ä½œã—ã¦ãã ã•ã„', 'warning');
            }
        }
        
        function checkElements() {
            try {
                const iframe = document.getElementById('testFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const haqeiQuestions = iframeDoc.querySelectorAll('haqei-question');
                const radioButtons = iframeDoc.querySelectorAll('input[type="radio"]');
                const labels = iframeDoc.querySelectorAll('label');
                
                log(`ğŸ” è¦ç´ ç¢ºèªçµæœ:`);
                log(`  - haqei-question: ${haqeiQuestions.length}å€‹`);
                log(`  - ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³: ${radioButtons.length}å€‹`);
                log(`  - ãƒ©ãƒ™ãƒ«: ${labels.length}å€‹`);
                
                haqeiQuestions.forEach((q, i) => {
                    const rect = q.getBoundingClientRect();
                    log(`  - è³ªå•${i}: w=${rect.width}, h=${rect.height}, visible=${rect.width > 0 && rect.height > 0}`);
                });
                
                updateStatus(`ğŸ“Š è¦ç´ ç¢ºèªå®Œäº† - è³ªå•:${haqeiQuestions.length}å€‹, ãƒœã‚¿ãƒ³:${radioButtons.length}å€‹`, 'success');
                
            } catch (error) {
                log(`âŒ è¦ç´ ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateStatus('âŒ è¦ç´ ç¢ºèªã«å¤±æ•—', 'error');
            }
        }
        
        function forceVisibility() {
            try {
                const iframe = document.getElementById('testFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // ç·Šæ€¥ä¿®æ­£é–¢æ•°ã‚’å†å®Ÿè¡Œ
                iframeDoc.defaultView.eval(`
                    const haqeiQuestions = document.querySelectorAll('haqei-question');
                    haqeiQuestions.forEach(element => {
                        element.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important; position: relative !important; width: 100% !important; height: auto !important; min-height: 400px !important; margin: 20px auto !important; padding: 30px !important; background: #2a2a2a !important; border: 3px solid #6366f1 !important; border-radius: 12px !important; z-index: 9999 !important; pointer-events: auto !important;';
                    });
                    
                    const radioButtons = document.querySelectorAll('input[type="radio"]');
                    radioButtons.forEach(radio => {
                        radio.style.cssText = 'display: inline-block !important; visibility: visible !important; opacity: 1 !important; pointer-events: auto !important; z-index: 10000 !important;';
                    });
                    
                    const labels = document.querySelectorAll('label');
                    labels.forEach(label => {
                        label.style.cssText = 'display: flex !important; visibility: visible !important; opacity: 1 !important; pointer-events: auto !important; z-index: 10000 !important; padding: 15px !important; margin: 10px 0 !important; background: #3a3a3a !important; border: 2px solid #555 !important; border-radius: 8px !important; color: #ffffff !important; cursor: pointer !important;';
                    });
                    
                    console.log('ğŸ’ª å¼·åˆ¶è¡¨ç¤ºå®Ÿè¡Œå®Œäº†');
                `);
                
                log('ğŸ’ª è¦ç´ å¼·åˆ¶è¡¨ç¤ºã‚’å®Ÿè¡Œ');
                updateStatus('ğŸ’ª è¦ç´ å¼·åˆ¶è¡¨ç¤ºå®Œäº†', 'success');
                
            } catch (error) {
                log(`âŒ å¼·åˆ¶è¡¨ç¤ºã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateStatus('âŒ å¼·åˆ¶è¡¨ç¤ºã«å¤±æ•—', 'error');
            }
        }
        
        function openInNewTab() {
            window.open('http://localhost:8080/os_analyzer.html', '_blank');
            log('ğŸ”— æ–°ã—ã„ã‚¿ãƒ–ã§ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã—ãŸ');
            updateStatus('ğŸ”— æ–°ã—ã„ã‚¿ãƒ–ã§ç›´æ¥ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„', 'success');
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ†ã‚¹ãƒˆã‚’è‡ªå‹•é–‹å§‹
        window.onload = function() {
            log('ğŸ“‹ æ‰‹å‹•ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸æº–å‚™å®Œäº†');
            updateStatus('ğŸ“‹ æº–å‚™å®Œäº† - ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„', 'success');
        };
    </script>
</body>
</html>