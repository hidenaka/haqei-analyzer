# テストコード集 - 各ステップ検証用

**作成日**: 2025年8月18日  
**用途**: 各実装ステップ後の動作確認  
**使用方法**: ブラウザのコンソールにコピー&ペーストして実行

## 🧪 STEP 0: ファイル存在テスト

```javascript
// テスト0-1: 必須ファイル確認
(() => {
    console.log('===== ファイル存在確認 =====');
    const files = [
        '/os_analyzer.html',
        '/js/os-analyzer-main.js',
        '/css/os-analyzer.css',
        '/js/core/QuestionManager.js',
        '/js/ScreenManager.js'
    ];
    
    files.forEach(file => {
        fetch(file, { method: 'HEAD' })
            .then(res => console.log(`${file}: ${res.ok ? '✅ 存在' : '❌ 不在'}`))
            .catch(() => console.log(`${file}: ❌ エラー`));
    });
})();
```

---

## 🧪 STEP 1: タブボタン構造テスト

```javascript
// テスト1-1: タブボタン数の確認
(() => {
    const buttons = document.querySelectorAll('.tab-button');
    console.log(`タブボタン数: ${buttons.length}`);
    console.log(buttons.length === 4 ? '✅ 正常（4個）' : `❌ 異常（${buttons.length}個）`);
    
    // 各ボタンの詳細
    buttons.forEach((btn, i) => {
        console.log(`  ${i+1}. ${btn.textContent} (data-tab="${btn.dataset.tab}")`);
    });
})();
```

```javascript
// テスト1-2: 必須タブの存在確認
(() => {
    const required = ['basic', 'synergy', 'transparency', 'application'];
    const forbidden = ['detail', 'expert', 'integration'];
    
    console.log('===== 必須タブ確認 =====');
    required.forEach(tab => {
        const exists = document.querySelector(`[data-tab="${tab}"]`);
        console.log(`${tab}: ${exists ? '✅' : '❌'}`);
    });
    
    console.log('===== 削除確認 =====');
    forbidden.forEach(tab => {
        const exists = document.querySelector(`[data-tab="${tab}"]`);
        console.log(`${tab}: ${!exists ? '✅ 削除済み' : '❌ まだ存在'}`);
    });
})();
```

---

## 🧪 STEP 2: シナジータブHTML要素テスト

```javascript
// テスト2-1: 主要要素の存在確認
(() => {
    const elements = [
        'synergy-content',
        'golden-pattern-analysis',
        'success-patterns',
        'warning-patterns',
        'consistency-circle',
        'consistency-value',
        'consistency-type',
        'os-flow-chart',
        'engine-flow-name',
        'interface-flow-name',
        'safemode-flow-name',
        'energy-loss-points',
        'optimization-actions'
    ];
    
    console.log('===== シナジータブ要素確認 =====');
    let passCount = 0;
    elements.forEach(id => {
        const exists = document.getElementById(id);
        console.log(`${id}: ${exists ? '✅' : '❌'}`);
        if (exists) passCount++;
    });
    
    console.log(`\n結果: ${passCount}/${elements.length} 要素OK`);
    console.log(passCount === elements.length ? '✅ 全要素OK' : '❌ 不足あり');
})();
```

```javascript
// テスト2-2: HTML構造の階層確認
(() => {
    const synergyContent = document.getElementById('synergy-content');
    if (!synergyContent) {
        console.log('❌ synergy-content が見つかりません');
        return;
    }
    
    const sections = synergyContent.querySelectorAll('.synergy-section, .compatibility-section, .coordination-section, .optimization-section');
    console.log(`セクション数: ${sections.length}`);
    console.log(sections.length === 4 ? '✅ 4セクション正常' : '❌ セクション数異常');
    
    sections.forEach((section, i) => {
        const title = section.querySelector('.section-title');
        console.log(`  ${i+1}. ${title ? title.textContent : '❌ タイトルなし'}`);
    });
})();
```

---

## 🧪 STEP 3: 不要タブ削除テスト

```javascript
// テスト3-1: 削除確認
(() => {
    const shouldBeDeleted = ['detail-content', 'expert-content', 'integration-content'];
    const shouldExist = ['basic-content', 'synergy-content', 'transparency-content', 'application-content'];
    
    console.log('===== 削除されるべき要素 =====');
    let deleteOK = true;
    shouldBeDeleted.forEach(id => {
        const exists = document.getElementById(id);
        console.log(`${id}: ${!exists ? '✅ 削除済み' : '❌ まだ存在'}`);
        if (exists) deleteOK = false;
    });
    
    console.log('\n===== 残るべき要素 =====');
    let existOK = true;
    shouldExist.forEach(id => {
        const exists = document.getElementById(id);
        console.log(`${id}: ${exists ? '✅ 存在' : '❌ 消えている！'}`);
        if (!exists) existOK = false;
    });
    
    console.log(`\n総合判定: ${deleteOK && existOK ? '✅ 完璧' : '❌ 要修正'}`);
})();
```

---

## 🧪 STEP 4: CSS適用テスト

```javascript
// テスト4-1: CSS読み込み確認
(() => {
    const styleSheets = Array.from(document.styleSheets);
    const osAnalyzerCSS = styleSheets.find(sheet => 
        sheet.href && sheet.href.includes('os-analyzer.css')
    );
    
    console.log('===== CSS読み込み確認 =====');
    console.log(osAnalyzerCSS ? '✅ os-analyzer.css 読み込み済み' : '❌ CSS未読み込み');
    
    if (osAnalyzerCSS) {
        try {
            const rules = Array.from(osAnalyzerCSS.cssRules || osAnalyzerCSS.rules);
            const synergyRules = rules.filter(rule => 
                rule.selectorText && rule.selectorText.includes('synergy')
            );
            console.log(`シナジー関連ルール数: ${synergyRules.length}`);
            console.log(synergyRules.length > 0 ? '✅ シナジーCSS適用済み' : '❌ シナジーCSS未適用');
        } catch (e) {
            console.log('⚠️ CSSルール読み取り不可（CORS）');
        }
    }
})();
```

```javascript
// テスト4-2: スタイル適用確認
(() => {
    // テスト要素を作成
    const testDiv = document.createElement('div');
    testDiv.className = 'score-circle';
    testDiv.style.cssText = '--score-percentage: 75%';
    testDiv.innerHTML = '<span id="test-value">75</span><span class="score-label">%</span>';
    document.body.appendChild(testDiv);
    
    const styles = window.getComputedStyle(testDiv);
    const hasSize = parseInt(styles.width) > 0 && parseInt(styles.height) > 0;
    const isCircle = styles.borderRadius === '50%';
    
    console.log('===== スタイル適用テスト =====');
    console.log(`サイズ: ${hasSize ? '✅' : '❌'} (${styles.width} × ${styles.height})`);
    console.log(`円形: ${isCircle ? '✅' : '❌'}`);
    console.log(`背景: ${styles.background.includes('conic') ? '✅ コニックグラデーション' : '❌'}`);
    
    // テスト要素を削除
    document.body.removeChild(testDiv);
})();
```

---

## 🧪 STEP 5: JavaScript関数テスト

```javascript
// テスト5-1: 関数定義確認
(() => {
    const functions = [
        'displaySynergyAnalysis',
        'displayGoldenPatternAnalysis',
        'displayConsistencyScore',
        'displayOSFlow',
        'displayOptimizationActions',
        'calculateTrigramCompatibility'
    ];
    
    console.log('===== 関数定義確認 =====');
    let allDefined = true;
    functions.forEach(func => {
        const isDefined = typeof window[func] === 'function';
        console.log(`${func}: ${isDefined ? '✅' : '❌'}`);
        if (!isDefined) allDefined = false;
    });
    
    console.log(`\n判定: ${allDefined ? '✅ 全関数定義済み' : '❌ 未定義の関数あり'}`);
})();
```

```javascript
// テスト5-2: 関数実行テスト（モックデータ）
(() => {
    if (typeof displaySynergyAnalysis !== 'function') {
        console.log('❌ displaySynergyAnalysis関数が未定義');
        return;
    }
    
    // モックデータ
    const mockOS = {
        name: 'テスト卦',
        upperTrigram: '乾',
        lowerTrigram: '坤',
        number: 1
    };
    
    try {
        console.log('===== 関数実行テスト =====');
        displaySynergyAnalysis(mockOS, mockOS, mockOS);
        console.log('✅ エラーなし');
        
        // 結果確認
        const value = document.getElementById('consistency-value');
        if (value && value.textContent !== '--') {
            console.log(`✅ スコア表示: ${value.textContent}%`);
        } else {
            console.log('⚠️ スコアが表示されていません');
        }
    } catch (error) {
        console.log('❌ エラー発生:', error.message);
    }
})();
```

---

## 🧪 STEP 6: タブ切り替えテスト

```javascript
// テスト6-1: タブクリック動作確認
(() => {
    console.log('===== タブ切り替えテスト =====');
    const tabs = ['basic', 'synergy', 'transparency', 'application'];
    
    tabs.forEach(tabName => {
        const button = document.querySelector(`[data-tab="${tabName}"]`);
        const content = document.getElementById(`${tabName}-content`);
        
        if (!button || !content) {
            console.log(`${tabName}: ❌ 要素不足`);
            return;
        }
        
        // クリック実行
        button.click();
        
        // 表示確認
        const isVisible = window.getComputedStyle(content).display !== 'none';
        const isActive = button.classList.contains('active');
        
        console.log(`${tabName}: ボタン${isActive ? '✅' : '❌'} コンテンツ${isVisible ? '✅' : '❌'}`);
    });
})();
```

```javascript
// テスト6-2: アクティブ状態の排他性確認
(() => {
    console.log('===== アクティブ状態テスト =====');
    
    // シナジータブをクリック
    const synergyButton = document.querySelector('[data-tab="synergy"]');
    if (synergyButton) synergyButton.click();
    
    // アクティブなボタンとコンテンツを確認
    const activeButtons = document.querySelectorAll('.tab-button.active');
    const visibleContents = Array.from(document.querySelectorAll('.tab-content'))
        .filter(el => window.getComputedStyle(el).display !== 'none');
    
    console.log(`アクティブボタン数: ${activeButtons.length} ${activeButtons.length === 1 ? '✅' : '❌'}`);
    console.log(`表示コンテンツ数: ${visibleContents.length} ${visibleContents.length === 1 ? '✅' : '❌'}`);
    
    if (activeButtons.length === 1 && visibleContents.length === 1) {
        console.log(`現在のタブ: ${activeButtons[0].dataset.tab}`);
        console.log(`表示中: ${visibleContents[0].id}`);
    }
})();
```

---

## 🧪 STEP 7: 統合動作テスト

```javascript
// テスト7-1: 完全動作シミュレーション
(() => {
    console.log('===== 統合動作テスト開始 =====\n');
    
    // モックデータで結果表示をシミュレート
    const mockEngineOS = {
        name: '乾為天',
        upperTrigram: '乾',
        lowerTrigram: '乾',
        number: 1
    };
    
    const mockInterfaceOS = {
        name: '兌為沢',
        upperTrigram: '兌',
        lowerTrigram: '兌',
        number: 58
    };
    
    const mockSafeModeOS = {
        name: '坤為地',
        upperTrigram: '坤',
        lowerTrigram: '坤',
        number: 2
    };
    
    try {
        // displayResults関数が存在する場合は実行
        if (typeof displayResults === 'function') {
            console.log('1. displayResults実行...');
            displayResults(mockEngineOS, mockInterfaceOS, mockSafeModeOS);
            console.log('   ✅ 成功');
        } else if (typeof displaySynergyAnalysis === 'function') {
            console.log('1. displaySynergyAnalysis直接実行...');
            displaySynergyAnalysis(mockEngineOS, mockInterfaceOS, mockSafeModeOS);
            console.log('   ✅ 成功');
        }
        
        // シナジータブに切り替え
        console.log('2. シナジータブへ切り替え...');
        const synergyTab = document.querySelector('[data-tab="synergy"]');
        if (synergyTab) {
            synergyTab.click();
            console.log('   ✅ 成功');
        }
        
        // 結果確認
        console.log('3. 表示内容確認...');
        const checks = {
            'パターン分析': document.querySelector('#golden-pattern-analysis .pattern-card'),
            '一貫性スコア': document.getElementById('consistency-value').textContent !== '--',
            'OSフロー': document.getElementById('engine-flow-name').textContent !== '--',
            'アクション': document.querySelectorAll('#optimization-actions .action-card').length > 0
        };
        
        Object.entries(checks).forEach(([name, result]) => {
            console.log(`   ${name}: ${result ? '✅' : '❌'}`);
        });
        
        const allPassed = Object.values(checks).every(v => v === true);
        console.log(`\n総合判定: ${allPassed ? '✅✅✅ 完璧！' : '❌ 要確認'}`);
        
    } catch (error) {
        console.log('❌ エラー発生:', error);
    }
})();
```

---

## 🔥 最終確認スクリプト

```javascript
// 全テストを一括実行
(() => {
    console.clear();
    console.log('🚀 OSアナライザー実装確認 - 全テスト実行\n');
    console.log('=' .repeat(50));
    
    const tests = {
        'タブ数': document.querySelectorAll('.tab-button').length === 4,
        'シナジータブ': document.querySelector('[data-tab="synergy"]') !== null,
        'シナジーコンテンツ': document.getElementById('synergy-content') !== null,
        '削除確認': document.getElementById('detail-content') === null,
        'JS関数': typeof displaySynergyAnalysis === 'function',
        'CSS適用': document.styleSheets.length > 0
    };
    
    let passCount = 0;
    Object.entries(tests).forEach(([name, result]) => {
        console.log(`${name}: ${result ? '✅ PASS' : '❌ FAIL'}`);
        if (result) passCount++;
    });
    
    console.log('=' .repeat(50));
    console.log(`結果: ${passCount}/${Object.keys(tests).length} テスト成功`);
    
    if (passCount === Object.keys(tests).length) {
        console.log('\n🎉🎉🎉 実装完了！おめでとうございます！ 🎉🎉🎉');
        console.log('30問の質問に回答して最終動作を確認してください。');
    } else {
        console.log('\n⚠️ 失敗したテストを確認して修正してください。');
    }
})();
```

---

**使用方法**:
1. 各STEPの実装後、対応するテストコードをコンソールで実行
2. ❌が出たら、その部分を修正
3. 全て✅になったら次のSTEPへ
4. 最後に「最終確認スクリプト」で全体確認