# HaQei Triple OS Analyzer デザイン復元修正計画書
作成日: 2025年8月17日

## 🔍 現在の問題

### 1. 画面が紫色一色になっている
- 元のデザインは白背景にカード型のUI
- 追加したCSSが元のスタイルを破壊している

### 2. ラジオボタンが表示されない
- 選択肢が見えない状態

### 3. 元のデザインと大きく異なる
- グラデーション背景（紫色）の美しいデザインが失われた
- カード型UIが消えた

## 📋 元のデザイン仕様（styles.css）

### 背景
- `body`に紫グラデーション: `linear-gradient(135deg, #667eea 0%, #764ba2 100%)`
- 各画面は白背景のカード型

### ウェルカム画面
- 白背景、角丸20px
- 青紫のタイトル（#6366f1）
- グラデーションボタン

### 質問画面
- 白背景、角丸20px
- プログレスバー付き
- ラジオボタン選択肢

## 🔧 修正計画

### Step 1: 追加したCSSを削除または修正

**ファイル**: `/Users/hideakimacbookair/Desktop/haqei-analyzer/public/os_analyzer.html`

**削除すべきCSS（103-245行目）**:
```html
<!-- UI/UX修正用スタイル -->
<style>
/* 削除：この部分のスタイルを全て削除 */
</style>
```

**代わりに以下を追加**:
```html
<style>
/* 画面切り替え用の最小限のスタイル */
.screen {
    display: none;
}

.screen.active {
    display: block;
}

/* スクリーンリーダー用 */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0,0,0,0);
    white-space: nowrap;
    border: 0;
}
</style>
```

### Step 2: HTMLの修正

**ファイル**: `/Users/hideakimacbookair/Desktop/haqei-analyzer/public/os_analyzer.html`

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaQei Triple OS Analyzer</title>
    <!-- 元のスタイルシートを読み込む -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- 必須スクリプト -->
    <script src="assets/H384H64database.js"></script>
    <!-- 以下略 -->
</head>
<body>
    <div id="app">
        <!-- ウェルカム画面 -->
        <section id="welcome-screen" class="screen welcome-screen active">
            <h1>HaQei Triple OS Analyzer</h1>
            <div class="welcome-content">
                <p>このシステムは、あなたの思考・行動パターンを3つのOS（オペレーティングシステム）として分析します。</p>
                <ul>
                    <li><strong>Engine OS</strong>: あなたの原動力となる思考パターン</li>
                    <li><strong>Interface OS</strong>: あなたの対人関係における特徴</li>
                    <li><strong>Safe Mode OS</strong>: あなたの安定性と受容性</li>
                </ul>
                <p>36の質問に答えることで、あなた独自のTriple OSプロファイルを生成します。</p>
            </div>
            <button id="start-btn">分析を開始</button>
        </section>
        
        <!-- 質問画面 -->
        <section id="question-screen" class="screen question-screen" style="display:none;">
            <div class="progress-container">
                <div class="progress-bar" id="progress-fill" style="width: 0%"></div>
                <div class="progress-text">
                    <span id="question-current">0</span> / <span id="question-total">36</span>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <span class="question-number" id="question-number">質問 1</span>
                    <span class="question-category" id="question-category">創造性</span>
                </div>
                <div class="question-text" id="question-text"></div>
                <div class="options-container" id="options-container">
                    <!-- 選択肢がここに動的に生成される -->
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button id="prev-btn">前へ</button>
                <button id="next-btn" disabled>次へ</button>
            </div>
        </section>
        
        <!-- 結果画面 -->
        <section id="results-screen" class="screen results-screen" style="display:none;">
            <h2>あなたのTriple OS分析結果</h2>
            <div id="os-cards-container"></div>
            <div id="summary-view"></div>
            <div id="hexagram-display"></div>
        </section>
        
        <!-- エラー画面 -->
        <section id="error-screen" class="screen error-screen" style="display:none;">
            <div class="error-container">
                <h2>エラーが発生しました</h2>
                <p id="error-message"></p>
                <button onclick="location.reload()">再試行</button>
            </div>
        </section>
    </div>
    
    <!-- アクセシビリティ用 -->
    <div id="aria-live-region" class="sr-only" aria-live="polite"></div>
    
    <!-- 最小限のスタイル追加 -->
    <style>
    .screen {
        display: none;
    }
    .screen.active {
        display: block;
    }
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0,0,0,0);
        white-space: nowrap;
        border: 0;
    }
    </style>
    
    <!-- スクリプト読み込み -->
    <script src="assets/js/questions-unified-complete.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="js/ScreenManager.js"></script>
    <script src="js/QuestionManager.js"></script>
    <script src="js/VirtualPersonaEnhancer.js"></script>
    <script src="js/os-analyzer-main.js"></script>
</body>
</html>
```

### Step 3: QuestionManager.jsの修正

**ファイル**: `/Users/hideakimacbookair/Desktop/haqei-analyzer/public/js/QuestionManager.js`

選択肢の表示を元のデザインに合わせる:
```javascript
displayQuestion(questionIndex) {
    const question = this.questions[questionIndex];
    
    // 質問テキスト
    const questionText = document.getElementById('question-text');
    if (questionText) {
        questionText.textContent = question.text;
    }
    
    // カテゴリ
    const categoryEl = document.getElementById('question-category');
    if (categoryEl) {
        categoryEl.textContent = question.category || '';
    }
    
    // 質問番号
    const numberEl = document.getElementById('question-number');
    if (numberEl) {
        numberEl.textContent = `質問 ${questionIndex + 1}`;
    }
    
    // 選択肢（ラジオボタン）
    const optionsContainer = document.getElementById('options-container');
    if (optionsContainer) {
        optionsContainer.innerHTML = '';
        
        question.options.forEach((option, index) => {
            const label = document.createElement('label');
            label.className = 'option-label';
            
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = `question-${questionIndex}`;
            radio.value = index;
            radio.id = `option-${index}`;
            
            const optionText = document.createElement('span');
            optionText.className = 'option-text';
            optionText.textContent = option.text;
            
            label.appendChild(radio);
            label.appendChild(optionText);
            optionsContainer.appendChild(label);
            
            // イベントリスナー
            radio.addEventListener('change', () => {
                // 次へボタンを有効化
                const nextBtn = document.getElementById('next-btn');
                if (nextBtn) nextBtn.disabled = false;
                
                // 選択状態の視覚的フィードバック
                document.querySelectorAll('.option-label').forEach(l => {
                    l.classList.remove('selected');
                });
                label.classList.add('selected');
            });
        });
    }
    
    // プログレスバー更新
    this.updateProgress(questionIndex);
}

updateProgress(questionIndex) {
    const progress = ((questionIndex + 1) / this.questions.length) * 100;
    const progressBar = document.getElementById('progress-fill');
    if (progressBar) {
        progressBar.style.width = `${progress}%`;
    }
    
    // テキスト更新
    const currentEl = document.getElementById('question-current');
    const totalEl = document.getElementById('question-total');
    if (currentEl) currentEl.textContent = questionIndex + 1;
    if (totalEl) totalEl.textContent = this.questions.length;
}
```

## 📊 期待される結果

| 項目 | 現状 | 修正後 |
|------|------|--------|
| 背景色 | 紫一色 | 紫グラデーション背景 + 白カード |
| ラジオボタン | 非表示 | 正常表示 |
| デザイン | 壊れている | 元の美しいデザイン |
| 画面遷移 | 不明 | スムーズに動作 |

## ⏱️ 実装時間

- HTML修正: 3分
- CSS削除と置き換え: 2分
- QuestionManager.js修正: 3分
- 動作確認: 2分

**合計: 約10分**

## ✅ 成功基準

1. 紫グラデーション背景が表示される
2. 各画面が白いカード型で表示される
3. ラジオボタンが正しく表示・動作する
4. 画面遷移がスムーズ
5. 元のデザインが完全復元される

---

この修正により、元の美しいデザインを保ちながら、機能的な問題も解決されます。