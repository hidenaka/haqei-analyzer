# ä¿®æ­£ç‰ˆè¨­è¨ˆæ›¸ - æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±åˆ

ä½œæˆæ—¥: 2025å¹´08æœˆ05æ—¥  
ä½œæˆè€…: HAQEI System Architect  
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: Future Simulator æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±åˆ  
ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 2.0

## 1. çµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 1.1 ä¿®æ­£å‰ï¼ˆç¾çŠ¶ï¼‰
```
future_simulator.html
    â†“
AuthenticIChingEngine.identifyCurrentSituation()
    â†“ ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°ã®ã¿ï¼‰
å›ºå®šãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
```

### 1.2 ä¿®æ­£å¾Œï¼ˆçµ±åˆï¼‰
```
future_simulator.html
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±åˆãƒ•ãƒ­ãƒ¼            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. SituationalContextEngine            â”‚
â”‚     â””â”€ analyzeSituationalContext()      â”‚
â”‚           â†“                             â”‚
â”‚  2. HexagramMappingEngine               â”‚
â”‚     â””â”€ mapSituationToHexagram()        â”‚
â”‚           â†“                             â”‚
â”‚  3. Authentic8ScenariosSystem           â”‚
â”‚     â””â”€ generate8TransformationPatterns()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
å‹•çš„çµæœè¡¨ç¤º
```

## 2. çµ±åˆå®Ÿè£…è¨­è¨ˆ

### 2.1 AuthenticIChingEngineä¿®æ­£
```javascript
class AuthenticIChingEngine {
  constructor() {
    // æ—¢å­˜ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
    this.h384Data = window.H384_DATA || [];
    
    // çµ±åˆç”¨ã‚¨ãƒ³ã‚¸ãƒ³ã®è¿½åŠ 
    this.situationalEngine = null;
    this.hexagramEngine = null;
  }

  // ä¿®æ­£ç‰ˆãƒ¡ã‚½ãƒƒãƒ‰
  async identifyCurrentSituation(inputText) {
    console.log("ğŸ”„ çµ±åˆç‰ˆç¾åœ¨çŠ¶æ³ç‰¹å®šé–‹å§‹");
    
    try {
      // 1. æ—¢å­˜ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆæœŸåŒ–ï¼ˆé…å»¶åˆæœŸåŒ–ï¼‰
      if (!this.situationalEngine) {
        this.situationalEngine = new SituationalContextEngine();
      }
      if (!this.hexagramEngine) {
        this.hexagramEngine = new HexagramMappingEngine();
        await this.hexagramEngine.initialize();
      }
      
      // 2. ãƒ†ã‚­ã‚¹ãƒˆåˆ†æï¼ˆæ—¢å­˜æ©Ÿèƒ½æ´»ç”¨ï¼‰
      const situationData = await this.situationalEngine.analyzeSituationalContext(inputText);
      console.log("ğŸ“Š çŠ¶æ³åˆ†æå®Œäº†:", situationData);
      
      // 3. æ˜“çµŒå¤‰æ›ï¼ˆæ—¢å­˜æ©Ÿèƒ½æ´»ç”¨ï¼‰
      const hexagramResult = await this.hexagramEngine.mapSituationToHexagram(situationData);
      console.log("ğŸ”® æ˜“çµŒå¤‰æ›å®Œäº†:", hexagramResult);
      
      // 4. çµ±åˆçµæœã®æ§‹ç¯‰
      return this.buildIntegratedResult(hexagramResult, situationData);
      
    } catch (error) {
      console.error("âŒ çµ±åˆå‡¦ç†ã‚¨ãƒ©ãƒ¼:", error);
      return this.getFallbackResult();
    }
  }

  buildIntegratedResult(hexagramResult, situationData) {
    return {
      å¦ç•ªå·: hexagramResult.primaryHexagram.id,
      å¦å: hexagramResult.primaryHexagram.name,
      çˆ»: hexagramResult.selectedLine.yao || 'åˆä¹',
      çˆ»ä½ç½®: hexagramResult.selectedLine.position || 1,
      ä¿¡é ¼åº¦: hexagramResult.confidence || 0.8,
      çŠ¶æ³åˆ†æ: situationData,
      æ˜“çµŒè§£é‡ˆ: hexagramResult.interpretation,
      å¤‰å¦: hexagramResult.changingHexagram
    };
  }
}
```

### 2.2 future_simulator.htmlä¿®æ­£
```javascript
class ProgressiveLoader {
  // æ—¢å­˜ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ãƒ¡ã‚½ãƒƒãƒ‰...

  async displayResults(inputText) {
    console.log('ğŸŒŸ çµ±åˆç‰ˆåˆ†æã‚·ã‚¹ãƒ†ãƒ é–‹å§‹');
    
    try {
      // 1. ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ï¼ˆå¿…è¦æ™‚ã®ã¿ï¼‰
      await this.initializeEngines();
      
      // 2. çµ±åˆåˆ†æå®Ÿè¡Œ
      const analysisResult = await this.performIntegratedAnalysis(inputText);
      
      // 3. è¡¨ç¤ºæ›´æ–°
      await this.updateAllDisplays(analysisResult);
      
      // 4. ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
      this.updateCharts(analysisResult);
      
      console.log('âœ… çµ±åˆåˆ†æå®Œäº†');
      
    } catch (error) {
      console.error('âŒ çµ±åˆåˆ†æã‚¨ãƒ©ãƒ¼:', error);
      this.displayFallbackResults(inputText);
    }
  }

  async initializeEngines() {
    // AuthenticIChingEngineã¯æ—¢å­˜ã®ã¾ã¾ä½¿ç”¨
    if (!this.authenticEngine) {
      this.authenticEngine = new AuthenticIChingEngine();
    }
    
    // 8ã‚·ãƒŠãƒªã‚ªã‚·ã‚¹ãƒ†ãƒ ã‚‚æ—¢å­˜åˆ©ç”¨
    if (!this.authentic8ScenariosSystem) {
      const container = document.getElementById('scenariosContainer') || this.createScenariosContainer();
      this.authentic8ScenariosSystem = new Authentic8ScenariosSystem(container, this.authenticEngine);
    }
  }

  async performIntegratedAnalysis(inputText) {
    // AuthenticIChingEngineã®ä¿®æ­£ç‰ˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—
    const currentSituation = await this.authenticEngine.identifyCurrentSituation(inputText);
    
    // 8ã‚·ãƒŠãƒªã‚ªç”Ÿæˆ
    const scenarios = this.authentic8ScenariosSystem.generate8TransformationPatterns(
      currentSituation.å¦ç•ªå·,
      currentSituation.çˆ»ä½ç½®,
      currentSituation
    );
    
    return {
      currentSituation,
      scenarios,
      choices: this.generateAuthenticChoices(currentSituation)
    };
  }

  async updateAllDisplays(analysisResult) {
    const { currentSituation, scenarios, choices } = analysisResult;
    
    // 1. ç¾åœ¨åœ°è¡¨ç¤º
    await this.updateCurrentPositionDisplay(currentSituation);
    
    // 2. é¸æŠè‚¢è¡¨ç¤º
    this.updateChoicesDisplay(choices);
    
    // 3. 8ã‚·ãƒŠãƒªã‚ªè¡¨ç¤º
    this.authentic8ScenariosSystem.displayScenarios(scenarios);
  }

  updateCurrentPositionDisplay(situation) {
    // æ—¢å­˜ã®CurrentPositionDisplayã‚’ä½¿ç”¨
    if (!this.currentPositionDisplay) {
      const container = document.getElementById('currentPositionContainer') || this.createCurrentPositionContainer();
      this.currentPositionDisplay = new CurrentPositionDisplay(container, this.authenticEngine);
    }
    
    this.currentPositionDisplay.updatePosition(situation);
  }

  updateChoicesDisplay(choices) {
    // æ—¢å­˜ã®DOMæ›´æ–°
    const choice1 = document.getElementById('choice1');
    const choice2 = document.getElementById('choice2');
    
    if (choice1 && choices.pathA) {
      choice1.querySelector('h3').textContent = choices.pathA.title;
      choice1.querySelector('p').textContent = choices.pathA.description;
    }
    
    if (choice2 && choices.pathB) {
      choice2.querySelector('h3').textContent = choices.pathB.title;
      choice2.querySelector('p').textContent = choices.pathB.description;
    }
  }

  updateCharts(analysisResult) {
    const { currentSituation } = analysisResult;
    
    // ãƒãƒ£ãƒ¼ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ
    const chartData = {
      å¦ç•ªå·: currentSituation.å¦ç•ªå·,
      å¦å: currentSituation.å¦å,
      çˆ»: currentSituation.çˆ»,
      åŸºæœ¬ã‚¹ã‚³ã‚¢: currentSituation.çŠ¶æ³åˆ†æ?.situationScore?.difficulty || 50,
      ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«: currentSituation.çŠ¶æ³åˆ†æ?.situationScore?.changeNecessity || 50,
      å®‰å®šæ€§: 100 - (currentSituation.çŠ¶æ³åˆ†æ?.situationScore?.urgency || 50),
      ãƒªã‚¹ã‚¯: -(currentSituation.çŠ¶æ³åˆ†æ?.situationScore?.complexity || 50),
      å¤‰å‹•æ€§: currentSituation.çŠ¶æ³åˆ†æ?.temporalDynamics?.changeVelocity || 50,
      ç·åˆè©•ä¾¡: Math.round(currentSituation.ä¿¡é ¼åº¦ * 100)
    };
    
    // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆé–¢æ•°ã‚’å‘¼ã³å‡ºã—
    if (typeof renderCurrentStateBarChart === 'function') {
      renderCurrentStateBarChart(chartData);
    }
  }
}
```

## 3. ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### 3.1 SituationalContextEngine â†’ HexagramMappingEngine
```javascript
// SituationalContextEngineã®å‡ºåŠ›
{
  primarySituation: {
    type: "challenge",
    intensity: 0.8,
    description: "..."
  },
  emotionalProfile: {
    valence: -0.3,
    arousal: 0.7,
    dominantEmotion: "anxiety"
  },
  temporalDynamics: {
    stage: "transition",
    changeVelocity: 0.6
  },
  contextualFactors: {...},
  confidence: 0.85
}

// HexagramMappingEngineãŒæœŸå¾…ã™ã‚‹å…¥åŠ›
// ï¼ˆæ—¢å­˜ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«æº–æ‹ ï¼‰
```

### 3.2 HexagramMappingEngine â†’ Authentic8ScenariosSystem
```javascript
// HexagramMappingEngineã®å‡ºåŠ›
{
  primaryHexagram: {
    id: 12,
    name: "å¦",
    upperTrigram: "å¤©",
    lowerTrigram: "åœ°"
  },
  selectedLine: {
    position: 3,
    yao: "ä¹ä¸‰",
    text: "åŒ…ç¾"
  },
  changingHexagram: {
    id: 33,
    name: "é¯"
  },
  confidence: 0.87
}
```

## 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 4.1 ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å¯¾å‡¦
```javascript
try {
  // çµ±åˆå‡¦ç†
} catch (error) {
  if (error.name === 'SituationalAnalysisError') {
    // åŸºæœ¬çš„ãªåˆ†æã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    return this.performBasicAnalysis(inputText);
  } else if (error.name === 'HexagramMappingError') {
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç¬¬12å¦ã‚’ä½¿ç”¨
    return this.getDefaultHexagramResult();
  } else {
    // å®Œå…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    return this.getFallbackResult();
  }
}
```

## 5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®

### 5.1 åˆæœŸåŒ–ã®æœ€é©åŒ–
- ã‚¨ãƒ³ã‚¸ãƒ³ã®é…å»¶åˆæœŸåŒ–
- å¿…è¦æ™‚ã®ã¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆ

### 5.2 éåŒæœŸå‡¦ç†
- Promise.allã«ã‚ˆã‚‹ä¸¦åˆ—å‡¦ç†æ¤œè¨
- ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç¶­æŒ

## 6. ãƒ†ã‚¹ãƒˆè¨ˆç”»

### 6.1 å˜ä½“ãƒ†ã‚¹ãƒˆ
- AuthenticIChingEngine.identifyCurrentSituation()ã®å‹•ä½œç¢ºèª
- å„ã‚¨ãƒ³ã‚¸ãƒ³é–“ã®ãƒ‡ãƒ¼ã‚¿å—ã‘æ¸¡ã—ç¢ºèª

### 6.2 çµ±åˆãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ•ãƒ­ãƒ¼ç¢ºèª
- æ§˜ã€…ãªå…¥åŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®æ¤œè¨¼

## 7. ç§»è¡Œãƒªã‚¹ã‚¯

### 7.1 å¾Œæ–¹äº’æ›æ€§
- æ—¢å­˜ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ç¶­æŒ
- æ®µéšçš„ãªç§»è¡Œã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### 7.2 ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
- ã‚¨ãƒ³ã‚¸ãƒ³é–“ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ç¢ºèª
- å¿…è¦ã«å¿œã˜ãŸã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼å®Ÿè£…

## 8. æ‰¿èª

æœ¬è¨­è¨ˆæ›¸ã¯ã€æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çµ±åˆã«ã‚ˆã‚‹å®Ÿè£…æ–¹é‡ã¨ã—ã¦æ‰¿èªã•ã‚Œã¾ã—ãŸã€‚

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: çµ±åˆå®Ÿè£…ã®é–‹å§‹