# 全JavaScript重複ファイル調査報告書

**作成日**: 2025年8月18日  
**調査範囲**: プロジェクト全体のJSファイル

## 🚨 発見された重複ファイル

### 1. app.js（3個）
```
./public/js/app.js                    ← 未使用？
./public/quick-analyzer/js/app.js     ← quick-analyzer専用
./public/assets/js/app.js             ← os_analyzer.htmlで使用中
```

**HTMLでの使用状況**:
- `os_analyzer.html`: **assets/js/app.js**を使用
- `quick-analyzer/quick_analyzer.html`: **js/app.js**を使用

### 2. PerformanceOptimizer.js（2個）
```
./public/js/core/PerformanceOptimizer.js
./public/js/PerformanceOptimizer.js
```

### 3. I-Ching関連ファイル（各2個）
```
MultiLineInterpreter.js:
  ./public/js/MultiLineInterpreter.js
  ./public/js/iching/MultiLineInterpreter.js   ← 正式版？

LineSelector.js:
  ./public/js/LineSelector.js
  ./public/js/iching/LineSelector.js           ← 正式版？

KingWenMapping.js:
  ./public/js/KingWenMapping.js
  ./public/js/iching/KingWenMapping.js         ← 正式版？

AdvanceProcessor.js:
  ./public/js/AdvanceProcessor.js
  ./public/js/iching/AdvanceProcessor.js       ← 正式版？
```

### 4. phase-description.test.js（2個）
```
場所不明（詳細調査必要）
```

### 5. chart.min.js（2個）
```
場所不明（詳細調査必要）
```

## 📊 影響分析

### 問題1: app.jsの混乱
- **3つの異なるapp.js**が存在
- os_analyzer.htmlは`assets/js/app.js`を使用
- しかし`public/js/app.js`も存在（未使用？）

### 問題2: I-Ching関連の重複
- すべてのI-Ching関連ファイルが2つずつ存在
- `/js/`直下と`/js/iching/`配下に重複
- どちらが正式版か不明

### 問題3: PerformanceOptimizerの重複
- coreフォルダとjsフォルダ直下に同じファイル
- 初期化時に競合の可能性

## 🎯 削除推奨リスト

### 優先度：高（安全に削除可能）
```bash
# I-Ching関連の重複（js直下を削除、ichingフォルダを正式版とする）
rm public/js/MultiLineInterpreter.js
rm public/js/LineSelector.js
rm public/js/KingWenMapping.js
rm public/js/AdvanceProcessor.js

# PerformanceOptimizerの重複（coreを正式版とする）
rm public/js/PerformanceOptimizer.js
```

### 優先度：中（確認後削除）
```bash
# 未使用のapp.js（assets/js/app.jsが正式版）
rm public/js/app.js  # ← HTMLで使われていない
```

### 優先度：低（保留）
- `public/quick-analyzer/js/app.js` - quick-analyzer専用なので保持
- `public/assets/js/app.js` - os_analyzer.htmlで使用中なので保持

## 📈 node_modules除外の重複数

プロジェクト固有のファイルのみを考慮すると：

| ファイル名 | 重複数 | 状態 |
|-----------|--------|------|
| app.js | 3個 | 要整理 |
| PerformanceOptimizer.js | 2個 | 要削除1個 |
| MultiLineInterpreter.js | 2個 | 要削除1個 |
| LineSelector.js | 2個 | 要削除1個 |
| KingWenMapping.js | 2個 | 要削除1個 |
| AdvanceProcessor.js | 2個 | 要削除1個 |

## 🔧 推奨アクション

### STEP 1: I-Ching関連の整理
```bash
# ichingフォルダを正式版として、js直下の重複を削除
rm public/js/MultiLineInterpreter.js
rm public/js/LineSelector.js
rm public/js/KingWenMapping.js
rm public/js/AdvanceProcessor.js
```

### STEP 2: PerformanceOptimizerの整理
```bash
# coreを正式版として、js直下を削除
rm public/js/PerformanceOptimizer.js
```

### STEP 3: app.jsの確認と整理
```bash
# 未使用のapp.jsを削除
rm public/js/app.js
```

### STEP 4: HTMLファイルの参照確認
```bash
# どのJSファイルが実際に使われているか確認
grep -r "<script" public/*.html | grep -v "//" | sort
```

## 📝 ディレクトリ構造の推奨

```
public/
  assets/js/
    app.js              # os_analyzer用メインファイル
    
  js/
    QuestionManager.js  # 単一インスタンス（整理済み）
    ScreenManager.js    # 単一インスタンス（整理済み）
    
    core/
      PerformanceOptimizer.js  # 正式版
      
    iching/
      MultiLineInterpreter.js  # 正式版
      LineSelector.js          # 正式版
      KingWenMapping.js        # 正式版
      AdvanceProcessor.js      # 正式版
      
  quick-analyzer/
    js/
      app.js            # quick-analyzer専用（保持）
```

## 結論

**主要な重複ファイル6種類**が発見されました：
1. app.js - 3個（1個削除推奨）
2. I-Ching関連4ファイル - 各2個（各1個削除推奨）
3. PerformanceOptimizer - 2個（1個削除推奨）

これらを整理することで、どのファイルが使われているか明確になり、初期化エラーや競合が解消されます。