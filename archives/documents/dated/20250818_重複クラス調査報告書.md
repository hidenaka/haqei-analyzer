# 重複クラス調査報告書

**作成日**: 2025年8月18日  
**調査実施**: 不要ファイル削除後の状態

## 📊 調査結果サマリー

### 削除実行済み
- ✅ バックアップ作成完了 (backup_20250818.tar.gz - 6.3MB)
- ✅ dist/ フォルダ削除
- ✅ archives/cleanup-20250807/ 削除
- ✅ test/archive/ 削除  
- ✅ js/ フォルダ（publicの外）削除
- ✅ public/js/core/QuestionManager.js 削除
- ✅ public/js/ui/QuestionManager.js 削除

### 重複クラスの発見
**合計6種類のクラスが重複**している：

## 🚨 重複クラス詳細

### 1. ScreenManager（2個）
```
public/js/ScreenManager.js          ← HTMLで読み込み中（正式版）
public/js/core/ScreenManager.js     ← 重複（削除候補）
```

### 2. StorageManager（2個）
```
public/js/shared/core/StorageManager.js    ← 未使用？
public/quick-analyzer/js/core/StorageManager.js  ← quick-analyzer専用
```

### 3. EmergencyState & EmergencyQuestionFlow（各2個）
```
public/emergency-bypass.js          ← ルート直下
public/js/emergency-bypass.js       ← js配下に重複
```

### 4. FutureBranchingSystem（2個）
```
public/js/core/FutureBranchingSystem.js
（別の場所にも存在の可能性）
```

### 5. PerformanceOptimizer（2個）
```
public/js/core/PerformanceOptimizer.js
（別の場所にも存在の可能性）
```

## 📈 問題の影響

### なぜQ.1だけラジオボタンになっていたか
1. **QuestionManager.jsは整理完了**
   - 現在は`public/js/QuestionManager.js`のみ
   - しかし、他のクラスの重複が影響している可能性

2. **ScreenManagerの競合**
   - 2つのScreenManagerが存在
   - 画面切り替え時に異なる処理が走る可能性

3. **初期化順序の問題**
   - 複数のクラスが競合して初期化される
   - Q.1だけ特別な処理パスを通っている

## 🔍 HTMLファイルでの読み込み状況

### os_analyzer.html で読み込まれているファイル
```html
<script src="js/ScreenManager.js"></script>    ← OK
<script src="js/QuestionManager.js"></script>  ← OK（整理済み）
```

### 問題のあるファイル構造
```
public/
├── emergency-bypass.js          ← ルート直下（異常）
├── js/
│   ├── emergency-bypass.js      ← 重複
│   ├── ScreenManager.js         ← 正式版
│   ├── QuestionManager.js       ← 正式版（整理済み）
│   └── core/
│       └── ScreenManager.js     ← 重複（削除候補）
```

## 🎯 推奨アクション

### STEP 1: 重複ファイルの削除
```bash
# ScreenManagerの重複削除
rm public/js/core/ScreenManager.js

# emergency-bypassの重複削除（ルート直下を削除）
rm public/emergency-bypass.js

# 未使用のStorageManager削除
rm -rf public/js/shared/  # shared全体が未使用なら
```

### STEP 2: クラス名の統一確認
```bash
# 各クラスが1つだけになったか確認
find public -name "*.js" -exec grep -l "class ScreenManager" {} \;
# 結果が1つだけならOK
```

### STEP 3: import/export の整理
多くのファイルがグローバル変数として定義されているが、適切なモジュール化が必要。

## 📝 根本原因の分析

### なぜこうなったか
1. **開発中の試行錯誤**
   - 異なる場所に同じファイルを作成
   - バージョン管理の不備

2. **ディレクトリ構造の不統一**
   - `/js/core/`
   - `/js/ui/`
   - `/js/shared/core/`
   - 等、複数の構造が混在

3. **ビルドプロセスの不在**
   - distフォルダがあったが、ビルドプロセスが不明
   - 手動でファイルをコピーしていた可能性

## ✅ 解決後の理想的な構造

```
public/
  js/
    # メインファイル（これだけ使用）
    QuestionManager.js
    ScreenManager.js
    os-analyzer-main.js
    
    # コアモジュール（必要なもののみ）
    core/
      必要な単一機能モジュール
    
    # その他は全て削除または統合
```

## 🚀 次のステップ

1. **重複クラスの削除実行**
2. **動作確認**
3. **Q.2以降のラジオボタン表示確認**
4. **不要なディレクトリの整理**

## 結論

**重複ファイルが原因で処理が混乱していた**ことが判明。特に：
- QuestionManager: 9個 → 1個に整理済み
- ScreenManager: 2個（要削除1個）
- その他: 4種類のクラスが重複

これらを整理することで、Q.2以降のラジオボタン問題も解決する可能性が高い。