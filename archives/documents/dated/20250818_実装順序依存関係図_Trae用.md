# 実装順序と依存関係 - 絶対厳守マニュアル

**作成日**: 2025年8月18日  
**重要度**: 🔴 最重要 - この順序を守らないと動作しません

## 🚫 絶対にやってはいけないこと

### ❌ 順序違反の例（これらは失敗します）
1. ❌ JavaScriptを先に追加してからHTML要素を追加 → エラー
2. ❌ CSSを追加せずに動作確認 → 表示崩れ
3. ❌ タブ削除前にシナジータブ追加 → ID競合
4. ❌ バックアップを取らずに開始 → 復旧不可能
5. ❌ 検証せずに次のステップへ → 連鎖エラー

---

## ✅ 正しい実装順序（必ず守る）

```
┌─────────────────────────────────────┐
│  STEP 0: バックアップ作成           │ ← 最初に必ず実行
└────────────┬────────────────────────┘
             ↓
┌─────────────────────────────────────┐
│  STEP 1: タブボタン構造の変更       │ ← HTMLの骨組み
└────────────┬────────────────────────┘
             ↓
┌─────────────────────────────────────┐
│  STEP 2: シナジータブHTML追加       │ ← 新規コンテンツ
└────────────┬────────────────────────┘
             ↓
┌─────────────────────────────────────┐
│  STEP 3: 不要タブ削除               │ ← 古いコンテンツ削除
└────────────┬────────────────────────┘
             ↓
┌─────────────────────────────────────┐
│  STEP 4: CSS追加                    │ ← 見た目の定義
└────────────┬────────────────────────┘
             ↓
┌─────────────────────────────────────┐
│  STEP 5: JavaScript関数追加         │ ← 動作の定義
└────────────┬────────────────────────┘
             ↓
┌─────────────────────────────────────┐
│  STEP 6: タブ切り替え修正           │ ← 連携処理
└────────────┬────────────────────────┘
             ↓
┌─────────────────────────────────────┐
│  STEP 7: 動作確認                   │ ← 最終チェック
└─────────────────────────────────────┘
```

---

## 🔗 各ステップの依存関係

### STEP 0 → 全ステップの前提条件
```
バックアップなし = リスク100%
必須ファイル:
- os_analyzer.html
- os-analyzer-main.js  
- os-analyzer.css
```

### STEP 1 → STEP 2,3の前提条件
```
タブボタン構造が正しくないと:
- STEP 2: シナジータブが表示されない
- STEP 3: 削除対象が特定できない
```

### STEP 2 → STEP 5の前提条件
```
HTML要素が存在しないと:
- STEP 5: JavaScriptがエラーになる
  └─ document.getElementById('synergy-content') → null
  └─ Cannot read properties of null エラー
```

### STEP 3 → STEP 6の前提条件
```
古いタブが残っていると:
- STEP 6: タブ切り替えで存在しないコンテンツを参照
  └─ タブクリック → 何も表示されない
```

### STEP 4 → STEP 7の前提条件
```
CSSがないと:
- STEP 7: 表示が崩れて確認できない
  └─ スコアサークルが四角になる
  └─ レイアウトが縦に伸びる
```

### STEP 5 → STEP 7の前提条件
```
JavaScript関数がないと:
- STEP 7: シナジー分析が空白
  └─ displaySynergyAnalysis is not defined エラー
```

---

## 📊 依存関係マトリクス

| 実行STEP | 依存するSTEP | 依存される側 | 必須度 |
|---------|------------|-----------|-------|
| STEP 0 | なし | 全STEP | 🔴必須 |
| STEP 1 | STEP 0 | STEP 2,3,6 | 🔴必須 |
| STEP 2 | STEP 0,1 | STEP 5,7 | 🔴必須 |
| STEP 3 | STEP 0,1 | STEP 6,7 | 🔴必須 |
| STEP 4 | STEP 0 | STEP 7 | 🟡重要 |
| STEP 5 | STEP 0,2 | STEP 7 | 🔴必須 |
| STEP 6 | STEP 0,1,3 | STEP 7 | 🔴必須 |
| STEP 7 | 全STEP | なし | 🔴必須 |

---

## ⚠️ よくある実装ミスと結果

### ミス1: STEP 2を飛ばしてSTEP 5実行
```javascript
// エラー発生
Uncaught TypeError: Cannot read properties of null (reading 'innerHTML')
at displayGoldenPatternAnalysis (os-analyzer-main.js:XXXX)

// 原因: document.getElementById('golden-pattern-analysis') が null
// 対処: STEP 2を実行してHTML要素を追加
```

### ミス2: STEP 1を間違えてSTEP 6実行
```javascript
// 症状: シナジータブをクリックしても反応しない
// 原因: data-tab="synergy" のボタンが存在しない
// 対処: STEP 1を正しく実行
```

### ミス3: STEP 3を忘れて完了
```javascript
// 症状: 存在しないタブが表示される
// 原因: 詳細層、専門層、統合層が残っている
// 対処: STEP 3で確実に削除
```

---

## 🔍 各ステップの所要時間目安

| STEP | 作業内容 | 所要時間 | 難易度 |
|------|---------|---------|--------|
| 0 | バックアップ | 2分 | ⭐ |
| 1 | タブ構造変更 | 5分 | ⭐⭐ |
| 2 | HTML追加 | 10分 | ⭐⭐⭐ |
| 3 | タブ削除 | 5分 | ⭐⭐ |
| 4 | CSS追加 | 5分 | ⭐ |
| 5 | JS追加 | 15分 | ⭐⭐⭐⭐ |
| 6 | タブ修正 | 5分 | ⭐⭐ |
| 7 | 動作確認 | 10分 | ⭐⭐ |
| **合計** | | **約60分** | |

---

## 📝 チェックポイント記録表

実装時に以下を記録してください：

```
□ STEP 0 完了時刻: ____:____ バックアップ場所: ________________
□ STEP 1 完了時刻: ____:____ タブ数確認: 4個 OK・NG
□ STEP 2 完了時刻: ____:____ synergy-content確認: OK・NG
□ STEP 3 完了時刻: ____:____ 削除確認: OK・NG
□ STEP 4 完了時刻: ____:____ CSS適用確認: OK・NG
□ STEP 5 完了時刻: ____:____ 関数定義確認: OK・NG
□ STEP 6 完了時刻: ____:____ タブ切替確認: OK・NG
□ STEP 7 完了時刻: ____:____ 全機能確認: OK・NG

問題発生STEP: ________
エラー内容: _______________________
```

---

## 🚨 緊急時の復旧手順

### 完全に壊れた場合
```bash
# バックアップから復旧
cp backup_20250818/os_analyzer.html.bak public/os_analyzer.html
cp backup_20250818/os-analyzer-main.js.bak public/js/os-analyzer-main.js
cp backup_20250818/os-analyzer.css.bak public/css/os-analyzer.css

# サーバー再起動
npm run dev
```

### 部分的に壊れた場合
```bash
# 特定ファイルのみ復旧
cp backup_20250818/os_analyzer.html.bak public/os_analyzer.html

# 変更を確認
git diff public/os_analyzer.html
```

---

## 🎯 成功の基準

### 全ステップ成功の条件
1. ✅ エラーが一つも出ない
2. ✅ 4つのタブが正しく表示される
3. ✅ シナジー分析に数値が表示される
4. ✅ CSSが正しく適用されている
5. ✅ 30問回答後に結果が表示される

### 失敗の兆候
1. ❌ コンソールに赤いエラー
2. ❌ タブクリックで何も起きない
3. ❌ 表示が大きく崩れている
4. ❌ 数値が「--」のまま
5. ❌ 白い画面になる

---

**最重要**: この順序を必ず守ってください。スキップや順序変更は失敗の原因です。