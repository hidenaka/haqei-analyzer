# HaQei Triple OS Analyzer 緊急修正手順書
作成日: 2025年8月17日

## 🚨 現在の問題

### 確認結果:
- **ラジオボタン**: 0個（全く表示されていない）
- **画面表示**: question-screenがactiveなのに`display: none`で見えない
- **背景**: 紫グラデーションのまま（古いstyles.cssが適用されている可能性）

## 🔧 緊急修正手順

### Step 1: CSSファイルの確認と修正

**ファイル**: `/Users/hideakimacbookair/Desktop/haqei-analyzer/public/styles-modern.css`

既に作成済みですが、以下を確認：

```css
/* 重要：画面表示の修正 */
.screen {
    display: none;
}

.screen.active {
    display: block !important; /* !importantを追加 */
}
```

### Step 2: HTMLの修正

**ファイル**: `/Users/hideakimacbookair/Desktop/haqei-analyzer/public/os_analyzer.html`

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaQei Triple OS Analyzer</title>
    <!-- モダンCSSを確実に読み込む -->
    <link rel="stylesheet" href="styles-modern.css">
    
    <!-- インラインスタイルで確実に適用 -->
    <style>
        /* 画面切り替えの最小限のスタイル */
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block !important;
        }
        
        /* bodyの古い紫背景を上書き */
        body {
            background: linear-gradient(180deg, #fafafa 0%, #f4f4f5 100%) !important;
        }
    </style>
    
    <!-- 以下既存のスクリプト -->
</head>
```

### Step 3: QuestionManager.jsの修正

**ファイル**: `/Users/hideakimacbookair/Desktop/haqei-analyzer/public/js/QuestionManager.js`

`displayQuestion`メソッドを修正してラジオボタンを生成：

```javascript
displayQuestion(questionIndex) {
    console.log('📝 Displaying question:', questionIndex);
    
    const question = this.questions[questionIndex];
    if (!question) {
        console.error('Question not found:', questionIndex);
        return;
    }
    
    // 質問テキストを表示
    const questionText = document.getElementById('question-text');
    if (questionText) {
        questionText.textContent = question.text;
    }
    
    // 質問番号を表示
    const questionNumber = document.getElementById('question-number');
    if (questionNumber) {
        questionNumber.textContent = `質問 ${questionIndex + 1}/36`;
    }
    
    // オプションコンテナをクリア
    const optionsContainer = document.getElementById('options-container');
    if (!optionsContainer) {
        console.error('Options container not found');
        return;
    }
    
    optionsContainer.innerHTML = '';
    
    // 選択肢を生成（ラジオボタン付き）
    if (question.options && Array.isArray(question.options)) {
        question.options.forEach((option, index) => {
            // ラベル要素を作成
            const label = document.createElement('label');
            label.className = 'option-label';
            label.style.cursor = 'pointer';
            
            // ラジオボタンを作成
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = `question-${questionIndex}`;
            radio.value = index;
            radio.id = `option-${questionIndex}-${index}`;
            
            // オプションテキスト
            const optionText = document.createElement('span');
            optionText.className = 'option-text';
            optionText.textContent = option.text || option;
            
            // ラベルに追加
            label.appendChild(radio);
            label.appendChild(optionText);
            
            // コンテナに追加
            optionsContainer.appendChild(label);
            
            // イベントリスナー
            radio.addEventListener('change', () => {
                console.log('✅ Option selected:', index);
                
                // 次へボタンを有効化
                const nextBtn = document.getElementById('next-btn');
                if (nextBtn) {
                    nextBtn.disabled = false;
                    nextBtn.style.opacity = '1';
                    nextBtn.style.cursor = 'pointer';
                }
                
                // 選択状態のスタイル更新
                document.querySelectorAll('.option-label').forEach(l => {
                    l.classList.remove('selected');
                });
                label.classList.add('selected');
                
                // 回答を保存
                this.saveAnswer(questionIndex, index);
            });
        });
        
        console.log(`✅ Created ${question.options.length} radio buttons`);
    } else {
        console.error('No options found for question:', question);
    }
    
    // プログレスバー更新
    this.updateProgress(questionIndex);
}
```

### Step 4: ScreenManager.jsの修正

**ファイル**: `/Users/hideakimacbookair/Desktop/haqei-analyzer/public/js/ScreenManager.js`

画面切り替えを確実に動作させる：

```javascript
switchTo(screenName) {
    console.log(`🔄 Switching to screen: ${screenName}`);
    
    // すべての画面を非表示
    const allScreens = document.querySelectorAll('.screen');
    allScreens.forEach(screen => {
        screen.classList.remove('active');
        screen.style.display = 'none'; // 明示的に設定
    });
    
    // 対象画面を表示
    let targetScreen = document.getElementById(`${screenName}-screen`);
    if (!targetScreen) {
        targetScreen = document.getElementById(screenName);
    }
    if (!targetScreen) {
        targetScreen = document.querySelector(`.${screenName}-screen`);
    }
    
    if (targetScreen) {
        targetScreen.classList.add('active');
        targetScreen.style.display = 'block'; // 明示的に設定
        targetScreen.style.opacity = '1'; // 確実に表示
        
        this.currentScreen = screenName;
        console.log(`✅ Switched to screen: ${screenName}`);
        
        // 質問画面の場合、最初の質問を表示
        if (screenName === 'question' && window.questionManager) {
            window.questionManager.displayQuestion(0);
        }
    } else {
        console.error(`❌ Screen not found: ${screenName}`);
    }
}
```

## 📊 確認項目

### ブラウザコンソールで実行:
```javascript
// 1. ラジオボタンの確認
console.log('Radio buttons:', document.querySelectorAll('input[type="radio"]').length);

// 2. 画面の状態確認
document.querySelectorAll('.screen').forEach(s => {
    console.log(s.id, {
        display: window.getComputedStyle(s).display,
        active: s.classList.contains('active')
    });
});

// 3. 手動で質問画面を表示
document.getElementById('welcome-screen').style.display = 'none';
document.getElementById('question-screen').style.display = 'block';

// 4. 手動で質問を表示
if (window.questionManager) {
    window.questionManager.displayQuestion(0);
}
```

## ⏱️ 実装時間

- CSS修正: 2分
- HTML修正: 2分  
- QuestionManager.js修正: 3分
- ScreenManager.js修正: 2分
- 動作確認: 3分

**合計: 約12分**

## ✅ 成功基準

1. ウェルカム画面が白いカードで表示される
2. 「分析を開始」ボタンで質問画面に遷移する
3. **ラジオボタンが5個表示される**
4. ラジオボタンを選択すると「次へ」ボタンが有効になる
5. 背景が明るいグレーグラデーション

---

**重要**: この修正により、ラジオボタンが表示され、画面遷移が正常に動作するようになります。