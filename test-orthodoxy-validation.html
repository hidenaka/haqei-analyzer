<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI Analyzer - æ˜“çµŒæ­£çµ±æ€§æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            border-bottom: 3px solid #2c3e50;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2c3e50;
            margin: 0;
            font-size: 2.5em;
        }
        .header h2 {
            color: #7f8c8d;
            margin: 5px 0;
            font-size: 1.2em;
            font-weight: normal;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: transform 0.2s;
        }
        .test-button:hover {
            transform: translateY(-2px);
        }
        .test-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        .results {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .score-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            margin: 5px;
        }
        .score-excellent { background-color: #27ae60; }
        .score-good { background-color: #3498db; }
        .score-needs-improvement { background-color: #f39c12; }
        .score-needs-fix { background-color: #e74c3c; }
        .issue-item {
            background: #fff;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .recommendation {
            background: #e8f5e8;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 10px;
            transition: width 0.3s ease;
            width: 0%;
        }
        .domain-score {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .domain-item {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .domain-item .label {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        .domain-item .value {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¯ æ˜“çµŒæ­£çµ±æ€§æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </h1>
            <h2>HAQEI Analyzer - Classical I-Ching Orthodoxy Validation</h2>
            <p>å¤å…¸æ˜“çµŒã®æ­£çµ±æ€§åŸºæº–ã«åŸºã¥ãå®Ÿè£…å“è³ªã®å³å¯†ãªæ¤œè¨¼</p>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª æ¤œè¨¼ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h3>
            <p>ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€å„æ¤œè¨¼è¦ç´ ã‚’å€‹åˆ¥ã«ãƒ†ã‚¹ãƒˆã™ã‚‹ã‹ã€åŒ…æ‹¬çš„ãªæ¤œè¨¼ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>
            
            <button class="test-button" onclick="runTrigramValidation()">
                ğŸ”¸ å…«å¦ç›¸äº’é–¢ä¿‚æ€§æ¤œè¨¼
            </button>
            
            <button class="test-button" onclick="runHexagramValidation()">
                ğŸ”¹ 64å¦é™°é™½ãƒãƒ©ãƒ³ã‚¹æ¤œè¨¼
            </button>
            
            <button class="test-button" onclick="runUltraSyncValidation()">
                âš¡ ã‚¦ãƒ«ãƒˆãƒ©ã‚·ãƒ³ã‚¯ãƒ­ã‚¸ãƒƒã‚¯20æ¤œè¨¼
            </button>
            
            <button class="test-button" onclick="runBunenjinValidation()">
                ğŸŒŠ bunenjinå“²å­¦æ•´åˆæ€§æ¤œè¨¼
            </button>
            
            <button class="test-button" onclick="runLineValidation()">
                ğŸ“ çˆ»è¾ãƒ¬ãƒ™ãƒ«é©ç”¨æ¤œè¨¼
            </button>
            
            <br><br>
            
            <button class="test-button" onclick="runComprehensiveValidation()" style="background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%); font-size: 18px; padding: 20px 40px;">
                ğŸ”¯ åŒ…æ‹¬çš„æ¤œè¨¼å®Ÿè¡Œ
            </button>
            
            <button class="test-button" onclick="generateDetailedReport()">
                ğŸ“Š è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
            </button>
        </div>

        <div id="results" class="results" style="display: none;">
            <!-- æ¤œè¨¼çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
    </div>

    <!-- å¿…è¦ãªJSãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ -->
    <script src="./public/js/os-analyzer/validation/ClassicalIChingStandards.js"></script>
    <script src="./public/js/os-analyzer/validation/IChingOrthodoxyValidator.js"></script>
    <script src="./public/js/os-analyzer/validation/OrthodoxyReportGenerator.js"></script>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let validator = null;
        let reportGenerator = null;
        let currentValidationResults = null;

        // åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', function() {
            initializeValidationSystem();
        });

        function initializeValidationSystem() {
            try {
                validator = new IChingOrthodoxyValidator();
                reportGenerator = new OrthodoxyReportGenerator();
                console.log("âœ… æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ");
            } catch (error) {
                console.error("âŒ æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—:", error);
                showError("æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚");
            }
        }

        // ========== å€‹åˆ¥æ¤œè¨¼é–¢æ•° ==========

        async function runTrigramValidation() {
            showLoading("å…«å¦ç›¸äº’é–¢ä¿‚æ€§ã‚’æ¤œè¨¼ä¸­...");
            
            try {
                // ç¾åœ¨ã®å®Ÿè£…ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const implementationData = await getCurrentImplementationData();
                
                // å…«å¦é–¢ä¿‚æ€§ã®ã¿ã‚’æ¤œè¨¼
                const trigramResults = await validator.validateTrigramRelationships();
                
                showTrigramResults(trigramResults);
                
            } catch (error) {
                console.error("å…«å¦æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:", error);
                showError("å…«å¦ç›¸äº’é–¢ä¿‚æ€§ã®æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
            }
        }

        async function runHexagramValidation() {
            showLoading("64å¦é™°é™½ãƒãƒ©ãƒ³ã‚¹ã‚’æ¤œè¨¼ä¸­...");
            
            try {
                const implementationData = await getCurrentImplementationData();
                const hexagramResults = await validator.validateHexagramYinYangBalance();
                
                showHexagramResults(hexagramResults);
                
            } catch (error) {
                console.error("64å¦æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:", error);
                showError("64å¦é™°é™½ãƒãƒ©ãƒ³ã‚¹ã®æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
            }
        }

        async function runUltraSyncValidation() {
            showLoading("ã‚¦ãƒ«ãƒˆãƒ©ã‚·ãƒ³ã‚¯ãƒ­ã‚¸ãƒƒã‚¯20ã‚’æ¤œè¨¼ä¸­...");
            
            try {
                const implementationData = await getCurrentImplementationData();
                const ultraSyncResults = await validator.validateUltraSyncLogicOrthodoxyWith20();
                
                showUltraSyncResults(ultraSyncResults);
                
            } catch (error) {
                console.error("ã‚¦ãƒ«ãƒˆãƒ©ã‚·ãƒ³ã‚¯æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:", error);
                showError("ã‚¦ãƒ«ãƒˆãƒ©ã‚·ãƒ³ã‚¯ãƒ­ã‚¸ãƒƒã‚¯20ã®æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
            }
        }

        async function runBunenjinValidation() {
            showLoading("bunenjinå“²å­¦æ•´åˆæ€§ã‚’æ¤œè¨¼ä¸­...");
            
            try {
                const implementationData = await getCurrentImplementationData();
                const bunenjinResults = await validator.validateBunenjinPhilosophyAlignment();
                
                showBunenjinResults(bunenjinResults);
                
            } catch (error) {
                console.error("bunenjinæ¤œè¨¼ã‚¨ãƒ©ãƒ¼:", error);
                showError("bunenjinå“²å­¦æ•´åˆæ€§ã®æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
            }
        }

        async function runLineValidation() {
            showLoading("çˆ»è¾ãƒ¬ãƒ™ãƒ«é©ç”¨ã‚’æ¤œè¨¼ä¸­...");
            
            try {
                const implementationData = await getCurrentImplementationData();
                const lineResults = await validator.validateLineApplicationAccuracy();
                
                showLineResults(lineResults);
                
            } catch (error) {
                console.error("çˆ»è¾æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:", error);
                showError("çˆ»è¾ãƒ¬ãƒ™ãƒ«é©ç”¨ã®æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
            }
        }

        // ========== åŒ…æ‹¬çš„æ¤œè¨¼ ==========

        async function runComprehensiveValidation() {
            showLoading("åŒ…æ‹¬çš„æ¤œè¨¼ã‚’å®Ÿè¡Œä¸­...", true);
            
            try {
                // ç¾åœ¨ã®å®Ÿè£…ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
                const implementationData = await getCurrentImplementationData();
                
                // é€²æ—è¡¨ç¤ºä»˜ãã§åŒ…æ‹¬çš„æ¤œè¨¼ã‚’å®Ÿè¡Œ
                const validationResults = await validator.validateImplementation(implementationData);
                
                currentValidationResults = validationResults;
                
                showComprehensiveResults(validationResults);
                
            } catch (error) {
                console.error("åŒ…æ‹¬çš„æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:", error);
                showError("åŒ…æ‹¬çš„æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
            }
        }

        // ========== å®Ÿè£…ãƒ‡ãƒ¼ã‚¿åé›† ==========

        async function getCurrentImplementationData() {
            // å®Ÿéš›ã®å®Ÿè£…ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
            // ã“ã®ãƒ†ã‚¹ãƒˆç‰ˆã§ã¯æ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
            
            return {
                trigramRelationships: await collectTrigramRelationshipData(),
                hexagramData: await collectHexagramData(),
                ultraSyncLogic: await collectUltraSyncLogicData(),
                tripleOSStructure: await collectTripleOSStructureData(),
                lineApplications: await collectLineApplicationData(),
                seasonalData: await collectSeasonalData(),
                fiveElementData: await collectFiveElementData(),
                lineRelationships: await collectLineRelationshipData()
            };
        }

        async function collectTrigramRelationshipData() {
            // å®Ÿéš›ã®iching_relationships.jsã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            if (typeof window.OPPOSING_RELATIONSHIPS !== 'undefined') {
                return {
                    opposition: window.OPPOSING_RELATIONSHIPS,
                    complement: window.COMPLEMENTARY_RELATIONSHIPS?.yin_yang_harmony || {}
                };
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: æ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿
            return {
                opposition: {
                    "ä¹¾": "å¤", "å¤": "ä¹¾",
                    "éœ‡": "è‰®", "è‰®": "éœ‡",
                    "å": "é›¢", "é›¢": "å",
                    "å·½": "å…Œ", "å…Œ": "å·½"
                },
                complement: {
                    "ä¹¾": "å·½", "å·½": "ä¹¾",
                    "å¤": "éœ‡", "éœ‡": "å¤",
                    "å": "é›¢", "é›¢": "å",
                    "è‰®": "å…Œ", "å…Œ": "è‰®"
                }
            };
        }

        async function collectHexagramData() {
            // å®Ÿéš›ã®hexagrams.jsã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            if (typeof window.HEXAGRAMS_MASTER !== 'undefined') {
                const hexagramData = {};
                window.HEXAGRAMS_MASTER.forEach(hex => {
                    // çˆ»ã®é…åˆ—ã‚’ç”Ÿæˆï¼ˆå®Ÿéš›ã®å®Ÿè£…ã«å¿œã˜ã¦èª¿æ•´ï¼‰
                    hexagramData[hex.hexagram_id] = {
                        name: hex.name_jp,
                        lines: generateHexagramLines(hex.hexagram_id),
                        upperTrigram: hex.upper_trigram_id,
                        lowerTrigram: hex.lower_trigram_id
                    };
                });
                return hexagramData;
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: åŸºæœ¬çš„ãªæ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿
            return {
                1: { name: "ä¹¾ç‚ºå¤©", lines: [1,1,1,1,1,1] },
                2: { name: "å¤ç‚ºåœ°", lines: [0,0,0,0,0,0] },
                // ç°¡ç•¥åŒ–
            };
        }

        function generateHexagramLines(hexagramId) {
            // ç°¡å˜ãª16é€²æ•°â†’2é€²æ•°å¤‰æ›ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
            const binary = (hexagramId - 1).toString(2).padStart(6, '0');
            return binary.split('').map(bit => parseInt(bit));
        }

        async function collectUltraSyncLogicData() {
            // ã‚¦ãƒ«ãƒˆãƒ©ã‚·ãƒ³ã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…çŠ¶æ³ã‚’ç¢ºèª
            return {
                methods: {
                    greatTheme: { implemented: true, orthodox: true },
                    trigramResonance: { implemented: true, orthodox: true },
                    // ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚‚åŒæ§˜ã«...
                }
            };
        }

        async function collectTripleOSStructureData() {
            return {
                hasEngineOS: true,
                hasInterfaceOS: true,
                hasSafeModeOS: true,
                allowsPersonalitySwitching: true,
                enablesContextualPersonality: true
            };
        }

        async function collectLineApplicationData() {
            return {
                positions: {
                    1: { meaning: "å§‹ã¾ã‚Šãƒ»åŸºç¤" },
                    2: { meaning: "ç™ºå±•ãƒ»è‡£ä½" },
                    3: { meaning: "è»¢æ›ãƒ»é€²é€€" },
                    4: { meaning: "é€²å±•ãƒ»è¿‘è‡£" },
                    5: { meaning: "æˆç†Ÿãƒ»å›ä½" },
                    6: { meaning: "å®Œæˆãƒ»é€€éš " }
                }
            };
        }

        async function collectSeasonalData() {
            return {
                hexagramSeasons: {
                    "å¾©": { season: "å†¬è‡³" },
                    "è‡¨": { season: "å°å¯’" },
                    // ä»–ã®åäºŒæ¶ˆæ¯å¦...
                }
            };
        }

        async function collectFiveElementData() {
            return {
                relationships: [
                    { source: "æœ¨", target: "ç«", type: "ç›¸ç”Ÿ" },
                    { source: "ç«", target: "åœŸ", type: "ç›¸ç”Ÿ" },
                    { source: "åœŸ", target: "é‡‘", type: "ç›¸ç”Ÿ" },
                    { source: "é‡‘", target: "æ°´", type: "ç›¸ç”Ÿ" },
                    { source: "æ°´", target: "æœ¨", type: "ç›¸ç”Ÿ" },
                    // ç›¸å‰‹é–¢ä¿‚ã‚‚åŒæ§˜ã«...
                ]
            };
        }

        async function collectLineRelationshipData() {
            return {
                correspondence: [
                    { pos1: 1, pos2: 4 },
                    { pos1: 2, pos2: 5 },
                    { pos1: 3, pos2: 6 }
                ],
                adjacency: [
                    { pos1: 1, pos2: 2 },
                    { pos1: 2, pos2: 3 },
                    { pos1: 3, pos2: 4 },
                    { pos1: 4, pos2: 5 },
                    { pos1: 5, pos2: 6 }
                ]
            };
        }

        // ========== çµæœè¡¨ç¤ºé–¢æ•° ==========

        function showLoading(message, showProgress = false) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>${message}</p>
                    ${showProgress ? '<div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>' : ''}
                </div>
            `;
        }

        function showError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <div class="issue-item">
                    <strong>âŒ ã‚¨ãƒ©ãƒ¼</strong><br>
                    ${message}
                </div>
            `;
        }

        function showTrigramResults(results) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <h3>ğŸ”¸ å…«å¦ç›¸äº’é–¢ä¿‚æ€§æ¤œè¨¼çµæœ</h3>
                <div class="${getScoreClass(results.overallScore)}">
                    ç·åˆã‚¹ã‚³ã‚¢: ${Math.round(results.overallScore * 100)}%
                </div>
                
                <div class="domain-score">
                    <div class="domain-item">
                        <div class="label">å¯¾ç«‹é–¢ä¿‚æ­£ç¢ºæ€§</div>
                        <div class="value">${Math.round(results.oppositionRelationships.score * 100)}%</div>
                    </div>
                    <div class="domain-item">
                        <div class="label">è£œå®Œé–¢ä¿‚æ­£ç¢ºæ€§</div>
                        <div class="value">${Math.round(results.complementaryRelationships.score * 100)}%</div>
                    </div>
                    <div class="domain-item">
                        <div class="label">äº”è¡Œå¾ªç’°æ­£ç¢ºæ€§</div>
                        <div class="value">${Math.round(results.fiveElementCycles.score * 100)}%</div>
                    </div>
                    <div class="domain-item">
                        <div class="label">å®¶æ—çš„å½¹å‰²æ­£ç¢ºæ€§</div>
                        <div class="value">${Math.round(results.familyDynamics.score * 100)}%</div>
                    </div>
                </div>
                
                ${results.issues.length > 0 ? `
                    <h4>ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ</h4>
                    ${results.issues.map(issue => `
                        <div class="issue-item">
                            <strong>${issue.category}</strong>: ${issue.description}
                        </div>
                    `).join('')}
                ` : '<div class="recommendation">âœ… å…«å¦ç›¸äº’é–¢ä¿‚æ€§ã«å•é¡Œã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>'}
            `;
        }

        function showComprehensiveResults(results) {
            const assessment = results.overallAssessment;
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <h3>ğŸ”¯ åŒ…æ‹¬çš„æ¤œè¨¼çµæœ</h3>
                
                <div class="score-badge ${getScoreClass(assessment.overallScore)}">
                    ç·åˆã‚¹ã‚³ã‚¢: ${Math.round(assessment.overallScore * 100)}% (${assessment.assessmentLevel})
                </div>
                
                <div class="domain-score">
                    <div class="domain-item">
                        <div class="label">å…«å¦é–¢ä¿‚æ€§</div>
                        <div class="value">${Math.round(assessment.domainScores.trigramRelationships * 100)}%</div>
                    </div>
                    <div class="domain-item">
                        <div class="label">64å¦ãƒãƒ©ãƒ³ã‚¹</div>
                        <div class="value">${Math.round(assessment.domainScores.hexagramBalance * 100)}%</div>
                    </div>
                    <div class="domain-item">
                        <div class="label">ã‚¦ãƒ«ãƒˆãƒ©ã‚·ãƒ³ã‚¯ãƒ­ã‚¸ãƒƒã‚¯</div>
                        <div class="value">${Math.round(assessment.domainScores.ultraSyncLogic * 100)}%</div>
                    </div>
                    <div class="domain-item">
                        <div class="label">bunenjinæ•´åˆæ€§</div>
                        <div class="value">${Math.round(assessment.domainScores.bunenjinAlignment * 100)}%</div>
                    </div>
                    <div class="domain-item">
                        <div class="label">çˆ»è¾é©ç”¨</div>
                        <div class="value">${Math.round(assessment.domainScores.lineApplication * 100)}%</div>
                    </div>
                </div>
                
                <h4>å¼·ã¿</h4>
                ${assessment.strengths.map(strength => `
                    <div class="recommendation">âœ… ${strength}</div>
                `).join('')}
                
                <h4>å¼±ã¿</h4>
                ${assessment.weaknesses.map(weakness => `
                    <div class="issue-item">âš ï¸ ${weakness}</div>
                `).join('')}
                
                <h4>æ”¹å–„å„ªå…ˆåº¦</h4>
                ${assessment.improvementPriorities.map((priority, index) => `
                    <div class="domain-item">
                        <div class="label">${index + 1}. ${priority.domain}</div>
                        <div class="value">ã‚¹ã‚³ã‚¢: ${Math.round(priority.score * 100)}% (${priority.urgency})</div>
                    </div>
                `).join('')}
                
                <h4>æœ€å„ªå…ˆæ¨å¥¨äº‹é …</h4>
                ${results.recommendations.filter(rec => rec.urgency === 'high').map(rec => `
                    <div class="recommendation">
                        <strong>${rec.category}</strong><br>
                        ${rec.recommendation}<br>
                        <small>å·¥æ•°: ${rec.estimatedEffort} | å½±éŸ¿: ${rec.expectedImpact}</small>
                    </div>
                `).join('')}
            `;
        }

        // ä»–ã®çµæœè¡¨ç¤ºé–¢æ•°ã‚‚åŒæ§˜ã«å®Ÿè£…...

        function getScoreClass(score) {
            if (score >= 0.9) return 'score-badge score-excellent';
            if (score >= 0.8) return 'score-badge score-good';
            if (score >= 0.7) return 'score-badge score-needs-improvement';
            return 'score-badge score-needs-fix';
        }

        // ========== ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ ==========

        async function generateDetailedReport() {
            if (!currentValidationResults) {
                showError("ã¾ãšåŒ…æ‹¬çš„æ¤œè¨¼ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚");
                return;
            }
            
            showLoading("è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­...");
            
            try {
                const report = await reportGenerator.generateReport(currentValidationResults, {
                    format: 'html',
                    includeCharts: true,
                    includeDetails: true
                });
                
                // æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º
                const reportWindow = window.open('', '_blank');
                reportWindow.document.write(report);
                reportWindow.document.close();
                
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = `
                    <div class="recommendation">
                        âœ… è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆãŒæ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚<br>
                        ãƒ¬ãƒãƒ¼ãƒˆã«ã¯åŒ…æ‹¬çš„ãªåˆ†æçµæœã€è¦–è¦šçš„ãªãƒãƒ£ãƒ¼ãƒˆã€å…·ä½“çš„ãªæ”¹å–„ææ¡ˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
                    </div>
                `;
                
            } catch (error) {
                console.error("ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼:", error);
                showError("è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
            }
        }

        // ãƒ‡ãƒ¢ç”¨ã®é€²æ—æ›´æ–°
        function updateProgress(percentage) {
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = percentage + '%';
            }
        }
    </script>
</body>
</html>