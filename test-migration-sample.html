<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI Data Migration Test - TASK-038æ¤œè¨¼</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f8fafc;
        }

        .section h2 {
            color: #1f2937;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-content {
            display: grid;
            gap: 16px;
        }

        .button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
        }

        .button:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .button.secondary {
            background: #6b7280;
        }

        .button.secondary:hover {
            background: #4b5563;
        }

        .button.danger {
            background: #ef4444;
        }

        .button.danger:hover {
            background: #dc2626;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .status-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
        }

        .status-card h3 {
            color: #374151;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-value {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .status-label {
            color: #6b7280;
            font-size: 14px;
        }

        .log-area {
            background: #111827;
            color: #f3f4f6;
            padding: 20px;
            border-radius: 8px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 14px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 16px;
        }

        .log-entry {
            margin-bottom: 4px;
        }

        .log-timestamp {
            color: #9ca3af;
            margin-right: 8px;
        }

        .log-level-info {
            color: #3b82f6;
        }

        .log-level-success {
            color: #10b981;
        }

        .log-level-error {
            color: #ef4444;
        }

        .log-level-warning {
            color: #f59e0b;
        }

        .sample-data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .sample-data-item {
            background: white;
            padding: 16px;
            border-radius: 6px;
            border: 1px solid #d1d5db;
        }

        .sample-data-item h4 {
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .sample-data-preview {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 12px;
            color: #6b7280;
            background: #f3f4f6;
            padding: 8px;
            border-radius: 4px;
            overflow: hidden;
            white-space: pre-wrap;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #6b7280;
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .alert.success {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            color: #065f46;
        }

        .alert.error {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }

        .alert.warning {
            background: #fef3c7;
            border: 1px solid #fde68a;
            color: #92400e;
        }

        @media (max-width: 640px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .content {
                padding: 20px;
            }

            .status-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="header">
                <h1>ğŸ”„ HAQEI Data Migration Test</h1>
                <p>localStorageã‹ã‚‰Supabaseã¸ã®ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼</p>
                <div class="badge">TASK-038 Complete Test</div>
            </div>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <div class="content">
                
                <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ¦‚è¦ -->
                <div class="section">
                    <h2>ğŸ“Š ç§»è¡Œã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³</h2>
                    <div class="status-grid">
                        <div class="status-card">
                            <h3>ğŸ” æ¤œå‡ºã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿</h3>
                            <div class="status-value">{{ detectionStatus.totalItems }}</div>
                            <div class="status-label">ã‚¢ã‚¤ãƒ†ãƒ </div>
                        </div>
                        <div class="status-card">
                            <h3>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º</h3>
                            <div class="status-value">{{ Math.round(detectionStatus.totalSize / 1024) }}</div>
                            <div class="status-label">KB</div>
                        </div>
                        <div class="status-card">
                            <h3>ğŸ¯ ç§»è¡Œé€²æ—</h3>
                            <div class="status-value">{{ migrationProgress }}%</div>
                            <div class="status-label">å®Œäº†</div>
                        </div>
                        <div class="status-card">
                            <h3>ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</h3>
                            <div class="status-value">{{ privacyLevel }}</div>
                            <div class="status-label">ãƒ¬ãƒ™ãƒ«</div>
                        </div>
                    </div>
                </div>

                <!-- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ -->
                <div class="section">
                    <h2>ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ</h2>
                    <div class="section-content">
                        <p>bunenjinå“²å­¦æº–æ‹ ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦localStorageã«ä¿å­˜ã—ã¾ã™ã€‚</p>
                        
                        <div class="sample-data-grid">
                            <div class="sample-data-item">
                                <h4>ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿</h4>
                                <div class="sample-data-preview">{{ JSON.stringify(sampleData.user, null, 2).substring(0, 100) }}...</div>
                            </div>
                            <div class="sample-data-item">
                                <h4>ğŸ® ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿</h4>
                                <div class="sample-data-preview">{{ JSON.stringify(sampleData.session, null, 2).substring(0, 100) }}...</div>
                            </div>
                            <div class="sample-data-item">
                                <h4>ğŸ’­ å›ç­”ãƒ‡ãƒ¼ã‚¿</h4>
                                <div class="sample-data-preview">{{ JSON.stringify(sampleData.responses[0], null, 2).substring(0, 100) }}...</div>
                            </div>
                            <div class="sample-data-item">
                                <h4>ğŸ¯ Triple OS</h4>
                                <div class="sample-data-preview">{{ JSON.stringify(sampleData.tripleOS, null, 2).substring(0, 100) }}...</div>
                            </div>
                        </div>

                        <div style="margin-top: 16px;">
                            <button class="button" @click="generateSampleData">
                                ğŸ§ª ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
                            </button>
                            <button class="button secondary" @click="clearLocalStorage" style="margin-left: 12px;">
                                ğŸ—‘ï¸ localStorage ã‚¯ãƒªã‚¢
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ãƒ‡ãƒ¼ã‚¿æ¤œå‡º -->
                <div class="section">
                    <h2>ğŸ” ãƒ‡ãƒ¼ã‚¿æ¤œå‡º</h2>
                    <div class="section-content">
                        <p>localStorageã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹HAQEIãƒ‡ãƒ¼ã‚¿ã‚’æ¤œå‡ºãƒ»åˆ†æã—ã¾ã™ã€‚</p>
                        
                        <div v-if="detectionResult" class="alert" :class="detectionResult.success ? 'success' : 'error'">
                            <strong>æ¤œå‡ºçµæœ:</strong> {{ detectionResult.message }}
                        </div>

                        <div>
                            <button class="button" @click="detectData" :disabled="isDetecting">
                                {{ isDetecting ? 'ğŸ”„ æ¤œå‡ºä¸­...' : 'ğŸ” ãƒ‡ãƒ¼ã‚¿æ¤œå‡º' }}
                            </button>
                        </div>

                        <div v-if="detectedData" style="margin-top: 16px;">
                            <h3>æ¤œå‡ºã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—:</h3>
                            <div class="sample-data-grid">
                                <div 
                                    v-for="(items, type) in detectedData.dataByType" 
                                    :key="type"
                                    v-if="items.length > 0"
                                    class="sample-data-item"
                                >
                                    <h4>{{ getDataTypeName(type) }}</h4>
                                    <div class="status-value">{{ items.length }}</div>
                                    <div class="status-label">ã‚¢ã‚¤ãƒ†ãƒ </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç§»è¡Œå®Ÿè¡Œ -->
                <div class="section">
                    <h2>ğŸš€ ãƒ‡ãƒ¼ã‚¿ç§»è¡Œå®Ÿè¡Œ</h2>
                    <div class="section-content">
                        <p>æ¤œå‡ºã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’Supabaseã«ç§»è¡Œã—ã¾ã™ï¼ˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼‰ã€‚</p>

                        <div class="alert warning">
                            <strong>æ³¨æ„:</strong> ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®å®Ÿè¡Œã§ã™ã€‚å®Ÿéš›ã®Supabaseã«ã¯æ¥ç¶šã•ã‚Œã¾ã›ã‚“ã€‚
                        </div>

                        <div v-if="migrationResult" class="alert" :class="migrationResult.success ? 'success' : 'error'">
                            <strong>ç§»è¡Œçµæœ:</strong> {{ migrationResult.message }}
                        </div>

                        <div v-if="isMigrating">
                            <div class="progress-bar">
                                <div class="progress-fill" :style="{ width: migrationProgress + '%' }"></div>
                            </div>
                            <div class="progress-text">
                                <span>{{ currentOperation }}</span>
                                <span>{{ migrationProgress }}%</span>
                            </div>
                        </div>

                        <div>
                            <button class="button" @click="startMigration" :disabled="!canStartMigration || isMigrating">
                                {{ isMigrating ? 'ğŸ”„ ç§»è¡Œä¸­...' : 'ğŸš€ ç§»è¡Œé–‹å§‹ï¼ˆãƒ†ã‚¹ãƒˆï¼‰' }}
                            </button>
                            <button v-if="isMigrating" class="button danger" @click="cancelMigration" style="margin-left: 12px;">
                                â¹ï¸ ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ãƒ­ã‚° -->
                <div class="section">
                    <h2>ğŸ“ å®Ÿè¡Œãƒ­ã‚°</h2>
                    <div class="log-area" ref="logArea">
                        <div v-for="entry in logs" :key="entry.id" class="log-entry">
                            <span class="log-timestamp">{{ formatTime(entry.timestamp) }}</span>
                            <span :class="`log-level-${entry.level}`">{{ entry.message }}</span>
                        </div>
                    </div>
                    <div style="margin-top: 16px;">
                        <button class="button secondary" @click="clearLogs">
                            ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢
                        </button>
                        <button class="button secondary" @click="exportLogs" style="margin-left: 12px;">
                            ğŸ“„ ãƒ­ã‚°å‡ºåŠ›
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, nextTick } = Vue

        createApp({
            setup() {
                // ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¼ã‚¿
                const detectionStatus = ref({
                    totalItems: 0,
                    totalSize: 0
                })
                
                const migrationProgress = ref(0)
                const privacyLevel = ref('maximum')
                const isDetecting = ref(false)
                const isMigrating = ref(false)
                const currentOperation = ref('')
                
                const detectionResult = ref(null)
                const migrationResult = ref(null)
                const detectedData = ref(null)
                
                const logs = ref([])
                
                // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
                const sampleData = ref({
                    user: {
                        id: 'user_12345',
                        email: 'test@haqei.com',
                        username: 'haqei_user',
                        privacy_level: 'maximum',
                        created_at: new Date().toISOString()
                    },
                    session: {
                        id: 'session_67890',
                        user_id: 'user_12345',
                        session_type: 'triple_os_analysis',
                        completion_status: 'completed',
                        created_at: new Date().toISOString()
                    },
                    responses: [
                        {
                            id: 'response_1',
                            session_id: 'session_67890',
                            question_id: 'q_engine_1',
                            question_text: 'ã‚ãªãŸã¯æœ¬å½“ã®è‡ªåˆ†ã‚’è¡¨ç¾ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ',
                            response_value: 6,
                            response_time_seconds: 3.2
                        },
                        {
                            id: 'response_2',
                            session_id: 'session_67890',
                            question_id: 'q_interface_1',
                            question_text: 'ä»–è€…ã¨ã®é–¢ä¿‚ã§è‡ªç„¶ä½“ã§ã„ã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ',
                            response_value: 5,
                            response_time_seconds: 4.1
                        },
                        {
                            id: 'response_3',
                            session_id: 'session_67890',
                            question_id: 'q_safe_1',
                            question_text: 'ã‚¹ãƒˆãƒ¬ã‚¹æ™‚ã«å†·é™ã•ã‚’ä¿ã¦ã¾ã™ã‹ï¼Ÿ',
                            response_value: 4,
                            response_time_seconds: 2.8
                        }
                    ],
                    tripleOS: {
                        engineOS: {
                            id: 'engine_12345',
                            user_id: 'user_12345',
                            hexagram_id: 1,
                            hexagram_name: 'ä¹¾ - The Creative',
                            confidence_score: 0.87,
                            analysis_data: {
                                authenticity_score: 85,
                                primary_trigram: 'Heaven',
                                secondary_trigram: 'Heaven',
                                characteristics: ['å‰µé€ æ€§', 'æŒ‡å°åŠ›', 'ç‹¬ç«‹æ€§']
                            }
                        },
                        interfaceOS: {
                            id: 'interface_12345',
                            user_id: 'user_12345',
                            hexagram_id: 11,
                            hexagram_name: 'æ³° - Peace',
                            confidence_score: 0.92,
                            analysis_data: {
                                adaptability_score: 78,
                                social_intelligence: 82,
                                characteristics: ['èª¿å’Œæ€§', 'æŸ”è»Ÿæ€§', 'å”èª¿æ€§']
                            }
                        },
                        safeModeOS: {
                            id: 'safe_12345',
                            user_id: 'user_12345',
                            hexagram_id: 52,
                            hexagram_name: 'è‰® - Keeping Still',
                            confidence_score: 0.79,
                            analysis_data: {
                                resilience_level: 73,
                                anxiety_management: 68,
                                characteristics: ['å®‰å®šæ€§', 'å¿è€åŠ›', 'å†…çœæ€§']
                            }
                        }
                    }
                })

                // Computed
                const canStartMigration = computed(() => {
                    return detectionStatus.value.totalItems > 0 && !isMigrating.value
                })

                // ãƒ¡ã‚½ãƒƒãƒ‰
                const addLog = (message, level = 'info') => {
                    logs.value.push({
                        id: Date.now() + Math.random(),
                        timestamp: Date.now(),
                        message,
                        level
                    })
                    
                    nextTick(() => {
                        const logArea = document.querySelector('.log-area')
                        if (logArea) {
                            logArea.scrollTop = logArea.scrollHeight
                        }
                    })
                }

                const formatTime = (timestamp) => {
                    return new Date(timestamp).toLocaleTimeString('ja-JP')
                }

                const generateSampleData = () => {
                    addLog('ğŸ§ª ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆä¸­...', 'info')
                    
                    try {
                        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿
                        localStorage.setItem('haqei_user_12345', JSON.stringify(sampleData.value.user))
                        
                        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿
                        localStorage.setItem('haqei_session_67890', JSON.stringify(sampleData.value.session))
                        
                        // å›ç­”ãƒ‡ãƒ¼ã‚¿
                        sampleData.value.responses.forEach((response, index) => {
                            localStorage.setItem(`haqei_response_${response.id}`, JSON.stringify(response))
                        })
                        
                        // Triple OSãƒ‡ãƒ¼ã‚¿
                        Object.entries(sampleData.value.tripleOS).forEach(([osType, osData]) => {
                            localStorage.setItem(`haqei_triple_os_${osType}_12345`, JSON.stringify(osData))
                        })
                        
                        // åˆ†æçµæœãƒ‡ãƒ¼ã‚¿
                        const analysisResult = {
                            id: 'analysis_12345',
                            session_id: 'session_67890',
                            user_id: 'user_12345',
                            analysis_data: {
                                timestamp: Date.now(),
                                dimensionScores: {
                                    authenticity: 85,
                                    adaptability: 78,
                                    resilience: 73
                                },
                                totalScore: 236,
                                averageScore: 78.7,
                                confidence: 0.86
                            },
                            triple_os_data: sampleData.value.tripleOS,
                            created_at: new Date().toISOString()
                        }
                        localStorage.setItem('haqei_analysis_12345', JSON.stringify(analysisResult))
                        
                        addLog('âœ… ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†ï¼ˆ15ã‚¢ã‚¤ãƒ†ãƒ ï¼‰', 'success')
                        updateDetectionStatus()
                        
                    } catch (error) {
                        addLog(`âŒ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error')
                    }
                }

                const clearLocalStorage = () => {
                    addLog('ğŸ—‘ï¸ localStorageã‚’ã‚¯ãƒªã‚¢ä¸­...', 'info')
                    
                    const keysToRemove = []
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i)
                        if (key && key.startsWith('haqei_')) {
                            keysToRemove.push(key)
                        }
                    }
                    
                    keysToRemove.forEach(key => localStorage.removeItem(key))
                    
                    addLog(`âœ… ${keysToRemove.length}å€‹ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, 'success')
                    updateDetectionStatus()
                    
                    detectionResult.value = null
                    migrationResult.value = null
                    detectedData.value = null
                }

                const updateDetectionStatus = () => {
                    let totalItems = 0
                    let totalSize = 0
                    
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i)
                        if (key && key.startsWith('haqei_')) {
                            totalItems++
                            const value = localStorage.getItem(key)
                            if (value) {
                                totalSize += value.length
                            }
                        }
                    }
                    
                    detectionStatus.value = { totalItems, totalSize }
                }

                const detectData = async () => {
                    if (isDetecting.value) return
                    
                    isDetecting.value = true
                    addLog('ğŸ” localStorageãƒ‡ãƒ¼ã‚¿æ¤œå‡ºã‚’é–‹å§‹...', 'info')
                    
                    try {
                        // æ¤œå‡ºå‡¦ç†ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                        await new Promise(resolve => setTimeout(resolve, 1000))
                        
                        const mockDetectedData = {
                            totalItems: detectionStatus.value.totalItems,
                            totalSizeBytes: detectionStatus.value.totalSize,
                            dataByType: {
                                user: [],
                                session: [],
                                response: [],
                                analysis: [],
                                triple_os: [],
                                settings: []
                            },
                            estimatedMigrationTime: 0,
                            privacyRisk: 'low',
                            compatibilityCheck: {
                                isCompatible: true,
                                issues: [],
                                recommendations: []
                            }
                        }
                        
                        // localStorageã‚’ã‚¹ã‚­ãƒ£ãƒ³
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i)
                            if (!key || !key.startsWith('haqei_')) continue
                            
                            const value = localStorage.getItem(key)
                            if (!value) continue
                            
                            const dataType = determineDataType(key)
                            const item = {
                                key,
                                value: JSON.parse(value),
                                timestamp: Date.now(),
                                dataType,
                                size: value.length
                            }
                            
                            mockDetectedData.dataByType[dataType].push(item)
                        }
                        
                        mockDetectedData.estimatedMigrationTime = Math.ceil(mockDetectedData.totalItems * 0.5)
                        
                        detectedData.value = mockDetectedData
                        detectionResult.value = {
                            success: true,
                            message: `${mockDetectedData.totalItems}å€‹ã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œå‡ºã—ã¾ã—ãŸ`
                        }
                        
                        addLog(`âœ… ãƒ‡ãƒ¼ã‚¿æ¤œå‡ºå®Œäº†: ${mockDetectedData.totalItems}ã‚¢ã‚¤ãƒ†ãƒ `, 'success')
                        
                    } catch (error) {
                        detectionResult.value = {
                            success: false,
                            message: `æ¤œå‡ºã‚¨ãƒ©ãƒ¼: ${error.message}`
                        }
                        addLog(`âŒ ãƒ‡ãƒ¼ã‚¿æ¤œå‡ºã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error')
                    } finally {
                        isDetecting.value = false
                    }
                }

                const determineDataType = (key) => {
                    const keyLower = key.toLowerCase()
                    
                    if (keyLower.includes('user')) return 'user'
                    if (keyLower.includes('session')) return 'session'
                    if (keyLower.includes('response')) return 'response'
                    if (keyLower.includes('analysis')) return 'analysis'
                    if (keyLower.includes('triple') || keyLower.includes('os')) return 'triple_os'
                    return 'settings'
                }

                const getDataTypeName = (type) => {
                    const names = {
                        user: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿',
                        session: 'ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿',
                        response: 'å›ç­”ãƒ‡ãƒ¼ã‚¿',
                        analysis: 'åˆ†æçµæœ',
                        triple_os: 'Triple OS',
                        settings: 'è¨­å®šãƒ‡ãƒ¼ã‚¿'
                    }
                    return names[type] || type
                }

                const startMigration = async () => {
                    if (!canStartMigration.value || isMigrating.value) return
                    
                    isMigrating.value = true
                    migrationProgress.value = 0
                    currentOperation.value = 'ç§»è¡Œæº–å‚™ä¸­...'
                    
                    addLog('ğŸš€ ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚’é–‹å§‹ã—ã¾ã™ï¼ˆãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰', 'info')
                    
                    try {
                        const totalItems = detectionStatus.value.totalItems
                        const phases = [
                            { name: 'ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ä¸­...', duration: 1000, progress: 15 },
                            { name: 'ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆä¸­...', duration: 800, progress: 30 },
                            { name: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ç§»è¡Œä¸­...', duration: 1200, progress: 50 },
                            { name: 'ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ç§»è¡Œä¸­...', duration: 1000, progress: 65 },
                            { name: 'å›ç­”ãƒ‡ãƒ¼ã‚¿ç§»è¡Œä¸­...', duration: 1500, progress: 80 },
                            { name: 'Triple OSãƒ‡ãƒ¼ã‚¿ç§»è¡Œä¸­...', duration: 1200, progress: 95 },
                            { name: 'ç§»è¡Œå®Œäº†ç¢ºèªä¸­...', duration: 500, progress: 100 }
                        ]
                        
                        for (const phase of phases) {
                            currentOperation.value = phase.name
                            addLog(`ğŸ“ ${phase.name}`, 'info')
                            
                            await new Promise(resolve => setTimeout(resolve, phase.duration))
                            migrationProgress.value = phase.progress
                        }
                        
                        migrationResult.value = {
                            success: true,
                            message: `${totalItems}å€‹ã®ã‚¢ã‚¤ãƒ†ãƒ ã®ç§»è¡ŒãŒå®Œäº†ã—ã¾ã—ãŸ`
                        }
                        
                        addLog('âœ… ãƒ‡ãƒ¼ã‚¿ç§»è¡ŒãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ', 'success')
                        addLog(`ğŸ“Š ç§»è¡Œçµ±è¨ˆ: ${totalItems}ã‚¢ã‚¤ãƒ†ãƒ ã€${Math.round(detectionStatus.value.totalSize / 1024)}KB`, 'success')
                        
                    } catch (error) {
                        migrationResult.value = {
                            success: false,
                            message: `ç§»è¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`
                        }
                        addLog(`âŒ ç§»è¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error')
                    } finally {
                        isMigrating.value = false
                        currentOperation.value = ''
                    }
                }

                const cancelMigration = () => {
                    if (!isMigrating.value) return
                    
                    isMigrating.value = false
                    migrationProgress.value = 0
                    currentOperation.value = ''
                    
                    migrationResult.value = {
                        success: false,
                        message: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ç§»è¡ŒãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ'
                    }
                    
                    addLog('â¹ï¸ ç§»è¡ŒãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ', 'warning')
                }

                const clearLogs = () => {
                    logs.value = []
                    addLog('ğŸ—‘ï¸ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info')
                }

                const exportLogs = () => {
                    const logText = logs.value.map(entry => 
                        `[${formatTime(entry.timestamp)}] ${entry.level.toUpperCase()}: ${entry.message}`
                    ).join('\n')
                    
                    const blob = new Blob([logText], { type: 'text/plain' })
                    const url = URL.createObjectURL(blob)
                    const a = document.createElement('a')
                    a.href = url
                    a.download = `haqei-migration-log-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`
                    document.body.appendChild(a)
                    a.click()
                    document.body.removeChild(a)
                    URL.revokeObjectURL(url)
                    
                    addLog('ğŸ“„ ãƒ­ã‚°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success')
                }

                // ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«
                onMounted(() => {
                    addLog('ğŸš€ HAQEI Migration Test System åˆæœŸåŒ–å®Œäº†', 'success')
                    addLog('ğŸ“‹ TASK-038: localStorageã‹ã‚‰Supabaseãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚·ã‚¹ãƒ†ãƒ ', 'info')
                    addLog('ğŸ”’ bunenjinå“²å­¦æº–æ‹ ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ç§»è¡Œ', 'info')
                    addLog('ğŸ¯ Triple OS Architectureå®Œå…¨å¯¾å¿œ', 'info')
                    updateDetectionStatus()
                })

                return {
                    // ãƒ‡ãƒ¼ã‚¿
                    detectionStatus,
                    migrationProgress,
                    privacyLevel,
                    isDetecting,
                    isMigrating,
                    currentOperation,
                    detectionResult,
                    migrationResult,
                    detectedData,
                    logs,
                    sampleData,
                    
                    // Computed
                    canStartMigration,
                    
                    // ãƒ¡ã‚½ãƒƒãƒ‰
                    generateSampleData,
                    clearLocalStorage,
                    detectData,
                    startMigration,
                    cancelMigration,
                    clearLogs,
                    exportLogs,
                    formatTime,
                    getDataTypeName,
                    
                    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
                    Math
                }
            }
        }).mount('#app')
    </script>
</body>
</html>