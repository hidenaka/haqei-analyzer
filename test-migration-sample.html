<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI Data Migration Test - TASK-038Ê§úË®º</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f8fafc;
        }

        .section h2 {
            color: #1f2937;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-content {
            display: grid;
            gap: 16px;
        }

        .button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
        }

        .button:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .button.secondary {
            background: #6b7280;
        }

        .button.secondary:hover {
            background: #4b5563;
        }

        .button.danger {
            background: #ef4444;
        }

        .button.danger:hover {
            background: #dc2626;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .status-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
        }

        .status-card h3 {
            color: #374151;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-value {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .status-label {
            color: #6b7280;
            font-size: 14px;
        }

        .log-area {
            background: #111827;
            color: #f3f4f6;
            padding: 20px;
            border-radius: 8px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 14px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 16px;
        }

        .log-entry {
            margin-bottom: 4px;
        }

        .log-timestamp {
            color: #9ca3af;
            margin-right: 8px;
        }

        .log-level-info {
            color: #3b82f6;
        }

        .log-level-success {
            color: #10b981;
        }

        .log-level-error {
            color: #ef4444;
        }

        .log-level-warning {
            color: #f59e0b;
        }

        .sample-data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .sample-data-item {
            background: white;
            padding: 16px;
            border-radius: 6px;
            border: 1px solid #d1d5db;
        }

        .sample-data-item h4 {
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .sample-data-preview {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 12px;
            color: #6b7280;
            background: #f3f4f6;
            padding: 8px;
            border-radius: 4px;
            overflow: hidden;
            white-space: pre-wrap;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #6b7280;
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .alert.success {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            color: #065f46;
        }

        .alert.error {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }

        .alert.warning {
            background: #fef3c7;
            border: 1px solid #fde68a;
            color: #92400e;
        }

        @media (max-width: 640px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .content {
                padding: 20px;
            }

            .status-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
            <div class="header">
                <h1>üîÑ HAQEI Data Migration Test</h1>
                <p>localStorage„Åã„ÇâSupabase„Å∏„ÅÆ„Éá„Éº„ÇøÁßªË°å„Ç∑„Çπ„ÉÜ„É†Ê§úË®º</p>
                <div class="badge">TASK-038 Complete Test</div>
            </div>

            <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div class="content">
                
                <!-- „Çπ„ÉÜ„Éº„Çø„ÇπÊ¶ÇË¶Å -->
                <div class="section">
                    <h2>üìä ÁßªË°å„Ç∑„Çπ„ÉÜ„É†Áä∂Ê≥Å</h2>
                    <div class="status-grid">
                        <div class="status-card">
                            <h3>üîç Ê§úÂá∫„Åï„Çå„Åü„Éá„Éº„Çø</h3>
                            <div class="status-value">{{ detectionStatus.totalItems }}</div>
                            <div class="status-label">„Ç¢„Ç§„ÉÜ„É†</div>
                        </div>
                        <div class="status-card">
                            <h3>üíæ „Éá„Éº„Çø„Çµ„Ç§„Ç∫</h3>
                            <div class="status-value">{{ Math.round(detectionStatus.totalSize / 1024) }}</div>
                            <div class="status-label">KB</div>
                        </div>
                        <div class="status-card">
                            <h3>üéØ ÁßªË°åÈÄ≤Êçó</h3>
                            <div class="status-value">{{ migrationProgress }}%</div>
                            <div class="status-label">ÂÆå‰∫Ü</div>
                        </div>
                        <div class="status-card">
                            <h3>üîí „Éó„É©„Ç§„Éê„Ç∑„Éº</h3>
                            <div class="status-value">{{ privacyLevel }}</div>
                            <div class="status-label">„É¨„Éô„É´</div>
                        </div>
                    </div>
                </div>

                <!-- „ÉÜ„Çπ„Éà„Éá„Éº„ÇøÁîüÊàê -->
                <div class="section">
                    <h2>üß™ „ÉÜ„Çπ„Éà„Éá„Éº„ÇøÁîüÊàê</h2>
                    <div class="section-content">
                        <p>bunenjinÂì≤Â≠¶Ê∫ñÊã†„ÅÆ„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíÁîüÊàê„Åó„Å¶localStorage„Å´‰øùÂ≠ò„Åó„Åæ„Åô„ÄÇ</p>
                        
                        <div class="sample-data-grid">
                            <div class="sample-data-item">
                                <h4>üë§ „É¶„Éº„Ç∂„Éº„Éá„Éº„Çø</h4>
                                <div class="sample-data-preview">{{ JSON.stringify(sampleData.user, null, 2).substring(0, 100) }}...</div>
                            </div>
                            <div class="sample-data-item">
                                <h4>üéÆ „Çª„ÉÉ„Ç∑„Éß„É≥„Éá„Éº„Çø</h4>
                                <div class="sample-data-preview">{{ JSON.stringify(sampleData.session, null, 2).substring(0, 100) }}...</div>
                            </div>
                            <div class="sample-data-item">
                                <h4>üí≠ ÂõûÁ≠î„Éá„Éº„Çø</h4>
                                <div class="sample-data-preview">{{ JSON.stringify(sampleData.responses[0], null, 2).substring(0, 100) }}...</div>
                            </div>
                            <div class="sample-data-item">
                                <h4>üéØ Triple OS</h4>
                                <div class="sample-data-preview">{{ JSON.stringify(sampleData.tripleOS, null, 2).substring(0, 100) }}...</div>
                            </div>
                        </div>

                        <div style="margin-top: 16px;">
                            <button class="button" @click="generateSampleData">
                                üß™ „Çµ„É≥„Éó„É´„Éá„Éº„ÇøÁîüÊàê
                            </button>
                            <button class="button secondary" @click="clearLocalStorage" style="margin-left: 12px;">
                                üóëÔ∏è localStorage „ÇØ„É™„Ç¢
                            </button>
                        </div>
                    </div>
                </div>

                <!-- „Éá„Éº„ÇøÊ§úÂá∫ -->
                <div class="section">
                    <h2>üîç „Éá„Éº„ÇøÊ§úÂá∫</h2>
                    <div class="section-content">
                        <p>localStorage„Å´‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãHAQEI„Éá„Éº„Çø„ÇíÊ§úÂá∫„ÉªÂàÜÊûê„Åó„Åæ„Åô„ÄÇ</p>
                        
                        <div v-if="detectionResult" class="alert" :class="detectionResult.success ? 'success' : 'error'">
                            <strong>Ê§úÂá∫ÁµêÊûú:</strong> {{ detectionResult.message }}
                        </div>

                        <div>
                            <button class="button" @click="detectData" :disabled="isDetecting">
                                {{ isDetecting ? 'üîÑ Ê§úÂá∫‰∏≠...' : 'üîç „Éá„Éº„ÇøÊ§úÂá∫' }}
                            </button>
                        </div>

                        <div v-if="detectedData" style="margin-top: 16px;">
                            <h3>Ê§úÂá∫„Åï„Çå„Åü„Éá„Éº„Çø„Çø„Ç§„Éó:</h3>
                            <div class="sample-data-grid">
                                <div 
                                    v-for="(items, type) in detectedData.dataByType" 
                                    :key="type"
                                    v-if="items.length > 0"
                                    class="sample-data-item"
                                >
                                    <h4>{{ getDataTypeName(type) }}</h4>
                                    <div class="status-value">{{ items.length }}</div>
                                    <div class="status-label">„Ç¢„Ç§„ÉÜ„É†</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÁßªË°åÂÆüË°å -->
                <div class="section">
                    <h2>üöÄ „Éá„Éº„ÇøÁßªË°åÂÆüË°å</h2>
                    <div class="section-content">
                        <p>Ê§úÂá∫„Åï„Çå„Åü„Éá„Éº„Çø„ÇíSupabase„Å´ÁßªË°å„Åó„Åæ„ÅôÔºà„ÉÜ„Çπ„ÉàÂÆüË°åÔºâ„ÄÇ</p>

                        <div class="alert warning">
                            <strong>Ê≥®ÊÑè:</strong> „Åì„Çå„ÅØ„ÉÜ„Çπ„ÉàÁí∞Â¢É„Åß„ÅÆÂÆüË°å„Åß„Åô„ÄÇÂÆüÈöõ„ÅÆSupabase„Å´„ÅØÊé•Á∂ö„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
                        </div>

                        <div v-if="migrationResult" class="alert" :class="migrationResult.success ? 'success' : 'error'">
                            <strong>ÁßªË°åÁµêÊûú:</strong> {{ migrationResult.message }}
                        </div>

                        <div v-if="isMigrating">
                            <div class="progress-bar">
                                <div class="progress-fill" :style="{ width: migrationProgress + '%' }"></div>
                            </div>
                            <div class="progress-text">
                                <span>{{ currentOperation }}</span>
                                <span>{{ migrationProgress }}%</span>
                            </div>
                        </div>

                        <div>
                            <button class="button" @click="startMigration" :disabled="!canStartMigration || isMigrating">
                                {{ isMigrating ? 'üîÑ ÁßªË°å‰∏≠...' : 'üöÄ ÁßªË°åÈñãÂßãÔºà„ÉÜ„Çπ„ÉàÔºâ' }}
                            </button>
                            <button v-if="isMigrating" class="button danger" @click="cancelMigration" style="margin-left: 12px;">
                                ‚èπÔ∏è „Ç≠„É£„É≥„Çª„É´
                            </button>
                        </div>
                    </div>
                </div>

                <!-- „É≠„Ç∞ -->
                <div class="section">
                    <h2>üìù ÂÆüË°å„É≠„Ç∞</h2>
                    <div class="log-area" ref="logArea">
                        <div v-for="entry in logs" :key="entry.id" class="log-entry">
                            <span class="log-timestamp">{{ formatTime(entry.timestamp) }}</span>
                            <span :class="`log-level-${entry.level}`">{{ entry.message }}</span>
                        </div>
                    </div>
                    <div style="margin-top: 16px;">
                        <button class="button secondary" @click="clearLogs">
                            üóëÔ∏è „É≠„Ç∞„ÇØ„É™„Ç¢
                        </button>
                        <button class="button secondary" @click="exportLogs" style="margin-left: 12px;">
                            üìÑ „É≠„Ç∞Âá∫Âäõ
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, nextTick } = Vue

        createApp({
            setup() {
                // „É™„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éá„Éº„Çø
                const detectionStatus = ref({
                    totalItems: 0,
                    totalSize: 0
                })
                
                const migrationProgress = ref(0)
                const privacyLevel = ref('maximum')
                const isDetecting = ref(false)
                const isMigrating = ref(false)
                const currentOperation = ref('')
                
                const detectionResult = ref(null)
                const migrationResult = ref(null)
                const detectedData = ref(null)
                
                const logs = ref([])
                
                // „Çµ„É≥„Éó„É´„Éá„Éº„Çø
                const sampleData = ref({
                    user: {
                        id: 'user_12345',
                        email: 'test@haqei.com',
                        username: 'haqei_user',
                        privacy_level: 'maximum',
                        created_at: new Date().toISOString()
                    },
                    session: {
                        id: 'session_67890',
                        user_id: 'user_12345',
                        session_type: 'triple_os_analysis',
                        completion_status: 'completed',
                        created_at: new Date().toISOString()
                    },
                    responses: [
                        {
                            id: 'response_1',
                            session_id: 'session_67890',
                            question_id: 'q_engine_1',
                            question_text: '„ÅÇ„Å™„Åü„ÅØÊú¨ÂΩì„ÅÆËá™ÂàÜ„ÇíË°®Áèæ„Åß„Åç„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü',
                            response_value: 6,
                            response_time_seconds: 3.2
                        },
                        {
                            id: 'response_2',
                            session_id: 'session_67890',
                            question_id: 'q_interface_1',
                            question_text: '‰ªñËÄÖ„Å®„ÅÆÈñ¢‰øÇ„ÅßËá™ÁÑ∂‰Ωì„Åß„ÅÑ„Çâ„Çå„Åæ„Åô„ÅãÔºü',
                            response_value: 5,
                            response_time_seconds: 4.1
                        },
                        {
                            id: 'response_3',
                            session_id: 'session_67890',
                            question_id: 'q_safe_1',
                            question_text: '„Çπ„Éà„É¨„ÇπÊôÇ„Å´ÂÜ∑Èùô„Åï„Çí‰øù„Å¶„Åæ„Åô„ÅãÔºü',
                            response_value: 4,
                            response_time_seconds: 2.8
                        }
                    ],
                    tripleOS: {
                        engineOS: {
                            id: 'engine_12345',
                            user_id: 'user_12345',
                            hexagram_id: 1,
                            hexagram_name: '‰πæ - The Creative',
                            confidence_score: 0.87,
                            analysis_data: {
                                authenticity_score: 85,
                                primary_trigram: 'Heaven',
                                secondary_trigram: 'Heaven',
                                characteristics: ['ÂâµÈÄ†ÊÄß', 'ÊåáÂ∞éÂäõ', 'Áã¨Á´ãÊÄß']
                            }
                        },
                        interfaceOS: {
                            id: 'interface_12345',
                            user_id: 'user_12345',
                            hexagram_id: 11,
                            hexagram_name: 'Ê≥∞ - Peace',
                            confidence_score: 0.92,
                            analysis_data: {
                                adaptability_score: 78,
                                social_intelligence: 82,
                                characteristics: ['Ë™øÂíåÊÄß', 'ÊüîËªüÊÄß', 'ÂçîË™øÊÄß']
                            }
                        },
                        safeModeOS: {
                            id: 'safe_12345',
                            user_id: 'user_12345',
                            hexagram_id: 52,
                            hexagram_name: 'ËâÆ - Keeping Still',
                            confidence_score: 0.79,
                            analysis_data: {
                                resilience_level: 73,
                                anxiety_management: 68,
                                characteristics: ['ÂÆâÂÆöÊÄß', 'ÂøçËÄêÂäõ', 'ÂÜÖÁúÅÊÄß']
                            }
                        }
                    }
                })

                // Computed
                const canStartMigration = computed(() => {
                    return detectionStatus.value.totalItems > 0 && !isMigrating.value
                })

                // „É°„ÇΩ„ÉÉ„Éâ
                const addLog = (message, level = 'info') => {
                    logs.value.push({
                        id: Date.now() + Math.random(),
                        timestamp: Date.now(),
                        message,
                        level
                    })
                    
                    nextTick(() => {
                        const logArea = document.querySelector('.log-area')
                        if (logArea) {
                            logArea.scrollTop = logArea.scrollHeight
                        }
                    })
                }

                const formatTime = (timestamp) => {
                    return new Date(timestamp).toLocaleTimeString('ja-JP')
                }

                const generateSampleData = () => {
                    addLog('üß™ „Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíÁîüÊàê‰∏≠...', 'info')
                    
                    try {
                        // „É¶„Éº„Ç∂„Éº„Éá„Éº„Çø
                        localStorage.setItem('haqei_user_12345', JSON.stringify(sampleData.value.user))
                        
                        // „Çª„ÉÉ„Ç∑„Éß„É≥„Éá„Éº„Çø
                        localStorage.setItem('haqei_session_67890', JSON.stringify(sampleData.value.session))
                        
                        // ÂõûÁ≠î„Éá„Éº„Çø
                        sampleData.value.responses.forEach((response, index) => {
                            localStorage.setItem(`haqei_response_${response.id}`, JSON.stringify(response))
                        })
                        
                        // Triple OS„Éá„Éº„Çø
                        Object.entries(sampleData.value.tripleOS).forEach(([osType, osData]) => {
                            localStorage.setItem(`haqei_triple_os_${osType}_12345`, JSON.stringify(osData))
                        })
                        
                        // ÂàÜÊûêÁµêÊûú„Éá„Éº„Çø
                        const analysisResult = {
                            id: 'analysis_12345',
                            session_id: 'session_67890',
                            user_id: 'user_12345',
                            analysis_data: {
                                timestamp: Date.now(),
                                dimensionScores: {
                                    authenticity: 85,
                                    adaptability: 78,
                                    resilience: 73
                                },
                                totalScore: 236,
                                averageScore: 78.7,
                                confidence: 0.86
                            },
                            triple_os_data: sampleData.value.tripleOS,
                            created_at: new Date().toISOString()
                        }
                        localStorage.setItem('haqei_analysis_12345', JSON.stringify(analysisResult))
                        
                        addLog('‚úÖ „Çµ„É≥„Éó„É´„Éá„Éº„ÇøÁîüÊàêÂÆå‰∫ÜÔºà15„Ç¢„Ç§„ÉÜ„É†Ôºâ', 'success')
                        updateDetectionStatus()
                        
                    } catch (error) {
                        addLog(`‚ùå „Çµ„É≥„Éó„É´„Éá„Éº„ÇøÁîüÊàê„Ç®„É©„Éº: ${error.message}`, 'error')
                    }
                }

                const clearLocalStorage = () => {
                    addLog('üóëÔ∏è localStorage„Çí„ÇØ„É™„Ç¢‰∏≠...', 'info')
                    
                    const keysToRemove = []
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i)
                        if (key && key.startsWith('haqei_')) {
                            keysToRemove.push(key)
                        }
                    }
                    
                    keysToRemove.forEach(key => localStorage.removeItem(key))
                    
                    addLog(`‚úÖ ${keysToRemove.length}ÂÄã„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`, 'success')
                    updateDetectionStatus()
                    
                    detectionResult.value = null
                    migrationResult.value = null
                    detectedData.value = null
                }

                const updateDetectionStatus = () => {
                    let totalItems = 0
                    let totalSize = 0
                    
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i)
                        if (key && key.startsWith('haqei_')) {
                            totalItems++
                            const value = localStorage.getItem(key)
                            if (value) {
                                totalSize += value.length
                            }
                        }
                    }
                    
                    detectionStatus.value = { totalItems, totalSize }
                }

                const detectData = async () => {
                    if (isDetecting.value) return
                    
                    isDetecting.value = true
                    addLog('üîç localStorage„Éá„Éº„ÇøÊ§úÂá∫„ÇíÈñãÂßã...', 'info')
                    
                    try {
                        // Ê§úÂá∫Âá¶ÁêÜ„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥
                        await new Promise(resolve => setTimeout(resolve, 1000))
                        
                        const mockDetectedData = {
                            totalItems: detectionStatus.value.totalItems,
                            totalSizeBytes: detectionStatus.value.totalSize,
                            dataByType: {
                                user: [],
                                session: [],
                                response: [],
                                analysis: [],
                                triple_os: [],
                                settings: []
                            },
                            estimatedMigrationTime: 0,
                            privacyRisk: 'low',
                            compatibilityCheck: {
                                isCompatible: true,
                                issues: [],
                                recommendations: []
                            }
                        }
                        
                        // localStorage„Çí„Çπ„Ç≠„É£„É≥
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i)
                            if (!key || !key.startsWith('haqei_')) continue
                            
                            const value = localStorage.getItem(key)
                            if (!value) continue
                            
                            const dataType = determineDataType(key)
                            const item = {
                                key,
                                value: JSON.parse(value),
                                timestamp: Date.now(),
                                dataType,
                                size: value.length
                            }
                            
                            mockDetectedData.dataByType[dataType].push(item)
                        }
                        
                        mockDetectedData.estimatedMigrationTime = Math.ceil(mockDetectedData.totalItems * 0.5)
                        
                        detectedData.value = mockDetectedData
                        detectionResult.value = {
                            success: true,
                            message: `${mockDetectedData.totalItems}ÂÄã„ÅÆ„Éá„Éº„Çø„Ç¢„Ç§„ÉÜ„É†„ÇíÊ§úÂá∫„Åó„Åæ„Åó„Åü`
                        }
                        
                        addLog(`‚úÖ „Éá„Éº„ÇøÊ§úÂá∫ÂÆå‰∫Ü: ${mockDetectedData.totalItems}„Ç¢„Ç§„ÉÜ„É†`, 'success')
                        
                    } catch (error) {
                        detectionResult.value = {
                            success: false,
                            message: `Ê§úÂá∫„Ç®„É©„Éº: ${error.message}`
                        }
                        addLog(`‚ùå „Éá„Éº„ÇøÊ§úÂá∫„Ç®„É©„Éº: ${error.message}`, 'error')
                    } finally {
                        isDetecting.value = false
                    }
                }

                const determineDataType = (key) => {
                    const keyLower = key.toLowerCase()
                    
                    if (keyLower.includes('user')) return 'user'
                    if (keyLower.includes('session')) return 'session'
                    if (keyLower.includes('response')) return 'response'
                    if (keyLower.includes('analysis')) return 'analysis'
                    if (keyLower.includes('triple') || keyLower.includes('os')) return 'triple_os'
                    return 'settings'
                }

                const getDataTypeName = (type) => {
                    const names = {
                        user: '„É¶„Éº„Ç∂„Éº„Éá„Éº„Çø',
                        session: '„Çª„ÉÉ„Ç∑„Éß„É≥„Éá„Éº„Çø',
                        response: 'ÂõûÁ≠î„Éá„Éº„Çø',
                        analysis: 'ÂàÜÊûêÁµêÊûú',
                        triple_os: 'Triple OS',
                        settings: 'Ë®≠ÂÆö„Éá„Éº„Çø'
                    }
                    return names[type] || type
                }

                const startMigration = async () => {
                    if (!canStartMigration.value || isMigrating.value) return
                    
                    isMigrating.value = true
                    migrationProgress.value = 0
                    currentOperation.value = 'ÁßªË°åÊ∫ñÂÇô‰∏≠...'
                    
                    addLog('üöÄ „Éá„Éº„ÇøÁßªË°å„ÇíÈñãÂßã„Åó„Åæ„ÅôÔºà„ÉÜ„Çπ„Éà„É¢„Éº„ÉâÔºâ', 'info')
                    
                    try {
                        const totalItems = detectionStatus.value.totalItems
                        const phases = [
                            { name: '„Éá„Éº„ÇøÊ§úË®º‰∏≠...', duration: 1000, progress: 15 },
                            { name: '„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó‰ΩúÊàê‰∏≠...', duration: 800, progress: 30 },
                            { name: '„É¶„Éº„Ç∂„Éº„Éá„Éº„ÇøÁßªË°å‰∏≠...', duration: 1200, progress: 50 },
                            { name: '„Çª„ÉÉ„Ç∑„Éß„É≥„Éá„Éº„ÇøÁßªË°å‰∏≠...', duration: 1000, progress: 65 },
                            { name: 'ÂõûÁ≠î„Éá„Éº„ÇøÁßªË°å‰∏≠...', duration: 1500, progress: 80 },
                            { name: 'Triple OS„Éá„Éº„ÇøÁßªË°å‰∏≠...', duration: 1200, progress: 95 },
                            { name: 'ÁßªË°åÂÆå‰∫ÜÁ¢∫Ë™ç‰∏≠...', duration: 500, progress: 100 }
                        ]
                        
                        for (const phase of phases) {
                            currentOperation.value = phase.name
                            addLog(`üìù ${phase.name}`, 'info')
                            
                            await new Promise(resolve => setTimeout(resolve, phase.duration))
                            migrationProgress.value = phase.progress
                        }
                        
                        migrationResult.value = {
                            success: true,
                            message: `${totalItems}ÂÄã„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÅÆÁßªË°å„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü`
                        }
                        
                        addLog('‚úÖ „Éá„Éº„ÇøÁßªË°å„ÅåÊ≠£Â∏∏„Å´ÂÆå‰∫Ü„Åó„Åæ„Åó„Åü', 'success')
                        addLog(`üìä ÁßªË°åÁµ±Ë®à: ${totalItems}„Ç¢„Ç§„ÉÜ„É†„ÄÅ${Math.round(detectionStatus.value.totalSize / 1024)}KB`, 'success')
                        
                    } catch (error) {
                        migrationResult.value = {
                            success: false,
                            message: `ÁßªË°å„Ç®„É©„Éº: ${error.message}`
                        }
                        addLog(`‚ùå ÁßªË°å„Ç®„É©„Éº: ${error.message}`, 'error')
                    } finally {
                        isMigrating.value = false
                        currentOperation.value = ''
                    }
                }

                const cancelMigration = () => {
                    if (!isMigrating.value) return
                    
                    isMigrating.value = false
                    migrationProgress.value = 0
                    currentOperation.value = ''
                    
                    migrationResult.value = {
                        success: false,
                        message: '„É¶„Éº„Ç∂„Éº„Å´„Çà„Å£„Å¶ÁßªË°å„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü'
                    }
                    
                    addLog('‚èπÔ∏è ÁßªË°å„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü', 'warning')
                }

                const clearLogs = () => {
                    logs.value = []
                    addLog('üóëÔ∏è „É≠„Ç∞„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü', 'info')
                }

                const exportLogs = () => {
                    const logText = logs.value.map(entry => 
                        `[${formatTime(entry.timestamp)}] ${entry.level.toUpperCase()}: ${entry.message}`
                    ).join('\n')
                    
                    const blob = new Blob([logText], { type: 'text/plain' })
                    const url = URL.createObjectURL(blob)
                    const a = document.createElement('a')
                    a.href = url
                    a.download = `haqei-migration-log-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`
                    document.body.appendChild(a)
                    a.click()
                    document.body.removeChild(a)
                    URL.revokeObjectURL(url)
                    
                    addLog('üìÑ „É≠„Ç∞„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü', 'success')
                }

                // „É©„Ç§„Éï„Çµ„Ç§„ÇØ„É´
                onMounted(() => {
                    addLog('üöÄ HAQEI Migration Test System ÂàùÊúüÂåñÂÆå‰∫Ü', 'success')
                    addLog('üìã TASK-038: localStorage„Åã„ÇâSupabase„Éá„Éº„ÇøÁßªË°å„Ç∑„Çπ„ÉÜ„É†', 'info')
                    addLog('üîí bunenjinÂì≤Â≠¶Ê∫ñÊã†„ÅÆ„Éó„É©„Ç§„Éê„Ç∑„Éº‰øùË≠∑ÁßªË°å', 'info')
                    addLog('üéØ Triple OS ArchitectureÂÆåÂÖ®ÂØæÂøú', 'info')
                    updateDetectionStatus()
                })

                return {
                    // „Éá„Éº„Çø
                    detectionStatus,
                    migrationProgress,
                    privacyLevel,
                    isDetecting,
                    isMigrating,
                    currentOperation,
                    detectionResult,
                    migrationResult,
                    detectedData,
                    logs,
                    sampleData,
                    
                    // Computed
                    canStartMigration,
                    
                    // „É°„ÇΩ„ÉÉ„Éâ
                    generateSampleData,
                    clearLocalStorage,
                    detectData,
                    startMigration,
                    cancelMigration,
                    clearLogs,
                    exportLogs,
                    formatTime,
                    getDataTypeName,
                    
                    // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£
                    Math
                }
            }
        }).mount('#app')
    </script>
</body>
</html>