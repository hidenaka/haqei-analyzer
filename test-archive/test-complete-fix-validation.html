<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œå…¨ä¿®æ­£æ¤œè¨¼ - HaQei OS Analyzer</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            margin: 0;
            padding: 20px;
            color: #fff;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            color: #333;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #2a5298;
            margin-bottom: 30px;
            font-size: 32px;
        }
        .test-group {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }
        .test-title {
            font-size: 20px;
            font-weight: bold;
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            background: #6c757d;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-pending { background: #6c757d; }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
        }
        .test-button:hover {
            transform: translateY(-2px);
        }
        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .result-box {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success-msg {
            color: #28a745;
            font-weight: bold;
        }
        .error-msg {
            color: #dc3545;
            font-weight: bold;
        }
        .warning-msg {
            color: #ffc107;
            font-weight: bold;
        }
        .info-msg {
            color: #17a2b8;
            font-weight: bold;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
        }
        th {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .summary-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        .summary-title {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .summary-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-value {
            font-size: 36px;
            font-weight: bold;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ HaQei OS Analyzer å®Œå…¨ä¿®æ­£æ¤œè¨¼</h1>
        
        <div class="summary-box">
            <div class="summary-title">ä¿®æ­£çŠ¶æ³ã‚µãƒãƒªãƒ¼</div>
            <div class="summary-stats">
                <div class="stat-item">
                    <div class="stat-value" id="total-fixes">0</div>
                    <div class="stat-label">ç·ä¿®æ­£é …ç›®</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="completed-fixes">0</div>
                    <div class="stat-label">å®Œäº†é …ç›®</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="test-passed">0</div>
                    <div class="stat-label">ãƒ†ã‚¹ãƒˆåˆæ ¼</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="test-failed">0</div>
                    <div class="stat-label">ãƒ†ã‚¹ãƒˆå¤±æ•—</div>
                </div>
            </div>
        </div>

        <div class="test-group">
            <div class="test-title">
                <span class="status-indicator" id="test1-status"></span>
                ãƒ†ã‚¹ãƒˆ1: separateAnswers è³ªå•åˆ†é›¢ãƒ­ã‚¸ãƒƒã‚¯
            </div>
            <button class="test-button" onclick="testSeparateAnswers()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="result-box" id="test1-result">
                ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...
            </div>
        </div>

        <div class="test-group">
            <div class="test-title">
                <span class="status-indicator" id="test2-status"></span>
                ãƒ†ã‚¹ãƒˆ2: Interface OS è³ªå•å‡¦ç† (Q13-Q24)
            </div>
            <button class="test-button" onclick="testInterfaceProcessing()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="result-box" id="test2-result">
                ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...
            </div>
        </div>

        <div class="test-group">
            <div class="test-title">
                <span class="status-indicator" id="test3-status"></span>
                ãƒ†ã‚¹ãƒˆ3: Safe Mode OS è³ªå•å‡¦ç† (Q25-Q36)
            </div>
            <button class="test-button" onclick="testSafeModeProcessing()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="result-box" id="test3-result">
                ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...
            </div>
        </div>

        <div class="test-group">
            <div class="test-title">
                <span class="status-indicator" id="test4-status"></span>
                ãƒ†ã‚¹ãƒˆ4: å…¨OSçµ±åˆå‹•ä½œãƒ†ã‚¹ãƒˆ
            </div>
            <button class="test-button" onclick="testFullIntegration()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="result-box" id="test4-result">
                ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...
            </div>
        </div>

        <div class="test-group">
            <div class="test-title">
                <span class="status-indicator" id="test5-status"></span>
                ãƒ†ã‚¹ãƒˆ5: ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ•´åˆæ€§ç¢ºèª
            </div>
            <button class="test-button" onclick="testDataFlowIntegrity()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="result-box" id="test5-result">
                ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...
            </div>
        </div>

        <div class="test-group">
            <div class="test-title">
                <span class="status-indicator" id="test-all-status"></span>
                çµ±åˆãƒ†ã‚¹ãƒˆ: å…¨ãƒ†ã‚¹ãƒˆä¸€æ‹¬å®Ÿè¡Œ
            </div>
            <button class="test-button" onclick="runAllTests()">å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="result-box" id="test-all-result">
                å…¨ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...
            </div>
        </div>
    </div>

    <iframe id="analyzer-frame" src="os_analyzer.html" style="display:none;"></iframe>

    <script>
        let analyzer = null;
        let testResults = {
            total: 7,
            completed: 0,
            passed: 0,
            failed: 0
        };

        // iframeèª­ã¿è¾¼ã¿å®Œäº†å¾Œã«analyzerã‚’å–å¾—
        document.getElementById('analyzer-frame').onload = function() {
            const iframe = document.getElementById('analyzer-frame');
            const iframeWindow = iframe.contentWindow;
            if (iframeWindow.window.osAnalyzer) {
                analyzer = iframeWindow.window.osAnalyzer;
                console.log('âœ… OS Analyzer loaded successfully');
                updateSummary();
            }
        };

        function updateSummary() {
            document.getElementById('total-fixes').textContent = testResults.total;
            document.getElementById('completed-fixes').textContent = testResults.completed;
            document.getElementById('test-passed').textContent = testResults.passed;
            document.getElementById('test-failed').textContent = testResults.failed;
        }

        function setTestStatus(testId, status) {
            const statusElement = document.getElementById(`${testId}-status`);
            statusElement.className = `status-indicator status-${status}`;
        }

        // ãƒ†ã‚¹ãƒˆ1: separateAnswers
        function testSeparateAnswers() {
            const resultDiv = document.getElementById('test1-result');
            setTestStatus('test1', 'pending');
            
            try {
                // æ¨¡æ“¬å›ç­”ãƒ‡ãƒ¼ã‚¿ä½œæˆï¼ˆå…¨36å•ï¼‰
                const mockAnswers = [];
                for (let i = 1; i <= 36; i++) {
                    mockAnswers.push({
                        questionId: `q${i}`,
                        value: 'A'
                    });
                }
                
                // separateAnswersã‚’å®Ÿè¡Œ
                const separated = analyzer.separateAnswers(mockAnswers);
                
                let html = '<span class="info-msg">ğŸ“Š separateAnswers å®Ÿè¡Œçµæœ:</span>\n\n';
                
                // è³ªå•æ•°ãƒã‚§ãƒƒã‚¯
                const engineCount = separated.worldviewAnswers.length;
                const interfaceCount = separated.scenarioAnswers.length;
                const safeModeCount = separated.defenseAnswers.length;
                
                html += `Engine OS: ${engineCount}å• (æœŸå¾…å€¤: 12å•) `;
                html += engineCount === 12 ? '<span class="success-msg">âœ…</span>\n' : '<span class="error-msg">âŒ</span>\n';
                
                html += `Interface OS: ${interfaceCount}å• (æœŸå¾…å€¤: 12å•) `;
                html += interfaceCount === 12 ? '<span class="success-msg">âœ…</span>\n' : '<span class="error-msg">âŒ</span>\n';
                
                html += `Safe Mode OS: ${safeModeCount}å• (æœŸå¾…å€¤: 12å•) `;
                html += safeModeCount === 12 ? '<span class="success-msg">âœ…</span>\n' : '<span class="error-msg">âŒ</span>\n';
                
                // è³ªå•ç•ªå·ç¯„å›²ãƒã‚§ãƒƒã‚¯
                html += '\n<span class="info-msg">è³ªå•ç•ªå·ç¯„å›²ãƒã‚§ãƒƒã‚¯:</span>\n';
                
                const engineFirst = separated.worldviewAnswers[0]?.questionId;
                const engineLast = separated.worldviewAnswers[11]?.questionId;
                html += `Engine: ${engineFirst} - ${engineLast} `;
                html += (engineFirst === 'q1' && engineLast === 'q12') ? '<span class="success-msg">âœ…</span>\n' : '<span class="error-msg">âŒ</span>\n';
                
                const interfaceFirst = separated.scenarioAnswers[0]?.questionId;
                const interfaceLast = separated.scenarioAnswers[11]?.questionId;
                html += `Interface: ${interfaceFirst} - ${interfaceLast} `;
                html += (interfaceFirst === 'q13' && interfaceLast === 'q24') ? '<span class="success-msg">âœ…</span>\n' : '<span class="error-msg">âŒ</span>\n';
                
                const safeModeFirst = separated.defenseAnswers[0]?.questionId;
                const safeModeLast = separated.defenseAnswers[11]?.questionId;
                html += `SafeMode: ${safeModeFirst} - ${safeModeLast} `;
                html += (safeModeFirst === 'q25' && safeModeLast === 'q36') ? '<span class="success-msg">âœ…</span>\n' : '<span class="error-msg">âŒ</span>\n';
                
                resultDiv.innerHTML = html;
                
                // ãƒ†ã‚¹ãƒˆçµæœåˆ¤å®š
                if (engineCount === 12 && interfaceCount === 12 && safeModeCount === 12 &&
                    engineFirst === 'q1' && engineLast === 'q12' &&
                    interfaceFirst === 'q13' && interfaceLast === 'q24' &&
                    safeModeFirst === 'q25' && safeModeLast === 'q36') {
                    setTestStatus('test1', 'success');
                    testResults.passed++;
                } else {
                    setTestStatus('test1', 'error');
                    testResults.failed++;
                }
                testResults.completed++;
                updateSummary();
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error-msg">ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                setTestStatus('test1', 'error');
                testResults.failed++;
                testResults.completed++;
                updateSummary();
            }
        }

        // ãƒ†ã‚¹ãƒˆ2: Interface OSå‡¦ç†
        function testInterfaceProcessing() {
            const resultDiv = document.getElementById('test2-result');
            setTestStatus('test2', 'pending');
            
            try {
                // analyzeSocialPatternsã®ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
                const analyzeCode = analyzer.analyzeSocialPatterns.toString();
                
                let html = '<span class="info-msg">ğŸ“Š Interface OS è³ªå•å‡¦ç†ãƒã‚§ãƒƒã‚¯:</span>\n\n';
                
                // Q13-Q24ã®å‚ç…§ç¢ºèª
                const hasQ13 = analyzeCode.includes('Q13');
                const hasQ24 = analyzeCode.includes('Q24');
                const hasQ25 = analyzeCode.includes('Q25');
                const hasQ30 = analyzeCode.includes('Q30');
                
                html += 'analyzeSocialPatterns ãƒ¡ã‚½ãƒƒãƒ‰:\n';
                html += `  Q13-Q24 å‚ç…§: ${hasQ13 && hasQ24 ? 'âœ…' : 'âŒ'}\n`;
                html += `  Q25-Q30 å‚ç…§: ${!hasQ25 && !hasQ30 ? 'âœ… é™¤å»æ¸ˆã¿' : 'âŒ ã¾ã æ®‹å­˜'}\n`;
                
                // buildInterfaceVectorã®ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
                const vectorCode = analyzer.buildInterfaceVector.toString();
                const vectorHasQ13 = vectorCode.includes('Q13');
                const vectorHasQ24 = vectorCode.includes('Q24_adaptation');
                
                html += '\nbuildInterfaceVector ãƒ¡ã‚½ãƒƒãƒ‰:\n';
                html += `  Q13-Q24 ãƒ‘ã‚¿ãƒ¼ãƒ³ä½¿ç”¨: ${vectorHasQ13 && vectorHasQ24 ? 'âœ…' : 'âŒ'}\n`;
                
                // å®Ÿéš›ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆãƒ†ã‚¹ãƒˆ
                const testAnswers = Array(12).fill({ selectedOption: { value: 'A' }});
                const patterns = analyzer.analyzeSocialPatterns(testAnswers);
                
                html += '\n<span class="info-msg">ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆãƒ†ã‚¹ãƒˆ (12å•):</span>\n';
                const patternKeys = Object.keys(patterns);
                html += `  ç”Ÿæˆã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³æ•°: ${patternKeys.length}\n`;
                html += `  Q19-Q24 ãƒ‘ã‚¿ãƒ¼ãƒ³å­˜åœ¨: ${patterns.Q24_adaptation !== undefined ? 'âœ…' : 'âŒ'}\n`;
                
                resultDiv.innerHTML = html;
                
                // ãƒ†ã‚¹ãƒˆçµæœåˆ¤å®š
                if (hasQ13 && hasQ24 && !hasQ25 && !hasQ30 && 
                    vectorHasQ13 && vectorHasQ24 && 
                    patternKeys.length === 12 && patterns.Q24_adaptation !== undefined) {
                    setTestStatus('test2', 'success');
                    testResults.passed++;
                } else {
                    setTestStatus('test2', 'error');
                    testResults.failed++;
                }
                testResults.completed++;
                updateSummary();
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error-msg">ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                setTestStatus('test2', 'error');
                testResults.failed++;
                testResults.completed++;
                updateSummary();
            }
        }

        // ãƒ†ã‚¹ãƒˆ3: Safe Mode OSå‡¦ç†
        function testSafeModeProcessing() {
            const resultDiv = document.getElementById('test3-result');
            setTestStatus('test3', 'pending');
            
            try {
                // extractDefensivePatternsã®ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
                const extractCode = analyzer.extractDefensivePatterns.toString();
                
                let html = '<span class="info-msg">ğŸ“Š Safe Mode OS è³ªå•å‡¦ç†ãƒã‚§ãƒƒã‚¯:</span>\n\n';
                
                // Q25-Q36ã®å‚ç…§ç¢ºèª
                const hasQ25 = extractCode.includes('Q25');
                const hasQ36 = extractCode.includes('Q36');
                const hasDefenseAnswers = extractCode.includes('defenseAnswers');
                
                html += 'extractDefensivePatterns ãƒ¡ã‚½ãƒƒãƒ‰:\n';
                html += `  å¼•æ•°å: ${hasDefenseAnswers ? 'âœ… defenseAnswers' : 'âŒ scenarioAnswers'}\n`;
                html += `  Q25-Q36 å‚ç…§: ${hasQ25 && hasQ36 ? 'âœ…' : 'âŒ'}\n`;
                
                // analyzeSafeModeOSã®å¼•æ•°ãƒã‚§ãƒƒã‚¯
                const analyzeCode = analyzer.analyzeSafeModeOS.toString();
                const hasCorrectParam = analyzeCode.includes('defenseAnswers');
                
                html += '\nanalyzeSafeModeOS ãƒ¡ã‚½ãƒƒãƒ‰:\n';
                html += `  å¼•æ•°å: ${hasCorrectParam ? 'âœ… defenseAnswers' : 'âŒ scenarioAnswers'}\n`;
                
                // å®Ÿéš›ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆãƒ†ã‚¹ãƒˆ
                const testAnswers = Array(12).fill({ 
                    selectedOption: { value: 'A' },
                    intensity: 0.8,
                    pattern: 'å¯¾æŠ—'
                });
                const patterns = analyzer.extractDefensivePatterns(testAnswers);
                
                html += '\n<span class="info-msg">ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆãƒ†ã‚¹ãƒˆ (12å•):</span>\n';
                const patternKeys = Object.keys(patterns);
                html += `  ç”Ÿæˆã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³æ•°: ${patternKeys.length}\n`;
                html += `  Q31-Q36 ãƒ‘ã‚¿ãƒ¼ãƒ³å­˜åœ¨: ${patterns.Q36_resourceStress !== undefined ? 'âœ…' : 'âŒ'}\n`;
                
                resultDiv.innerHTML = html;
                
                // ãƒ†ã‚¹ãƒˆçµæœåˆ¤å®š
                if (hasDefenseAnswers && hasCorrectParam && hasQ25 && hasQ36 &&
                    patternKeys.length === 12 && patterns.Q36_resourceStress !== undefined) {
                    setTestStatus('test3', 'success');
                    testResults.passed++;
                } else {
                    setTestStatus('test3', 'error');
                    testResults.failed++;
                }
                testResults.completed++;
                updateSummary();
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error-msg">ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                setTestStatus('test3', 'error');
                testResults.failed++;
                testResults.completed++;
                updateSummary();
            }
        }

        // ãƒ†ã‚¹ãƒˆ4: å…¨OSçµ±åˆå‹•ä½œ
        async function testFullIntegration() {
            const resultDiv = document.getElementById('test4-result');
            setTestStatus('test4', 'pending');
            
            try {
                let html = '<span class="info-msg">ğŸ“Š å…¨OSçµ±åˆå‹•ä½œãƒ†ã‚¹ãƒˆ:</span>\n\n';
                
                // 36å•ã®æ¨¡æ“¬å›ç­”ä½œæˆ
                const mockAnswers = [];
                for (let i = 1; i <= 36; i++) {
                    mockAnswers.push({
                        questionId: `q${i}`,
                        selectedOption: { value: 'A' }
                    });
                }
                
                // è³ªå•åˆ†é›¢
                const separated = analyzer.separateAnswers(mockAnswers);
                
                html += '1. è³ªå•åˆ†é›¢:\n';
                html += `   Engine: ${separated.worldviewAnswers.length}å•\n`;
                html += `   Interface: ${separated.scenarioAnswers.length}å•\n`;
                html += `   SafeMode: ${separated.defenseAnswers.length}å•\n\n`;
                
                // Engine OSåˆ†æ
                const engineOS = await analyzer.analyzeEngineOS(separated.worldviewAnswers);
                html += '2. Engine OS:\n';
                html += `   å¦: ${engineOS.hexagramName || 'N/A'} (#${engineOS.hexagramId || 'N/A'})\n`;
                html += `   è¨ˆç®—æˆåŠŸ: ${engineOS.hexagramId ? 'âœ…' : 'âŒ'}\n\n`;
                
                // Interface OSåˆ†æ
                const interfaceOS = await analyzer.analyzeInterfaceOS(separated.scenarioAnswers, engineOS);
                html += '3. Interface OS:\n';
                html += `   å¦: ${interfaceOS.hexagramName || 'N/A'} (#${interfaceOS.hexagramId || 'N/A'})\n`;
                html += `   è¨ˆç®—æˆåŠŸ: ${interfaceOS.hexagramId ? 'âœ…' : 'âŒ'}\n\n`;
                
                // Safe Mode OSåˆ†æ
                const safeModeOS = await analyzer.analyzeSafeModeOS(separated.defenseAnswers, engineOS);
                html += '4. Safe Mode OS:\n';
                html += `   å¦: ${safeModeOS.hexagramName || 'N/A'} (#${safeModeOS.hexagramId || 'N/A'})\n`;
                html += `   è¨ˆç®—æˆåŠŸ: ${safeModeOS.hexagramId ? 'âœ…' : 'âŒ'}\n\n`;
                
                html += '<span class="info-msg">ç·åˆåˆ¤å®š:</span>\n';
                const allSuccess = engineOS.hexagramId && interfaceOS.hexagramId && safeModeOS.hexagramId;
                html += allSuccess ? '<span class="success-msg">âœ… å…¨OSæ­£å¸¸å‹•ä½œ</span>' : '<span class="error-msg">âŒ ä¸€éƒ¨OSã§å•é¡Œç™ºç”Ÿ</span>';
                
                resultDiv.innerHTML = html;
                
                // ãƒ†ã‚¹ãƒˆçµæœåˆ¤å®š
                if (allSuccess) {
                    setTestStatus('test4', 'success');
                    testResults.passed++;
                } else {
                    setTestStatus('test4', 'error');
                    testResults.failed++;
                }
                testResults.completed++;
                updateSummary();
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error-msg">ã‚¨ãƒ©ãƒ¼: ${error.message}\n${error.stack}</span>`;
                setTestStatus('test4', 'error');
                testResults.failed++;
                testResults.completed++;
                updateSummary();
            }
        }

        // ãƒ†ã‚¹ãƒˆ5: ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ•´åˆæ€§
        function testDataFlowIntegrity() {
            const resultDiv = document.getElementById('test5-result');
            setTestStatus('test5', 'pending');
            
            try {
                let html = '<span class="info-msg">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ•´åˆæ€§ç¢ºèª:</span>\n\n';
                
                // Q13-Q24ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
                const interfaceAnswers = [];
                for (let i = 13; i <= 24; i++) {
                    interfaceAnswers.push({
                        questionId: `q${i}`,
                        selectedOption: { value: 'B' }
                    });
                }
                
                // analyzeSocialPatternså®Ÿè¡Œ
                const patterns = analyzer.analyzeSocialPatterns(interfaceAnswers);
                
                html += '1. Interface OS ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ:\n';
                let allPatternsValid = true;
                for (let i = 13; i <= 24; i++) {
                    const key = `Q${i}_${getPatternName(i)}`;
                    const hasPattern = patterns[key] !== undefined;
                    html += `   ${key}: ${hasPattern ? 'âœ…' : 'âŒ'}\n`;
                    if (!hasPattern) allPatternsValid = false;
                }
                
                // buildInterfaceVectorå®Ÿè¡Œ
                const vector = analyzer.buildInterfaceVector(patterns);
                
                html += '\n2. Interface ãƒ™ã‚¯ãƒˆãƒ«æ§‹ç¯‰:\n';
                let allVectorValid = true;
                Object.entries(vector).forEach(([key, value]) => {
                    const isValid = !isNaN(value) && value !== undefined;
                    html += `   ${key}: ${value.toFixed(2)} ${isValid ? 'âœ…' : 'âŒ'}\n`;
                    if (!isValid) allVectorValid = false;
                });
                
                html += '\n<span class="info-msg">ç·åˆåˆ¤å®š:</span>\n';
                const allSuccess = allPatternsValid && allVectorValid;
                html += allSuccess ? '<span class="success-msg">âœ… ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ­£å¸¸</span>' : '<span class="error-msg">âŒ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ç•°å¸¸</span>';
                
                resultDiv.innerHTML = html;
                
                // ãƒ†ã‚¹ãƒˆçµæœåˆ¤å®š
                if (allSuccess) {
                    setTestStatus('test5', 'success');
                    testResults.passed++;
                } else {
                    setTestStatus('test5', 'error');
                    testResults.failed++;
                }
                testResults.completed++;
                updateSummary();
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error-msg">ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                setTestStatus('test5', 'error');
                testResults.failed++;
                testResults.completed++;
                updateSummary();
            }
        }

        function getPatternName(questionNum) {
            const patterns = {
                13: 'leadership',
                14: 'interpersonal',
                15: 'family',
                16: 'emergency',
                17: 'competition',
                18: 'community',
                19: 'social',
                20: 'conflict',
                21: 'trust',
                22: 'expression',
                23: 'cooperation',
                24: 'adaptation'
            };
            return patterns[questionNum] || 'unknown';
        }

        // å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runAllTests() {
            const resultDiv = document.getElementById('test-all-result');
            setTestStatus('test-all', 'pending');
            
            // ãƒªã‚»ãƒƒãƒˆ
            testResults.completed = 0;
            testResults.passed = 0;
            testResults.failed = 0;
            
            resultDiv.innerHTML = '<span class="info-msg">å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</span>\n\n';
            
            // å„ãƒ†ã‚¹ãƒˆã‚’é †ç•ªã«å®Ÿè¡Œ
            await new Promise(resolve => setTimeout(resolve, 100));
            testSeparateAnswers();
            
            await new Promise(resolve => setTimeout(resolve, 500));
            testInterfaceProcessing();
            
            await new Promise(resolve => setTimeout(resolve, 500));
            testSafeModeProcessing();
            
            await new Promise(resolve => setTimeout(resolve, 500));
            await testFullIntegration();
            
            await new Promise(resolve => setTimeout(resolve, 500));
            testDataFlowIntegrity();
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // çµæœé›†è¨ˆ
            let html = '<span class="info-msg">ğŸ“Š å…¨ãƒ†ã‚¹ãƒˆå®Œäº†:</span>\n\n';
            html += `å®Ÿè¡Œãƒ†ã‚¹ãƒˆæ•°: ${testResults.completed}\n`;
            html += `åˆæ ¼: ${testResults.passed}\n`;
            html += `å¤±æ•—: ${testResults.failed}\n`;
            html += `æˆåŠŸç‡: ${(testResults.passed / testResults.completed * 100).toFixed(1)}%\n\n`;
            
            if (testResults.failed === 0) {
                html += '<span class="success-msg">ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼ï¼ä¿®æ­£ã¯å®Œå…¨ã«æˆåŠŸã—ã¾ã—ãŸã€‚</span>';
                setTestStatus('test-all', 'success');
            } else {
                html += '<span class="error-msg">âš ï¸ ä¸€éƒ¨ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã€‚è¿½åŠ ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚</span>';
                setTestStatus('test-all', 'error');
            }
            
            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html>