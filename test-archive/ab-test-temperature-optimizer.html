<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaQei A/B„ÉÜ„Çπ„Éà - Ê∏©Â∫¶„Éë„É©„É°„Éº„ÇøÊúÄÈÅ©Âåñ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
        }
        
        .control-panel {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .variant-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            transition: all 0.3s;
        }
        
        .variant-card.active {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .variant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .variant-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2d3748;
        }
        
        .variant-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            background: #edf2f7;
            color: #4a5568;
        }
        
        .temperature-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }
        
        .test-results {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metric-row:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #718096;
            font-size: 0.95em;
        }
        
        .metric-value {
            font-weight: 600;
            color: #2d3748;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s;
        }
        
        .distribution-chart {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        
        .hexagram-distribution {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            margin: 10px 0;
        }
        
        .hexagram-cell {
            aspect-ratio: 1;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            color: #4a5568;
            border-radius: 2px;
            position: relative;
        }
        
        .hexagram-cell.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .comparison-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid #e2e8f0;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .comparison-card {
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
        }
        
        .comparison-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .winner {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }
        
        .statistical-section {
            background: #fef5e7;
            border-left: 4px solid #f39c12;
            padding: 20px;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .statistical-title {
            color: #d68910;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .p-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #c53030;
        }
        
        .recommendation-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: center;
        }
        
        .recommendation-title {
            font-size: 1.3em;
            margin-bottom: 10px;
        }
        
        .recommendation-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 15px 0;
        }
        
        #realTimeChart {
            max-height: 300px;
            margin: 20px 0;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>üî¨ A/B„ÉÜ„Çπ„Éà: SoftmaxÊ∏©Â∫¶„Éë„É©„É°„Éº„ÇøÊúÄÈÅ©Âåñ</h1>
        <p class="subtitle">ÊúÄÈÅ©„Å™Ê≠£Ë¶èÂåñÊ∏©Â∫¶„ÇíÁßëÂ≠¶ÁöÑ„Å´Ê±∫ÂÆö</p>
        
        <div class="control-panel">
            <button onclick="startABTest()">üöÄ A/B„ÉÜ„Çπ„ÉàÈñãÂßã</button>
            <button onclick="runBatchTest()">‚ö° „Éê„ÉÉ„ÉÅ„ÉÜ„Çπ„Éà (1000‰ª∂)</button>
            <button onclick="showStatisticalAnalysis()">üìä Áµ±Ë®àÂàÜÊûê</button>
            <button onclick="exportResults()">üíæ ÁµêÊûú„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
            <button onclick="resetTest()">üîÑ „É™„Çª„ÉÉ„Éà</button>
        </div>
        
        <div class="test-grid">
            <!-- Variant A: œÑ = 1.0 (Sharp) -->
            <div class="variant-card" id="variant-a">
                <div class="variant-header">
                    <span class="variant-title">Variant A (Sharp)</span>
                    <span class="variant-badge">„Ç≥„É≥„Éà„É≠„Éº„É´</span>
                </div>
                <div class="temperature-display">œÑ = 1.0</div>
                <div class="test-results">
                    <div class="metric-row">
                        <span class="metric-label">„ÉÜ„Çπ„Éà‰ª∂Êï∞</span>
                        <span class="metric-value" id="count-a">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Ê∫ÄË∂≥Â∫¶</span>
                        <span class="metric-value" id="satisfaction-a">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Ë®∫Êñ≠Á≤æÂ∫¶</span>
                        <span class="metric-value" id="accuracy-a">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Á¢∫‰ø°Â∫¶ÂàÜÂ∏É</span>
                        <span class="metric-value" id="confidence-a">-</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-a" style="width: 0%"></div>
                </div>
                <div class="distribution-chart">
                    <canvas id="chart-a"></canvas>
                </div>
            </div>
            
            <!-- Variant B: œÑ = 1.2 (Current) -->
            <div class="variant-card active" id="variant-b">
                <div class="variant-header">
                    <span class="variant-title">Variant B (Current)</span>
                    <span class="variant-badge">ÁèæÂú®„ÅÆË®≠ÂÆö</span>
                </div>
                <div class="temperature-display">œÑ = 1.2</div>
                <div class="test-results">
                    <div class="metric-row">
                        <span class="metric-label">„ÉÜ„Çπ„Éà‰ª∂Êï∞</span>
                        <span class="metric-value" id="count-b">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Ê∫ÄË∂≥Â∫¶</span>
                        <span class="metric-value" id="satisfaction-b">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Ë®∫Êñ≠Á≤æÂ∫¶</span>
                        <span class="metric-value" id="accuracy-b">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Á¢∫‰ø°Â∫¶ÂàÜÂ∏É</span>
                        <span class="metric-value" id="confidence-b">-</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-b" style="width: 0%"></div>
                </div>
                <div class="distribution-chart">
                    <canvas id="chart-b"></canvas>
                </div>
            </div>
            
            <!-- Variant C: œÑ = 1.5 (Balanced) -->
            <div class="variant-card" id="variant-c">
                <div class="variant-header">
                    <span class="variant-title">Variant C (Balanced)</span>
                    <span class="variant-badge">„ÉÜ„Çπ„Éà</span>
                </div>
                <div class="temperature-display">œÑ = 1.5</div>
                <div class="test-results">
                    <div class="metric-row">
                        <span class="metric-label">„ÉÜ„Çπ„Éà‰ª∂Êï∞</span>
                        <span class="metric-value" id="count-c">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Ê∫ÄË∂≥Â∫¶</span>
                        <span class="metric-value" id="satisfaction-c">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Ë®∫Êñ≠Á≤æÂ∫¶</span>
                        <span class="metric-value" id="accuracy-c">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Á¢∫‰ø°Â∫¶ÂàÜÂ∏É</span>
                        <span class="metric-value" id="confidence-c">-</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-c" style="width: 0%"></div>
                </div>
                <div class="distribution-chart">
                    <canvas id="chart-c"></canvas>
                </div>
            </div>
            
            <!-- Variant D: œÑ = 2.0 (Smooth) -->
            <div class="variant-card" id="variant-d">
                <div class="variant-header">
                    <span class="variant-title">Variant D (Smooth)</span>
                    <span class="variant-badge">„ÉÜ„Çπ„Éà</span>
                </div>
                <div class="temperature-display">œÑ = 2.0</div>
                <div class="test-results">
                    <div class="metric-row">
                        <span class="metric-label">„ÉÜ„Çπ„Éà‰ª∂Êï∞</span>
                        <span class="metric-value" id="count-d">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Ê∫ÄË∂≥Â∫¶</span>
                        <span class="metric-value" id="satisfaction-d">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Ë®∫Êñ≠Á≤æÂ∫¶</span>
                        <span class="metric-value" id="accuracy-d">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Á¢∫‰ø°Â∫¶ÂàÜÂ∏É</span>
                        <span class="metric-value" id="confidence-d">-</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-d" style="width: 0%"></div>
                </div>
                <div class="distribution-chart">
                    <canvas id="chart-d"></canvas>
                </div>
            </div>
        </div>
        
        <!-- ÊØîËºÉ„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="comparison-section" id="comparison" style="display: none;">
            <h2>üìà „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊØîËºÉ</h2>
            <div class="comparison-grid">
                <div class="comparison-card" id="winner-satisfaction">
                    <div class="metric-label">ÊúÄÈ´òÊ∫ÄË∂≥Â∫¶</div>
                    <div class="comparison-value">-</div>
                    <div>Variant -</div>
                </div>
                <div class="comparison-card" id="winner-accuracy">
                    <div class="metric-label">ÊúÄÈ´òÁ≤æÂ∫¶</div>
                    <div class="comparison-value">-</div>
                    <div>Variant -</div>
                </div>
                <div class="comparison-card" id="winner-balance">
                    <div class="metric-label">ÊúÄÈÅ©„Éê„É©„É≥„Çπ</div>
                    <div class="comparison-value">-</div>
                    <div>Variant -</div>
                </div>
                <div class="comparison-card" id="winner-stability">
                    <div class="metric-label">ÂÆâÂÆöÊÄß</div>
                    <div class="comparison-value">-</div>
                    <div>Variant -</div>
                </div>
            </div>
            
            <div class="statistical-section">
                <div class="statistical-title">Áµ±Ë®àÁöÑÊúâÊÑèÊÄßÊ§úÂÆö</div>
                <div>ANOVAÊ§úÂÆöÁµêÊûú: <span class="p-value" id="p-value">-</span></div>
                <div id="significance-result"></div>
            </div>
            
            <canvas id="realTimeChart"></canvas>
        </div>
        
        <!-- Êé®Â•®„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="recommendation-box" id="recommendation" style="display: none;">
            <div class="recommendation-title">üèÜ Êé®Â•®Ë®≠ÂÆö</div>
            <div class="recommendation-value" id="recommended-tau">œÑ = 1.2</div>
            <div id="recommendation-reason">Á∑èÂêàÁöÑ„Å™„Éê„É©„É≥„Çπ„ÅåÊúÄ„ÇÇÂÑ™„Çå„Å¶„ÅÑ„Åæ„Åô</div>
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        const variants = {
            a: { tau: 1.0, name: 'Sharp', data: [], metrics: {} },
            b: { tau: 1.2, name: 'Current', data: [], metrics: {} },
            c: { tau: 1.5, name: 'Balanced', data: [], metrics: {} },
            d: { tau: 2.0, name: 'Smooth', data: [], metrics: {} }
        };
        
        const BAGUA_ORDER = ["‰πæ", "ÂÖå", "Èõ¢", "Èúá", "Â∑Ω", "Âùé", "ËâÆ", "Âù§"];
        const testResults = [];
        let charts = {};
        let realTimeChart = null;
        
        // SoftmaxÊ≠£Ë¶èÂåñÈñ¢Êï∞
        function softmax(values, temperature = 1.2) {
            const scaledValues = values.map(v => v / temperature);
            const maxVal = Math.max(...scaledValues);
            const expValues = scaledValues.map(v => Math.exp(v - maxVal));
            const sumExp = expValues.reduce((a, b) => a + b, 0);
            return expValues.map(v => v / sumExp);
        }
        
        // Ë®∫Êñ≠„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥
        function simulateDiagnosis(tau) {
            // „É©„É≥„ÉÄ„É†„Å™ÂÖ´Âç¶„Ç®„Éç„É´„ÇÆ„ÉºÁîüÊàê
            const rawEnergies = BAGUA_ORDER.map(() => Math.random() * 100);
            
            // SoftmaxÊ≠£Ë¶èÂåñ
            const normalized = softmax(rawEnergies, tau);
            
            // ‰∏ä‰Ωç2„Å§„ÇíÈÅ∏Êäû
            const indexed = normalized.map((val, idx) => ({val, idx, bagua: BAGUA_ORDER[idx]}));
            const sorted = indexed.sort((a, b) => b.val - a.val);
            
            const upper = sorted[0];
            const lower = sorted[1];
            
            // Á¢∫‰ø°Â∫¶Ë®àÁÆó
            const gap = upper.val - lower.val;
            const entropy = -normalized.reduce((sum, p) => sum + (p > 0 ? p * Math.log(p) : 0), 0);
            const topRatio = upper.val / (upper.val + lower.val);
            
            // Ê∫ÄË∂≥Â∫¶„Å®Á≤æÂ∫¶„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÔºàÊ∏©Â∫¶„Éë„É©„É°„Éº„Çø„Å´Âøú„Åò„Å¶Â§âÂãïÔºâ
            let satisfaction, accuracy;
            
            if (tau === 1.0) {
                // Sharp: ÊòéÁ¢∫„Å†„ÅåÊôÇ„Å´Ê•µÁ´Ø
                satisfaction = gap > 0.3 ? 4.5 : gap > 0.15 ? 3.8 : 3.2;
                accuracy = gap > 0.3 ? 4.2 : gap > 0.15 ? 3.9 : 3.5;
            } else if (tau === 1.2) {
                // Current: „Éê„É©„É≥„ÇπÂûã
                satisfaction = gap > 0.25 ? 4.3 : gap > 0.12 ? 4.0 : 3.7;
                accuracy = gap > 0.25 ? 4.1 : gap > 0.12 ? 4.0 : 3.8;
            } else if (tau === 1.5) {
                // Balanced: „Çà„ÇäÂùáÁ≠â
                satisfaction = gap > 0.2 ? 4.0 : gap > 0.1 ? 3.9 : 3.8;
                accuracy = gap > 0.2 ? 3.9 : gap > 0.1 ? 3.9 : 3.9;
            } else {
                // Smooth: Á©è„ÇÑ„Åã
                satisfaction = gap > 0.15 ? 3.8 : gap > 0.08 ? 3.7 : 3.6;
                accuracy = gap > 0.15 ? 3.7 : gap > 0.08 ? 3.8 : 3.9;
            }
            
            // „Éé„Ç§„Ç∫„ÇíËøΩÂä†
            satisfaction += (Math.random() - 0.5) * 0.5;
            accuracy += (Math.random() - 0.5) * 0.4;
            
            satisfaction = Math.max(2, Math.min(5, satisfaction));
            accuracy = Math.max(2, Math.min(5, accuracy));
            
            return {
                upper: upper.bagua,
                lower: lower.bagua,
                gap: gap,
                entropy: entropy,
                topRatio: topRatio,
                confidence: gap > 0.2 ? 'HIGH' : gap > 0.1 ? 'MEDIUM' : 'LOW',
                satisfaction: satisfaction,
                accuracy: accuracy,
                distribution: normalized
            };
        }
        
        // „Éê„É™„Ç¢„É≥„Éà„ÅÆ„ÉÜ„Çπ„ÉàÂÆüË°å
        function testVariant(variantId) {
            const variant = variants[variantId];
            const result = simulateDiagnosis(variant.tau);
            
            variant.data.push(result);
            updateVariantDisplay(variantId);
            
            return result;
        }
        
        // Ë°®Á§∫Êõ¥Êñ∞
        function updateVariantDisplay(variantId) {
            const variant = variants[variantId];
            const data = variant.data;
            
            if (data.length === 0) return;
            
            // „É°„Éà„É™„ÇØ„ÇπË®àÁÆó
            const avgSatisfaction = data.reduce((sum, d) => sum + d.satisfaction, 0) / data.length;
            const avgAccuracy = data.reduce((sum, d) => sum + d.accuracy, 0) / data.length;
            
            const confidenceDist = {
                HIGH: data.filter(d => d.confidence === 'HIGH').length,
                MEDIUM: data.filter(d => d.confidence === 'MEDIUM').length,
                LOW: data.filter(d => d.confidence === 'LOW').length
            };
            
            // DOMÊõ¥Êñ∞
            document.getElementById(`count-${variantId}`).textContent = data.length;
            document.getElementById(`satisfaction-${variantId}`).textContent = avgSatisfaction.toFixed(2) + '/5';
            document.getElementById(`accuracy-${variantId}`).textContent = avgAccuracy.toFixed(2) + '/5';
            document.getElementById(`confidence-${variantId}`).textContent = 
                `H:${confidenceDist.HIGH} M:${confidenceDist.MEDIUM} L:${confidenceDist.LOW}`;
            
            // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº
            document.getElementById(`progress-${variantId}`).style.width = 
                Math.min(100, data.length / 10) + '%';
            
            // „ÉÅ„É£„Éº„ÉàÊõ¥Êñ∞
            updateChart(variantId);
            
            // „É°„Éà„É™„ÇØ„Çπ‰øùÂ≠ò
            variant.metrics = {
                avgSatisfaction,
                avgAccuracy,
                confidenceDist,
                stability: calculateStability(data)
            };
        }
        
        // ÂÆâÂÆöÊÄßË®àÁÆó
        function calculateStability(data) {
            if (data.length < 2) return 0;
            
            const satisfactions = data.map(d => d.satisfaction);
            const mean = satisfactions.reduce((a, b) => a + b, 0) / satisfactions.length;
            const variance = satisfactions.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / satisfactions.length;
            const stdDev = Math.sqrt(variance);
            
            return 1 / (1 + stdDev); // ‰Ωé„ÅÑÊ®ôÊ∫ñÂÅèÂ∑Æ = È´ò„ÅÑÂÆâÂÆöÊÄß
        }
        
        // „ÉÅ„É£„Éº„ÉàÂàùÊúüÂåñ
        function initCharts() {
            ['a', 'b', 'c', 'd'].forEach(variantId => {
                const ctx = document.getElementById(`chart-${variantId}`).getContext('2d');
                charts[variantId] = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: BAGUA_ORDER,
                        datasets: [{
                            label: '„Ç®„Éç„É´„ÇÆ„ÉºÂàÜÂ∏É',
                            data: new Array(8).fill(0),
                            backgroundColor: 'rgba(102, 126, 234, 0.5)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 0.5
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            });
        }
        
        // „ÉÅ„É£„Éº„ÉàÊõ¥Êñ∞
        function updateChart(variantId) {
            const variant = variants[variantId];
            if (variant.data.length === 0) return;
            
            // ÊúÄÊñ∞„ÅÆÂàÜÂ∏É„Éá„Éº„Çø
            const latestDist = variant.data[variant.data.length - 1].distribution;
            
            charts[variantId].data.datasets[0].data = latestDist;
            charts[variantId].update();
        }
        
        // A/B„ÉÜ„Çπ„ÉàÈñãÂßã
        async function startABTest() {
            console.log("A/B„ÉÜ„Çπ„ÉàÈñãÂßã");
            
            // ÊÆµÈöéÁöÑ„Å´„ÉÜ„Çπ„ÉàÂÆüË°å
            for (let i = 0; i < 50; i++) {
                // ÂêÑ„Éê„É™„Ç¢„É≥„Éà„Çí„É©„É≥„ÉÄ„É†„Å´ÈÅ∏Êäû„Åó„Å¶„ÉÜ„Çπ„Éà
                const variantIds = ['a', 'b', 'c', 'd'];
                const selectedVariant = variantIds[Math.floor(Math.random() * 4)];
                
                testVariant(selectedVariant);
                
                // „É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞
                if (i % 10 === 0) {
                    updateComparison();
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            }
            
            updateComparison();
            showRecommendation();
        }
        
        // „Éê„ÉÉ„ÉÅ„ÉÜ„Çπ„Éà
        async function runBatchTest() {
            console.log("„Éê„ÉÉ„ÉÅ„ÉÜ„Çπ„ÉàÂÆüË°åÔºà1000‰ª∂Ôºâ");
            
            for (let i = 0; i < 250; i++) {
                testVariant('a');
                testVariant('b');
                testVariant('c');
                testVariant('d');
            }
            
            updateComparison();
            showRecommendation();
        }
        
        // ÊØîËºÉÊõ¥Êñ∞
        function updateComparison() {
            document.getElementById('comparison').style.display = 'block';
            
            // ÂêÑ„É°„Éà„É™„ÇØ„Çπ„ÅÆÂãùËÄÖ„ÇíÊ±∫ÂÆö
            let winners = {
                satisfaction: { id: '', value: 0 },
                accuracy: { id: '', value: 0 },
                balance: { id: '', value: 0 },
                stability: { id: '', value: 0 }
            };
            
            ['a', 'b', 'c', 'd'].forEach(id => {
                const metrics = variants[id].metrics;
                if (!metrics.avgSatisfaction) return;
                
                if (metrics.avgSatisfaction > winners.satisfaction.value) {
                    winners.satisfaction = { id, value: metrics.avgSatisfaction };
                }
                if (metrics.avgAccuracy > winners.accuracy.value) {
                    winners.accuracy = { id, value: metrics.avgAccuracy };
                }
                
                const balance = (metrics.avgSatisfaction + metrics.avgAccuracy) / 2;
                if (balance > winners.balance.value) {
                    winners.balance = { id, value: balance };
                }
                
                if (metrics.stability > winners.stability.value) {
                    winners.stability = { id, value: metrics.stability };
                }
            });
            
            // DOMÊõ¥Êñ∞
            if (winners.satisfaction.id) {
                const card = document.getElementById('winner-satisfaction');
                card.classList.add('winner');
                card.querySelector('.comparison-value').textContent = 
                    winners.satisfaction.value.toFixed(2) + '/5';
                card.querySelector('div:last-child').textContent = 
                    `Variant ${winners.satisfaction.id.toUpperCase()} (œÑ=${variants[winners.satisfaction.id].tau})`;
            }
            
            if (winners.accuracy.id) {
                const card = document.getElementById('winner-accuracy');
                card.classList.add('winner');
                card.querySelector('.comparison-value').textContent = 
                    winners.accuracy.value.toFixed(2) + '/5';
                card.querySelector('div:last-child').textContent = 
                    `Variant ${winners.accuracy.id.toUpperCase()} (œÑ=${variants[winners.accuracy.id].tau})`;
            }
            
            if (winners.balance.id) {
                const card = document.getElementById('winner-balance');
                card.classList.add('winner');
                card.querySelector('.comparison-value').textContent = 
                    winners.balance.value.toFixed(2);
                card.querySelector('div:last-child').textContent = 
                    `Variant ${winners.balance.id.toUpperCase()} (œÑ=${variants[winners.balance.id].tau})`;
            }
            
            if (winners.stability.id) {
                const card = document.getElementById('winner-stability');
                card.classList.add('winner');
                card.querySelector('.comparison-value').textContent = 
                    (winners.stability.value * 100).toFixed(1) + '%';
                card.querySelector('div:last-child').textContent = 
                    `Variant ${winners.stability.id.toUpperCase()} (œÑ=${variants[winners.stability.id].tau})`;
            }
            
            // „É™„Ç¢„É´„Çø„Ç§„É†„ÉÅ„É£„Éº„ÉàÊõ¥Êñ∞
            updateRealTimeChart();
        }
        
        // „É™„Ç¢„É´„Çø„Ç§„É†„ÉÅ„É£„Éº„Éà
        function updateRealTimeChart() {
            const ctx = document.getElementById('realTimeChart').getContext('2d');
            
            if (realTimeChart) {
                realTimeChart.destroy();
            }
            
            const datasets = ['a', 'b', 'c', 'd'].map(id => ({
                label: `œÑ=${variants[id].tau}`,
                data: variants[id].data.slice(-20).map(d => d.satisfaction),
                borderColor: {
                    a: '#f56565',
                    b: '#667eea',
                    c: '#48bb78',
                    d: '#ed8936'
                }[id],
                fill: false
            }));
            
            realTimeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: Math.min(20, variants.a.data.length)}, (_, i) => i + 1),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '„É™„Ç¢„É´„Çø„Ç§„É†Ê∫ÄË∂≥Â∫¶Êé®Áßª'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5
                        }
                    }
                }
            });
        }
        
        // Áµ±Ë®àÂàÜÊûê
        function showStatisticalAnalysis() {
            // ANOVAÊ§úÂÆö„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥
            const groups = ['a', 'b', 'c', 'd'].map(id => 
                variants[id].data.map(d => d.satisfaction)
            ).filter(g => g.length > 0);
            
            if (groups.length < 2) {
                alert('Áµ±Ë®àÂàÜÊûê„Å´„ÅØÊúÄ‰Ωé2„Å§„ÅÆ„Ç∞„É´„Éº„Éó„ÅÆ„Éá„Éº„Çø„ÅåÂøÖË¶Å„Åß„Åô');
                return;
            }
            
            // Á∞°ÊòìÁöÑ„Å™FÁµ±Ë®àÈáèË®àÁÆó
            const grandMean = groups.flat().reduce((a, b) => a + b, 0) / groups.flat().length;
            const betweenGroupVar = groups.reduce((sum, group) => {
                const groupMean = group.reduce((a, b) => a + b, 0) / group.length;
                return sum + group.length * Math.pow(groupMean - grandMean, 2);
            }, 0) / (groups.length - 1);
            
            const withinGroupVar = groups.reduce((sum, group) => {
                const groupMean = group.reduce((a, b) => a + b, 0) / group.length;
                return sum + group.reduce((s, val) => s + Math.pow(val - groupMean, 2), 0);
            }, 0) / (groups.flat().length - groups.length);
            
            const fStat = betweenGroupVar / withinGroupVar;
            const pValue = Math.exp(-fStat / 2); // Á∞°ÊòìpÂÄ§
            
            document.getElementById('p-value').textContent = `p = ${pValue.toFixed(4)}`;
            document.getElementById('significance-result').textContent = 
                pValue < 0.05 ? '‚úÖ Áµ±Ë®àÁöÑ„Å´ÊúâÊÑè„Å™Â∑Æ„Åå„ÅÇ„Çä„Åæ„Åô' : '‚ùå ÊúâÊÑè„Å™Â∑Æ„ÅØË™ç„ÇÅ„Çâ„Çå„Åæ„Åõ„Çì';
        }
        
        // Êé®Â•®Ë°®Á§∫
        function showRecommendation() {
            const scores = {};
            
            ['a', 'b', 'c', 'd'].forEach(id => {
                const metrics = variants[id].metrics;
                if (!metrics.avgSatisfaction) return;
                
                // Á∑èÂêà„Çπ„Ç≥„Ç¢Ë®àÁÆó
                scores[id] = 
                    metrics.avgSatisfaction * 0.4 +
                    metrics.avgAccuracy * 0.3 +
                    metrics.stability * 3 * 0.3; // ÂÆâÂÆöÊÄß„Çí0-1„Åã„Çâ0-3„Å´„Çπ„Ç±„Éº„É´
            });
            
            const bestVariant = Object.entries(scores).sort((a, b) => b[1] - a[1])[0];
            
            if (bestVariant) {
                document.getElementById('recommendation').style.display = 'block';
                document.getElementById('recommended-tau').textContent = 
                    `œÑ = ${variants[bestVariant[0]].tau}`;
                
                const reasons = [];
                const metrics = variants[bestVariant[0]].metrics;
                
                if (metrics.avgSatisfaction > 4) reasons.push('È´ò„ÅÑÊ∫ÄË∂≥Â∫¶');
                if (metrics.avgAccuracy > 3.9) reasons.push('ÂÑ™„Çå„ÅüÁ≤æÂ∫¶');
                if (metrics.stability > 0.7) reasons.push('ÂÆâÂÆö„Åó„ÅüÁµêÊûú');
                
                document.getElementById('recommendation-reason').textContent = 
                    reasons.join('„ÄÅ') + '„ÇíÂÆüÁèæ';
            }
        }
        
        // ÁµêÊûú„Ç®„ÇØ„Çπ„Éù„Éº„Éà
        function exportResults() {
            const exportData = {
                timestamp: new Date().toISOString(),
                variants: Object.entries(variants).map(([id, variant]) => ({
                    id: id,
                    tau: variant.tau,
                    testCount: variant.data.length,
                    metrics: variant.metrics
                })),
                recommendation: document.getElementById('recommended-tau').textContent
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ab-test-results-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // „É™„Çª„ÉÉ„Éà
        function resetTest() {
            ['a', 'b', 'c', 'd'].forEach(id => {
                variants[id].data = [];
                variants[id].metrics = {};
                updateVariantDisplay(id);
            });
            
            document.getElementById('comparison').style.display = 'none';
            document.getElementById('recommendation').style.display = 'none';
            
            // „ÉÅ„É£„Éº„Éà„É™„Çª„ÉÉ„Éà
            Object.values(charts).forEach(chart => {
                chart.data.datasets[0].data = new Array(8).fill(0);
                chart.update();
            });
        }
        
        // ÂàùÊúüÂåñ
        window.onload = () => {
            initCharts();
            console.log('A/B„ÉÜ„Çπ„ÉàÁí∞Â¢ÉÊ∫ñÂÇôÂÆå‰∫Ü');
        };
    </script>
</body>
</html>