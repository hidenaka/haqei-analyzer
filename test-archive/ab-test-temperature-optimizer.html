<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaQei A/Bãƒ†ã‚¹ãƒˆ - æ¸©åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
        }
        
        .control-panel {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .variant-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            transition: all 0.3s;
        }
        
        .variant-card.active {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .variant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .variant-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2d3748;
        }
        
        .variant-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            background: #edf2f7;
            color: #4a5568;
        }
        
        .temperature-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }
        
        .test-results {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metric-row:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #718096;
            font-size: 0.95em;
        }
        
        .metric-value {
            font-weight: 600;
            color: #2d3748;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s;
        }
        
        .distribution-chart {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        
        .hexagram-distribution {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            margin: 10px 0;
        }
        
        .hexagram-cell {
            aspect-ratio: 1;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            color: #4a5568;
            border-radius: 2px;
            position: relative;
        }
        
        .hexagram-cell.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .comparison-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid #e2e8f0;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .comparison-card {
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
        }
        
        .comparison-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .winner {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }
        
        .statistical-section {
            background: #fef5e7;
            border-left: 4px solid #f39c12;
            padding: 20px;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .statistical-title {
            color: #d68910;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .p-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #c53030;
        }
        
        .recommendation-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: center;
        }
        
        .recommendation-title {
            font-size: 1.3em;
            margin-bottom: 10px;
        }
        
        .recommendation-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 15px 0;
        }
        
        #realTimeChart {
            max-height: 300px;
            margin: 20px 0;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ A/Bãƒ†ã‚¹ãƒˆ: Softmaxæ¸©åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–</h1>
        <p class="subtitle">æœ€é©ãªæ­£è¦åŒ–æ¸©åº¦ã‚’ç§‘å­¦çš„ã«æ±ºå®š</p>
        
        <div class="control-panel">
            <button onclick="startABTest()">ğŸš€ A/Bãƒ†ã‚¹ãƒˆé–‹å§‹</button>
            <button onclick="runBatchTest()">âš¡ ãƒãƒƒãƒãƒ†ã‚¹ãƒˆ (1000ä»¶)</button>
            <button onclick="showStatisticalAnalysis()">ğŸ“Š çµ±è¨ˆåˆ†æ</button>
            <button onclick="exportResults()">ğŸ’¾ çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            <button onclick="resetTest()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        
        <div class="test-grid">
            <!-- Variant A: Ï„ = 1.0 (Sharp) -->
            <div class="variant-card" id="variant-a">
                <div class="variant-header">
                    <span class="variant-title">Variant A (Sharp)</span>
                    <span class="variant-badge">ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</span>
                </div>
                <div class="temperature-display">Ï„ = 1.0</div>
                <div class="test-results">
                    <div class="metric-row">
                        <span class="metric-label">ãƒ†ã‚¹ãƒˆä»¶æ•°</span>
                        <span class="metric-value" id="count-a">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">æº€è¶³åº¦</span>
                        <span class="metric-value" id="satisfaction-a">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">è¨ºæ–­ç²¾åº¦</span>
                        <span class="metric-value" id="accuracy-a">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">ç¢ºä¿¡åº¦åˆ†å¸ƒ</span>
                        <span class="metric-value" id="confidence-a">-</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-a" style="width: 0%"></div>
                </div>
                <div class="distribution-chart">
                    <canvas id="chart-a"></canvas>
                </div>
            </div>
            
            <!-- Variant B: Ï„ = 1.2 (Current) -->
            <div class="variant-card active" id="variant-b">
                <div class="variant-header">
                    <span class="variant-title">Variant B (Current)</span>
                    <span class="variant-badge">ç¾åœ¨ã®è¨­å®š</span>
                </div>
                <div class="temperature-display">Ï„ = 1.2</div>
                <div class="test-results">
                    <div class="metric-row">
                        <span class="metric-label">ãƒ†ã‚¹ãƒˆä»¶æ•°</span>
                        <span class="metric-value" id="count-b">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">æº€è¶³åº¦</span>
                        <span class="metric-value" id="satisfaction-b">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">è¨ºæ–­ç²¾åº¦</span>
                        <span class="metric-value" id="accuracy-b">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">ç¢ºä¿¡åº¦åˆ†å¸ƒ</span>
                        <span class="metric-value" id="confidence-b">-</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-b" style="width: 0%"></div>
                </div>
                <div class="distribution-chart">
                    <canvas id="chart-b"></canvas>
                </div>
            </div>
            
            <!-- Variant C: Ï„ = 1.5 (Balanced) -->
            <div class="variant-card" id="variant-c">
                <div class="variant-header">
                    <span class="variant-title">Variant C (Balanced)</span>
                    <span class="variant-badge">ãƒ†ã‚¹ãƒˆ</span>
                </div>
                <div class="temperature-display">Ï„ = 1.5</div>
                <div class="test-results">
                    <div class="metric-row">
                        <span class="metric-label">ãƒ†ã‚¹ãƒˆä»¶æ•°</span>
                        <span class="metric-value" id="count-c">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">æº€è¶³åº¦</span>
                        <span class="metric-value" id="satisfaction-c">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">è¨ºæ–­ç²¾åº¦</span>
                        <span class="metric-value" id="accuracy-c">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">ç¢ºä¿¡åº¦åˆ†å¸ƒ</span>
                        <span class="metric-value" id="confidence-c">-</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-c" style="width: 0%"></div>
                </div>
                <div class="distribution-chart">
                    <canvas id="chart-c"></canvas>
                </div>
            </div>
            
            <!-- Variant D: Ï„ = 2.0 (Smooth) -->
            <div class="variant-card" id="variant-d">
                <div class="variant-header">
                    <span class="variant-title">Variant D (Smooth)</span>
                    <span class="variant-badge">ãƒ†ã‚¹ãƒˆ</span>
                </div>
                <div class="temperature-display">Ï„ = 2.0</div>
                <div class="test-results">
                    <div class="metric-row">
                        <span class="metric-label">ãƒ†ã‚¹ãƒˆä»¶æ•°</span>
                        <span class="metric-value" id="count-d">0</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">æº€è¶³åº¦</span>
                        <span class="metric-value" id="satisfaction-d">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">è¨ºæ–­ç²¾åº¦</span>
                        <span class="metric-value" id="accuracy-d">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">ç¢ºä¿¡åº¦åˆ†å¸ƒ</span>
                        <span class="metric-value" id="confidence-d">-</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-d" style="width: 0%"></div>
                </div>
                <div class="distribution-chart">
                    <canvas id="chart-d"></canvas>
                </div>
            </div>
        </div>
        
        <!-- æ¯”è¼ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="comparison-section" id="comparison" style="display: none;">
            <h2>ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ</h2>
            <div class="comparison-grid">
                <div class="comparison-card" id="winner-satisfaction">
                    <div class="metric-label">æœ€é«˜æº€è¶³åº¦</div>
                    <div class="comparison-value">-</div>
                    <div>Variant -</div>
                </div>
                <div class="comparison-card" id="winner-accuracy">
                    <div class="metric-label">æœ€é«˜ç²¾åº¦</div>
                    <div class="comparison-value">-</div>
                    <div>Variant -</div>
                </div>
                <div class="comparison-card" id="winner-balance">
                    <div class="metric-label">æœ€é©ãƒãƒ©ãƒ³ã‚¹</div>
                    <div class="comparison-value">-</div>
                    <div>Variant -</div>
                </div>
                <div class="comparison-card" id="winner-stability">
                    <div class="metric-label">å®‰å®šæ€§</div>
                    <div class="comparison-value">-</div>
                    <div>Variant -</div>
                </div>
            </div>
            
            <div class="statistical-section">
                <div class="statistical-title">çµ±è¨ˆçš„æœ‰æ„æ€§æ¤œå®š</div>
                <div>ANOVAæ¤œå®šçµæœ: <span class="p-value" id="p-value">-</span></div>
                <div id="significance-result"></div>
            </div>
            
            <canvas id="realTimeChart"></canvas>
        </div>
        
        <!-- æ¨å¥¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="recommendation-box" id="recommendation" style="display: none;">
            <div class="recommendation-title">ğŸ† æ¨å¥¨è¨­å®š</div>
            <div class="recommendation-value" id="recommended-tau">Ï„ = 1.2</div>
            <div id="recommendation-reason">ç·åˆçš„ãªãƒãƒ©ãƒ³ã‚¹ãŒæœ€ã‚‚å„ªã‚Œã¦ã„ã¾ã™</div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        const variants = {
            a: { tau: 1.0, name: 'Sharp', data: [], metrics: {} },
            b: { tau: 1.2, name: 'Current', data: [], metrics: {} },
            c: { tau: 1.5, name: 'Balanced', data: [], metrics: {} },
            d: { tau: 2.0, name: 'Smooth', data: [], metrics: {} }
        };
        
        const BAGUA_ORDER = ["ä¹¾", "å…Œ", "é›¢", "éœ‡", "å·½", "å", "è‰®", "å¤"];
        const testResults = [];
        let charts = {};
        let realTimeChart = null;
        
        // Softmaxæ­£è¦åŒ–é–¢æ•°
        function softmax(values, temperature = 1.2) {
            const scaledValues = values.map(v => v / temperature);
            const maxVal = Math.max(...scaledValues);
            const expValues = scaledValues.map(v => Math.exp(v - maxVal));
            const sumExp = expValues.reduce((a, b) => a + b, 0);
            return expValues.map(v => v / sumExp);
        }
        
        // è¨ºæ–­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateDiagnosis(tau) {
            // ãƒ©ãƒ³ãƒ€ãƒ ãªå…«å¦ã‚¨ãƒãƒ«ã‚®ãƒ¼ç”Ÿæˆ
            const rawEnergies = BAGUA_ORDER.map(() => Math.random() * 100);
            
            // Softmaxæ­£è¦åŒ–
            const normalized = softmax(rawEnergies, tau);
            
            // ä¸Šä½2ã¤ã‚’é¸æŠ
            const indexed = normalized.map((val, idx) => ({val, idx, bagua: BAGUA_ORDER[idx]}));
            const sorted = indexed.sort((a, b) => b.val - a.val);
            
            const upper = sorted[0];
            const lower = sorted[1];
            
            // ç¢ºä¿¡åº¦è¨ˆç®—
            const gap = upper.val - lower.val;
            const entropy = -normalized.reduce((sum, p) => sum + (p > 0 ? p * Math.log(p) : 0), 0);
            const topRatio = upper.val / (upper.val + lower.val);
            
            // æº€è¶³åº¦ã¨ç²¾åº¦ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ¸©åº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¿œã˜ã¦å¤‰å‹•ï¼‰
            let satisfaction, accuracy;
            
            if (tau === 1.0) {
                // Sharp: æ˜ç¢ºã ãŒæ™‚ã«æ¥µç«¯
                satisfaction = gap > 0.3 ? 4.5 : gap > 0.15 ? 3.8 : 3.2;
                accuracy = gap > 0.3 ? 4.2 : gap > 0.15 ? 3.9 : 3.5;
            } else if (tau === 1.2) {
                // Current: ãƒãƒ©ãƒ³ã‚¹å‹
                satisfaction = gap > 0.25 ? 4.3 : gap > 0.12 ? 4.0 : 3.7;
                accuracy = gap > 0.25 ? 4.1 : gap > 0.12 ? 4.0 : 3.8;
            } else if (tau === 1.5) {
                // Balanced: ã‚ˆã‚Šå‡ç­‰
                satisfaction = gap > 0.2 ? 4.0 : gap > 0.1 ? 3.9 : 3.8;
                accuracy = gap > 0.2 ? 3.9 : gap > 0.1 ? 3.9 : 3.9;
            } else {
                // Smooth: ç©ã‚„ã‹
                satisfaction = gap > 0.15 ? 3.8 : gap > 0.08 ? 3.7 : 3.6;
                accuracy = gap > 0.15 ? 3.7 : gap > 0.08 ? 3.8 : 3.9;
            }
            
            // ãƒã‚¤ã‚ºã‚’è¿½åŠ 
            satisfaction += (Math.random() - 0.5) * 0.5;
            accuracy += (Math.random() - 0.5) * 0.4;
            
            satisfaction = Math.max(2, Math.min(5, satisfaction));
            accuracy = Math.max(2, Math.min(5, accuracy));
            
            return {
                upper: upper.bagua,
                lower: lower.bagua,
                gap: gap,
                entropy: entropy,
                topRatio: topRatio,
                confidence: gap > 0.2 ? 'HIGH' : gap > 0.1 ? 'MEDIUM' : 'LOW',
                satisfaction: satisfaction,
                accuracy: accuracy,
                distribution: normalized
            };
        }
        
        // ãƒãƒªã‚¢ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function testVariant(variantId) {
            const variant = variants[variantId];
            const result = simulateDiagnosis(variant.tau);
            
            variant.data.push(result);
            updateVariantDisplay(variantId);
            
            return result;
        }
        
        // è¡¨ç¤ºæ›´æ–°
        function updateVariantDisplay(variantId) {
            const variant = variants[variantId];
            const data = variant.data;
            
            if (data.length === 0) return;
            
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨ˆç®—
            const avgSatisfaction = data.reduce((sum, d) => sum + d.satisfaction, 0) / data.length;
            const avgAccuracy = data.reduce((sum, d) => sum + d.accuracy, 0) / data.length;
            
            const confidenceDist = {
                HIGH: data.filter(d => d.confidence === 'HIGH').length,
                MEDIUM: data.filter(d => d.confidence === 'MEDIUM').length,
                LOW: data.filter(d => d.confidence === 'LOW').length
            };
            
            // DOMæ›´æ–°
            document.getElementById(`count-${variantId}`).textContent = data.length;
            document.getElementById(`satisfaction-${variantId}`).textContent = avgSatisfaction.toFixed(2) + '/5';
            document.getElementById(`accuracy-${variantId}`).textContent = avgAccuracy.toFixed(2) + '/5';
            document.getElementById(`confidence-${variantId}`).textContent = 
                `H:${confidenceDist.HIGH} M:${confidenceDist.MEDIUM} L:${confidenceDist.LOW}`;
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
            document.getElementById(`progress-${variantId}`).style.width = 
                Math.min(100, data.length / 10) + '%';
            
            // ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
            updateChart(variantId);
            
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ä¿å­˜
            variant.metrics = {
                avgSatisfaction,
                avgAccuracy,
                confidenceDist,
                stability: calculateStability(data)
            };
        }
        
        // å®‰å®šæ€§è¨ˆç®—
        function calculateStability(data) {
            if (data.length < 2) return 0;
            
            const satisfactions = data.map(d => d.satisfaction);
            const mean = satisfactions.reduce((a, b) => a + b, 0) / satisfactions.length;
            const variance = satisfactions.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / satisfactions.length;
            const stdDev = Math.sqrt(variance);
            
            return 1 / (1 + stdDev); // ä½ã„æ¨™æº–åå·® = é«˜ã„å®‰å®šæ€§
        }
        
        // ãƒãƒ£ãƒ¼ãƒˆåˆæœŸåŒ–
        function initCharts() {
            ['a', 'b', 'c', 'd'].forEach(variantId => {
                const ctx = document.getElementById(`chart-${variantId}`).getContext('2d');
                charts[variantId] = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: BAGUA_ORDER,
                        datasets: [{
                            label: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼åˆ†å¸ƒ',
                            data: new Array(8).fill(0),
                            backgroundColor: 'rgba(102, 126, 234, 0.5)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 0.5
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            });
        }
        
        // ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
        function updateChart(variantId) {
            const variant = variants[variantId];
            if (variant.data.length === 0) return;
            
            // æœ€æ–°ã®åˆ†å¸ƒãƒ‡ãƒ¼ã‚¿
            const latestDist = variant.data[variant.data.length - 1].distribution;
            
            charts[variantId].data.datasets[0].data = latestDist;
            charts[variantId].update();
        }
        
        // A/Bãƒ†ã‚¹ãƒˆé–‹å§‹
        async function startABTest() {
            console.log("A/Bãƒ†ã‚¹ãƒˆé–‹å§‹");
            
            // æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            for (let i = 0; i < 50; i++) {
                // å„ãƒãƒªã‚¢ãƒ³ãƒˆã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠã—ã¦ãƒ†ã‚¹ãƒˆ
                const variantIds = ['a', 'b', 'c', 'd'];
                const selectedVariant = variantIds[Math.floor(Math.random() * 4)];
                
                testVariant(selectedVariant);
                
                // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
                if (i % 10 === 0) {
                    updateComparison();
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            }
            
            updateComparison();
            showRecommendation();
        }
        
        // ãƒãƒƒãƒãƒ†ã‚¹ãƒˆ
        async function runBatchTest() {
            console.log("ãƒãƒƒãƒãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆ1000ä»¶ï¼‰");
            
            for (let i = 0; i < 250; i++) {
                testVariant('a');
                testVariant('b');
                testVariant('c');
                testVariant('d');
            }
            
            updateComparison();
            showRecommendation();
        }
        
        // æ¯”è¼ƒæ›´æ–°
        function updateComparison() {
            document.getElementById('comparison').style.display = 'block';
            
            // å„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å‹è€…ã‚’æ±ºå®š
            let winners = {
                satisfaction: { id: '', value: 0 },
                accuracy: { id: '', value: 0 },
                balance: { id: '', value: 0 },
                stability: { id: '', value: 0 }
            };
            
            ['a', 'b', 'c', 'd'].forEach(id => {
                const metrics = variants[id].metrics;
                if (!metrics.avgSatisfaction) return;
                
                if (metrics.avgSatisfaction > winners.satisfaction.value) {
                    winners.satisfaction = { id, value: metrics.avgSatisfaction };
                }
                if (metrics.avgAccuracy > winners.accuracy.value) {
                    winners.accuracy = { id, value: metrics.avgAccuracy };
                }
                
                const balance = (metrics.avgSatisfaction + metrics.avgAccuracy) / 2;
                if (balance > winners.balance.value) {
                    winners.balance = { id, value: balance };
                }
                
                if (metrics.stability > winners.stability.value) {
                    winners.stability = { id, value: metrics.stability };
                }
            });
            
            // DOMæ›´æ–°
            if (winners.satisfaction.id) {
                const card = document.getElementById('winner-satisfaction');
                card.classList.add('winner');
                card.querySelector('.comparison-value').textContent = 
                    winners.satisfaction.value.toFixed(2) + '/5';
                card.querySelector('div:last-child').textContent = 
                    `Variant ${winners.satisfaction.id.toUpperCase()} (Ï„=${variants[winners.satisfaction.id].tau})`;
            }
            
            if (winners.accuracy.id) {
                const card = document.getElementById('winner-accuracy');
                card.classList.add('winner');
                card.querySelector('.comparison-value').textContent = 
                    winners.accuracy.value.toFixed(2) + '/5';
                card.querySelector('div:last-child').textContent = 
                    `Variant ${winners.accuracy.id.toUpperCase()} (Ï„=${variants[winners.accuracy.id].tau})`;
            }
            
            if (winners.balance.id) {
                const card = document.getElementById('winner-balance');
                card.classList.add('winner');
                card.querySelector('.comparison-value').textContent = 
                    winners.balance.value.toFixed(2);
                card.querySelector('div:last-child').textContent = 
                    `Variant ${winners.balance.id.toUpperCase()} (Ï„=${variants[winners.balance.id].tau})`;
            }
            
            if (winners.stability.id) {
                const card = document.getElementById('winner-stability');
                card.classList.add('winner');
                card.querySelector('.comparison-value').textContent = 
                    (winners.stability.value * 100).toFixed(1) + '%';
                card.querySelector('div:last-child').textContent = 
                    `Variant ${winners.stability.id.toUpperCase()} (Ï„=${variants[winners.stability.id].tau})`;
            }
            
            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
            updateRealTimeChart();
        }
        
        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒ¼ãƒˆ
        function updateRealTimeChart() {
            const ctx = document.getElementById('realTimeChart').getContext('2d');
            
            if (realTimeChart) {
                realTimeChart.destroy();
            }
            
            const datasets = ['a', 'b', 'c', 'd'].map(id => ({
                label: `Ï„=${variants[id].tau}`,
                data: variants[id].data.slice(-20).map(d => d.satisfaction),
                borderColor: {
                    a: '#f56565',
                    b: '#667eea',
                    c: '#48bb78',
                    d: '#ed8936'
                }[id],
                fill: false
            }));
            
            realTimeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: Math.min(20, variants.a.data.length)}, (_, i) => i + 1),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æº€è¶³åº¦æ¨ç§»'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5
                        }
                    }
                }
            });
        }
        
        // çµ±è¨ˆåˆ†æ
        function showStatisticalAnalysis() {
            // ANOVAæ¤œå®šã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const groups = ['a', 'b', 'c', 'd'].map(id => 
                variants[id].data.map(d => d.satisfaction)
            ).filter(g => g.length > 0);
            
            if (groups.length < 2) {
                alert('çµ±è¨ˆåˆ†æã«ã¯æœ€ä½2ã¤ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™');
                return;
            }
            
            // ç°¡æ˜“çš„ãªFçµ±è¨ˆé‡è¨ˆç®—
            const grandMean = groups.flat().reduce((a, b) => a + b, 0) / groups.flat().length;
            const betweenGroupVar = groups.reduce((sum, group) => {
                const groupMean = group.reduce((a, b) => a + b, 0) / group.length;
                return sum + group.length * Math.pow(groupMean - grandMean, 2);
            }, 0) / (groups.length - 1);
            
            const withinGroupVar = groups.reduce((sum, group) => {
                const groupMean = group.reduce((a, b) => a + b, 0) / group.length;
                return sum + group.reduce((s, val) => s + Math.pow(val - groupMean, 2), 0);
            }, 0) / (groups.flat().length - groups.length);
            
            const fStat = betweenGroupVar / withinGroupVar;
            const pValue = Math.exp(-fStat / 2); // ç°¡æ˜“på€¤
            
            document.getElementById('p-value').textContent = `p = ${pValue.toFixed(4)}`;
            document.getElementById('significance-result').textContent = 
                pValue < 0.05 ? 'âœ… çµ±è¨ˆçš„ã«æœ‰æ„ãªå·®ãŒã‚ã‚Šã¾ã™' : 'âŒ æœ‰æ„ãªå·®ã¯èªã‚ã‚‰ã‚Œã¾ã›ã‚“';
        }
        
        // æ¨å¥¨è¡¨ç¤º
        function showRecommendation() {
            const scores = {};
            
            ['a', 'b', 'c', 'd'].forEach(id => {
                const metrics = variants[id].metrics;
                if (!metrics.avgSatisfaction) return;
                
                // ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®—
                scores[id] = 
                    metrics.avgSatisfaction * 0.4 +
                    metrics.avgAccuracy * 0.3 +
                    metrics.stability * 3 * 0.3; // å®‰å®šæ€§ã‚’0-1ã‹ã‚‰0-3ã«ã‚¹ã‚±ãƒ¼ãƒ«
            });
            
            const bestVariant = Object.entries(scores).sort((a, b) => b[1] - a[1])[0];
            
            if (bestVariant) {
                document.getElementById('recommendation').style.display = 'block';
                document.getElementById('recommended-tau').textContent = 
                    `Ï„ = ${variants[bestVariant[0]].tau}`;
                
                const reasons = [];
                const metrics = variants[bestVariant[0]].metrics;
                
                if (metrics.avgSatisfaction > 4) reasons.push('é«˜ã„æº€è¶³åº¦');
                if (metrics.avgAccuracy > 3.9) reasons.push('å„ªã‚ŒãŸç²¾åº¦');
                if (metrics.stability > 0.7) reasons.push('å®‰å®šã—ãŸçµæœ');
                
                document.getElementById('recommendation-reason').textContent = 
                    reasons.join('ã€') + 'ã‚’å®Ÿç¾';
            }
        }
        
        // çµæœã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportResults() {
            const exportData = {
                timestamp: new Date().toISOString(),
                variants: Object.entries(variants).map(([id, variant]) => ({
                    id: id,
                    tau: variant.tau,
                    testCount: variant.data.length,
                    metrics: variant.metrics
                })),
                recommendation: document.getElementById('recommended-tau').textContent
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ab-test-results-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // ãƒªã‚»ãƒƒãƒˆ
        function resetTest() {
            ['a', 'b', 'c', 'd'].forEach(id => {
                variants[id].data = [];
                variants[id].metrics = {};
                updateVariantDisplay(id);
            });
            
            document.getElementById('comparison').style.display = 'none';
            document.getElementById('recommendation').style.display = 'none';
            
            // ãƒãƒ£ãƒ¼ãƒˆãƒªã‚»ãƒƒãƒˆ
            Object.values(charts).forEach(chart => {
                chart.data.datasets[0].data = new Array(8).fill(0);
                chart.update();
            });
        }
        
        // åˆæœŸåŒ–
        window.onload = () => {
            initCharts();
            console.log('A/Bãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™å®Œäº†');
        };
    </script>
</body>
</html>