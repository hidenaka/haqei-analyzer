<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¹å–„è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯æ¤œè¨¼</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
        }
        
        .control-panel {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f7fafc;
            border-radius: 12px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .test-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #718096;
        }
        
        .metric-value {
            font-weight: 600;
            color: #2d3748;
        }
        
        .success {
            color: #38a169;
        }
        
        .warning {
            color: #e53e3e;
        }
        
        .info {
            color: #3182ce;
        }
        
        .chart-container {
            margin: 20px 0;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        
        #comparisonChart, #distributionChart {
            max-height: 400px;
        }
        
        .explanation {
            background: #fef5e7;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .pure-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .pure-yes {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .pure-no {
            background: #fed7e2;
            color: #c53030;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #f7fafc;
            font-weight: 600;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="improved-diagnostic-logic.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ æ”¹å–„è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯æ¤œè¨¼</h1>
        <p class="subtitle">æ˜“çµŒæ€æƒ³ã‚’åæ˜ ã—ãŸé›†ä¸­åº¦é€£å‹•å‹ç´”å¦åˆ¶å¾¡</p>
        
        <div class="control-panel">
            <button onclick="runSingleTest()">å˜ä¸€ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="runComparisonTest()">æ–°æ—§æ¯”è¼ƒãƒ†ã‚¹ãƒˆ</button>
            <button onclick="runBatchTest(100)">100å›ãƒãƒƒãƒãƒ†ã‚¹ãƒˆ</button>
            <button onclick="runBatchTest(1000)">1000å›ãƒãƒƒãƒãƒ†ã‚¹ãƒˆ</button>
            <button onclick="runConcentrationTest()">é›†ä¸­åº¦åˆ¥ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="clearResults()">ã‚¯ãƒªã‚¢</button>
        </div>
        
        <!-- å˜ä¸€ãƒ†ã‚¹ãƒˆçµæœ -->
        <div class="test-section" id="singleTest" style="display: none;">
            <h2>ğŸ“Š å˜ä¸€è¨ºæ–­ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>å…¥åŠ›ãƒ™ã‚¯ãƒˆãƒ«</h3>
                    <div id="inputVector"></div>
                </div>
                <div class="test-card">
                    <h3>å…«å¦ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆSoftmaxå¾Œï¼‰</h3>
                    <div id="baguaEnergies"></div>
                </div>
                <div class="test-card">
                    <h3>è¨ºæ–­çµæœ</h3>
                    <div id="diagnosisResult"></div>
                </div>
                <div class="test-card">
                    <h3>é›†ä¸­åº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹</h3>
                    <div id="concentrationMetrics"></div>
                </div>
            </div>
            <div class="explanation" id="explanation"></div>
        </div>
        
        <!-- æ–°æ—§æ¯”è¼ƒ -->
        <div class="test-section" id="comparisonTest" style="display: none;">
            <h2>ğŸ“ˆ æ–°æ—§ãƒ­ã‚¸ãƒƒã‚¯æ¯”è¼ƒ</h2>
            <div class="chart-container">
                <canvas id="comparisonChart"></canvas>
            </div>
            <table id="comparisonTable">
                <thead>
                    <tr>
                        <th>é …ç›®</th>
                        <th>æ—§ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆReLUä»˜ãï¼‰</th>
                        <th>æ–°ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆSoftmaxä¸€æœ¬åŒ–ï¼‰</th>
                        <th>æ”¹å–„åº¦</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        
        <!-- ãƒãƒƒãƒãƒ†ã‚¹ãƒˆçµæœ -->
        <div class="test-section" id="batchTest" style="display: none;">
            <h2>ğŸ“Š ãƒãƒƒãƒãƒ†ã‚¹ãƒˆçµæœ</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>Engine OS</h3>
                    <div id="engineStats"></div>
                </div>
                <div class="test-card">
                    <h3>Interface OS</h3>
                    <div id="interfaceStats"></div>
                </div>
                <div class="test-card">
                    <h3>Safe Mode OS</h3>
                    <div id="safemodeStats"></div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="distributionChart"></canvas>
            </div>
        </div>
        
        <!-- é›†ä¸­åº¦åˆ¥ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section" id="concentrationTest" style="display: none;">
            <h2>ğŸ¯ é›†ä¸­åº¦åˆ¥ç´”å¦ç‡åˆ†æ</h2>
            <table id="concentrationTable">
                <thead>
                    <tr>
                        <th>é›†ä¸­åº¦ãƒ¬ãƒ™ãƒ«</th>
                        <th>HerfindahlæŒ‡æ•°</th>
                        <th>ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼</th>
                        <th>ç´”å¦ç‡ï¼ˆå®Ÿæ¸¬ï¼‰</th>
                        <th>ç´”å¦ç‡ï¼ˆæœŸå¾…ï¼‰</th>
                        <th>èª¬æ˜</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        // æ”¹å–„ã‚¨ãƒ³ã‚¸ãƒ³ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        const engine = new ImprovedDiagnosticEngine();
        let comparisonChart = null;
        let distributionChart = null;
        
        // å˜ä¸€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function runSingleTest() {
            // ãƒ©ãƒ³ãƒ€ãƒ ãªå…¥åŠ›ãƒ™ã‚¯ãƒˆãƒ«ç”Ÿæˆ
            const userVector = {};
            const BAGUA = ["ä¹¾", "å…Œ", "é›¢", "éœ‡", "å·½", "å", "è‰®", "å¤"];
            
            // ãƒ©ãƒ³ãƒ€ãƒ ãªé›†ä¸­åº¦ã§ç”Ÿæˆ
            const concentration = Math.random();
            if (concentration < 0.3) {
                // åˆ†æ•£å‹
                BAGUA.forEach(b => userVector[b] = 10 + Math.random() * 10);
            } else if (concentration < 0.7) {
                // ä¸­é–“å‹
                BAGUA.forEach(b => userVector[b] = Math.random() * 50);
            } else {
                // é›†ä¸­å‹
                const dominant = BAGUA[Math.floor(Math.random() * 8)];
                BAGUA.forEach(b => userVector[b] = b === dominant ? 80 + Math.random() * 20 : Math.random() * 20);
            }
            
            // è¨ºæ–­å®Ÿè¡Œ
            const result = engine.performDiagnosis(userVector, 'engine', 'probabilistic');
            
            // çµæœè¡¨ç¤º
            document.getElementById('singleTest').style.display = 'block';
            
            // å…¥åŠ›ãƒ™ã‚¯ãƒˆãƒ«è¡¨ç¤º
            const inputDiv = document.getElementById('inputVector');
            inputDiv.innerHTML = Object.entries(userVector)
                .map(([k, v]) => `<div class="metric"><span class="metric-label">${k}</span><span class="metric-value">${v.toFixed(1)}</span></div>`)
                .join('');
            
            // å…«å¦ã‚¨ãƒãƒ«ã‚®ãƒ¼è¡¨ç¤º
            const energyDiv = document.getElementById('baguaEnergies');
            energyDiv.innerHTML = Object.entries(result.baguaEnergies)
                .map(([k, v]) => `<div class="metric"><span class="metric-label">${k}</span><span class="metric-value">${(v * 100).toFixed(1)}%</span></div>`)
                .join('');
            
            // è¨ºæ–­çµæœè¡¨ç¤º
            const resultDiv = document.getElementById('diagnosisResult');
            resultDiv.innerHTML = `
                <div class="metric">
                    <span class="metric-label">ä¸Šå¦</span>
                    <span class="metric-value">${result.upperTrigram}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ä¸‹å¦</span>
                    <span class="metric-value">${result.lowerTrigram}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ç´”å¦åˆ¤å®š</span>
                    <span class="metric-value">
                        ${result.isPure ? 'ç´”å¦' : 'æ··åˆå¦'}
                        <span class="pure-indicator ${result.isPure ? 'pure-yes' : 'pure-no'}">
                            ${result.isPure ? 'âœ“' : 'âœ—'}
                        </span>
                    </span>
                </div>
            `;
            
            // é›†ä¸­åº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¡¨ç¤º
            const metricsDiv = document.getElementById('concentrationMetrics');
            metricsDiv.innerHTML = `
                <div class="metric">
                    <span class="metric-label">HerfindahlæŒ‡æ•°</span>
                    <span class="metric-value">${result.metrics.herfindahl.toFixed(3)}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼</span>
                    <span class="metric-value">${result.metrics.entropy.toFixed(3)}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">æœ€å¤§å€¤æ¯”ç‡</span>
                    <span class="metric-value">${(result.metrics.topRatio * 100).toFixed(1)}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ä¸Šä½å·®</span>
                    <span class="metric-value">${(result.metrics.gap * 100).toFixed(1)}%</span>
                </div>
            `;
            
            // èª¬æ˜è¡¨ç¤º
            document.getElementById('explanation').innerHTML = `
                <strong>è¨ºæ–­èª¬æ˜:</strong> ${result.explanation}
            `;
        }
        
        // æ–°æ—§æ¯”è¼ƒãƒ†ã‚¹ãƒˆ
        function runComparisonTest() {
            const testCount = 1000;
            const oldResults = [];
            const newResults = [];
            
            // æ—§ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆReLUä»˜ãï¼‰
            for (let i = 0; i < testCount; i++) {
                const result = simulateOldLogic();
                oldResults.push(result);
            }
            
            // æ–°ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
            for (let i = 0; i < testCount; i++) {
                const userVector = generateRandomVector();
                const result = engine.performDiagnosis(userVector, 'engine', 'probabilistic');
                newResults.push(result);
            }
            
            // çµ±è¨ˆè¨ˆç®—
            const oldPureRate = oldResults.filter(r => r.isPure).length / testCount;
            const newPureRate = newResults.filter(r => r.isPure).length / testCount;
            
            // çµæœè¡¨ç¤º
            document.getElementById('comparisonTest').style.display = 'block';
            
            // ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
            const tbody = document.querySelector('#comparisonTable tbody');
            tbody.innerHTML = `
                <tr>
                    <td>ç´”å¦ç‡</td>
                    <td class="${oldPureRate > 0.18 ? 'warning' : ''}">${(oldPureRate * 100).toFixed(1)}%</td>
                    <td class="${newPureRate > 0.18 ? 'warning' : 'success'}">${(newPureRate * 100).toFixed(1)}%</td>
                    <td>${((newPureRate - oldPureRate) * 100).toFixed(1)}%</td>
                </tr>
                <tr>
                    <td>ç†è«–å€¤ã¨ã®ä¹–é›¢</td>
                    <td>${((oldPureRate - 0.125) * 100).toFixed(1)}%</td>
                    <td>${((newPureRate - 0.125) * 100).toFixed(1)}%</td>
                    <td>-</td>
                </tr>
            `;
            
            // ã‚°ãƒ©ãƒ•æ›´æ–°
            updateComparisonChart(oldPureRate, newPureRate);
        }
        
        // ãƒãƒƒãƒãƒ†ã‚¹ãƒˆ
        function runBatchTest(count) {
            const results = {
                engine: [],
                interface: [],
                safemode: []
            };
            
            // å„OSã‚¿ã‚¤ãƒ—ã§ãƒ†ã‚¹ãƒˆ
            ['engine', 'interface', 'safemode'].forEach(osType => {
                for (let i = 0; i < count; i++) {
                    const userVector = generateRandomVector();
                    const result = engine.performDiagnosis(userVector, osType, 'probabilistic');
                    results[osType].push(result);
                }
            });
            
            // çµæœè¡¨ç¤º
            document.getElementById('batchTest').style.display = 'block';
            
            // å„OSã®çµ±è¨ˆè¡¨ç¤º
            ['engine', 'interface', 'safemode'].forEach(osType => {
                const osResults = results[osType];
                const pureCount = osResults.filter(r => r.isPure).length;
                const pureRate = pureCount / count;
                const avgHerfindahl = osResults.reduce((sum, r) => sum + r.metrics.herfindahl, 0) / count;
                
                const statsDiv = document.getElementById(`${osType}Stats`);
                statsDiv.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">ãƒ†ã‚¹ãƒˆæ•°</span>
                        <span class="metric-value">${count}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ç´”å¦æ•°</span>
                        <span class="metric-value">${pureCount}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ç´”å¦ç‡</span>
                        <span class="metric-value ${pureRate > 0.18 ? 'warning' : 'success'}">${(pureRate * 100).toFixed(2)}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">å¹³å‡é›†ä¸­åº¦</span>
                        <span class="metric-value">${(avgHerfindahl * 100).toFixed(1)}%</span>
                    </div>
                `;
            });
            
            // åˆ†å¸ƒã‚°ãƒ©ãƒ•æ›´æ–°
            updateDistributionChart(results);
        }
        
        // é›†ä¸­åº¦åˆ¥ãƒ†ã‚¹ãƒˆ
        function runConcentrationTest() {
            const levels = [
                { name: 'ä½é›†ä¸­', herfindahl: 0.125, variance: 0.01 },
                { name: 'ä¸­ä½é›†ä¸­', herfindahl: 0.15, variance: 0.02 },
                { name: 'ä¸­é›†ä¸­', herfindahl: 0.175, variance: 0.025 },
                { name: 'ä¸­é«˜é›†ä¸­', herfindahl: 0.2, variance: 0.03 },
                { name: 'é«˜é›†ä¸­', herfindahl: 0.25, variance: 0.04 }
            ];
            
            const tbody = document.querySelector('#concentrationTable tbody');
            tbody.innerHTML = '';
            
            levels.forEach(level => {
                const results = [];
                for (let i = 0; i < 200; i++) {
                    const userVector = generateVectorWithConcentration(level.herfindahl, level.variance);
                    const result = engine.performDiagnosis(userVector, 'engine', 'probabilistic');
                    results.push(result);
                }
                
                const pureCount = results.filter(r => r.isPure).length;
                const pureRate = pureCount / results.length;
                const avgHerfindahl = results.reduce((sum, r) => sum + r.metrics.herfindahl, 0) / results.length;
                const avgEntropy = results.reduce((sum, r) => sum + r.metrics.entropy, 0) / results.length;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${level.name}</td>
                    <td>${avgHerfindahl.toFixed(3)}</td>
                    <td>${avgEntropy.toFixed(3)}</td>
                    <td class="${pureRate > 0.2 ? 'warning' : 'success'}">${(pureRate * 100).toFixed(1)}%</td>
                    <td>${(avgHerfindahl * 100).toFixed(1)}%</td>
                    <td>${avgHerfindahl > 0.2 ? 'æ°—ãŒé›†ä¸­' : avgHerfindahl < 0.15 ? 'æ°—ãŒåˆ†æ•£' : 'ãƒãƒ©ãƒ³ã‚¹çŠ¶æ…‹'}</td>
                `;
            });
            
            document.getElementById('concentrationTest').style.display = 'block';
        }
        
        // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function generateRandomVector() {
            const vector = {};
            const BAGUA = ["ä¹¾", "å…Œ", "é›¢", "éœ‡", "å·½", "å", "è‰®", "å¤"];
            BAGUA.forEach(b => vector[b] = Math.random() * 100);
            return vector;
        }
        
        function generateVectorWithConcentration(targetHerfindahl, variance) {
            const BAGUA = ["ä¹¾", "å…Œ", "é›¢", "éœ‡", "å·½", "å", "è‰®", "å¤"];
            const vector = {};
            
            // ç›®æ¨™HerfindahlæŒ‡æ•°ã«åŸºã¥ã„ã¦åˆ†å¸ƒã‚’ç”Ÿæˆ
            const probs = [];
            let remaining = 1;
            
            for (let i = 0; i < 7; i++) {
                const p = Math.random() * remaining * 0.3;
                probs.push(p);
                remaining -= p;
            }
            probs.push(remaining);
            
            // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            probs.sort(() => Math.random() - 0.5);
            
            // ãƒ™ã‚¯ãƒˆãƒ«ã«å¤‰æ›
            BAGUA.forEach((b, i) => {
                vector[b] = probs[i] * 100 + (Math.random() - 0.5) * variance * 100;
            });
            
            return vector;
        }
        
        function simulateOldLogic() {
            // æ—§ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆReLUä¸‹é™å€¤ä»˜ãï¼‰
            const BAGUA = ["ä¹¾", "å…Œ", "é›¢", "éœ‡", "å·½", "å", "è‰®", "å¤"];
            const rawEnergies = BAGUA.map(() => Math.random() * 100);
            
            // Z-scoreæ¨™æº–åŒ–
            const mean = rawEnergies.reduce((a, b) => a + b, 0) / rawEnergies.length;
            const variance = rawEnergies.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / rawEnergies.length;
            const std = Math.sqrt(variance);
            
            const zScored = rawEnergies.map(v => std > 0 ? (v - mean) / std : 0);
            
            // ReLUæ´»æ€§åŒ–ï¼ˆå•é¡Œã®ã‚ã‚‹å®Ÿè£…ï¼‰
            const activated = zScored.map(v => Math.max(0.01, v));
            
            // æ­£è¦åŒ–
            const sum = activated.reduce((a, b) => a + b, 0);
            const normalized = activated.map(v => v / sum);
            
            // ä¸Šä½2ã¤ã‚’é¸æŠ
            const sorted = normalized.map((v, i) => ({ v, i })).sort((a, b) => b.v - a.v);
            
            return {
                isPure: sorted[0].i === sorted[1].i || Math.abs(sorted[0].v - sorted[1].v) < 0.001
            };
        }
        
        function updateComparisonChart(oldRate, newRate) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            if (comparisonChart) {
                comparisonChart.destroy();
            }
            
            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['æ—§ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆReLUï¼‰', 'æ–°ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆSoftmaxï¼‰', 'ç†è«–å€¤'],
                    datasets: [{
                        label: 'ç´”å¦ç‡ (%)',
                        data: [oldRate * 100, newRate * 100, 12.5],
                        backgroundColor: [
                            'rgba(229, 62, 62, 0.5)',
                            'rgba(102, 126, 234, 0.5)',
                            'rgba(56, 161, 105, 0.5)'
                        ],
                        borderColor: [
                            'rgba(229, 62, 62, 1)',
                            'rgba(102, 126, 234, 1)',
                            'rgba(56, 161, 105, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 30,
                            title: {
                                display: true,
                                text: 'ç´”å¦ç‡ (%)'
                            }
                        }
                    }
                }
            });
        }
        
        function updateDistributionChart(results) {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            if (distributionChart) {
                distributionChart.destroy();
            }
            
            const datasets = Object.entries(results).map(([osType, osResults]) => {
                const pureRate = osResults.filter(r => r.isPure).length / osResults.length;
                return {
                    label: osType.toUpperCase() + ' OS',
                    data: [pureRate * 100],
                    backgroundColor: {
                        engine: 'rgba(102, 126, 234, 0.5)',
                        interface: 'rgba(237, 137, 54, 0.5)',
                        safemode: 'rgba(72, 187, 120, 0.5)'
                    }[osType]
                };
            });
            
            distributionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ç´”å¦ç‡'],
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 25,
                            title: {
                                display: true,
                                text: 'ç´”å¦ç‡ (%)'
                            }
                        }
                    },
                    plugins: {
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: 12.5,
                                    yMax: 12.5,
                                    borderColor: 'rgb(255, 99, 132)',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        content: 'ç†è«–å€¤ 12.5%',
                                        enabled: true
                                    }
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function clearResults() {
            document.getElementById('singleTest').style.display = 'none';
            document.getElementById('comparisonTest').style.display = 'none';
            document.getElementById('batchTest').style.display = 'none';
            document.getElementById('concentrationTest').style.display = 'none';
        }
    </script>
</body>
</html>