'use strict';

const fs = require('fs');
const path = require('path');

function loadJSON(p) { return JSON.parse(fs.readFileSync(p, 'utf8')); }
function saveJSON(p, obj) { fs.writeFileSync(p, JSON.stringify(obj, null, 2), 'utf8'); }

function main() {
  const file = path.resolve(__dirname, '..', 'public', 'data', 'narratives_chain.v1.json');
  const db = loadJSON(file);
  
  // 乾為天 用九
  const baseKey = '乾為天 用九 | ';
  const updates = {
    JJJ: {
      chain_long:
        'まず、群龍が集まり、それぞれが自律的に動き始めます。指示を待たず、各自が最善を尽くしながら、全体の調和を保ちます。' +
        '続いて、その協働がさらに深まります。言葉を交わさずとも意図が通じ、完璧な連携が生まれます。' +
        '最後に、誰も先頭に立たない理想の組織が完成します。全員がリーダーであり、全員がサポーターという究極の形が実現します。' +
        '突破口は、個の自律と全体の調和にあります。まずは各自の強みを認め、信頼して任せることから始めましょう。',
      suitability: '成熟した組織で自律的な協働を実現したい場面',
      caution: '自律性が無秩序にならないよう、共通の価値観を確立する',
      label: '一貫深化 （テーマ継続）'
    },
    JJH: {
      chain_long:
        'まず、優秀な個が集まり、それぞれの才能を発揮します。競争ではなく、協力の精神で切磋琢磨します。' +
        '続いて、その集合体がより強固になります。個性を保ちながら、一つの有機体として機能し始めます。' +
        '最後に、組織の在り方を転換します。ヒエラルキーから、ネットワークへ。中央集権から、分散協調へと進化します。' +
        '突破口は、組織構造の革新にあります。まずは権限を分散し、各自が判断できる環境を整えましょう。',
      suitability: '従来の組織構造を超えた新しい協働形態を作りたい場面',
      caution: '急激な構造変化で混乱しないよう、段階的に移行する',
      label: '二段深化→視点切替 （構造転換）'
    },
    JHJ: {
      chain_long:
        'まず、群龍の力を結集します。個々の強みを理解し、最適な配置で力を発揮させます。' +
        '次に、協働の方法を変えます。指揮命令から、相互触発へ。管理から、共創へと関係性を転換します。' +
        '最後に、その新しい関係性を深めます。信頼が増し、創造性が高まり、想像を超える成果が生まれます。' +
        '突破口は、関係性の質的転換にあります。まずは対話を重ね、真の相互理解を築きましょう。',
      suitability: '個の力を最大限に引き出す創造的な組織を作りたい場面',
      caution: '創造性を重視しすぎて、基本的な規律を失わないよう注意',
      label: '深化→視点切替→再深化 （構造転換）'
    },
    JHH: {
      chain_long:
        'まず、全員がリーダーとして立ち上がります。責任を分かち合い、それぞれが主体的に動きます。' +
        '続いて、リーダーシップの形を変えます。固定から流動へ、役職から役割へと柔軟に変化させます。' +
        '最後に、さらに進化させます。リーダーシップから、パートナーシップへ。上下から、対等へと関係を再定義します。' +
        '突破口は、流動的な役割分担にあります。まずは状況に応じて、最適な人が前に出る文化を作りましょう。',
      suitability: '固定的な役割を超えて、柔軟な協働体制を築きたい場面',
      caution: '責任の所在が曖昧にならないよう、明確な合意形成を行う',
      label: '初動深化→連続切替 （再整流）'
    },
    HJJ: {
      chain_long:
        'まず、群龍という概念を再定義します。強者の集まりから、多様性の調和へと理解を転換します。' +
        '続いて、その新しい理解で実践します。強さだけでなく、弱さも含めて受け入れ、包括的な組織を作ります。' +
        '最後に、さらに実践を深めます。多様性が創造性を生み、弱さが強さに変わる瞬間を体験します。' +
        '突破口は、多様性の真の受容にあります。まずは違いを認め、それを強みに変える方法を見つけましょう。',
      suitability: '多様性を活かした包括的な組織を実現したい場面',
      caution: '理想論に偏らず、現実的な運営方法を確立する',
      label: '視点切替→二段深化 （構造転換）'
    },
    HJH: {
      chain_long:
        'まず、無首という理想を追求します。誰も頂点に立たない、真に平等な関係を目指します。' +
        '次に、その理想を実践で試します。困難に直面しながらも、新しい協働の形を模索します。' +
        '最後に、理想と現実を統合します。完全な平等ではなくても、実現可能な最良の形を見出します。' +
        '突破口は、理想と現実の架橋にあります。まずは小さな実験から始め、徐々に理想に近づけましょう。',
      suitability: '理想的な平等組織を現実的に実装したい場面',
      caution: '理想に固執しすぎて、実効性を失わないよう注意',
      label: '視点切替→深化→再切替 （構造転換）'
    },
    HHJ: {
      chain_long:
        'まず、個を解放します。次に、組織を解放します。二度の解放で、真の自由が生まれます。' +
        '最後に、その自由の中で秩序を見出します。カオスから、自己組織化によって新しい調和が生まれます。' +
        '突破口は、自由と秩序の両立にあります。まずは最小限のルールで、最大限の創造性を引き出しましょう。',
      suitability: '自由と創造性を最大化しながら秩序を保ちたい場面',
      caution: '自由が放縦にならないよう、核となる価値観を共有する',
      label: '連続切替→深化 （再設計）'
    },
    HHH: {
      chain_long:
        'まず、形を捨てます。続いて、名を捨てます。最後に、我を捨てます。' +
        '三度の放棄で、究極の集合意識に到達します。個と全体の境界が消え、完全な一体化が実現します。' +
        '突破口は、自我の超越にあります。まずは個人の利益を超えて、全体の幸福を第一に考えましょう。',
      suitability: '個を超えた集合知や集合意識を実現したい場面',
      caution: '個性や多様性を完全に失わないよう、バランスを保つ',
      label: '三段転換 （完全再設計）'
    }
  };

  for (const pat of Object.keys(updates)) {
    const k = baseKey + pat;
    if (!db[k]) {
      console.log(`Creating new entry: ${k}`);
      db[k] = {
        tone: 'story',
        start: { hex: '乾為天', pos: 7 }, // 用九は特殊位置
        final: {}
      };
    }
    Object.assign(db[k], updates[pat], { updated_at: new Date().toISOString() });
  }

  // finalの計算（用九は特殊なので、坤為地への転換を基本とする）
  db['乾為天 用九 | JJJ'].final = { hex: '坤為地', pos: 4 };
  db['乾為天 用九 | JJH'].final = { hex: '坤為地', pos: 3 };
  db['乾為天 用九 | JHJ'].final = { hex: '坤為地', pos: 3 };
  db['乾為天 用九 | JHH'].final = { hex: '坤為地', pos: 2 };
  db['乾為天 用九 | HJJ'].final = { hex: '坤為地', pos: 3 };
  db['乾為天 用九 | HJH'].final = { hex: '坤為地', pos: 2 };
  db['乾為天 用九 | HHJ'].final = { hex: '坤為地', pos: 2 };
  db['乾為天 用九 | HHH'].final = { hex: '坤為地', pos: 7 }; // 用六へ

  saveJSON(file, db);
  console.log('Updated 乾為天 用九 (8 patterns)');
}

main();