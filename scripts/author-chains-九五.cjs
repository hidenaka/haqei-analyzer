'use strict';

const fs = require('fs');
const path = require('path');

function loadJSON(p) { return JSON.parse(fs.readFileSync(p, 'utf8')); }
function saveJSON(p, obj) { fs.writeFileSync(p, JSON.stringify(obj, null, 2), 'utf8'); }

function main() {
  const file = path.resolve(__dirname, '..', 'public', 'data', 'narratives_chain.v1.json');
  const db = loadJSON(file);
  
  // 乾為天 九五
  const baseKey = '乾為天 九五 | ';
  const updates = {
    JJJ: {
      chain_long:
        'まず、中心に立つ重みを静かに受け止めます。声を荒げず、力を誇示せず、淡々と責務を果たしていきます。' +
        '続いて、同じ姿勢を保ちながら深めます。判断は速く、言葉は少なく、しかし確実に物事が進んでいきます。' +
        '最後に、品位ある統治が定着します。周囲の信頼が厚くなり、自然と人が集まり、協力の輪が広がります。' +
        '突破口は、誇示しない強さにあります。まずは実績で語り、謙虚な姿勢で信頼を積み重ねましょう。',
      suitability: '最高位で公正な統治やリーダーシップを発揮する場面',
      caution: '権力に酔わず、常に公平性と透明性を保つ',
      label: '一貫深化 （テーマ継続）'
    },
    JJH: {
      chain_long:
        'まず、頂点での振る舞いを確立します。威厳と親しみやすさのバランスを取りながら、存在感を示します。' +
        '続いて、その姿勢をさらに洗練させます。無駄な動きが消え、必要最小限の指示で組織が動くようになります。' +
        '最後に、視点を切り替えます。統治から育成へ、指示から委任へと重心を移し、次世代を育てます。' +
        '突破口は、成熟した後の継承準備にあります。まずは後継者を見極め、段階的に権限を移譲しましょう。',
      suitability: '絶頂期から次世代への橋渡しを考える場面',
      caution: '早すぎる権限移譲で組織が混乱しないよう注意',
      label: '二段深化→視点切替 （構造転換）'
    },
    JHJ: {
      chain_long:
        'まず、王者の風格を身につけます。一挙手一投足に意味を持たせ、存在そのものがメッセージとなります。' +
        '次に、視点を変えます。上から見下ろす視点から、横に並ぶ視点へと意識を調整します。' +
        '最後に、その新しい視点で深めます。対等な関係の中で、真の尊敬と協力を引き出していきます。' +
        '突破口は、威厳と親近感の両立にあります。まずは相手の立場に立ち、共感を示してから導きましょう。',
      suitability: '権威を保ちながら協調的な関係を築きたい場面',
      caution: '親しみやすさが軽さと誤解されないよう、芯を保つ',
      label: '深化→視点切替→再深化 （構造転換）'
    },
    JHH: {
      chain_long:
        'まず、完璧な統治を目指します。細部まで目を配り、公正な判断を積み重ねていきます。' +
        '続いて、統治の方法を変えます。直接から間接へ、明示から暗示へと手法を切り替えます。' +
        '最後に、さらに手法を変えます。統制から自律へ、管理から支援へと役割を転換します。' +
        '突破口は、段階的な手法の転換にあります。まずは小さな範囲で試し、効果を確認してから展開しましょう。',
      suitability: '管理型から支援型のリーダーシップへ移行したい場面',
      caution: '急激な変化で現場が混乱しないよう、移行期間を設ける',
      label: '初動深化→連続切替 （再整流）'
    },
    HJJ: {
      chain_long:
        'まず、従来の王道を見直します。時代に合わない部分を認識し、新しい統治の形を模索します。' +
        '続いて、新しいスタイルで深めます。試行錯誤を重ねながら、より効果的な方法を見つけていきます。' +
        '最後に、さらに磨きをかけます。細部を調整し、新しい王道として確立させます。' +
        '突破口は、伝統と革新の融合にあります。まずは守るべきものと変えるべきものを明確に分けましょう。',
      suitability: '伝統的な方法を現代的にアップデートしたい場面',
      caution: '革新に走りすぎて、大切な本質を失わないよう注意',
      label: '視点切替→二段深化 （構造転換）'
    },
    HJH: {
      chain_long:
        'まず、王位の意味を問い直します。権力から奉仕へ、支配から貢献へと本質を転換します。' +
        '次に、その新しい理解で実践します。言動が変わり、周囲の反応も変わっていきます。' +
        '最後に、再び意味を更新します。固定化を避け、常に進化する統治を心がけます。' +
        '突破口は、概念の継続的な更新にあります。まずは固定観念を手放し、時代と共に成長しましょう。',
      suitability: '既存の権威概念を超えて新しいリーダー像を作りたい場面',
      caution: '理想論に偏りすぎて、現実的な統治力を失わないよう注意',
      label: '視点切替→深化→再切替 （構造転換）'
    },
    HHJ: {
      chain_long:
        'まず、王座から降ります。次に、民衆の中に入ります。二度の降下で、真の声が聞こえてきます。' +
        '最後に、新しい高みへ昇ります。下から積み上げた理解が、より強固な統治の基盤となります。' +
        '突破口は、一度降りる勇気にあります。まずは現場の声を直接聞き、そこから再構築しましょう。',
      suitability: '現場理解を深めてから新たな高みを目指したい場面',
      caution: '降りすぎて権威を失わないよう、バランスを保つ',
      label: '連続切替→深化 （再設計）'
    },
    HHH: {
      chain_long:
        'まず、王を超えます。続いて、人を超えます。最後に、時を超えます。' +
        '三度の超越で、永遠の理想に到達します。個人を超えた普遍的な価値を体現し、時代を超えて語り継がれる存在となります。' +
        '突破口は、究極の無私にあります。まずは自我を捨て、全体の幸福のために生きる覚悟を決めましょう。',
      suitability: '個人を超えた普遍的な価値を実現したい場面',
      caution: '理想が高すぎて孤立しないよう、現実との接点を保つ',
      label: '三段転換 （完全再設計）'
    }
  };

  for (const pat of Object.keys(updates)) {
    const k = baseKey + pat;
    if (!db[k]) {
      console.log(`Creating new entry: ${k}`);
      db[k] = {
        tone: 'story',
        start: { hex: '乾為天', pos: 5 },
        final: {}
      };
    }
    Object.assign(db[k], updates[pat], { updated_at: new Date().toISOString() });
  }

  // finalの計算（九五から3回の変化）
  // 注：pos 6の次は序卦伝に従って次の卦へ
  db['乾為天 九五 | JJJ'].final = { hex: '坤為地', pos: 2 };
  db['乾為天 九五 | JJH'].final = { hex: '天風姤', pos: 7 }; // 用九的な特殊ケース
  db['乾為天 九五 | JHJ'].final = { hex: '火天大有', pos: 1 };
  db['乾為天 九五 | JHH'].final = { hex: '乾為天', pos: 6 };
  db['乾為天 九五 | HJJ'].final = { hex: '火天大有', pos: 1 };
  db['乾為天 九五 | HJH'].final = { hex: '天火同人', pos: 6 };
  db['乾為天 九五 | HHJ'].final = { hex: '火天大有', pos: 6 };
  db['乾為天 九五 | HHH'].final = { hex: '火天大有', pos: 5 };

  saveJSON(file, db);
  console.log('Updated 乾為天 九五 (8 patterns)');
}

main();