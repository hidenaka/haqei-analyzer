'use strict';

const fs = require('fs');
const path = require('path');

function loadJSON(p) { return JSON.parse(fs.readFileSync(p, 'utf8')); }
function saveJSON(p, obj) { fs.writeFileSync(p, JSON.stringify(obj, null, 2), 'utf8'); }

// 水雷屯の各爻に対する詳細な物語
function create水雷屯Narratives() {
  const narratives = {};
  
  // 水雷屯 初九
  narratives['水雷屯 初九 | JJJ'] = {
    chain_long: 'まず、困難の中で動けない状況を受け入れます。大きな石が道を塞いでいるように見えますが、焦って無理に動かそうとせず、石の周りの地形を観察し、別の道筋を探る時期です。続いて、少しずつ活路が見えてきます。石を避ける小道を発見し、一歩ずつ確実に進むことで、困難は徐々に小さくなっていきます。仲間との協力も得られるようになります。最後に、困難を乗り越える知恵が身につきます。今回の経験が次の困難に立ち向かう力となり、リーダーシップを発揮できる準備が整います。突破口は、困難を学びの機会と捉えることにあります。まずは現状を冷静に分析し、小さな一歩から始めましょう。',
    tone: 'story',
    suitability: '創業期や新規事業の立ち上げで困難に直面している場面',
    caution: '焦って無理に進もうとせず、着実な基盤作りを優先する',
    label: '一貫深化 （テーマ継続）'
  };
  
  narratives['水雷屯 初九 | JJH'] = {
    chain_long: 'まず、動けない状況で基礎体力を養います。すぐには前進できませんが、その場でできる準備を整え、知識を蓄え、必要な道具を揃えていきます。この準備期間が後の飛躍を支えます。続いて、準備がさらに充実します。理論を学び、シミュレーションを重ね、あらゆる可能性を検討することで、動き出す時の成功確率が高まります。最後に、視点を変えて協力者を探します。一人で突破しようとするのではなく、チームを作ることで、困難は分割され、解決可能になります。突破口は、準備期間を有効活用することにあります。まずは今できることに集中し、機が熟すのを待ちましょう。',
    tone: 'story',
    suitability: '準備期間を経て、協力体制を構築したい場面',
    caution: '準備に時間をかけすぎて、タイミングを逃さないよう注意',
    label: '二段深化→視点切替 （構造転換）'
  };

  // 水雷屯 六二
  narratives['水雷屯 六二 | JJJ'] = {
    chain_long: 'まず、進退に迷う状況を慎重に見極めます。馬車が泥にはまったように、前にも後ろにも動けない時は、無理に動かず、地面が乾くのを待つ賢明さが必要です。続いて、待つ間に状況が好転し始めます。援助の申し出が来たり、新しい情報が入ったりして、次第に進むべき道が明確になってきます。忍耐が実を結び始めます。最後に、適切なタイミングで動き出します。十分な準備と情報収集を経て、確信を持って前進できるようになります。待った甲斐があったと実感できる成果が得られます。突破口は、待つことの価値を理解することにあります。まずは状況を正確に把握し、最適なタイミングを見極めましょう。',
    tone: 'story',
    suitability: '重要な決断を迫られているが、情報不足で迷っている場面',
    caution: '優柔不断と慎重さを混同せず、時期が来たら決断する',
    label: '一貫深化 （テーマ継続）'
  };

  // 水雷屯 六三
  narratives['水雷屯 六三 | HJJ'] = {
    chain_long: 'まず、従来の方法を捨てて新しいアプローチを試みます。深い森で道に迷った時、来た道を戻るのではなく、高い場所に登って全体を見渡すような発想の転換が必要です。次に、新しい視点から問題を深く分析します。高所から見ることで、森の構造が理解でき、最短ルートが見えてきます。これまで見えなかった解決策が次々と発見されます。最後に、発見した方法をさらに洗練させます。理論を実践に移し、細部を調整することで、確実に機能する解決策が完成します。困難は成長の糧となります。突破口は、視点を変える勇気にあります。まずは固定観念を捨て、全く新しい角度から問題を見直しましょう。',
    tone: 'story',
    suitability: '従来の方法で行き詰まり、革新的な解決策が必要な場面',
    caution: '新しい方法に固執しすぎず、実用性を重視する',
    label: '視点切替→二段深化 （構造転換）'
  };

  // 他の爻も同様に詳細に作成...
  
  return narratives;
}

// 山水蒙の各爻に対する詳細な物語
function create山水蒙Narratives() {
  const narratives = {};
  
  // 山水蒙 初六
  narratives['山水蒙 初六 | JJJ'] = {
    chain_long: 'まず、無知を自覚し、学ぶ姿勢を整えます。幼児が言葉を覚えるように、一つ一つの概念を丁寧に理解し、基礎知識を積み重ねていきます。恥ずかしがらずに質問することが大切です。続いて、学習が加速し始めます。基礎が固まることで、新しい知識の吸収が早くなり、点と点がつながって線になり、やがて面として理解できるようになります。最後に、知識が知恵へと昇華します。学んだことを実践で活かし、自分なりの理解を深めることで、他人に教えられるレベルまで成長します。突破口は、素直な学習姿勢にあります。まずは自分の無知を認め、謙虚に学び始めましょう。',
    tone: 'story',
    suitability: '新しい分野を学び始める時や、初心者として成長したい場面',
    caution: '知ったかぶりをせず、基礎を疎かにしない',
    label: '一貫深化 （テーマ継続）'
  };

  narratives['山水蒙 九二 | JHJ'] = {
    chain_long: 'まず、教える立場として基本を伝えます。生徒の理解度を確認しながら、一つ一つ丁寧に説明し、相手が理解するまで根気よく付き合います。教えることで自分も学びます。次に、教え方を変えてみます。講義形式から対話形式へ、理論から実践へと方法を切り替えることで、生徒の理解が深まり、新しい気づきが生まれます。最後に、新しい方法でさらに深く教えます。生徒の個性に合わせた指導法を確立し、それぞれの才能を最大限に引き出すことができるようになります。突破口は、教え方の柔軟性にあります。まずは相手を理解し、最適な方法を見つけましょう。',
    tone: 'story',
    suitability: '指導者として人を育てる場面や、知識を伝える必要がある時',
    caution: '一方的な教え込みにならず、相手の成長を見守る',
    label: '深化→視点切替→再深化 （構造転換）'
  };

  // 他の爻も同様に...
  
  return narratives;
}

function main() {
  const file = path.resolve(__dirname, '..', 'public', 'data', 'narratives_chain.v1.json');
  const db = loadJSON(file);
  
  // 水雷屯と山水蒙から丁寧に作り直し
  const 水雷屯 = create水雷屯Narratives();
  const 山水蒙 = create山水蒙Narratives();
  
  // データベースを更新
  Object.entries(水雷屯).forEach(([key, value]) => {
    db[key] = { ...db[key], ...value, updated_at: new Date().toISOString() };
  });
  
  Object.entries(山水蒙).forEach(([key, value]) => {
    db[key] = { ...db[key], ...value, updated_at: new Date().toISOString() };
  });
  
  saveJSON(file, db);
  console.log('水雷屯と山水蒙の物語を丁寧に書き直しました');
  console.log(`水雷屯: ${Object.keys(水雷屯).length}件`);
  console.log(`山水蒙: ${Object.keys(山水蒙).length}件`);
}

main();