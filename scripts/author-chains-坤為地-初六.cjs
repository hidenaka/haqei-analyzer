'use strict';

const fs = require('fs');
const path = require('path');

function loadJSON(p) { return JSON.parse(fs.readFileSync(p, 'utf8')); }
function saveJSON(p, obj) { fs.writeFileSync(p, JSON.stringify(obj, null, 2), 'utf8'); }

function main() {
  const file = path.resolve(__dirname, '..', 'public', 'data', 'narratives_chain.v1.json');
  const db = loadJSON(file);
  
  // 坤為地 初六
  const baseKey = '坤為地 初六 | ';
  const updates = {
    JJJ: {
      chain_long:
        'まず、霜を踏む感触から始まります。小さな冷たさが、やがて来る厳しい冬の予兆だと気づき、静かに備えを始めます。' +
        '続いて、その予感を深く受け止めます。表には出さず、内側で着実に準備を重ね、来るべき時に備えます。' +
        '最後に、備えが形になり始めます。目立たない努力が、確かな土台となって、次の段階を支える力になります。' +
        '突破口は、小さな兆候を見逃さないことにあります。まずは観察力を研ぎ澄まし、変化の予兆を察知しましょう。',
      suitability: '将来のリスクを察知し、早期に準備を始めたい場面',
      caution: '過度な心配で動けなくならないよう、適度な楽観も保つ',
      label: '一貫深化 （テーマ継続）'
    },
    JJH: {
      chain_long:
        'まず、小さな変化の兆しを感じ取ります。霜が示す冬の到来のように、確実に迫る変化を察知します。' +
        '続いて、その察知を確信に変えます。データを集め、傾向を分析し、予測の精度を高めていきます。' +
        '最後に、視点を切り替えます。守りから攻めへ、受動から能動へと姿勢を転換し、変化を機会に変えます。' +
        '突破口は、予測から行動への転換にあります。まずはリスクをチャンスと捉え、先手を打って動きましょう。',
      suitability: '変化を予測し、それを機会として活用したい場面',
      caution: '予測に頼りすぎて、現実への対応が遅れないよう注意',
      label: '二段深化→視点切替 （構造転換）'
    },
    JHJ: {
      chain_long:
        'まず、地に足をつけて歩き始めます。一歩一歩を確実に、焦らず着実に前進していきます。' +
        '次に、歩き方を変えます。直線から曲線へ、硬さから柔らかさへと動きを調整します。' +
        '最後に、その新しい歩みを深めます。リズムが生まれ、流れが良くなり、自然な前進が続きます。' +
        '突破口は、柔軟な歩みにあります。まずは状況に応じて歩幅を調整し、無理のない進み方を見つけましょう。',
      suitability: '着実かつ柔軟に前進したい場面',
      caution: '柔軟すぎて方向性を見失わないよう、目標を明確に保つ',
      label: '深化→視点切替→再深化 （構造転換）'
    },
    JHH: {
      chain_long:
        'まず、受け身の姿勢で始めます。周囲の動きを観察し、流れを読みながら、自分の位置を確認します。' +
        '続いて、観察の視点を変えます。表面から深層へ、現象から本質へと理解を深めていきます。' +
        '最後に、さらに視点を転換します。観察から洞察へ、理解から予測へと能力を高めます。' +
        '突破口は、深い洞察力にあります。まずは表面的な動きに惑わされず、本質を見抜く目を養いましょう。',
      suitability: '観察と洞察を通じて、深い理解を得たい場面',
      caution: '分析に時間をかけすぎて、行動のタイミングを逃さない',
      label: '初動深化→連続切替 （再整流）'
    },
    HJJ: {
      chain_long:
        'まず、従来の受動的な立場を見直します。待つだけでなく、積極的に情報を集める姿勢に転換します。' +
        '続いて、その新しい姿勢で行動を深めます。情報網を広げ、感度を上げ、より早く変化を察知します。' +
        '最後に、さらに能力を磨きます。察知から予測へ、予測から対策へと、先読みの精度を高めます。' +
        '突破口は、受動的知性の能動化にあります。まずはアンテナを高く張り、積極的に情報を取りに行きましょう。',
      suitability: '受け身の立場から、情報優位を作りたい場面',
      caution: '情報収集に偏りすぎて、実行力が落ちないよう注意',
      label: '視点切替→二段深化 （構造転換）'
    },
    HJH: {
      chain_long:
        'まず、地の力を別の角度から理解します。支える力から、育てる力へと認識を転換します。' +
        '次に、その理解で実践します。種を蒔き、水をやり、じっくりと成長を待つ姿勢を身につけます。' +
        '最後に、再び視点を変えます。育てるから、育つへ。能動から受動へと、自然の流れに任せます。' +
        '突破口は、育成と委任のバランスにあります。まずは種を蒔いたら、過度に干渉せず成長を見守りましょう。',
      suitability: '育成や長期的な成長を支援したい場面',
      caution: '放任しすぎて、必要な支援を怠らないよう注意',
      label: '視点切替→深化→再切替 （構造転換）'
    },
    HHJ: {
      chain_long:
        'まず、地という概念を拡張します。物理的な大地から、精神的な基盤へと理解を広げます。' +
        '次に、その基盤を別の形に変えます。固定から流動へ、安定から変化へと性質を転換します。' +
        '最後に、新しい基盤を確立します。変化の中にも不変のものを見出し、動的な安定を作り出します。' +
        '突破口は、動的平衡の実現にあります。まずは変化を恐れず、その中で軸を保つ方法を見つけましょう。',
      suitability: '変化の中で安定を保ちたい場面',
      caution: '変化に流されて、本質的な価値を見失わないよう注意',
      label: '連続切替→深化 （再設計）'
    },
    HHH: {
      chain_long:
        'まず、形を変えます。続いて、質を変えます。最後に、次元を変えます。' +
        '三度の変容で、地は天となり、天は地となります。陰陽が循環し、終わりが始まりとなる永遠の流れを体現します。' +
        '突破口は、対極の統合にあります。まずは二元論を超えて、全体性の中で物事を捉えましょう。',
      suitability: '根本的な変革や、対極の統合を目指す場面',
      caution: '抽象的になりすぎて、実践性を失わないよう注意',
      label: '三段転換 （完全再設計）'
    }
  };

  for (const pat of Object.keys(updates)) {
    const k = baseKey + pat;
    if (!db[k]) {
      console.log(`Creating new entry: ${k}`);
      db[k] = {
        tone: 'story',
        start: { hex: '坤為地', pos: 1 },
        final: {}
      };
    }
    Object.assign(db[k], updates[pat], { updated_at: new Date().toISOString() });
  }

  // finalの計算（初六から3回の変化）
  db['坤為地 初六 | JJJ'].final = { hex: '坤為地', pos: 4 };
  db['坤為地 初六 | JJH'].final = { hex: '地雷復', pos: 3 };
  db['坤為地 初六 | JHJ'].final = { hex: '地山謙', pos: 3 };
  db['坤為地 初六 | JHH'].final = { hex: '坤為地', pos: 2 };
  db['坤為地 初六 | HJJ'].final = { hex: '地雷復', pos: 3 };
  db['坤為地 初六 | HJH'].final = { hex: '地雷復', pos: 2 };
  db['坤為地 初六 | HHJ'].final = { hex: '地雷復', pos: 2 };
  db['坤為地 初六 | HHH'].final = { hex: '地雷復', pos: 1 };

  saveJSON(file, db);
  console.log('Updated 坤為地 初六 (8 patterns)');
}

main();