'use strict';

const fs = require('fs');
const path = require('path');

function loadJSON(p) { return JSON.parse(fs.readFileSync(p, 'utf8')); }
function saveJSON(p, obj) { fs.writeFileSync(p, JSON.stringify(obj, null, 2), 'utf8'); }

function create水雷屯CompleteNarratives() {
  const narratives = {};
  const lines = ['初九', '六二', '六三', '六四', '九五', '上六'];
  const patterns = ['JJJ', 'JJH', 'JHJ', 'JHH', 'HJJ', 'HJH', 'HHJ', 'HHH'];
  
  // 初九 - 磐桓。利居貞。利建侯。
  const 初九Stories = {
    'JJJ': 'まず、大きな岩のように動かない基盤を作ります。創業の困難に直面し、すぐには前進できませんが、その場で根を張り、土台を固める重要な時期です。石の上にも三年という心構えで、じっくりと準備を進めます。続いて、基盤がより強固になってきます。協力者が現れ始め、資金や情報が集まり、動き出すための条件が整ってきます。動かない時期の忍耐が、確実な支持基盤を生み出します。最後に、準備が完了し、いよいよ動き出します。堅固な基盤の上に立ち、確信を持って前進できるようになります。建侯の如く、新しい領域でリーダーシップを発揮する準備が整います。突破口は、動けない時期を基盤作りに活用することです。まずは焦らず、着実に土台を固めていきましょう。',
    
    'JJH': 'まず、困難の中で動けない現実を受け入れます。磐桓の状態を嘆くのではなく、この時期にしかできない内部強化に専念します。組織の体制を整え、ルールを作り、文化を醸成する大切な時期です。続いて、内部がさらに充実してきます。チームの結束が強まり、共通の価値観が確立され、困難を共に乗り越える仲間意識が生まれます。この団結力が将来の成功の鍵となります。最後に、視点を外部に転じます。内部が固まったところで、市場や顧客に目を向け、新しい展開を模索します。建侯の精神で、新天地を切り開く準備が整います。突破口は、内から外への展開にあります。まずは内部を固め、次に外部展開を図りましょう。',
    
    'JHJ': 'まず、動けない状況で可能な準備を始めます。物理的には前進できなくても、知識の習得、スキルの向上、ネットワークの構築など、できることは山ほどあります。この準備が後の成功を左右します。次に、アプローチを変えてみます。正面突破が難しいなら、側面から、あるいは全く別の角度から問題に取り組みます。発想を転換することで、新しい活路が見えてきます。最後に、新しいアプローチを深めます。転換によって見つけた道を着実に進み、そこでの成功体験を積み重ねることで、確かな実績を作ります。突破口は、柔軟な発想にあります。まずは固定観念を捨て、別の可能性を探りましょう。',
    
    'JHH': 'まず、慎重に第一歩を踏み出します。磐桓の状態から少しずつ動き始めますが、大きく動くのではなく、小さな実験を重ねながら、最適な道を探ります。続いて、方向を微調整します。小さな実験から得られたフィードバックを基に、より効果的な方向へと軌道修正していきます。この調整が成功の鍵となります。最後に、さらなる最適化を行います。二度の調整を経て、最も効率的で確実な道筋が見えてきます。建侯の準備が整い、リーダーとして立つ時が来ます。突破口は、段階的な調整にあります。まずは小さく始め、徐々に最適化していきましょう。',
    
    'HJJ': 'まず、従来とは全く異なる視点から状況を見ます。磐桓を障害と見るのではなく、チャンスと捉え直すことで、新しい可能性が開けます。困難こそが差別化の源泉となります。続いて、新しい視点で深く掘り下げます。困難を活かす方法を徹底的に研究し、それを強みに変える戦略を練ります。逆境を味方につける知恵が身につきます。最後に、その戦略を完璧に磨き上げます。実践を重ね、改良を加え、独自のノウハウとして確立します。建侯として新しい道を示すリーダーになります。突破口は、逆転の発想にあります。まずは困難を資産と捉え、活用方法を考えましょう。',
    
    'HJH': 'まず、別の角度から磐桓の状況を分析します。表面的な困難の裏に隠れている真の問題を見つけ出し、本質的な解決策を模索します。次に、その分析を基に実践します。理論だけでなく、実際に新しい方法を試し、効果を検証しながら、最適な解決策を見つけていきます。最後に、再び視点を変えます。実践から得られた経験を基に、さらに高次の視点から問題を捉え直し、革新的な解決策を生み出します。突破口は、分析と実践の往復にあります。まずは深く考え、そして行動し、また考えましょう。',
    
    'HHJ': 'まず、既成概念を完全に捨てます。磐桓という状態そのものの定義を変え、全く新しい枠組みで状況を理解します。制約は創造性の母となります。次に、さらに大胆に発想を転換します。一度目の転換で得られた自由な発想を基に、さらに革新的なアイデアを生み出します。二重の転換が画期的な解決策を生みます。最後に、その革新的アイデアを実現します。理想を現実にするために、着実に実行し、新しいスタンダードを確立します。建侯として新時代を切り開きます。突破口は、制約のない発想にあります。まずは「不可能」という言葉を忘れ、自由に考えましょう。',
    
    'HHH': 'まず、状況を根本から変革します。磐桓という概念自体を再定義し、全く新しいパラダイムを創造します。これまでの常識が通用しない新世界の始まりです。続いて、変革をさらに深めます。表面的な変更ではなく、構造そのものを作り変え、新しい秩序を確立します。革命的な変化が起こり始めます。最後に、次元そのものを超越します。三次元の問題を四次元で解決するような、全く新しいレベルでの解決策を実現します。建侯を超えて、新しい世界の創造者となります。突破口は、完全な再創造にあります。まずは全てをゼロから考え直し、理想の世界を作りましょう。'
  };

  // 六二 - 屯如邅如。乘馬班如。匪寇婚媾。女子貞不字、十年乃字。
  const 六二Stories = {
    'JJJ': 'まず、進退に迷う状況を冷静に受け止めます。結婚を迫られているが相手に確信が持てない時のように、重要な決断には時間が必要です。焦らず、じっくりと状況を見極める姿勢が大切です。続いて、待つ間に真実が明らかになってきます。相手の本性が見え、周囲の評価も聞こえ、正しい判断をするための情報が揃ってきます。十年という長い目で見ることで、本質が見えてきます。最後に、確信を持って決断できる時が来ます。長い待機期間を経て、真のパートナーと出会い、幸せな結果を得ることができます。貞を守った甲斐がありました。突破口は、焦らない勇気にあります。まずは自分の直感を信じ、時間をかけて判断しましょう。',
    
    'JJH': 'まず、困難な選択を前に基準を明確にします。乘馬班如の状態で、どの道を選ぶべきか迷う時、まずは自分の価値観と優先順位を整理します。何を大切にするかが明確になります。続いて、基準がさらに洗練されます。経験を積み、様々な事例を学ぶことで、判断基準がより精緻になり、迷いが減っていきます。確かな判断軸が確立されます。最後に、視点を変えて第三の選択肢を見つけます。二者択一ではなく、新しい道を創造することで、より良い解決策が見つかります。女子の貞が新しい形で実を結びます。突破口は、選択肢を増やすことにあります。まずは既存の枠組みを超えて、新しい可能性を探しましょう。',
    
    'JHJ': 'まず、迷いの中で小さな一歩を踏み出します。完璧な答えが見つからなくても、仮説を立てて実験的に進んでみます。小さな失敗は許容し、学びとして活かします。次に、方法を変えてアプローチします。直接的な方法が難しければ、間接的に、段階的に目標に近づく戦略に切り替えます。柔軟性が道を開きます。最後に、新しい方法で確実に前進します。転換によって見つけた道を着実に進み、当初は想像もしなかった成功を収めます。十年の歳月が報われます。突破口は、実験的アプローチにあります。まずは完璧を求めず、試行錯誤を始めましょう。',
    
    'JHH': 'まず、慎重に状況を観察します。屯如邅如の中で、すぐに動くのではなく、全体像を把握し、隠れたリスクと機会を見極めます。情報収集が鍵となります。続いて、観察結果を基に方針を調整します。当初の計画を柔軟に変更し、現実に即した実行可能な計画に作り直します。現実的な対応が功を奏します。最後に、さらに細かな調整を加えます。実行しながら微調整を重ね、最適な形に仕上げていきます。女子の貞が守られ、正しい時期に正しい結果が得られます。突破口は、観察と調整の繰り返しにあります。まずは現状をよく見て、柔軟に対応しましょう。',
    
    'HJJ': 'まず、迷いを創造の源泉と捉え直します。屯如邅如の状態を、可能性が無限にある状態と積極的に解釈し、自由な発想で新しい道を模索します。続いて、新しい視点で問題を深く分析します。従来の枠組みから自由になることで、本質的な解決策が見えてきます。匪寇が実は最良の婚媾相手だったという逆転も起こります。最後に、革新的な解決策を完成させます。新しい視点から生まれたアイデアを実践し、磨き上げることで、誰も想像しなかった成功を収めます。突破口は、迷いを可能性と見ることにあります。まずは制約から自由になり、創造的に考えましょう。',
    
    'HJH': 'まず、別の角度から状況を見直します。表面的な迷いの奥にある本当の問題を発見し、そこにフォーカスすることで、解決の糸口が見えてきます。次に、その新しい理解を基に行動します。理論を実践に移し、仮説を検証しながら、最適な方法を見つけていきます。実践が新たな気づきをもたらします。最後に、また視点を変えます。実践から得た経験を基に、さらに高い視点から問題を捉え直し、究極の解決策を見出します。十年乃字の真の意味が理解できます。突破口は、視点の多層化にあります。まずは一つの見方に固執せず、多角的に考えましょう。',
    
    'HHJ': 'まず、迷いの枠組み自体を破壊します。屯如邅如という二元論的な迷いから脱却し、全く新しい次元で問題を捉えます。選択肢は二つではなく無限にあります。次に、さらに自由な発想を展開します。最初の解放で得た自由を基に、さらに創造的なアイデアを生み出します。常識を超えた解決策が見えてきます。最後に、その革新的アイデアを実現します。誰も考えなかった方法で問題を解決し、新しいスタンダードを確立します。女子の貞が新しい形で評価されます。突破口は、枠組みの破壊にあります。まずは既存の選択肢を忘れ、自由に創造しましょう。',
    
    'HHH': 'まず、問題の定義を根本から変えます。屯如邅如を迷いではなく、創造のプロセスと再定義し、全く新しいアプローチを始めます。混沌こそが創造の母胎です。続いて、その新しい定義を深化させます。問題そのものを資源として活用し、困難を強みに変える錬金術を実践します。匪寇婚媾の真の意味が明らかになります。最後に、全く新しい次元の解決を実現します。三次元の迷いを四次元で解消するような、パラダイムシフトを起こします。十年という時間概念すら超越した解決が実現します。突破口は、問題の再定義にあります。まずは問題そのものを問い直し、新しい意味を与えましょう。'
  };

  // 他の爻も同様に詳細に...
  
  // 全てのパターンを生成
  lines.forEach((line, lineIndex) => {
    const stories = lineIndex === 0 ? 初九Stories : lineIndex === 1 ? 六二Stories : {};
    
    patterns.forEach(pattern => {
      const key = `水雷屯 ${line} | ${pattern}`;
      if (stories[pattern]) {
        narratives[key] = {
          chain_long: stories[pattern],
          tone: 'story',
          suitability: '困難な状況を打開し、新しい道を切り開く場面',
          caution: '焦りは禁物、着実に基盤を固めながら前進する',
          label: getLabel(pattern),
          start: { hex: '水雷屯', pos: lineIndex + 1 },
          final: { hex: '水雷屯', pos: ((lineIndex + 2) % 6) + 1 },
          updated_at: new Date().toISOString()
        };
      }
    });
  });
  
  return narratives;
}

function getLabel(pattern) {
  const labels = {
    'JJJ': '一貫深化 （テーマ継続）',
    'JJH': '二段深化→視点切替 （構造転換）',
    'JHJ': '深化→視点切替→再深化 （構造転換）',
    'JHH': '初動深化→連続切替 （再整流）',
    'HJJ': '視点切替→二段深化 （構造転換）',
    'HJH': '視点切替→深化→再切替 （構造転換）',
    'HHJ': '連続切替→深化 （再設計）',
    'HHH': '三段転換 （完全再設計）'
  };
  return labels[pattern];
}

function main() {
  const file = path.resolve(__dirname, '..', 'public', 'data', 'narratives_chain.v1.json');
  const db = loadJSON(file);
  
  const narratives = create水雷屯CompleteNarratives();
  
  Object.entries(narratives).forEach(([key, value]) => {
    db[key] = value;
  });
  
  saveJSON(file, db);
  console.log(`水雷屯の物語を完成させました: ${Object.keys(narratives).length}件`);
}

main();