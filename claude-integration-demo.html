<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claudeçµ±åˆç²¾åº¦å‘ä¸Šã‚·ã‚¹ãƒ†ãƒ  - ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ§ </text></svg>">
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .demo-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .demo-section:hover {
            transform: translateY(-5px);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-area {
            margin-bottom: 20px;
        }

        .input-area label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .input-area textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            resize: vertical;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-area textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .options-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        .analyze-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .analyze-button:hover {
            transform: translateY(-2px);
        }

        .analyze-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-area {
            margin-top: 25px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .comparison-chart {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            grid-column: 1 / -1;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #718096;
            font-size: 0.9rem;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success { background-color: #48bb78; }
        .status-warning { background-color: #ed8936; }
        .status-error { background-color: #f56565; }

        .component-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .component-card {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #667eea;
        }

        .component-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .component-stats {
            font-size: 0.9rem;
            color: #718096;
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .success-message {
            background: #c6f6d5;
            color: #2f855a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #667eea;
            margin: 20px 0;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hexagram-result {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .hexagram-info {
            flex: 1;
        }

        .hexagram-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .confidence-bar {
            width: 100px;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #667eea);
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .options-panel {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  Claudeçµ±åˆç²¾åº¦å‘ä¸Šã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>386çˆ»ãƒãƒƒãƒ”ãƒ³ã‚°ç²¾åº¦ã‚’23% â†’ 50-60%ã«å‘ä¸Šã•ã›ã‚‹ã‚¼ãƒ­ã‚³ã‚¹ãƒˆAIã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <!-- ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆ -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="currentAccuracy">23.4%</div>
                <div class="metric-label">ç¾åœ¨ã®ç²¾åº¦</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="targetAccuracy">55.0%</div>
                <div class="metric-label">ç›®æ¨™ç²¾åº¦</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="totalAnalyses">0</div>
                <div class="metric-label">ç·åˆ†æå›æ•°</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="averageTime">0ms</div>
                <div class="metric-label">å¹³å‡å‡¦ç†æ™‚é–“</div>
            </div>
        </div>

        <div class="demo-grid">
            <!-- åˆ†æå®Ÿè¡Œãƒ‘ãƒãƒ« -->
            <div class="demo-section">
                <h2 class="section-title">
                    ğŸ” çµ±åˆåˆ†æå®Ÿè¡Œ
                </h2>
                
                <div class="input-area">
                    <label for="userInput">ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ:</label>
                    <textarea 
                        id="userInput" 
                        placeholder="ä¾‹: æœ€è¿‘ä»•äº‹ã§æ‚©ã‚“ã§ã„ã¾ã™ã€‚ä¸Šå¸ã¨ã®é–¢ä¿‚ã‚‚è‰¯ããªã„ã—ã€å°†æ¥ãŒä¸å®‰ã§ã™ã€‚"
                    ></textarea>
                </div>

                <div class="options-panel">
                    <div class="option-item">
                        <input type="checkbox" id="useClaudeAnalysis" checked>
                        <label for="useClaudeAnalysis">Claudeé«˜åº¦åˆ†æ</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="useContextualMapping" checked>
                        <label for="useContextualMapping">æ–‡è„ˆç†è§£ãƒãƒƒãƒ”ãƒ³ã‚°</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="optimizeTemplates" checked>
                        <label for="optimizeTemplates">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæœ€é©åŒ–</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="enableAccuracyTesting" checked>
                        <label for="enableAccuracyTesting">ç²¾åº¦æ¤œè¨¼</label>
                    </div>
                </div>

                <button class="analyze-button" id="analyzeButton" onclick="performAnalysis()">
                    çµ±åˆåˆ†æã‚’å®Ÿè¡Œ
                </button>

                <div id="analysisResults" class="results-area" style="display: none;">
                    <!-- åˆ†æçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </div>

            <!-- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç›£è¦– -->
            <div class="demo-section">
                <h2 class="section-title">
                    ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç›£è¦–
                </h2>
                
                <div id="systemStatus">
                    <div class="loading">
                        <div class="spinner"></div>
                        ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ä¸­...
                    </div>
                </div>

                <div class="component-status" id="componentStatus" style="display: none;">
                    <!-- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçŠ¶æ…‹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </div>
        </div>

        <!-- ç²¾åº¦æ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆ -->
        <div class="comparison-chart">
            <h2 class="section-title">
                ğŸ“ˆ ç²¾åº¦æ”¹å–„åŠ¹æœæ¯”è¼ƒ
            </h2>
            <canvas id="accuracyChart" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- å¿…è¦ãªJavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ -->
    <script src="./public/assets/H384H64database.js"></script>
    <script src="./public/js/pages/future-simulator/HexagramPatternTemplates.js"></script>
    <script src="./public/js/pages/future-simulator/DynamicKeywordGenerator.js"></script>
    <script src="./public/js/pages/future-simulator/IntegratedAnalysisEngine.js"></script>
    <script src="./public/js/pages/future-simulator/ClaudeAnalysisEngine.js"></script>
    <script src="./public/js/pages/future-simulator/SmartTemplateOptimizer.js"></script>
    <script src="./public/js/pages/future-simulator/ContextualMappingSystem.js"></script>
    <script src="./public/js/pages/future-simulator/ZeroCostAccuracyTester.js"></script>
    <script src="./public/js/pages/future-simulator/ClaudeIntegrationManager.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let integrationManager = null;
        let accuracyChart = null;
        let systemStats = {
            totalAnalyses: 0,
            successfulAnalyses: 0,
            averageTime: 0,
            currentAccuracy: 23.4
        };

        // ãƒ‡ãƒ¢ç”¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
        const demoTestCases = [
            {
                text: "æœ€è¿‘ä»•äº‹ã§æ‚©ã‚“ã§ã„ã¾ã™ã€‚ä¸Šå¸ã¨ã®é–¢ä¿‚ã‚‚è‰¯ããªã„ã—ã€å°†æ¥ãŒä¸å®‰ã§ã™ã€‚",
                expected: "anxiety",
                description: "ä¸å®‰ãƒ»äººé–“é–¢ä¿‚ã®æ‚©ã¿"
            },
            {
                text: "æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå§‹ã¾ã£ã¦ã€ã¨ã¦ã‚‚ã‚ãã‚ãã—ã¦ã„ã¾ã™ï¼ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¨ã‚‚æ„æ°—æŠ•åˆã—ã¦ã€ãã£ã¨æˆåŠŸã™ã‚‹ã¨æ€ã„ã¾ã™ã€‚",
                expected: "hope",
                description: "å¸Œæœ›ãƒ»ç©æ¥µçš„ãªæ°—æŒã¡"
            },
            {
                text: "è»¢è·ã‚’è€ƒãˆã¦ã„ã‚‹ã‘ã©ã€ãªã‹ãªã‹æ±ºæ–­ã§ãã¾ã›ã‚“ã€‚ä»Šã®ä¼šç¤¾ã‚‚æ‚ªããªã„ã—ã€ã§ã‚‚æˆé•·ã§ãã‚‹æ°—ãŒã—ãªãã¦...",
                expected: "confusion",
                description: "è¿·ã„ãƒ»æ±ºæ–­ã¸ã®æ‚©ã¿"
            },
            {
                text: "æ˜¨æ—¥ã€é•·å¹´ã®å‹äººã¨å¤§å–§å˜©ã—ã¦ã—ã¾ã„ã¾ã—ãŸã€‚è¨€ã„éããŸã¨å¾Œæ‚”ã—ã¦ã„ã¾ã™ãŒã€è¬ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒåˆ†ã‹ã‚‰ãªã„ã€‚",
                expected: "sadness",
                description: "å¾Œæ‚”ãƒ»äººé–“é–¢ä¿‚ã®å•é¡Œ"
            }
        ];

        // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        async function initializeSystem() {
            try {
                console.log('ğŸš€ ãƒ‡ãƒ¢ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹...');
                
                // Claudeçµ±åˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆæœŸåŒ–
                integrationManager = new ClaudeIntegrationManager();
                const initResult = await integrationManager.initialize();
                
                if (initResult.success) {
                    displaySystemStatus(initResult);
                    updateComponentStatus();
                    initializeAccuracyChart();
                    
                    // ãƒ‡ãƒ¢ç”¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’å…¥åŠ›æ¬„ã«è¡¨ç¤º
                    populateTestCases();
                    
                    console.log('âœ… ãƒ‡ãƒ¢ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
                } else {
                    displaySystemError(initResult);
                }
                
            } catch (error) {
                console.error('âŒ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                displaySystemError({ error: error.message });
            }
        }

        // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è¡¨ç¤º
        function displaySystemStatus(status) {
            const statusElement = document.getElementById('systemStatus');
            
            if (status.success) {
                statusElement.innerHTML = `
                    <div class="success-message">
                        <span class="status-indicator status-success"></span>
                        ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ç¨¼åƒä¸­
                        <div style="margin-top: 10px; font-size: 0.9rem;">
                            åˆæœŸåŒ–æ™‚é–“: ${Math.round(status.initializationTime)}ms<br>
                            èª­ã¿è¾¼ã¿æ¸ˆã¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: ${status.componentsLoaded}/4
                        </div>
                    </div>
                `;
            } else {
                statusElement.innerHTML = `
                    <div class="error-message">
                        <span class="status-indicator status-error"></span>
                        ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼
                        <div style="margin-top: 10px; font-size: 0.9rem;">
                            ${status.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}
                            ${status.fallbackMode ? '<br>ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œä¸­' : ''}
                        </div>
                    </div>
                `;
            }
        }

        // ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function displaySystemError(error) {
            const statusElement = document.getElementById('systemStatus');
            statusElement.innerHTML = `
                <div class="error-message">
                    <span class="status-indicator status-error"></span>
                    ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼: ${error.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}
                </div>
            `;
        }

        // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçŠ¶æ…‹æ›´æ–°
        function updateComponentStatus() {
            if (!integrationManager) return;
            
            const stats = integrationManager.getSystemStatistics();
            const statusElement = document.getElementById('componentStatus');
            
            const components = [
                { name: 'ClaudeAnalysisEngine', label: 'Claudeé«˜åº¦åˆ†æ', stat: stats.componentStats.claudeAnalysis },
                { name: 'ContextualMappingSystem', label: 'æ–‡è„ˆç†è§£ãƒãƒƒãƒ”ãƒ³ã‚°', stat: stats.componentStats.contextualMapping },
                { name: 'SmartTemplateOptimizer', label: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæœ€é©åŒ–', stat: stats.componentStats.templateOptimizer },
                { name: 'ZeroCostAccuracyTester', label: 'ç²¾åº¦æ¤œè¨¼', stat: stats.componentStats.accuracyTester }
            ];

            statusElement.innerHTML = components.map(comp => `
                <div class="component-card">
                    <div class="component-name">
                        <span class="status-indicator ${comp.stat.success > comp.stat.used * 0.8 ? 'status-success' : 'status-warning'}"></span>
                        ${comp.label}
                    </div>
                    <div class="component-stats">
                        ä½¿ç”¨å›æ•°: ${comp.stat.used} | æˆåŠŸ: ${comp.stat.success} | å¹³å‡æ™‚é–“: ${Math.round(comp.stat.avgTime)}ms
                    </div>
                </div>
            `).join('');
            
            statusElement.style.display = 'grid';
            
            // çµ±è¨ˆæ•°å€¤æ›´æ–°
            document.getElementById('totalAnalyses').textContent = stats.totalRequests;
            document.getElementById('averageTime').textContent = Math.round(stats.averageProcessingTime) + 'ms';
        }

        // ç²¾åº¦æ¯”è¼ƒãƒãƒ£ãƒ¼ãƒˆåˆæœŸåŒ–
        function initializeAccuracyChart() {
            const ctx = document.getElementById('accuracyChart').getContext('2d');
            
            accuracyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³', 'ç¾åœ¨', 'ç›®æ¨™'],
                    datasets: [
                        {
                            label: 'æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ',
                            data: [23.4, 23.4, 23.4],
                            borderColor: '#f56565',
                            backgroundColor: 'rgba(245, 101, 101, 0.1)',
                            borderWidth: 2,
                            fill: true
                        },
                        {
                            label: 'Claudeçµ±åˆã‚·ã‚¹ãƒ†ãƒ ',
                            data: [23.4, systemStats.currentAccuracy, 55.0],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: '386çˆ»ãƒãƒƒãƒ”ãƒ³ã‚°ç²¾åº¦ã®æ”¹å–„æ¨ç§»'
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¥åŠ›
        function populateTestCases() {
            const inputElement = document.getElementById('userInput');
            const randomCase = demoTestCases[Math.floor(Math.random() * demoTestCases.length)];
            inputElement.value = randomCase.text;
            inputElement.placeholder = `ä¾‹: ${randomCase.description}`;
        }

        // åˆ†æå®Ÿè¡Œ
        async function performAnalysis() {
            const userInput = document.getElementById('userInput').value.trim();
            if (!userInput) {
                alert('åˆ†æã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            if (!integrationManager) {
                alert('ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return;
            }

            const analyzeButton = document.getElementById('analyzeButton');
            const resultsArea = document.getElementById('analysisResults');
            
            try {
                // UIæ›´æ–°
                analyzeButton.disabled = true;
                analyzeButton.textContent = 'åˆ†æä¸­...';
                
                resultsArea.style.display = 'block';
                resultsArea.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        çµ±åˆåˆ†æã‚’å®Ÿè¡Œä¸­...
                    </div>
                `;

                // åˆ†æã‚ªãƒ—ã‚·ãƒ§ãƒ³å–å¾—
                const options = {
                    useClaudeAnalysis: document.getElementById('useClaudeAnalysis').checked,
                    useContextualMapping: document.getElementById('useContextualMapping').checked,
                    optimizeTemplates: document.getElementById('optimizeTemplates').checked,
                    enableAccuracyTesting: document.getElementById('enableAccuracyTesting').checked
                };

                // çµ±åˆåˆ†æå®Ÿè¡Œ
                const startTime = performance.now();
                const result = await integrationManager.performEnhancedAnalysis(userInput, options);
                const endTime = performance.now();

                // çµæœè¡¨ç¤º
                displayAnalysisResults(result, endTime - startTime);
                
                // çµ±è¨ˆæ›´æ–°
                updateSystemStatistics(result, endTime - startTime);
                updateComponentStatus();
                updateAccuracyChart(result);

            } catch (error) {
                console.error('åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                resultsArea.innerHTML = `
                    <div class="error-message">
                        åˆ†æã‚¨ãƒ©ãƒ¼: ${error.message}
                    </div>
                `;
            } finally {
                analyzeButton.disabled = false;
                analyzeButton.textContent = 'çµ±åˆåˆ†æã‚’å®Ÿè¡Œ';
            }
        }

        // åˆ†æçµæœè¡¨ç¤º
        function displayAnalysisResults(result, processingTime) {
            const resultsArea = document.getElementById('analysisResults');
            
            if (!result.success) {
                resultsArea.innerHTML = `
                    <div class="error-message">
                        åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ: ${result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}
                    </div>
                `;
                return;
            }

            const topCandidates = result.results.topCandidates || [];
            const metadata = result.metadata || {};
            
            const hexagramResults = topCandidates.slice(0, 5).map((candidate, index) => `
                <div class="hexagram-result">
                    <div class="hexagram-number">#${index + 1}</div>
                    <div class="hexagram-info">
                        <div><strong>${candidate.hexagram}å¦ ${candidate.line ? candidate.line + 'çˆ»' : ''}</strong></div>
                        <div style="font-size: 0.9rem; color: #718096;">
                            ä¿¡é ¼åº¦: ${Math.round(candidate.totalConfidence * 100)}% | 
                            æƒ…å ±æº: ${candidate.sources?.join(', ') || 'çµ±åˆåˆ†æ'}
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${candidate.totalConfidence * 100}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');

            resultsArea.innerHTML = `
                <div class="success-message">
                    <span class="status-indicator status-success"></span>
                    çµ±åˆåˆ†æå®Œäº† (${Math.round(processingTime)}ms)
                    <div style="margin-top: 10px; font-size: 0.9rem;">
                        ä½¿ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: ${metadata.componentsUsed?.join(', ') || 'N/A'}<br>
                        ç²¾åº¦æ”¹å–„: +${metadata.accuracyImprovement || 0}%
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 15px; color: #4a5568;">ä¸Šä½å€™è£œï¼ˆä¿¡é ¼åº¦é †ï¼‰:</h4>
                    ${hexagramResults || '<p>å€™è£œãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>'}
                </div>
                
                ${result.results.analysisBreakdown ? `
                    <div style="margin-top: 20px;">
                        <h4 style="margin-bottom: 10px; color: #4a5568;">åˆ†æå†…è¨³:</h4>
                        <div style="font-size: 0.9rem; color: #718096;">
                            ${Object.entries(result.results.analysisBreakdown).map(([source, breakdown]) => 
                                `<div>${source}: ${breakdown.success ? 'âœ…' : 'âŒ'} (${breakdown.candidateCount}å€™è£œ)`
                            ).join('<br>')}
                        </div>
                    </div>
                ` : ''}
            `;
        }

        // ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆæ›´æ–°
        function updateSystemStatistics(result, processingTime) {
            systemStats.totalAnalyses++;
            if (result.success) {
                systemStats.successfulAnalyses++;
            }
            
            // å¹³å‡å‡¦ç†æ™‚é–“æ›´æ–°
            systemStats.averageTime = (systemStats.averageTime * (systemStats.totalAnalyses - 1) + processingTime) / systemStats.totalAnalyses;
            
            // ç²¾åº¦æ›´æ–°ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ï¼‰
            if (result.metadata && result.metadata.accuracyImprovement) {
                const improvement = result.metadata.accuracyImprovement;
                systemStats.currentAccuracy = Math.min(23.4 + improvement, 60.0);
            }
            
            // UIæ›´æ–°
            document.getElementById('currentAccuracy').textContent = systemStats.currentAccuracy.toFixed(1) + '%';
        }

        // ç²¾åº¦ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
        function updateAccuracyChart(result) {
            if (!accuracyChart) return;
            
            accuracyChart.data.datasets[1].data[1] = systemStats.currentAccuracy;
            accuracyChart.update();
        }

        // ãƒ©ãƒ³ãƒ€ãƒ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹é¸æŠ
        function selectRandomTestCase() {
            populateTestCases();
        }

        // ä¸€æ‹¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runBatchTest() {
            if (!integrationManager) {
                alert('ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return;
            }

            console.log('ğŸ§ª ä¸€æ‹¬ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            for (const testCase of demoTestCases) {
                document.getElementById('userInput').value = testCase.text;
                await performAnalysis();
                await new Promise(resolve => setTimeout(resolve, 1000)); // 1ç§’é–“éš”
            }
            
            console.log('âœ… ä¸€æ‹¬ãƒ†ã‚¹ãƒˆå®Œäº†');
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            
            // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹é¸æŠãƒœã‚¿ãƒ³è¿½åŠ 
            const analyzeButton = document.getElementById('analyzeButton');
            analyzeButton.insertAdjacentHTML('afterend', `
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button onclick="selectRandomTestCase()" style="flex: 1; padding: 8px; background: #e2e8f0; border: none; border-radius: 4px; cursor: pointer;">
                        ãƒ©ãƒ³ãƒ€ãƒ ä¾‹æ–‡
                    </button>
                    <button onclick="runBatchTest()" style="flex: 1; padding: 8px; background: #e2e8f0; border: none; border-radius: 4px; cursor: pointer;">
                        ä¸€æ‹¬ãƒ†ã‚¹ãƒˆ
                    </button>
                </div>
            `);
            
            // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Ÿè¡Œ
            initializeSystem();
        });

        // ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–å®Ÿè¡Œ
        async function optimizeSystem() {
            if (!integrationManager) return;
            
            try {
                await integrationManager.optimizeSystem();
                updateComponentStatus();
                console.log('âœ… ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–å®Œäº†');
            } catch (error) {
                console.error('âŒ ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        function generateDiagnosticReport() {
            if (!integrationManager) return;
            
            const report = integrationManager.generateDiagnosticReport();
            console.log('ğŸ“‹ è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ:', report);
            
            // ãƒ¬ãƒãƒ¼ãƒˆã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `claude-integration-diagnostic-${new Date().getTime()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // å®šæœŸçš„ãªã‚·ã‚¹ãƒ†ãƒ ç›£è¦–
        setInterval(() => {
            if (integrationManager && integrationManager.initialized) {
                updateComponentStatus();
                
                // 30åˆ†ã”ã¨ã«ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–
                const now = Date.now();
                if (!window.lastOptimization || now - window.lastOptimization > 1800000) {
                    optimizeSystem();
                    window.lastOptimization = now;
                }
            }
        }, 30000); // 30ç§’é–“éš”
    </script>
</body>
</html>