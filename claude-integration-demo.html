<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClaudeÁµ±ÂêàÁ≤æÂ∫¶Âêë‰∏ä„Ç∑„Çπ„ÉÜ„É† - „Éá„É¢„É≥„Çπ„Éà„É¨„Éº„Ç∑„Éß„É≥</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>">
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .demo-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .demo-section:hover {
            transform: translateY(-5px);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-area {
            margin-bottom: 20px;
        }

        .input-area label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .input-area textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            resize: vertical;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-area textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .options-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        .analyze-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .analyze-button:hover {
            transform: translateY(-2px);
        }

        .analyze-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-area {
            margin-top: 25px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .comparison-chart {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            grid-column: 1 / -1;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #718096;
            font-size: 0.9rem;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success { background-color: #48bb78; }
        .status-warning { background-color: #ed8936; }
        .status-error { background-color: #f56565; }

        .component-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .component-card {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #667eea;
        }

        .component-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .component-stats {
            font-size: 0.9rem;
            color: #718096;
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .success-message {
            background: #c6f6d5;
            color: #2f855a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #667eea;
            margin: 20px 0;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hexagram-result {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .hexagram-info {
            flex: 1;
        }

        .hexagram-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .confidence-bar {
            width: 100px;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #667eea);
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .options-panel {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üß† ClaudeÁµ±ÂêàÁ≤æÂ∫¶Âêë‰∏ä„Ç∑„Çπ„ÉÜ„É†</h1>
            <p>386Áàª„Éû„ÉÉ„Éî„É≥„Ç∞Á≤æÂ∫¶„Çí23% ‚Üí 50-60%„Å´Âêë‰∏ä„Åï„Åõ„Çã„Çº„É≠„Ç≥„Çπ„ÉàAI„Ç∑„Çπ„ÉÜ„É†</p>
        </div>

        <!-- „Ç∑„Çπ„ÉÜ„É†Áµ±Ë®à -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="currentAccuracy">23.4%</div>
                <div class="metric-label">ÁèæÂú®„ÅÆÁ≤æÂ∫¶</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="targetAccuracy">55.0%</div>
                <div class="metric-label">ÁõÆÊ®ôÁ≤æÂ∫¶</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="totalAnalyses">0</div>
                <div class="metric-label">Á∑èÂàÜÊûêÂõûÊï∞</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="averageTime">0ms</div>
                <div class="metric-label">Âπ≥ÂùáÂá¶ÁêÜÊôÇÈñì</div>
            </div>
        </div>

        <div class="demo-grid">
            <!-- ÂàÜÊûêÂÆüË°å„Éë„Éç„É´ -->
            <div class="demo-section">
                <h2 class="section-title">
                    üîç Áµ±ÂêàÂàÜÊûêÂÆüË°å
                </h2>
                
                <div class="input-area">
                    <label for="userInput">„É¶„Éº„Ç∂„ÉºÂÖ•Âäõ„ÉÜ„Ç≠„Çπ„Éà:</label>
                    <textarea 
                        id="userInput" 
                        placeholder="‰æã: ÊúÄËøë‰ªï‰∫ã„ÅßÊÇ©„Çì„Åß„ÅÑ„Åæ„Åô„ÄÇ‰∏äÂè∏„Å®„ÅÆÈñ¢‰øÇ„ÇÇËâØ„Åè„Å™„ÅÑ„Åó„ÄÅÂ∞ÜÊù•„Åå‰∏çÂÆâ„Åß„Åô„ÄÇ"
                    ></textarea>
                </div>

                <div class="options-panel">
                    <div class="option-item">
                        <input type="checkbox" id="useClaudeAnalysis" checked>
                        <label for="useClaudeAnalysis">ClaudeÈ´òÂ∫¶ÂàÜÊûê</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="useContextualMapping" checked>
                        <label for="useContextualMapping">ÊñáËÑàÁêÜËß£„Éû„ÉÉ„Éî„É≥„Ç∞</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="optimizeTemplates" checked>
                        <label for="optimizeTemplates">„ÉÜ„É≥„Éó„É¨„Éº„ÉàÊúÄÈÅ©Âåñ</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="enableAccuracyTesting" checked>
                        <label for="enableAccuracyTesting">Á≤æÂ∫¶Ê§úË®º</label>
                    </div>
                </div>

                <button class="analyze-button" id="analyzeButton" onclick="performAnalysis()">
                    Áµ±ÂêàÂàÜÊûê„ÇíÂÆüË°å
                </button>

                <div id="analysisResults" class="results-area" style="display: none;">
                    <!-- ÂàÜÊûêÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>
            </div>

            <!-- „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖãÁõ£Ë¶ñ -->
            <div class="demo-section">
                <h2 class="section-title">
                    üìä „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖãÁõ£Ë¶ñ
                </h2>
                
                <div id="systemStatus">
                    <div class="loading">
                        <div class="spinner"></div>
                        „Ç∑„Çπ„ÉÜ„É†„ÇíÂàùÊúüÂåñ‰∏≠...
                    </div>
                </div>

                <div class="component-status" id="componentStatus" style="display: none;">
                    <!-- „Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÁä∂ÊÖã„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>
            </div>
        </div>

        <!-- Á≤æÂ∫¶ÊØîËºÉ„ÉÅ„É£„Éº„Éà -->
        <div class="comparison-chart">
            <h2 class="section-title">
                üìà Á≤æÂ∫¶ÊîπÂñÑÂäπÊûúÊØîËºÉ
            </h2>
            <canvas id="accuracyChart" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- ÂøÖË¶Å„Å™JavaScript„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø -->
    <script src="./public/assets/H384H64database.js"></script>
    <script src="./public/js/pages/future-simulator/HexagramPatternTemplates.js"></script>
    <script src="./public/js/pages/future-simulator/DynamicKeywordGenerator.js"></script>
    <script src="./public/js/pages/future-simulator/IntegratedAnalysisEngine.js"></script>
    <script src="./public/js/pages/future-simulator/ClaudeAnalysisEngine.js"></script>
    <script src="./public/js/pages/future-simulator/SmartTemplateOptimizer.js"></script>
    <script src="./public/js/pages/future-simulator/ContextualMappingSystem.js"></script>
    <script src="./public/js/pages/future-simulator/ZeroCostAccuracyTester.js"></script>
    <script src="./public/js/pages/future-simulator/ClaudeIntegrationManager.js"></script>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let integrationManager = null;
        let accuracyChart = null;
        let systemStats = {
            totalAnalyses: 0,
            successfulAnalyses: 0,
            averageTime: 0,
            currentAccuracy: 23.4
        };

        // „Éá„É¢Áî®„ÉÜ„Çπ„Éà„Ç±„Éº„Çπ
        const demoTestCases = [
            {
                text: "ÊúÄËøë‰ªï‰∫ã„ÅßÊÇ©„Çì„Åß„ÅÑ„Åæ„Åô„ÄÇ‰∏äÂè∏„Å®„ÅÆÈñ¢‰øÇ„ÇÇËâØ„Åè„Å™„ÅÑ„Åó„ÄÅÂ∞ÜÊù•„Åå‰∏çÂÆâ„Åß„Åô„ÄÇ",
                expected: "anxiety",
                description: "‰∏çÂÆâ„Éª‰∫∫ÈñìÈñ¢‰øÇ„ÅÆÊÇ©„Åø"
            },
            {
                text: "Êñ∞„Åó„ÅÑ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅåÂßã„Åæ„Å£„Å¶„ÄÅ„Å®„Å¶„ÇÇ„Çè„Åè„Çè„Åè„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ„ÉÅ„Éº„É†„É°„É≥„Éê„Éº„Å®„ÇÇÊÑèÊ∞óÊäïÂêà„Åó„Å¶„ÄÅ„Åç„Å£„Å®ÊàêÂäü„Åô„Çã„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ",
                expected: "hope",
                description: "Â∏åÊúõ„ÉªÁ©çÊ•µÁöÑ„Å™Ê∞óÊåÅ„Å°"
            },
            {
                text: "Ëª¢ËÅ∑„ÇíËÄÉ„Åà„Å¶„ÅÑ„Çã„Åë„Å©„ÄÅ„Å™„Åã„Å™„ÅãÊ±∫Êñ≠„Åß„Åç„Åæ„Åõ„Çì„ÄÇ‰ªä„ÅÆ‰ºöÁ§æ„ÇÇÊÇ™„Åè„Å™„ÅÑ„Åó„ÄÅ„Åß„ÇÇÊàêÈï∑„Åß„Åç„ÇãÊ∞ó„Åå„Åó„Å™„Åè„Å¶...",
                expected: "confusion",
                description: "Ëø∑„ÅÑ„ÉªÊ±∫Êñ≠„Å∏„ÅÆÊÇ©„Åø"
            },
            {
                text: "Êò®Êó•„ÄÅÈï∑Âπ¥„ÅÆÂèã‰∫∫„Å®Â§ßÂñßÂò©„Åó„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„ÄÇË®Ä„ÅÑÈÅé„Åé„Åü„Å®ÂæåÊÇî„Åó„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅË¨ù„Çã„Çø„Ç§„Éü„É≥„Ç∞„ÅåÂàÜ„Åã„Çâ„Å™„ÅÑ„ÄÇ",
                expected: "sadness",
                description: "ÂæåÊÇî„Éª‰∫∫ÈñìÈñ¢‰øÇ„ÅÆÂïèÈ°å"
            }
        ];

        // „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
        async function initializeSystem() {
            try {
                console.log('üöÄ „Éá„É¢„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÈñãÂßã...');
                
                // ClaudeÁµ±Âêà„Éû„Éç„Éº„Ç∏„É£„ÉºÂàùÊúüÂåñ
                integrationManager = new ClaudeIntegrationManager();
                const initResult = await integrationManager.initialize();
                
                if (initResult.success) {
                    displaySystemStatus(initResult);
                    updateComponentStatus();
                    initializeAccuracyChart();
                    
                    // „Éá„É¢Áî®„ÉÜ„Çπ„Éà„Ç±„Éº„Çπ„ÇíÂÖ•ÂäõÊ¨Ñ„Å´Ë°®Á§∫
                    populateTestCases();
                    
                    console.log('‚úÖ „Éá„É¢„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆå‰∫Ü');
                } else {
                    displaySystemError(initResult);
                }
                
            } catch (error) {
                console.error('‚ùå „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                displaySystemError({ error: error.message });
            }
        }

        // „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖãË°®Á§∫
        function displaySystemStatus(status) {
            const statusElement = document.getElementById('systemStatus');
            
            if (status.success) {
                statusElement.innerHTML = `
                    <div class="success-message">
                        <span class="status-indicator status-success"></span>
                        „Ç∑„Çπ„ÉÜ„É†Ê≠£Â∏∏Á®ºÂÉç‰∏≠
                        <div style="margin-top: 10px; font-size: 0.9rem;">
                            ÂàùÊúüÂåñÊôÇÈñì: ${Math.round(status.initializationTime)}ms<br>
                            Ë™≠„ÅøËæº„ÅøÊ∏à„Åø„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà: ${status.componentsLoaded}/4
                        </div>
                    </div>
                `;
            } else {
                statusElement.innerHTML = `
                    <div class="error-message">
                        <span class="status-indicator status-error"></span>
                        „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ„Ç®„É©„Éº
                        <div style="margin-top: 10px; font-size: 0.9rem;">
                            ${status.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'}
                            ${status.fallbackMode ? '<br>„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„É¢„Éº„Éâ„ÅßÂãï‰Ωú‰∏≠' : ''}
                        </div>
                    </div>
                `;
            }
        }

        // „Ç∑„Çπ„ÉÜ„É†„Ç®„É©„ÉºË°®Á§∫
        function displaySystemError(error) {
            const statusElement = document.getElementById('systemStatus');
            statusElement.innerHTML = `
                <div class="error-message">
                    <span class="status-indicator status-error"></span>
                    „Ç∑„Çπ„ÉÜ„É†„Ç®„É©„Éº: ${error.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'}
                </div>
            `;
        }

        // „Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÁä∂ÊÖãÊõ¥Êñ∞
        function updateComponentStatus() {
            if (!integrationManager) return;
            
            const stats = integrationManager.getSystemStatistics();
            const statusElement = document.getElementById('componentStatus');
            
            const components = [
                { name: 'ClaudeAnalysisEngine', label: 'ClaudeÈ´òÂ∫¶ÂàÜÊûê', stat: stats.componentStats.claudeAnalysis },
                { name: 'ContextualMappingSystem', label: 'ÊñáËÑàÁêÜËß£„Éû„ÉÉ„Éî„É≥„Ç∞', stat: stats.componentStats.contextualMapping },
                { name: 'SmartTemplateOptimizer', label: '„ÉÜ„É≥„Éó„É¨„Éº„ÉàÊúÄÈÅ©Âåñ', stat: stats.componentStats.templateOptimizer },
                { name: 'ZeroCostAccuracyTester', label: 'Á≤æÂ∫¶Ê§úË®º', stat: stats.componentStats.accuracyTester }
            ];

            statusElement.innerHTML = components.map(comp => `
                <div class="component-card">
                    <div class="component-name">
                        <span class="status-indicator ${comp.stat.success > comp.stat.used * 0.8 ? 'status-success' : 'status-warning'}"></span>
                        ${comp.label}
                    </div>
                    <div class="component-stats">
                        ‰ΩøÁî®ÂõûÊï∞: ${comp.stat.used} | ÊàêÂäü: ${comp.stat.success} | Âπ≥ÂùáÊôÇÈñì: ${Math.round(comp.stat.avgTime)}ms
                    </div>
                </div>
            `).join('');
            
            statusElement.style.display = 'grid';
            
            // Áµ±Ë®àÊï∞ÂÄ§Êõ¥Êñ∞
            document.getElementById('totalAnalyses').textContent = stats.totalRequests;
            document.getElementById('averageTime').textContent = Math.round(stats.averageProcessingTime) + 'ms';
        }

        // Á≤æÂ∫¶ÊØîËºÉ„ÉÅ„É£„Éº„ÉàÂàùÊúüÂåñ
        function initializeAccuracyChart() {
            const ctx = document.getElementById('accuracyChart').getContext('2d');
            
            accuracyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['„Éô„Éº„Çπ„É©„Ç§„É≥', 'ÁèæÂú®', 'ÁõÆÊ®ô'],
                    datasets: [
                        {
                            label: 'Êó¢Â≠ò„Ç∑„Çπ„ÉÜ„É†',
                            data: [23.4, 23.4, 23.4],
                            borderColor: '#f56565',
                            backgroundColor: 'rgba(245, 101, 101, 0.1)',
                            borderWidth: 2,
                            fill: true
                        },
                        {
                            label: 'ClaudeÁµ±Âêà„Ç∑„Çπ„ÉÜ„É†',
                            data: [23.4, systemStats.currentAccuracy, 55.0],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: '386Áàª„Éû„ÉÉ„Éî„É≥„Ç∞Á≤æÂ∫¶„ÅÆÊîπÂñÑÊé®Áßª'
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // „ÉÜ„Çπ„Éà„Ç±„Éº„ÇπÂÖ•Âäõ
        function populateTestCases() {
            const inputElement = document.getElementById('userInput');
            const randomCase = demoTestCases[Math.floor(Math.random() * demoTestCases.length)];
            inputElement.value = randomCase.text;
            inputElement.placeholder = `‰æã: ${randomCase.description}`;
        }

        // ÂàÜÊûêÂÆüË°å
        async function performAnalysis() {
            const userInput = document.getElementById('userInput').value.trim();
            if (!userInput) {
                alert('ÂàÜÊûê„Åô„Çã„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            if (!integrationManager) {
                alert('„Ç∑„Çπ„ÉÜ„É†„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ');
                return;
            }

            const analyzeButton = document.getElementById('analyzeButton');
            const resultsArea = document.getElementById('analysisResults');
            
            try {
                // UIÊõ¥Êñ∞
                analyzeButton.disabled = true;
                analyzeButton.textContent = 'ÂàÜÊûê‰∏≠...';
                
                resultsArea.style.display = 'block';
                resultsArea.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        Áµ±ÂêàÂàÜÊûê„ÇíÂÆüË°å‰∏≠...
                    </div>
                `;

                // ÂàÜÊûê„Ç™„Éó„Ç∑„Éß„É≥ÂèñÂæó
                const options = {
                    useClaudeAnalysis: document.getElementById('useClaudeAnalysis').checked,
                    useContextualMapping: document.getElementById('useContextualMapping').checked,
                    optimizeTemplates: document.getElementById('optimizeTemplates').checked,
                    enableAccuracyTesting: document.getElementById('enableAccuracyTesting').checked
                };

                // Áµ±ÂêàÂàÜÊûêÂÆüË°å
                const startTime = performance.now();
                const result = await integrationManager.performEnhancedAnalysis(userInput, options);
                const endTime = performance.now();

                // ÁµêÊûúË°®Á§∫
                displayAnalysisResults(result, endTime - startTime);
                
                // Áµ±Ë®àÊõ¥Êñ∞
                updateSystemStatistics(result, endTime - startTime);
                updateComponentStatus();
                updateAccuracyChart(result);

            } catch (error) {
                console.error('ÂàÜÊûê„Ç®„É©„Éº:', error);
                resultsArea.innerHTML = `
                    <div class="error-message">
                        ÂàÜÊûê„Ç®„É©„Éº: ${error.message}
                    </div>
                `;
            } finally {
                analyzeButton.disabled = false;
                analyzeButton.textContent = 'Áµ±ÂêàÂàÜÊûê„ÇíÂÆüË°å';
            }
        }

        // ÂàÜÊûêÁµêÊûúË°®Á§∫
        function displayAnalysisResults(result, processingTime) {
            const resultsArea = document.getElementById('analysisResults');
            
            if (!result.success) {
                resultsArea.innerHTML = `
                    <div class="error-message">
                        ÂàÜÊûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'}
                    </div>
                `;
                return;
            }

            const topCandidates = result.results.topCandidates || [];
            const metadata = result.metadata || {};
            
            const hexagramResults = topCandidates.slice(0, 5).map((candidate, index) => `
                <div class="hexagram-result">
                    <div class="hexagram-number">#${index + 1}</div>
                    <div class="hexagram-info">
                        <div><strong>${candidate.hexagram}Âç¶ ${candidate.line ? candidate.line + 'Áàª' : ''}</strong></div>
                        <div style="font-size: 0.9rem; color: #718096;">
                            ‰ø°È†ºÂ∫¶: ${Math.round(candidate.totalConfidence * 100)}% | 
                            ÊÉÖÂ†±Ê∫ê: ${candidate.sources?.join(', ') || 'Áµ±ÂêàÂàÜÊûê'}
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${candidate.totalConfidence * 100}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');

            resultsArea.innerHTML = `
                <div class="success-message">
                    <span class="status-indicator status-success"></span>
                    Áµ±ÂêàÂàÜÊûêÂÆå‰∫Ü (${Math.round(processingTime)}ms)
                    <div style="margin-top: 10px; font-size: 0.9rem;">
                        ‰ΩøÁî®„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà: ${metadata.componentsUsed?.join(', ') || 'N/A'}<br>
                        Á≤æÂ∫¶ÊîπÂñÑ: +${metadata.accuracyImprovement || 0}%
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 15px; color: #4a5568;">‰∏ä‰ΩçÂÄôË£úÔºà‰ø°È†ºÂ∫¶È†ÜÔºâ:</h4>
                    ${hexagramResults || '<p>ÂÄôË£ú„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ</p>'}
                </div>
                
                ${result.results.analysisBreakdown ? `
                    <div style="margin-top: 20px;">
                        <h4 style="margin-bottom: 10px; color: #4a5568;">ÂàÜÊûêÂÜÖË®≥:</h4>
                        <div style="font-size: 0.9rem; color: #718096;">
                            ${Object.entries(result.results.analysisBreakdown).map(([source, breakdown]) => 
                                `<div>${source}: ${breakdown.success ? '‚úÖ' : '‚ùå'} (${breakdown.candidateCount}ÂÄôË£ú)`
                            ).join('<br>')}
                        </div>
                    </div>
                ` : ''}
            `;
        }

        // „Ç∑„Çπ„ÉÜ„É†Áµ±Ë®àÊõ¥Êñ∞
        function updateSystemStatistics(result, processingTime) {
            systemStats.totalAnalyses++;
            if (result.success) {
                systemStats.successfulAnalyses++;
            }
            
            // Âπ≥ÂùáÂá¶ÁêÜÊôÇÈñìÊõ¥Êñ∞
            systemStats.averageTime = (systemStats.averageTime * (systemStats.totalAnalyses - 1) + processingTime) / systemStats.totalAnalyses;
            
            // Á≤æÂ∫¶Êõ¥Êñ∞Ôºà„É°„Çø„Éá„Éº„Çø„Åã„ÇâÔºâ
            if (result.metadata && result.metadata.accuracyImprovement) {
                const improvement = result.metadata.accuracyImprovement;
                systemStats.currentAccuracy = Math.min(23.4 + improvement, 60.0);
            }
            
            // UIÊõ¥Êñ∞
            document.getElementById('currentAccuracy').textContent = systemStats.currentAccuracy.toFixed(1) + '%';
        }

        // Á≤æÂ∫¶„ÉÅ„É£„Éº„ÉàÊõ¥Êñ∞
        function updateAccuracyChart(result) {
            if (!accuracyChart) return;
            
            accuracyChart.data.datasets[1].data[1] = systemStats.currentAccuracy;
            accuracyChart.update();
        }

        // „É©„É≥„ÉÄ„É†„ÉÜ„Çπ„Éà„Ç±„Éº„ÇπÈÅ∏Êäû
        function selectRandomTestCase() {
            populateTestCases();
        }

        // ‰∏ÄÊã¨„ÉÜ„Çπ„ÉàÂÆüË°å
        async function runBatchTest() {
            if (!integrationManager) {
                alert('„Ç∑„Çπ„ÉÜ„É†„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ');
                return;
            }

            console.log('üß™ ‰∏ÄÊã¨„ÉÜ„Çπ„ÉàÈñãÂßã...');
            
            for (const testCase of demoTestCases) {
                document.getElementById('userInput').value = testCase.text;
                await performAnalysis();
                await new Promise(resolve => setTimeout(resolve, 1000)); // 1ÁßíÈñìÈöî
            }
            
            console.log('‚úÖ ‰∏ÄÊã¨„ÉÜ„Çπ„ÉàÂÆå‰∫Ü');
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
            
            // „ÉÜ„Çπ„Éà„Ç±„Éº„ÇπÈÅ∏Êäû„Éú„Çø„É≥ËøΩÂä†
            const analyzeButton = document.getElementById('analyzeButton');
            analyzeButton.insertAdjacentHTML('afterend', `
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button onclick="selectRandomTestCase()" style="flex: 1; padding: 8px; background: #e2e8f0; border: none; border-radius: 4px; cursor: pointer;">
                        „É©„É≥„ÉÄ„É†‰æãÊñá
                    </button>
                    <button onclick="runBatchTest()" style="flex: 1; padding: 8px; background: #e2e8f0; border: none; border-radius: 4px; cursor: pointer;">
                        ‰∏ÄÊã¨„ÉÜ„Çπ„Éà
                    </button>
                </div>
            `);
            
            // „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÂÆüË°å
            initializeSystem();
        });

        // „Ç∑„Çπ„ÉÜ„É†ÊúÄÈÅ©ÂåñÂÆüË°å
        async function optimizeSystem() {
            if (!integrationManager) return;
            
            try {
                await integrationManager.optimizeSystem();
                updateComponentStatus();
                console.log('‚úÖ „Ç∑„Çπ„ÉÜ„É†ÊúÄÈÅ©ÂåñÂÆå‰∫Ü');
            } catch (error) {
                console.error('‚ùå „Ç∑„Çπ„ÉÜ„É†ÊúÄÈÅ©Âåñ„Ç®„É©„Éº:', error);
            }
        }

        // Ë®∫Êñ≠„É¨„Éù„Éº„ÉàÁîüÊàê
        function generateDiagnosticReport() {
            if (!integrationManager) return;
            
            const report = integrationManager.generateDiagnosticReport();
            console.log('üìã Ë®∫Êñ≠„É¨„Éù„Éº„Éà:', report);
            
            // „É¨„Éù„Éº„Éà„ÇíJSON„Éï„Ç°„Ç§„É´„Å®„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `claude-integration-diagnostic-${new Date().getTime()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ÂÆöÊúüÁöÑ„Å™„Ç∑„Çπ„ÉÜ„É†Áõ£Ë¶ñ
        setInterval(() => {
            if (integrationManager && integrationManager.initialized) {
                updateComponentStatus();
                
                // 30ÂàÜ„Åî„Å®„Å´„Ç∑„Çπ„ÉÜ„É†ÊúÄÈÅ©Âåñ
                const now = Date.now();
                if (!window.lastOptimization || now - window.lastOptimization > 1800000) {
                    optimizeSystem();
                    window.lastOptimization = now;
                }
            }
        }, 30000); // 30ÁßíÈñìÈöî
    </script>
</body>
</html>