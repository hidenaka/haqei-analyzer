# ファイル保存ルール確立

**実施日**: 2025年8月18日  
**目的**: 重複ファイル問題の根本解決

## 🔍 実施内容

### 1. 問題分析
- **発見**: QuestionManager.js等、同名ファイルが複数箇所に作成される問題
- **影響**: Q.1のみラジオボタン表示、Q.2以降非表示のバグ発生
- **原因**: ファイル保存場所のルールが不明確

### 2. 5WHY分析による根本原因特定
```
問題: 同名ファイルが複数箇所に作成される
Why1: なぜ？ → 保存場所のルールが不明確
Why2: なぜ？ → ディレクトリ構造の定義がない
Why3: なぜ？ → CLAUDE.mdに具体的な保存ルールがない
Why4: なぜ？ → 開発時に場当たり的に作成してきた
Why5: なぜ？ → 最初に構造設計をしなかった
対策: 明確なファイル保存ルールを定義し、CLAUDE.mdに追記
```

### 3. 重複ファイル削除実績
- **削除数**: 6ファイル
- **対象**:
  - app.js (古いバージョン削除)
  - PerformanceOptimizer.js (js/直下を削除、core版保持)
  - I-Ching関連4ファイル (js/直下を削除、iching/版保持)

### 4. CLAUDE.md更新内容

#### 追加したファイル保存ルール
```markdown
## 📂 ファイル保存ルール（必須）

### JSファイル作成時の確認
1. 既存ファイルの確認（必須）: find public -name "ファイル名.js"
2. 既存があれば修正、なければ適切な場所に新規作成

### ディレクトリ構造
- assets/js/: ビルド済み・外部ライブラリ
- js/: 開発用JavaScriptファイル
- js/core/: コア機能（システム基盤）
- js/iching/: I-Ching関連（易経専門）
- js/components/: UIコンポーネント
- js/utils/: ユーティリティ

### 禁止事項
- 同名ファイルの作成
- public/直下へのJS配置
- "ついでに"別の場所にコピー

### クラス名の一意性
- 1クラス = 1ファイル
- クラス名の重複禁止
- export/importで明示的に管理
```

## 📊 効果

### 期待される改善
1. **重複ファイルの防止**
   - 作成前チェックで重複を防ぐ
   - 明確な配置ルールで迷わない

2. **メンテナンス性向上**
   - どこに何があるか明確
   - 修正箇所が一意に決まる

3. **初期化エラーの防止**
   - クラスの重複定義がなくなる
   - 読み込み順序が明確

## 📝 今後の運用

### ファイル作成前チェックリスト
- [ ] `find public -name "ファイル名.js"` を実行
- [ ] 既存ファイルがないことを確認
- [ ] 適切なフォルダを選択
- [ ] クラス名の重複を確認
- [ ] HTMLでの読み込み順序を考慮

## 結論

ファイル保存ルールをCLAUDE.mdに明文化し、重複ファイル問題の根本解決を実現。
今後は作成前チェックの徹底により、同様の問題発生を防止。