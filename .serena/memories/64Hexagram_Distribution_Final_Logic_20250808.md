# 64卦分散ロジック最終実装仕様
記録日: 2025年8月8日

## 実装済みロジックの要点

### 1. Engine OS
- **動的重み付け**: calculateEngineDynamicWeights()
- **確率的選択**: selectEngineTrigramsStochastic(temperature=0.4)
- **シグモイド変換**: 中間値抑制、極値強調
- **エラー対策**: 入力検証、除算エラー対策、境界チェック

### 2. Interface OS  
- **動的スケーリング**: calculateInterfaceDynamicWeights()
- **確率的選択**: selectInterfaceTrigrams(temperature=0.3)
- **シグモイド変換**: k=4で差別化強化
- **Engine OS影響**: 25%の相互作用

### 3. SafeMode OS
- **動的重み付け**: calculateSafeModeDynamicWeights()
- **確率的選択**: selectDefensiveTrigrams(temperature=0.35)
- **Engine OS影響**: 40%の基礎人格影響
- **エラー対策**: 入力検証、フォールバック完備

### 4. 64卦マトリックス（重複なし）
```javascript
[
    [1,  43, 14, 34,  9,  5, 26, 11],  // 乾上
    [10, 58, 38, 54, 61, 60, 41, 19],  // 兌上
    [13, 49, 30, 55, 37, 63, 22, 36],  // 離上
    [25, 17, 21, 51, 42,  3, 27, 24],  // 震上
    [44, 28, 50, 32, 57, 48, 18, 46],  // 巽上
    [6,  47, 64, 40, 59, 29,  4,  7],  // 坎上
    [33, 31, 56, 62, 53, 39, 52, 15],  // 艮上
    [12, 45, 35, 16, 20,  8, 23,  2]   // 坤上
]
```

### 5. 三爻間相互作用
- 乾-坤: 1.5（最高調和）
- 坎-離: 1.4（水火既済）
- 震-巽: 1.3（雷風相薄）
- 艮-兌: 1.2（山沢通気）

## 検証すべきポイント

1. **分散性**: 同じ回答パターンで異なる結果が出るか
2. **カバレッジ**: 様々な回答で多様な卦が出現するか
3. **整合性**: Engine/Interface/SafeModeの関係性は適切か
4. **安定性**: エラーなく診断が完了するか

## テスト回答パターン

- パターンA: 全A回答（外向的・積極的）
- パターンB: 全C回答（中庸・バランス）
- パターンC: 全E回答（内向的・消極的）
- パターンD: ABCDE交互（多様性）
- パターンE: ランダム選択

## 期待される結果

- 各パターンで異なる卦の出現
- 同一パターンでも確率的に異なる結果
- エラーなく診断完了
- LocalStorageへの正常保存