# テキストから卦と爻を判定する実装 (2025/08/08)

## 実装内容

### ユーザー要求
- テキストから状況の卦と爻を出せるようにする
- 爻は卦によって意味が全然変わるから一つずつ定義した上で判断
- H384にあるデータを使用

### 実装ファイル

1. **text-to-hexagram-yao-enhanced.js**
   - 卦固有の爻辞データを使った判定ロジック
   - enhanced_hexagrams_orthodoxy.jsonから爻データ読み込み
   - 64卦のうち主要13卦の個別判定ロジック実装

### 実装した卦の爻判定パターン

```javascript
// 実装済みの卦
1. 乾為天 - 潜龍、見龍、終日乾乾、或躍在淵、飛龍在天、亢龍有悔
2. 坤為地 - 履霜、直方大、含章、括嚢、黄裳、龍戦于野
3. 水雷屯 - 困難な始まり、協力、進退窮まる等
4. 山水蒙 - 教育開始、包容、依存等
5. 水天需 - 郊外で待つ、砂地、泥、血、酒食、穴
29. 坎為水 - 習坎、坎に陥る、来たり往く等
30. 離為火 - 錯然、黄離、日昃等
31. 沢山咸 - 親指、ふくらはぎ、もも等
47. 沢水困 - 臀部、酒食に困る、石等
49. 沢火革 - 黄牛の革、己の日、三度等
52. 艮為山 - 足指、ふくらはぎ、腰等
58. 兌為沢 - 和兌、孚兌、来兌等
60. 水沢節 - 門を出ない、安節、甘節、苦節
63. 水火既済 - 濡れた尾、婦人の簾等
64. 火水未済 - 濡れた尾、車輪を引く等
```

### テスト結果
- 初回テスト: 15.4%精度（2/13成功）
- 課題: 汎用パターンマッチングとの競合
- 爻辞データが3卦分しかない（要拡充）

### 技術的課題

1. **データ不足**
   - enhanced_hexagrams_orthodoxy.jsonに3卦分のデータしかない
   - 残り61卦は汎用パターンマッチングに依存

2. **判定ロジックの優先順位**
   - 卦判定と爻判定が独立している
   - 文脈を考慮した統合判定が必要

3. **実世界テキスト対応**
   - SNS文体、口語表現への対応実装済み（advanced-text-analyzer.js）
   - 卦固有の爻判定との統合が必要

## 今後の改善点

1. 全64卦の爻辞データ整備
2. 判定精度の向上（目標80%以上）
3. 文脈考慮型の統合判定システム
4. ユーザーフィードバックによる学習機能