# Trae AI実装作業の標準手順
作成日: 2025年1月16日

## 📌 概要
Trae AI エディターを使用した実装作業の標準的な指示方法とタスク実行手順。

## 🎯 Traeの特徴
- ByteDance製のAI IDE（VS Codeベース）
- **#記号でファイル参照が可能**（検索時間短縮の鍵）
- Builderモードで複数ファイルの自動編集
- Claude 3.5 Sonnetを無料で使用可能
- ルールファイル（.trae/rules）でAIの振る舞いをカスタマイズ可能

## 📝 標準的な指示の出し方

### 1. ファイル参照の明確化
```
#public/js/VirtualPersonaEnhancer.js
#public/js/os-analyzer-main.js の7600行目付近
#public/os_analyzer.html の100行目付近
```

### 2. Builderモードの活用
```
⌘+K でBuilderモード起動
各ステップでプレビュー確認してから適用
```

### 3. 段階的な実装指示
```
ステップ1: [具体的な修正内容]
ステップ2: [次の修正内容]
（各ステップで動作確認）
```

## 🔧 効果的な指示文の構成

### 必須要素
1. **目的の明確化** - 何を達成したいか
2. **前提条件** - 現在の状態、動作している部分
3. **ファイルパス** - #記号で明確に指定
4. **修正内容** - 修正前後のコード例
5. **動作確認方法** - テスト手順

### テンプレート例
```markdown
【目的】
[修正の目的を1行で]

【対象ファイル】
#[ファイルパス]

【現在のエラー/問題】
```
[エラーメッセージや問題の説明]
```

【修正内容】
```javascript
// 修正前
[現在のコード]

// 修正後
[修正後のコード]
```

【確認方法】
1. [確認手順1]
2. [確認手順2]
```

## 💡 HaQei Analyzerでの実装例

### 2025年1月16日の修正作業
UI層の4箇所の修正で完全動作する例：

#### 1. VirtualPersonaEnhancerのnullエラー修正
- ファイル: `#public/js/VirtualPersonaEnhancer.js`
- 内容: addEventListenerの前にnullチェック追加
- エラー: `TypeError: Cannot read properties of null`

#### 2. ScreenManagerへの画面登録
- ファイル: `#public/js/os-analyzer-main.js`
- 位置: 7600行目付近
- 内容: registerScreens関数の追加
- 問題: `screens: []`で空配列

#### 3. エラー画面の表示制御
- ファイル: `#public/os_analyzer.html`
- 位置: DOMContentLoadedイベント内
- 内容: エラー画面の条件付き表示
- 問題: 常にエラー画面表示

#### 4. スタートボタンのイベント設定
- ファイル: `#public/assets/js/app.js`
- 位置: 92行目付近
- 内容: setupStartButton関数の改善
- 問題: ボタンが機能しない

## 🐛 デバッグのコツ

### サイドチャット活用（⌘+U）
```
現在のエラーを確認:
#[ファイルパス] のどこで[エラー内容]が発生していますか？
```

### インラインチャット活用（⌘+I）
コード内で直接質問や修正依頼

### ルールファイルの設定
`.trae/rules/architecture.md` にプロジェクト構造を記載
`#rulename` で呼び出し可能

## ⚠️ 注意事項
- **コア機能が正常なら触らない**（質問システム、スコアリング計算）
- **UI層のみの修正を優先**
- **nullチェックを必ず追加**
- **各ステップで動作確認**
- **プレビューを確認してから適用**

## 📊 実装の優先順位

### Phase 1: 緊急修正（必須）
1. VirtualPersonaEnhancerのnullチェック
2. ScreenManagerへの画面登録
3. エラー画面の表示条件
4. スタートボタンの動作

### Phase 2: 安定性向上（推奨）
1. すべてのDOM操作にnullチェック
2. エラーハンドリングの統一
3. 初期化順序の最適化

### Phase 3: 機能拡張（オプション）
1. 易経統合の実装
2. パフォーマンス最適化
3. UI/UXの改善

## 🔍 動作確認コマンド

```javascript
// コンソールで実行
console.log('Questions loaded:', window.QUESTIONS?.length); // 36
console.log('ScreenManager:', window.screenManager?.screens);
console.log('Errors:', document.querySelectorAll('.error').length);
```

## 📁 関連ファイル
- `20250116_Trae実装指示文.md` - 具体的な実装指示
- `20250116_UI実装指示書.md` - UI修正の詳細仕様
- `20250116_現状分析と課題整理報告書.md` - 問題の分析結果
- `20250116_易経統合プロジェクト実行計画書.md` - 将来の拡張計画

## ✅ チェックリスト

実装前：
- [ ] Traeのセットアップ完了
- [ ] プロジェクトを開いた
- [ ] Builderモード起動方法を確認（⌘+K）

実装中：
- [ ] ファイルパスを#で指定
- [ ] 各ステップでプレビュー確認
- [ ] コンソールでエラー確認

実装後：
- [ ] 画面遷移が正常動作
- [ ] 36問の質問に回答可能
- [ ] Triple OS結果が表示される
- [ ] コンソールにエラーなし

---

この手順に従うことで、Traeが効率的に実装作業を実行でき、検索時間を最小限に抑えながら正確な修正が可能になる。