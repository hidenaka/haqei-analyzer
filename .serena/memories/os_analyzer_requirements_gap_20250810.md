# HaQei OS Analyzer 要件ギャップ分析
日付: 2025-08-10
作業者: Claude

## 要件準拠率: 38% (10/26項目)

## 主要な要件ギャップ

### 1. 64卦での型記述 ❌
**要件:** 3つのOS（Engine/Interface/Safe）を64卦で"型"として確定
**現状:** 
- 64卦IDが結果に含まれていない（undefined）
- 卦名・卦象の表示がない
- hexagramIdは計算されているが、契約Aの形式で保存されていない

### 2. 相互作用と豊かさの言語化 ⚠️ 部分的
**要件:** 
- 強みが出るインターフェース ✅
- 弱みを感じやすいインターフェース ❌
- 葛藤の典型パターン ✅
- 統合のヒント ✅

**現状:**
- 「弱み」の記述が不足
- 相互作用セクションの可視化が不十分

### 3. 変化を扱わない ❌
**要件:** OSでは変化記述禁止
**現状:** 
- "transform"や"advance"などの変化記述が含まれている可能性
- Future Simulatorの概念が混在

### 4. 契約A準拠の保存形式 ❌
**要件:** 指定されたJSON形式での保存
```json
{
  "version": "1.1",
  "engine_os": {"id": 1, "name": "乾為天", "score": 0.82},
  "interface_os": {"id": 2, "name": "坤為地", "score": 0.74},
  "safe_mode_os": {"id": 29, "name": "坎為水", "score": 0.65},
  "synergy": {...},
  "interactions": {...},
  "created_at": "ISO-8601"
}
```

**現状:**
- localStorageに保存されていない、または形式が異なる
- フィールド名が要件と異なる（engine_os vs engineOS等）

### 5. UI要件 ⚠️ 部分的
**満たしている:**
- 320pxでも崩れない ✅
- 3枚のOSカード表示 ✅

**不足:**
- 卦名・卦象・要旨の表示
- 相互作用カードの明確な表示

## 改善提案

### 優先度1: 契約A準拠の実装
1. 保存形式を契約Aに完全準拠させる
2. 64卦IDとname（卦名）を正しく設定
3. scoreの計算と保存

### 優先度2: 結果表示の改善
1. 64卦の情報（卦名・卦象）を明確に表示
2. 相互作用セクションを独立して表示
3. 「弱みが出やすいインターフェース」の追加

### 優先度3: 変化記述の削除
1. OS Analyzerから変化関連の記述を削除
2. Future Simulatorとの明確な分離

## 技術的課題
- 結果画面が正しく表示されない（分析中で止まる）
- TripleOSEngineの結果形式が契約Aと異なる
- localStorageのキー名や構造が要件と不一致

## 次のステップ
1. 結果画面の表示問題を解決
2. 契約A準拠のデータ構造に変更
3. 64卦情報の適切な表示
4. 相互作用と豊かさの言語化を強化