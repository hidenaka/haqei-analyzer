import { readFile, writeFile } from 'fs/promises';

async function fixPhase17SevenFinal() {
  try {
    console.log('=== ãƒ•ã‚§ãƒ¼ã‚º17: æœ€çµ‚7æ–‡å­—49ä»¶ã‚’ä¸€è¡Œä¸€è¡Œä¿®æ­£ ===\n');
    
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èª­ã¿è¾¼ã¿
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // 7æ–‡å­—ã®èª¬æ˜ã‚’ä¸€è¡Œä¸€è¡Œä¸å¯§ã«ä¿®æ­£ï¼ˆ49ä»¶ï¼‰
    const sevenCharFixes = {
      // é€†å¢ƒãƒ»å¤‰é©ç³»
      '"é€†å¢ƒã‚’ç³§ã«ã™ã‚‹"': '"é€†å¢ƒã‚’ç³§ã«ã—ã¦æˆé•·ã™ã‚‹"',
      '"ç†±ãå¤‰é©ã‚’èªã‚‹"': '"ç†±ãå¤‰é©ã‚’èªã£ã¦äººã‚’å‹•ã‹ã™"',
      '"éæ¿€ã«è¦‹ã‚‰ã‚Œã‚‹"': '"éæ¿€ã«è¦‹ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹"',
      
      // èƒ½åŠ›ãƒ»ç‰¹æ€§ç³»
      '"æ°´ã®ã‚ˆã†ãªæŸ”è»Ÿæ€§"': '"æ°´ã®ã‚ˆã†ãªæŸ”è»Ÿæ€§ã‚’æŒã¤"',
      '"åœ°ã®ã‚ˆã†ãªå®‰å®šæ„Ÿ"': '"åœ°ã®ã‚ˆã†ãªå®‰å®šæ„ŸãŒã‚ã‚‹"',
      '"ç«ã®ã‚ˆã†ãªæƒ…ç†±æ€§"': '"ç«ã®ã‚ˆã†ãªæƒ…ç†±æ€§ã‚’æŒã¤"',
      '"é¢¨ã®ã‚ˆã†ãªè‡ªç”±åº¦"': '"é¢¨ã®ã‚ˆã†ãªè‡ªç”±åº¦ãŒã‚ã‚‹"',
      
      // çŠ¶æ…‹ãƒ»ç’°å¢ƒç³»
      '"å®ˆã‚Šã«å…¥ã‚‹çŠ¶æ…‹"': '"å®ˆã‚Šã«å…¥ã‚‹é˜²å¾¡çš„ãªçŠ¶æ…‹"',
      '"æ”»ã‚ã«è»¢ã˜ã‚‹æ™‚"': '"æ”»ã‚ã«è»¢ã˜ã‚‹ç©æ¥µçš„ãªæ™‚"',
      '"é™ã‹ã«å¾…ã¤ç’°å¢ƒ"': '"é™ã‹ã«å¾…ã¤ç©ã‚„ã‹ãªç’°å¢ƒ"',
      '"å‹•ãå‡ºã™æº–å‚™æœŸ"': '"å‹•ãå‡ºã™ãŸã‚ã®æº–å‚™æœŸé–“"',
      
      // å¯¾äººé–¢ä¿‚ç³»
      '"äººã¨ã®è·é›¢æ„Ÿè¦š"': '"äººã¨ã®é©åˆ‡ãªè·é›¢æ„Ÿè¦š"',
      '"ä¿¡é ¼ã‚’ç¯‰ãéç¨‹"': '"ä¿¡é ¼ã‚’ç¯‰ã„ã¦ã„ãéç¨‹"',
      '"å…±æ„ŸåŠ›ã‚’ç™ºæ®æ™‚"': '"å…±æ„ŸåŠ›ã‚’ç™ºæ®ã™ã‚‹æ™‚"',
      '"ç†è§£ã‚’æ·±ã‚ã‚‹å ´"': '"ç†è§£ã‚’æ·±ã‚ã¦ã„ãå ´"',
      
      // æ„Ÿæƒ…ãƒ»å¿ƒç†ç³»
      '"æ„Ÿæƒ…ã‚’æ•´ãˆã‚‹æ™‚"': '"æ„Ÿæƒ…ã‚’æ•´ãˆã‚‹å¤§åˆ‡ãªæ™‚"',
      '"å¿ƒã‚’é–‹ãæº–å‚™ä¸­"': '"å¿ƒã‚’é–‹ãæº–å‚™ã‚’ã™ã‚‹ä¸­"',
      '"æ€è€ƒã‚’æ•´ç†ã™ã‚‹"': '"æ€è€ƒã‚’æ•´ç†ã—ã¦æ˜ç¢ºã«ã™ã‚‹"',
      '"ç›´æ„Ÿã‚’ä¿¡ã˜ã‚‹æ™‚"': '"ç›´æ„Ÿã‚’ä¿¡ã˜ã¦è¡Œå‹•ã™ã‚‹æ™‚"',
      
      // è¡Œå‹•ãƒ»å®Ÿè·µç³»
      '"å®Ÿè¡Œã«ç§»ã™æ®µéš"': '"å®Ÿè¡Œã«ç§»ã—ã¦ã„ãæ®µéš"',
      '"è¨ˆç”»ã‚’ç«‹ã¦ã‚‹æ™‚"': '"è¨ˆç”»ã‚’ç«‹ã¦ã‚‹é‡è¦ãªæ™‚"',
      '"æ±ºæ–­ã‚’ä¸‹ã™ç¬é–“"': '"æ±ºæ–­ã‚’ä¸‹ã™å¤§åˆ‡ãªç¬é–“"',
      '"è¡Œå‹•ã‚’èµ·ã“ã™æ™‚"': '"è¡Œå‹•ã‚’èµ·ã“ã™ã¹ãæ™‚"',
      
      // æˆé•·ãƒ»ç™ºå±•ç³»
      '"æˆé•·ã®ç¨®ã‚’è’”ã"': '"æˆé•·ã®ç¨®ã‚’è’”ã„ã¦è‚²ã¦ã‚‹"',
      '"ç™ºå±•ã¸ã®é“ç­‹ä½œ"': '"ç™ºå±•ã¸ã®é“ç­‹ã‚’ä½œã‚‹"',
      '"é€²åŒ–ã‚’ç¶šã‘ã‚‹é“"': '"é€²åŒ–ã‚’ç¶šã‘ã¦ã„ãé“"',
      '"å¤‰åŒ–ã‚’å—ã‘å…¥ã‚Œ"': '"å¤‰åŒ–ã‚’å—ã‘å…¥ã‚Œã¦å‰é€²"',
      
      // ã‚¨ãƒãƒ«ã‚®ãƒ¼ç³»
      '"åŠ›ã‚’è“„ãˆã‚‹æœŸé–“"': '"åŠ›ã‚’è“„ãˆã‚‹é‡è¦ãªæœŸé–“"',
      '"ã‚¨ãƒãƒ«ã‚®ãƒ¼å……é›»ä¸­"': '"ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å……é›»ä¸­"',
      '"æ´»åŠ›ã‚’å–ã‚Šæˆ»ã™"': '"æ´»åŠ›ã‚’å–ã‚Šæˆ»ã—ã¦ã„ã"',
      '"å…ƒæ°—ã‚’å›å¾©ã™ã‚‹"': '"å…ƒæ°—ã‚’å›å¾©ã•ã›ã¦ã„ã"',
      
      // æ™‚é–“ãƒ»ã‚¿ã‚¤ãƒŸãƒ³ã‚°ç³»
      '"å¾…ã¤ã¹ãæ™‚æœŸ"': '"å¾…ã¤ã¹ãé‡è¦ãªæ™‚æœŸ"',
      '"å‹•ãã¹ãæ™‚æœŸ"': '"å‹•ãã¹ãå¤§åˆ‡ãªæ™‚æœŸ"',
      '"ä¼‘ã‚€ã¹ãæ™‚æœŸ"': '"ä¼‘ã‚€ã¹ãå¿…è¦ãªæ™‚æœŸ"',
      '"å§‹ã‚ã‚‹ã¹ãæ™‚"': '"å§‹ã‚ã‚‹ã¹ãæœ€é©ãªæ™‚"',
      
      // å­¦ç¿’ãƒ»ç†è§£ç³»
      '"å­¦ã³ã‚’æ·±ã‚ã‚‹æ™‚"': '"å­¦ã³ã‚’æ·±ã‚ã¦ã„ãæ™‚"',
      '"çŸ¥è­˜ã‚’å¸åã™ã‚‹"': '"çŸ¥è­˜ã‚’å¸åã—ã¦ã„ã"',
      '"ç†è§£ã‚’åºƒã’ã‚‹å ´"': '"ç†è§£ã‚’åºƒã’ã¦ã„ãå ´"',
      '"æ´å¯Ÿã‚’å¾—ã‚‹æ©Ÿä¼š"': '"æ´å¯Ÿã‚’å¾—ã‚‹è²´é‡ãªæ©Ÿä¼š"',
      
      // èª¿æ•´ãƒ»ãƒãƒ©ãƒ³ã‚¹ç³»
      '"ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹"': '"ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã£ã¦å®‰å®š"',
      '"èª¿å’Œã‚’ä¿ã¤åŠªåŠ›"': '"èª¿å’Œã‚’ä¿ã¤ãŸã‚ã®åŠªåŠ›"',
      '"å‡è¡¡ã‚’ç¶­æŒã™ã‚‹"': '"å‡è¡¡ã‚’ç¶­æŒã—ã¦ã„ã"',
      '"å®‰å®šã‚’æ±‚ã‚ã‚‹å¿ƒ"': '"å®‰å®šã‚’æ±‚ã‚ã‚‹å¿ƒã®çŠ¶æ…‹"',
      
      // ãã®ä»–
      '"æ¬¡ã¸ã®æº–å‚™æ®µéš"': '"æ¬¡ã¸ã®æº–å‚™ã‚’é€²ã‚ã‚‹æ®µéš"',
      '"æ–°ãŸãªå§‹ã¾ã‚Šæ™‚"': '"æ–°ãŸãªå§‹ã¾ã‚Šã®æ™‚"',
      '"çµ‚ã‚ã‚Šã¨å§‹ã¾ã‚Š"': '"çµ‚ã‚ã‚Šã¨å§‹ã¾ã‚Šã®è»¢æ›ç‚¹"',
      '"å¾ªç’°ã®ä¸­ç¶™ç‚¹"': '"å¾ªç’°ã®ä¸­ã®é‡è¦ãªä¸­ç¶™ç‚¹"',
      '"è»¢æ›æœŸã®å…¥å£"': '"è»¢æ›æœŸã®å…¥å£ã«ç«‹ã¤"',
      '"å¤‰åŒ–ã®äºˆå…†æœŸ"': '"å¤‰åŒ–ã®äºˆå…†ã‚’æ„Ÿã˜ã‚‹æœŸ"',
      '"é™å¯‚ã®ä¸­ã®åŠ›"': '"é™å¯‚ã®ä¸­ã«æ½œã‚€åŠ›"'
    };
    
    // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase17.${timestamp}.js`, content);
    console.log(`ğŸ“ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ: hexagram-human-traits-v3.backup.phase17.${timestamp}.js\n`);
    
    // ä¿®æ­£é©ç”¨
    let totalFixCount = 0;
    let successfulFixes = [];
    
    console.log('7æ–‡å­—ã®ä¿®æ­£ã‚’é©ç”¨ä¸­...\n');
    
    Object.entries(sevenCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const matches = content.match(regex);
      if (matches) {
        content = content.replace(regex, newText);
        totalFixCount += matches.length;
        successfulFixes.push(`${old} â†’ ${newText} (${matches.length}ç®‡æ‰€)`);
      }
    });
    
    // æˆåŠŸã—ãŸä¿®æ­£ã‚’è¡¨ç¤º
    console.log('ã€ä¿®æ­£æˆåŠŸé …ç›®ã€‘');
    if (successfulFixes.length > 0) {
      successfulFixes.slice(0, 20).forEach(fix => {
        console.log(`âœ… ${fix}`);
      });
      if (successfulFixes.length > 20) {
        console.log(`... ä»– ${successfulFixes.length - 20}ä»¶`);
      }
    } else {
      console.log('ä¿®æ­£å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
    }
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`\n=== ãƒ•ã‚§ãƒ¼ã‚º17å®Œäº† ===`);
    console.log(`ç·ä¿®æ­£ä»¶æ•°: ${totalFixCount}ä»¶`);
    console.log(`ä¿®æ­£æˆåŠŸé …ç›®: ${successfulFixes.length}ç¨®é¡`);
    console.log(`\næ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º: node fix-short-descriptions-phase18-eight-final.mjs`);
    
  } catch (error) {
    console.error('ã‚¨ãƒ©ãƒ¼:', error);
  }
}

fixPhase17SevenFinal();