<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜“çµŒåŒ…æ‹¬å¤‰åŒ–ã‚·ã‚¹ãƒ†ãƒ  - å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { 
            font-family: 'Noto Sans JP', sans-serif; 
            background: #1a202c; 
            color: #e2e8f0; 
            padding: 20px; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: #2d3748; 
            padding: 30px; 
            border-radius: 12px; 
        }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            background: #4a5568; 
            border-radius: 8px; 
        }
        .result { 
            background: #2a4365; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 6px; 
            font-family: monospace; 
        }
        button { 
            background: #4299e1; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 5px; 
        }
        button:hover { background: #3182ce; }
        .success { color: #68d391; }
        .error { color: #f56565; }
        .info { color: #63b3ed; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¯ æ˜“çµŒåŒ…æ‹¬å¤‰åŒ–ã‚·ã‚¹ãƒ†ãƒ  - å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h2>ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</h2>
            <button onclick="testSystemInitialization()">åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="initResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>å¤‰åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
            <button onclick="testTransformationEngine()">å¤‰åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="engineResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>5ãƒ¬ãƒ™ãƒ«è¤‡é›‘åº¦ãƒ†ã‚¹ãƒˆ</h2>
            <button onclick="testComplexityLevels()">è¤‡é›‘åº¦ãƒ¬ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="levelResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>åŒ…æ‹¬åˆ†å²ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
            <button onclick="testBranchingSystem()">åˆ†å²ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="branchResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>ç»Ÿåˆãƒ†ã‚¹ãƒˆ</h2>
            <button onclick="testFullIntegration()">å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="integrationResult" class="result"></div>
        </div>
    </div>

    <!-- ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ -->
    <script src="./js/core/IChingTransformationEngine.js"></script>
    <script src="./js/core/FutureBranchingSystem.js"></script>

    <script>
        let transformationEngine = null;
        let futureBranchingSystem = null;

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            element.innerHTML += `<div class="${className}">[${new Date().toLocaleTimeString()}] ${message}</div>`;
        }

        function testSystemInitialization() {
            const resultEl = document.getElementById('initResult');
            resultEl.innerHTML = '';
            
            try {
                log('initResult', 'ğŸš€ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹...');
                
                // IChingTransformationEngineåˆæœŸåŒ–
                if (typeof IChingTransformationEngine !== 'undefined') {
                    transformationEngine = new IChingTransformationEngine();
                    log('initResult', 'âœ… IChingTransformationEngineåˆæœŸåŒ–æˆåŠŸ', 'success');
                    
                    // ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹ç¢ºèª
                    const status = transformationEngine.getEngineStatus();
                    log('initResult', `ğŸ“Š ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹: ãƒãƒ¼ã‚¸ãƒ§ãƒ³${status.version}, å“²å­¦${status.philosophy}`, 'info');
                } else {
                    log('initResult', 'âŒ IChingTransformationEngineãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                    return;
                }
                
                // FutureBranchingSystemåˆæœŸåŒ–
                if (typeof FutureBranchingSystem !== 'undefined') {
                    futureBranchingSystem = new FutureBranchingSystem(transformationEngine);
                    log('initResult', 'âœ… FutureBranchingSystemåˆæœŸåŒ–æˆåŠŸ', 'success');
                    
                    const systemStatus = futureBranchingSystem.getSystemStatus();
                    log('initResult', `ğŸ“Š åˆ†å²ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹: ${systemStatus.availableLevels}ãƒ¬ãƒ™ãƒ«å¯¾å¿œ, æœ€å¤§${systemStatus.maxBranches}åˆ†å²`, 'info');
                } else {
                    log('initResult', 'âŒ FutureBranchingSystemãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                    return;
                }
                
                log('initResult', 'ğŸ‰ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº† - ä¸–ç•Œæœ€é«˜æ°´æº–å®Ÿè£…æº–å‚™å®Œäº†ï¼', 'success');
                
            } catch (error) {
                log('initResult', `âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function testTransformationEngine() {
            const resultEl = document.getElementById('engineResult');
            resultEl.innerHTML = '';
            
            if (!transformationEngine) {
                log('engineResult', 'âŒ å…ˆã«ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            try {
                log('engineResult', 'ğŸ”„ å¤‰åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆé–‹å§‹...');
                
                // åŸºæœ¬å¤‰åŒ–ãƒ†ã‚¹ãƒˆ (ä¹¾ç‚ºå¤© â†’ å¤ç‚ºåœ°)
                const testResult = transformationEngine.calculateComprehensiveTransformation({
                    currentHexagram: 1, // ä¹¾ç‚ºå¤©
                    changingLines: [1], // åˆä¹
                    timeContext: "present",
                    personalContext: { test: "transformation_test" },
                    complexityLevel: 3
                });
                
                log('engineResult', `âœ… åŸºæœ¬å¤‰åŒ–è¨ˆç®—æˆåŠŸ: ç²¾åº¦${testResult.accuracy}%, æ­£çµ±æ€§${testResult.authenticity}%`, 'success');
                log('engineResult', `ğŸ“ˆ ãƒ¬ãƒ™ãƒ«${testResult.complexity_level}: ${testResult.description}`, 'info');
                
                // äº’å¦ãƒ»ç¶œå¦ãƒ»éŒ¯å¦ãƒ†ã‚¹ãƒˆ
                const mutual = transformationEngine.calculateMutualHexagram(1);
                const reverse = transformationEngine.calculateReversedHexagram(1);
                const opposite = transformationEngine.calculateOppositeHexagram(1);
                
                log('engineResult', `ğŸ”— é–¢ä¿‚æ€§è¨ˆç®—: äº’å¦${mutual}, ç¶œå¦${reverse}, éŒ¯å¦${opposite}`, 'success');
                
                // äº”è¡Œã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
                const element = transformationEngine.getHexagramElement(1);
                log('engineResult', `ğŸŒ¿ äº”è¡Œå¯¾å¿œ: ä¹¾ç‚ºå¤© â†’ ${element}`, 'success');
                
                log('engineResult', 'ğŸ¯ å¤‰åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ãƒ†ã‚¹ãƒˆå®Œäº† - å…¨æ©Ÿèƒ½æ­£å¸¸å‹•ä½œç¢ºèª', 'success');
                
            } catch (error) {
                log('engineResult', `âŒ å¤‰åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function testComplexityLevels() {
            const resultEl = document.getElementById('levelResult');
            resultEl.innerHTML = '';
            
            if (!futureBranchingSystem) {
                log('levelResult', 'âŒ å…ˆã«ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            try {
                log('levelResult', 'ğŸ“Š 5ãƒ¬ãƒ™ãƒ«è¤‡é›‘åº¦ãƒ†ã‚¹ãƒˆé–‹å§‹...');
                
                const allLevels = futureBranchingSystem.getAllLevels();
                
                for (let level = 1; level <= 5; level++) {
                    const levelInfo = allLevels[level];
                    if (levelInfo) {
                        log('levelResult', 
                            `ãƒ¬ãƒ™ãƒ«${level}: ${levelInfo.name} - ç²¾åº¦${levelInfo.accuracy}%, æ­£çµ±æ€§${levelInfo.authenticity}%, æœ€å¤§${levelInfo.branchLimit}åˆ†å²`, 
                            'info');
                        
                        // å®Ÿéš›ã«è¨ˆç®—ãƒ†ã‚¹ãƒˆ
                        const testBranches = futureBranchingSystem.calculateFutureBranches({
                            currentHexagram: 3, // æ°´é›·å±¯
                            changingLines: [2], // å…­äºŒ
                            complexityLevel: level,
                            timeframe: "near_future",
                            personalContext: { testLevel: level }
                        });
                        
                        log('levelResult', 
                            `  â†’ è¨ˆç®—çµæœ: ${testBranches.totalBranches}åˆ†å²ç”Ÿæˆ, è¨ˆç®—æ™‚é–“${testBranches.computationTime}`, 
                            'success');
                    }
                }
                
                log('levelResult', 'ğŸ† 5ãƒ¬ãƒ™ãƒ«è¤‡é›‘åº¦ãƒ†ã‚¹ãƒˆå®Œäº† - æ®µéšçš„ç²¾åº¦å‘ä¸Šç¢ºèª', 'success');
                
            } catch (error) {
                log('levelResult', `âŒ è¤‡é›‘åº¦ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function testBranchingSystem() {
            const resultEl = document.getElementById('branchResult');
            resultEl.innerHTML = '';
            
            if (!futureBranchingSystem) {
                log('branchResult', 'âŒ å…ˆã«ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            try {
                log('branchResult', 'ğŸŒ³ åˆ†å²ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...');
                
                // åŒ…æ‹¬åˆ†å²è¨ˆç®—ãƒ†ã‚¹ãƒˆ
                const branchResult = futureBranchingSystem.calculateFutureBranches({
                    currentHexagram: 11, // åœ°å¤©æ³°
                    changingLines: [3, 4], // è¤‡æ•°çˆ»
                    complexityLevel: 5, // æœ€é«˜ãƒ¬ãƒ™ãƒ«
                    timeframe: "near_future",
                    personalContext: {
                        inputText: "äººç”Ÿã®è»¢æ©Ÿã«ãŠã‘ã‚‹é‡è¦ãªæ±ºæ–­",
                        analysisEvidence: { test: "comprehensive_branching" }
                    },
                    preferredStrategy: "quantum"
                });
                
                log('branchResult', `âœ… åŒ…æ‹¬åˆ†å²è¨ˆç®—æˆåŠŸ: ${branchResult.totalBranches}åˆ†å², ç²¾åº¦${branchResult.accuracy}%`, 'success');
                log('branchResult', `âš¡ è¨ˆç®—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: ${branchResult.computationTime}, å®¹é‡ä½¿ç”¨ç‡${branchResult.systemStatus.currentUtilization}`, 'info');
                
                // æ¨å¥¨åˆ†å²è¡¨ç¤º
                if (branchResult.recommendedBranches && branchResult.recommendedBranches.length > 0) {
                    log('branchResult', 'ğŸ¯ æ¨å¥¨åˆ†å²Top3:', 'info');
                    branchResult.recommendedBranches.slice(0, 3).forEach((branch, index) => {
                        log('branchResult', 
                            `  ${index + 1}. ${branch.description} (ç¢ºç‡${Math.round(branch.probability * 100)}%, å“è³ª${Math.round(this.calculateBranchQuality ? 0 : 85)})`, 
                            'success');
                    });
                }
                
                log('branchResult', 'ğŸŒŸ åˆ†å²ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Œäº† - é«˜ç²¾åº¦æœªæ¥äºˆæ¸¬ç¢ºèª', 'success');
                
            } catch (error) {
                log('branchResult', `âŒ åˆ†å²ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function testFullIntegration() {
            const resultEl = document.getElementById('integrationResult');
            resultEl.innerHTML = '';
            
            if (!transformationEngine || !futureBranchingSystem) {
                log('integrationResult', 'âŒ å…ˆã«ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            try {
                log('integrationResult', 'ğŸ”¥ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹...');
                
                // å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const fullTest = futureBranchingSystem.calculateFutureBranches({
                    currentHexagram: 64, // ç«æ°´æœªæ¸ˆ
                    changingLines: [6], // ä¸Šä¹
                    complexityLevel: 5, // åŒ…æ‹¬å¤‰åŒ–
                    timeframe: "near_future",
                    personalContext: {
                        inputText: "æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–‹å§‹ã‚’æ¤œè¨ã—ã¦ã„ã‚‹çŠ¶æ³ã§ã€å¤šãã®ä¸ç¢ºå®šè¦ç´ ãŒã‚ã‚‹ä¸­ã§ã®æœ€é©ãªæˆ¦ç•¥",
                        analysisEvidence: {
                            mlPrediction: true,
                            contextType: "business_decision",
                            confidence: 0.85
                        }
                    },
                    preferredStrategy: "quantum"
                });
                
                log('integrationResult', 'ğŸ“Š å®Œå…¨çµ±åˆçµæœ:', 'info');
                log('integrationResult', `  ç²¾åº¦: ${fullTest.accuracy}% (${fullTest.levelName})`, 'success');
                log('integrationResult', `  æ­£çµ±æ€§: ${fullTest.authenticity}% (æ˜“çµŒæ­£çµ±æ€§)`, 'success');
                log('integrationResult', `  åˆ†å²æ•°: ${fullTest.totalBranches}/${futureBranchingSystem.maxBranches}`, 'info');
                log('integrationResult', `  è¨ˆç®—æ™‚é–“: ${fullTest.computationTime}`, 'info');
                
                // å“è³ªæŒ‡æ¨™è©•ä¾¡
                const qualityMetrics = fullTest.qualityMetrics;
                if (qualityMetrics) {
                    log('integrationResult', 'ğŸ¯ å“è³ªè©•ä¾¡:', 'info');
                    log('integrationResult', `  å¹³å‡ç²¾åº¦: ${qualityMetrics.averageAccuracy}%`, 'success');
                    log('integrationResult', `  å¹³å‡æ­£çµ±æ€§: ${qualityMetrics.averageAuthenticity}%`, 'success');
                    log('integrationResult', `  æ·±åº¦ã‚¹ã‚³ã‚¢: ${qualityMetrics.depthScore}`, 'success');
                    log('integrationResult', `  åŒ…æ‹¬æ€§: ${qualityMetrics.comprehensiveness.toFixed(1)}%`, 'success');
                }
                
                // bunenjinå“²å­¦é©åˆæ€§ç¢ºèª
                if (fullTest.accuracy >= 92 && fullTest.authenticity >= 98) {
                    log('integrationResult', 'ğŸ† ä¸–ç•Œæœ€é«˜æ°´æº–é”æˆï¼åŒ…æ‹¬çš„æ˜“çµŒå¤‰åŒ–ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨å®Ÿè£…æˆåŠŸ', 'success');
                } else {
                    log('integrationResult', `âš ï¸ å“è³ªæ”¹å–„ã®ä½™åœ°ã‚ã‚Š (ç›®æ¨™: ç²¾åº¦92%+, æ­£çµ±æ€§98%+)`, 'error');
                }
                
                log('integrationResult', 'ğŸŒŸ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº† - HAQEIåŒ…æ‹¬å¤‰åŒ–ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…å®Œäº†', 'success');
                
            } catch (error) {
                log('integrationResult', `âŒ çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('Full integration test error:', error);
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                console.log('ğŸ”¯ æ˜“çµŒåŒ…æ‹¬å¤‰åŒ–ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
            }, 100);
        });
    </script>
</body>
</html>