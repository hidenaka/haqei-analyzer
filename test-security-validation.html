<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAQEI Security Validation Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .header h1 {
            color: #c0392b;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .security-test {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .security-test h3 {
            color: #e74c3c;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-button {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .secure { background: #d4edda; border-left: 4px solid #28a745; }
        .vulnerable { background: #f8d7da; border-left: 4px solid #dc3545; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }

        .security-level {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .level-high { background: #d4edda; color: #155724; }
        .level-medium { background: #fff3cd; color: #856404; }
        .level-low { background: #f8d7da; color: #721c24; }

        .attack-vector {
            background: #ffe6e6;
            border: 1px solid #ff9999;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .mitigation {
            background: #e6ffe6;
            border: 1px solid #99ff99;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”’ HAQEI ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</h1>
            <p>ãƒ‡ãƒ¼ã‚¿ä¿è­·ãƒ»ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã®ç·åˆãƒ†ã‚¹ãƒˆ</p>
        </div>

        <!-- XSSæ”»æ’ƒãƒ†ã‚¹ãƒˆ -->
        <div class="security-test">
            <h3>ğŸš¨ XSSæ”»æ’ƒè€æ€§ãƒ†ã‚¹ãƒˆ <span class="security-level level-high">HIGH RISK</span></h3>
            <div class="attack-vector">
                <strong>æ”»æ’ƒãƒ™ã‚¯ã‚¿ãƒ¼:</strong> ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€HTMLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
            </div>
            <button class="test-button" onclick="testXSSResistance()">XSSè€æ€§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="test-result" id="xssResult"></div>
        </div>

        <!-- ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒãƒ†ã‚¹ãƒˆ -->
        <div class="security-test">
            <h3>ğŸ’‰ ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒãƒ†ã‚¹ãƒˆ <span class="security-level level-high">HIGH RISK</span></h3>
            <div class="attack-vector">
                <strong>æ”»æ’ƒãƒ™ã‚¯ã‚¿ãƒ¼:</strong> ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€HTMLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
            </div>
            <button class="test-button" onclick="testInjectionResistance()">ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³è€æ€§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="test-result" id="injectionResult"></div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ†ã‚¹ãƒˆ -->
        <div class="security-test">
            <h3>ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ†ã‚¹ãƒˆ <span class="security-level level-medium">MEDIUM RISK</span></h3>
            <div class="attack-vector">
                <strong>å¯¾è±¡:</strong> å€‹äººæƒ…å ±å‡¦ç†ã€ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã€æƒ…å ±æ¼æ´©
            </div>
            <button class="test-button" onclick="testDataPrivacy()">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="test-result" id="privacyResult"></div>
        </div>

        <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ -->
        <div class="security-test">
            <h3>ğŸ« ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ <span class="security-level level-medium">MEDIUM RISK</span></h3>
            <div class="attack-vector">
                <strong>å¯¾è±¡:</strong> ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã€ãƒ‡ãƒ¼ã‚¿ä¿æŒã€ã‚¯ãƒ­ã‚¹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚¢ã‚¯ã‚»ã‚¹
            </div>
            <button class="test-button" onclick="testSessionSecurity()">ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="test-result" id="sessionResult"></div>
        </div>

        <!-- å…¥åŠ›æ¤œè¨¼ãƒ†ã‚¹ãƒˆ -->
        <div class="security-test">
            <h3>âœ… å…¥åŠ›æ¤œè¨¼ãƒ†ã‚¹ãƒˆ <span class="security-level level-high">HIGH RISK</span></h3>
            <div class="attack-vector">
                <strong>å¯¾è±¡:</strong> å…¥åŠ›ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            </div>
            <button class="test-button" onclick="testInputValidation()">å…¥åŠ›æ¤œè¨¼ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="test-result" id="validationResult"></div>
        </div>

        <!-- CSPãƒ†ã‚¹ãƒˆ -->
        <div class="security-test">
            <h3>ğŸ›¡ï¸ Content Security Policy ãƒ†ã‚¹ãƒˆ <span class="security-level level-medium">MEDIUM RISK</span></h3>
            <div class="attack-vector">
                <strong>å¯¾è±¡:</strong> CSPè¨­å®šã€å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹èª­ã¿è¾¼ã¿ã€ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
            </div>
            <button class="test-button" onclick="testCSP()">CSPãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div class="test-result" id="cspResult"></div>
        </div>

        <!-- å…¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ -->
        <div class="security-test">
            <h3>ğŸ” åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ</h3>
            <button class="test-button" onclick="runAllSecurityTests()" style="background: linear-gradient(135deg, #8e44ad, #9b59b6); font-size: 16px; padding: 15px 25px;">
                å…¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            </button>
            <button class="test-button" onclick="generateSecurityReport()">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
        </div>
    </div>

    <!-- ä¾å­˜é–¢ä¿‚ã®èª­ã¿è¾¼ã¿ -->
    <script src="assets/H384H64database.js"></script>
    <script src="js/pages/future-simulator/IntegratedAnalysisEngine.js"></script>
    <script src="js/pages/future-simulator/MetaphorGenerationEngine.js"></script>
    <script src="js/pages/future-simulator/DynamicKeywordGenerator.js"></script>

    <script>
        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
        class SecurityTestController {
            constructor() {
                this.testResults = new Map();
                this.vulnerabilities = [];
                this.mitigations = [];
                this.analysisEngine = null;
            }

            async initialize() {
                try {
                    console.log('ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–');
                    
                    // ãƒ†ã‚¹ãƒˆç”¨ã®åˆ†æã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–
                    this.analysisEngine = new IntegratedAnalysisEngine(window.tokenizer);
                    if (this.analysisEngine.initializeAsync) {
                        await this.analysisEngine.initializeAsync();
                    }
                    
                    console.log('âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
                } catch (error) {
                    console.error('âŒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            displayResult(testType, result, isSecure = true) {
                const resultElement = document.getElementById(`${testType}Result`);
                if (resultElement) {
                    resultElement.className = `test-result ${isSecure ? 'secure' : 'vulnerable'}`;
                    resultElement.textContent = typeof result === 'string' ? result : JSON.stringify(result, null, 2);
                }
                
                this.testResults.set(testType, { 
                    isSecure, 
                    result, 
                    timestamp: Date.now() 
                });
            }

            // XSSæ”»æ’ƒè€æ€§ãƒ†ã‚¹ãƒˆ
            async testXSSResistance() {
                console.log('ğŸš¨ XSSæ”»æ’ƒè€æ€§ãƒ†ã‚¹ãƒˆé–‹å§‹');
                
                const xssPayloads = [
                    '<script>alert("XSS")</script>',
                    '<img src="x" onerror="alert(\'XSS\')">',
                    'javascript:alert("XSS")',
                    '<svg onload="alert(\'XSS\')">',
                    '"><script>alert("XSS")</script>',
                    '\';alert(String.fromCharCode(88,83,83))//\';alert(String.fromCharCode(88,83,83))//";alert(String.fromCharCode(88,83,83))//";alert(String.fromCharCode(88,83,83))//--></SCRIPT>">\'><SCRIPT>alert(String.fromCharCode(88,83,83))</SCRIPT>',
                    '<iframe src="javascript:alert(\'XSS\')"></iframe>',
                    '<object data="javascript:alert(\'XSS\')"></object>'
                ];

                const results = [];
                let vulnerabilityCount = 0;

                for (const payload of xssPayloads) {
                    try {
                        // åˆ†æã‚¨ãƒ³ã‚¸ãƒ³ã«XSSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æŠ•å…¥
                        const result = await this.analysisEngine.performSevenStageAnalysis(payload, 'security_test', null);
                        
                        // çµæœã®ãƒ†ã‚­ã‚¹ãƒˆã«ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒæœªå‡¦ç†ã§æ®‹ã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                        const resultText = JSON.stringify(result);
                        const containsUnsafeScript = resultText.includes('<script>') || 
                                                   resultText.includes('javascript:') ||
                                                   resultText.includes('onerror=') ||
                                                   resultText.includes('onload=');

                        if (containsUnsafeScript) {
                            vulnerabilityCount++;
                            this.vulnerabilities.push({
                                type: 'XSS',
                                payload: payload,
                                severity: 'HIGH',
                                description: 'ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ'
                            });
                        }

                        results.push({
                            payload: payload.substring(0, 50) + '...',
                            sanitized: !containsUnsafeScript,
                            confidence: result.qualityMetrics?.overallConfidence || 0
                        });

                    } catch (error) {
                        // ã‚¨ãƒ©ãƒ¼ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šè‰¯ã„å…†å€™ï¼ˆé©åˆ‡ãªæ‹’å¦ï¼‰
                        results.push({
                            payload: payload.substring(0, 50) + '...',
                            sanitized: true,
                            error: 'Properly rejected'
                        });
                    }
                }

                const isSecure = vulnerabilityCount === 0;
                
                const report = `XSSæ”»æ’ƒè€æ€§ãƒ†ã‚¹ãƒˆçµæœ:
ãƒ†ã‚¹ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æ•°: ${xssPayloads.length}
è„†å¼±æ€§æ¤œå‡ºæ•°: ${vulnerabilityCount}
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«: ${isSecure ? 'å®‰å…¨' : 'è„†å¼±'}

è©³ç´°çµæœ:
${results.map(r => `- ${r.payload}: ${r.sanitized ? 'âœ… ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿' : 'âŒ å±é™º'}`).join('\n')}

${vulnerabilityCount > 0 ? `
âš ï¸  ç™ºè¦‹ã•ã‚ŒãŸè„†å¼±æ€§:
${this.vulnerabilities.filter(v => v.type === 'XSS').map(v => `- ${v.description} (${v.severity})`).join('\n')}
` : 'âœ… XSSæ”»æ’ƒã«å¯¾ã—ã¦é©åˆ‡ã«ä¿è­·ã•ã‚Œã¦ã„ã¾ã™'}`;

                this.displayResult('xss', report, isSecure);

                if (!isSecure) {
                    this.mitigations.push({
                        vulnerability: 'XSS',
                        recommendation: [
                            'å…¥åŠ›ã®HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã‚’å¼·åŒ–',
                            'Content Security Policy (CSP) ã®å®Ÿè£…',
                            'å‡ºåŠ›æ™‚ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ '
                        ]
                    });
                }
            }

            // ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒãƒ†ã‚¹ãƒˆ
            async testInjectionResistance() {
                console.log('ğŸ’‰ ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒãƒ†ã‚¹ãƒˆé–‹å§‹');

                const injectionPayloads = [
                    'eval("alert(\'injection\')")',
                    'Function("return alert(\'injection\')")()',
                    'setTimeout("alert(\'injection\')", 100)',
                    'document.write("<script>alert(\'injection\')</script>")',
                    'window["eval"]("alert(\'injection\')")',
                    'new Function("alert(\'injection\')")()',
                    '${alert("injection")}',
                    '#{alert("injection")}',
                    '{{alert("injection")}}',
                    '__import__("os").system("echo injection")'
                ];

                const results = [];
                let vulnerabilityCount = 0;

                for (const payload of injectionPayloads) {
                    try {
                        const result = await this.analysisEngine.performSevenStageAnalysis(payload, 'security_test', null);
                        
                        // çµæœã«å±é™ºãªã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
                        const resultText = JSON.stringify(result);
                        const containsUnsafeCode = resultText.includes('eval(') || 
                                                 resultText.includes('Function(') ||
                                                 resultText.includes('setTimeout(') ||
                                                 resultText.includes('document.write');

                        if (containsUnsafeCode) {
                            vulnerabilityCount++;
                            this.vulnerabilities.push({
                                type: 'Code Injection',
                                payload: payload,
                                severity: 'HIGH',
                                description: 'ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ'
                            });
                        }

                        results.push({
                            payload: payload.substring(0, 40) + '...',
                            safe: !containsUnsafeCode,
                            processed: true
                        });

                    } catch (error) {
                        results.push({
                            payload: payload.substring(0, 40) + '...',
                            safe: true,
                            processed: false,
                            error: 'Properly blocked'
                        });
                    }
                }

                const isSecure = vulnerabilityCount === 0;

                const report = `ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒãƒ†ã‚¹ãƒˆçµæœ:
ãƒ†ã‚¹ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æ•°: ${injectionPayloads.length}
è„†å¼±æ€§æ¤œå‡ºæ•°: ${vulnerabilityCount}
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«: ${isSecure ? 'å®‰å…¨' : 'è„†å¼±'}

è©³ç´°çµæœ:
${results.map(r => `- ${r.payload}: ${r.safe ? 'âœ… å®‰å…¨' : 'âŒ å±é™º'}`).join('\n')}

${vulnerabilityCount > 0 ? `
âš ï¸  ç™ºè¦‹ã•ã‚ŒãŸè„†å¼±æ€§:
${this.vulnerabilities.filter(v => v.type === 'Code Injection').map(v => `- ${v.description} (${v.severity})`).join('\n')}
` : 'âœ… ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã«å¯¾ã—ã¦é©åˆ‡ã«ä¿è­·ã•ã‚Œã¦ã„ã¾ã™'}`;

                this.displayResult('injection', report, isSecure);
            }

            // ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ†ã‚¹ãƒˆ
            async testDataPrivacy() {
                console.log('ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹');

                const privacyTests = [];
                let privacyScore = 100;

                // å€‹äººæƒ…å ±å‡¦ç†ãƒ†ã‚¹ãƒˆ
                const personalInfo = {
                    email: 'test@example.com',
                    phone: '090-1234-5678',
                    name: 'å±±ç”°å¤ªéƒ',
                    address: 'æ±äº¬éƒ½æ¸‹è°·åŒº1-1-1'
                };

                for (const [type, data] of Object.entries(personalInfo)) {
                    try {
                        const result = await this.analysisEngine.performSevenStageAnalysis(
                            `ç§ã®${type === 'email' ? 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹' : type === 'phone' ? 'é›»è©±ç•ªå·' : type === 'name' ? 'åå‰' : 'ä½æ‰€'}ã¯${data}ã§ã™`,
                            'privacy_test',
                            null
                        );

                        // çµæœã«å€‹äººæƒ…å ±ãŒå¹³æ–‡ã§æ®‹ã£ã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
                        const resultText = JSON.stringify(result);
                        const containsPersonalInfo = resultText.includes(data);

                        privacyTests.push({
                            type: type,
                            data: data,
                            leaked: containsPersonalInfo,
                            masked: !containsPersonalInfo
                        });

                        if (containsPersonalInfo) {
                            privacyScore -= 20;
                            this.vulnerabilities.push({
                                type: 'Privacy Leak',
                                data: type,
                                severity: 'MEDIUM',
                                description: `${type}æƒ…å ±ãŒçµæœã«å«ã¾ã‚Œã¦ã„ã¾ã™`
                            });
                        }

                    } catch (error) {
                        privacyTests.push({
                            type: type,
                            data: data,
                            leaked: false,
                            masked: true,
                            error: 'Processing rejected'
                        });
                    }
                }

                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
                const storageTest = this.testLocalStorageSecurity();
                privacyTests.push(storageTest);

                if (!storageTest.secure) {
                    privacyScore -= 10;
                }

                const isSecure = privacyScore >= 80;

                const report = `ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ†ã‚¹ãƒˆçµæœ:
ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚¹ã‚³ã‚¢: ${privacyScore}/100
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«: ${isSecure ? 'é©åˆ‡' : 'æ”¹å–„å¿…è¦'}

å€‹äººæƒ…å ±å‡¦ç†ãƒ†ã‚¹ãƒˆ:
${privacyTests.filter(t => t.type !== 'localStorage').map(t => 
    `- ${t.type}: ${t.masked ? 'âœ… ãƒã‚¹ã‚¯æ¸ˆã¿' : 'âŒ æ¼æ´©ãƒªã‚¹ã‚¯'}`
).join('\n')}

ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£:
- localStorage: ${storageTest.secure ? 'âœ… å®‰å…¨' : 'âŒ ãƒªã‚¹ã‚¯ã‚ã‚Š'}

${privacyScore < 80 ? `
âš ï¸  ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ”¹å–„ç‚¹:
- å€‹äººæƒ…å ±ã®è‡ªå‹•ãƒã‚¹ã‚­ãƒ³ã‚°å®Ÿè£…
- ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“ã®åˆ¶é™
- æ©Ÿå¯†æƒ…å ±ã®æš—å·åŒ–
` : 'âœ… ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãŒé©åˆ‡ã«ä¿è­·ã•ã‚Œã¦ã„ã¾ã™'}`;

                this.displayResult('privacy', report, isSecure);
            }

            testLocalStorageSecurity() {
                try {
                    const testKey = 'security_test_' + Date.now();
                    const sensitiveData = {
                        password: 'secret123',
                        token: 'auth_token_12345',
                        personal: 'æ©Ÿå¯†æƒ…å ±'
                    };

                    // æ©Ÿå¯†æƒ…å ±ã®ä¿å­˜ãƒ†ã‚¹ãƒˆ
                    localStorage.setItem(testKey, JSON.stringify(sensitiveData));
                    const retrieved = JSON.parse(localStorage.getItem(testKey));
                    
                    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                    localStorage.removeItem(testKey);

                    // å¹³æ–‡ä¿å­˜ã¯å±é™º
                    const isPlainText = retrieved.password === sensitiveData.password;

                    return {
                        type: 'localStorage',
                        secure: !isPlainText, // å¹³æ–‡ã§ãªã„å ´åˆã¯å®‰å…¨
                        encryption: !isPlainText,
                        accessible: true
                    };

                } catch (error) {
                    return {
                        type: 'localStorage',
                        secure: true,
                        encryption: true,
                        accessible: false,
                        error: error.message
                    };
                }
            }

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
            async testSessionSecurity() {
                console.log('ğŸ« ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆé–‹å§‹');

                const sessionTests = [];
                let sessionScore = 100;

                // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ†ã‚¹ãƒˆ
                const sessionTest1 = this.testSessionIsolation();
                sessionTests.push(sessionTest1);
                if (!sessionTest1.isolated) sessionScore -= 25;

                // ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒ†ã‚¹ãƒˆ
                const persistenceTest = this.testDataPersistence();
                sessionTests.push(persistenceTest);
                if (!persistenceTest.secure) sessionScore -= 25;

                // ã‚¯ãƒ­ã‚¹ã‚¿ãƒ–ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ
                const crossTabTest = this.testCrossTabSecurity();
                sessionTests.push(crossTabTest);
                if (!crossTabTest.secure) sessionScore -= 25;

                // ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™ãƒ†ã‚¹ãƒˆ
                const expirationTest = this.testSessionExpiration();
                sessionTests.push(expirationTest);
                if (!expirationTest.hasExpiration) sessionScore -= 25;

                const isSecure = sessionScore >= 75;

                const report = `ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆçµæœ:
ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ã‚³ã‚¢: ${sessionScore}/100
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«: ${isSecure ? 'é©åˆ‡' : 'æ”¹å–„å¿…è¦'}

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆè©³ç´°:
${sessionTests.map(t => `- ${t.name}: ${t.secure || t.isolated || t.hasExpiration ? 'âœ… å®‰å…¨' : 'âŒ ãƒªã‚¹ã‚¯ã‚ã‚Š'}`).join('\n')}

${sessionScore < 75 ? `
âš ï¸  ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„ç‚¹:
- ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†é›¢ã®å¼·åŒ–
- ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ã®æš—å·åŒ–
- ã‚¯ãƒ­ã‚¹ã‚¿ãƒ–ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™ã®å®Ÿè£…
` : 'âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™'}`;

                this.displayResult('session', report, isSecure);
            }

            testSessionIsolation() {
                // ç°¡æ˜“çš„ãªã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ†ã‚¹ãƒˆ
                try {
                    const sessionId1 = 'session_' + Math.random();
                    const sessionId2 = 'session_' + Math.random();
                    
                    sessionStorage.setItem(sessionId1, 'data1');
                    sessionStorage.setItem(sessionId2, 'data2');
                    
                    const isolated = sessionStorage.getItem(sessionId1) !== sessionStorage.getItem(sessionId2);
                    
                    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                    sessionStorage.removeItem(sessionId1);
                    sessionStorage.removeItem(sessionId2);
                    
                    return {
                        name: 'ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†é›¢',
                        isolated: isolated,
                        secure: isolated
                    };
                } catch (error) {
                    return {
                        name: 'ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†é›¢',
                        isolated: false,
                        secure: false,
                        error: error.message
                    };
                }
            }

            testDataPersistence() {
                try {
                    const testData = { sensitive: true, data: 'test' };
                    localStorage.setItem('persistence_test', JSON.stringify(testData));
                    
                    // ãƒ‡ãƒ¼ã‚¿ãŒæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ï¼‰
                    const rawData = localStorage.getItem('persistence_test');
                    const isEncrypted = !rawData.includes('sensitive');
                    
                    localStorage.removeItem('persistence_test');
                    
                    return {
                        name: 'ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–',
                        secure: isEncrypted,
                        encrypted: isEncrypted
                    };
                } catch (error) {
                    return {
                        name: 'ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–',
                        secure: true,
                        encrypted: true,
                        error: error.message
                    };
                }
            }

            testCrossTabSecurity() {
                // ã‚¯ãƒ­ã‚¹ã‚¿ãƒ–ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®åŸºæœ¬ãƒã‚§ãƒƒã‚¯
                try {
                    const testKey = 'cross_tab_test';
                    sessionStorage.setItem(testKey, 'test_data');
                    
                    // sessionStorageã¯è‡ªç„¶ã«ã‚¿ãƒ–é–“ã§åˆ†é›¢ã•ã‚Œã‚‹
                    const isTabIsolated = typeof sessionStorage !== 'undefined';
                    
                    sessionStorage.removeItem(testKey);
                    
                    return {
                        name: 'ã‚¯ãƒ­ã‚¹ã‚¿ãƒ–ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£',
                        secure: isTabIsolated,
                        tabIsolated: isTabIsolated
                    };
                } catch (error) {
                    return {
                        name: 'ã‚¯ãƒ­ã‚¹ã‚¿ãƒ–ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£',
                        secure: false,
                        tabIsolated: false,
                        error: error.message
                    };
                }
            }

            testSessionExpiration() {
                // ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™ã®ãƒã‚§ãƒƒã‚¯
                const hasSessionTimeout = typeof sessionStorage !== 'undefined';
                const hasLocalStorageExpiration = typeof localStorage !== 'undefined';
                
                return {
                    name: 'ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹æœŸé™',
                    hasExpiration: hasSessionTimeout,
                    mechanism: hasSessionTimeout ? 'sessionStorage' : 'none'
                };
            }

            // å…¥åŠ›æ¤œè¨¼ãƒ†ã‚¹ãƒˆ
            async testInputValidation() {
                console.log('âœ… å…¥åŠ›æ¤œè¨¼ãƒ†ã‚¹ãƒˆé–‹å§‹');

                const invalidInputs = [
                    '', // ç©ºæ–‡å­—
                    ' '.repeat(1000), // é•·ã™ãã‚‹ç©ºç™½
                    'a'.repeat(10000), // é•·ã™ãã‚‹æ–‡å­—åˆ—
                    null,
                    undefined,
                    123, // æ•°å€¤
                    [], // é…åˆ—
                    {}, // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
                    true, // çœŸå½å€¤
                    '\0\0\0', // nullæ–‡å­—
                    '\u0000\u0001\u0002', // åˆ¶å¾¡æ–‡å­—
                    'ğŸ˜€'.repeat(1000), // å¤§é‡ã®çµµæ–‡å­—
                    'SELECT * FROM users', // SQLlike
                    '../../../etc/passwd', // ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«
                    'file:///etc/passwd' // ãƒ•ã‚¡ã‚¤ãƒ«URI
                ];

                const validationResults = [];
                let validationScore = 100;

                for (const input of invalidInputs) {
                    try {
                        const result = await this.analysisEngine.performSevenStageAnalysis(input, 'validation_test', null);
                        
                        // é©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                        const hasValidationError = result.finalResult?.error || 
                                                 result.qualityMetrics?.errorCount > 0 ||
                                                 result.qualityAssessment?.grade === 'ERROR';

                        const inputType = typeof input;
                        const inputLength = input && input.length ? input.length : 0;

                        if (!hasValidationError && (inputType !== 'string' || inputLength === 0 || inputLength > 5000)) {
                            validationScore -= 5;
                            this.vulnerabilities.push({
                                type: 'Input Validation',
                                input: typeof input === 'string' ? input.substring(0, 50) : String(input),
                                severity: 'MEDIUM',
                                description: 'ä¸æ­£ãªå…¥åŠ›ãŒé©åˆ‡ã«æ¤œè¨¼ã•ã‚Œã¦ã„ã¾ã›ã‚“'
                            });
                        }

                        validationResults.push({
                            input: typeof input === 'string' ? (input.length > 20 ? input.substring(0, 20) + '...' : input) : String(input),
                            type: inputType,
                            length: inputLength,
                            validated: hasValidationError || (inputType === 'string' && inputLength > 0 && inputLength <= 5000),
                            error: hasValidationError
                        });

                    } catch (error) {
                        // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã¯è‰¯ã„ï¼ˆé©åˆ‡ãªæ¤œè¨¼ï¼‰
                        validationResults.push({
                            input: typeof input === 'string' ? input.substring(0, 20) : String(input),
                            type: typeof input,
                            validated: true,
                            caught: true,
                            error: error.message
                        });
                    }
                }

                const isSecure = validationScore >= 80;

                const report = `å…¥åŠ›æ¤œè¨¼ãƒ†ã‚¹ãƒˆçµæœ:
æ¤œè¨¼ã‚¹ã‚³ã‚¢: ${validationScore}/100
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«: ${isSecure ? 'é©åˆ‡' : 'æ”¹å–„å¿…è¦'}

æ¤œè¨¼ãƒ†ã‚¹ãƒˆè©³ç´°:
${validationResults.slice(0, 10).map(r => 
    `- ${r.input} (${r.type}): ${r.validated ? 'âœ… æ¤œè¨¼æ¸ˆã¿' : 'âŒ æœªæ¤œè¨¼'}`
).join('\n')}
${validationResults.length > 10 ? `... ä»–${validationResults.length - 10}ä»¶` : ''}

æœ‰åŠ¹ãªå…¥åŠ›ç‡: ${validationResults.filter(r => r.validated).length}/${validationResults.length}

${validationScore < 80 ? `
âš ï¸  å…¥åŠ›æ¤œè¨¼æ”¹å–„ç‚¹:
- ã‚ˆã‚Šå³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯
- æ–‡å­—åˆ—é•·åˆ¶é™ã®å®Ÿè£…
- ç‰¹æ®Šæ–‡å­—ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- NULLæ–‡å­—ãƒ»åˆ¶å¾¡æ–‡å­—ã®é™¤å»
` : 'âœ… å…¥åŠ›æ¤œè¨¼ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™'}`;

                this.displayResult('validation', report, isSecure);
            }

            // CSPãƒ†ã‚¹ãƒˆ
            async testCSP() {
                console.log('ğŸ›¡ï¸ Content Security Policy ãƒ†ã‚¹ãƒˆé–‹å§‹');

                const cspTests = [];
                let cspScore = 100;

                // CSPãƒ˜ãƒƒãƒ€ãƒ¼ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
                const cspHeaderExists = this.checkCSPHeader();
                cspTests.push(cspHeaderExists);
                if (!cspHeaderExists.exists) cspScore -= 40;

                // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒã‚§ãƒƒã‚¯
                const inlineScriptCheck = this.checkInlineScripts();
                cspTests.push(inlineScriptCheck);
                if (!inlineScriptCheck.compliant) cspScore -= 20;

                // å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ãƒã‚§ãƒƒã‚¯
                const externalResourceCheck = this.checkExternalResources();
                cspTests.push(externalResourceCheck);
                if (!externalResourceCheck.secure) cspScore -= 20;

                // eval()ä½¿ç”¨ãƒã‚§ãƒƒã‚¯
                const evalCheck = this.checkEvalUsage();
                cspTests.push(evalCheck);
                if (!evalCheck.compliant) cspScore -= 20;

                const isSecure = cspScore >= 70;

                const report = `Content Security Policy ãƒ†ã‚¹ãƒˆçµæœ:
CSPã‚¹ã‚³ã‚¢: ${cspScore}/100
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«: ${isSecure ? 'é©åˆ‡' : 'æ”¹å–„å¿…è¦'}

CSPãƒ†ã‚¹ãƒˆè©³ç´°:
${cspTests.map(t => `- ${t.name}: ${t.exists || t.compliant || t.secure ? 'âœ… é©åˆ‡' : 'âŒ è¦æ”¹å–„'}`).join('\n')}

${cspScore < 70 ? `
âš ï¸  CSPæ”¹å–„ç‚¹:
- CSPãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š
- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®é™¤å»
- å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®åˆ¶é™
- eval()ã®ä½¿ç”¨ç¦æ­¢
` : 'âœ… Content Security PolicyãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™'}`;

                this.displayResult('csp', report, isSecure);
            }

            checkCSPHeader() {
                // CSPãƒ˜ãƒƒãƒ€ãƒ¼ã®ç°¡æ˜“ãƒã‚§ãƒƒã‚¯
                const metaCSP = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
                return {
                    name: 'CSPãƒ˜ãƒƒãƒ€ãƒ¼',
                    exists: !!metaCSP,
                    content: metaCSP ? metaCSP.content : 'ãªã—'
                };
            }

            checkInlineScripts() {
                // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
                const inlineScripts = document.querySelectorAll('script:not([src])');
                const hasInlineScripts = inlineScripts.length > 0;
                
                return {
                    name: 'ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ',
                    compliant: !hasInlineScripts,
                    count: inlineScripts.length,
                    recommendation: hasInlineScripts ? 'CSP nonce or hashã‚’ä½¿ç”¨' : 'ãªã—'
                };
            }

            checkExternalResources() {
                // å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®ãƒã‚§ãƒƒã‚¯
                const externalScripts = document.querySelectorAll('script[src]');
                const externalStyles = document.querySelectorAll('link[rel="stylesheet"]');
                
                let unsafeResources = 0;
                externalScripts.forEach(script => {
                    const src = script.src;
                    if (src && !src.startsWith(window.location.origin) && !src.startsWith('https://')) {
                        unsafeResources++;
                    }
                });

                return {
                    name: 'å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹',
                    secure: unsafeResources === 0,
                    unsafeCount: unsafeResources,
                    totalExternal: externalScripts.length + externalStyles.length
                };
            }

            checkEvalUsage() {
                // eval()ã®ä½¿ç”¨ãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ï¼‰
                const scriptsContent = Array.from(document.scripts)
                    .map(script => script.innerHTML)
                    .join(' ');
                
                const hasEval = scriptsContent.includes('eval(') || 
                               scriptsContent.includes('Function(') ||
                               scriptsContent.includes('setTimeout(') && scriptsContent.includes('string');

                return {
                    name: 'eval()ä½¿ç”¨',
                    compliant: !hasEval,
                    detected: hasEval,
                    recommendation: hasEval ? 'eval()ã®ä½¿ç”¨ã‚’é¿ã‘ã‚‹' : 'ãªã—'
                };
            }

            // å…¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            async runAllSecurityTests() {
                console.log('ğŸ” åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆé–‹å§‹');
                
                try {
                    await this.initialize();
                    
                    await this.testXSSResistance();
                    await this.testInjectionResistance();
                    await this.testDataPrivacy();
                    await this.testSessionSecurity();
                    await this.testInputValidation();
                    await this.testCSP();
                    
                    console.log('âœ… å…¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆå®Œäº†');
                    
                } catch (error) {
                    console.error('âŒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
            generateSecurityReport() {
                const timestamp = new Date().toISOString();
                const totalTests = this.testResults.size;
                const secureTests = Array.from(this.testResults.values()).filter(r => r.isSecure).length;
                const securityScore = totalTests > 0 ? Math.round((secureTests / totalTests) * 100) : 0;

                const report = {
                    timestamp: timestamp,
                    securityScore: securityScore,
                    totalTests: totalTests,
                    secureTests: secureTests,
                    vulnerableTests: totalTests - secureTests,
                    testResults: Object.fromEntries(this.testResults),
                    vulnerabilities: this.vulnerabilities,
                    mitigations: this.mitigations,
                    recommendations: this.generateSecurityRecommendations(),
                    environment: {
                        userAgent: navigator.userAgent,
                        language: navigator.language,
                        protocol: window.location.protocol,
                        secureContext: window.isSecureContext
                    }
                };

                // ãƒ¬ãƒãƒ¼ãƒˆã‚’JSONã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `haqei-security-report-${timestamp.replace(/[:.]/g, '-')}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                console.log('ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ', report);
            }

            generateSecurityRecommendations() {
                const recommendations = [];
                
                if (this.vulnerabilities.some(v => v.type === 'XSS')) {
                    recommendations.push('XSSæ”»æ’ƒå¯¾ç­–: å…¥åŠ›å€¤ã®HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã¨CSPã®å®Ÿè£…');
                }
                
                if (this.vulnerabilities.some(v => v.type === 'Code Injection')) {
                    recommendations.push('ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–: eval()ã®ä½¿ç”¨ç¦æ­¢ã¨å…¥åŠ›æ¤œè¨¼ã®å¼·åŒ–');
                }
                
                if (this.vulnerabilities.some(v => v.type === 'Privacy Leak')) {
                    recommendations.push('ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·: å€‹äººæƒ…å ±ã®è‡ªå‹•ãƒã‚¹ã‚­ãƒ³ã‚°ã¨æš—å·åŒ–');
                }
                
                if (this.vulnerabilities.some(v => v.type === 'Input Validation')) {
                    recommendations.push('å…¥åŠ›æ¤œè¨¼: å‹ãƒã‚§ãƒƒã‚¯ã¨æ–‡å­—åˆ—é•·åˆ¶é™ã®å®Ÿè£…');
                }
                
                if (recommendations.length === 0) {
                    recommendations.push('ç¾åœ¨ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã¯é©åˆ‡ã§ã™ã€‚å®šæœŸçš„ãªç›£æŸ»ã‚’ç¶™ç¶šã—ã¦ãã ã•ã„ã€‚');
                }
                
                return recommendations;
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
        const securityController = new SecurityTestController();

        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–¢æ•°
        async function testXSSResistance() {
            await securityController.initialize();
            await securityController.testXSSResistance();
        }

        async function testInjectionResistance() {
            await securityController.initialize();
            await securityController.testInjectionResistance();
        }

        async function testDataPrivacy() {
            await securityController.initialize();
            await securityController.testDataPrivacy();
        }

        async function testSessionSecurity() {
            await securityController.initialize();
            await securityController.testSessionSecurity();
        }

        async function testInputValidation() {
            await securityController.initialize();
            await securityController.testInputValidation();
        }

        async function testCSP() {
            await securityController.initialize();
            await securityController.testCSP();
        }

        async function runAllSecurityTests() {
            await securityController.runAllSecurityTests();
        }

        function generateSecurityReport() {
            securityController.generateSecurityReport();
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ”’ HAQEI ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
        });
    </script>
</body>
</html>