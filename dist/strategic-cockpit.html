<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HAQEI æˆ¦ç•¥ã‚³ãƒƒã‚¯ãƒ”ãƒƒãƒˆ - å€‹äººOSçµ±åˆæˆ¦ç•¥ã‚·ã‚¹ãƒ†ãƒ </title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>æ˜“</text></svg>"
    />
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&family=Shippori+Mincho:wght@400;700&display=swap"
      rel="stylesheet"
    />
    
    <!-- Core HAQEI Assets -->
    <script src="./assets/H384H64database.js"></script>
    
    <style>
      body {
        font-family: "Inter", "Noto Sans JP", sans-serif;
      }
      
      .brand-text {
        background: -webkit-linear-gradient(45deg, #a5b4fc, #e0e7ff);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      
      .strategy-module {
        background: rgba(17, 24, 39, 0.8);
        border: 1px solid rgba(55, 65, 81, 0.5);
        backdrop-filter: blur(10px);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
      }
      
      .strategy-module:hover {
        border-color: rgba(99, 102, 241, 0.5);
        box-shadow: 0 8px 32px rgba(99, 102, 241, 0.2);
      }
      
      .module-title {
        font-family: "Shippori Mincho", serif;
        font-size: 1.5rem;
        font-weight: 700;
        color: #c7d2fe;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid #4f46e5;
        padding-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      
      .os-strategy-card {
        background: rgba(30, 41, 59, 0.8);
        border-radius: 0.75rem;
        padding: 1.5rem;
        border: 2px solid transparent;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      
      .os-strategy-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--os-color);
        opacity: 0.7;
      }
      
      .engine-card { --os-color: #f59e0b; }
      .interface-card { --os-color: #3b82f6; }
      .safemode-card { --os-color: #10b981; }
      
      .os-strategy-card:hover {
        transform: translateY(-4px);
        border-color: var(--os-color);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
      }
      
      .strategy-insight {
        background: rgba(99, 102, 241, 0.1);
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 0.5rem;
        padding: 1rem;
        margin-top: 1rem;
      }
      
      .action-item {
        background: rgba(16, 185, 129, 0.1);
        border-left: 3px solid #10b981;
        padding: 0.75rem 1rem;
        margin: 0.5rem 0;
        border-radius: 0 0.5rem 0.5rem 0;
      }
      
      .risk-item {
        background: rgba(239, 68, 68, 0.1);
        border-left: 3px solid #ef4444;
        padding: 0.75rem 1rem;
        margin: 0.5rem 0;
        border-radius: 0 0.5rem 0.5rem 0;
      }
      
      .timeline-phase {
        background: rgba(139, 92, 246, 0.1);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 0.5rem;
        padding: 1rem;
        margin: 0.5rem 0;
      }
      
      .loading-spinner {
        width: 32px;
        height: 32px;
        border: 3px solid rgba(99, 102, 241, 0.3);
        border-left: 3px solid #6366f1;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .fade-in {
        animation: fadeIn 0.6s ease-out;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      .error-message {
        background: rgba(220, 38, 38, 0.1);
        border: 1px solid rgba(220, 38, 38, 0.3);
        border-radius: 0.5rem;
        padding: 1rem;
        color: #fca5a5;
        text-align: center;
      }
      
      @media (max-width: 768px) {
        .strategy-module {
          padding: 1rem;
          margin-bottom: 1rem;
        }
        
        .module-title {
          font-size: 1.25rem;
        }
        
        .os-strategy-card {
          padding: 1rem;
        }
      }
    </style>
</head>

<body class="bg-gray-900 text-gray-200 min-h-screen">
    <!-- Header Section -->
    <header class="bg-gray-800 shadow-lg border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-4xl font-bold brand-text tracking-wider">
                        HAQEI æˆ¦ç•¥ã‚³ãƒƒã‚¯ãƒ”ãƒƒãƒˆ
                    </h1>
                    <p class="text-gray-400 mt-2 text-lg">
                        Triple OS Ã— ç¾åœ¨çŠ¶æ³ Ã— æ˜“çµŒAI = å€‹äººå°‚ç”¨æˆ¦ç•¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹
                    </p>
                </div>
                <div class="flex gap-4">
                    <button onclick="refreshData()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                        ğŸ”„ ãƒ‡ãƒ¼ã‚¿æ›´æ–°
                    </button>
                    <button onclick="exportStrategy()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors">
                        ğŸ“¤ æˆ¦ç•¥æ›¸å‡ºåŠ›
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Status Dashboard -->
        <div id="status-dashboard" class="strategy-module">
            <h2 class="module-title">ğŸ¯ æˆ¦ç•¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="text-2xl font-bold text-amber-400" id="os-analysis-status">æœªå®Ÿè¡Œ</div>
                    <p class="text-sm text-gray-400">OSåˆ†æã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</p>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-400" id="future-sim-status">æœªå®Ÿè¡Œ</div>
                    <p class="text-sm text-gray-400">æœªæ¥åˆ†æã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</p>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-400" id="strategy-ready-status">å¾…æ©Ÿä¸­</div>
                    <p class="text-sm text-gray-400">æˆ¦ç•¥ç”Ÿæˆæº–å‚™</p>
                </div>
            </div>
        </div>

        <!-- Triple OS Strategic Analysis -->
        <div id="triple-os-strategy" class="strategy-module hidden">
            <h2 class="module-title">ğŸ”¥ Triple OSæˆ¦ç•¥åˆ†æ</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6" id="os-strategies-container">
                <!-- Dynamic OS Strategy Cards will be inserted here -->
            </div>
        </div>

        <!-- Integrated Strategic Advice -->
        <div id="strategic-advice" class="strategy-module hidden">
            <h2 class="module-title">âš¡ çµ±åˆæˆ¦ç•¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h2>
            <div id="ai-strategic-analysis" class="text-center py-8">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-400">AIãŒæˆ¦ç•¥ã‚’ç”Ÿæˆä¸­...</p>
            </div>
        </div>

        <!-- Action Plan -->
        <div id="action-plan" class="strategy-module hidden">
            <h2 class="module-title">ğŸ“‹ è¡Œå‹•è¨ˆç”»</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold text-green-400 mb-3">âœ… ä»Šã™ãå®Ÿè¡Œã™ã¹ãè¡Œå‹•</h3>
                    <div id="immediate-actions"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-blue-400 mb-3">ğŸ“… æ®µéšçš„å®Ÿè¡Œè¨ˆç”»</h3>
                    <div id="timeline-plan"></div>
                </div>
            </div>
        </div>

        <!-- Risk Management -->
        <div id="risk-management" class="strategy-module hidden">
            <h2 class="module-title">ğŸ›¡ï¸ ãƒªã‚¹ã‚¯ç®¡ç†æˆ¦ç•¥</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div>
                    <h3 class="text-lg font-semibold text-red-400 mb-3">ğŸš¨ é«˜ãƒªã‚¹ã‚¯è¦å› </h3>
                    <div id="high-risk-items"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-yellow-400 mb-3">âš ï¸ ä¸­ãƒªã‚¹ã‚¯è¦å› </h3>
                    <div id="medium-risk-items"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-green-400 mb-3">âœ… ç®¡ç†æ¸ˆã¿è¦å› </h3>
                    <div id="low-risk-items"></div>
                </div>
            </div>
        </div>

        <!-- Data Sources Links -->
        <div class="strategy-module">
            <h2 class="module-title">ğŸ”— ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ç®¡ç†</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="text-center p-6 bg-gray-800 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">ğŸ§¬ OSåˆ†æã‚·ã‚¹ãƒ†ãƒ </h3>
                    <p class="text-gray-400 mb-4">Triple OSã®è©³ç´°åˆ†æã¨æœ€é©åŒ–</p>
                    <a href="os_analyzer.html" class="bg-amber-600 hover:bg-amber-700 px-4 py-2 rounded-lg transition-colors inline-block">
                        OSåˆ†æã‚’å®Ÿè¡Œ
                    </a>
                </div>
                <div class="text-center p-6 bg-gray-800 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">ğŸ”® æœªæ¥ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h3>
                    <p class="text-gray-400 mb-4">ç¾åœ¨åœ°ã‹ã‚‰è¤‡æ•°ã‚·ãƒŠãƒªã‚ªã®äºˆæ¸¬</p>
                    <a href="future_simulator.html" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors inline-block">
                        æœªæ¥åˆ†æã‚’å®Ÿè¡Œ
                    </a>
                </div>
            </div>
        </div>
    </main>

    <!-- Strategic Data Integration Engine -->
    <script>
        // Global Configuration
        const STRATEGIC_COCKPIT_CONFIG = {
            version: '2.0.0',
            debug: true,
            llmEndpoint: '/api/strategic-advice',
            maxRetries: 3,
            timeout: 30000
        };

        // Core Data Structures
        let strategicData = {
            osAnalysis: null,
            futureSimulation: null,
            strategicAdvice: null,
            lastUpdated: null
        };

        // Strategic Data Integration Class
        class StrategicDataIntegrator {
            constructor() {
                this.initialized = false;
                this.cache = new Map();
            }

            async initialize() {
                console.log('ğŸš€ Strategic Cockpit initializing...');
                
                try {
                    await this.loadExistingData();
                    this.updateStatusDashboard();
                    
                    if (this.hasRequiredData()) {
                        await this.generateStrategicAnalysis();
                    }
                    
                    this.initialized = true;
                    console.log('âœ… Strategic Cockpit initialized');
                    
                } catch (error) {
                    console.error('âŒ Initialization failed:', error);
                    this.showError('ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                }
            }

            async loadExistingData() {
                // Load OS Analysis Data
                const osDataString = localStorage.getItem('haqeiOsAnalyzerData');
                if (osDataString) {
                    try {
                        strategicData.osAnalysis = JSON.parse(osDataString);
                        console.log('âœ… OS Analysis data loaded');
                    } catch (error) {
                        console.error('âŒ Failed to parse OS Analysis data:', error);
                    }
                }

                // Load Future Simulation Data
                const futureDataString = localStorage.getItem('proFutureReportData');
                if (futureDataString) {
                    try {
                        strategicData.futureSimulation = JSON.parse(futureDataString);
                        console.log('âœ… Future Simulation data loaded');
                    } catch (error) {
                        console.error('âŒ Failed to parse Future Simulation data:', error);
                    }
                }

                strategicData.lastUpdated = new Date().toISOString();
            }

            hasRequiredData() {
                const hasOSData = strategicData.osAnalysis && 
                                 strategicData.osAnalysis.analysisResult && 
                                 strategicData.osAnalysis.analysisResult.hexagram_candidates;
                
                const hasFutureData = strategicData.futureSimulation && 
                                     strategicData.futureSimulation.paths;

                return hasOSData || hasFutureData; // At least one is required
            }

            updateStatusDashboard() {
                const osStatus = document.getElementById('os-analysis-status');
                const futureStatus = document.getElementById('future-sim-status');
                const strategyStatus = document.getElementById('strategy-ready-status');

                if (strategicData.osAnalysis) {
                    osStatus.textContent = 'å®Œäº†';
                    osStatus.className = 'text-2xl font-bold text-green-400';
                } else {
                    osStatus.textContent = 'æœªå®Ÿè¡Œ';
                    osStatus.className = 'text-2xl font-bold text-gray-500';
                }

                if (strategicData.futureSimulation) {
                    futureStatus.textContent = 'å®Œäº†';
                    futureStatus.className = 'text-2xl font-bold text-green-400';
                } else {
                    futureStatus.textContent = 'æœªå®Ÿè¡Œ';
                    futureStatus.className = 'text-2xl font-bold text-gray-500';
                }

                if (this.hasRequiredData()) {
                    strategyStatus.textContent = 'æº–å‚™å®Œäº†';
                    strategyStatus.className = 'text-2xl font-bold text-green-400';
                } else {
                    strategyStatus.textContent = 'ãƒ‡ãƒ¼ã‚¿ä¸è¶³';
                    strategyStatus.className = 'text-2xl font-bold text-yellow-400';
                }
            }

            async generateStrategicAnalysis() {
                if (!this.hasRequiredData()) {
                    console.warn('âš ï¸ Insufficient data for strategic analysis');
                    return;
                }

                try {
                    // Show Triple OS Strategy if available
                    if (strategicData.osAnalysis) {
                        this.renderTripleOSStrategy();
                    }

                    // Generate AI Strategic Advice
                    await this.generateAIStrategicAdvice();
                    
                    // Show all strategic modules
                    this.showStrategicModules();

                } catch (error) {
                    console.error('âŒ Strategic analysis failed:', error);
                    this.showError('æˆ¦ç•¥åˆ†æã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                }
            }

            renderTripleOSStrategy() {
                const container = document.getElementById('os-strategies-container');
                const candidates = strategicData.osAnalysis.analysisResult.hexagram_candidates;
                
                if (!candidates || candidates.length < 3) {
                    console.warn('âš ï¸ Insufficient OS candidates');
                    return;
                }

                const osTypes = [
                    { name: 'Engine OS', icon: 'ğŸ”¥', class: 'engine-card', desc: 'å†…ç™ºçš„å‹•æ©Ÿã‚·ã‚¹ãƒ†ãƒ ' },
                    { name: 'Interface OS', icon: 'ğŸ­', class: 'interface-card', desc: 'ç¤¾ä¼šå®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ ' },
                    { name: 'Safe Mode OS', icon: 'ğŸ›¡ï¸', class: 'safemode-card', desc: 'å®‰å…¨ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ' }
                ];

                container.innerHTML = candidates.slice(0, 3).map((os, index) => {
                    const osType = osTypes[index];
                    return `
                        <div class="os-strategy-card ${osType.class}">
                            <div class="flex items-center mb-4">
                                <span class="text-2xl mr-3">${osType.icon}</span>
                                <div>
                                    <h3 class="text-lg font-semibold text-white">${osType.name}</h3>
                                    <p class="text-sm text-gray-400">${osType.desc}</p>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="text-xl font-bold text-white mb-2">${os.name_jp || os.name}</h4>
                                <p class="text-sm text-gray-300 mb-2">${os.reading || ''}</p>
                                <p class="text-gray-400 text-sm">${os.keywords || os.description || ''}</p>
                            </div>
                            
                            <div class="strategy-insight">
                                <h5 class="font-semibold text-purple-300 mb-2">ğŸ’¡ æˆ¦ç•¥çš„æ´»ç”¨æ³•</h5>
                                <p class="text-sm text-gray-300" id="strategy-${index}">
                                    åˆ†æä¸­...
                                </p>
                            </div>
                        </div>
                    `;
                }).join('');

                // Generate specific strategic insights for each OS
                this.generateOSSpecificInsights(candidates);
                
                document.getElementById('triple-os-strategy').classList.remove('hidden');
            }

            generateOSSpecificInsights(candidates) {
                candidates.slice(0, 3).forEach((os, index) => {
                    const insightElement = document.getElementById(`strategy-${index}`);
                    if (insightElement) {
                        // Generate context-aware strategic insight
                        const insight = this.generateOSInsight(os, index);
                        insightElement.textContent = insight;
                    }
                });
            }

            generateOSInsight(os, osIndex) {
                const osNames = ['Engine OS', 'Interface OS', 'Safe Mode OS'];
                const osName = osNames[osIndex];
                
                // Basic strategic insights based on hexagram characteristics
                const insights = {
                    0: `${osName}ã¨ã—ã¦ã€Œ${os.name_jp}ã€ã‚’æ´»ç”¨ï¼šå‰µé€ çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ç¾åœ¨ã®èª²é¡Œè§£æ±ºã«å‘ã‘ã¦é›†ä¸­æŠ•ä¸‹ã—ã€æ–°ã—ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¨¡ç´¢ã—ã¾ã—ã‚‡ã†ã€‚`,
                    1: `${osName}ã¨ã—ã¦ã€Œ${os.name_jp}ã€ã‚’æ´»ç”¨ï¼šç¤¾ä¼šã¨ã®æ¥ç‚¹ã§${os.keywords}ã®ç‰¹æ€§ã‚’æ´»ã‹ã—ã€å‘¨å›²ã¨ã®å”èª¿ã¨åŠ¹æœçš„ãªå®Ÿè¡Œã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ã€‚`,
                    2: `${osName}ã¨ã—ã¦ã€Œ${os.name_jp}ã€ã‚’æ´»ç”¨ï¼šå›°é›£ãªæ™‚æœŸã®å®‰å…¨åŸºåœ°ã¨ã—ã¦${os.keywords}ã®å®‰å®šæ€§ã‚’ä¿ã¡ã€æŒç¶šå¯èƒ½ãªæˆé•·ã‚’æ”¯ãˆã¾ã—ã‚‡ã†ã€‚`
                };

                return insights[osIndex] || `${osName}ã¨ã—ã¦ã€Œ${os.name_jp}ã€ã®ç‰¹æ€§ã‚’æ´»ã‹ã—ãŸæˆ¦ç•¥çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚`;
            }

            async generateAIStrategicAdvice() {
                const adviceContainer = document.getElementById('ai-strategic-analysis');
                
                try {
                    // Prepare data for AI analysis
                    const analysisPayload = {
                        osAnalysis: strategicData.osAnalysis,
                        futureSimulation: strategicData.futureSimulation,
                        timestamp: Date.now()
                    };

                    // For development/demo purposes, generate basic strategic advice
                    const advice = this.generateBasicStrategicAdvice(analysisPayload);
                    
                    adviceContainer.innerHTML = `
                        <div class="text-left">
                            <h3 class="text-xl font-bold text-purple-300 mb-4">ğŸ§  AIçµ±åˆæˆ¦ç•¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h3>
                            <div class="strategy-insight">
                                <p class="text-gray-300 leading-relaxed">${advice.mainAdvice}</p>
                            </div>
                            
                            <div class="mt-6">
                                <h4 class="font-semibold text-blue-300 mb-3">ğŸ¯ é‡ç‚¹æˆ¦ç•¥ãƒã‚¤ãƒ³ãƒˆ</h4>
                                <ul class="space-y-2">
                                    ${advice.keyPoints.map(point => `
                                        <li class="flex items-start">
                                            <span class="text-blue-400 mr-2">â–¶</span>
                                            <span class="text-gray-300">${point}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                    `;

                    // Generate action plan and risk management
                    this.generateActionPlan(advice);
                    this.generateRiskManagement(advice);

                } catch (error) {
                    console.error('âŒ AI strategic advice generation failed:', error);
                    adviceContainer.innerHTML = `
                        <div class="error-message">
                            <h3 class="font-bold mb-2">æˆ¦ç•¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆã‚¨ãƒ©ãƒ¼</h3>
                            <p>AIã‚¢ãƒ‰ãƒã‚¤ã‚¹ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã®ä¸Šã€å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚</p>
                        </div>
                    `;
                }
            }

            generateBasicStrategicAdvice(payload) {
                const hasOSData = payload.osAnalysis !== null;
                const hasFutureData = payload.futureSimulation !== null;
                
                let mainAdvice = '';
                let keyPoints = [];

                if (hasOSData && hasFutureData) {
                    // Both data sources available
                    const osData = payload.osAnalysis;
                    const futureData = payload.futureSimulation;
                    
                    mainAdvice = `ã‚ãªãŸã®Triple OSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¨ç¾åœ¨ã®çŠ¶æ³åˆ†æã‹ã‚‰ã€çµ±åˆçš„ãªæˆ¦ç•¥ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ææ¡ˆã—ã¾ã™ã€‚
                    Engine OSã€Œ${osData.analysisResult.hexagram_candidates[0].name_jp}ã€ã®å‰µé€ æ€§ã€
                    Interface OSã€Œ${osData.analysisResult.hexagram_candidates[1].name_jp}ã€ã®å®Ÿè¡ŒåŠ›ã€
                    Safe Mode OSã€Œ${osData.analysisResult.hexagram_candidates[2].name_jp}ã€ã®å®‰å®šæ€§ã‚’
                    ãƒãƒ©ãƒ³ã‚¹è‰¯ãæ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ç¾åœ¨ã®èª²é¡Œã€Œ${futureData.worry || 'çŠ¶æ³æ”¹å–„'}ã€ã«å¯¾ã™ã‚‹
                    å¤šè§’çš„ã§æŒç¶šå¯èƒ½ãªè§£æ±ºç­–ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚`;

                    keyPoints = [
                        '3ã¤ã®OSã®ç‰¹æ€§ã‚’ç†è§£ã—ã€çŠ¶æ³ã«å¿œã˜ã¦æœ€é©ãªOSã‚’å„ªå…ˆçš„ã«æ´»ç”¨ã™ã‚‹',
                        'å„OSã®å¼·ã¿ã‚’æ´»ã‹ã—ãŸå½¹å‰²åˆ†æ‹…ã«ã‚ˆã‚Šã€åŠ¹ç‡çš„ãªå•é¡Œè§£æ±ºã‚’å›³ã‚‹',
                        'Safe Mode OSã‚’å¸¸ã«æ„è­˜ã—ã€ãƒªã‚¹ã‚¯ç®¡ç†ã¨æŒç¶šå¯èƒ½æ€§ã‚’ç¢ºä¿ã™ã‚‹',
                        'å®šæœŸçš„ãªæŒ¯ã‚Šè¿”ã‚Šã«ã‚ˆã‚Šã€OSæ´»ç”¨æˆ¦ç•¥ã‚’ç¶™ç¶šçš„ã«æœ€é©åŒ–ã™ã‚‹'
                    ];

                } else if (hasOSData) {
                    // OS data only
                    const osData = payload.osAnalysis;
                    
                    mainAdvice = `Triple OSåˆ†æçµæœã«åŸºã¥ãå€‹äººæˆ¦ç•¥ã‚’ææ¡ˆã—ã¾ã™ã€‚
                    ã‚ãªãŸã®ä¸­æ ¸çš„ãªEngine OSã€Œ${osData.analysisResult.hexagram_candidates[0].name_jp}ã€ã‚’ä¸»è»¸ã¨ã—ã¦ã€
                    Interface OSã€Œ${osData.analysisResult.hexagram_candidates[1].name_jp}ã€ã«ã‚ˆã‚‹ç¤¾ä¼šå®Ÿè£…ã¨ã€
                    Safe Mode OSã€Œ${osData.analysisResult.hexagram_candidates[2].name_jp}ã€ã«ã‚ˆã‚‹å®‰å…¨ç®¡ç†ã®
                    ä¸‰ä½ä¸€ä½“ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã§ã€å€‹äººã®æ½œåœ¨èƒ½åŠ›ã‚’æœ€å¤§é™ç™ºæ®ã§ãã¾ã™ã€‚`;

                    keyPoints = [
                        'Engine OSã®å‰µé€ çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æ—¥å¸¸ã®èª²é¡Œè§£æ±ºã«ç©æ¥µæ´»ç”¨ã™ã‚‹',
                        'Interface OSã®ç¤¾ä¼šæ€§ã‚’æ´»ã‹ã—ã€å‘¨å›²ã¨ã®å”èª¿ã¨åŠ¹æœçš„ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å›³ã‚‹',
                        'Safe Mode OSã®å®‰å®šæ©Ÿèƒ½ã«ã‚ˆã‚Šã€ã‚¹ãƒˆãƒ¬ã‚¹ç®¡ç†ã¨ç¶™ç¶šå¯èƒ½ãªæˆé•·ã‚’å®Ÿç¾ã™ã‚‹'
                    ];

                } else if (hasFutureData) {
                    // Future data only
                    const futureData = payload.futureSimulation;
                    
                    mainAdvice = `æœªæ¥åˆ†æçµæœã«åŸºã¥ãæˆ¦ç•¥çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ææ¡ˆã—ã¾ã™ã€‚
                    ç¾åœ¨ã®èª²é¡Œã€Œ${futureData.worry || 'çŠ¶æ³æ”¹å–„'}ã€ã«å¯¾ã—ã¦ã€
                    è¤‡æ•°ã®ã‚·ãƒŠãƒªã‚ªã‚’æƒ³å®šã—ãŸæŸ”è»Ÿã§é©å¿œæ€§ã®é«˜ã„æˆ¦ç•¥ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã§ã€
                    ä¸ç¢ºå®Ÿæ€§ã®é«˜ã„ç’°å¢ƒã§ã‚‚å®‰å®šã—ãŸæˆæœã‚’å®Ÿç¾ã§ãã¾ã™ã€‚`;

                    keyPoints = [
                        'è¤‡æ•°ã®ã‚·ãƒŠãƒªã‚ªã‚’å¸¸ã«æƒ³å®šã—ã€çŠ¶æ³å¤‰åŒ–ã«æŸ”è»Ÿã«å¯¾å¿œã§ãã‚‹ä½“åˆ¶ã‚’æ§‹ç¯‰ã™ã‚‹',
                        'çŸ­æœŸçš„æˆæœã¨é•·æœŸçš„æŒç¶šå¯èƒ½æ€§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸæˆ¦ç•¥ã‚’å®Ÿè¡Œã™ã‚‹',
                        'å®šæœŸçš„ãªçŠ¶æ³åˆ†æã«ã‚ˆã‚Šã€æˆ¦ç•¥ã®æ–¹å‘æ€§ã‚’ç¶™ç¶šçš„ã«èª¿æ•´ã™ã‚‹'
                    ];
                }

                return { mainAdvice, keyPoints };
            }

            generateActionPlan(advice) {
                const immediateContainer = document.getElementById('immediate-actions');
                const timelineContainer = document.getElementById('timeline-plan');

                const immediateActions = [
                    'ç¾åœ¨ã®èª²é¡Œã‚’3ã¤ã®OSè¦–ç‚¹ã§å†æ•´ç†ã—ã€å„ªå…ˆé †ä½ã‚’æ˜ç¢ºåŒ–ã™ã‚‹',
                    'æœ€ã‚‚æ´»ç”¨ã—ã‚„ã™ã„OSã‹ã‚‰å®Ÿéš›ã®è¡Œå‹•ã‚’é–‹å§‹ã—ã€å°ã•ãªæˆåŠŸä½“é¨“ã‚’ç©ã‚€',
                    'æ¯æ—¥ã®æŒ¯ã‚Šè¿”ã‚Šã§OSæ´»ç”¨çŠ¶æ³ã‚’ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã—ã€èª¿æ•´ã‚’è¡Œã†'
                ];

                const timelinePhases = [
                    { phase: 'ç¬¬1é€±', focus: 'OSç†è§£æ·±åŒ–', actions: 'Triple OSã®ç‰¹æ€§æŠŠæ¡ã¨ç¾çŠ¶åˆ†æ' },
                    { phase: 'ç¬¬2-4é€±', focus: 'å®Ÿè·µé–‹å§‹', actions: 'Engine OSã‚’ä¸­å¿ƒã¨ã—ãŸèª²é¡Œè§£æ±ºå®Ÿè·µ' },
                    { phase: '2-3ãƒ¶æœˆ', focus: 'çµ±åˆé‹ç”¨', actions: '3ã¤ã®OSã®é€£æºã«ã‚ˆã‚‹åŒ…æ‹¬çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ' },
                    { phase: '3ãƒ¶æœˆä»¥é™', focus: 'æœ€é©åŒ–', actions: 'ç¶™ç¶šçš„æ”¹å–„ã¨æ–°ãŸãªèª²é¡Œã¸ã®é©ç”¨' }
                ];

                immediateContainer.innerHTML = immediateActions.map(action => `
                    <div class="action-item">
                        <span class="text-green-400 font-semibold">âœ“</span>
                        <span class="ml-2 text-gray-300">${action}</span>
                    </div>
                `).join('');

                timelineContainer.innerHTML = timelinePhases.map(phase => `
                    <div class="timeline-phase">
                        <h4 class="font-semibold text-purple-300">${phase.phase}: ${phase.focus}</h4>
                        <p class="text-sm text-gray-400 mt-1">${phase.actions}</p>
                    </div>
                `).join('');
            }

            generateRiskManagement(advice) {
                const highRiskContainer = document.getElementById('high-risk-items');
                const mediumRiskContainer = document.getElementById('medium-risk-items');
                const lowRiskContainer = document.getElementById('low-risk-items');

                const riskItems = {
                    high: [
                        'Engine OSã«éåº¦ã«ä¾å­˜ã—ã€ä»–ã®OSã‚’è»½è¦–ã™ã‚‹ãƒªã‚¹ã‚¯',
                        'çŸ­æœŸæˆæœã‚’è¿½æ±‚ã—ã¦ã€Safe Mode OSã®å®‰å®šæ€§ã‚’è»½è¦–ã™ã‚‹ãƒªã‚¹ã‚¯'
                    ],
                    medium: [
                        'Interface OSã®ç¤¾ä¼šæ€§ã‚’æ´»ã‹ã—ãã‚Œãšã€å­¤ç«‹ã—ã¦ã—ã¾ã†ãƒªã‚¹ã‚¯',
                        'è¤‡æ•°OSã®åˆ‡ã‚Šæ›¿ãˆã«æ··ä¹±ã—ã€ä¸€è²«æ€§ã‚’å¤±ã†ãƒªã‚¹ã‚¯'
                    ],
                    low: [
                        'æ—¥å¸¸çš„ãªæŒ¯ã‚Šè¿”ã‚ŠãŒã§ãã¦ã„ãªã„çŠ¶æ³',
                        'å°ã•ãªå¤±æ•—ã‚’éåº¦ã«é‡è¦–ã—ã¦ã—ã¾ã†å‚¾å‘'
                    ]
                };

                highRiskContainer.innerHTML = riskItems.high.map(risk => `
                    <div class="risk-item">
                        <span class="text-red-400 font-semibold">âš ï¸</span>
                        <span class="ml-2 text-gray-300 text-sm">${risk}</span>
                    </div>
                `).join('');

                mediumRiskContainer.innerHTML = riskItems.medium.map(risk => `
                    <div class="risk-item bg-yellow-900 bg-opacity-20 border-yellow-500">
                        <span class="text-yellow-400 font-semibold">âš¡</span>
                        <span class="ml-2 text-gray-300 text-sm">${risk}</span>
                    </div>
                `).join('');

                lowRiskContainer.innerHTML = riskItems.low.map(risk => `
                    <div class="risk-item bg-green-900 bg-opacity-20 border-green-500">
                        <span class="text-green-400 font-semibold">ğŸ“</span>
                        <span class="ml-2 text-gray-300 text-sm">${risk}</span>
                    </div>
                `).join('');
            }

            showStrategicModules() {
                const modules = [
                    'strategic-advice',
                    'action-plan', 
                    'risk-management'
                ];

                modules.forEach((moduleId, index) => {
                    setTimeout(() => {
                        const module = document.getElementById(moduleId);
                        if (module) {
                            module.classList.remove('hidden');
                            module.classList.add('fade-in');
                        }
                    }, index * 200);
                });
            }

            showError(message) {
                const statusDashboard = document.getElementById('status-dashboard');
                statusDashboard.innerHTML = `
                    <div class="error-message">
                        <h3 class="font-bold mb-2">âš ï¸ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h3>
                        <p>${message}</p>
                        <div class="mt-4">
                            <button onclick="window.location.reload()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                                å†èª­ã¿è¾¼ã¿
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Global Functions
        async function refreshData() {
            console.log('ğŸ”„ Refreshing strategic data...');
            const integrator = new StrategicDataIntegrator();
            await integrator.initialize();
        }

        function exportStrategy() {
            console.log('ğŸ“¤ Exporting strategy...');
            
            const strategyData = {
                timestamp: new Date().toISOString(),
                osAnalysis: strategicData.osAnalysis,
                futureSimulation: strategicData.futureSimulation,
                strategicAdvice: strategicData.strategicAdvice
            };

            const blob = new Blob([JSON.stringify(strategyData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `haqei-strategic-analysis-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            console.log('âœ… Strategy exported successfully');
        }

        // Initialize Strategic Cockpit
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ¯ Strategic Cockpit loading...');
            
            try {
                const integrator = new StrategicDataIntegrator();
                await integrator.initialize();
            } catch (error) {
                console.error('âŒ Strategic Cockpit initialization failed:', error);
            }
        });
    </script>
</body>
</html>