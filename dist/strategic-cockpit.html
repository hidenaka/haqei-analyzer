<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HAQEI 戦略コックピット - 個人OS統合戦略システム</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>易</text></svg>"
    />
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&family=Shippori+Mincho:wght@400;700&display=swap"
      rel="stylesheet"
    />
    
    <!-- Core HAQEI Assets -->
    <script src="./assets/H384H64database.js"></script>
    
    <style>
      body {
        font-family: "Inter", "Noto Sans JP", sans-serif;
      }
      
      .brand-text {
        background: -webkit-linear-gradient(45deg, #a5b4fc, #e0e7ff);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      
      .strategy-module {
        background: rgba(17, 24, 39, 0.8);
        border: 1px solid rgba(55, 65, 81, 0.5);
        backdrop-filter: blur(10px);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
      }
      
      .strategy-module:hover {
        border-color: rgba(99, 102, 241, 0.5);
        box-shadow: 0 8px 32px rgba(99, 102, 241, 0.2);
      }
      
      .module-title {
        font-family: "Shippori Mincho", serif;
        font-size: 1.5rem;
        font-weight: 700;
        color: #c7d2fe;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid #4f46e5;
        padding-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      
      .os-strategy-card {
        background: rgba(30, 41, 59, 0.8);
        border-radius: 0.75rem;
        padding: 1.5rem;
        border: 2px solid transparent;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      
      .os-strategy-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--os-color);
        opacity: 0.7;
      }
      
      .engine-card { --os-color: #f59e0b; }
      .interface-card { --os-color: #3b82f6; }
      .safemode-card { --os-color: #10b981; }
      
      .os-strategy-card:hover {
        transform: translateY(-4px);
        border-color: var(--os-color);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
      }
      
      .strategy-insight {
        background: rgba(99, 102, 241, 0.1);
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 0.5rem;
        padding: 1rem;
        margin-top: 1rem;
      }
      
      .action-item {
        background: rgba(16, 185, 129, 0.1);
        border-left: 3px solid #10b981;
        padding: 0.75rem 1rem;
        margin: 0.5rem 0;
        border-radius: 0 0.5rem 0.5rem 0;
      }
      
      .risk-item {
        background: rgba(239, 68, 68, 0.1);
        border-left: 3px solid #ef4444;
        padding: 0.75rem 1rem;
        margin: 0.5rem 0;
        border-radius: 0 0.5rem 0.5rem 0;
      }
      
      .timeline-phase {
        background: rgba(139, 92, 246, 0.1);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 0.5rem;
        padding: 1rem;
        margin: 0.5rem 0;
      }
      
      .loading-spinner {
        width: 32px;
        height: 32px;
        border: 3px solid rgba(99, 102, 241, 0.3);
        border-left: 3px solid #6366f1;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .fade-in {
        animation: fadeIn 0.6s ease-out;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      .error-message {
        background: rgba(220, 38, 38, 0.1);
        border: 1px solid rgba(220, 38, 38, 0.3);
        border-radius: 0.5rem;
        padding: 1rem;
        color: #fca5a5;
        text-align: center;
      }
      
      @media (max-width: 768px) {
        .strategy-module {
          padding: 1rem;
          margin-bottom: 1rem;
        }
        
        .module-title {
          font-size: 1.25rem;
        }
        
        .os-strategy-card {
          padding: 1rem;
        }
      }
    </style>
</head>

<body class="bg-gray-900 text-gray-200 min-h-screen">
    <!-- Header Section -->
    <header class="bg-gray-800 shadow-lg border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-4xl font-bold brand-text tracking-wider">
                        HAQEI 戦略コックピット
                    </h1>
                    <p class="text-gray-400 mt-2 text-lg">
                        Triple OS × 現在状況 × 易経AI = 個人専用戦略アドバイス
                    </p>
                </div>
                <div class="flex gap-4">
                    <button onclick="refreshData()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                        🔄 データ更新
                    </button>
                    <button onclick="exportStrategy()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors">
                        📤 戦略書出力
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Status Dashboard -->
        <div id="status-dashboard" class="strategy-module">
            <h2 class="module-title">🎯 戦略ステータス</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="text-2xl font-bold text-amber-400" id="os-analysis-status">未実行</div>
                    <p class="text-sm text-gray-400">OS分析ステータス</p>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-400" id="future-sim-status">未実行</div>
                    <p class="text-sm text-gray-400">未来分析ステータス</p>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-400" id="strategy-ready-status">待機中</div>
                    <p class="text-sm text-gray-400">戦略生成準備</p>
                </div>
            </div>
        </div>

        <!-- Triple OS Strategic Analysis -->
        <div id="triple-os-strategy" class="strategy-module hidden">
            <h2 class="module-title">🔥 Triple OS戦略分析</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6" id="os-strategies-container">
                <!-- Dynamic OS Strategy Cards will be inserted here -->
            </div>
        </div>

        <!-- Integrated Strategic Advice -->
        <div id="strategic-advice" class="strategy-module hidden">
            <h2 class="module-title">⚡ 統合戦略アドバイス</h2>
            <div id="ai-strategic-analysis" class="text-center py-8">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-400">AIが戦略を生成中...</p>
            </div>
        </div>

        <!-- Action Plan -->
        <div id="action-plan" class="strategy-module hidden">
            <h2 class="module-title">📋 行動計画</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold text-green-400 mb-3">✅ 今すぐ実行すべき行動</h3>
                    <div id="immediate-actions"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-blue-400 mb-3">📅 段階的実行計画</h3>
                    <div id="timeline-plan"></div>
                </div>
            </div>
        </div>

        <!-- Risk Management -->
        <div id="risk-management" class="strategy-module hidden">
            <h2 class="module-title">🛡️ リスク管理戦略</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div>
                    <h3 class="text-lg font-semibold text-red-400 mb-3">🚨 高リスク要因</h3>
                    <div id="high-risk-items"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-yellow-400 mb-3">⚠️ 中リスク要因</h3>
                    <div id="medium-risk-items"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-green-400 mb-3">✅ 管理済み要因</h3>
                    <div id="low-risk-items"></div>
                </div>
            </div>
        </div>

        <!-- Data Sources Links -->
        <div class="strategy-module">
            <h2 class="module-title">🔗 データソース管理</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="text-center p-6 bg-gray-800 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">🧬 OS分析システム</h3>
                    <p class="text-gray-400 mb-4">Triple OSの詳細分析と最適化</p>
                    <a href="os_analyzer.html" class="bg-amber-600 hover:bg-amber-700 px-4 py-2 rounded-lg transition-colors inline-block">
                        OS分析を実行
                    </a>
                </div>
                <div class="text-center p-6 bg-gray-800 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">🔮 未来シミュレーター</h3>
                    <p class="text-gray-400 mb-4">現在地から複数シナリオの予測</p>
                    <a href="future_simulator.html" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors inline-block">
                        未来分析を実行
                    </a>
                </div>
            </div>
        </div>
    </main>

    <!-- Strategic Data Integration Engine -->
    <script>
        // Global Configuration
        const STRATEGIC_COCKPIT_CONFIG = {
            version: '2.0.0',
            debug: true,
            llmEndpoint: '/api/strategic-advice',
            maxRetries: 3,
            timeout: 30000
        };

        // Core Data Structures
        let strategicData = {
            osAnalysis: null,
            futureSimulation: null,
            strategicAdvice: null,
            lastUpdated: null
        };

        // Strategic Data Integration Class
        class StrategicDataIntegrator {
            constructor() {
                this.initialized = false;
                this.cache = new Map();
            }

            async initialize() {
                console.log('🚀 Strategic Cockpit initializing...');
                
                try {
                    await this.loadExistingData();
                    this.updateStatusDashboard();
                    
                    if (this.hasRequiredData()) {
                        await this.generateStrategicAnalysis();
                    }
                    
                    this.initialized = true;
                    console.log('✅ Strategic Cockpit initialized');
                    
                } catch (error) {
                    console.error('❌ Initialization failed:', error);
                    this.showError('システムの初期化に失敗しました。データソースを確認してください。');
                }
            }

            async loadExistingData() {
                // Load OS Analysis Data
                const osDataString = localStorage.getItem('haqeiOsAnalyzerData');
                if (osDataString) {
                    try {
                        strategicData.osAnalysis = JSON.parse(osDataString);
                        console.log('✅ OS Analysis data loaded');
                    } catch (error) {
                        console.error('❌ Failed to parse OS Analysis data:', error);
                    }
                }

                // Load Future Simulation Data
                const futureDataString = localStorage.getItem('proFutureReportData');
                if (futureDataString) {
                    try {
                        strategicData.futureSimulation = JSON.parse(futureDataString);
                        console.log('✅ Future Simulation data loaded');
                    } catch (error) {
                        console.error('❌ Failed to parse Future Simulation data:', error);
                    }
                }

                strategicData.lastUpdated = new Date().toISOString();
            }

            hasRequiredData() {
                const hasOSData = strategicData.osAnalysis && 
                                 strategicData.osAnalysis.analysisResult && 
                                 strategicData.osAnalysis.analysisResult.hexagram_candidates;
                
                const hasFutureData = strategicData.futureSimulation && 
                                     strategicData.futureSimulation.paths;

                return hasOSData || hasFutureData; // At least one is required
            }

            updateStatusDashboard() {
                const osStatus = document.getElementById('os-analysis-status');
                const futureStatus = document.getElementById('future-sim-status');
                const strategyStatus = document.getElementById('strategy-ready-status');

                if (strategicData.osAnalysis) {
                    osStatus.textContent = '完了';
                    osStatus.className = 'text-2xl font-bold text-green-400';
                } else {
                    osStatus.textContent = '未実行';
                    osStatus.className = 'text-2xl font-bold text-gray-500';
                }

                if (strategicData.futureSimulation) {
                    futureStatus.textContent = '完了';
                    futureStatus.className = 'text-2xl font-bold text-green-400';
                } else {
                    futureStatus.textContent = '未実行';
                    futureStatus.className = 'text-2xl font-bold text-gray-500';
                }

                if (this.hasRequiredData()) {
                    strategyStatus.textContent = '準備完了';
                    strategyStatus.className = 'text-2xl font-bold text-green-400';
                } else {
                    strategyStatus.textContent = 'データ不足';
                    strategyStatus.className = 'text-2xl font-bold text-yellow-400';
                }
            }

            async generateStrategicAnalysis() {
                if (!this.hasRequiredData()) {
                    console.warn('⚠️ Insufficient data for strategic analysis');
                    return;
                }

                try {
                    // Show Triple OS Strategy if available
                    if (strategicData.osAnalysis) {
                        this.renderTripleOSStrategy();
                    }

                    // Generate AI Strategic Advice
                    await this.generateAIStrategicAdvice();
                    
                    // Show all strategic modules
                    this.showStrategicModules();

                } catch (error) {
                    console.error('❌ Strategic analysis failed:', error);
                    this.showError('戦略分析の生成に失敗しました。');
                }
            }

            renderTripleOSStrategy() {
                const container = document.getElementById('os-strategies-container');
                const candidates = strategicData.osAnalysis.analysisResult.hexagram_candidates;
                
                if (!candidates || candidates.length < 3) {
                    console.warn('⚠️ Insufficient OS candidates');
                    return;
                }

                const osTypes = [
                    { name: 'Engine OS', icon: '🔥', class: 'engine-card', desc: '内発的動機システム' },
                    { name: 'Interface OS', icon: '🎭', class: 'interface-card', desc: '社会実行システム' },
                    { name: 'Safe Mode OS', icon: '🛡️', class: 'safemode-card', desc: '安全管理システム' }
                ];

                container.innerHTML = candidates.slice(0, 3).map((os, index) => {
                    const osType = osTypes[index];
                    return `
                        <div class="os-strategy-card ${osType.class}">
                            <div class="flex items-center mb-4">
                                <span class="text-2xl mr-3">${osType.icon}</span>
                                <div>
                                    <h3 class="text-lg font-semibold text-white">${osType.name}</h3>
                                    <p class="text-sm text-gray-400">${osType.desc}</p>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="text-xl font-bold text-white mb-2">${os.name_jp || os.name}</h4>
                                <p class="text-sm text-gray-300 mb-2">${os.reading || ''}</p>
                                <p class="text-gray-400 text-sm">${os.keywords || os.description || ''}</p>
                            </div>
                            
                            <div class="strategy-insight">
                                <h5 class="font-semibold text-purple-300 mb-2">💡 戦略的活用法</h5>
                                <p class="text-sm text-gray-300" id="strategy-${index}">
                                    分析中...
                                </p>
                            </div>
                        </div>
                    `;
                }).join('');

                // Generate specific strategic insights for each OS
                this.generateOSSpecificInsights(candidates);
                
                document.getElementById('triple-os-strategy').classList.remove('hidden');
            }

            generateOSSpecificInsights(candidates) {
                candidates.slice(0, 3).forEach((os, index) => {
                    const insightElement = document.getElementById(`strategy-${index}`);
                    if (insightElement) {
                        // Generate context-aware strategic insight
                        const insight = this.generateOSInsight(os, index);
                        insightElement.textContent = insight;
                    }
                });
            }

            generateOSInsight(os, osIndex) {
                const osNames = ['Engine OS', 'Interface OS', 'Safe Mode OS'];
                const osName = osNames[osIndex];
                
                // Basic strategic insights based on hexagram characteristics
                const insights = {
                    0: `${osName}として「${os.name_jp}」を活用：創造的エネルギーを現在の課題解決に向けて集中投下し、新しいアプローチを模索しましょう。`,
                    1: `${osName}として「${os.name_jp}」を活用：社会との接点で${os.keywords}の特性を活かし、周囲との協調と効果的な実行を心がけましょう。`,
                    2: `${osName}として「${os.name_jp}」を活用：困難な時期の安全基地として${os.keywords}の安定性を保ち、持続可能な成長を支えましょう。`
                };

                return insights[osIndex] || `${osName}として「${os.name_jp}」の特性を活かした戦略的アプローチを検討してください。`;
            }

            async generateAIStrategicAdvice() {
                const adviceContainer = document.getElementById('ai-strategic-analysis');
                
                try {
                    // Prepare data for AI analysis
                    const analysisPayload = {
                        osAnalysis: strategicData.osAnalysis,
                        futureSimulation: strategicData.futureSimulation,
                        timestamp: Date.now()
                    };

                    // For development/demo purposes, generate basic strategic advice
                    const advice = this.generateBasicStrategicAdvice(analysisPayload);
                    
                    adviceContainer.innerHTML = `
                        <div class="text-left">
                            <h3 class="text-xl font-bold text-purple-300 mb-4">🧠 AI統合戦略アドバイス</h3>
                            <div class="strategy-insight">
                                <p class="text-gray-300 leading-relaxed">${advice.mainAdvice}</p>
                            </div>
                            
                            <div class="mt-6">
                                <h4 class="font-semibold text-blue-300 mb-3">🎯 重点戦略ポイント</h4>
                                <ul class="space-y-2">
                                    ${advice.keyPoints.map(point => `
                                        <li class="flex items-start">
                                            <span class="text-blue-400 mr-2">▶</span>
                                            <span class="text-gray-300">${point}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                    `;

                    // Generate action plan and risk management
                    this.generateActionPlan(advice);
                    this.generateRiskManagement(advice);

                } catch (error) {
                    console.error('❌ AI strategic advice generation failed:', error);
                    adviceContainer.innerHTML = `
                        <div class="error-message">
                            <h3 class="font-bold mb-2">戦略アドバイス生成エラー</h3>
                            <p>AIアドバイスの生成に失敗しました。データを確認の上、再試行してください。</p>
                        </div>
                    `;
                }
            }

            generateBasicStrategicAdvice(payload) {
                const hasOSData = payload.osAnalysis !== null;
                const hasFutureData = payload.futureSimulation !== null;
                
                let mainAdvice = '';
                let keyPoints = [];

                if (hasOSData && hasFutureData) {
                    // Both data sources available
                    const osData = payload.osAnalysis;
                    const futureData = payload.futureSimulation;
                    
                    mainAdvice = `あなたのTriple OSプロファイルと現在の状況分析から、統合的な戦略アプローチを提案します。
                    Engine OS「${osData.analysisResult.hexagram_candidates[0].name_jp}」の創造性、
                    Interface OS「${osData.analysisResult.hexagram_candidates[1].name_jp}」の実行力、
                    Safe Mode OS「${osData.analysisResult.hexagram_candidates[2].name_jp}」の安定性を
                    バランス良く活用することで、現在の課題「${futureData.worry || '状況改善'}」に対する
                    多角的で持続可能な解決策を構築できます。`;

                    keyPoints = [
                        '3つのOSの特性を理解し、状況に応じて最適なOSを優先的に活用する',
                        '各OSの強みを活かした役割分担により、効率的な問題解決を図る',
                        'Safe Mode OSを常に意識し、リスク管理と持続可能性を確保する',
                        '定期的な振り返りにより、OS活用戦略を継続的に最適化する'
                    ];

                } else if (hasOSData) {
                    // OS data only
                    const osData = payload.osAnalysis;
                    
                    mainAdvice = `Triple OS分析結果に基づく個人戦略を提案します。
                    あなたの中核的なEngine OS「${osData.analysisResult.hexagram_candidates[0].name_jp}」を主軸として、
                    Interface OS「${osData.analysisResult.hexagram_candidates[1].name_jp}」による社会実装と、
                    Safe Mode OS「${osData.analysisResult.hexagram_candidates[2].name_jp}」による安全管理の
                    三位一体システムを構築することで、個人の潜在能力を最大限発揮できます。`;

                    keyPoints = [
                        'Engine OSの創造的エネルギーを日常の課題解決に積極活用する',
                        'Interface OSの社会性を活かし、周囲との協調と効果的なコミュニケーションを図る',
                        'Safe Mode OSの安定機能により、ストレス管理と継続可能な成長を実現する'
                    ];

                } else if (hasFutureData) {
                    // Future data only
                    const futureData = payload.futureSimulation;
                    
                    mainAdvice = `未来分析結果に基づく戦略的アプローチを提案します。
                    現在の課題「${futureData.worry || '状況改善'}」に対して、
                    複数のシナリオを想定した柔軟で適応性の高い戦略を構築することで、
                    不確実性の高い環境でも安定した成果を実現できます。`;

                    keyPoints = [
                        '複数のシナリオを常に想定し、状況変化に柔軟に対応できる体制を構築する',
                        '短期的成果と長期的持続可能性のバランスを重視した戦略を実行する',
                        '定期的な状況分析により、戦略の方向性を継続的に調整する'
                    ];
                }

                return { mainAdvice, keyPoints };
            }

            generateActionPlan(advice) {
                const immediateContainer = document.getElementById('immediate-actions');
                const timelineContainer = document.getElementById('timeline-plan');

                const immediateActions = [
                    '現在の課題を3つのOS視点で再整理し、優先順位を明確化する',
                    '最も活用しやすいOSから実際の行動を開始し、小さな成功体験を積む',
                    '毎日の振り返りでOS活用状況をモニタリングし、調整を行う'
                ];

                const timelinePhases = [
                    { phase: '第1週', focus: 'OS理解深化', actions: 'Triple OSの特性把握と現状分析' },
                    { phase: '第2-4週', focus: '実践開始', actions: 'Engine OSを中心とした課題解決実践' },
                    { phase: '2-3ヶ月', focus: '統合運用', actions: '3つのOSの連携による包括的アプローチ' },
                    { phase: '3ヶ月以降', focus: '最適化', actions: '継続的改善と新たな課題への適用' }
                ];

                immediateContainer.innerHTML = immediateActions.map(action => `
                    <div class="action-item">
                        <span class="text-green-400 font-semibold">✓</span>
                        <span class="ml-2 text-gray-300">${action}</span>
                    </div>
                `).join('');

                timelineContainer.innerHTML = timelinePhases.map(phase => `
                    <div class="timeline-phase">
                        <h4 class="font-semibold text-purple-300">${phase.phase}: ${phase.focus}</h4>
                        <p class="text-sm text-gray-400 mt-1">${phase.actions}</p>
                    </div>
                `).join('');
            }

            generateRiskManagement(advice) {
                const highRiskContainer = document.getElementById('high-risk-items');
                const mediumRiskContainer = document.getElementById('medium-risk-items');
                const lowRiskContainer = document.getElementById('low-risk-items');

                const riskItems = {
                    high: [
                        'Engine OSに過度に依存し、他のOSを軽視するリスク',
                        '短期成果を追求して、Safe Mode OSの安定性を軽視するリスク'
                    ],
                    medium: [
                        'Interface OSの社会性を活かしきれず、孤立してしまうリスク',
                        '複数OSの切り替えに混乱し、一貫性を失うリスク'
                    ],
                    low: [
                        '日常的な振り返りができていない状況',
                        '小さな失敗を過度に重視してしまう傾向'
                    ]
                };

                highRiskContainer.innerHTML = riskItems.high.map(risk => `
                    <div class="risk-item">
                        <span class="text-red-400 font-semibold">⚠️</span>
                        <span class="ml-2 text-gray-300 text-sm">${risk}</span>
                    </div>
                `).join('');

                mediumRiskContainer.innerHTML = riskItems.medium.map(risk => `
                    <div class="risk-item bg-yellow-900 bg-opacity-20 border-yellow-500">
                        <span class="text-yellow-400 font-semibold">⚡</span>
                        <span class="ml-2 text-gray-300 text-sm">${risk}</span>
                    </div>
                `).join('');

                lowRiskContainer.innerHTML = riskItems.low.map(risk => `
                    <div class="risk-item bg-green-900 bg-opacity-20 border-green-500">
                        <span class="text-green-400 font-semibold">📝</span>
                        <span class="ml-2 text-gray-300 text-sm">${risk}</span>
                    </div>
                `).join('');
            }

            showStrategicModules() {
                const modules = [
                    'strategic-advice',
                    'action-plan', 
                    'risk-management'
                ];

                modules.forEach((moduleId, index) => {
                    setTimeout(() => {
                        const module = document.getElementById(moduleId);
                        if (module) {
                            module.classList.remove('hidden');
                            module.classList.add('fade-in');
                        }
                    }, index * 200);
                });
            }

            showError(message) {
                const statusDashboard = document.getElementById('status-dashboard');
                statusDashboard.innerHTML = `
                    <div class="error-message">
                        <h3 class="font-bold mb-2">⚠️ エラーが発生しました</h3>
                        <p>${message}</p>
                        <div class="mt-4">
                            <button onclick="window.location.reload()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                                再読み込み
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Global Functions
        async function refreshData() {
            console.log('🔄 Refreshing strategic data...');
            const integrator = new StrategicDataIntegrator();
            await integrator.initialize();
        }

        function exportStrategy() {
            console.log('📤 Exporting strategy...');
            
            const strategyData = {
                timestamp: new Date().toISOString(),
                osAnalysis: strategicData.osAnalysis,
                futureSimulation: strategicData.futureSimulation,
                strategicAdvice: strategicData.strategicAdvice
            };

            const blob = new Blob([JSON.stringify(strategyData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `haqei-strategic-analysis-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            console.log('✅ Strategy exported successfully');
        }

        // Initialize Strategic Cockpit
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('🎯 Strategic Cockpit loading...');
            
            try {
                const integrator = new StrategicDataIntegrator();
                await integrator.initialize();
            } catch (error) {
                console.error('❌ Strategic Cockpit initialization failed:', error);
            }
        });
    </script>
</body>
</html>