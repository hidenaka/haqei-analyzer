<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>åŒä¸€å¦Engine-Safeå…¨ä»¶æ¤œè¨¼</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
        }
        .result { 
            margin: 5px 0; 
            padding: 5px; 
            border-radius: 3px;
        }
        .harmony { background: rgba(59, 130, 246, 0.2); }
        .tension { background: rgba(245, 158, 11, 0.2); }
        .conflict { background: rgba(239, 68, 68, 0.2); }
        .synergy { background: rgba(16, 185, 129, 0.2); }
        .anomaly { 
            border: 2px solid #ef4444; 
            background: rgba(239, 68, 68, 0.3);
        }
        .summary { 
            margin: 20px 0;
            padding: 15px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” åŒä¸€å¦Engine-Safeå…¨ä»¶æ¤œè¨¼</h1>
    <button onclick="verifyAllSameHexagrams()">64å¦ã™ã¹ã¦ã‚’æ¤œè¨¼</button>
    <div id="results"></div>
    <div id="summary"></div>

    <script src="./assets/H384H64database.js"></script>
    <script src="./js/core/TripleOSInteractionAnalyzer.js"></script>
    <script>
        function verifyAllSameHexagrams() {
            const analyzer = new TripleOSInteractionAnalyzer();
            const results = [];
            const anomalies = [];
            
            console.log('é–‹å§‹: 64å¦ã™ã¹ã¦ã®engine-safeåŒä¸€å¦æ¤œè¨¼');
            
            for (let i = 1; i <= 64; i++) {
                const engineOS = { hexagramId: i, name: `ç¬¬${i}å¦`, score: 0.5 };
                const safeModeOS = { hexagramId: i, name: `ç¬¬${i}å¦`, score: 0.5 };
                const interfaceOS = { hexagramId: 30, name: 'ç¬¬30å¦', score: 0.5 }; // å›ºå®šå€¤
                
                try {
                    const analysis = analyzer.analyze(engineOS, interfaceOS, safeModeOS);
                    const engineSafePair = analysis.interactions.pair_insights.find(pair => 
                        pair.pair === 'Engine-Safe'
                    );
                    
                    if (engineSafePair) {
                        const hexagram = H384H64database.find(h => h.id === i);
                        const result = {
                            id: i,
                            name: hexagram?.name || `ç¬¬${i}å¦`,
                            keywords: hexagram?.keywords || [],
                            category: engineSafePair.category,
                            summary: engineSafePair.summary,
                            synergy: engineSafePair.synergy
                        };
                        
                        results.push(result);
                        
                        // ç•°å¸¸åˆ¤å®š: èª¿å’Œç³»å¦ãŒTENSIONã‚„CONFLICTã«ãªã£ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹
                        const harmonicKeywords = ['èª¿å’Œ', 'å”èª¿', 'å®‰å®š', 'å¹³å’Œ', 'å—å®¹æ€§', 'åŒ…å®¹åŠ›', 'æŸ”è»Ÿæ€§', 'æ…ˆæ‚²', 'æ¯æ€§'];
                        const isHarmonic = result.keywords.some(k => harmonicKeywords.includes(k));
                        
                        if (isHarmonic && (result.category === 'TENSION' || result.category === 'CONFLICT')) {
                            anomalies.push({
                                ...result,
                                reason: `èª¿å’Œç³»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ [${result.keywords.filter(k => harmonicKeywords.includes(k)).join(', ')}] ãªã®ã« ${result.category}`
                            });
                        }
                        
                        // åå¯¾ã«ã€ç«¶äº‰ç³»å¦ãŒHARMONYã«ãªã£ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ã‚‚ãƒã‚§ãƒƒã‚¯
                        const competitiveKeywords = ['ç«¶äº‰', 'äº‰ã„', 'é—˜äº‰', 'å¯¾ç«‹', 'è¡çª'];
                        const isCompetitive = result.keywords.some(k => competitiveKeywords.includes(k));
                        
                        if (isCompetitive && result.category === 'HARMONY') {
                            anomalies.push({
                                ...result,
                                reason: `ç«¶äº‰ç³»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ [${result.keywords.filter(k => competitiveKeywords.includes(k)).join(', ')}] ãªã®ã« ${result.category}`
                            });
                        }
                    }
                } catch (error) {
                    console.error(`ç¬¬${i}å¦ã®åˆ†æã§ã‚¨ãƒ©ãƒ¼:`, error);
                    results.push({
                        id: i,
                        name: `ç¬¬${i}å¦`,
                        category: 'ERROR',
                        summary: error.message,
                        synergy: null
                    });
                }
            }
            
            displayResults(results, anomalies);
        }
        
        function displayResults(results, anomalies) {
            const resultHtml = results.map(result => {
                const isAnomaly = anomalies.find(a => a.id === result.id);
                const className = `result ${result.category.toLowerCase()} ${isAnomaly ? 'anomaly' : ''}`;
                
                return `
                    <div class="${className}">
                        <strong>${result.id}. ${result.name}</strong>
                        [${result.category}] (${result.synergy?.toFixed(3)})
                        <br>
                        ${result.summary}
                        ${isAnomaly ? `<br><span style="color: #ef4444">âš ï¸ ç•°å¸¸: ${isAnomaly.reason}</span>` : ''}
                        <br>
                        <small>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${result.keywords.join(', ')}</small>
                    </div>
                `;
            }).join('');
            
            document.getElementById('results').innerHTML = resultHtml;
            
            // çµ±è¨ˆã‚µãƒãƒªãƒ¼
            const categoryCount = {};
            results.forEach(r => {
                categoryCount[r.category] = (categoryCount[r.category] || 0) + 1;
            });
            
            const summaryHtml = `
                <div class="summary">
                    <h3>ğŸ“Š æ¤œè¨¼çµæœã‚µãƒãƒªãƒ¼</h3>
                    <p><strong>æ¤œè¨¼å¯¾è±¡:</strong> 64å¦ã™ã¹ã¦ã®engine-safeåŒä¸€å¦ãƒšã‚¢</p>
                    <p><strong>ç•°å¸¸ã‚±ãƒ¼ã‚¹:</strong> ${anomalies.length}ä»¶</p>
                    
                    <h4>ã‚«ãƒ†ã‚´ãƒªåˆ†å¸ƒ:</h4>
                    ${Object.entries(categoryCount).map(([cat, count]) => 
                        `<p>${cat}: ${count}ä»¶ (${(count/64*100).toFixed(1)}%)</p>`
                    ).join('')}
                    
                    ${anomalies.length > 0 ? `
                        <h4>ğŸš¨ ç™ºè¦‹ã•ã‚ŒãŸç•°å¸¸ã‚±ãƒ¼ã‚¹:</h4>
                        ${anomalies.map(anomaly => `
                            <p style="color: #ef4444">
                                <strong>${anomaly.id}. ${anomaly.name}</strong>: ${anomaly.reason}
                            </p>
                        `).join('')}
                    ` : '<p style="color: #10b981">âœ… ç•°å¸¸ã‚±ãƒ¼ã‚¹ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>'}
                </div>
            `;
            
            document.getElementById('summary').innerHTML = summaryHtml;
            
            console.log('æ¤œè¨¼å®Œäº†:', {
                total: results.length,
                anomalies: anomalies.length,
                categories: categoryCount
            });
        }
    </script>
</body>
</html>