<\!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T104 結果表示検証テスト</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .pass { background: #059669; }
        .fail { background: #dc2626; }
        .pending { background: #f59e0b; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #test-output { white-space: pre-wrap; font-family: monospace; background: #333; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 T104 結果表示実装検証テスト</h1>
        
        <h2>📋 テスト項目</h2>
        <div id="test-checklist">
            <div class="test-result pending" id="test-1">1. Triple OS結果の美しい表示</div>
            <div class="test-result pending" id="test-2">2. 3列カードレイアウトの動作</div>
            <div class="test-result pending" id="test-3">3. 64卦情報の正確表示</div>
            <div class="test-result pending" id="test-4">4. スコア可視化の動作</div>
            <div class="test-result pending" id="test-5">5. HaQei哲学準拠（参考として表現）</div>
            <div class="test-result pending" id="test-6">6. レスポンシブデザイン</div>
            <div class="test-result pending" id="test-7">7. パフォーマンス測定</div>
        </div>

        <h2>🎯 テスト実行</h2>
        <button onclick="startResultsTest()">結果表示テスト開始</button>
        <button onclick="testHaQeiPhilosophy()">HaQei哲学準拠テスト</button>
        <button onclick="testResponsiveDesign()">レスポンシブテスト</button>
        <button onclick="testPerformance()">パフォーマンステスト</button>
        
        <h2>📊 テスト出力</h2>
        <div id="test-output"></div>
    </div>

    <script>
        let testOutput = document.getElementById('test-output');
        
        function log(message) {
            testOutput.textContent += new Date().toLocaleTimeString() + ': ' + message + '\\n';
            testOutput.scrollTop = testOutput.scrollHeight;
            console.log(message);
        }
        
        function setTestResult(testId, status) {
            const element = document.getElementById(testId);
            element.className = 'test-result ' + status;
        }

        async function startResultsTest() {
            log('🧪 T104 結果表示テスト開始');
            
            try {
                // 1. Triple OS結果の美しい表示テスト
                log('📱 テスト1: Triple OS結果表示の確認');
                const resultsPage = window.open('/emergency_haqei.html', 'resultsTest');
                
                // テスト用データをlocalStorageにセット
                const testAnswers = {};
                for(let i = 1; i <= 30; i++) {
                    testAnswers[i] = Math.floor(Math.random() * 4) + 1;
                }
                
                // 新しいウィンドウのlocalStorageにデータを設定
                setTimeout(() => {
                    if (resultsPage && \!resultsPage.closed) {
                        try {
                            resultsPage.localStorage.setItem('haqei_answers', JSON.stringify(testAnswers));
                            resultsPage.localStorage.setItem('haqei_session_id', 'test_' + Date.now());
                            log('✅ テストデータをlocalStorageに設定完了');
                            setTestResult('test-1', 'pass');
                        } catch (e) {
                            log('❌ テストデータ設定失敗: ' + e.message);
                            setTestResult('test-1', 'fail');
                        }
                    }
                }, 2000);
                
                log('✅ 結果表示テスト準備完了');
                
            } catch (error) {
                log('❌ テスト実行エラー: ' + error.message);
                setTestResult('test-1', 'fail');
            }
        }

        async function testHaQeiPhilosophy() {
            log('🎌 HaQei哲学準拠テスト開始');
            
            try {
                // emergency_haqei.htmlの内容を確認
                const response = await fetch('/emergency_haqei.html');
                const html = await response.text();
                
                // HaQei哲学の要素を確認
                const checks = [
                    { pattern: /参考として/g, name: '「参考として」表現' },
                    { pattern: /決定論/g, name: '決定論的表現の回避', invert: true },
                    { pattern: /戦略的活用/g, name: '戦略的活用ガイダンス' },
                    { pattern: /自己理解/g, name: '自己理解ツール位置づけ' }
                ];
                
                let philosophyScore = 0;
                checks.forEach(check => {
                    const matches = html.match(check.pattern);
                    const found = matches && matches.length > 0;
                    const passed = check.invert ? \!found : found;
                    
                    if (passed) {
                        philosophyScore++;
                        log('✅ ' + check.name + ': 適合');
                    } else {
                        log('❌ ' + check.name + ': 要改善');
                    }
                });
                
                if (philosophyScore >= checks.length * 0.75) {
                    setTestResult('test-5', 'pass');
                    log('✅ HaQei哲学準拠テスト: 合格 (' + philosophyScore + '/' + checks.length + ')');
                } else {
                    setTestResult('test-5', 'fail');
                    log('❌ HaQei哲学準拠テスト: 不合格 (' + philosophyScore + '/' + checks.length + ')');
                }
                
            } catch (error) {
                log('❌ HaQei哲学テストエラー: ' + error.message);
                setTestResult('test-5', 'fail');
            }
        }

        async function testResponsiveDesign() {
            log('📱 レスポンシブデザインテスト開始');
            
            try {
                // 異なるビューポートサイズでテスト
                const viewports = [
                    { width: 375, height: 667, name: 'Mobile (iPhone)' },
                    { width: 768, height: 1024, name: 'Tablet' },
                    { width: 1200, height: 800, name: 'Desktop' }
                ];
                
                let responsiveScore = 0;
                
                for (const viewport of viewports) {
                    log('🔍 ' + viewport.name + ' (' + viewport.width + 'x' + viewport.height + ') テスト中');
                    
                    // 新しいウィンドウでテスト
                    const testWindow = window.open('/emergency_haqei.html', 'responsiveTest', 
                        'width=' + viewport.width + ',height=' + viewport.height);
                    
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    if (testWindow && \!testWindow.closed) {
                        responsiveScore++;
                        testWindow.close();
                        log('✅ ' + viewport.name + ': 表示成功');
                    } else {
                        log('❌ ' + viewport.name + ': 表示失敗');
                    }
                }
                
                if (responsiveScore >= viewports.length * 0.67) {
                    setTestResult('test-6', 'pass');
                    log('✅ レスポンシブデザインテスト: 合格');
                } else {
                    setTestResult('test-6', 'fail');
                    log('❌ レスポンシブデザインテスト: 不合格');
                }
                
            } catch (error) {
                log('❌ レスポンシブテストエラー: ' + error.message);
                setTestResult('test-6', 'fail');
            }
        }

        async function testPerformance() {
            log('⚡ パフォーマンステスト開始');
            
            try {
                const startTime = performance.now();
                
                // ページ読み込み時間測定
                const response = await fetch('/emergency_haqei.html');
                const html = await response.text();
                
                const loadTime = performance.now() - startTime;
                log('📊 ページ読み込み時間: ' + loadTime.toFixed(2) + 'ms');
                
                // メモリ使用量測定（可能な場合）
                if (performance.memory) {
                    const memoryInfo = performance.memory;
                    log('💾 メモリ使用量: ' + (memoryInfo.usedJSHeapSize / 1024 / 1024).toFixed(2) + 'MB');
                }
                
                // パフォーマンス判定
                if (loadTime < 3000) { // 3秒以内
                    setTestResult('test-7', 'pass');
                    log('✅ パフォーマンステスト: 合格 (読み込み時間 < 3秒)');
                } else {
                    setTestResult('test-7', 'fail');
                    log('❌ パフォーマンステスト: 不合格 (読み込み時間 >= 3秒)');
                }
                
            } catch (error) {
                log('❌ パフォーマンステストエラー: ' + error.message);
                setTestResult('test-7', 'fail');
            }
        }
        
        // 初期メッセージ
        log('🧪 T104 結果表示検証テストスイート準備完了');
        log('📋 テスト対象: Triple OS結果表示、HaQei哲学準拠、UI/UX、パフォーマンス');
        log('🎯 テストを開始するには上記のボタンをクリックしてください');
    </script>
</body>
</html>
