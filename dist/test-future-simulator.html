<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future Simulator Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #0f172a;
            color: #ffffff;
            font-family: "Inter", sans-serif;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #1e293b;
            padding: 2rem;
            border-radius: 12px;
        }
        .test-input {
            width: 100%;
            padding: 1rem;
            margin: 1rem 0;
            background-color: #334155;
            border: 1px solid #475569;
            color: #ffffff;
            border-radius: 8px;
        }
        .test-button {
            background-color: #2563eb;
            color: #ffffff;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
        }
        .test-button:hover {
            background-color: #1d4ed8;
        }
        .result-container {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #334155;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ¯ Future Simulator Integration Test</h1>
        
        <div>
            <h2>ğŸ“š System Status</h2>
            <div id="systemStatus">Loading...</div>
        </div>
        
        <div>
            <h2>ğŸ”® Test Analysis</h2>
            <textarea id="testInput" class="test-input" placeholder="æ‚©ã¿ã‚„çŠ¶æ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ10æ–‡å­—ä»¥ä¸Šï¼‰" rows="4">å°†æ¥ã®ã‚­ãƒ£ãƒªã‚¢ã«ã¤ã„ã¦æ‚©ã‚“ã§ã„ã¾ã™ã€‚ç¾åœ¨ã®ä»•äº‹ã‚’ç¶šã‘ã‚‹ã¹ãã‹ã€æ–°ã—ã„æŒ‘æˆ¦ã‚’ã™ã‚‹ã¹ãã‹è¿·ã£ã¦ã„ã¾ã™ã€‚</textarea>
            <button id="testButton" class="test-button">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        </div>
        
        <div class="result-container">
            <h2>ğŸ“Š Test Results</h2>
            <div id="testResults">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¾Œã«ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
        </div>
        
        <div id="three-stage-visualizer"></div>
        <div id="eight-scenarios-display"></div>
    </div>

    <!-- Core System Assets -->
    <script src="./assets/H384H64database.js"></script>
    <script src="./js/core/H384DatabaseConnector.js"></script>
    <script src="./js/core/IChingChoiceLogic.js"></script>
    <script src="./js/core/IChingGuidanceEngine.js"></script>
    <script src="./js/components/ThreeStageVisualizer.js"></script>
    <script src="./js/components/EightScenariosDisplay.js"></script>
    <script src="./js/future-simulator-integration.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ Starting Future Simulator Test...');
            
            const statusDiv = document.getElementById('systemStatus');
            const testButton = document.getElementById('testButton');
            const testInput = document.getElementById('testInput');
            const testResults = document.getElementById('testResults');
            
            // System Status Check
            setTimeout(() => {
                const status = [];
                
                if (window.H384_DATA) {
                    status.push('âœ… H384_DATA: Loaded (' + Object.keys(window.H384_DATA).length + ' entries)');
                } else {
                    status.push('âŒ H384_DATA: Not loaded');
                }
                
                if (window.h384db && window.h384db.isLoaded) {
                    status.push('âœ… H384DatabaseConnector: Ready');
                } else {
                    status.push('âŒ H384DatabaseConnector: Not ready');
                }
                
                if (window.iChingChoice) {
                    status.push('âœ… IChingChoiceLogic: Loaded');
                } else {
                    status.push('âŒ IChingChoiceLogic: Not loaded');
                }
                
                if (window.iChingGuidance) {
                    status.push('âœ… IChingGuidanceEngine: Loaded');
                } else {
                    status.push('âŒ IChingGuidanceEngine: Not loaded');
                }
                
                if (window.futureSimulator && window.futureSimulator.isInitialized) {
                    status.push('âœ… FutureSimulatorIntegration: Initialized');
                } else {
                    status.push('âŒ FutureSimulatorIntegration: Not initialized');
                }
                
                statusDiv.innerHTML = status.join('<br>');
            }, 2000);
            
            // Test Button Handler
            testButton.addEventListener('click', async function() {
                const inputText = testInput.value.trim();
                
                if (!inputText || inputText.length < 10) {
                    alert('10æ–‡å­—ä»¥ä¸Šã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                testButton.textContent = 'ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
                testButton.disabled = true;
                testResults.innerHTML = 'ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
                
                try {
                    // Check if Future Simulator is available
                    if (!window.futureSimulator) {
                        throw new Error('FutureSimulatorIntegration not available');
                    }
                    
                    // Test IChingChoiceLogic directly
                    if (window.iChingChoice) {
                        const testHexagram = {
                            'å¦å': 'æ°´é›·å±¯',
                            'çˆ»': 'åˆä¹',
                            'å¦ç•ªå·': 3,
                            'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰': ['å”åŠ›è€…', 'å¾…æ©Ÿ', 'æº–å‚™']
                        };
                        
                        const followChange = window.iChingChoice.calculateChange(testHexagram, true);
                        const rejectChange = window.iChingChoice.calculateChange(testHexagram, false);
                        
                        const testResult = {
                            input: inputText,
                            testHexagram: testHexagram,
                            followChange: followChange,
                            rejectChange: rejectChange,
                            systemStatus: 'IChingChoiceLogic working correctly'
                        };
                        
                        testResults.innerHTML = '<pre>' + JSON.stringify(testResult, null, 2) + '</pre>';
                    } else {
                        testResults.innerHTML = 'âŒ IChingChoiceLogic not available';
                    }
                    
                } catch (error) {
                    console.error('âŒ Test failed:', error);
                    testResults.innerHTML = 'âŒ Test failed: ' + error.message;
                } finally {
                    testButton.textContent = 'ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ';
                    testButton.disabled = false;
                }
            });
        });
    </script>
</body>
</html>