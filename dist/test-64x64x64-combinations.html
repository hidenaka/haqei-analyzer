<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>64Ã—64Ã—64 çµ„ã¿åˆã‚ã›æ¤œè¨¼</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
        }
        .test-section { 
            margin: 30px 0; 
            padding: 20px; 
            border: 1px solid #444; 
            border-radius: 8px;
        }
        .random-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        .os-display {
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 5px;
        }
        .os-display h3 {
            color: #60a5fa;
            margin-bottom: 10px;
        }
        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        #result {
            margin-top: 30px;
            padding: 20px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 8px;
            max-height: 600px;
            overflow-y: auto;
        }
        .interaction-detail {
            margin: 15px 0;
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 5px;
        }
        .keyword-highlight {
            color: #fbbf24;
            font-weight: bold;
        }
        .energy-pattern {
            color: #10b981;
            font-style: italic;
        }
        .combination-summary {
            padding: 10px;
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”® 64Ã—64Ã—64 çµ„ã¿åˆã‚ã›æ¤œè¨¼ãƒ„ãƒ¼ãƒ«</h1>
    <p>262,144é€šã‚Šã®çµ„ã¿åˆã‚ã›ã‹ã‚‰ä»»æ„ã®çµ„ã¿åˆã‚ã›ã‚’é¸ã‚“ã§ã€ãã‚Œãã‚Œã®ç‰¹å¾´ãŒæ­£ã—ãè¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</p>

    <div class="test-section">
        <h2>ğŸ“Š ãƒ©ãƒ³ãƒ€ãƒ çµ„ã¿åˆã‚ã›ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="generateRandomCombination()">ğŸ² ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ (1-64ã‹ã‚‰é¸æŠ)</button>
        <button onclick="generateSpecificPattern()">ğŸ¯ ç‰¹å®šãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆ</button>
        <button onclick="generateExtremeCase()">âš¡ æ¥µç«¯ãªã‚±ãƒ¼ã‚¹ç”Ÿæˆ</button>
        
        <div class="random-selector" id="os-display"></div>
        <div id="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š çµ±è¨ˆåˆ†æ</h2>
        <button onclick="analyzeMultipleCombinations(10)">10çµ„åˆã›åˆ†æ</button>
        <button onclick="analyzeMultipleCombinations(100)">100çµ„åˆã›åˆ†æ</button>
        <div id="statistics"></div>
    </div>

    <script src="./assets/H384H64database.js"></script>
    <script src="./js/core/TripleOSInteractionAnalyzer.js"></script>
    <script>
        let currentCombination = null;
        
        function generateRandomCombination() {
            // 1-64ã®ä¸­ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«3ã¤é¸æŠ
            const engineId = Math.floor(Math.random() * 64) + 1;
            const interfaceId = Math.floor(Math.random() * 64) + 1;
            const safeId = Math.floor(Math.random() * 64) + 1;
            
            analyzeCombination(engineId, interfaceId, safeId);
        }
        
        function generateSpecificPattern() {
            // ç‰¹å®šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆç›¸æ€§ã®è‰¯ã„çµ„ã¿åˆã‚ã›ï¼‰
            const patterns = [
                [1, 2, 29],  // ä¹¾ãƒ»å¤ãƒ»å
                [11, 12, 63], // æ³°ãƒ»å¦ãƒ»æ—¢æ¸ˆ
                [3, 4, 5],    // å±¯ãƒ»è’™ãƒ»éœ€
                [13, 14, 15], // åŒäººãƒ»å¤§æœ‰ãƒ»è¬™
                [61, 62, 63], // ä¸­å­šãƒ»å°éãƒ»æ—¢æ¸ˆ
            ];
            const pattern = patterns[Math.floor(Math.random() * patterns.length)];
            analyzeCombination(...pattern);
        }
        
        function generateExtremeCase() {
            // æ¥µç«¯ãªã‚±ãƒ¼ã‚¹ï¼ˆåŒã˜å¦ã€å¯¾æ¥µã®å¦ãªã©ï¼‰
            const extremeCases = [
                [1, 1, 1],    // ã™ã¹ã¦åŒã˜ï¼ˆä¹¾ï¼‰
                [2, 2, 2],    // ã™ã¹ã¦åŒã˜ï¼ˆå¤ï¼‰
                [1, 2, 64],   // å§‹ã¾ã‚Šã¨çµ‚ã‚ã‚Š
                [63, 64, 1],  // å®Œæˆãƒ»æœªå®Œãƒ»å‰µé€ 
                [29, 30, 52], // æ°´ãƒ»ç«ãƒ»å±±
            ];
            const extreme = extremeCases[Math.floor(Math.random() * extremeCases.length)];
            analyzeCombination(...extreme);
        }
        
        function analyzeCombination(engineId, interfaceId, safeId) {
            const analyzer = new TripleOSInteractionAnalyzer();
            
            // OSãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
            const engineOS = {
                hexagramId: engineId,
                name: H64_DATA[engineId - 1].åå‰,
                score: Math.random() * 0.4 + 0.6
            };
            
            const interfaceOS = {
                hexagramId: interfaceId,
                name: H64_DATA[interfaceId - 1].åå‰,
                score: Math.random() * 0.4 + 0.5
            };
            
            const safeModeOS = {
                hexagramId: safeId,
                name: H64_DATA[safeId - 1].åå‰,
                score: Math.random() * 0.4 + 0.4
            };
            
            currentCombination = { engineOS, interfaceOS, safeModeOS };
            
            // è¡¨ç¤º
            displayOSInfo();
            
            // åˆ†æå®Ÿè¡Œ
            const analysis = analyzer.analyze(engineOS, interfaceOS, safeModeOS);
            displayResult(analysis);
        }
        
        function displayOSInfo() {
            const { engineOS, interfaceOS, safeModeOS } = currentCombination;
            const analyzer = new TripleOSInteractionAnalyzer();
            
            const engineChar = analyzer.getHexagramCharacteristics(engineOS.hexagramId);
            const interfaceChar = analyzer.getHexagramCharacteristics(interfaceOS.hexagramId);
            const safeChar = analyzer.getHexagramCharacteristics(safeModeOS.hexagramId);
            
            document.getElementById('os-display').innerHTML = `
                <div class="os-display">
                    <h3>âš¡ Engine OS</h3>
                    <strong>${engineOS.name} (${engineOS.hexagramId})</strong><br>
                    ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: <span class="keyword-highlight">${engineChar.keywords.join(', ')}</span><br>
                    å¼·ã¿: ${engineChar.strength}<br>
                    å¼±ã¿: ${engineChar.weakness}<br>
                    ã‚¨ãƒãƒ«ã‚®ãƒ¼: <span class="energy-pattern">${engineChar.energy}</span><br>
                    ã‚¹ã‚³ã‚¢: ${engineOS.score.toFixed(2)}
                </div>
                <div class="os-display">
                    <h3>ğŸ”„ Interface OS</h3>
                    <strong>${interfaceOS.name} (${interfaceOS.hexagramId})</strong><br>
                    ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: <span class="keyword-highlight">${interfaceChar.keywords.join(', ')}</span><br>
                    å¼·ã¿: ${interfaceChar.strength}<br>
                    å¼±ã¿: ${interfaceChar.weakness}<br>
                    ã‚¨ãƒãƒ«ã‚®ãƒ¼: <span class="energy-pattern">${interfaceChar.energy}</span><br>
                    ã‚¹ã‚³ã‚¢: ${interfaceOS.score.toFixed(2)}
                </div>
                <div class="os-display">
                    <h3>ğŸ›¡ï¸ SafeMode OS</h3>
                    <strong>${safeModeOS.name} (${safeModeOS.hexagramId})</strong><br>
                    ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: <span class="keyword-highlight">${safeChar.keywords.join(', ')}</span><br>
                    å¼·ã¿: ${safeChar.strength}<br>
                    å¼±ã¿: ${safeChar.weakness}<br>
                    ã‚¨ãƒãƒ«ã‚®ãƒ¼: <span class="energy-pattern">${safeChar.energy}</span><br>
                    ã‚¹ã‚³ã‚¢: ${safeModeOS.score.toFixed(2)}
                </div>
            `;
        }
        
        function displayResult(analysis) {
            const { interactions, synergy } = analysis;
            
            let html = '<h3>ğŸ” åˆ†æçµæœ</h3>';
            
            // çµ„ã¿åˆã‚ã›ã®è¦ç´„
            html += `<div class="combination-summary">
                <strong>çµ„ã¿åˆã‚ã›ID:</strong> ${analysis.engine_os.id}-${analysis.interface_os.id}-${analysis.safe_mode_os.id}<br>
                <strong>çµ„ã¿åˆã‚ã›ç·æ•°:</strong> 64Ã—64Ã—64 = 262,144é€šã‚Šã®ä¸­ã®1ã¤<br>
                <strong>ã‚·ãƒŠã‚¸ãƒ¼è©•ä¾¡:</strong> ${synergy.notes}
            </div>`;
            
            // ãƒšã‚¢é–“ç›¸äº’ä½œç”¨
            html += '<div class="interaction-detail">';
            html += '<h4>ğŸ“Š ãƒšã‚¢é–“ç›¸äº’ä½œç”¨</h4>';
            interactions.pair_insights.forEach(pair => {
                html += `<div style="margin: 5px 0;">
                    <strong>${pair.pair}:</strong> ${pair.summary}
                    <span style="float: right; background: ${getCategoryColor(pair.category)}; padding: 2px 8px; border-radius: 4px;">
                        ${pair.category}
                    </span>
                </div>`;
            });
            html += '</div>';
            
            // ã‚¢ãƒ•ã‚©ãƒ¼ãƒ€ãƒ³ã‚¹
            html += '<div class="interaction-detail">';
            html += '<h4>ğŸ’¡ ã‚¢ãƒ•ã‚©ãƒ¼ãƒ€ãƒ³ã‚¹ï¼ˆå¼·ã¿/å¼±ã¿ã®ç™ºç¾ï¼‰</h4>';
            ['engine', 'interface', 'safe'].forEach(osType => {
                const osName = osType === 'engine' ? 'Engine OS' : 
                              osType === 'interface' ? 'Interface OS' : 'SafeMode OS';
                html += `<strong>${osName}:</strong><br>`;
                html += 'âœ¨ å¼·ã¿ãŒå‡ºã‚‹: <ul>';
                interactions.affordances[osType].thrives_with.forEach(t => {
                    html += `<li>${t}</li>`;
                });
                html += '</ul>';
                html += 'âš ï¸ å¼±ã¿ãŒå‡ºã‚‹: <ul>';
                interactions.affordances[osType].struggles_with.forEach(s => {
                    html += `<li>${s}</li>`;
                });
                html += '</ul>';
            });
            html += '</div>';
            
            // å†…çš„è‘›è—¤
            html += '<div class="interaction-detail">';
            html += `<h4>âš¡ å†…çš„è‘›è—¤ï¼ˆ${interactions.inner_conflicts.length}å€‹ï¼‰</h4>`;
            html += '<ol>';
            interactions.inner_conflicts.forEach(conflict => {
                html += `<li>${conflict}</li>`;
            });
            html += '</ol>';
            html += '</div>';
            
            // çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            html += '<div class="interaction-detail">';
            html += '<h4>ğŸŒŸ çµ±åˆã®ãƒ’ãƒ³ãƒˆ</h4>';
            html += '<ol>';
            interactions.integration_prompts.forEach(prompt => {
                html += `<li>${prompt}</li>`;
            });
            html += '</ol>';
            html += '</div>';
            
            document.getElementById('result').innerHTML = html;
        }
        
        function getCategoryColor(category) {
            const colors = {
                'SYNERGY': '#10b981',
                'HARMONY': '#3b82f6',
                'TENSION': '#f59e0b',
                'CONFLICT': '#ef4444'
            };
            return colors[category] || '#6b7280';
        }
        
        function analyzeMultipleCombinations(count) {
            const statistics = {
                totalCombinations: count,
                uniqueKeywords: new Set(),
                energyPatterns: {},
                synergyTypes: { SYNERGY: 0, HARMONY: 0, TENSION: 0, CONFLICT: 0 },
                conflictCounts: {}
            };
            
            const analyzer = new TripleOSInteractionAnalyzer();
            
            for (let i = 0; i < count; i++) {
                const engineId = Math.floor(Math.random() * 64) + 1;
                const interfaceId = Math.floor(Math.random() * 64) + 1;
                const safeId = Math.floor(Math.random() * 64) + 1;
                
                const engineOS = {
                    hexagramId: engineId,
                    name: `ç¬¬${engineId}å¦`,
                    score: Math.random()
                };
                
                const interfaceOS = {
                    hexagramId: interfaceId,
                    name: `ç¬¬${interfaceId}å¦`,
                    score: Math.random()
                };
                
                const safeModeOS = {
                    hexagramId: safeId,
                    name: `ç¬¬${safeId}å¦`,
                    score: Math.random()
                };
                
                const analysis = analyzer.analyze(engineOS, interfaceOS, safeModeOS);
                
                // çµ±è¨ˆåé›†
                const engineChar = analyzer.getHexagramCharacteristics(engineId);
                const interfaceChar = analyzer.getHexagramCharacteristics(interfaceId);
                const safeChar = analyzer.getHexagramCharacteristics(safeId);
                
                // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åé›†
                [...engineChar.keywords, ...interfaceChar.keywords, ...safeChar.keywords].forEach(k => {
                    statistics.uniqueKeywords.add(k);
                });
                
                // ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³é›†è¨ˆ
                [engineChar.energy, interfaceChar.energy, safeChar.energy].forEach(e => {
                    statistics.energyPatterns[e] = (statistics.energyPatterns[e] || 0) + 1;
                });
                
                // ã‚·ãƒŠã‚¸ãƒ¼ã‚¿ã‚¤ãƒ—é›†è¨ˆ
                analysis.interactions.pair_insights.forEach(pair => {
                    statistics.synergyTypes[pair.category]++;
                });
                
                // è‘›è—¤æ•°é›†è¨ˆ
                const conflictCount = analysis.interactions.inner_conflicts.length;
                statistics.conflictCounts[conflictCount] = (statistics.conflictCounts[conflictCount] || 0) + 1;
            }
            
            // çµ±è¨ˆè¡¨ç¤º
            let html = `<h3>ğŸ“Š ${count}çµ„åˆã›ã®çµ±è¨ˆåˆ†æ</h3>`;
            html += '<div class="interaction-detail">';
            html += `<strong>ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ•°:</strong> ${statistics.uniqueKeywords.size}å€‹<br>`;
            html += `<strong>ç†è«–ä¸Šã®çµ„ã¿åˆã‚ã›ç·æ•°:</strong> 64Ã—64Ã—64 = 262,144é€šã‚Š<br>`;
            html += `<strong>ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ç‡:</strong> ${(count / 262144 * 100).toFixed(4)}%<br>`;
            html += '</div>';
            
            html += '<div class="interaction-detail">';
            html += '<strong>ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³å‡ºç¾é »åº¦ï¼ˆä¸Šä½5ï¼‰:</strong><br>';
            const sortedEnergy = Object.entries(statistics.energyPatterns)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            sortedEnergy.forEach(([pattern, count]) => {
                html += `${pattern}: ${count}å›<br>`;
            });
            html += '</div>';
            
            html += '<div class="interaction-detail">';
            html += '<strong>ã‚·ãƒŠã‚¸ãƒ¼ã‚¿ã‚¤ãƒ—åˆ†å¸ƒ:</strong><br>';
            Object.entries(statistics.synergyTypes).forEach(([type, count]) => {
                const percentage = (count / (count * 3) * 100).toFixed(1);
                html += `${type}: ${count}å›<br>`;
            });
            html += '</div>';
            
            html += '<div class="interaction-detail">';
            html += '<strong>å†…çš„è‘›è—¤æ•°ã®åˆ†å¸ƒ:</strong><br>';
            Object.entries(statistics.conflictCounts)
                .sort((a, b) => a[0] - b[0])
                .forEach(([count, freq]) => {
                    html += `${count}å€‹ã®è‘›è—¤: ${freq}çµ„åˆã›<br>`;
                });
            html += '</div>';
            
            document.getElementById('statistics').innerHTML = html;
        }
    </script>
</body>
</html>