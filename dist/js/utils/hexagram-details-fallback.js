class HexagramDetailsFallback{constructor(){this.trigramCharacteristics={1:{engineStrengths:["創造性と革新力","強いリーダーシップ","不屈の精神力"],engineWeaknesses:["完璧主義の傾向","他者への配慮不足","過度なプレッシャー"],interfaceBehaviors:["積極的な意見表明","困難なタスクへの率先対応","ビジョンの明確な提示"],safeModePatterns:["独断的な決定","他者の介入拒絶","孤立傾向"]},2:{engineStrengths:["優れたコミュニケーション能力","社交性と親しみやすさ","楽観的な発想力"],engineWeaknesses:["一貫性の欠如","表面的な関係性","軽率な判断"],interfaceBehaviors:["明るい雰囲気作り","積極的な対話","人間関係の橋渡し"],safeModePatterns:["過度な愛想笑い","本心の隠蔽","八方美人的行動"]},3:{engineStrengths:["鋭い洞察力","情熱的な表現力","美的センス"],engineWeaknesses:["感情の起伏","依存的傾向","プライドの高さ"],interfaceBehaviors:["知的な議論","創造的な提案","感情豊かな表現"],safeModePatterns:["注目を求める行動","感情的な反応","華やかさへの固執"]},4:{engineStrengths:["瞬発力と行動力","変化への適応力","困難突破力"],engineWeaknesses:["衝動性","計画性の不足","持続力の欠如"],interfaceBehaviors:["エネルギッシュな行動","迅速な決断","変化の先導"],safeModePatterns:["短気な反応","計画なしの行動","混乱時のパニック"]},5:{engineStrengths:["柔軟性と適応力","協調性","継続的な努力"],engineWeaknesses:["優柔不断","自己主張の弱さ","流されやすさ"],interfaceBehaviors:["穏やかな調整","人に合わせる姿勢","静かな影響力"],safeModePatterns:["決断回避","責任転嫁","曖昧な態度"]},6:{engineStrengths:["深い思考力","探究心","困難への耐性"],engineWeaknesses:["悲観的思考","孤立傾向","リスク回避"],interfaceBehaviors:["慎重な発言","深い洞察の提供","問題の本質追求"],safeModePatterns:["悲観的な予測","引きこもり","過度な心配"]},7:{engineStrengths:["安定性と信頼性","慎重な判断力","忍耐力"],engineWeaknesses:["頑固さ","変化への抵抗","保守的思考"],interfaceBehaviors:["安定した対応","慎重な意見","確実な実行"],safeModePatterns:["頑固な態度","変化拒絶","孤立化"]},8:{engineStrengths:["包容力","支援能力","持続的な努力"],engineWeaknesses:["自己主張の弱さ","過度な献身","境界線の曖昧さ"],interfaceBehaviors:["支援的な行動","調和を重視した対応","受容的な態度"],safeModePatterns:["自己犠牲","境界線の喪失","過度な我慢"]}},this.coreDrivePatterns={pure:{1:"創造と革新を通じて世界に影響を与えること",2:"人々との交流と喜びの共有",3:"知性と美を通じた自己表現",4:"変化と挑戦を通じた成長",5:"調和と協力による価値創造",6:"深い探求による真理の発見",7:"安定と継続による価値の保全",8:"支援と育成による他者の成長促進"},opposite:{"1-8":"創造力と受容性の調和による包括的リーダーシップ","2-7":"社交性と安定性の組み合わせによる信頼関係構築","3-6":"洞察力と探求心の融合による深い理解力","4-5":"行動力と協調性のバランスによる効果的な変革"},mixed:"複数の価値観の統合による独自の世界観の構築"}}generateHexagramDetails(e,n,t=null){try{if(window.HEXAGRAM_DETAILS&&window.HEXAGRAM_DETAILS[e])return window.HEXAGRAM_DETAILS[e];const r=this.integrateOSAnalysisContext(t,e),a=n.upper_trigram_id,s=n.lower_trigram_id;return this.generateFallbackDetails(e,n,a,s,r)}catch(r){return console.warn(`⚠️ フォールバック生成エラー (卦${e}):`,r),this.generateBasicFallback(e,n,t)}}integrateOSAnalysisContext(e,n){if(!e)return null;try{let t=e;if("string"==typeof e&&(t=JSON.parse(e)),t&&(t.engineOS||t.interfaceOS||t.safeModeOS))return console.log(`🔗 [HexagramDetailsFallback] OS分析結果を統合 (卦${n})`),{engineOS:t.engineOS,interfaceOS:t.interfaceOS,safeModeOS:t.safeModeOS,userVector:t.userVector,integrated:!0};if(window.storageManager){const e=window.storageManager.getAnalysisResult();if(e&&e.engineOS)return console.log(`🔄 [HexagramDetailsFallback] StorageManagerから分析結果を取得 (卦${n})`),{engineOS:e.engineOS,interfaceOS:e.interfaceOS,safeModeOS:e.safeModeOS,userVector:e.userVector,integrated:!0}}return null}catch(t){return console.warn("⚠️ [HexagramDetailsFallback] OS分析結果統合エラー:",t),null}}generateFallbackDetails(e,n,t,r,a=null){const s=this.trigramCharacteristics[t],i=this.trigramCharacteristics[r];let o=null,l=null,c=null;a&&a.integrated&&(console.log(`🎯 [HexagramDetailsFallback] パーソナライズ生成開始 (卦${e})`),o=this.generatePersonalizedEngine(a,s,i),l=this.generatePersonalizedInterface(a,s,i),c=this.generatePersonalizedSafeMode(a,s,i));const g=o||{strength_meter:this.calculateStrengthMeter(t,r),core_drive:this.generateCoreDrive(t,r),potential_strengths:this.combineStrengths(s,i),potential_weaknesses:this.combineWeaknesses(s,i)},h=l||{how_it_appears:this.generateAppearance(t,r),behavioral_patterns:this.combineBehaviors(s,i),impression_on_others:this.generateImpression(t,r)},d=c||{trigger_situations:this.generateTriggers(t,r),defensive_patterns:this.combineDefensivePatterns(s,i),internal_state:this.generateInternalState(t,r)},p={upper:this.getTrigramInfo(t),lower:this.getTrigramInfo(r)},m=a?this.generateTripleOSCatchphrase(a,n,t,r):n.catchphrase||"深い智慧を持つ人";return{name_jp:n.name_jp||`第${e}卦`,catchphrase:m,description:n.description||`${n.name_jp}の卦は、独特な価値観と深い洞察力を持つ存在です。`,keywords:n.keywords?n.keywords.split(","):["成長","変化","調和"],engine:g,interface:h,safe_mode:d,trigrams:p,triple_os_enhanced:!!a,generation_quality:a?.9:.7}}generatePersonalizedEngine(e,n,t){const r=e.userVector||{},a=e.engineOS||{},s=this.extractPersonalizedStrengths(r,n,t),i=Math.round(1.2*(a.compatibilityScore||75));return{strength_meter:Math.min(i,100),core_drive:this.generatePersonalizedCoreDrive(e),potential_strengths:s,potential_weaknesses:this.generatePersonalizedWeaknesses(r,n,t),personalized:!0}}generatePersonalizedInterface(e,n,t){e.interfaceOS;return{how_it_appears:this.generatePersonalizedAppearance(e),behavioral_patterns:this.generatePersonalizedBehaviors(e,n,t),impression_on_others:this.generatePersonalizedImpression(e),personalized:!0}}generatePersonalizedSafeMode(e,n,t){e.safeModeOS;return{trigger_situations:this.generatePersonalizedTriggers(e),defensive_patterns:this.generatePersonalizedDefensivePatterns(e,n,t),internal_state:this.generatePersonalizedInternalState(e),personalized:!0}}extractPersonalizedStrengths(e,n,t){const r=[];return Object.entries(e).sort(([,e],[,n])=>n-e).slice(0,3).forEach(([e,n])=>{if(n>.6){const n={innovation:"革新的な発想力",stability:"安定した継続力",cooperation:"優れた協調性",independence:"自立した行動力",intuition:"鋭い直感力",resilience:"困難への耐久力",adaptability:"柔軟な適応力",protection:"他者を守る力"},t=n[e.split("_")[1]]||n[e];t&&r.push(t)}}),n&&n.engineStrengths&&r.push(...n.engineStrengths.slice(0,1)),r.length>0?r.slice(0,3):["独特な視点","深い思考力","価値観への忠実さ"]}generateTripleOSCatchphrase(e,n,t,r){const a=e.engineOS?.osName||"",s=e.interfaceOS?.osName||"",i=(e.safeModeOS,{"創造":"新しい可能性を切り拓く革新者","直感":"深い洞察で真理を見抜く賢者","行動":"迷いなく前進する実践者","調和":"人々を結ぶ架け橋となる存在","支援":"他者の成長を支える育成者","受容":"包容力で安心を与える癒し手","安定":"確固たる信念を持つ堅実者","継続":"地道な努力で価値を築く建設者","保護":"大切なものを守り抜く守護者"});let o=n.catchphrase||"深い智慧を持つ人";for(const[l,c]of Object.entries(i))if(a.includes(l)||s.includes(l)){o=c;break}return o}generatePersonalizedCoreDrive(e){return`${e.engineOS?.osName||""}を通じて自分らしい価値を世界に表現すること`}generatePersonalizedWeaknesses(e,n,t){const r=Object.entries(e||{}).filter(([,e])=>e<.4).slice(0,2),a={innovation:"新しい変化への躊躇",stability:"継続的な取り組みの困難",cooperation:"他者との協働の難しさ",independence:"自立した決断への不安"},s=r.map(([e])=>a[e.split("_")[1]]||a[e]).filter(Boolean);return s.length>0?s:["理想と現実のギャップ","他者との価値観の違い"]}generatePersonalizedAppearance(e){return`${e.interfaceOS?.osName||""}の特性を活かした自然な存在感`}generatePersonalizedBehaviors(e,n,t){const r=[`${e.interfaceOS?.osName||""}に基づく一貫した行動`];return n&&n.interfaceBehaviors&&r.push(...n.interfaceBehaviors.slice(0,2)),r}generatePersonalizedImpression(e){return`${e.interfaceOS?.osName||""}らしい印象を与える、信頼できる人物`}generatePersonalizedTriggers(e){return[`${e.safeModeOS?.osName||""}の特性が脅かされる状況`,"価値観が理解されない時","過度なプレッシャーを感じた時"]}generatePersonalizedDefensivePatterns(e,n,t){const r=[`${e.safeModeOS?.osName||""}による自己防御行動`];return n&&n.safeModePatterns&&r.push(...n.safeModePatterns.slice(0,2)),r}generatePersonalizedInternalState(e){return`${e.safeModeOS?.osName||""}が働いている時の内なる葛藤と自己保護の願い`}generateBasicFallback(e,n,t=null){return{name_jp:n?.name_jp||`第${e}卦`,catchphrase:n?.catchphrase||"深い智慧を持つ人",description:n?.description||`第${e}卦の深い智慧を持つあなたは、独自の価値観で世界を捉える特別な存在です。`,keywords:["成長","変化","調和"],engine:{strength_meter:75,core_drive:"自己実現と他者への貢献の調和",potential_strengths:["独特な視点","深い思考力","価値観への忠実さ"],potential_weaknesses:["理想と現実のギャップ","他者との価値観の相違","変化への適応"]},interface:{how_it_appears:"静かで思慮深い存在感",behavioral_patterns:["慎重な発言","深い洞察の提供","価値観に基づく行動"],impression_on_others:"信頼できるが少し読みにくい人"},safe_mode:{trigger_situations:["価値観が脅かされた時","理解されない状況","過度なプレッシャー"],defensive_patterns:["内向的になる","自分の世界に閉じこもる","頑固な態度"],internal_state:"「自分の道を貫こう」という意志と「理解されたい」という願い"},trigrams:{upper:{name:"上卦",symbol:"☰",description:"外向的な特性"},lower:{name:"下卦",symbol:"☷",description:"内向的な特性"}}}}calculateStrengthMeter(e,n){const t={1:95,2:70,3:85,4:80,5:75,6:78,7:82,8:72},r=t[e]||75,a=t[n]||75;return Math.round(.6*r+.4*a)}generateCoreDrive(e,n){if(e===n)return this.coreDrivePatterns.pure[e]||this.coreDrivePatterns.mixed;const t=`${Math.min(e,n)}-${Math.max(e,n)}`;return this.coreDrivePatterns.opposite[t]||this.coreDrivePatterns.mixed}combineStrengths(e,n){if(!e||!n)return["創造性","洞察力","価値観への忠実さ"];const t=[...e.engineStrengths.slice(0,2),...n.engineStrengths.slice(0,1)];return t.length>0?t:["創造性","洞察力","価値観への忠実さ"]}combineWeaknesses(e,n){if(!e||!n)return["理想主義的傾向","他者との価値観の違い","変化への抵抗"];const t=[...e.engineWeaknesses.slice(0,2),...n.engineWeaknesses.slice(0,1)];return t.length>0?t:["理想主義的傾向","他者との価値観の違い","変化への抵抗"]}combineBehaviors(e,n){if(!e||!n)return["慎重な発言","深い洞察の提供","価値観に基づく行動"];const t=[...e.interfaceBehaviors.slice(0,2),...n.interfaceBehaviors.slice(0,1)];return t.length>0?t:["慎重な発言","深い洞察の提供","価値観に基づく行動"]}combineDefensivePatterns(e,n){if(!e||!n)return["内向的になる","自分の世界に閉じこもる","頑固な態度"];const t=[...e.safeModePatterns.slice(0,2),...n.safeModePatterns.slice(0,1)];return t.length>0?t:["内向的になる","自分の世界に閉じこもる","頑固な態度"]}generateAppearance(e,n){return{1:"自信に満ちた堂々とした振る舞い",2:"明るく親しみやすい雰囲気",3:"知的で華やかな存在感",4:"エネルギッシュで活動的な様子",5:"穏やかで協調的な態度",6:"慎重で思慮深い姿勢",7:"安定感のある落ち着いた様子",8:"温和で支援的な雰囲気"}[e]||"独特な存在感を持つ人"}generateImpression(e,n){return"信頼できるが、その深い思考は時に理解するのが難しい。独自の視点を持つ興味深い人物。"}generateTriggers(e,n){return["自分の価値観が否定された時","理不尽な状況に直面した時","長期間のストレスにさらされた時"]}generateInternalState(e,n){return"「自分らしくありたい」という願いと「周囲との調和も大切」という思いの間での葛藤。"}getTrigramInfo(e){return{1:{name:"乾",symbol:"☰",description:"天、創造性、リーダーシップ"},2:{name:"兌",symbol:"☱",description:"沢、喜び、コミュニケーション"},3:{name:"離",symbol:"☲",description:"火、知性、美"},4:{name:"震",symbol:"☳",description:"雷、行動、変化"},5:{name:"巽",symbol:"☴",description:"風、柔軟性、浸透"},6:{name:"坎",symbol:"☵",description:"水、知恵、困難"},7:{name:"艮",symbol:"☶",description:"山、安定、静止"},8:{name:"坤",symbol:"☷",description:"地、受容、育成"}}[e]||{name:"不明",symbol:"☰",description:"基本的な特性"}}getHexagramDetails(e,n=null){const t=window.hexagrams_master?.find(n=>n.hexagram_id===e);return t?this.generateHexagramDetails(e,t,n):(console.warn(`⚠️ 卦${e}のデータが見つかりません`),this.generateBasicFallback(e,null,n))}assessFallbackQuality(e){let n=0;return e.triple_os_enhanced&&(n+=30),e.engine?.personalized&&(n+=25),e.interface?.personalized&&(n+=25),e.safe_mode?.personalized&&(n+=20),Math.min(n,100)}}"undefined"!=typeof window&&(window.HexagramDetailsFallback=HexagramDetailsFallback,window.hexagramDetailsFallback=new HexagramDetailsFallback,console.log("✅ HexagramDetailsFallback loaded and ready")),"undefined"!=typeof module&&module.exports&&(module.exports=HexagramDetailsFallback);