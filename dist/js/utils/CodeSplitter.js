class CodeSplitter{constructor(e={}){this.options={enableAnalysis:!0,enableSplitting:!0,enableOptimization:!0,analysisDepth:"medium",splitThreshold:51200,...e},this.analysis={modules:new Map,dependencies:new Map,duplicates:[],deadCode:[],opportunities:[]},this.strategies={byFeature:this.splitByFeature.bind(this),byRoute:this.splitByRoute.bind(this),bySize:this.splitBySize.bind(this),byUsage:this.splitByUsage.bind(this)},this.metrics={analysisTime:0,splitsIdentified:0,potentialSavings:0,optimizationScore:0},console.log("✂️ CodeSplitter initialized - Advanced splitting analysis ready")}async analyzeCodebase(){const e=performance.now();console.log("🔍 Analyzing codebase for splitting opportunities...");try{await this.analyzeLoadedModules(),this.buildDependencyGraph(),this.identifySplittingOpportunities(),this.calculateOptimizationPotential();const t=performance.now()-e;return this.metrics.analysisTime=t,console.log(`✅ Codebase analysis complete in ${t.toFixed(0)}ms`),this.generateAnalysisReport()}catch(t){throw console.error("❌ Codebase analysis failed:",t),t}}async analyzeLoadedModules(){const e=document.querySelectorAll("script[src]"),t=window.moduleLoader?Array.from(window.moduleLoader.loadedModules.keys()):[];e.forEach(e=>{this.analyzeScript(e.src)}),t.forEach(e=>{this.analyzeModule(e)}),console.log(`📊 Analyzed ${e.length} static scripts and ${t.length} dynamic modules`)}analyzeScript(e){const t={url:e,type:"static",size:0,dependencies:[],exports:[],functions:[],classes:[],splitOpportunities:[]};this.estimateModuleSize(t),this.identifyModuleType(t),this.analysis.modules.set(e,t)}analyzeModule(e){const t={url:e,type:"dynamic",size:0,dependencies:[],exports:[],functions:[],classes:[],splitOpportunities:[]};if(window.moduleLoader&&window.moduleLoader.loadedModules.has(e)){const i=window.moduleLoader.loadedModules.get(e);t.size=i.estimatedSize||0,t.loadTime=i.loadTime||0}this.identifyModuleType(t),this.analysis.modules.set(e,t)}estimateModuleSize(e){const t=performance.getEntriesByName(e.url);if(t.length>0){const i=t[0];e.size=i.transferSize||i.encodedBodySize||0,e.loadTime=i.duration||0}}identifyModuleType(e){const t=e.url;t.includes("/lib/")?(e.category="library",e.splitPriority="high"):t.includes("/components/")?(e.category="component",e.splitPriority="medium"):t.includes("/core/")?(e.category="core",e.splitPriority="low"):t.includes("/data/")?(e.category="data",e.splitPriority="high"):t.includes("/utils/")?(e.category="utility",e.splitPriority="medium"):(e.category="unknown",e.splitPriority="low"),e.size>this.options.splitThreshold&&(e.splitPriority="high")}buildDependencyGraph(){console.log("🕸️ Building dependency graph..."),this.analysis.modules.forEach((e,t)=>{const i=this.extractDependencies(e);this.analysis.dependencies.set(t,i)})}extractDependencies(e){const t=[];return Object.entries({BaseComponent:["/js/shared/core/BaseComponent.js"],StorageManager:["/js/shared/core/StorageManager.js","/js/shared/core/MicroStorageManager.js"],DataManager:["/js/shared/core/DataManager.js"],Calculator:["/js/os-analyzer/core/Calculator.js"],Chart:["/js/lib/chart.min.js"],VirtualQuestionFlow:["/js/os-analyzer/components/VirtualQuestionFlow-core.js","/js/os-analyzer/components/VirtualQuestionFlow-renderer.js"]}).forEach(([i,s])=>{(e.url.includes(i)||e.category===i.toLowerCase())&&t.push(...s)}),[...new Set(t)]}identifySplittingOpportunities(){console.log("🎯 Identifying splitting opportunities...");const e=[];this.analysis.modules.forEach((t,i)=>{const s=this.strategies.byFeature(t);e.push(...s);const o=this.strategies.bySize(t);e.push(...o);const n=this.strategies.byUsage(t);e.push(...n)}),this.analysis.opportunities=this.prioritizeOpportunities(e),this.metrics.splitsIdentified=this.analysis.opportunities.length}splitByFeature(e){const t=[];return Object.entries({"help-system":{trigger:"onDemand",priority:"high",estimatedSaving:"400KB"},chart:{trigger:"onResults",priority:"high",estimatedSaving:"200KB"},"analysis-engine":{trigger:"onAnalysis",priority:"medium",estimatedSaving:"800KB"},visualization:{trigger:"onResults",priority:"medium",estimatedSaving:"300KB"}}).forEach(([i,s])=>{(e.url.includes(i)||e.category===i)&&t.push({type:"feature",module:e.url,feature:i,...s,currentSize:e.size})}),t}splitBySize(e){const t=[];return e.size>this.options.splitThreshold&&t.push({type:"size",module:e.url,reason:"Large module",currentSize:e.size,priority:e.size>102400?"high":"medium",strategy:"chunk-splitting",estimatedSaving:Math.floor(.6*e.size)+"B"}),t}splitByUsage(e){const t=[];return Object.entries({debug:"development-only",test:"development-only",admin:"admin-only",advanced:"power-user",experimental:"optional"}).forEach(([i,s])=>{e.url.includes(i)&&t.push({type:"usage",module:e.url,usage:s,priority:"high",strategy:"conditional-loading",currentSize:e.size,estimatedSaving:e.size+"B"})}),t}prioritizeOpportunities(e){return e.filter(e=>e.currentSize>1024).sort((e,t)=>{const i={high:3,medium:2,low:1},s=i[e.priority]||0,o=i[t.priority]||0;return s!==o?o-s:t.currentSize-e.currentSize}).slice(0,20)}calculateOptimizationPotential(){let e=0,t=0;this.analysis.modules.forEach(e=>{t+=e.size}),this.analysis.opportunities.forEach(t=>{const i=t.estimatedSaving,s=parseInt(i)||0;e+=s}),this.metrics.potentialSavings=e,this.metrics.optimizationScore=t>0?Math.min(100,e/t*100):0}generateAnalysisReport(){const e={summary:{modulesAnalyzed:this.analysis.modules.size,splittingOpportunities:this.analysis.opportunities.length,potentialSavings:this.formatBytes(this.metrics.potentialSavings),optimizationScore:this.metrics.optimizationScore.toFixed(1)+"%"},opportunities:this.analysis.opportunities.map(e=>({...e,currentSize:this.formatBytes(e.currentSize),estimatedSaving:this.formatBytes(parseInt(e.estimatedSaving)||0)})),recommendations:this.generateRecommendations(),metrics:this.metrics};return console.log("📊 Code Splitting Analysis Report:"),console.log("=".repeat(50)),console.log(`📦 Modules Analyzed: ${e.summary.modulesAnalyzed}`),console.log(`✂️ Splitting Opportunities: ${e.summary.splittingOpportunities}`),console.log(`💾 Potential Savings: ${e.summary.potentialSavings}`),console.log(`🎯 Optimization Score: ${e.summary.optimizationScore}`),e.opportunities.length>0&&(console.log("🎯 Top Opportunities:"),e.opportunities.slice(0,5).forEach((e,t)=>{console.log(`${t+1}. ${e.module} (${e.currentSize} → save ${e.estimatedSaving})`)})),console.log("=".repeat(50)),e}generateRecommendations(){const e=[],t=this.analysis.opportunities.filter(e=>"high"===e.priority&&e.currentSize>51200);t.length>0&&e.push({type:"high-impact",message:`${t.length} high-impact splitting opportunities identified`,action:"Implement dynamic imports for these modules first",modules:t.map(e=>e.module)});const i=this.analysis.opportunities.filter(e=>e.module.includes("/lib/"));i.length>0&&e.push({type:"library-splitting",message:"Third-party libraries can be lazy loaded",action:"Move chart.js and other libraries to results bundle",modules:i.map(e=>e.module)});const s=this.analysis.opportunities.filter(e=>"feature"===e.type);return s.length>0&&e.push({type:"feature-splitting",message:"Feature-based code splitting opportunities",action:"Implement lazy loading for optional features",features:[...new Set(s.map(e=>e.feature))]}),e}formatBytes(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB"][t]}exportAnalysis(){return{analysis:{modules:Array.from(this.analysis.modules.entries()),dependencies:Array.from(this.analysis.dependencies.entries()),opportunities:this.analysis.opportunities},metrics:this.metrics,timestamp:Date.now()}}}window.codeSplitter||(window.codeSplitter=new CodeSplitter({enableAnalysis:!0,splitThreshold:51200}),console.log("🎯 Global CodeSplitter initialized"),window.analyzeCodeSplitting=()=>window.codeSplitter.analyzeCodebase(),window.getCodeSplittingReport=()=>window.codeSplitter.generateAnalysisReport()),"undefined"!=typeof module&&module.exports&&(module.exports=CodeSplitter);