class DataCompatibilityLayer{constructor(){this.loadedFiles=new Set,this.loadingPromises=new Map,console.log("🔄 Data Compatibility Layer initialized")}async loadDataFile(a,e,t=null){if(this.loadedFiles.has(a))return Promise.resolve();if(this.loadingPromises.has(a))return this.loadingPromises.get(a);const i=this.performLoad(a,e,t);this.loadingPromises.set(a,i);try{this.loadedFiles.add(a),console.log(`✅ Loaded ${a} → ${e}`)}catch(o){throw console.error(`❌ Failed to load ${a}:`,o),this.loadingPromises.delete(a),o}return i}async performLoad(a,e,t){try{const i=fetch(a);if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const o=i.json(),d=t?t(o):o;return"undefined"!=typeof window&&(window[e]=d),d}catch(i){throw console.error(`Error loading ${a}:`,i),i}}async loadAllData(){const a=[this.loadDataFile("/data/hexagrams.json","hexagrams_master"),this.loadDataFile("/data/ai_themes.json","futureThemeMap"),this.loadDataFile("/data/koudo_shishin.json","koudoShishinData"),this.loadDataFile("/data/bible.json","BIBLE_DATA"),this.loadDataFile("/data/h384.json","H384_DATA_JSON",a=>({version:a.version,hexagrams:a.hexagrams,getHexagramData:e=>a.hexagrams.find(a=>a.id===e),getLineText:(a,e)=>`${a}-${e} (JSON data loaded)`,initialized:!0}))];try{return Promise.all(a),console.log("🎉 All data files loaded successfully"),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("dataCompatibilityReady",{detail:{loadedFiles:Array.from(this.loadedFiles)}})),!0}catch(e){return console.error("❌ Failed to load all data files:",e),!1}}isDataReady(){return"undefined"!=typeof window&&["hexagrams_master","futureThemeMap","koudoShishinData","BIBLE_DATA"].every(a=>void 0!==window[a]&&null!==window[a])}waitForData(a=1e4){return new Promise((e,t)=>{if(this.isDataReady())return void e(!0);const i=setTimeout(()=>{t(new Error(`Data loading timeout after ${a}ms`))},a),checkReady=()=>{this.isDataReady()?(clearTimeout(i),e(!0)):setTimeout(checkReady,100)};checkReady()})}}const dataCompatibilityLayer=new DataCompatibilityLayer;"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{dataCompatibilityLayer.loadAllData()}):dataCompatibilityLayer.loadAllData()),"undefined"!=typeof window&&(window.dataCompatibilityLayer=dataCompatibilityLayer),console.log("🔧 Data Compatibility Layer ready");