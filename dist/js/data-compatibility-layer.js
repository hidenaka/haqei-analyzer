class DataCompatibilityLayer{constructor(){this.loadedFiles=new Set,this.loadingPromises=new Map,console.log("🔄 Data Compatibility Layer initialized")}async loadDataFile(a,t,e=null){if(this.loadedFiles.has(a))return Promise.resolve();if(this.loadingPromises.has(a))return this.loadingPromises.get(a);const i=this.performLoad(a,t,e);this.loadingPromises.set(a,i);try{await i,this.loadedFiles.add(a),console.log(`✅ Loaded ${a} → ${t}`)}catch(o){throw console.error(`❌ Failed to load ${a}:`,o),this.loadingPromises.delete(a),o}return i}async performLoad(a,t,e){try{const i=await fetch(a);if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const o=await i.json(),d=e?e(o):o;return"undefined"!=typeof window&&(window[t]=d),d}catch(i){throw console.error(`Error loading ${a}:`,i),i}}async loadAllData(){const a=[this.loadDataFile("/data/hexagrams.json","hexagrams_master"),this.loadDataFile("/data/ai_themes.json","futureThemeMap"),this.loadDataFile("/data/koudo_shishin.json","koudoShishinData"),this.loadDataFile("/data/bible.json","BIBLE_DATA"),this.loadDataFile("/data/h384.json","H384_DATA_JSON",a=>({version:a.version,hexagrams:a.hexagrams,getHexagramData:t=>a.hexagrams.find(a=>a.id===t),getLineText:(a,t)=>`${a}-${t} (JSON data loaded)`,initialized:!0}))];try{return await Promise.all(a),console.log("🎉 All data files loaded successfully"),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("dataCompatibilityReady",{detail:{loadedFiles:Array.from(this.loadedFiles)}})),!0}catch(t){return console.error("❌ Failed to load all data files:",t),!1}}isDataReady(){return"undefined"!=typeof window&&["hexagrams_master","futureThemeMap","koudoShishinData","BIBLE_DATA"].every(a=>void 0!==window[a]&&null!==window[a])}waitForData(a=1e4){return new Promise((t,e)=>{if(this.isDataReady())return void t(!0);const i=setTimeout(()=>{e(new Error(`Data loading timeout after ${a}ms`))},a),checkReady=()=>{this.isDataReady()?(clearTimeout(i),t(!0)):setTimeout(checkReady,100)};checkReady()})}}const dataCompatibilityLayer=new DataCompatibilityLayer;"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{dataCompatibilityLayer.loadAllData()}):dataCompatibilityLayer.loadAllData()),"undefined"!=typeof window&&(window.dataCompatibilityLayer=dataCompatibilityLayer),console.log("🔧 Data Compatibility Layer ready");