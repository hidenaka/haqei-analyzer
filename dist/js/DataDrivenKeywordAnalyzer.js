class DataDrivenKeywordAnalyzer{constructor(e){this.h384Data=e,this.buildKeywordRelationMap()}buildKeywordRelationMap(){this.keywordMap=new Map,this.hexagramRelations=new Map,this.h384Data.forEach((e,t)=>{const s=`${e["卦番号"]}_${e["爻"]}`;this.keywordMap.set(s,{keywords:e["キーワード"]?e["キーワード"].split(","):[],interpretation:e["現代解釈の要約"]||"",scores:{basic:parseInt(e["S1_基本スコア"])||50,potential:parseInt(e["S2_ポテンシャル"])||50,stability:parseInt(e["S3_安定性スコア"])||50,risk:parseInt(e["S4_リスク"])||0,volatility:parseInt(e["S6_変動性スコア"])||50,total:parseInt(e["S7_総合評価スコア"])||50},hexNum:e["卦番号"],hexName:e["卦名"],line:e["爻"]})});for(let e=1;e<=64;e++){const t=[];for(let s=1;s<=6;s++){const r=`${e}_${this.getLineText(s)}`;this.keywordMap.has(r)&&t.push(this.keywordMap.get(r))}this.hexagramRelations.set(e,t)}}getLineText(e){return["初九","九二","九三","九四","九五","上九","初六","六二","六三","六四","六五","上六"][e-1]||"初九"}generateJinConnection(e,t,s,r){const a=`${e}_${t}`,o=`${s}_${r}`,i=this.keywordMap.get(a),n=this.keywordMap.get(o);if(!i||!n)return"関係性データが見つかりません";const c=n.scores.total-i.scores.total,l=n.scores.stability-i.scores.stability,h=n.scores.risk-i.scores.risk,u=i.keywords.join("・"),$=n.keywords.join("・");return c>10?`「${u}」の状態から、総合評価が${Math.round(c)}ポイント向上し、「${$}」という発展的な段階へ進みます。${i.hexName}の中で、${i.interpretation.substring(0,30)}から${n.interpretation.substring(0,30)}への自然な成長過程です。`:c<-10?`「${u}」から「${$}」へ移行し、より慎重な対応が必要な段階となります。${i.hexName}において、${l>0?"安定性は増しますが":"リスクが高まり"}、${Math.abs(Math.round(h))}ポイントの注意が必要です。`:`「${u}」から「${$}」へと、${i.hexName}の中で段階的に進化します。安定性が${Math.round(l)}ポイント、ポテンシャルが${Math.round(n.scores.potential-i.scores.potential)}ポイント変化し、${n.interpretation.substring(0,50)}という状況への移行です。`}generateHengShift(e,t,s,r){const a=`${e}_${t}`,o=`${s}_${r}`,i=this.keywordMap.get(a),n=this.keywordMap.get(o);if(!i||!n)return"転換データが見つかりません";const c=i.keywords.join("・"),l=n.keywords.join("・"),h=n.scores.volatility-i.scores.volatility,u=n.scores.potential-i.scores.potential;return h>10?`${i.hexName}の「${c}」から、${n.hexName}の「${l}」へと卦が変化し、変動性が${Math.round(h)}ポイント増加します。${n.interpretation.substring(0,50)}という新たな局面への転換です。`:u>10?`「${c}」という${i.hexName}の状態から離れ、${n.hexName}の「${l}」へ方向転換します。ポテンシャルが${Math.round(u)}ポイント向上し、${n.interpretation.substring(0,40)}という可能性が開けます。`:`${i.hexName}から${n.hexName}への転換により、「${c}」から「${l}」へと状況が質的に変化します。総合評価が${Math.round(n.scores.total-i.scores.total)}ポイント変化し、${n.interpretation.substring(0,30)}への転機となります。`}calculateSemanticDistance(e,t,s,r){const a=`${e}_${t}`,o=`${s}_${r}`,i=this.keywordMap.get(a),n=this.keywordMap.get(o);if(!i||!n)return 100;return(.3*Math.abs(i.scores.basic-n.scores.basic)+.2*Math.abs(i.scores.potential-n.scores.potential)+.2*Math.abs(i.scores.stability-n.scores.stability)+.3*Math.abs(i.scores.risk-n.scores.risk))/100}recommendNextStep(e,t,s="stability"){const r=[],a=this.getNextLine(t);if(a){const t=`${e}_${a}`,o=this.keywordMap.get(t);o&&r.push({type:"jin",hex:e,line:a,score:this.evaluateObjective(o,s),data:o})}for(let o=0;o<5;o++){const e=Math.floor(64*Math.random())+1,a=`${e}_${t}`,o=this.keywordMap.get(a);o&&r.push({type:"heng",hex:e,line:t,score:this.evaluateObjective(o,s),data:o})}return r.sort((e,t)=>t.score-e.score),r}evaluateObjective(e,t){switch(t){case"stability":return e.scores.stability-Math.abs(e.scores.risk);case"growth":return e.scores.potential+e.scores.basic;case"safety":return 100+e.scores.risk;case"change":return e.scores.volatility+e.scores.potential;default:return e.scores.total}}getNextLine(e){["初九","九二","九三","九四","九五","上九","初六","六二","六三","六四","六五","上六"].indexOf(e);return e.includes("初")?e.includes("九")?"九二":"六二":e.includes("二")?e.includes("九")?"九三":"六三":e.includes("三")?e.includes("九")?"九四":"六四":e.includes("四")?e.includes("九")?"九五":"六五":e.includes("五")?e.includes("九")?"上九":"上六":null}evaluatePath(e){let t=0,s=0,r=0;return e.forEach((e,a)=>{const o=`${e.hex}_${e.line}`,i=this.keywordMap.get(o);i&&(t+=i.scores.total*(1-.1*a),s+=i.scores.risk,r+=i.scores.stability)}),{totalScore:t/e.length,totalRisk:s,averageStability:r/e.length,recommendation:this.generatePathRecommendation(t/e.length,s)}}generatePathRecommendation(e,t){return e>70&&t>-100?"非常に良好な展開が期待できます":e>50&&t>-150?"バランスの取れた現実的な選択です":t<-200?"リスクが高いため慎重な判断が必要です":"状況に応じた柔軟な対応が求められます"}}"undefined"!=typeof module&&module.exports&&(module.exports=DataDrivenKeywordAnalyzer);