class DisplayController{constructor(e={}){this.container=e.container||document.body,this.debugMode=e.debugMode||!1,this.autoFix=!1!==e.autoFix,this.managedElements=new WeakMap,this.conflictResolver=new CSSConflictResolver,this.operationCount=0,this.totalTime=0,this.debugMode&&console.log("üéØ DisplayController v2.0 initialized")}async ensureElementVisible(e,t={}){const i=performance.now();try{const s={forceDisplay:!0,useImportant:!0,clearConflicts:!0,observeChanges:!1,...t};if(!e)throw new Error("Element is required");const o=this.getElementState(e);this.managedElements.set(e,{config:s,initialState:o,lastCheck:Date.now()}),s.clearConflicts&&await this.conflictResolver.resolveConflicts(e),s.forceDisplay&&this.forceElementVisible(e,s.useImportant),this.ensureParentVisibility(e);const n=this.getElementState(e),l=n.isVisible;return s.observeChanges&&l&&this.startObserving(e),this.operationCount++,this.totalTime+=performance.now()-i,this.debugMode&&console.log("üéØ ensureElementVisible: "+(l?"ÊàêÂäü":"Â§±Êïó"),{element:e.tagName,initialState:o,finalState:n,time:`${(performance.now()-i).toFixed(2)}ms`}),l}catch(s){return console.error("‚ùå DisplayController.ensureElementVisible failed:",s),!1}}forceElementVisible(e,t=!0){const i=t?"important":"";if(e.style&&(e.style.setProperty("display","block",i),e.style.setProperty("visibility","visible",i),e.style.setProperty("opacity","1",i),e.style.setProperty("position","relative",i),e.style.setProperty("z-index","10",i)),e.shadowRoot){const t=e.shadowRoot.querySelector(".question-container");t&&(t.style.setProperty("display","block",i),t.style.setProperty("visibility","visible",i),t.style.setProperty("opacity","1",i))}e.classList.add("force-visible"),e.classList.remove("hidden")}ensureParentVisibility(e){let t=e.parentElement,i=0;for(;t&&i<10;){this.getElementState(t).isVisible||(this.debugMode&&console.log(`üîç Parent not visible: ${t.tagName}${t.id?"#"+t.id:""}${t.className?"."+t.className.split(" ")[0]:""}`),"none"===t.style.display&&(t.style.display="block"),"hidden"===t.style.visibility&&(t.style.visibility="visible"),"0"===t.style.opacity&&(t.style.opacity="1")),t=t.parentElement,i++}}getElementState(e){if(!e)return{isVisible:!1,reason:"Element not found"};const t=window.getComputedStyle(e),i=e.getBoundingClientRect(),s={isVisible:!0,issues:[],display:t.display,visibility:t.visibility,opacity:t.opacity,position:t.position,width:i.width,height:i.height,top:i.top,left:i.left};return"none"===t.display&&(s.isVisible=!1,s.issues.push("display: none")),"hidden"===t.visibility&&(s.isVisible=!1,s.issues.push("visibility: hidden")),"0"===t.opacity&&(s.isVisible=!1,s.issues.push("opacity: 0")),0!==i.width&&0!==i.height||(s.isVisible=!1,s.issues.push("zero dimensions")),(i.top<-i.height||i.top>window.innerHeight)&&s.issues.push("outside viewport"),s}startObserving(e){if(!window.MutationObserver)return;const t=new MutationObserver(t=>{let i=!1;t.forEach(e=>{"attributes"!==e.type||"style"!==e.attributeName&&"class"!==e.attributeName||(i=!0)}),i&&setTimeout(()=>{this.ensureElementVisible(e)},100)});t.observe(e,{attributes:!0,attributeFilter:["style","class"]});const i=this.managedElements.get(e);i&&(i.observer=t)}getStats(){return{operationCount:this.operationCount,totalTime:this.totalTime,averageTime:this.operationCount>0?this.totalTime/this.operationCount:0,managedElementsCount:this.managedElements.size||0}}destroy(){for(const[e,t]of this.managedElements.entries())t.observer&&t.observer.disconnect();this.debugMode&&console.log("üéØ DisplayController destroyed",this.getStats())}}class CSSConflictResolver{constructor(){this.knownConflicts=["display: none !important","visibility: hidden !important","opacity: 0 !important","height: 0px","width: 0px","overflow: hidden"]}async resolveConflicts(e){try{const t=this.detectConflicts(e);return t.length>0&&(console.log(`üîß CSS conflicts detected for ${e.tagName}:`,t),this.overrideConflicts(e,t)),0===t.length}catch(t){return console.error("‚ùå CSSConflictResolver.resolveConflicts failed:",t),!1}}detectConflicts(e){const t=[],i=window.getComputedStyle(e);return"none"===i.display&&t.push("display: none"),"hidden"===i.visibility&&t.push("visibility: hidden"),"0"===i.opacity&&t.push("opacity: 0"),t}overrideConflicts(e,t){t.forEach(t=>{t.includes("display")&&e.style.setProperty("display","block","important"),t.includes("visibility")&&e.style.setProperty("visibility","visible","important"),t.includes("opacity")&&e.style.setProperty("opacity","1","important")})}}"undefined"!=typeof window&&(window.DisplayController=DisplayController,window.CSSConflictResolver=CSSConflictResolver),"undefined"!=typeof module&&module.exports&&(module.exports={DisplayController:DisplayController,CSSConflictResolver:CSSConflictResolver});