class FutureBranchingSystem{constructor(){this.currentState=null,this.choices=[],this.outcomes=[],this.selectedChoice=null,this.layoutType="classic",this.animationEnabled=!0,this.votingData={},this.personaTemplates=this.initPersonaTemplates()}initPersonaTemplates(){return{careerSeeker:{id:"career-seeker",name:"ã‚­ãƒ£ãƒªã‚¢è¿·å­ï¼ˆ25-35æ­³ï¼‰",icon:"ğŸ’¼",scenarios:[{current:"æ¯æœæº€å“¡é›»è»Šã«æºã‚‰ã‚Œã¦ã€æœ¬å½“ã«ã“ã®ã¾ã¾ã§ã„ã„ã®ï¼Ÿ",choices:[{type:"safe",label:"ç¾è·ç¶™ç¶š",outcome:"å®‰å®šã ã‘ã©æˆé•·åœæ»"},{type:"adventure",label:"è»¢è·æŒ‘æˆ¦",outcome:"ãƒªã‚¹ã‚¯ã‚ã‚‹ã‘ã©æ–°ãŸãªå¯èƒ½æ€§"},{type:"creative",label:"ç‹¬ç«‹èµ·æ¥­",outcome:"æœ€å¤§ãƒªã‚¹ã‚¯ã€æœ€å¤§ãƒªã‚¿ãƒ¼ãƒ³"}]}]},loveWorrier:{id:"love-worrier",name:"æ‹æ„›æ‚©ã¿ï¼ˆ20-30æ­³ï¼‰",icon:"ğŸ’•",scenarios:[{current:"å½¼ã¨ã®é–¢ä¿‚ã€ã“ã®ã¾ã¾ç¶šã‘ã‚‹ã¹ãï¼Ÿ",choices:[{type:"safe",label:"é–¢ä¿‚ç¶™ç¶š",outcome:"å®‰å®šã ã‘ã©ãƒãƒ³ãƒãƒª"},{type:"adventure",label:"è·é›¢ã‚’ç½®ã",outcome:"å®¢è¦³è¦–ã§é–¢ä¿‚æ”¹å–„ã®å¯èƒ½æ€§"},{type:"creative",label:"åˆ¥ã‚Œã‚’é¸ã¶",outcome:"ç—›ã¿ã®å¾Œã«æ–°ãŸãªå‡ºä¼šã„"}]}]},healthSeeker:{id:"health-seeker",name:"å¥åº·æ”¹å–„å¸Œæœ›ï¼ˆ30-50æ­³ï¼‰",icon:"ğŸŒ±",scenarios:[{current:"ã‚¹ãƒˆãƒ¬ã‚¹ã¨ç–²åŠ´ã§ä½“èª¿ä¸è‰¯ãŒç¶šã„ã¦ã„ã‚‹",choices:[{type:"safe",label:"ç”Ÿæ´»ç¿’æ…£æ”¹å–„",outcome:"å¾ã€…ã«ä½“èª¿å›å¾©"},{type:"adventure",label:"è»¢è·ãƒ»ç’°å¢ƒå¤‰åŒ–",outcome:"ã‚¹ãƒˆãƒ¬ã‚¹æºã‹ã‚‰è§£æ”¾"},{type:"creative",label:"ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«é©å‘½",outcome:"äººç”Ÿå…¨ä½“ã®è³ªå‘ä¸Š"}]}]}}}async init(e){this.container=e,console.log("ğŸŒŸ Initializing Future Branching System...");try{return this.setupContainer(),this.bindEvents(),await this.loadSavedData(),console.log("âœ… Future Branching System initialized"),!0}catch(t){return console.error("âŒ Failed to initialize:",t),!1}}setupContainer(){if(!this.container)return void console.error("Container not found");this.container.classList.add("future-branching-container"),this.container.innerHTML='\n      <div class="branching-header mb-4">\n        <h2 class="text-2xl font-bold text-center mb-2">ğŸŒŸ æœªæ¥åˆ†å²ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼</h2>\n        <p class="text-center text-secondary">ã‚ãªãŸã®é¸æŠãŒå°ãå¯èƒ½æ€§ã‚’å¯è¦–åŒ–</p>\n      </div>\n      \n      <div class="layout-selector mb-4 text-center">\n        <button class="layout-btn" data-layout="classic">ã‚¯ãƒ©ã‚·ãƒƒã‚¯</button>\n        <button class="layout-btn" data-layout="timeline">ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</button>\n        <button class="layout-btn" data-layout="radial">æ”¾å°„çŠ¶</button>\n      </div>\n      \n      <div class="persona-selector mb-4 text-center">\n        <span class="text-sm text-secondary mr-2">ãƒšãƒ«ã‚½ãƒŠé¸æŠ:</span>\n        <select id="persona-select" class="haqei-input inline-block w-auto">\n          <option value="">ã‚«ã‚¹ã‚¿ãƒ </option>\n          <option value="career-seeker">ã‚­ãƒ£ãƒªã‚¢è¿·å­</option>\n          <option value="love-worrier">æ‹æ„›æ‚©ã¿</option>\n          <option value="health-seeker">å¥åº·æ”¹å–„</option>\n        </select>\n      </div>\n      \n      <div id="branching-diagram" class="branching-diagram layout-classic">\n        \x3c!-- Dynamic content will be inserted here --\x3e\n      </div>\n      \n      <div class="voting-section mt-4" style="display: none;">\n        <h3 class="text-lg font-semibold mb-2">ã¿ã‚“ãªã®é¸æŠ</h3>\n        <div id="voting-results"></div>\n      </div>\n    ';this.container.querySelectorAll(".layout-btn").forEach(e=>{e.style.cssText="\n        background: #2563eb;\n        color: white;\n        padding: 0.5rem 1rem;\n        border-radius: 0.5rem;\n        margin: 0 0.25rem;\n        border: none;\n        cursor: pointer;\n        transition: all 0.3s;\n      ",e.addEventListener("mouseenter",()=>{e.style.background="#1d4ed8",e.style.transform="translateY(-2px)"}),e.addEventListener("mouseleave",()=>{e.style.background="#2563eb",e.style.transform="translateY(0)"})})}bindEvents(){this.container.querySelectorAll(".layout-btn").forEach(e=>{e.addEventListener("click",e=>{this.changeLayout(e.target.dataset.layout)})});const e=this.container.querySelector("#persona-select");e&&e.addEventListener("change",e=>{this.loadPersonaScenario(e.target.value)})}createBranching(e){const t=this.container.querySelector("#branching-diagram");if(t){switch(this.currentState=e.current,this.choices=e.choices||[],this.outcomes=e.outcomes||[],this.layoutType){case"timeline":this.renderTimelineLayout(t);break;case"radial":this.renderRadialLayout(t);break;default:this.renderClassicLayout(t)}this.animationEnabled&&this.applyAnimations()}}renderClassicLayout(e){e.className="branching-diagram layout-classic";let t=`\n      \x3c!-- Current State --\x3e\n      <div class="current-row">\n        <div class="branching-node current-state animate-current">\n          <span class="node-icon icon-current"></span>\n          <h3 class="text-lg font-semibold mb-2">ç¾åœ¨ã®çŠ¶æ³</h3>\n          <p>${this.currentState||"ã‚ãªãŸã®ç¾åœ¨ã®çŠ¶æ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"}</p>\n        </div>\n      </div>\n      \n      \x3c!-- Connection Lines --\x3e\n      <div style="height: 40px; position: relative;">\n        <svg width="100%" height="40" style="position: absolute; top: 0; left: 0;">\n          <line x1="50%" y1="0" x2="16.66%" y2="40" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>\n          <line x1="50%" y1="0" x2="50%" y2="40" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>\n          <line x1="50%" y1="0" x2="83.33%" y2="40" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>\n        </svg>\n      </div>\n      \n      \x3c!-- Choices --\x3e\n      <div class="choices-row">`;this.choices.forEach((e,n)=>{const i=this.getChoiceClass(e.type),a=this.getIconClass(e.type);t+=`\n        <div class="branching-node ${i} animate-choice choice-selector" data-choice="${n}">\n          <span class="node-icon ${a}"></span>\n          <h4 class="font-semibold mb-1">${e.label}</h4>\n          <p class="text-sm">${e.description||""}</p>\n          ${this.votingData[n]?`\n            <div class="voting-display">${this.votingData[n]}%</div>\n            <div class="voting-bar">\n              <div class="voting-bar-fill" style="width: ${this.votingData[n]}%"></div>\n            </div>\n          `:""}\n        </div>`}),t+='</div>\n      \n      \x3c!-- Outcomes --\x3e\n      <div class="outcomes-row mt-4">',this.outcomes.forEach((e,n)=>{const i=this.getOutcomeClass(e.type),a=e.icon||"icon-success";t+=`\n        <div class="branching-node ${i} animate-outcome" style="animation-delay: ${.5+.1*n}s">\n          <span class="node-icon ${a}"></span>\n          <h4 class="font-semibold mb-1">${e.label}</h4>\n          <p class="text-sm">${e.description}</p>\n          <div class="text-xs mt-2 opacity-75">${e.timeframe||"3ãƒ¶æœˆå¾Œ"}</div>\n        </div>`}),t+="</div>",e.innerHTML=t,this.bindChoiceEvents()}renderTimelineLayout(e){e.className="branching-diagram layout-timeline";const t=[{label:"ç¾åœ¨",nodes:[this.currentState]},{label:"é¸æŠ",nodes:this.choices},{label:"1ãƒ¶æœˆå¾Œ",nodes:this.getOutcomesForTime("1month")},{label:"3ãƒ¶æœˆå¾Œ",nodes:this.getOutcomesForTime("3months")},{label:"1å¹´å¾Œ",nodes:this.getOutcomesForTime("1year")}];let n="";t.forEach((e,t)=>{n+=`\n        <div class="timeline-stage">\n          <div class="timeline-label">${e.label}</div>\n          <div class="timeline-choices">`,e.nodes.forEach((e,i)=>{if("string"==typeof e)n+=`\n            <div class="branching-node current-state" style="animation-delay: ${.2*t}s">\n              <p>${e}</p>\n            </div>`;else{const a=e.type?this.getChoiceClass(e.type):"outcome-neutral";n+=`\n            <div class="branching-node ${a} animate-choice" style="animation-delay: ${.2*t+.1*i}s">\n              <h4 class="font-semibold">${e.label}</h4>\n              <p class="text-sm">${e.description||""}</p>\n            </div>`}}),n+="</div></div>"}),e.innerHTML=n}renderRadialLayout(e){e.className="branching-diagram layout-radial";let t=`\n      \x3c!-- Center Node --\x3e\n      <div class="center-node">\n        <div class="branching-node current-state animate-current">\n          <span class="node-icon icon-current"></span>\n          <h3 class="text-lg font-semibold">ç¾åœ¨</h3>\n          <p class="text-sm">${this.currentState}</p>\n        </div>\n      </div>`;this.choices.forEach((e,n)=>{const i=120*n*Math.PI/180,a=200*Math.cos(i-Math.PI/2),s=200*Math.sin(i-Math.PI/2),o=this.getChoiceClass(e.type),c=this.getIconClass(e.type);t+=`\n        <div class="choice-node animate-choice" style="transform: translate(${a}px, ${s}px); animation-delay: ${.2*n}s">\n          <div class="branching-node ${o} choice-selector" data-choice="${n}">\n            <span class="node-icon ${c}"></span>\n            <h4 class="font-semibold">${e.label}</h4>\n          </div>\n        </div>`}),e.innerHTML=t}getChoiceClass(e){return{safe:"choice-safe",adventure:"choice-adventure",creative:"choice-creative"}[e]||"choice-safe"}getIconClass(e){return{safe:"icon-safe",adventure:"icon-adventure",creative:"icon-creative"}[e]||"icon-current"}getOutcomeClass(e){return{positive:"outcome-positive",neutral:"outcome-neutral",challenging:"outcome-challenging"}[e]||"outcome-neutral"}applyAnimations(){this.container.querySelectorAll(".branching-node").forEach((e,t)=>{e.style.opacity="0",setTimeout(()=>{e.style.opacity="1",e.classList.add("fade-in")},100*t)})}bindChoiceEvents(){this.container.querySelectorAll(".choice-selector").forEach(e=>{e.addEventListener("click",e=>{this.selectChoice(e.currentTarget.dataset.choice)})})}selectChoice(e){this.container.querySelectorAll(".choice-selector").forEach((t,n)=>{n===parseInt(e)?(t.classList.add("selected"),t.classList.remove("unselected"),this.selectedChoice=n):(t.classList.remove("selected"),t.classList.add("unselected"))}),this.highlightOutcome(e),this.updateVoting(e)}highlightOutcome(e){this.container.querySelectorAll(".outcomes-row .branching-node").forEach((t,n)=>{n===parseInt(e)?t.classList.add("pulse-effect"):t.classList.remove("pulse-effect")})}changeLayout(e){this.layoutType=e;this.container.querySelectorAll(".layout-btn").forEach(t=>{t.dataset.layout===e?t.style.background="#1d4ed8":t.style.background="#2563eb"}),this.currentState&&this.createBranching({current:this.currentState,choices:this.choices,outcomes:this.outcomes})}loadPersonaScenario(e){if(!e)return void this.showCustomInput();const t=this.personaTemplates[e];if(t&&t.scenarios[0]){const e=t.scenarios[0],n=e.choices.map(e=>({type:e.type,label:e.label,description:e.outcome})),i=e.choices.map(e=>({type:"safe"===e.type?"neutral":"creative"===e.type?"positive":"challenging",label:e.outcome,description:this.generateOutcomeDescription(e.type),timeframe:"3ãƒ¶æœˆå¾Œ"}));this.createBranching({current:e.current,choices:n,outcomes:i}),this.showVotingSection()}}generateOutcomeDescription(e){return{safe:"ç€å®Ÿãªå‰é€²ã€‚ãƒªã‚¹ã‚¯ã¯æœ€å°é™ã«æŠ‘ãˆã‚‰ã‚Œã¾ã—ãŸã€‚",adventure:"æ–°ã—ã„æŒ‘æˆ¦ã«ã‚ˆã‚Šã€äºˆæƒ³å¤–ã®æˆé•·ã‚’é‚ã’ã¾ã—ãŸã€‚",creative:"å‰µé€ çš„ãªé¸æŠãŒã€å¤§ããªå¤‰é©ã‚’ã‚‚ãŸã‚‰ã—ã¾ã—ãŸã€‚"}[e]||""}showCustomInput(){const e=this.container.querySelector("#branching-diagram");e.innerHTML='\n      <div class="custom-input-section">\n        <h3 class="text-lg font-semibold mb-3">ã‚«ã‚¹ã‚¿ãƒ ã‚·ãƒŠãƒªã‚ªä½œæˆ</h3>\n        \n        <div class="mb-3">\n          <label class="block text-sm mb-1">ç¾åœ¨ã®çŠ¶æ³</label>\n          <textarea id="custom-current" class="haqei-input" rows="3" \n            placeholder="ä¾‹: æ¯æ—¥åŒã˜ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã§ã€ä½•ã‹å¤‰åŒ–ãŒæ¬²ã—ã„ã¨æ„Ÿã˜ã¦ã„ã‚‹"></textarea>\n        </div>\n        \n        <div class="mb-3">\n          <label class="block text-sm mb-1">é¸æŠè‚¢1 (å®‰å…¨)</label>\n          <input type="text" id="custom-choice-1" class="haqei-input" \n            placeholder="ä¾‹: ç¾çŠ¶ç¶­æŒ">\n        </div>\n        \n        <div class="mb-3">\n          <label class="block text-sm mb-1">é¸æŠè‚¢2 (æŒ‘æˆ¦)</label>\n          <input type="text" id="custom-choice-2" class="haqei-input" \n            placeholder="ä¾‹: æ–°ã—ã„ã‚¹ã‚­ãƒ«ç¿’å¾—">\n        </div>\n        \n        <div class="mb-3">\n          <label class="block text-sm mb-1">é¸æŠè‚¢3 (å‰µé€ )</label>\n          <input type="text" id="custom-choice-3" class="haqei-input" \n            placeholder="ä¾‹: ç‹¬è‡ªã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹">\n        </div>\n        \n        <button id="create-custom" class="haqei-button">ã‚·ãƒŠãƒªã‚ªä½œæˆ</button>\n      </div>\n    ';e.querySelector("#create-custom").addEventListener("click",()=>{this.createCustomScenario()})}createCustomScenario(){const e=document.getElementById("custom-current").value,t=document.getElementById("custom-choice-1").value,n=document.getElementById("custom-choice-2").value,i=document.getElementById("custom-choice-3").value;if(!(e&&t&&n&&i))return void alert("ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const a=[{type:"safe",label:t,description:"å®‰å®šã—ãŸé¸æŠ"},{type:"adventure",label:n,description:"æŒ‘æˆ¦çš„ãªé¸æŠ"},{type:"creative",label:i,description:"å‰µé€ çš„ãªé¸æŠ"}];this.createBranching({current:e,choices:a,outcomes:[{type:"neutral",label:"ç€å®Ÿãªæˆæœ",description:"äºˆæƒ³é€šã‚Šã®çµæœãŒå¾—ã‚‰ã‚Œã¾ã—ãŸ",timeframe:"3ãƒ¶æœˆå¾Œ"},{type:"challenging",label:"æˆé•·ã®æ©Ÿä¼š",description:"å›°é›£ã‚‚ã‚ã‚Šã¾ã™ãŒã€å¤§ããæˆé•·ã—ã¾ã—ãŸ",timeframe:"3ãƒ¶æœˆå¾Œ"},{type:"positive",label:"å¤§ããªæˆåŠŸ",description:"æƒ³åƒä»¥ä¸Šã®æˆæœã‚’é”æˆã—ã¾ã—ãŸ",timeframe:"3ãƒ¶æœˆå¾Œ"}]}),this.showVotingSection()}showVotingSection(){const e=this.container.querySelector(".voting-section");e&&(e.style.display="block",this.initializeVoting())}initializeVoting(){this.votingData={0:Math.floor(40*Math.random())+20,1:Math.floor(40*Math.random())+20,2:Math.floor(40*Math.random())+20};const e=Object.values(this.votingData).reduce((e,t)=>e+t,0);Object.keys(this.votingData).forEach(t=>{this.votingData[t]=Math.round(this.votingData[t]/e*100)}),this.updateVotingDisplay()}updateVotingDisplay(){const e=this.container.querySelector("#voting-results");if(!e)return;let t='<div class="voting-results-grid">';this.choices.forEach((e,n)=>{const i=this.votingData[n]||0;t+=`\n        <div class="voting-item mb-2">\n          <div class="flex justify-between mb-1">\n            <span>${e.label}</span>\n            <span class="font-semibold">${i}%</span>\n          </div>\n          <div class="voting-bar">\n            <div class="voting-bar-fill" style="width: ${i}%"></div>\n          </div>\n        </div>`}),t+="</div>",e.innerHTML=t}updateVoting(e){this.votingData[e]=(this.votingData[e]||0)+1;const t=Object.values(this.votingData).reduce((e,t)=>e+t,0);Object.keys(this.votingData).forEach(e=>{this.votingData[e]=Math.round(this.votingData[e]/t*100)}),this.updateVotingDisplay()}getOutcomesForTime(e){return{"1month":[{label:"åˆæœŸå¤‰åŒ–",description:"å°ã•ãªå¤‰åŒ–ãŒå§‹ã¾ã‚‹"},{label:"é©å¿œæœŸ",description:"æ–°ã—ã„ç’°å¢ƒã«æ…£ã‚Œå§‹ã‚ã‚‹"},{label:"æ¢ç´¢æœŸ",description:"å¯èƒ½æ€§ã‚’æ¢ã‚‹"}],"3months":[{label:"æˆæœå‡ºç¾",description:"å…·ä½“çš„ãªæˆæœãŒè¦‹ãˆå§‹ã‚ã‚‹"},{label:"æŒ‘æˆ¦ç¶™ç¶š",description:"å›°é›£ã‚’ä¹—ã‚Šè¶ŠãˆãªãŒã‚‰å‰é€²"},{label:"å‰µé€ é–‹èŠ±",description:"ç‹¬è‡ªã®ä¾¡å€¤ãŒå½¢ã«ãªã‚‹"}],"1year":[{label:"å®‰å®šæˆé•·",description:"ç€å®Ÿãªæˆé•·ã‚’å®Ÿç¾"},{label:"å¤§ããªé£›èº",description:"äºˆæƒ³ã‚’è¶…ãˆã‚‹æˆæœ"},{label:"æ–°å¢ƒåœ°é–‹æ‹“",description:"å…¨ãæ–°ã—ã„é“ã‚’åˆ‡ã‚Šé–‹ã"}]}[e]||[]}async loadSavedData(){try{const e=localStorage.getItem("futureBranchingData");if(e){const t=JSON.parse(e);this.votingData=t.votingData||{}}}catch(e){console.log("No saved data found")}}saveData(){try{const e={votingData:this.votingData,lastUpdated:(new Date).toISOString()};localStorage.setItem("futureBranchingData",JSON.stringify(e))}catch(e){console.error("Failed to save data:",e)}}}window.FutureBranchingSystem=FutureBranchingSystem;