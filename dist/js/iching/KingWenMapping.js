import{ConfigLoader}from"../../../config/config-loader-adapter.js";export class KingWenMapping{constructor(){this.hexagramData=null,this.reverseMap=new Map,this.initialized=!1,this.loader=new ConfigLoader}async initialize(){if(!this.initialized)try{const i=await this.loader.load("kingwen-mapping",{basePath:"undefined"!=typeof window?"/config":"../../config"});this.hexagramData=i.hexagrams,this.buildReverseMap(),this.initialized=!0,console.log(`âœ… KingWenMapping initialized with ${Object.keys(this.hexagramData).length} hexagrams`)}catch(i){console.error("Failed to initialize KingWenMapping:",i),this.initializeWithSeedData()}}initializeWithSeedData(){this.hexagramData={1:{name:"ä¹¾ç‚ºå¤©",lines:[1,1,1,1,1,1],trigrams:["ä¹¾","ä¹¾"]},2:{name:"å¤ç‚ºåœ°",lines:[0,0,0,0,0,0],trigrams:["å¤","å¤"]},11:{name:"æ³°",lines:[1,1,1,0,0,0],trigrams:["ä¹¾","å¤"]},12:{name:"å¦",lines:[0,0,0,1,1,1],trigrams:["å¤","ä¹¾"]},63:{name:"æ—¢æ¸ˆ",lines:[1,0,1,0,1,0],trigrams:["é›¢","å"]},64:{name:"æœªæ¸ˆ",lines:[0,1,0,1,0,1],trigrams:["å","é›¢"]}},this.buildReverseMap(),this.initialized=!0}buildReverseMap(){this.reverseMap.clear();for(const[i,e]of Object.entries(this.hexagramData)){const a=e.lines.join("");this.reverseMap.set(a,parseInt(i))}}calculateTransformedHex(i,e){this.initialized||this.initializeWithSeedData();const a=this.hexagramData[i];if(!a)return console.warn(`Hexagram ${i} not found in mapping`),null;const n=[...a.lines],t=e-1;if(t<0||t>5)return console.error(`Invalid line number: ${e}`),null;n[t]=1===n[t]?0:1;const r=n.join(""),s=this.reverseMap.get(r);return s||(console.warn(`No hexagram found for pattern ${r}`),this.calculateFallbackHex(i,e))}calculateFallbackHex(i,e){const a=1+(i-1^1<<e-1);return console.warn(`Using fallback calculation: ${i} line ${e} â†’ ${a} (may be incorrect)`),a}getLineConfiguration(i){this.initialized||this.initializeWithSeedData();const e=this.hexagramData[i];return e?e.lines:null}getHexagramFromLines(i){if(this.initialized||this.initializeWithSeedData(),!Array.isArray(i)||6!==i.length)return console.error("Invalid lines array"),null;const e=i.join("");return this.reverseMap.get(e)||null}getHexagramData(i){return this.initialized||this.initializeWithSeedData(),this.hexagramData[i]||null}getAvailableHexagramCount(){return Object.keys(this.hexagramData||{}).length}}"undefined"!=typeof window&&(window.KingWenMapping=KingWenMapping,console.log("ğŸŒ KingWenMapping registered to window object"));