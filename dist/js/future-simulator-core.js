console.log("ğŸ¯ Future Simulator Core Loading..."),window.FutureSimulator=window.FutureSimulator||{},FutureSimulator.Core={initialized:!1,authentic386Integration:null,useAuthentic386:!0,async init(){console.log("ğŸš€ Future Simulator initializing...");try{this.initKuromoji(),this.init386System(),this.initializeEngines(),this.initUI(),this.setupEventListeners(),this.initialized=!0,console.log("âœ… Future Simulator initialized successfully");const e=document.getElementById("initial-loading");e&&(e.style.display="none")}catch(e){console.error("âŒ Initialization error:",e),this.showError("ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚")}},initKuromoji:async()=>(console.log("ğŸ“ Initializing Japanese text analyzer..."),new Promise((e,t)=>{if("undefined"==typeof kuromoji)return console.log("â„¹ï¸ Kuromoji not available, using simple analysis"),void e();kuromoji.builder({dicPath:"https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict/"}).build((t,n)=>{t?(console.warn("âš ï¸ Kuromoji init failed, continuing with simple analysis"),e()):(window.tokenizer=n,console.log("âœ… Japanese analyzer ready"),e())})})),async init386System(){console.log("ğŸ‹ Initializing Authentic 386 System...");try{void 0!==window.Authentic386YaoAnalyzer?(this.authentic386Analyzer=new window.Authentic386YaoAnalyzer,await this.authentic386Analyzer.initialize(),console.log("âœ… Authentic 386çˆ» Analyzer initialized successfully"),this.useAuthentic386=!0):void 0!==window.Authentic386Integration?(this.authentic386Integration=new window.Authentic386Integration,this.authentic386Integration.initialize(),console.log("âœ… Authentic 386 System integrated successfully"),this.useAuthentic386=!0):(console.warn("âš ï¸ Authentic386 systems not available, using legacy system"),this.useAuthentic386=!1)}catch(e){console.error("âŒ 386 System initialization error:",e),this.useAuthentic386=!1}},async initUI(){console.log("ğŸ¨ Initializing UI components...");try{const e=document.querySelector(".future-simulator-container")||document.body;"none"===e.style.display&&(e.style.display="block");const t=document.getElementById("situation-input")||document.querySelector('textarea[placeholder*="çŠ¶æ³"]')||document.querySelector("textarea");t&&(t.addEventListener("input",this.handleInputChange.bind(this)),this.setupCharacterCounter(t),console.log("âœ… Input field initialized")),"undefined"!=typeof Chart?console.log("ğŸ“Š Chart.js available"):(console.log("â„¹ï¸ Chart.js not available, using fallback displays"),this.setupFallbackVisualization())}catch(e){console.error("âŒ UI initialization error:",e)}},setupCharacterCounter(e){try{if(e.nextElementSibling?.classList?.contains("character-counter"))return;const t=document.createElement("div");t.className="character-counter",t.style.cssText="font-size: 12px; color: #6b7280; text-align: right; margin-top: 4px;";const updateCounter=()=>{const n=e.value.length;t.textContent=`${n} æ–‡å­—`,t.style.color=n>500?"#ef4444":"#6b7280"};e.addEventListener("input",updateCounter),e.parentNode.insertBefore(t,e.nextSibling),updateCounter()}catch(t){console.error("âŒ Character counter setup error:",t)}},setupFallbackVisualization(){console.log("ğŸ¨ Setting up fallback visualization system..."),window.createFallbackChart=(e,t)=>{if(t)try{const n=Math.max(...e.map(e=>e.value||0)),i=e.map(e=>{const t=n>0?e.value/n*100:0;return`\n            <div class="chart-bar" style="margin-bottom: 8px;">\n              <div class="bar-label" style="display: inline-block; width: 120px; font-size: 12px;">${e.label||"ãƒ‡ãƒ¼ã‚¿"}</div>\n              <div class="bar-container" style="display: inline-block; width: 200px; background: #e2e8f0; height: 20px; border-radius: 10px; overflow: hidden; vertical-align: middle;">\n                <div class="bar-fill" style="width: ${t}%; height: 100%; background: linear-gradient(90deg, #3b82f6, #06b6d4); transition: width 0.5s ease;"></div>\n              </div>\n              <span style="margin-left: 8px; font-size: 12px; color: #6b7280;">${e.value||0}%</span>\n            </div>\n          `}).join("");t.innerHTML=`\n          <div class="fallback-chart" style="padding: 16px; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">\n            <div style="margin-bottom: 16px; font-weight: bold; color: #374151;">ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–</div>\n            ${i}\n          </div>\n        `}catch(n){console.error("âŒ Fallback chart error:",n),t.innerHTML='<div style="padding: 16px; color: #6b7280;">ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤ºã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</div>'}}},setupEventListeners(){console.log("ğŸ”— Setting up event listeners...");const e=document.getElementById("analyze-button")||document.querySelector('button[onclick*="analyze"]')||document.querySelector(".analyze-btn")||Array.from(document.querySelectorAll("button")).find(e=>e.textContent.includes("åˆ†æ"));e&&(e.onclick=()=>this.startAnalysis(),console.log("âœ… Analyze button connected")),document.addEventListener("click",e=>{(e.target.matches('[data-action="analyze"]')||e.target.textContent.includes("åˆ†æ")||e.target.textContent.includes("ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ"))&&(e.preventDefault(),this.startAnalysis())})},handleInputChange(e){const t=e.target.value.trim(),n=document.querySelector('button[onclick*="analyze"]')||document.querySelector(".analyze-btn");n&&(n.disabled=t.length<10)},async startAnalysis(){console.log("ğŸ” Starting advanced analysis with text interpretation...");const e=document.getElementById("situation-input")||document.querySelector('textarea[placeholder*="çŠ¶æ³"]')||document.querySelector("textarea");if(!e||!e.value.trim())return void alert("çŠ¶æ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const t=e.value.trim();this.showLoading();try{let e,i=1,s=null,a=null;if(this.authentic386Analyzer&&this.authentic386Analyzer.initialized)console.log("ğŸ‹ Using Authentic 386çˆ» Analysis System..."),a=this.authentic386Analyzer.analyzeText(t),a&&(console.log("âœ… 386çˆ» Analysis Result:",a),a.hexagram&&(s=a.hexagram,i=6*a.hexagram.hexagram_id-6+(a.yao?.position||1)),a.specialYao&&console.log("ğŸŒŸ Special Yao detected:",a.specialYao.name));else if(window.IntegratedAnalysisEngine&&window.MultiDimensionalContextAnalyzer){console.log("ğŸ” Using IntegratedAnalysisEngine for deep text analysis...");const e=window.IntegratedAnalysisEngine&&window.IntegratedAnalysisEngine.performAnalysis?window.IntegratedAnalysisEngine.performAnalysis(t):null;console.log("ğŸ“Š Integrated analysis result:",e);const n=window.MultiDimensionalContextAnalyzer&&window.MultiDimensionalContextAnalyzer.analyzeContext?window.MultiDimensionalContextAnalyzer.analyzeContext(t):null;if(console.log("ğŸŒ Multi-dimensional context:",n),window.DynamicKeywordGenerator&&window.DynamicKeywordGenerator.generateKeywords){const e=await window.DynamicKeywordGenerator.generateKeywords(t);console.log("ğŸ”¤ Dynamic keywords generated:",e)}if(window.h384db&&e){const t=window.h384db.findBestMatch(e.keywords||[]);t&&(i=t.lineNumber,s=t.hexagramData,console.log(`âœ… Found matching hexagram: ${s["å¦å"]} ${s["çˆ»"]}`))}}if(window.tokenizer){console.log("ğŸ“ Using Kuromoji for morphological analysis...");const e=window.tokenizer.tokenize(t);console.log("ğŸ”¤ Morphological tokens:",e)}if(s||(console.log("âš ï¸ Using fallback random selection..."),i=Math.floor(384*Math.random())+1),this.useAuthentic386&&this.authentic386Integration)console.log("ğŸ… Using Authentic 386-Line Analysis System"),e=this.authentic386Integration.analyzeWithAuthentic386(t,{branchCount:8,enableSpecialLines:!0,integrationMode:"enhanced",currentLine:i}),this.displayAuthentic386Results(e);else if(window.Extended512HexagramEngine&&window.Extended512HexagramEngine.initialized)console.log("ğŸŒŸ Using Extended 512-Pattern Analysis System"),e=window.Extended512HexagramEngine.analyze512Pattern(t,{detailed:!0,include_yong_yao:!0,branch_count:8,currentLine:i}),this.display512PatternResults(e);else if(window.BinaryTreeFutureEngine){console.log("ğŸŒ³ Using Binary Tree Future Analysis System"),console.log(`ğŸ“ Current line determined: ${i}`);const e={inputText:t,hexagramData:s,integratedAnalysis:window.IntegratedAnalysisEngine&&window.IntegratedAnalysisEngine.performAnalysis?window.IntegratedAnalysisEngine.performAnalysis(t):null,contextAnalysis:window.MultiDimensionalContextAnalyzer?window.MultiDimensionalContextAnalyzer.analyzeContext(t):null},a=new window.BinaryTreeFutureEngine;console.log("ğŸ” DEBUG: Calling generateBinaryTreeFutures with:",{currentLine:i,context:e});const o=await a.generateBinaryTreeFutures(i,e);console.log("ğŸ” DEBUG: generateBinaryTreeFutures returned:",o),console.log("ğŸ¯ Calling IChingGuidanceEngine.performCompleteAnalysis for threeStageProcess...");let r=null;if(window.iChingGuidance&&window.iChingGuidance.performCompleteAnalysis)try{r=await window.iChingGuidance.performCompleteAnalysis(t),console.log("âœ… IChingGuidanceEngine analysis completed:",{hasThreeStageProcess:!!r?.threeStageProcess,hasEightScenarios:!!r?.eightScenarios,threeStageProcessStages:r?.threeStageProcess?.stages?.length})}catch(n){console.error("âŒ IChingGuidanceEngine analysis failed:",n)}else console.warn("âš ï¸ IChingGuidanceEngine not available");this.displayBinaryTreeResults(o),r&&window.futureSimulatorIntegration&&(console.log("ğŸ”„ Sending complete analysis to FutureSimulatorIntegration..."),window.futureSimulatorIntegration.displayResults(r))}else{console.log("âš¡ Using Standard Analysis System");const e=this.generateScenarios(t);this.displayResults(e)}}catch(n){console.error("Analysis error:",n),this.showError("åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ¨™æº–ã‚·ã‚¹ãƒ†ãƒ ã§å†è©¦è¡Œã—ã¾ã™ã€‚");const e=this.generateScenarios(t);this.displayResults(e)}},displayAuthentic386Results(e){console.log("ğŸ‹ Displaying Authentic 386-Line results:",{mode:e.integrationMode,special:e.specialLineDetected?.detected,authenticity:e.authenticity});const t=this.getResultsContainer();if(!t)return void console.error("Results container not found");t.innerHTML="";const n=this.generateAuthentic386HTML(e);t.innerHTML=n,this.setupAuthentic386Interactions(e),t.scrollIntoView({behavior:"smooth",block:"start"}),this.hideLoading()},generateAuthentic386HTML(e){const t=e.specialLineDetected?.detected,n=e.specialLineDetected?.type;let i="";if(t)i=`\n        <div class="current-pattern-card bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-6 mb-6 border-2 border-orange-300 shadow-lg">\n          <div class="flex items-center justify-between mb-4">\n            <h2 class="text-2xl font-bold text-gray-800">ğŸŒŸ ç‰¹æ®Šçˆ»æ¤œå‡º</h2>\n            <span class="px-4 py-2 bg-orange-600 text-white rounded-full text-sm font-bold animate-pulse">\n              ${n} - æ¥µã‚ã¦ç¨€\n            </span>\n          </div>\n          \n          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">\n            <div class="text-center p-4 bg-white rounded-lg border border-orange-200">\n              <div class="text-4xl mb-2">${"YouKuu"===n?"ğŸ‰":"ğŸŒ™"}</div>\n              <div class="font-bold text-orange-700">${n}</div>\n              <div class="text-sm text-orange-600">\n                ${"YouKuu"===n?"ç¾¤é¾ç„¡é¦–å‰":"åˆ©æ°¸è²"}\n              </div>\n            </div>\n            <div class="text-center p-4 bg-white rounded-lg border border-orange-200">\n              <div class="text-3xl mb-2">âš¡</div>\n              <div class="font-semibold text-gray-700">å¤‰åŒ–ãƒ¬ãƒ™ãƒ«</div>\n              <div class="text-sm text-orange-600">æœ€å¤§ç´šå¤‰åŒ–</div>\n            </div>\n            <div class="text-center p-4 bg-white rounded-lg border border-orange-200">\n              <div class="text-3xl mb-2">ğŸ¯</div>\n              <div class="font-semibold text-gray-700">ä¿¡é ¼æ€§</div>\n              <div class="text-sm text-orange-600">${Math.round(100*e.authenticity)}%</div>\n            </div>\n          </div>\n          \n          <div class="bg-orange-100 rounded-lg p-4 border border-orange-200">\n            <h3 class="font-bold text-orange-800 mb-2">ç‰¹æ®ŠçŠ¶æ³è§£é‡ˆ:</h3>\n            <p class="text-orange-700">\n              ${this.getSpecialLineInterpretation(n)}\n            </p>\n          </div>\n        </div>\n      `;else{const t=e.integratedAnalysis?.hexagram;i=`\n        <div class="current-pattern-card bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl p-6 mb-6 border border-blue-200">\n          <div class="flex items-center justify-between mb-4">\n            <h2 class="text-2xl font-bold text-gray-800">ç¾åœ¨ã®çŠ¶æ³</h2>\n            <span class="px-3 py-1 bg-blue-600 text-white rounded-full text-sm font-medium">\n              æ­£çµ±386çˆ»ã‚·ã‚¹ãƒ†ãƒ \n            </span>\n          </div>\n          \n          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">\n            <div class="text-center p-4 bg-white rounded-lg">\n              <div class="text-3xl mb-2">â˜¯ï¸</div>\n              <div class="font-semibold text-gray-700">${t?.number||"?"}. ${t?.name||"æœªç¢ºå®š"}</div>\n              <div class="text-sm text-gray-500">æ˜“çµŒå¦</div>\n            </div>\n            <div class="text-center p-4 bg-white rounded-lg">\n              <div class="text-3xl mb-2">ğŸ”®</div>\n              <div class="font-semibold text-gray-700">ä¿¡é ¼æ€§</div>\n              <div class="text-sm text-blue-600">${Math.round(100*e.authenticity)}%</div>\n            </div>\n            <div class="text-center p-4 bg-white rounded-lg">\n              <div class="text-3xl mb-2">ğŸ¯</div>\n              <div class="font-semibold text-gray-700">åˆ†æãƒ¢ãƒ¼ãƒ‰</div>\n              <div class="text-sm text-blue-600">${e.integrationMode}</div>\n            </div>\n          </div>\n        </div>\n      `}const s=e.eightScenarios?.scenarios||[];return`\n      <div class="analysis-results-386 fade-in">\n        ${i}\n        \n        \x3c!-- 8ã¤ã®æœªæ¥åˆ†å² --\x3e\n        <div class="scenarios-section">\n          <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸŒ¸ 8ã¤ã®å¤‰åŒ–ã®é“ç­‹</h2>\n          ${this.generateScenariosHTML(s)}\n        </div>\n        \n        \x3c!-- æ¨å¥¨è¡Œå‹• --\x3e\n        <div class="recommendation-card bg-green-50 rounded-xl p-6 mt-6 border border-green-200">\n          <h3 class="text-xl font-bold text-green-800 mb-3">ğŸ¯ æ¨å¥¨è¡Œå‹•</h3>\n          <p class="text-green-700">${this.getActionRecommendation(e)}</p>\n        </div>\n      </div>\n    `},generateScenariosHTML(e){return e&&0!==e.length?`\n      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">\n        ${e.map((e,t)=>`\n          <div class="scenario-card bg-white rounded-lg p-4 border hover:shadow-lg transition-shadow cursor-pointer"\n               onclick="FutureSimulator.Core.showScenarioDetail(${t})">\n            <div class="text-center mb-3">\n              <div class="text-2xl mb-2">${this.getScenarioEmoji(e.direction)}</div>\n              <h4 class="font-semibold text-gray-800">${e.name||e.direction}</h4>\n            </div>\n            <div class="text-sm text-gray-600 mb-2">\n              ${e.description?.substring(0,80)}...\n            </div>\n            <div class="flex justify-between text-xs text-gray-500">\n              <span>ç¢ºç‡: ${Math.round(100*(e.probability||.125))}%</span>\n              <span>${e.timeframe||"medium_term"}</span>\n            </div>\n          </div>\n        `).join("")}\n      </div>\n    `:'<p class="text-gray-500">ã‚·ãƒŠãƒªã‚ªãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆä¸­...</p>'},setupAuthentic386Interactions(e){window.currentAnalysisResult=e,e.specialLineDetected?.detected&&(console.log("ğŸŒŸ Special line interactions enabled"),this.setupSpecialLineInteractions(e.specialLineDetected.type))},getSpecialLineInterpretation:e=>"YouKuu"===e?"å…¨ã¦ã®è¦ç´ ãŒæœ€é«˜åº¦ã®å‰µé€ çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æŒã¤æ¥µã‚ã¦ç¨€ãªçŠ¶æ³ã§ã™ã€‚ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’åˆ†æ•£ã—ã€å„äººãŒè‡ªå¾‹çš„ã«å”åŠ›ã™ã‚‹ã“ã¨ã§ç†æƒ³çš„ãªçµæœãŒæœŸå¾…ã§ãã¾ã™ã€‚ã€Œç¾¤é¾ç„¡é¦–ã€ã®çŠ¶æ…‹ - ç‰¹å®šã®ãƒªãƒ¼ãƒ€ãƒ¼ã«ä¾å­˜ã—ãªã„çµ„ç¹”ã®æœ€é«˜å½¢æ…‹ã§ã™ã€‚":"YouRokuu"===e?"å…¨ã¦ã®è¦ç´ ãŒæœ€é«˜åº¦ã®å—å®¹çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æŒã¤æ¥µã‚ã¦ç¨€ãªçŠ¶æ³ã§ã™ã€‚åœ°é“ã§æŒç¶šçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€é•·æœŸçš„ãªå®‰å®šã¨ç™ºå±•ãŒæœŸå¾…ã§ãã¾ã™ã€‚ã€Œæ°¸è²ã«åˆ©ã—ã€ã®çŠ¶æ…‹ - æ­£é“ã‚’å®ˆã‚Šç¶šã‘ã‚‹ã“ã¨ã«ã‚ˆã‚‹çœŸã®åˆ©ç›Šã®ç²å¾—ã§ã™ã€‚":"ç‰¹æ®ŠãªçŠ¶æ³ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚",getActionRecommendation(e){const t=e.specialLineDetected;if(t?.detected){if("YouKuu"===t.type)return"å‰µé€ åŠ›ãŒæœ€é«˜æ½®ã«é”ã—ã¦ã„ã‚‹çŠ¶æ³ã§ã™ã€‚å„ãƒ¡ãƒ³ãƒãƒ¼ã®è‡ªä¸»æ€§ã‚’æœ€å¤§é™æ´»ã‹ã—ã€ãƒˆãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§ã¯ãªãå”èª¿çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§é€²ã‚ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚";if("YouRokuu"===t.type)return"å—å®¹æ€§ã¨æŒç¶šæ€§ãŒæœ€é«˜åº¦ã«ç™ºæ®ã•ã‚Œã‚‹çŠ¶æ³ã§ã™ã€‚æ€¥ãŒãšç€å®Ÿã«ã€æ­£é“ã‚’å®ˆã‚ŠãªãŒã‚‰é•·æœŸçš„ãªè¦–ç‚¹ã§å–ã‚Šçµ„ã‚€ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚"}return e.recommendedAction||"æ˜“çµŒã®æŒ‡å°ã«å¾“ã„ã€ç¾åœ¨ã®çŠ¶æ³ã«é©ã—ãŸæ–¹æ³•ã§é€²ã‚ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚"},getScenarioEmoji:e=>({creative_leadership:"ğŸ‰",joyful_expression:"ğŸ˜Š",illuminating_clarity:"â˜€ï¸",initiating_action:"âš¡",gentle_penetration:"ğŸŒ¿",adaptive_flow:"ğŸŒŠ",stable_foundation:"ğŸ”ï¸",receptive_support:"ğŸŒ™","ä¹¾":"ğŸ‰","å…Œ":"ğŸ˜Š","é›¢":"â˜€ï¸","éœ‡":"âš¡","å·½":"ğŸŒ¿","å":"ğŸŒŠ","è‰®":"ğŸ”ï¸","å¤":"ğŸŒ™"}[e]||"ğŸ”®"),showScenarioDetail(e){if(window.currentAnalysisResult&&window.currentAnalysisResult.eightScenarios){const t=window.currentAnalysisResult.eightScenarios.scenarios[e];t&&alert(`${t.name}\n\n${t.description||"ã‚·ãƒŠãƒªã‚ªã®è©³ç´°æƒ…å ±"}\n\næ¨å¥¨: ${t.recommendation||"çŠ¶æ³ã«å¿œã˜ã¦å¯¾å¿œã—ã¦ãã ã•ã„"}`)}},setupSpecialLineInteractions(e){console.log(`ğŸŒŸ Setting up ${e} interactions`)},display512PatternResults(e){console.log("ğŸ¨ Displaying 512-pattern results:",e.pattern_id);const t=this.getResultsContainer();if(!t)return void console.error("Results container not found");t.innerHTML="";const n=this.generate512PatternHTML(e);t.innerHTML=n,this.setup512PatternInteractions(e),t.scrollIntoView({behavior:"smooth",block:"start"}),this.hideLoading()},generate512PatternHTML(e){const t=e.current_pattern,n=e.future_branches;return`\n      <div class="analysis-results-512 fade-in">\n        \x3c!-- Current Pattern Display --\x3e\n        <div class="current-pattern-card bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6 mb-6 border border-purple-200">\n          <div class="flex items-center justify-between mb-4">\n            <h2 class="text-2xl font-bold text-gray-800">ç¾åœ¨ã®çŠ¶æ³ãƒ‘ã‚¿ãƒ¼ãƒ³</h2>\n            <span class="px-3 py-1 bg-purple-600 text-white rounded-full text-sm font-medium">\n              ${t.id} (512ä¸­ã®${t.pattern_index+1})\n            </span>\n          </div>\n          \n          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">\n            <div class="text-center p-4 bg-white rounded-lg">\n              <div class="text-3xl mb-2">â˜¯ï¸</div>\n              <div class="font-semibold text-gray-700">ç¬¬${t.line_position}çˆ»</div>\n              <div class="text-sm text-gray-500">\n                ${t.is_yong_yao?"ç”¨çˆ»ï¼ˆç‰¹æ®Šï¼‰":"é€šå¸¸çˆ»"}\n              </div>\n            </div>\n            <div class="text-center p-4 bg-white rounded-lg">\n              <div class="text-3xl mb-2">${this.getElementEmoji(t.dominant_element)}</div>\n              <div class="font-semibold text-gray-700">${t.dominant_element}ã®æ€§è³ª</div>\n              <div class="text-sm text-gray-500">${t.transformation_type}</div>\n            </div>\n            <div class="text-center p-4 bg-white rounded-lg">\n              <div class="text-3xl mb-2">ğŸ¯</div>\n              <div class="font-semibold text-gray-700">ä¿¡é ¼æ€§</div>\n              <div class="text-sm text-gray-500">${Math.round(100*t.authenticity_score)}%</div>\n            </div>\n          </div>\n          \n          <div class="bg-white rounded-lg p-4">\n            <h3 class="font-semibold text-gray-800 mb-2">HaQeiå“²å­¦çš„æ„å‘³</h3>\n            <p class="text-gray-700">${t.haqei_meaning}</p>\n          </div>\n          \n          ${e.yong_yao_analysis?this.generateYongYaoHTML(e.yong_yao_analysis):""}\n        </div>\n\n        \x3c!-- Future Branches (8 Scenarios) --\x3e\n        <div class="future-branches-container">\n          <div class="flex items-center justify-between mb-6">\n            <h2 class="text-2xl font-bold text-gray-800">å…«è±¡æœªæ¥åˆ†å²å›³</h2>\n            <span class="text-sm text-gray-600">\n              512ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰8ã¤ã®ä»£è¡¨çš„ãªæœªæ¥ã‚’é¸å‡º\n            </span>\n          </div>\n          \n          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">\n            ${n.map((e,t)=>this.generateBranchHTML(e,t)).join("")}\n          </div>\n        </div>\n\n        \x3c!-- Philosophical Guidance --\x3e\n        <div class="philosophical-guidance bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-6 mt-6 border border-amber-200">\n          <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">\n            <span class="text-2xl mr-2">ğŸ§˜â€â™‚ï¸</span>\n            HaQeiå“²å­¦çš„æŒ‡å°\n          </h3>\n          <div class="space-y-3">\n            ${e.philosophical_guidance?e.philosophical_guidance.map(e=>`<p class="text-gray-700 leading-relaxed">${e}</p>`).join(""):'<p class="text-gray-700">çŠ¶æ³ã«å¿œã˜ãŸæŒ‡å°ã‚’ç”Ÿæˆä¸­...</p>'}\n          </div>\n        </div>\n      </div>\n    `},generateYongYaoHTML:e=>`\n      <div class="yong-yao-analysis mt-4 p-4 bg-gradient-to-r from-yellow-50 to-amber-50 rounded-lg border border-yellow-200">\n        <h4 class="font-semibold text-amber-800 mb-2 flex items-center">\n          <span class="text-lg mr-2">âš¡</span>\n          ç”¨çˆ»ã®ç‰¹æ®Šãªæ„å‘³ - ${"yong_jiu"===e.type?"ç”¨ä¹ï¼ˆå‰µé€ ã®æ¥µè‡´ï¼‰":"ç”¨å…­ï¼ˆå—å®¹ã®æ¥µè‡´ï¼‰"}\n        </h4>\n        <p class="text-amber-700 text-sm leading-relaxed">${e.wisdom}</p>\n        <div class="mt-2 text-xs text-amber-600">\n          æ³¨æ„äº‹é …: ${e.caution}\n        </div>\n      </div>\n    `,generateBranchHTML:(e,t)=>`\n      <div class="branch-card bg-white rounded-lg p-4 border border-gray-200 hover:shadow-lg transition-all duration-300 cursor-pointer"\n           data-branch-index="${t}" \n           data-bagua="${e.bagua}">\n        <div class="text-center mb-3">\n          <div class="text-4xl mb-2">${e.emoji}</div>\n          <h3 class="font-bold text-gray-800 text-sm">${e.nature}ã®é“</h3>\n          <p class="text-xs text-gray-600">${e.direction}</p>\n        </div>\n        \n        <div class="space-y-2">\n          <div class="text-xs">\n            <span class="font-semibold">é–¢é€£æ€§:</span> \n            <span class="inline-block w-16 h-2 bg-gray-200 rounded-full overflow-hidden">\n              <div class="h-full bg-blue-500 rounded-full" \n                   style="width: ${Math.min(100,e.relevance_score)}%"></div>\n            </span>\n          </div>\n          <div class="text-xs">\n            <span class="font-semibold">ç¢ºç‡:</span> ${e.probability}\n          </div>\n        </div>\n        \n        <p class="text-xs text-gray-700 mt-2 line-clamp-3">${e.description}</p>\n        \n        <div class="mt-3 pt-2 border-t border-gray-100">\n          <p class="text-xs text-blue-600 font-medium">ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°è¡¨ç¤º</p>\n        </div>\n      </div>\n    `,setup512PatternInteractions(e){document.querySelectorAll(".branch-card").forEach(t=>{t.addEventListener("click",t=>{const n=parseInt(t.currentTarget.dataset.branchIndex),i=e.future_branches[n];this.showBranchDetails(i,e)})})},showBranchDetails(e,t){const n=document.createElement("div");n.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",n.innerHTML=`\n      <div class="bg-white rounded-xl p-6 max-w-2xl w-full max-h-screen overflow-y-auto">\n        <div class="flex items-center justify-between mb-4">\n          <h2 class="text-2xl font-bold text-gray-800 flex items-center">\n            <span class="text-3xl mr-3">${e.emoji}</span>\n            ${e.nature}ã®é“ (${e.bagua})\n          </h2>\n          <button class="close-modal text-gray-500 hover:text-gray-700 text-2xl">&times;</button>\n        </div>\n        \n        <div class="space-y-4">\n          <div>\n            <h3 class="font-semibold text-gray-800 mb-2">æ–¹å‘æ€§</h3>\n            <p class="text-gray-700">${e.direction}</p>\n          </div>\n          \n          <div>\n            <h3 class="font-semibold text-gray-800 mb-2">è©³ç´°èª¬æ˜</h3>\n            <p class="text-gray-700">${e.description}</p>\n          </div>\n          \n          <div>\n            <h3 class="font-semibold text-gray-800 mb-2">æŒ‡å°å†…å®¹</h3>\n            <p class="text-gray-700">${e.guidance}</p>\n          </div>\n          \n          ${e.haqei_wisdom?`\n            <div>\n              <h3 class="font-semibold text-gray-800 mb-2">HaQeiæ™ºæ…§</h3>\n              <p class="text-gray-700">${e.haqei_wisdom}</p>\n            </div>\n          `:""}\n          \n          <div class="grid grid-cols-2 gap-4 mt-4">\n            <div class="text-center p-3 bg-blue-50 rounded-lg">\n              <div class="font-semibold text-blue-800">é–¢é€£æ€§</div>\n              <div class="text-2xl font-bold text-blue-600">${Math.round(e.relevance_score)}%</div>\n            </div>\n            <div class="text-center p-3 bg-green-50 rounded-lg">\n              <div class="font-semibold text-green-800">ç¢ºç‡</div>\n              <div class="text-2xl font-bold text-green-600">${e.probability}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `,document.body.appendChild(n),n.querySelector(".close-modal").addEventListener("click",()=>{document.body.removeChild(n)}),n.addEventListener("click",e=>{e.target===n&&document.body.removeChild(n)})},displayBinaryTreeResults(e){console.log("ğŸŒ³ Displaying Binary Tree results with BinaryTreeCompleteDisplay:",{currentLine:e.currentLine,totalPaths:e.finalEightPaths?.length||0,version:e.version});const t=this.getResultsContainer();t?(t.innerHTML="",this.generateBinaryTreeHTML(e),setTimeout(()=>{const e=document.querySelector(".binary-tree-complete-analysis");e&&e.scrollIntoView({behavior:"smooth",block:"start"}),this.hideLoading()},200)):console.error("Results container not found")},generateBinaryTreeHTML(e){const t=this.enhanceResultData(e);return window.BinaryTreeCompleteDisplay?(window.BinaryTreeCompleteDisplay.display(t),'<div id="binary-tree-display-container">\x3c!-- Rendered by BinaryTreeCompleteDisplay --\x3e</div>'):'<div class="error-message">Display system not available</div>'},enhanceResultData(e){return!e.finalEightPaths&&e.branches&&(e.finalEightPaths=this.convertBranchesToPaths(e.branches)),e.finalEightPaths&&(e.finalEightPaths=e.finalEightPaths.map((e,t)=>({...e,pathIndex:e.pathIndex||t+1,title:e.title||`ãƒ‘ã‚¹${t+1}`,description:e.description||e.fullDescription||this.generatePathDescription(e),probability:e.probability||1/8,route:e.route||["é–‹å§‹","ä¸­é–“","çµ‚äº†"]}))),e},convertBranchesToPaths(e){const t=[];let n=1;return e&&e.level3&&Object.entries(e.level3).forEach(([e,i])=>{Object.entries(i).forEach(([i,s])=>{Object.entries(s).forEach(([s,a])=>{t.push({pathIndex:n++,title:this.generatePathTitle(e,i,s),description:this.generatePathDescriptionFromBranch(e,i,s),probability:a.final_probability||1/8,route:this.generatePathRoute(e,i,s)})})})}),t.length>0?t:this.generateDefaultPaths()},generatePathTitle:(e,t,n)=>({progress_continue_strengthen:"ç¶™ç¶šå¼·åŒ–ãƒ»çªç ´å‹",progress_continue_moderate:"ç¶™ç¶šå¼·åŒ–ãƒ»å®‰å®šå‹",progress_adjust_strengthen:"ç¶™ç¶šèª¿æ•´ãƒ»é©æ–°å‹",progress_adjust_moderate:"ç¶™ç¶šèª¿æ•´ãƒ»æ”¹å–„å‹",transform_complete_strengthen:"è»¢æ›å®Œå…¨ãƒ»é£›èºå‹",transform_complete_moderate:"è»¢æ›å®Œå…¨ãƒ»æ®µéšå‹",transform_integrate_strengthen:"è»¢æ›çµ±åˆãƒ»èåˆå‹",transform_integrate_moderate:"è»¢æ›çµ±åˆãƒ»å‰µé€ å‹"}[`${e}_${t}_${n.replace("option_a","strengthen").replace("option_b","moderate")}`]||`${e}ãƒ»${t}ãƒ»${n}`),generatePathDescriptionFromBranch:(e,t,n)=>({progress_continue_strengthen:"ç¾åœ¨ã®å¼·ã¿ã‚’æœ€å¤§é™ã«æ´»ã‹ã—ã€æ—¢å­˜ã®æ–¹å‘æ€§ã‚’ã•ã‚‰ã«æ¨é€²ã™ã‚‹é“",progress_continue_moderate:"å®‰å®šæ€§ã‚’é‡è¦–ã—ãªãŒã‚‰ç€å®Ÿã«å‰é€²ã™ã‚‹å …å®Ÿãªé“",progress_adjust_strengthen:"åŸºæœ¬è·¯ç·šã‚’ç¶­æŒã—ãªãŒã‚‰é©æ–°çš„ãªæ”¹å–„ã‚’åŠ ãˆã‚‹é“",progress_adjust_moderate:"æŸ”è»Ÿãªèª¿æ•´ã«ã‚ˆã‚Šæœ€é©ãªãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã¤é“",transform_complete_strengthen:"æ ¹æœ¬çš„ãªå¤‰é©ã«ã‚ˆã‚Šé£›èºçš„æˆé•·ã‚’é”æˆã™ã‚‹é“",transform_complete_moderate:"è¨ˆç”»çš„ãªè»¢æ›ã«ã‚ˆã‚Šæ–°ãŸãªå¯èƒ½æ€§ã‚’é–‹æ‹“ã™ã‚‹é“",transform_integrate_strengthen:"æ–°æ—§ã®è¦ç´ ã‚’å‰µé€ çš„ã«çµ±åˆã—ç‹¬è‡ªã®ä¾¡å€¤ã‚’ç”Ÿã¿å‡ºã™é“",transform_integrate_moderate:"å¤šæ§˜ãªè¦ç´ ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆãçµ±åˆã™ã‚‹é“"}[`${e}_${t}_${n.replace("option_a","strengthen").replace("option_b","moderate")}`]||"æ–°ãŸãªå¯èƒ½æ€§ã‚’æ¢ç´¢ã™ã‚‹é“"),generatePathRoute(e,t,n){const i={progress:"ç¶™ç¶šé¸æŠ",transform:"è»¢æ›é¸æŠ",continue:"å¼·åŒ–æ–¹å‘",adjust:"èª¿æ•´æ–¹å‘",complete:"å®Œå…¨è»¢æ›",integrate:"çµ±åˆæ–¹å‘",option_a:"ç©æ¥µæ¨é€²",option_b:"ç€å®Ÿé€²è¡Œ"};return["é–‹å§‹",i[e]||e,i[t]||t,i[n]||n]},generateDefaultPaths:()=>[{pathIndex:1,title:"ç¶™ç¶šå¼·åŒ–ãƒ»çªç ´å‹",description:"ç¾åœ¨ã®å¼·ã¿ã‚’æœ€å¤§é™ã«æ´»ã‹ã™é“",probability:.135,route:["é–‹å§‹","ç¶™ç¶šé¸æŠ","å¼·åŒ–æ–¹å‘","ç©æ¥µæ¨é€²"]},{pathIndex:2,title:"ç¶™ç¶šå¼·åŒ–ãƒ»å®‰å®šå‹",description:"ç€å®Ÿãªæˆé•·ã‚’é‡è¦–ã™ã‚‹é“",probability:.115,route:["é–‹å§‹","ç¶™ç¶šé¸æŠ","å¼·åŒ–æ–¹å‘","ç€å®Ÿé€²è¡Œ"]},{pathIndex:3,title:"ç¶™ç¶šèª¿æ•´ãƒ»é©æ–°å‹",description:"æ—¢å­˜ã®æ çµ„ã¿ã‚’é©æ–°ã™ã‚‹é“",probability:.13,route:["é–‹å§‹","ç¶™ç¶šé¸æŠ","èª¿æ•´æ–¹å‘","ç©æ¥µæ¨é€²"]},{pathIndex:4,title:"ç¶™ç¶šèª¿æ•´ãƒ»æ”¹å–„å‹",description:"æ®µéšçš„ãªæ”¹å–„ã‚’é‡ã­ã‚‹é“",probability:.12,route:["é–‹å§‹","ç¶™ç¶šé¸æŠ","èª¿æ•´æ–¹å‘","ç€å®Ÿé€²è¡Œ"]},{pathIndex:5,title:"è»¢æ›çµ±åˆãƒ»èåˆå‹",description:"æ–°æ—§ã®è¦ç´ ã‚’çµ±åˆã™ã‚‹é“",probability:.14,route:["é–‹å§‹","è»¢æ›é¸æŠ","çµ±åˆæ–¹å‘","ç©æ¥µæ¨é€²"]},{pathIndex:6,title:"è»¢æ›çµ±åˆãƒ»å‰µé€ å‹",description:"å…¨ãæ–°ã—ã„ä¾¡å€¤ã‚’å‰µé€ ã™ã‚‹é“",probability:.13,route:["é–‹å§‹","è»¢æ›é¸æŠ","çµ±åˆæ–¹å‘","ç€å®Ÿé€²è¡Œ"]},{pathIndex:7,title:"è»¢æ›æ®µéšãƒ»é£›èºå‹",description:"å¤§ããªé£›èºã‚’ç›®æŒ‡ã™é“",probability:.12,route:["é–‹å§‹","è»¢æ›é¸æŠ","å®Œå…¨è»¢æ›","ç©æ¥µæ¨é€²"]},{pathIndex:8,title:"è»¢æ›æ®µéšãƒ»æ¢ç´¢å‹",description:"æ–°ãŸãªå¯èƒ½æ€§ã‚’æ¢ç´¢ã™ã‚‹é“",probability:.11,route:["é–‹å§‹","è»¢æ›é¸æŠ","å®Œå…¨è»¢æ›","ç€å®Ÿé€²è¡Œ"]}],generatePathDescription:e=>e.route&&e.route.length>0?`${e.route.join(" â†’ ")}ã‚’é€šã˜ã¦ã€æ–°ãŸãªæœªæ¥ã‚’åˆ‡ã‚Šé–‹ãé“`:"æœªæ¥ã¸ã®æ–°ãŸãªå¯èƒ½æ€§ã‚’æ¢ç´¢ã™ã‚‹é“",generateHaQeiIntegrationHTML:e=>`\n      <div class="haqei-integration bg-gradient-to-r from-amber-50 to-yellow-50 rounded-xl p-6 mt-6 border border-amber-200">\n        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">\n          <span class="text-2xl mr-2">ğŸ§˜â€â™‚ï¸</span>\n          HaQeiå“²å­¦çš„çµ±åˆ\n        </h3>\n        \n        <div class="space-y-4">\n          <div class="bg-white rounded-lg p-4">\n            <h4 class="font-semibold text-amber-800 mb-2">ğŸ¤ çŸ›ç›¾å—å®¹ã®åŸå‰‡</h4>\n            <p class="text-amber-700 text-sm">${e.contradiction_acceptance?.explanation||"è¤‡æ•°ã®ç›¸åã™ã‚‹é“ç­‹ãŒåŒæ™‚ã«å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’å—ã‘å…¥ã‚Œã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šè±Šã‹ãªé¸æŠè‚¢ãŒç”Ÿã¾ã‚Œã¾ã™"}</p>\n          </div>\n          \n          <div class="bg-white rounded-lg p-4">\n            <h4 class="font-semibold text-amber-800 mb-2">ğŸ­ æ®µéšçš„åˆ†äººåˆ‡ã‚Šæ›¿ãˆ</h4>\n            <div class="space-y-2 text-sm text-amber-700">\n              <div><strong>ç¬¬1æ®µéš:</strong> ${e.persona_switching?.level1||"æˆ¦ç•¥çš„æ€è€ƒåˆ†äºº"}</div>\n              <div><strong>ç¬¬2æ®µéš:</strong> ${e.persona_switching?.level2||"å®Ÿè¡Œåˆ¤æ–­åˆ†äºº"}</div>\n              <div><strong>ç¬¬3æ®µéš:</strong> ${e.persona_switching?.level3||"æœ€çµ‚æ±ºæ–­åˆ†äºº"}</div>\n            </div>\n          </div>\n          \n          <div class="bg-white rounded-lg p-4">\n            <h4 class="font-semibold text-amber-800 mb-2">ğŸŒŸ çµ±åˆçš„çŸ¥æµ</h4>\n            <p class="text-amber-700 text-sm">${e.unified_wisdom?.meta_guidance||"å…¨ã¦ã®é¸æŠè‚¢ã‚’ç†è§£ã™ã‚‹ã“ã¨ã§ã€çŠ¶æ³ã«æœ€é©ãªåˆ¤æ–­ãŒå¯èƒ½ã«ãªã‚Šã¾ã™"}</p>\n          </div>\n        </div>\n      </div>\n    `,setupBinaryTreeInteractions(e){console.log("ğŸŒ³ Setting up binary tree interactions"),window.currentBinaryResult=e,document.querySelectorAll(".level1-option").forEach(t=>{t.addEventListener("click",t=>{const n=t.currentTarget.dataset.choice;this.handleLevel1Selection(n,e)})}),document.querySelectorAll(".path-card").forEach(t=>{t.addEventListener("click",t=>{const n=parseInt(t.currentTarget.dataset.pathIndex);this.showPathDetails(n,e)})})},handleLevel1Selection(e,t){console.log(`ğŸ¯ Level 1 selection: ${e}`),document.getElementById("level-1-selection").classList.add("hidden"),document.getElementById("level-2-selection").classList.remove("hidden");const n=document.getElementById("level-2-options");n.innerHTML="progress"===e?'\n        <button class="level2-option bg-green-50 hover:bg-green-100 border-2 border-green-200 rounded-lg p-4 transition-all duration-300" data-choice="continue" data-parent="progress">\n          <div class="text-2xl mb-2">â¬†ï¸</div>\n          <div class="font-bold text-green-800">ã•ã‚‰ã«é€²ã‚€</div>\n          <div class="text-sm text-green-600 mt-2">é †è¡Œã®æ–¹å‘æ€§ã‚’ã‚ˆã‚Šå¼·åŒ–ã™ã‚‹</div>\n        </button>\n        <button class="level2-option bg-yellow-50 hover:bg-yellow-100 border-2 border-yellow-200 rounded-lg p-4 transition-all duration-300" data-choice="adjust" data-parent="progress">\n          <div class="text-2xl mb-2">âš–ï¸</div>\n          <div class="font-bold text-yellow-800">ä¸€éƒ¨è»¢æ›</div>\n          <div class="text-sm text-yellow-600 mt-2">é †è¡Œã—ã¤ã¤ã‚‚éƒ¨åˆ†çš„ã«èª¿æ•´ã™ã‚‹</div>\n        </button>\n      ':'\n        <button class="level2-option bg-red-50 hover:bg-red-100 border-2 border-red-200 rounded-lg p-4 transition-all duration-300" data-choice="complete" data-parent="transform">\n          <div class="text-2xl mb-2">ğŸ”„</div>\n          <div class="font-bold text-red-800">å®Œå…¨è»¢æ›</div>\n          <div class="text-sm text-red-600 mt-2">æ ¹æœ¬çš„ãªæ–¹å‘è»¢æ›ã‚’è¡Œã†</div>\n        </button>\n        <button class="level2-option bg-purple-50 hover:bg-purple-100 border-2 border-purple-200 rounded-lg p-4 transition-all duration-300" data-choice="integrate" data-parent="transform">\n          <div class="text-2xl mb-2">ğŸ¤</div>\n          <div class="font-bold text-purple-800">çµ±åˆçš„è»¢æ›</div>\n          <div class="text-sm text-purple-600 mt-2">æ—¢å­˜è¦ç´ ã¨æ–°è¦ç´ ã‚’çµ±åˆã™ã‚‹</div>\n        </button>\n      ',document.querySelectorAll(".level2-option").forEach(e=>{e.addEventListener("click",e=>{const n=e.currentTarget.dataset.choice,i=e.currentTarget.dataset.parent;this.handleLevel2Selection(i,n,t)})})},handleLevel2Selection(e,t,n){console.log(`ğŸ¯ Level 2 selection: ${e} â†’ ${t}`),document.getElementById("level-2-selection").classList.add("hidden"),document.getElementById("level-3-selection").classList.remove("hidden");document.getElementById("level-3-options").innerHTML=`\n      <button class="level3-option bg-blue-50 hover:bg-blue-100 border-2 border-blue-200 rounded-lg p-4 transition-all duration-300" data-choice="strengthen" data-path="${e}-${t}">\n        <div class="text-2xl mb-2">ğŸ’ª</div>\n        <div class="font-bold text-blue-800">ç¶™ç¶šå¼·åŒ–</div>\n        <div class="text-sm text-blue-600 mt-2">é¸æŠã—ãŸæ–¹å‘æ€§ã‚’ã•ã‚‰ã«å¼·åŒ–</div>\n      </button>\n      <button class="level3-option bg-gray-50 hover:bg-gray-100 border-2 border-gray-200 rounded-lg p-4 transition-all duration-300" data-choice="moderate" data-path="${e}-${t}">\n        <div class="text-2xl mb-2">âš–ï¸</div>\n        <div class="font-bold text-gray-800">éƒ¨åˆ†çš„ä¿®æ­£</div>\n        <div class="text-sm text-gray-600 mt-2">ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã¡ãªãŒã‚‰èª¿æ•´</div>\n      </button>\n    `,document.querySelectorAll(".level3-option").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.dataset.choice,i=e.currentTarget.dataset.path;this.handleLevel3Selection(i,t,n)})})},handleLevel3Selection(e,t,n){console.log(`ğŸ¯ Final selection: ${e} â†’ ${t}`),document.getElementById("level-3-selection").classList.add("hidden");const i=document.getElementById("final-patterns-display");i.classList.remove("hidden");const s=document.createElement("div");s.className="completion-message bg-emerald-50 border border-emerald-200 rounded-lg p-4 mb-6",s.innerHTML=`\n      <div class="flex items-center">\n        <div class="text-3xl mr-4">ğŸ‰</div>\n        <div>\n          <div class="font-bold text-emerald-800">é¸æŠãƒ—ãƒ­ã‚»ã‚¹å®Œäº†ï¼</div>\n          <div class="text-sm text-emerald-600">ã‚ãªãŸã®3æ®µéšé¸æŠ: ${e} â†’ ${t}</div>\n          <div class="text-sm text-emerald-600">ä»¥ä¸‹ã®8ã¤ã®é“ç­‹ãŒã‚ãªãŸã®å‰ã«é–‹ã‹ã‚Œã¦ã„ã¾ã™</div>\n        </div>\n      </div>\n    `,i.insertBefore(s,i.firstChild),i.scrollIntoView({behavior:"smooth"})},showPathDetails(e,t){const n=t.finalEightPaths[e];if(!n)return;const i=document.createElement("div");i.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",i.innerHTML=`\n      <div class="bg-white rounded-xl p-6 max-w-2xl w-full max-h-screen overflow-y-auto">\n        <div class="flex items-center justify-between mb-4">\n          <h2 class="text-2xl font-bold text-gray-800">\n            ${n.title}\n          </h2>\n          <button class="close-modal text-gray-500 hover:text-gray-700 text-2xl">&times;</button>\n        </div>\n        \n        <div class="space-y-4">\n          <div>\n            <h3 class="font-semibold text-gray-800 mb-2">é¸æŠçµŒè·¯</h3>\n            <div class="flex items-center space-x-2 text-sm bg-gray-50 p-3 rounded-lg">\n              ${(n.route||[]).map(e=>`<span class="bg-white px-2 py-1 rounded">${e}</span>`).join('<span class="text-gray-400">â†’</span>')}\n            </div>\n          </div>\n          \n          <div>\n            <h3 class="font-semibold text-gray-800 mb-2">è©³ç´°èª¬æ˜</h3>\n            <p class="text-gray-700">${n.fullDescription||n.title}</p>\n          </div>\n          \n          <div>\n            <h3 class="font-semibold text-gray-800 mb-2">å®Ÿè·µçš„æŒ‡å°</h3>\n            <ul class="list-disc list-inside text-gray-700 space-y-1">\n              ${(n.practical_guidance||["çŠ¶æ³ã‚’è¦³å¯Ÿã™ã‚‹","æ®µéšçš„ã«é€²ã‚€","æŸ”è»Ÿã«å¯¾å¿œã™ã‚‹"]).map(e=>`<li>${e}</li>`).join("")}\n            </ul>\n          </div>\n          \n          <div class="grid grid-cols-2 gap-4">\n            <div class="text-center p-3 bg-blue-50 rounded-lg">\n              <div class="font-semibold text-blue-800">å®Ÿç¾ç¢ºç‡</div>\n              <div class="text-2xl font-bold text-blue-600">${Math.round(100*(n.probability||.125))}%</div>\n            </div>\n            <div class="text-center p-3 bg-green-50 rounded-lg">\n              <div class="font-semibold text-green-800">æœŸé–“ç›®å®‰</div>\n              <div class="text-lg font-bold text-green-600">${n.timeline||"3-6ãƒ¶æœˆ"}</div>\n            </div>\n          </div>\n          \n          <div>\n            <h3 class="font-semibold text-gray-800 mb-2">æˆåŠŸè¦å› </h3>\n            <div class="flex flex-wrap gap-2">\n              ${(n.success_factors||["ç¶™ç¶šæ€§","é©å¿œåŠ›","åˆ¤æ–­åŠ›"]).map(e=>`<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">${e}</span>`).join("")}\n            </div>\n          </div>\n          \n          <div>\n            <h3 class="font-semibold text-gray-800 mb-2">æ³¨æ„ã™ã¹ãèª²é¡Œ</h3>\n            <div class="flex flex-wrap gap-2">\n              ${(n.potential_challenges||["å¤‰åŒ–ã¸ã®æŠµæŠ—","å¤–çš„è¦å› ","ã‚¿ã‚¤ãƒŸãƒ³ã‚°"]).map(e=>`<span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm">${e}</span>`).join("")}\n            </div>\n          </div>\n        </div>\n      </div>\n    `,document.body.appendChild(i),i.querySelector(".close-modal").addEventListener("click",()=>{document.body.removeChild(i)}),i.addEventListener("click",e=>{e.target===i&&document.body.removeChild(i)})},getResultsContainer(){return document.getElementById("results-container")||document.getElementById("analysis-results")||document.querySelector(".results-section")||this.createResultsContainer()},getElementEmoji:e=>({"æœ¨":"ğŸŒ±","ç«":"ğŸ”¥","åœŸ":"ğŸŒ","é‡‘":"âš¡","æ°´":"ğŸŒŠ"}[e]||"â­"),generateScenarios(e){console.log("ğŸ² Generating scenarios for:",e.substring(0,50)+"...");return[{title:"ç¾çŠ¶ç¶­æŒã®æœªæ¥",description:"ç¾åœ¨ã®çŠ¶æ³ã‚’ç¶™ç¶šã—ãŸå ´åˆã®å±•é–‹",content:"ç¾åœ¨ã®æ–¹å‘æ€§ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã§ã€å®‰å®šã—ãŸæˆé•·ãŒæœŸå¾…ã§ãã¾ã™ã€‚ãƒªã‚¹ã‚¯ã¯å°‘ãªãã€ç€å®Ÿãªé€²æ­©ã‚’é‚ã’ã‚‹ã§ã—ã‚‡ã†ã€‚",probability:"é«˜",timeframe:"çŸ­æœŸï½ä¸­æœŸ",advice:"ç¾åœ¨ã®å–ã‚Šçµ„ã¿ã‚’ç¶™ç¶šã—ã€å°ã•ãªæ”¹å–„ã‚’ç©ã¿é‡ã­ã¾ã—ã‚‡ã†ã€‚"},{title:"ç©æ¥µå¤‰åŒ–ã®æœªæ¥",description:"å¤§èƒ†ãªå¤‰åŒ–ã‚’é¸æŠã—ãŸå ´åˆã®å±•é–‹",content:"æ–°ã—ã„æŒ‘æˆ¦ã«è¸ã¿å‡ºã™ã“ã¨ã§ã€å¤§ããªæˆé•·ã®æ©Ÿä¼šã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚å›°é›£ã¯ã‚ã‚Šã¾ã™ãŒã€ãã‚Œã‚’ä¹—ã‚Šè¶ŠãˆãŸå…ˆã«æ–°ã—ã„å¯èƒ½æ€§ãŒåºƒãŒã‚Šã¾ã™ã€‚",probability:"ä¸­",timeframe:"ä¸­æœŸï½é•·æœŸ",advice:"ãƒªã‚¹ã‚¯ã‚’æ…é‡ã«è©•ä¾¡ã—ã¤ã¤ã€æº–å‚™ã‚’æ•´ãˆã¦ã‹ã‚‰è¡Œå‹•ã—ã¾ã—ã‚‡ã†ã€‚"},{title:"èª¿å’Œçš„ç™ºå±•ã®æœªæ¥",description:"ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸé¸æŠã®å±•é–‹",content:"æ…é‡ã•ã¨ç©æ¥µæ€§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã¡ãªãŒã‚‰ã€æ®µéšçš„ã«å¤‰åŒ–ã‚’é€²ã‚ã‚‹ã“ã¨ã§ã€æœ€ã‚‚å®‰å…¨ã§åŠ¹æœçš„ãªæˆæœã‚’å¾—ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚",probability:"é«˜",timeframe:"ä¸­æœŸ",advice:"æ§˜ã€…ãªé¸æŠè‚¢ã‚’æ¤œè¨ã—ã€æœ€é©ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¦‹æ¥µã‚ã¾ã—ã‚‡ã†ã€‚"},{title:"å†…çœæ·±åŒ–ã®æœªæ¥",description:"è‡ªå·±ç†è§£ã‚’æ·±ã‚ã‚‹é¸æŠã®å±•é–‹",content:"ã¾ãšã¯è‡ªåˆ†è‡ªèº«ã¨å‘ãåˆã„ã€çœŸã«æœ›ã‚€æ–¹å‘æ€§ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šç¢ºä¿¡ã‚’æŒã£ã¦æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚",probability:"ä¸­",timeframe:"çŸ­æœŸ",advice:"æ™‚é–“ã‚’ã‹ã‘ã¦è‡ªåˆ†ã®ä¾¡å€¤è¦³ã¨ç›®æ¨™ã‚’æ•´ç†ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚"},{title:"å”åŠ›æ‹¡å¼µã®æœªæ¥",description:"ä»–è€…ã¨ã®é€£æºã‚’é‡è¦–ã—ãŸå±•é–‹",content:"ä¿¡é ¼ã§ãã‚‹äººã€…ã¨ã®å”åŠ›é–¢ä¿‚ã‚’ç¯‰ãã“ã¨ã§ã€ä¸€äººã§ã¯é”æˆã§ããªã„å¤§ããªæˆæœã‚’ç”Ÿã¿å‡ºã™ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚",probability:"ä¸­",timeframe:"ä¸­æœŸ",advice:"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’åºƒã’ã€win-winã®é–¢ä¿‚ã‚’æ§‹ç¯‰ã—ã¾ã—ã‚‡ã†ã€‚"},{title:"æ½œä¼æº–å‚™ã®æœªæ¥",description:"æ™‚æœŸã‚’å¾…ã¡æº–å‚™ã‚’é‡ã­ã‚‹é¸æŠã®å±•é–‹",content:"ä»Šã¯æº–å‚™ã®æ™‚æœŸã€‚é©åˆ‡ãªæ©Ÿä¼šã‚’å¾…ã¡ãªãŒã‚‰å®ŸåŠ›ã‚’è“„ãˆã‚‹ã“ã¨ã§ã€æœ€è‰¯ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¡Œå‹•ã«ç§»ã™ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚",probability:"é«˜",timeframe:"çŸ­æœŸï½ä¸­æœŸ",advice:"ç„¦ã‚‰ãšã€ã—ã£ã‹ã‚Šã¨ã—ãŸåŸºç›¤ä½œã‚Šã«é›†ä¸­ã—ã¾ã—ã‚‡ã†ã€‚"}].sort(()=>Math.random()-.5).slice(0,4)},displayResults(e){console.log("ğŸ“Š Displaying analysis results...");let t=document.getElementById("results-container")||document.getElementById("analysis-results")||document.querySelector(".results-section");t||(t=this.createResultsContainer()),t.innerHTML=`\n      <div class="results-header">\n        <h2>ğŸ”® æœªæ¥åˆ†æçµæœ</h2>\n        <p>ã‚ãªãŸã®çŠ¶æ³ã‹ã‚‰å°ãå‡ºã•ã‚ŒãŸå¯èƒ½æ€§ã®ã‚ã‚‹ã‚·ãƒŠãƒªã‚ªã§ã™</p>\n      </div>\n      <div class="scenarios-grid">\n        ${e.map((e,t)=>`\n          <div class="scenario-card" style="animation-delay: ${.2*t}s">\n            <div class="scenario-header">\n              <h3>${e.title}</h3>\n              <span class="probability-badge">${e.probability}ç¢ºç‡</span>\n            </div>\n            <div class="scenario-content">\n              <p class="description">${e.description}</p>\n              <p class="content">${e.content}</p>\n              <div class="scenario-meta">\n                <span class="timeframe">â±ï¸ ${e.timeframe}</span>\n              </div>\n              <div class="advice">\n                <strong>ğŸ’¡ ã‚¢ãƒ‰ãƒã‚¤ã‚¹:</strong> ${e.advice}\n              </div>\n            </div>\n          </div>\n        `).join("")}\n      </div>\n      <div class="results-footer">\n        <p><em>â€» ã“ã‚Œã‚‰ã¯æ˜“çµŒã®æ€æƒ³ã«åŸºã¥ãä¸€èˆ¬çš„ãªæŒ‡é‡ã§ã™ã€‚æœ€çµ‚çš„ãªåˆ¤æ–­ã¯ã”è‡ªèº«ã§ãŠæ±ºã‚ãã ã•ã„ã€‚</em></p>\n        <button onclick="location.reload()" class="retry-button">ğŸ”„ æ–°ã—ãåˆ†æã™ã‚‹</button>\n      </div>\n    `,t.style.display="block",t.scrollIntoView({behavior:"smooth"})},createResultsContainer(){const e=document.createElement("div");e.id="results-container",e.className="results-section";const t=document.querySelector(".input-section")||document.querySelector("form")||document.querySelector("textarea").closest("div");return t?t.parentNode.insertBefore(e,t.nextSibling):document.body.appendChild(e),e},showLoading(){const e=document.querySelector('button[onclick*="analyze"]')||document.querySelector(".analyze-btn");e&&(e.disabled=!0,e.textContent="ğŸ”® åˆ†æä¸­...");const t=document.getElementById("results-loading");t&&(t.style.display="block")},hideLoading(){const e=document.querySelector('button[onclick*="analyze"]')||document.querySelector(".analyze-btn");e&&(e.disabled=!1,e.textContent="ğŸ¯ æœªæ¥ã‚’åˆ†æã™ã‚‹");const t=document.getElementById("results-loading");t&&(t.style.display="none")},async initializeEngines(){console.log("ğŸ”§ Initializing analysis engines...");try{window.IntegratedAnalysisEngine&&window.IntegratedAnalysisEngine.init(),window.SituationalContextEngine&&window.SituationalContextEngine.init(),window.MultiDimensionalContextAnalyzer&&window.MultiDimensionalContextAnalyzer.init(),console.log("âœ… Analysis engines initialized")}catch(e){console.error("âŒ Engine initialization error:",e)}},showError(e){console.error("âŒ System Error:",e);const t=document.getElementById("error-display")||document.getElementById("result-display");t?t.innerHTML=`\n        <div class="error-message" style="background: #ff4444; color: white; padding: 1rem; border-radius: 0.5rem;">\n          <h3>ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼</h3>\n          <p>${e}</p>\n          <p><small>è©³ç´°ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</small></p>\n        </div>\n      `:alert(e),this.hideLoading()},safeLoadComponent(e){try{const t=window[e];return t&&"function"==typeof t.init?(t.init(),console.log(`âœ… ${e} loaded successfully`),!0):(console.warn(`âš ï¸ ${e} not available or missing init method`),!1)}catch(t){return console.error(`âŒ Error loading ${e}:`,t.message),!1}}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>FutureSimulator.Core.init(),1e3)}):setTimeout(()=>FutureSimulator.Core.init(),1e3),console.log("âœ… Future Simulator Core loaded");