class MetaphorGenerationEngine{constructor(){this.initialized=!1,this.metaphorDatabase=null,this.generationRules=null,this.contextAnalyzer=null,this.integrativeHarmony={wisdom_simplicity:!0,clarity_depth:!0,practical_profound:!0,accessible_mystery:!0},this.engineOS=null,this.interfaceOS=null,this.safeMode=null,this.init()}async init(){console.log("ğŸ¨ [MetaphorGenerationEngine] åˆæœŸåŒ–é–‹å§‹ - æ˜“çµŒãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ");try{this.initializeTripleOS(),await this.initializeMetaphorDatabase(),await this.setupGenerationRules(),await this.initializeContextAnalyzer(),this.initialized=!0,console.log("âœ… [MetaphorGenerationEngine] ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†")}catch(e){console.error("âŒ [MetaphorGenerationEngine] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:",e),this.activateSafeMode()}}initializeTripleOS(){console.log("ğŸ”§ [MetaphorGenerationEngine] Triple OS Architecture åˆæœŸåŒ–"),this.engineOS={name:"Metaphor Engine OS",version:"1.0.0",philosophy:"haqei-creative",async generateMetaphor(e,t={}){try{const a=this.extractEssenceElements(e),n=await this.generateCandidates(a,t),i=this.selectBestMetaphor(n,e);return{metaphor:await this.elaborateMetaphor(i,e),essence:a,confidence:this.calculateConfidence(i,e),philosophy:"haqei-metaphor"}}catch(a){return console.warn("âš ï¸ ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼ç”Ÿæˆã‚¨ãƒ©ãƒ¼ - åŸºæœ¬ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼ä½¿ç”¨:",a),this.generateBasicMetaphor(e)}},extractEssenceElements(e){return{energy:this.analyzeEnergy(e),movement:this.analyzeMovement(e),relationships:this.analyzeRelationships(e),transformation:this.analyzeTransformation(e),timeQuality:this.analyzeTimeQuality(e),spaceQuality:this.analyzeSpaceQuality(e)}},analyzeEnergy(e){const t=e.keywords||[];let a="balanced",n=.5;const i=["æ¿€ã—ã„","å¼·ã„","æ€¥æ¿€","çˆ†ç™º","ç‡ƒãˆã‚‹","ç†±ã„"],r=["é™ã‹","ç©ã‚„ã‹","ç·©ã‚„ã‹","å†·é™","è½ã¡ç€ã"],s=["å‹•ã","å¤‰åŒ–","æµã‚Œ","é€²ã‚€","ç™ºå±•"],o=["æ­¢ã¾ã‚‹","å®‰å®š","ç¶­æŒ","ä¿ã¤","å›ºå®š"],c=t.filter(e=>i.some(t=>e.includes(t))).length,h=t.filter(e=>r.some(t=>e.includes(t))).length,l=t.filter(e=>s.some(t=>e.includes(t))).length,p=t.filter(e=>o.some(t=>e.includes(t))).length;return c>h?(a=l>p?"high-dynamic":"high-static",n=Math.min(.7+.1*c,1)):h>c?(a=p>l?"low-static":"low-dynamic",n=Math.max(.3-.1*h,.1)):a="balanced",{type:a,intensity:n}},analyzeMovement(e){const t=e.keywords||[],a={};Object.entries({spiral:["èºæ—‹","å·»ã","å›ã‚‹","å¾ªç’°"],linear:["ç›´é€²","ä¸€ç›´ç·š","çœŸã£ç›´ã","ä¸€æ–¹å‘"],wave:["æ³¢","èµ·ä¼","ä¸Šä¸‹","æ³¢å‹•"],stillness:["é™æ­¢","å‹•ã‹ãªã„","å›ºå®š","å¤‰ã‚ã‚‰ãªã„"]}).forEach(([e,n])=>{a[e]=t.filter(e=>n.some(t=>e.includes(t))).length});const n=Object.entries(a).reduce((e,[t,a])=>a>e.count?{pattern:t,count:a}:e,{pattern:"balanced",count:0});return{type:n.pattern,intensity:n.count/t.length,direction:this.analyzeDirection(t)}},analyzeDirection(e){const t={};return Object.entries({upward:["ä¸Š","æ˜‡ã‚‹","å‘ä¸Š","æˆé•·","ç™ºå±•"],downward:["ä¸‹","é™ã‚Šã‚‹","ä½ä¸‹","æ¸›å°‘","æ²ˆã‚€"],inward:["å†…","ä¸­å¿ƒ","é›†ä¸­","å†…çœ","æ·±ã‚ã‚‹"],outward:["å¤–","æ‹¡å¤§","åºƒãŒã‚‹","å¤–å‘","å±•é–‹"]}).forEach(([a,n])=>{t[a]=e.filter(e=>n.some(t=>e.includes(t))).length}),Object.entries(t).reduce((e,[t,a])=>a>e.count?{dir:t,count:a}:e,{dir:"neutral",count:0}).dir},analyzeRelationships(e){const t=e.keywords||[],a={};return Object.entries({harmony:["èª¿å’Œ","å”åŠ›","åˆæ„","ä¸€è‡´","å”èª¿"],conflict:["å¯¾ç«‹","è¡çª","äº‰ã„","ç«¶äº‰","æ‘©æ“¦"],distance:["é›¢ã‚Œã‚‹","è·é›¢","å­¤ç«‹","åˆ†é›¢","ç‹¬ç«‹"],closeness:["è¿‘ã¥ã","è¦ªå¯†","çµåˆ","çµ±åˆ","èåˆ"]}).forEach(([e,n])=>{a[e]=t.filter(e=>n.some(t=>e.includes(t))).length/t.length}),a},analyzeTransformation(e){const t=e.keywords||[],a={};Object.entries({gradual:["å¾ã€…ã«","ã‚†ã£ãã‚Š","æ®µéšçš„","æ¼¸é€²"],sudden:["çªç„¶","æ€¥ã«","ä¸€æ°—ã«","ç¬é–“"],cyclical:["å¾ªç’°","ç¹°ã‚Šè¿”ã—","ã‚µã‚¤ã‚¯ãƒ«","å‘¨æœŸ"],irreversible:["ä¸å¯é€†","æˆ»ã‚‰ãªã„","æ°¸ç¶š","æ ¹æœ¬"]}).forEach(([e,n])=>{a[e]=t.filter(e=>n.some(t=>e.includes(t))).length});const n=Object.entries(a).reduce((e,[t,a])=>a>e.count?{type:t,count:a}:e,{type:"gradual",count:0});return{type:n.type,intensity:n.count/t.length,direction:this.getTransformationDirection(e)}},getTransformationDirection(e){const t=["è‰¯ã","æ”¹å–„","æˆé•·","ç™ºå±•","å‘ä¸Š"],a=["æ‚ªã","æ‚ªåŒ–","è¡°é€€","ä½ä¸‹","å¾Œé€€"],n=e.keywords||[],i=n.filter(e=>t.some(t=>e.includes(t))).length,r=n.filter(e=>a.some(t=>e.includes(t))).length;return i>r?"positive":r>i?"negative":"neutral"},analyzeTimeQuality(e){const t=e.keywords||[],a={};return Object.entries({kairos:["æ©Ÿä¼š","ã‚¿ã‚¤ãƒŸãƒ³ã‚°","æ™‚æ©Ÿ","å¥½æ©Ÿ"],chronos:["æœŸé™","ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«","æ™‚é–“","æœŸé–“"],eternal:["æ°¸é ","ç„¡é™","æ’ä¹…","ä¸å¤‰"],momentary:["ç¬é–“","ä¸€æ™‚","çŸ­æœŸ","åˆ¹é‚£"]}).forEach(([e,n])=>{a[e]=t.filter(e=>n.some(t=>e.includes(t))).length}),a},analyzeSpaceQuality(e){const t=e.keywords||[],a={};return Object.entries({expansive:["åºƒã„","å¤§ãã„","æ‹¡å¤§","ç„¡é™"],intimate:["ç‹­ã„","å°ã•ã„","å¯†æ¥","è¦ªå¯†"],structured:["æ•´ç†","ç§©åº","æ§‹é€ ","ä½“ç³»"],fluid:["æµå‹•","æŸ”è»Ÿ","å¤‰åŒ–","é©å¿œ"]}).forEach(([e,n])=>{a[e]=t.filter(e=>n.some(t=>e.includes(t))).length}),a},async generateCandidates(e,t){const a=[];return a.push(...this.generateNatureMetaphors(e)),a.push(...this.generateHumanActivityMetaphors(e)),a.push(...this.generateAbstractMetaphors(e)),a.push(...this.generateIChingMetaphors(e)),a},generateNatureMetaphors(e){const t=[],a=e.energy;"high-dynamic"===a.type&&(t.push({category:"nature",type:"weather",metaphor:"åµã®ä¸­ã‚’é€²ã‚€èˆ¹",essence:"turbulent_progress",imagery:"æ¿€ã—ã„é¢¨ã¨æ³¢ã®ä¸­ã§ã‚‚ç›®çš„åœ°ã«å‘ã‹ã†",wisdom:"å›°é›£ãªçŠ¶æ³ã‚‚é€²æ­©ã®æ©Ÿä¼šã¨ãªã‚‹"}),t.push({category:"nature",type:"fire",metaphor:"å±±ç«äº‹ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹æ–°ç·‘",essence:"destructive_renewal",imagery:"å¤ã„ã‚‚ã®ãŒç‡ƒãˆå°½ããŸå¾Œã«æ–°ã—ã„ç”Ÿå‘½ãŒèŠ½å¹ã",wisdom:"ç ´å£Šã¨å‰µé€ ã¯è¡¨è£ä¸€ä½“"})),"low-static"===a.type&&(t.push({category:"nature",type:"earth",metaphor:"æ·±ã„åœ°å±¤ã§è‚²ã¤é‰±ç‰©",essence:"slow_formation",imagery:"é•·ã„æ™‚é–“ã‚’ã‹ã‘ã¦ç¾ã—ã„çµæ™¶ãŒå½¢æˆã•ã‚Œã‚‹",wisdom:"æ™‚é–“ã‚’ã‹ã‘ã‚‹ã“ã¨ã§çœŸã®ä¾¡å€¤ãŒç”Ÿã¾ã‚Œã‚‹"}),t.push({category:"nature",type:"water",metaphor:"é™ã‹ãªæ·±ã„æ¹–",essence:"profound_stillness",imagery:"è¡¨é¢ã¯ç©ã‚„ã‹ã§ã‚‚æ·±éƒ¨ã«ã¯è±Šã‹ãªç”Ÿå‘½ãŒã‚ã‚‹",wisdom:"é™å¯‚ã®ä¸­ã«ç„¡é™ã®å¯èƒ½æ€§ãŒå®¿ã‚‹"}));const n=e.movement;return"spiral"===n.type&&t.push({category:"nature",type:"cosmic",metaphor:"éŠ€æ²³ã®èºæ—‹è…•",essence:"cosmic_evolution",imagery:"å·¨å¤§ãªæ¸¦ã®ä¸­ã§æ˜Ÿã€…ãŒç”Ÿã¾ã‚Œè‚²ã¤",wisdom:"æˆé•·ã¯èºæ—‹çŠ¶ã«é€²ã‚€"}),"wave"===n.type&&t.push({category:"nature",type:"ocean",metaphor:"æ½®ã®æº€ã¡å¼•ã",essence:"natural_rhythm",imagery:"çµ¶ãˆé–“ãªã„æ³¢ã®å‹•ããŒæµ·å²¸ã‚’å½¢ä½œã‚‹",wisdom:"è‡ªç„¶ã®ãƒªã‚ºãƒ ã«å¾“ã†ã“ã¨ã®é‡è¦æ€§"}),t},generateHumanActivityMetaphors(e){const t=[],a=e.relationships;a.harmony>.6&&t.push({category:"human",type:"music",metaphor:"ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ©ã®æ¼”å¥",essence:"harmonious_cooperation",imagery:"ç•°ãªã‚‹æ¥½å™¨ãŒä¸€ã¤ã®ç¾ã—ã„éŸ³æ¥½ã‚’å‰µé€ ã™ã‚‹",wisdom:"èª¿å’Œã¯å¤šæ§˜æ€§ã®ä¸­ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹"}),a.conflict>.6&&t.push({category:"human",type:"craft",metaphor:"é›å†¶å±‹ã®é‰„æ‰“ã¡",essence:"forging_through_conflict",imagery:"æ¿€ã—ã„æ‰“æ’ƒã«ã‚ˆã£ã¦é‡‘å±ãŒç¾ã—ã„å½¢ã«å¤‰ã‚ã‚‹",wisdom:"å¯¾ç«‹ã¯æˆé•·ã®æ©Ÿä¼š"});const n=e.transformation;return"gradual"===n.type&&t.push({category:"human",type:"art",metaphor:"é™¶èŠ¸å®¶ã®ä½œå“ã¥ãã‚Š",essence:"patient_shaping",imagery:"ã‚ãã‚ã®ä¸Šã§å°‘ã—ãšã¤å½¢ã‚’æ•´ãˆã¦ã„ã",wisdom:"å¿è€å¼·ã„åŠªåŠ›ãŒç¾ã‚’ç”Ÿã¿å‡ºã™"}),"sudden"===n.type&&t.push({category:"human",type:"discovery",metaphor:"ç™ºæ˜å®¶ã®ã²ã‚‰ã‚ã",essence:"breakthrough_moment",imagery:"é•·ã„è©¦è¡ŒéŒ¯èª¤ã®æœ«ã«çªç„¶è§£æ±ºç­–ãŒè¦‹ãˆã‚‹",wisdom:"æº–å‚™ã•ã‚ŒãŸå¿ƒã«æ´å¯ŸãŒè¨ªã‚Œã‚‹"}),t},generateAbstractMetaphors(e){const t=[],a=e.timeQuality;a.kairos>a.chronos&&t.push({category:"abstract",type:"opportunity",metaphor:"æ‰‰ãŒé–‹ãç¬é–“",essence:"perfect_timing",imagery:"ç„¡æ•°ã®æ‰‰ã®ä¸­ã§ä¸€ã¤ã ã‘ãŒå…‰ã£ã¦é–‹ã‹ã‚Œã‚‹",wisdom:"ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã™ã¹ã¦ã‚’æ±ºã‚ã‚‹"}),a.eternal>.3&&t.push({category:"abstract",type:"cycle",metaphor:"æ°¸é ã«å›ã‚‹å††ç’°",essence:"eternal_return",imagery:"å§‹ã¾ã‚Šã¨çµ‚ã‚ã‚ŠãŒä¸€ã¤ã«ãªã£ãŸå®Œå…¨ãªå††",wisdom:"ã™ã¹ã¦ã¯æ°¸é ã®å¾ªç’°ã®ä¸­ã«ã‚ã‚‹"});const n=e.spaceQuality;return n.expansive>n.intimate&&t.push({category:"abstract",type:"horizon",metaphor:"åœ°å¹³ç·šã®å½¼æ–¹",essence:"infinite_possibility",imagery:"ã©ã“ã¾ã§ã‚‚ç¶šãåºƒå¤§ãªæ™¯è‰²",wisdom:"å¯èƒ½æ€§ã¯ç„¡é™ã«åºƒãŒã£ã¦ã„ã‚‹"}),n.intimate>n.expansive&&t.push({category:"abstract",type:"essence",metaphor:"ç¨®ã®ä¸­ã®å¤§æ¨¹",essence:"concentrated_potential",imagery:"å°ã•ãªç¨®ã«å·¨å¤§ãªæœ¨ã®å¯èƒ½æ€§ãŒè¾¼ã‚ã‚‰ã‚Œã¦ã„ã‚‹",wisdom:"çœŸã®åŠ›ã¯æœ¬è³ªã«é›†ç´„ã•ã‚Œã‚‹"}),t},generateIChingMetaphors(e){const t=[];return t.push({category:"iching",type:"yinyang",metaphor:"é™°é™½ã®å¤ªæ¥µå›³",essence:"dynamic_balance",imagery:"å¯¾ç«‹ã™ã‚‹åŠ›ãŒå®Œç’§ãªèª¿å’Œã‚’ä¿ã¡ãªãŒã‚‰å›è»¢ã™ã‚‹",wisdom:"çŸ›ç›¾ã™ã‚‹è¦ç´ ã®çµ±åˆãŒçœŸã®èª¿å’Œã‚’ç”Ÿã‚€"}),"high-dynamic"===e.energy.type&&t.push({category:"iching",type:"five_elements",metaphor:"ç«ãŒæœ¨ã‚’åŠ©ã‘åœŸã‚’ç”Ÿã‚€",essence:"supportive_transformation",imagery:"è¦ç´ åŒå£«ãŒäº’ã„ã‚’æ”¯ãˆåˆã„ãªãŒã‚‰å¤‰åŒ–ã™ã‚‹",wisdom:"ç›¸äº’æ”¯æ´ã«ã‚ˆã‚Šå¤§ããªåŠ›ãŒç”Ÿã¾ã‚Œã‚‹"}),t.push({category:"iching",type:"bagua",metaphor:"å…«æ–¹ä½ã®ç¾…é‡ç›¤",essence:"directional_wisdom",imagery:"ã‚ã‚‰ã‚†ã‚‹æ–¹å‘ã¸ã®å¯èƒ½æ€§ã‚’ç¤ºã™ç¥è–ãªå›³å½¢",wisdom:"ã™ã¹ã¦ã®æ–¹å‘ã«é“ãŒã‚ã‚‹"}),t},selectBestMetaphor(e,t){if(0===e.length)return this.getDefaultMetaphor();return e.map(e=>({...e,score:this.scoreMetaphor(e,t)})).reduce((e,t)=>t.score>e.score?t:e)},scoreMetaphor(e,t){let a=.5;"nature"===e.category&&t.naturalAffinity>.6&&(a+=.2),"iching"===e.category&&t.philosophicalDepth>.7&&(a+=.3);const n=t.keywords||[],i=e.imagery.split(/\s+/);return a+=.1*n.filter(e=>i.some(t=>t.includes(e)||e.includes(t))).length,(e.essence.includes("integration")||e.essence.includes("harmony"))&&(a+=.15),Math.min(a,1)},async elaborateMetaphor(e,t){return{...e,applicationToSituation:this.applyToSituation(e,t),actionGuidance:this.generateActionGuidance(e,t),temporalUnfolding:this.generateTemporalUnfolding(e),deepMessage:this.extractDeepMessage(e,t),alternativePerspectives:this.generateAlternativePerspectives(e)}},applyToSituation(e,t){return{currentPhase:this.identifyCurrentPhase(e,t),keyElements:this.mapKeyElements(e,t),dynamics:this.describeDynamics(e,t)}},generateActionGuidance(e,t){const a=[];switch(e.essence){case"turbulent_progress":a.push("åµã®ä¸­ã§ã‚‚èˆµã‚’æ¡ã‚Šç¶šã‘ã‚‹"),a.push("ä¸€æ™‚çš„ãªé¿é›£æ¸¯ã‚’è¦‹ã¤ã‘ã‚‹"),a.push("å¤©å€™ã®å¤‰åŒ–ã‚’æ³¨æ„æ·±ãè¦³å¯Ÿã™ã‚‹");break;case"slow_formation":a.push("ç„¦ã‚‰ãšã«æ™‚é–“ã‚’ã‹ã‘ã‚‹"),a.push("å°ã•ãªå¤‰åŒ–ã‚’å¤§åˆ‡ã«ã™ã‚‹"),a.push("å†…å´ã§ã®æˆé•·ã«æ³¨ç›®ã™ã‚‹");break;case"harmonious_cooperation":a.push("ä»–è€…ã¨ã®èª¿å’Œã‚’é‡è¦–ã™ã‚‹"),a.push("å…¨ä½“ã®åˆ©ç›Šã‚’è€ƒãˆã‚‹"),a.push("è‡ªåˆ†ã®å½¹å‰²ã‚’æ˜ç¢ºã«ã™ã‚‹");break;default:a.push("ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼ã®æ™ºæ…§ã‚’æ—¥å¸¸ã«æ´»ã‹ã™"),a.push("è±¡å¾´çš„æ„å‘³ã‚’å®Ÿè·µçš„è¡Œå‹•ã«å¤‰æ›ã™ã‚‹")}return a},generateTemporalUnfolding:e=>({past:`${e.metaphor}ãŒå½¢æˆã•ã‚ŒãŸèƒŒæ™¯`,present:`ç¾åœ¨ã®${e.metaphor}ã®çŠ¶æ…‹`,future:`${e.metaphor}ãŒå‘ã‹ã†æ–¹å‘`}),extractDeepMessage:(e,t)=>({turbulent_progress:"å›°é›£ãªçŠ¶æ³ã“ããŒçœŸã®æˆé•·ã‚’ã‚‚ãŸã‚‰ã™",slow_formation:"æ™‚é–“ã¯æœ€ã‚‚å‰å¤§ãªå‰µé€ è€…ã§ã‚ã‚‹",harmonious_cooperation:"å€‹ã®å®Œæˆã¯å…¨ä½“ã®èª¿å’Œã®ä¸­ã«ã‚ã‚‹",dynamic_balance:"èª¿å’Œã®çµ±åˆã“ããŒçœŸã®æ™ºæ…§"}[e.essence]||`${e.metaphor}ã¯ã€ç”Ÿãã‚‹ã“ã¨ã®æ ¹æºçš„æ„å‘³ã‚’æ•™ãˆã¦ãã‚Œã‚‹`),generateAlternativePerspectives:e=>[`${e.metaphor}ã‚’é€†ã®è§’åº¦ã‹ã‚‰è¦‹ã‚‹ã¨...`,`ã‚‚ã—${e.metaphor}ãŒäººé–“ã ã£ãŸã‚‰...`,`${e.metaphor}ã®éš ã‚ŒãŸå´é¢ã¯...`],generateBasicMetaphor:e=>({category:"basic",type:"journey",metaphor:"äººç”Ÿã®æ—…è·¯",essence:"universal_journey",imagery:"å±±ã‚ã‚Šè°·ã‚ã‚Šã®é“ã‚’ä¸€æ­©ãšã¤é€²ã‚“ã§ã„ã",wisdom:"ã™ã¹ã¦ã®ä½“é¨“ãŒæˆé•·ã®ç³§ã¨ãªã‚‹",confidence:.5,philosophy:"haqei-basic"}),getDefaultMetaphor:()=>({category:"default",type:"river",metaphor:"å¤§æ²³ã®æµã‚Œ",essence:"natural_flow",imagery:"æºæµã‹ã‚‰æµ·ã¸ã¨å‘ã‹ã†å£®å¤§ãªæ—…",wisdom:"è‡ªç„¶ã®æµã‚Œã«èº«ã‚’ä»»ã›ã‚‹ã“ã¨ã®å¤§åˆ‡ã•"})},this.interfaceOS={name:"Metaphor Interface OS",formatMetaphorResult(e){return{display:{title:e.metaphor.metaphor,category:this.formatCategory(e.metaphor.category),imagery:e.metaphor.imagery,wisdom:e.metaphor.wisdom,essence:e.metaphor.essence,elaboration:this.formatElaboration(e.metaphor)},confidence:e.confidence,philosophy:e.philosophy}},formatCategory:e=>({nature:"ğŸŒ¿ è‡ªç„¶ç•Œ",human:"ğŸ‘¥ äººé–“æ´»å‹•",abstract:"ğŸ­ æŠ½è±¡æ¦‚å¿µ",iching:"â˜¯ï¸ æ˜“çµŒ",basic:"ğŸ›¤ï¸ åŸºæœ¬",default:"ğŸŒŠ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ"}[e]||e),formatElaboration:e=>e.applicationToSituation?{application:{title:"ç¾åœ¨ã®çŠ¶æ³ã¸ã®é©ç”¨",content:e.applicationToSituation},guidance:{title:"è¡Œå‹•æŒ‡é‡",actions:e.actionGuidance||[]},temporal:{title:"æ™‚é–“çš„å±•é–‹",content:e.temporalUnfolding},deepMessage:{title:"æ·±å±¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",content:e.deepMessage}}:null},this.safeMode={name:"Metaphor Safe Mode OS",active:!1,activate(){return console.log("ğŸ›¡ï¸ [MetaphorGenerationEngine] Safe Mode èµ·å‹•"),this.active=!0,{basicMetaphors:!0,fullElaboration:!1,philosophy:"haqei-safe"}},generateSafeMetaphor(e){const t=[{metaphor:"å­£ç¯€ã®å¤‰åŒ–",imagery:"æ˜¥å¤ç§‹å†¬ã®è‡ªç„¶ãªã‚µã‚¤ã‚¯ãƒ«",wisdom:"ã™ã¹ã¦ã«ã¯é©åˆ‡ãªæ™‚ãŒã‚ã‚‹"},{metaphor:"æœ¨ã®æˆé•·",imagery:"ç¨®ã‹ã‚‰å¤§æ¨¹ã¸ã¨è‚²ã¤éç¨‹",wisdom:"æ ¹ã‚’æ·±ãå¼µã‚‹ã“ã¨ã®å¤§åˆ‡ã•"},{metaphor:"å·ã®æµã‚Œ",imagery:"å±±ã‹ã‚‰æµ·ã¸ã®æ°´ã®æ—…",wisdom:"éšœå®³ã‚’ä¹—ã‚Šè¶Šãˆã¦é€²ã‚€åŠ›"}];return{metaphor:t[Math.floor(Math.random()*t.length)],confidence:.6,philosophy:"haqei-safe"}}},console.log("âœ… [MetaphorGenerationEngine] Triple OS Architecture æº–å‚™å®Œäº†")}async initializeMetaphorDatabase(){console.log("ğŸ“š [MetaphorGenerationEngine] ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–"),this.metaphorDatabase={naturalElements:this.createNaturalElementsDB(),humanActivities:this.createHumanActivitiesDB(),abstractConcepts:this.createAbstractConceptsDB(),ichingSymbols:this.createIChingSymbolsDB(),culturalArchetypes:this.createCulturalArchetypesDB()}}createNaturalElementsDB(){return{weather:["åµ","é›¨","è™¹","é¢¨","é›ª","é›·","éœ§","é›²"],water:["å·","æµ·","æ¹–","æ»","æ³‰","æ³¢","æ½®","æ°·"],earth:["å±±","è°·","å²©","åœŸ","ç ‚","æ´çªŸ","ä¸˜","å¹³åŸ"],fire:["ç‚","å¤ªé™½","æ˜Ÿ","ç¨²å¦»","å…‰","ç†±","ç‡ƒç„¼","ç¯"],plants:["æœ¨","èŠ±","è‰","æ£®","è‘‰","æ ¹","ç¨®","å®Ÿ"],animals:["é³¥","é­š","ç£","è™«","è¶","é·¹","äº€","é¾"]}}createHumanActivitiesDB(){return{crafts:["é™¶èŠ¸","ç¹”ç‰©","é›å†¶","æœ¨å·¥","çµµç”»","å½«åˆ»"],music:["æ¼”å¥","åˆå”±","ä½œæ›²","ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼","ãƒªã‚ºãƒ ","ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼"],sports:["ç™»å±±","èˆªæµ·","ç«¶èµ°","æ ¼é—˜","èˆè¸Š","ä½“æ“"],learning:["èª­æ›¸","ç ”ç©¶","ç™ºè¦‹","å®Ÿé¨“","æ•™è‚²","ç‘æƒ³"],social:["ä¼šè©±","å”åŠ›","ç«¶äº‰","æ”¯æ´","æŒ‡å°","å¾“é †"]}}createAbstractConceptsDB(){return{time:["æ°¸é ","ç¬é–“","å¾ªç’°","ç·šå½¢","éå»","æœªæ¥","ç¾åœ¨"],space:["ç„¡é™","å¢ƒç•Œ","ä¸­å¿ƒ","å‘¨ç¸","ä¸Šä¸‹","å†…å¤–","é è¿‘"],relation:["çµ±ä¸€","åˆ†é›¢","èª¿å’Œ","å¯¾ç«‹","åŒ…å«","æ’é™¤","å¹³è¡¡"],change:["é€²åŒ–","é©å‘½","æˆé•·","è¡°é€€","å¤‰èº«","å¾©æ´»","å¾ªç’°"]}}createIChingSymbolsDB(){return{trigrams:["ä¹¾","å¤","éœ‡","å·½","å","é›¢","è‰®","å…Œ"],concepts:["é™°é™½","å¤ªæ¥µ","ç„¡æ¥µ","é“","å¾·","æ°—","ç†","è±¡"],patterns:["èºæ—‹","å††ç’°","æ³¢å‹•","è„ˆå‹•","å…±é³´","åéŸ¿","å¾ªç’°"]}}createCulturalArchetypesDB(){return{roles:["è³¢è€…","æˆ¦å£«","æ²»ç™‚è€…","å‰µé€ è€…","æ¡ˆå†…è€…","ä¿è­·è€…"],journeys:["å†’é™º","å¸°é‚„","æ¢æ±‚","è©¦ç·´","å¤‰èº«","è¦šé†’"],relationships:["å¸«å¼Ÿ","å‹æƒ…","æ‹æ„›","è¦ªå­","å…„å¼Ÿ","æ•µå¯¾"]}}async setupGenerationRules(){console.log("ğŸ“‹ [MetaphorGenerationEngine] ç”Ÿæˆãƒ«ãƒ¼ãƒ«è¨­å®š"),this.generationRules={contextMapping:{emotional:{anger:["fire","thunder","storm"],sadness:["water","autumn","descent"],joy:["light","spring","flight"],fear:["darkness","cave","maze"],love:["warmth","garden","embrace"]},situational:{beginning:["dawn","seed","birth"],progress:["journey","growth","building"],obstacle:["mountain","storm","labyrinth"],completion:["harvest","sunset","circle"],transformation:["butterfly","fire","alchemy"]},relational:{harmony:["orchestra","dance","ecosystem"],conflict:["battle","forge","earthquake"],separation:["island","winter","exile"],union:["river_meeting","wedding","synthesis"]}},elaborationPatterns:{temporal:["past_formation","present_state","future_direction"],spatial:["center_essence","boundary_limits","surrounding_context"],dynamic:["static_foundation","moving_forces","transformation_potential"]},wisdomExtraction:{practical:"å®Ÿè·µçš„ãªè¡Œå‹•æŒ‡é‡",philosophical:"äººç”Ÿã®æ·±ã„æ´å¯Ÿ",spiritual:"é­‚ã®æˆé•·ã¸ã®é“",social:"äººé–“é–¢ä¿‚ã®æ™ºæ…§"}}}async initializeContextAnalyzer(){console.log("ğŸ” [MetaphorGenerationEngine] ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ†æå™¨åˆæœŸåŒ–"),this.contextAnalyzer={analyzeEmotionalTone:e=>{const t={},a=e.keywords||[];return Object.entries({joy:["å¬‰ã—ã„","æ¥½ã—ã„","å¹¸ã›","å–œã³"],sadness:["æ‚²ã—ã„","å¯‚ã—ã„","è¾›ã„","è‹¦ã—ã„"],anger:["æ€’ã‚Š","è…¹ç«‹ã¤","æ†¤ã‚Š","ã‚¤ãƒ©ã‚¤ãƒ©"],fear:["ä¸å®‰","ææ€–","å¿ƒé…","æ€–ã„"],love:["æ„›","å¥½ã","å¤§åˆ‡","æ„›æƒ…"]}).forEach(([e,n])=>{t[e]=a.filter(e=>n.some(t=>e.includes(t))).length}),t},identifyArchetype:e=>{const t={},a=e.keywords||[];return Object.entries({hero:["å‹‡æ°—","å†’é™º","æŒ‘æˆ¦","æˆ¦ã„"],sage:["çŸ¥æµ","å­¦ç¿’","ç†è§£","æ´å¯Ÿ"],caregiver:["ä¸–è©±","ä¿è­·","æ”¯æ´","æ„›æƒ…"],creator:["å‰µé€ ","èŠ¸è¡“","ä½œå“","è¡¨ç¾"],explorer:["æ¢æ±‚","ç™ºè¦‹","æ—…","æœªçŸ¥"]}).forEach(([e,n])=>{t[e]=a.filter(e=>n.some(t=>e.includes(t))).length}),t}}}activateSafeMode(){console.log("ğŸ›¡ï¸ [MetaphorGenerationEngine] Safe Mode èµ·å‹•"),this.safeMode.activate(),this.initialized=!0}async generateMetaphorForSituation(e,t={}){this.initialized||await this.init();try{if(this.safeMode.active)return this.safeMode.generateSafeMetaphor(e);const a=await this.engineOS.generateMetaphor(e,t);return this.interfaceOS.formatMetaphorResult(a)}catch(a){return console.error("âŒ [MetaphorGenerationEngine] ãƒ¡ã‚¿ãƒ•ã‚¡ãƒ¼ç”Ÿæˆã‚¨ãƒ©ãƒ¼:",a),this.safeMode.generateSafeMetaphor(e)}}getStatus(){return{initialized:this.initialized,safeModeActive:this.safeMode?.active||!1,databaseReady:!!this.metaphorDatabase,rulesReady:!!this.generationRules,analyzerReady:!!this.contextAnalyzer,philosophy:"haqei",architecture:"triple-os"}}}"undefined"!=typeof window&&(window.MetaphorGenerationEngine=new MetaphorGenerationEngine),console.log("âœ… [MetaphorGenerationEngine] HaQei Philosophy Implementation Loaded");