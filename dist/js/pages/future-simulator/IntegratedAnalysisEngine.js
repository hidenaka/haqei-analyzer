console.log("🔬 IntegratedAnalysisEngine Loading..."),window.IntegratedAnalysisEngine={init(){console.log("🔧 IntegratedAnalysisEngine initializing..."),this.setupTripleOS(),this.initializeAnalysisFrameworks(),this.loadKnowledgeBase(),console.log("✅ IntegratedAnalysisEngine initialized successfully")},setupTripleOS(){this.engineOS={name:"Integrated Analysis Engine OS",version:"1.0.0",philosophy:"haqei-integration",async performIntegratedAnalysis(e,t={}){try{const a=this.preprocessData(e),i=await this.performDimensionalAnalysis(a,t),s=await this.performSemanticAnalysis(a,t),n=await this.performPatternAnalysis(a,t),o=await this.performContextualAnalysis(a,t),r=await this.performIChingAnalysis(a,t),l=this.integrateAnalysisResults({dimensional:i,semantic:s,pattern:n,contextual:o,iching:r}),c=this.extractInsights(l,t);return{dataPoints:a,analyses:{dimensional:i,semantic:s,pattern:n,contextual:o,iching:r},integrated:l,insights:c,recommendations:this.generateRecommendations(l,c,t),metadata:{analysisDepth:this.calculateAnalysisDepth(l),confidenceScore:this.calculateConfidenceScore(l),complexityLevel:this.calculateComplexityLevel(e),philosophy:"haqei-integrated"}}}catch(a){return console.warn("⚠️ Integrated analysis error:",a),this.createFallbackAnalysis(e)}},preprocessData(e){const t=e.map(e=>{const t=this.normalizeDataPoint(e),a=this.enrichDataPoint(t),i=this.validateDataPoint(a);return{...i,id:this.generatePointId(i),timestamp:t.timestamp||(new Date).toISOString(),weight:this.calculatePointWeight(i)}});return this.filterValidPoints(t)},normalizeDataPoint(e){const t={...e};return t.text&&(t.text=t.text.trim(),t.wordCount=t.text.split(/\s+/).length,t.characterCount=t.text.length),void 0!==t.value&&(t.normalizedValue=this.normalizeValue(t.value)),t.category&&(t.categoryNormalized=this.normalizeCategory(t.category)),t},enrichDataPoint(e){const t={...e};return t.text&&(t.semantic=this.extractSemanticFeatures(t.text),t.entities=this.extractEntities(t.text),t.sentiment=this.analyzeSentiment(t.text)),t.timestamp&&(t.temporal=this.extractTemporalFeatures(t.timestamp)),t.relations=this.identifyRelations(t),t},async performDimensionalAnalysis(e,t){const a={temporal:this.analyzeTemporal(e),spatial:this.analyzeSpatial(e),semantic:this.analyzeSemanticDimension(e),emotional:this.analyzeEmotional(e),complexity:this.analyzeComplexity(e),relationship:this.analyzeRelationships(e)},i=this.calculateDimensionalCorrelations(a);return{dimensions:a,correlations:i,patterns:this.identifyDimensionalPatterns(a,i),dimensionality:Object.keys(a).length,strength:this.calculateDimensionalStrength(a)}},async performSemanticAnalysis(e,t){const a=e.map(e=>this.extractSemanticFeatures(e.text||"")),i=this.extractConcepts(a),s=this.identifyThemes(i),n=this.deriveMeanings(s,t);return{concepts:i,themes:s,meanings:n,relationships:this.mapSemanticRelationships(i),semanticDensity:this.calculateSemanticDensity(i),meaningDepth:this.calculateMeaningDepth(n)}},async performPatternAnalysis(e,t){const a={sequences:this.identifySequences(e),cycles:this.detectCycles(e),trends:this.analyzeTrends(e),anomalies:this.detectAnomalies(e),clusters:this.performClustering(e)};return{patterns:a,patternStrength:this.calculatePatternStrength(a),predictability:this.assessPredictability(a),stability:this.assessStability(a)}},async performContextualAnalysis(e,t){const a={situational:this.analyzeSituationalContext(e,t),environmental:this.analyzeEnvironmentalContext(e,t),temporal:this.analyzeTemporalContext(e,t),social:this.analyzeSocialContext(e,t)};return{factors:a,influences:this.assessContextualInfluences(a),dependencies:this.identifyContextualDependencies(a),contextualRelevance:this.calculateContextualRelevance(a),adaptability:this.assessAdaptability(a)}},async performIChingAnalysis(e,t){const a=this.mapToHexagrams(e),i=this.analyzeTrigramsFromData(e),s=this.identifyChangePatterns(e),n=this.assessYinYangBalance(e);return{hexagrams:a,trigrams:i,changes:s,balance:n,wisdom:this.extractIChingWisdom(a,s),guidance:this.generateIChingGuidance(i,n),philosophicalAlignment:this.assessPhilosophicalAlignment(e)}},integrateAnalysisResults(e){const t={overallScore:this.calculateWeightedScore(e,{dimensional:.25,semantic:.25,pattern:.2,contextual:.15,iching:.15}),coherence:this.assessCoherence(e),complexity:this.assessIntegratedComplexity(e),reliability:this.assessReliability(e),actionability:this.assessActionability(e)};return t.crossInsights=this.generateCrossInsights(e),t.synergies=this.identifySynergies(e),t.tensions=this.identifyTensions(e),t},extractInsights(e,t){const a=[],i=this.extractPrimaryInsights(e);a.push(...i);const s=this.discoverHiddenInsights(e);a.push(...s);const n=this.extractContextualInsights(e,t);a.push(...n);const o=this.extractPhilosophicalInsights(e);return a.push(...o),this.prioritizeInsights(a)},generateRecommendations(e,t,a){const i=[];t.forEach(e=>{const t=this.generateInsightBasedRecommendations(e,a);i.push(...t)});const s=this.generatePatternBasedRecommendations(e,a);i.push(...s);const n=this.generateIChingBasedRecommendations(e,a);return i.push(...n),this.prioritizeRecommendations(i)}},this.interfaceOS={name:"Integrated Analysis Interface OS",formatAnalysisResult(e){return{summary:this.createAnalysisSummary(e),detailed:this.createDetailedReport(e),visualizations:this.generateVisualizationSpecs(e),insights:this.formatInsights(e.insights),recommendations:this.formatRecommendations(e.recommendations),philosophy:e.metadata.philosophy}},createAnalysisSummary(e){return{title:"HaQei統合分析レポート",overview:{dataPoints:e.dataPoints.length,analysisDepth:e.metadata.analysisDepth,confidence:this.formatPercentage(e.metadata.confidenceScore),complexity:this.formatComplexity(e.metadata.complexityLevel)},keyFindings:this.extractKeyFindings(e),topInsights:e.insights.slice(0,3),urgentRecommendations:e.recommendations.filter(e=>"high"===e.urgency).slice(0,2)}},createDetailedReport(e){return{analyses:{dimensional:this.formatDimensionalAnalysis(e.analyses.dimensional),semantic:this.formatSemanticAnalysis(e.analyses.semantic),pattern:this.formatPatternAnalysis(e.analyses.pattern),contextual:this.formatContextualAnalysis(e.analyses.contextual),iching:this.formatIChingAnalysis(e.analyses.iching)},integration:this.formatIntegratedResults(e.integrated),methodology:this.describeMethodology(),limitations:this.describeLimitations()}},generateVisualizationSpecs(e){return{dimensionalRadar:this.createDimensionalRadarSpec(e.analyses.dimensional),semanticNetwork:this.createSemanticNetworkSpec(e.analyses.semantic),patternTimeline:this.createPatternTimelineSpec(e.analyses.pattern),ichingWheel:this.createIChingWheelSpec(e.analyses.iching),insightMatrix:this.createInsightMatrixSpec(e.insights)}}},this.safeMode={name:"Integrated Analysis Safe Mode OS",active:!1,activate(){return console.log("🛡️ IntegratedAnalysisEngine Safe Mode activated"),this.active=!0,{basicAnalysis:!0,advancedFeatures:!1,philosophy:"haqei-safe"}},performBasicAnalysis(e){return{...{summary:{count:e.length,types:this.identifyDataTypes(e),quality:"basic"},simpleInsights:this.extractSimpleInsights(e),basicRecommendations:this.generateBasicRecommendations(e)},metadata:{analysisDepth:.3,confidenceScore:.5,complexityLevel:.4,philosophy:"haqei-safe"}}}}},initializeAnalysisFrameworks(){this.analysisFrameworks={dimensional:this.createDimensionalFramework(),semantic:this.createSemanticFramework(),pattern:this.createPatternFramework(),contextual:this.createContextualFramework(),iching:this.createIChingFramework()}},createDimensionalFramework:()=>({dimensions:["temporal","spatial","semantic","emotional","complexity","relationship"],analysisMethod:"multidimensional_scaling",correlationThreshold:.5,patternDetectionSensitivity:.7}),createSemanticFramework:()=>({conceptExtractionMethod:"tf_idf_enhanced",themeIdentificationThreshold:.6,meaningDerivationDepth:3,relationshipMappingStrength:.5}),createPatternFramework:()=>({sequenceMinLength:3,cycleDetectionWindow:10,trendAnalysisWindow:20,anomalyThreshold:2,clusteringMethod:"hierarchical"}),createContextualFramework:()=>({contextTypes:["situational","environmental","temporal","social"],influenceAssessmentMethod:"weighted_impact",dependencyAnalysisDepth:2,adaptabilityMetrics:["flexibility","resilience","responsiveness"]}),createIChingFramework:()=>({hexagramMappingMethod:"semantic_trigram_analysis",changePatternDetection:"yin_yang_transitions",balanceAssessmentCriteria:["harmony","flow","transformation"],wisdomExtractionDepth:"philosophical_essence"}),loadKnowledgeBase(){try{console.log("📚 Loading knowledge base..."),this.knowledgeBase={concepts:this.safeLoadDatabase("loadConceptDatabase"),patterns:this.safeLoadDatabase("loadPatternDatabase"),contexts:this.safeLoadDatabase("loadContextDatabase"),iching:this.safeLoadDatabase("loadIChingDatabase")},console.log("✅ Knowledge base loaded successfully")}catch(e){console.error("❌ Knowledge base loading error:",e),this.knowledgeBase={concepts:{},patterns:{},contexts:{},iching:{}}}},safeLoadDatabase(e){try{const t=this[e];if("function"==typeof t){const a=t.call(this);return console.log(`✅ ${e} loaded successfully`),a}return console.warn(`⚠️ Method ${e} not available, using fallback`),{}}catch(t){return console.error(`❌ Error calling ${e}:`,t.message),{}}},extractSemanticFeatures(e){return{keywords:this.extractKeywords(e),phrases:this.extractPhrases(e),entities:this.extractNamedEntities(e),concepts:this.extractConcepts(e),relations:this.extractRelations(e)}},analyzeSentiment(e){const t=["良い","嬉しい","成功","達成","満足"].reduce((t,a)=>t+(e.includes(a)?1:0),0),a=["悪い","悲しい","失敗","困難","不安"].reduce((t,a)=>t+(e.includes(a)?1:0),0),i=e.split(/\s+/).length,s=t/i,n=a/i;return{positive:s,negative:n,neutral:1-s-n,overall:s-n}},mapToHexagrams(e){const t=[];return e.forEach(e=>{const a=this.determineHexagramFromDataPoint(e);t.push({dataPoint:e.id,hexagram:a,confidence:this.calculateHexagramConfidence(e,a),reasoning:this.explainHexagramMapping(e,a)})}),t},determineHexagramFromDataPoint(e){const t=this.analyzeDataPointCharacteristics(e);return"high"===t.energy&&"upward"===t.direction?"乾":"low"===t.energy&&"high"===t.stability?"坤":"sudden"===t.change&&"high"===t.impact?"震":"smooth"===t.flow&&"high"===t.adaptability?"巽":"既済"},async performIntegratedAnalysis(e,t={}){this.engineOS||await this.init();try{if(this.safeMode.active)return this.safeMode.performBasicAnalysis(e);const a=await this.engineOS.performIntegratedAnalysis(e,t);return this.interfaceOS.formatAnalysisResult(a)}catch(a){return console.error("❌ Integrated analysis failed:",a),this.safeMode.activate(),this.safeMode.performBasicAnalysis(e)}},getAnalysisCapabilities(){const e=["basic_analysis","data_preprocessing"];return this.analysisFrameworks&&e.push("dimensional_analysis","semantic_analysis","pattern_recognition"),this.knowledgeBase&&e.push("contextual_analysis","iching_integration","wisdom_extraction"),this.safeMode.active||e.push("cross_analysis","insight_generation","recommendation_engine"),e},loadConceptDatabase:()=>({entities:["person","organization","location","event"],concepts:["success","failure","growth","change","harmony"],relationships:["cause-effect","correlation","similarity","opposition"],attributes:["positive","negative","neutral","complex"]}),loadPatternDatabase:()=>({linguistic:["noun_patterns","verb_patterns","emotion_patterns"],semantic:["topic_patterns","theme_patterns","meaning_patterns"],contextual:["situation_patterns","response_patterns","outcome_patterns"]}),loadContextDatabase:()=>({domains:["work","personal","relationships","health","finance"],scenarios:["decision","problem","opportunity","conflict"],environments:["formal","informal","stressful","supportive"]}),loadIChingDatabase:()=>({hexagrams:window.H64_DATA||[],trigrams:["乾","兌","離","震","巽","坎","艮","坤"],elements:["木","火","土","金","水"],principles:["陰","陽","五行","八卦","六十四卦"]})},document.addEventListener("DOMContentLoaded",()=>{window.IntegratedAnalysisEngine.init()}),console.log("✅ IntegratedAnalysisEngine loaded successfully with HaQei Philosophy");