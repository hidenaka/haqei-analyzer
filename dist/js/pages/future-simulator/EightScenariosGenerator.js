class EightScenariosGenerator{constructor(){this.initialized=!1,this.version="2.1.0-emergency-fix",this.philosophyAlignment="haqei-eight-scenarios-integration",this.scenarioCount=8,this.scenarioTemplate=this.initializeScenarioTemplate(),this.HaQeiElements={contradictionAcceptance:!0,personaSwitching:!0,situationalAdaptation:!0,ichingIntegration:!0},this.ichingMapping=new Map,this.initializeIChingMapping(),this.scenarioCache=new Map,this.cacheTimeout=18e5,console.log("🎯 EightScenariosGenerator v2.1.0 initialized - HaQei統合8シナリオ生成システム"),this.initialized=!0}async generateEightScenarios(e,i=null){try{if(console.log("🎯 Generating 8 scenarios from analysis context"),!e||!e.inputText)throw new Error("Analysis context with inputText is required");const t=this.generateCacheKey(e),n=this.scenarioCache.get(t);if(n&&Date.now()-n.timestamp<this.cacheTimeout)return console.log("📋 Returning cached scenarios"),n.scenarios;const a=performance.now(),r=this.analyzeInputText(e.inputText),o=this.mapToSituationalHexagram(r),c=this.generateBasePatterns(r,o),s=i?this.integrateBinaryTreeData(c,i):c,l=this.buildScenarios(s,e),p=this.enhanceScenarios(l,r),h=this.validateContradictionAcceptance(p),d=performance.now()-a;return this.scenarioCache.set(t,{scenarios:h,timestamp:Date.now()}),console.log(`✅ Eight scenarios generated: ${h.length} scenarios in ${Math.round(d)}ms`),h}catch(t){return console.error("❌ Error in generateEightScenarios:",t),this.generateFallbackScenarios(e)}}analyzeInputText(e){const i={originalText:e,wordCount:e.length,emotionalTone:this.detectEmotionalTone(e),keyThemes:this.extractKeyThemes(e),situationType:this.classifySituationType(e),urgencyLevel:this.assessUrgencyLevel(e),complexityLevel:this.assessComplexityLevel(e)};return console.log("📝 Text analysis completed:",i.keyThemes),i}mapToSituationalHexagram(e){const i=this.calculateOptimalHexagram(e),t=this.getHexagramData(i);return{number:i,name:t.name||`第${i}卦`,keywords:t.keywords||["変化","選択","発展"],situation:t.situation||"転換期の状況",guidance:t.guidance||"慎重な判断が必要"}}generateBasePatterns(e,i){return[{id:1,direction:"forward_active",title:"積極的前進",description:"現在の方向性を強化し、積極的に前進する",approach:"proactive",energy:"yang",iching_principle:"乾為天 - 創造と行動"},{id:2,direction:"forward_adaptive",title:"適応的前進",description:"状況に適応しながら着実に前進する",approach:"adaptive",energy:"balanced",iching_principle:"坤為地 - 受容と発展"},{id:3,direction:"transform_gradual",title:"段階的変革",description:"段階的に変化を起こし、新しい方向性を模索する",approach:"transformative",energy:"yin-to-yang",iching_principle:"漸 - 段階的発展"},{id:4,direction:"transform_decisive",title:"決断的変革",description:"大胆な決断により根本的な変革を起こす",approach:"decisive",energy:"yang-strong",iching_principle:"革 - 革新と変革"},{id:5,direction:"stabilize_strengthen",title:"強化安定化",description:"現在の良い要素を強化し、安定化を図る",approach:"strengthening",energy:"stable-yang",iching_principle:"大壮 - 力強い安定"},{id:6,direction:"stabilize_harmonize",title:"調和安定化",description:"要素間の調和を重視し、平和的な安定を目指す",approach:"harmonizing",energy:"stable-yin",iching_principle:"泰 - 平和と調和"},{id:7,direction:"integrate_synthesis",title:"統合的発展",description:"異なる要素を統合し、新しい可能性を創造する",approach:"integrative",energy:"synthesis",iching_principle:"既済 - 完成と統合"},{id:8,direction:"explore_innovative",title:"革新的探索",description:"従来にない新しいアプローチを探索する",approach:"innovative",energy:"creative",iching_principle:"未済 - 無限の可能性"}].map(t=>({...t,relevanceScore:this.calculateRelevanceScore(t,e,i),contextualAdjustment:this.applyContextualAdjustment(t,e)}))}integrateBinaryTreeData(e,i){return i&&i.finalEightPaths?e.map((e,t)=>{const n=i.finalEightPaths[t];return n?{...e,binaryTreeIntegration:{pathIndex:n.pathIndex,route:n.route,probability:n.probability,timeline:n.timeline,successFactors:n.success_factors,challenges:n.potential_challenges},enhancedDescription:this.mergeDescriptions(e.description,n.fullDescription),confidence:Math.min(e.relevanceScore+n.probability,1)}:e}):e}buildScenarios(e,i){return e.map((e,t)=>({scenarioId:`scenario_${e.id}`,scenarioIndex:t+1,title:e.title,description:e.enhancedDescription||e.description,HaQeiElements:{contradictionAcceptance:{principle:`${e.title}は他の道と矛盾しない独立した選択肢`,application:"状況や分人の状態により最適性が変化する"},personaApplication:{primaryPersona:this.identifyPrimaryPersona(e,i),secondaryPersona:this.identifySecondaryPersona(e,i),dynamicSwitch:`状況により${this.identifyPrimaryPersona(e,i)}から${this.identifySecondaryPersona(e,i)}への切り替えが有効`},situationalAdaptation:{optimalConditions:this.identifyOptimalConditions(e),adaptationStrategy:this.generateAdaptationStrategy(e)}},practicalElements:{actionSteps:this.generateActionSteps(e),timeframe:e.binaryTreeIntegration?.timeline||this.estimateTimeframe(e),successIndicators:this.generateSuccessIndicators(e),riskFactors:e.binaryTreeIntegration?.challenges||this.identifyRiskFactors(e)},ichingIntegration:{principle:e.iching_principle,modernApplication:this.generateModernApplication(e),guidance:this.generateIChingGuidance(e)},metadata:{relevanceScore:e.relevanceScore,confidence:e.confidence||e.relevanceScore,energyType:e.energy,approach:e.approach,generatedAt:(new Date).toISOString()}}))}enhanceScenarios(e,i){return e.map(t=>({...t,qualityEnhancements:{specificityLevel:this.calculateSpecificity(t,i),practicalityScore:this.calculatePracticality(t),uniquenessIndex:this.calculateUniqueness(t,e)},customization:{personalizedTitle:this.personalizeTitle(t,i),contextualDescription:this.contextualizeDescription(t,i),tailoredGuidance:this.tailorGuidance(t,i)},visualization:{color:this.assignScenarioColor(t),icon:this.assignScenarioIcon(t),priority:this.calculatePriority(t,e)}}))}validateContradictionAcceptance(e){const i=e.map(i=>({...i,contradictionValidation:{isValid:!0,complementaryScenarios:this.findComplementaryScenarios(i,e),dialecticalTension:this.calculateDialecticalTension(i,e),resolutionGuidance:this.generateResolutionGuidance(i,e)}}));return console.log("✅ Contradiction acceptance validation completed"),i}initializeScenarioTemplate(){return{minScenarios:8,maxScenarios:8,requiredElements:["title","description","HaQeiElements","practicalElements","ichingIntegration"]}}initializeIChingMapping(){for(let e=1;e<=64;e++)this.ichingMapping.set(e,{number:e,name:`第${e}卦`,keywords:["変化","発展","調和"],guidance:"状況に応じた適切な判断"})}generateCacheKey(e){return`eight_scenarios_${JSON.stringify(e).slice(0,100)}`.replace(/\s+/g,"_")}detectEmotionalTone(e){const i=["良い","素晴らしい","成功","喜び","希望"].reduce((i,t)=>i+(e.includes(t)?1:0),0),t=["悪い","困難","問題","心配","不安"].reduce((i,t)=>i+(e.includes(t)?1:0),0);return i>t?"positive":t>i?"negative":"neutral"}extractKeyThemes(e){const i=[];return Object.entries({"仕事":["仕事","職場","会社","業務","キャリア"],"人間関係":["人間関係","友人","家族","恋人","同僚"],"健康":["健康","病気","体調","医療","運動"],"学習":["学習","勉強","教育","成長","スキル"],"財務":["お金","財務","投資","収入","支出"]}).forEach(([t,n])=>{n.some(i=>e.includes(i))&&i.push(t)}),i.length>0?i:["一般"]}classifySituationType(e){return e.includes("問題")||e.includes("困難")?"problem-solving":e.includes("選択")||e.includes("決断")?"decision-making":e.includes("目標")||e.includes("計画")?"goal-setting":e.includes("関係")||e.includes("コミュニケーション")?"relationship":"general-guidance"}assessUrgencyLevel(e){return["緊急","急ぎ","今すぐ","至急"].some(i=>e.includes(i))?"high":"medium"}assessComplexityLevel(e){return e.length>200?"high":e.length>100?"medium":"low"}calculateOptimalHexagram(e){let i=1;return"positive"===e.emotionalTone&&(i+=20),"negative"===e.emotionalTone&&(i+=40),"decision-making"===e.situationType&&(i+=10),"high"===e.urgencyLevel&&(i+=5),Math.min(i%64+1,64)}getHexagramData(e){if("undefined"!=typeof window&&window.H384_DATA){const i=window.H384_DATA.filter(i=>i["卦番号"]===e)[0];if(i)return{name:i["卦名"],keywords:i["キーワード"]?[i["キーワード"]]:["変化"],situation:i["現代解釈の要約"]||"状況の転換期",guidance:"慎重な判断と適切な行動"}}return{name:`第${e}卦`,keywords:["変化","発展"],situation:"変化の時期",guidance:"状況を注意深く観察し、適切に行動する"}}calculateRelevanceScore(e,i,t){let n=.5;return i.keyThemes.includes("仕事")&&"proactive"===e.approach&&(n+=.2),"negative"===i.emotionalTone&&"transformative"===e.approach&&(n+=.2),"high"===i.urgencyLevel&&"decisive"===e.approach&&(n+=.1),Math.min(n,1)}applyContextualAdjustment(e,i){return{themeAlignment:i.keyThemes,emotionalResonance:i.emotionalTone,situationalFit:i.situationType}}mergeDescriptions(e,i){return`${e}。${i||""}`}identifyPrimaryPersona(e,i){return{proactive:"積極行動分人",adaptive:"適応調整分人",transformative:"変革推進分人",decisive:"決断実行分人",strengthening:"強化発展分人",harmonizing:"調和維持分人",integrative:"統合創造分人",innovative:"革新探索分人"}[e.approach]||"一般判断分人"}identifySecondaryPersona(e,i){return{"積極行動分人":"慎重検討分人","適応調整分人":"積極行動分人","変革推進分人":"安定維持分人","決断実行分人":"熟考分析分人","強化発展分人":"調和維持分人","調和維持分人":"強化発展分人","統合創造分人":"専門集中分人","革新探索分人":"実践重視分人"}[this.identifyPrimaryPersona(e,i)]||"補完的分人"}identifyOptimalConditions(e){return{proactive:["明確な目標設定時","環境が安定している時","リソースが十分な時"],adaptive:["環境が変化している時","不確実性が高い時","柔軟性が求められる時"],transformative:["現状に限界を感じる時","新しい可能性を模索する時"],decisive:["迅速な判断が求められる時","機会が限定的な時"],strengthening:["基盤が安定している時","持続的成長を目指す時"],harmonizing:["対立や摩擦がある時","バランスが必要な時"],integrative:["複数の要素を統合する時","新しい価値を創造する時"],innovative:["従来の方法に限界を感じる時","創造性が求められる時"]}[e.approach]||["一般的な状況において"]}generateAdaptationStrategy(e){return`${e.title}を基本方針として、状況変化に応じて${this.identifySecondaryPersona(e,{})}による調整を実行`}generateActionSteps(e){return["現状分析と目標設定","具体的行動計画の策定","段階的実行と進捗確認","成果評価と必要な調整"].map(i=>`${e.title}において：${i}`)}estimateTimeframe(e){return{proactive:"1-3ヶ月",adaptive:"3-6ヶ月",transformative:"6-12ヶ月",decisive:"1-2ヶ月",strengthening:"3-9ヶ月",harmonizing:"2-6ヶ月",integrative:"6-18ヶ月",innovative:"12-24ヶ月"}[e.approach]||"3-6ヶ月"}generateSuccessIndicators(e){return[`${e.title}に関連する具体的成果の達成`,"関係者からの肯定的なフィードバック","個人的満足度と成長の実感","継続可能な改善サイクルの確立"]}identifyRiskFactors(e){return["外部環境の予期しない変化","リソース不足や制約の発生","関係者の理解や協力の不足","計画の複雑性による実行困難"]}generateModernApplication(e){return`現代社会における${e.title}の実践: ${e.description}を具体的行動に落とし込み、持続可能な形で実行する`}generateIChingGuidance(e){return`${e.iching_principle}の教えに基づき、${e.title}を実践する際は状況の変化を注意深く観察し、適切なタイミングで行動する`}calculateSpecificity(e,i){return.2*i.keyThemes.length+.1*e.practicalElements.actionSteps.length}calculatePracticality(e){return e.practicalElements.actionSteps.length>3?.8:.6}calculateUniqueness(e,i){return.7+("innovative"===e.metadata.approach?.2:0)}personalizeTitle(e,i){return`${e.title} (${i.keyThemes.join("・")}重視)`}contextualizeDescription(e,i){return`${i.keyThemes.join("・")}の文脈における${e.description}`}tailorGuidance(e,i){return`${"negative"===i.emotionalTone?"困難な状況から":"現在の状況を活かして"}、${e.ichingIntegration.guidance}`}assignScenarioColor(e){return{proactive:"#4CAF50",adaptive:"#2196F3",transformative:"#FF9800",decisive:"#F44336",strengthening:"#9C27B0",harmonizing:"#00BCD4",integrative:"#795548",innovative:"#E91E63"}[e.metadata.approach]||"#757575"}assignScenarioIcon(e){return{proactive:"⚡",adaptive:"🌊",transformative:"🦋",decisive:"⚔️",strengthening:"💪",harmonizing:"☯️",integrative:"🔗",innovative:"💡"}[e.metadata.approach]||"🎯"}calculatePriority(e,i){return Math.round(100*e.metadata.relevanceScore)}findComplementaryScenarios(e,i){return i.filter(i=>i.scenarioId!==e.scenarioId).map(e=>e.scenarioId).slice(0,2)}calculateDialecticalTension(e,i){return.6}generateResolutionGuidance(e,i){return`${e.title}は他の選択肢と対立するものではなく、状況や内的分人の状態により最適な選択が変わることを理解する`}generateFallbackScenarios(e){const i=Array.from({length:8},(e,i)=>({scenarioId:`fallback_scenario_${i+1}`,scenarioIndex:i+1,title:`基本的アプローチ ${i+1}`,description:`状況に応じた基本的な対応策 ${i+1}`,HaQeiElements:{contradictionAcceptance:{principle:"複数の道が同時に有効である",application:"状況に応じた選択が可能"}},practicalElements:{actionSteps:["分析","計画","実行","評価"],timeframe:"3-6ヶ月",successIndicators:["進捗","成果","満足度"],riskFactors:["変化","制約","複雑性"]},metadata:{relevanceScore:.5,confidence:.5,approach:"general"},visualization:{color:"#757575",icon:"🎯",priority:50}}));return console.log("🔄 Fallback scenarios generated"),i}clearCache(){this.scenarioCache.clear(),console.log("🧹 EightScenariosGenerator cache cleared")}getSystemInfo(){return{version:this.version,philosophy:this.philosophyAlignment,scenarioCount:this.scenarioCount,cacheSize:this.scenarioCache.size,HaQeiElements:this.HaQeiElements,initialized:this.initialized}}}"undefined"!=typeof window&&(window.EightScenariosGenerator=EightScenariosGenerator,window.haqeiScenariosGenerator||(window.haqeiScenariosGenerator=new EightScenariosGenerator)),"undefined"!=typeof module&&module.exports&&(module.exports=EightScenariosGenerator),console.log("🎯 EightScenariosGenerator.js loaded successfully - HaQei統合8シナリオ生成システム");