console.log("☯️ HexagramMappingEngine Loading..."),function(){"use strict";class HexagramMappingEngine{constructor(){this.name="HexagramMappingEngine",this.version="1.0.0",this.philosophy="haqei-hexagram-wisdom",this.tripleOS={engineOS:null,interfaceOS:null,safeModeOS:null},this.hexagramDatabase=this.initializeHexagramDatabase(),this.trigrams=this.initializeTrigrams(),this.changePatterns=this.initializeChangePatterns(),this.haqeiIntegration={wisdom:"智慧と簡潔さの統合",clarity:"明晰さと深遠さの調和",practicality:"実用性と神秘性の融合",accessibility:"誰もが理解できる易経"},this.isInitialized=!1}async initialize(){console.log("🔧 HexagramMappingEngine initializing...");try{return await this.setupTripleOS(),await this.initializeDatabase(),await this.initializeChangeAnalyzer(),await this.integrateHaQeiPhilosophy(),this.isInitialized=!0,console.log("✅ HexagramMappingEngine initialized successfully"),!0}catch(e){return console.error("❌ HexagramMappingEngine initialization failed:",e),this.initializeSafeMode()}}async setupTripleOS(){this.tripleOS.engineOS={analyze:e=>this.analyzeTextToHexagram(e),map:e=>this.mapContextToHexagram(e),transform:e=>this.transformHexagram(e)},this.tripleOS.interfaceOS={display:e=>this.formatHexagramDisplay(e),visualize:e=>this.createHexagramVisualization(e),explain:e=>this.generateExplanation(e)},this.tripleOS.safeModeOS={fallback:()=>this.getDefaultHexagram(),validate:e=>this.validateHexagram(e),recover:e=>this.recoverFromError(e)}}initializeHexagramDatabase(){return{1:{name:"乾",meaning:"天",attributes:["創造","強健","リーダーシップ"]},2:{name:"坤",meaning:"地",attributes:["受容","包容","サポート"]},3:{name:"屯",meaning:"始まりの困難",attributes:["誕生","成長","挑戦"]},4:{name:"蒙",meaning:"啓蒙",attributes:["学習","教育","成長"]},63:{name:"既済",meaning:"完成",attributes:["達成","調和","完了"]},64:{name:"未済",meaning:"未完成",attributes:["継続","可能性","未来"]}}}initializeTrigrams(){return{"☰":{name:"乾",element:"天",attributes:["創造的","積極的","父"]},"☷":{name:"坤",element:"地",attributes:["受容的","消極的","母"]},"☳":{name:"震",element:"雷",attributes:["動き","衝撃","長男"]},"☴":{name:"巽",element:"風",attributes:["浸透","柔軟","長女"]},"☵":{name:"坎",element:"水",attributes:["危険","深淵","中男"]},"☲":{name:"離",element:"火",attributes:["明るさ","美","中女"]},"☶":{name:"艮",element:"山",attributes:["静止","瞑想","少男"]},"☱":{name:"兌",element:"沢",attributes:["喜び","説得","少女"]}}}initializeChangePatterns(){return{"互綜":e=>this.calculateMutualChange(e),"錯卦":e=>this.calculateOppositeChange(e),"綜卦":e=>this.calculateReverseChange(e),"変爻":(e,a)=>this.calculateLineChange(e,a)}}async analyzeTextToHexagram(e){if(!e)return this.getDefaultHexagram();try{const a=await this.extractKeywords(e),i=await this.analyzeSentiment(e),t=await this.analyzeContext(e),n=this.calculateHexagramNumber(a,i,t),s=this.hexagramDatabase[n]||this.getDefaultHexagram();return s.changes=this.calculatePossibleChanges(n),s}catch(a){return console.error("Text to hexagram mapping failed:",a),this.tripleOS.safeModeOS.fallback()}}async mapContextToHexagram(e){const a={time:this.mapTimeToTrigram(e.time),space:this.mapSpaceToTrigram(e.space),emotion:this.mapEmotionToTrigram(e.emotion),action:this.mapActionToTrigram(e.action)},i=this.combineTrigrams([a.time,a.space]),t=this.combineTrigrams([a.emotion,a.action]);return this.combineTrigramsToHexagram(i,t)}transformHexagram(e){return{original:e,mutual:this.changePatterns["互綜"](e),opposite:this.changePatterns["錯卦"](e),reverse:this.changePatterns["綜卦"](e),evolution:this.calculateEvolution(e)}}async extractKeywords(e){return e.split(/\s+/).filter(e=>e.length>2)}async analyzeSentiment(e){let a=0;return["良い","素晴らしい","成功","幸せ"].forEach(i=>{e.includes(i)&&a++}),["悪い","失敗","困難","不安"].forEach(i=>{e.includes(i)&&a--}),a}async analyzeContext(e){return{length:e.length,complexity:e.split(/[.!?]/).length,urgency:e.includes("緊急")||e.includes("今すぐ"),uncertainty:e.includes("かも")||e.includes("たぶん")}}calculateHexagramNumber(e,a,i){let t=1;return t+=e.length%64,t+=a>0?10:-10,t+=5*i.complexity,t=Math.abs(t)%64+1,t}calculatePossibleChanges(e){return{next:e%64+1,previous:e>1?e-1:64,opposite:65-e,complement:(e+31)%64+1}}getDefaultHexagram(){return{number:1,name:"乾",meaning:"天",attributes:["創造","強健","リーダーシップ"],message:"HaQei哲学による初期状態"}}formatHexagramDisplay(e){return`\n        【${e.name}卦】\n        意味: ${e.meaning}\n        特性: ${e.attributes.join(", ")}\n        ${e.message||""}\n      `}async integrateHaQeiPhilosophy(){this.philosophicalFramework={simplicity:"シンプルで理解しやすい",depth:"深い洞察を提供",practicality:"実用的なアドバイス",universality:"普遍的な智慧"}}initializeSafeMode(){return console.log("⚠️ Initializing safe mode..."),this.isInitialized=!0,!0}}"undefined"!=typeof window&&(window.HexagramMappingEngine=HexagramMappingEngine),"undefined"!=typeof module&&module.exports&&(module.exports=HexagramMappingEngine),console.log("✅ HexagramMappingEngine loaded successfully with HaQei Philosophy")}("undefined"!=typeof window?window:global);