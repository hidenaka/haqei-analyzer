console.log("🎭 SituationalContextEngine Loading..."),window.SituationalContextEngine={init(){console.log("🔧 SituationalContextEngine initializing..."),this.setupTripleOS(),this.initializeContextFrameworks(),this.loadSituationalMappings(),console.log("✅ SituationalContextEngine initialized successfully")},setupTripleOS(){this.engineOS={name:"Situational Context Engine OS",version:"1.0.0",philosophy:"haqei-situational",async analyzeSituationalContext(t,e={}){try{const i=this.recognizeSituation(t),a=await this.mapSituationalContext(i,e),n=this.analyzeEnvironmentalFactors(t,a),s=this.analyzeStakeholders(t,a),o=this.analyzeDynamicFactors(t,a),r=this.generateAdaptationStrategies(a,o);return{input:t,situation:i,context:a,environmental:n,stakeholders:s,dynamics:o,adaptations:r,metadata:{contextComplexity:this.calculateContextComplexity(a),adaptationPotential:this.calculateAdaptationPotential(r),situationalStability:this.assessSituationalStability(o),philosophy:"haqei-situational"}}}catch(i){return console.warn("⚠️ Situational context analysis error:",i),this.createFallbackContext(t)}},recognizeSituation(t){const e=this.identifySituationTypes(t);return{types:e,urgency:this.assessUrgencyLevel(t),complexity:this.assessSituationComplexity(t),scope:this.determineSituationScope(t),nature:this.analyzeSituationNature(t),primaryType:this.determinePrimarySituationType(e),confidence:this.calculateRecognitionConfidence(e)}},identifySituationTypes(t){const e=[];return Object.entries({decision:/決める|選ぶ|判断|決断|方針|選択/,problem:/問題|困難|課題|トラブル|悩み|障害/,opportunity:/チャンス|機会|可能性|好機|タイミング/,relationship:/人間関係|友人|家族|同僚|チーム|パートナー/,career:/仕事|転職|昇進|キャリア|職業|会社/,health:/健康|体調|病気|治療|医療|ケア/,learning:/学習|勉強|教育|スキル|知識|成長/,finance:/お金|金融|投資|収入|支出|経済/,creative:/創作|芸術|デザイン|アイデア|表現|クリエイティブ/,communication:/コミュニケーション|会話|伝達|相談|対話/,conflict:/対立|争い|衝突|緊張|摩擦|対抗/,change:/変化|変更|転換|移行|改革|革新/}).forEach(([i,a])=>{a.test(t)&&e.push({type:i,confidence:this.calculatePatternConfidence(a,t),relevance:this.assessTypeRelevance(i,t)})}),e.sort((t,e)=>e.confidence-t.confidence)},assessUrgencyLevel(t){const e={high:/緊急|急ぎ|すぐに|今すぐ|至急|危険|クリティカル/,medium:/早め|近いうち|そろそろ|なるべく|できれば/,low:/いつか|将来|時間があるとき|余裕があるとき/};for(const[i,a]of Object.entries(e))if(a.test(t))return{level:i,confidence:this.calculatePatternConfidence(a,t),indicators:this.extractUrgencyIndicators(t,a)};return{level:"medium",confidence:.5,indicators:[]}},assessSituationComplexity(t){let e=.5;e+=.3*(new Set(t.split(/\s+/)).size/t.split(/\s+/).length);e+=.1*this.identifyDomains(t).length;e+=.05*this.identifyStakeholders(t).length;return e+=.1*this.identifyTimeframes(t).length,Math.min(e,1)},determineSituationScope(t){const e=[];return Object.entries({personal:/自分|私|個人的|プライベート|一人で/,interpersonal:/相手|パートナー|友人|家族|恋人/,group:/チーム|グループ|仲間|みんな|集団/,organizational:/会社|組織|部署|職場|企業/,societal:/社会|地域|コミュニティ|世間|公共/,global:/世界|グローバル|国際|全体|普遍/}).forEach(([i,a])=>{a.test(t)&&e.push({scope:i,strength:this.calculatePatternStrength(a,t)})}),e.length>0?e:[{scope:"personal",strength:.5}]},analyzeSituationNature(t){const e=[];return Object.entries({analytical:/分析|検討|調査|研究|データ|情報/,creative:/創造|アイデア|発想|イノベーション|デザイン/,emotional:/感情|気持ち|心|愛|不安|喜び|悲しみ/,practical:/実践|実行|行動|実際|具体的|現実/,strategic:/戦略|計画|方針|長期|目標|ビジョン/,tactical:/戦術|手法|方法|短期|即効|テクニック/,philosophical:/哲学|価値観|信念|人生|意味|本質/}).forEach(([i,a])=>{a.test(t)&&e.push({nature:i,strength:this.calculatePatternStrength(a,t),relevance:this.assessNatureRelevance(i,t)})}),e.sort((t,e)=>e.strength-t.strength)},async mapSituationalContext(t,e){const i={situation:t,previous:e,timestamp:(new Date).toISOString()},a=await this.createSituationalContextMap(t),n=this.analyzeContinuity(i,e);return{base:i,map:a,continuity:n,constraints:this.identifyContextualConstraints(t),opportunities:this.identifyContextualOpportunities(t),coherence:this.calculateContextualCoherence(a,n)}},analyzeEnvironmentalFactors(t,e){const i={physical:this.analyzePhysicalEnvironment(t),social:this.analyzeSocialEnvironment(t),cultural:this.analyzeCulturalEnvironment(t),economic:this.analyzeEconomicEnvironment(t),technological:this.analyzeTechnologicalEnvironment(t),temporal:this.analyzeTemporalEnvironment(t)};return{factors:i,interactions:this.analyzeFactorInteractions(i),influences:this.assessEnvironmentalInfluences(i,e),dominantFactors:this.identifyDominantFactors(i),stability:this.assessEnvironmentalStability(i)}},analyzeStakeholders(t,e){const i=this.identifyStakeholders(t),a=this.analyzeStakeholderRoles(i,e),n=this.mapStakeholderRelationships(i,t),s=this.assessStakeholderInfluences(i,e);return{stakeholders:i,roles:a,relationships:n,influences:s,dynamics:this.analyzeStakeholderDynamics(i,n),keyStakeholders:this.identifyKeyStakeholders(i,s),alignment:this.assessStakeholderAlignment(i,n)}},analyzeDynamicFactors(t,e){const i=this.identifyTrends(t,e),a=this.identifyPressures(t,e),n=this.identifyChanges(t,e),s=this.assessMomentum(t,e),o=this.assessVolatility(i,a,n);return{trends:i,pressures:a,changes:n,momentum:s,volatility:o,predictability:this.assessPredictability(i,o),adaptationRequired:this.assessAdaptationRequirement(n,o)}},generateAdaptationStrategies(t,e){const i=[];return e.volatility>.6&&i.push(...this.generateVolatilityStrategies(e)),e.volatility<.4&&i.push(...this.generateStabilityStrategies(e)),t.opportunities.length>0&&i.push(...this.generateOpportunityStrategies(t.opportunities)),t.constraints.length>0&&i.push(...this.generateConstraintStrategies(t.constraints)),i.push(...this.generateHaQeiIntegrationStrategies(t,e)),this.prioritizeStrategies(i)}},this.interfaceOS={name:"Situational Context Interface OS",formatContextResult(t){return{overview:this.createContextOverview(t),situation:this.formatSituation(t.situation),context:this.formatContext(t.context),environmental:this.formatEnvironmentalFactors(t.environmental),stakeholders:this.formatStakeholders(t.stakeholders),dynamics:this.formatDynamics(t.dynamics),adaptations:this.formatAdaptations(t.adaptations),insights:this.generateContextualInsights(t),visualizations:this.generateVisualizationSpecs(t),philosophy:t.metadata.philosophy}},createContextOverview(t){return{title:"HaQei状況コンテキスト分析",summary:{situationType:t.situation.primaryType,urgency:t.situation.urgency.level,complexity:this.formatComplexity(t.situation.complexity),scope:t.situation.scope[0]?.scope||"unknown"},keyInsights:this.extractKeyInsights(t),urgentActions:this.extractUrgentActions(t.adaptations),contextualTheme:this.deriveContextualTheme(t)}},formatSituation(t){return{primary:this.formatSituationType(t.primaryType),types:t.types.map(t=>({name:this.formatSituationType(t.type),confidence:this.formatPercentage(t.confidence),relevance:this.formatPercentage(t.relevance)})),urgency:{level:this.formatUrgencyLevel(t.urgency.level),indicators:t.urgency.indicators},complexity:this.formatComplexity(t.complexity),scope:t.scope.map(t=>({name:this.formatScopeType(t.scope),strength:this.formatPercentage(t.strength)})),nature:t.nature.map(t=>({name:this.formatNatureType(t.nature),strength:this.formatPercentage(t.strength)}))}}},this.safeMode={name:"Situational Context Safe Mode OS",active:!1,activate(){return console.log("🛡️ SituationalContextEngine Safe Mode activated"),this.active=!0,{basicContextAnalysis:!0,advancedFeatures:!1,philosophy:"haqei-safe"}},performBasicSituationalAnalysis(t){const e={type:this.identifyBasicSituationType(t),urgency:this.assessBasicUrgency(t),complexity:this.estimateBasicComplexity(t),scope:"personal"};return{input:t,situation:e,insights:[`基本的な状況分析: ${e.type}として認識`],metadata:{contextComplexity:e.complexity,adaptationPotential:.5,situationalStability:.5,philosophy:"haqei-safe"}}}}},initializeContextFrameworks(){try{console.log("🔧 Initializing context frameworks..."),this.contextFrameworks={situationType:this.safeCreateFramework("createSituationTypeFramework"),urgency:this.safeCreateFramework("createUrgencyFramework"),scope:this.safeCreateFramework("createScopeFramework"),nature:this.safeCreateFramework("createNatureFramework"),adaptation:this.safeCreateFramework("createAdaptationFramework")},console.log("✅ Context frameworks initialized successfully")}catch(t){console.error("❌ Context frameworks initialization error:",t),this.contextFrameworks={}}},safeCreateFramework(t){try{const e=this[t];if("function"==typeof e){const i=e.call(this);return console.log(`✅ ${t} framework created`),i}return console.warn(`⚠️ Framework method ${t} not available`),{}}catch(e){return console.error(`❌ Error creating framework ${t}:`,e.message),{}}},createSituationTypeFramework:()=>({categories:["decision","problem","opportunity","relationship","career","health","learning","finance","creative","communication","conflict","change"],hierarchies:{problem:["technical","interpersonal","strategic"],decision:["binary","multiple","strategic"],opportunity:["immediate","strategic","creative"]}}),loadSituationalMappings(){this.situationalMappings={contexts:this.loadContextMappings(),adaptations:this.loadAdaptationMappings(),strategies:this.loadStrategyMappings()}},loadContextMappings:()=>({situational:{decision:["決める","選ぶ","判断","決断","選択"],problem:["問題","困難","課題","トラブル","障害"],opportunity:["チャンス","機会","可能性","好機"],relationship:["人間関係","関係","付き合い","つながり"]},environmental:{work:["仕事","職場","会社","業務","キャリア"],personal:["個人的","私的","プライベート"],social:["社会的","公的","コミュニティ"],family:["家庭","家族","家庭的"]},adaptations:{flexible:["柔軟","適応","変化対応","臨機応変"],stable:["安定","一貫","継続","保持"],innovative:["革新","新しい","創造","独创"]}}),loadAdaptationMappings:()=>({strategies:{accommodation:["適応","受容","柔軟対応","調整"],resistance:["抵抗","反対","維持","守る"],transformation:["変化","変革","進化","成長"],integration:["統合","融合","結合","一体化"]},contexts:{high_pressure:["プレッシャー","ストレス","緊張","玉限"],supportive:["支援","サポート","協力","支え"],uncertain:["不確実","曖昧","不明","不安定"]}}),loadStrategyMappings:()=>({haqei:{harmony:["調和","バランス","均衡","穏やか"],transformation:["変化","成長","進化","発展"],integration:["統合","融合","一体","結合"],wisdom:["知恵","洞察","理解","気づき"]},practical:{planning:["計画","準備","段取り","方針"],action:["行動","実行","実践","取り組み"],reflection:["振り返り","反省","考察","見直し"]}}),identifyStakeholders(t){const e=[];return[/私|自分|個人/,/家族|両親|兄弟|姉妹|子供/,/友人|友達|仲間|知人/,/恋人|パートナー|配偶者/,/上司|部下|同僚|チーム/,/顧客|クライアント|お客様/,/専門家|医者|弁護士|コンサルタント/].forEach((i,a)=>{i.test(t)&&e.push({type:this.getStakeholderType(a),relevance:this.calculateStakeholderRelevance(t,i)})}),e},getStakeholderType:t=>["self","family","friends","partner","colleagues","clients","experts"][t]||"unknown",calculatePatternConfidence(t,e){const i=e.match(t);if(!i)return 0;const a=i.length,n=e.length;return Math.min(a/(n/100),1)},calculatePatternStrength(t,e){return(this.calculatePatternConfidence(t,e)+this.assessContextualRelevance(t,e))/2},assessContextualRelevance(t,e){const i=this.extractSurroundingContext(t,e);return this.calculateSemanticRelevance(i)},generateHaQeiIntegrationStrategies(t,e){const i=[];return i.push({type:"harmony",description:"状況の異なる要素間の調和を図る",actions:["対立要素の統合","異なる視点の受容","バランスの模索"],priority:"high",philosophy:"haqei-harmony"}),i.push({type:"transformation",description:"状況を通じた成長と変容を促進",actions:["学習機会の活用","視野の拡張","価値観の深化"],priority:"medium",philosophy:"haqei-transformation"}),i.push({type:"integration",description:"分散した要素の統合的理解",actions:["全体像の把握","関連性の発見","本質の洞察"],priority:"medium",philosophy:"haqei-integration"}),i},async analyzeSituationalContext(t,e={}){this.engineOS||await this.init();try{if(this.safeMode.active)return this.safeMode.performBasicSituationalAnalysis(t);const i=await this.engineOS.analyzeSituationalContext(t,e);return this.interfaceOS.formatContextResult(i)}catch(i){return console.error("❌ Situational context analysis failed:",i),this.safeMode.activate(),this.safeMode.performBasicSituationalAnalysis(t)}},getContextCapabilities(){const t=["basic_situation_recognition","urgency_assessment"];return this.contextFrameworks&&t.push("advanced_situation_analysis","stakeholder_analysis","environmental_analysis"),this.situationalMappings&&t.push("adaptation_strategies","haqei_integration","context_synthesis"),this.safeMode.active||t.push("dynamic_adaptation","complex_context_mapping","philosophical_integration"),t},createUrgencyFramework:()=>({levels:["low","medium","high","critical","emergency"],timescales:["immediate","today","this_week","this_month","future"],consequences:["minor","moderate","significant","major","catastrophic"],reversibility:["reversible","partially_reversible","irreversible"]}),createScopeFramework:()=>({impact:["personal","interpersonal","team","organization","society"],reach:["local","regional","national","international","global"],duration:["temporary","short-term","medium-term","long-term","permanent"],depth:["surface","moderate","deep","fundamental","transformational"]}),createNatureFramework:()=>({types:["problem","opportunity","crisis","routine","creative"],complexity:["simple","complicated","complex","chaotic"],predictability:["predictable","somewhat_predictable","unpredictable"],controllability:["controllable","influenceable","uncontrollable"]}),createAdaptationFramework:()=>({strategies:["accommodation","assimilation","transformation","resistance"],flexibility:["rigid","adaptive","flexible","fluid"],resilience:["fragile","robust","antifragile"],learning:["surface","deep","transformational"]})},document.addEventListener("DOMContentLoaded",()=>{window.SituationalContextEngine.init()}),console.log("✅ SituationalContextEngine loaded successfully with HaQei Philosophy");