console.log("ðŸ§  ML Integration Loading with HaQei Philosophy..."),window.MLIntegration={initialized:!1,haqeiConfiguration:{philosophy:"haqei",approach:"harmony_driven",acceptance_contradiction:!0,organic_learning:!0,compassionate_analysis:!0,wisdom_guided:!0},engineOS:null,interfaceOS:null,safeMode:null,async init(){console.log("ðŸš€ MLIntegration initializing with HaQei principles...");try{this.setupTripleOSArchitecture(),await this.initializeMLModels(),await this.setupHaQeiEnhancement(),this.validateMLCapabilities(),this.initialized=!0,console.log("âœ… MLIntegration initialized with HaQei philosophy")}catch(e){console.error("âŒ MLIntegration initialization failed:",e),this.activateSafeMode()}},setupTripleOSArchitecture(){console.log("ðŸ”§ Setting up Triple OS Architecture for ML..."),this.engineOS={name:"ML Engine OS",version:"1.0.0",philosophy:"haqei-ml",async analyzeText(e,t={}){try{const i={sentiment:this.analyzeSentiment(e),keywords:this.extractKeywords(e),themes:this.identifyThemes(e),emotions:this.detectEmotions(e),complexity:this.assessComplexity(e),haqei_alignment:this.assessHaQeiAlignment(e)};return{text:e,analysis:i,context:t,confidence:this.calculateOverallConfidence(i),philosophy:"haqei-enhanced"}}catch(i){return console.warn("âš ï¸ Text analysis error:",i),this.createFallbackAnalysis(e)}},analyzeSentiment(e){let t=0,i=0;["å¬‰ã—ã„","æ¥½ã—ã„","å¹¸ã›","è‰¯ã„","ç´ æ™´ã‚‰ã—ã„","æ„›","å¸Œæœ›","æˆåŠŸ","èª¿å’Œ","å¹³å’Œ"].forEach(i=>{const n=(e.match(new RegExp(i,"g"))||[]).length;t+=n}),["æ‚²ã—ã„","è¾›ã„","å›°ã‚‹","æ‚ªã„","å•é¡Œ","ä¸å®‰","å¿ƒé…","å¤±æ•—","å¯¾ç«‹","æ··ä¹±"].forEach(t=>{const n=(e.match(new RegExp(t,"g"))||[]).length;i+=n});const n=t+i;if(0===n)return{polarity:0,magnitude:0,classification:"neutral"};const a=(t-i)/n;let s="neutral";return a>.2?s="positive":a<-.2&&(s="negative"),{polarity:a,magnitude:n/e.length*100,classification:s,positive_score:t,negative_score:i}},extractKeywords(e){const t=e.match(/[ä¸€-é¾¯]+/g)||[],i=new Map;t.forEach(e=>{e.length>=2&&i.set(e,(i.get(e)||0)+1)});return Array.from(i.entries()).map(([t,i])=>({word:t,frequency:i,importance:this.calculateWordImportance(t,i,e.length),category:this.categorizeWord(t)})).sort((e,t)=>t.importance-e.importance).slice(0,10)},calculateWordImportance(e,t,i){let n=t/i*100;e.length>=3&&(n*=1.2),e.length>=4&&(n*=1.1);return["èª¿å’Œ","æ…ˆæ‚²","æ™ºæ…§","çœŸå®Ÿ","å¹³å’Œ","ç†è§£","æˆé•·","æ„›","å”åŠ›"].includes(e)&&(n*=1.5),Math.min(n,1)},categorizeWord(e){const t={emotion:["å¬‰ã—ã„","æ‚²ã—ã„","æ„›","æ€’ã‚Š","ä¸å®‰","å¸Œæœ›"],action:["ã™ã‚‹","è¡Œã†","ä½œã‚‹","å­¦ã¶","æˆé•·","å¤‰åŒ–"],relation:["é–¢ä¿‚","å‹äºº","å®¶æ—","ä»²é–“","å”åŠ›","ç†è§£"],time:["éŽåŽ»","ç¾åœ¨","æœªæ¥","æ™‚é–“","çž¬é–“"],philosophy:["èª¿å’Œ","æ™ºæ…§","çœŸå®Ÿ","æ…ˆæ‚²","å¹³å’Œ"]};for(const[i,n]of Object.entries(t))if(n.some(t=>e.includes(t)))return i;return"general"},identifyThemes(e){const t=[];return Object.entries({personal_development:/æˆé•·|ç™ºå±•|å‘ä¸Š|è‡ªå·±å®Ÿç¾|å­¦ç¿’/g,relationships:/é–¢ä¿‚|å‹äºº|å®¶æ—|æ„›|ç†è§£|å”åŠ›/g,work_career:/ä»•äº‹|ä¼šç¤¾|ã‚­ãƒ£ãƒªã‚¢|è·å ´|ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/g,health_wellness:/å¥åº·|ä½“èª¿|å¿ƒèº«|ãƒãƒ©ãƒ³ã‚¹|ã‚¦ã‚§ãƒ«ãƒã‚¹/g,spirituality:/ç²¾ç¥ž|é­‚|å“²å­¦|çž‘æƒ³|æ™ºæ…§|çœŸå®Ÿ/g,creativity:/å‰µé€ |ã‚¢ãƒ¼ãƒˆ|è¡¨ç¾|é©æ–°|ã‚¢ã‚¤ãƒ‡ã‚¢/g}).forEach(([i,n])=>{const a=(e.match(n)||[]).length;a>0&&t.push({theme:i,relevance:Math.min(a/3,1),matches:a})}),t.sort((e,t)=>t.relevance-e.relevance)},detectEmotions(e){const t={};let i=0;Object.entries({joy:/å¬‰ã—|æ¥½ã—|å¹¸ã›|å–œã³|æº€è¶³|è‰¯ã„/g,sadness:/æ‚²ã—|è¾›ã„|å¯‚ã—|æ†‚é¬±|è½ã¡è¾¼/g,anger:/æ€’ã‚Š|è…¹ç«‹|ã‚¤ãƒ©ã‚¤ãƒ©|æ†¤ã‚Š|ä¸æº€/g,fear:/ä¸å®‰|å¿ƒé…|æ€–|æã‚Œ|ç·Šå¼µ/g,love:/æ„›|å¥½ã|å¤§åˆ‡|æ…ˆã—|æ€ã„ã‚„ã‚Š/g,hope:/å¸Œæœ›|æœŸå¾…|å¤¢|é¡˜ã„|æœªæ¥/g,peace:/å¹³å’Œ|å®‰å¿ƒ|è½ã¡ç€|èª¿å’Œ|é™ã‹/g}).forEach(([n,a])=>{const s=(e.match(a)||[]).length;t[n]={count:s,intensity:Math.min(s/2,1)},i+=s});let n=0,a=0;return["joy","love","hope","peace"].forEach(e=>{n+=t[e].count}),["sadness","anger","fear"].forEach(e=>{a+=t[e].count}),{emotions:t,emotional_balance:{positive:n,negative:a,ratio:i>0?n/i:.5},dominant_emotion:this.findDominantEmotion(t),overall_intensity:i/e.length*100}},findDominantEmotion(e){let t=0,i="neutral";return Object.entries(e).forEach(([e,n])=>{n.intensity>t&&(t=n.intensity,i=e)}),{emotion:i,intensity:t}},assessComplexity(e){const t={length:e.length/500,sentence_count:(e.match(/[ã€‚ï¼ï¼Ÿ]/g)||[]).length,unique_words:new Set(e.match(/[ä¸€-é¾¯]+/g)||[]).size,conjunction_usage:(e.match(/ã—ã‹ã—|ã ãŒ|ã¨ã“ã‚ãŒ|ä¸€æ–¹|ãã‚Œã§ã‚‚/g)||[]).length,abstract_concepts:(e.match(/æ¦‚å¿µ|æ€è€ƒ|å“²å­¦|ç²¾ç¥ž|æœ¬è³ª/g)||[]).length},i=.2*Math.min(t.length,1)+.2*Math.min(t.sentence_count/10,1)+.3*Math.min(t.unique_words/50,1)+.2*Math.min(t.conjunction_usage/3,1)+.1*Math.min(t.abstract_concepts/5,1);return{score:i,level:i>.7?"high":i>.4?"medium":"low",factors:t}},assessHaQeiAlignment(e){const t={};let i=0;return Object.entries({harmony:/èª¿å’Œ|å¹³å’Œ|ãƒãƒ©ãƒ³ã‚¹|çµ±åˆ|å”èª¿|å”åŠ›/g,compassion:/æ…ˆæ‚²|æ€ã„ã‚„ã‚Š|æ„›|å…±æ„Ÿ|ç†è§£|æ”¯æ´|å„ªã—ã•/g,wisdom:/æ™ºæ…§|çŸ¥æµ|å­¦ç¿’|æˆé•·|æ´žå¯Ÿ|çµŒé¨“|ç†è§£/g,authenticity:/çœŸå®Ÿ|èª å®Ÿ|æ­£ç›´|è‡ªç„¶|ç´”ç²‹|æœ¬è³ª|ç´ ç›´/g}).forEach(([n,a])=>{const s=(e.match(a)||[]).length,o=Math.min(s/3,1);t[n]={matches:s,score:o,keywords:[...e.matchAll(a)].map(e=>e[0])},i+=o}),{principles:t,overall_score:i/4,classification:this.classifyHaQeiAlignment(i/4),recommendations:this.generateHaQeiRecommendations(t)}},classifyHaQeiAlignment:e=>e>=.7?"highly_aligned":e>=.4?"moderately_aligned":e>=.2?"partially_aligned":"minimally_aligned",generateHaQeiRecommendations(e){const t=[];return Object.entries(e).forEach(([e,i])=>{if(i.score<.5){const i={harmony:"èª¿å’Œã¨å”åŠ›ã®è¦ç´ ã‚’å–ã‚Šå…¥ã‚Œã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™",compassion:"æ€ã„ã‚„ã‚Šã¨å…±æ„Ÿã®è¦–ç‚¹ã‚’åŠ ãˆã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™",wisdom:"å­¦ç¿’ã¨æˆé•·ã®æ©Ÿä¼šã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™",authenticity:"çœŸå®Ÿã¨èª å®Ÿã•ã‚’é‡è¦–ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™"};t.push(i[e])}}),t},calculateOverallConfidence:e=>[e.sentiment?.2:0,e.keywords.length>0?.2:0,e.themes.length>0?.2:0,e.emotions?.2:0,e.haqei_alignment?.2:0].reduce((e,t)=>e+t,0),createFallbackAnalysis:e=>({text:e,analysis:{sentiment:{polarity:0,classification:"neutral"},keywords:[],themes:[],emotions:{emotions:{},emotional_balance:{ratio:.5}},complexity:{score:.3,level:"low"},haqei_alignment:{overall_score:.3,classification:"partially_aligned"}},confidence:.3,philosophy:"haqei-fallback"})},this.interfaceOS={name:"ML Interface OS",formatAnalysisResult(e){return{summary:{confidence:Math.round(100*e.confidence)+"%",sentiment:e.analysis.sentiment.classification,complexity:e.analysis.complexity.level,haqei_alignment:e.analysis.haqei_alignment.classification,top_keywords:e.analysis.keywords.slice(0,5).map(e=>e.word)},detailed:{sentiment_analysis:this.formatSentimentAnalysis(e.analysis.sentiment),keyword_analysis:this.formatKeywordAnalysis(e.analysis.keywords),theme_analysis:this.formatThemeAnalysis(e.analysis.themes),emotion_analysis:this.formatEmotionAnalysis(e.analysis.emotions),haqei_analysis:this.formatHaQeiAnalysis(e.analysis.haqei_alignment)},insights:this.generateInsights(e.analysis),recommendations:this.generateRecommendations(e.analysis)}},formatSentimentAnalysis(e){return{polarity:e.polarity?.toFixed(2)||0,classification:e.classification,strength:e.magnitude?.toFixed(2)||0,interpretation:this.interpretSentiment(e.classification,e.polarity)}},interpretSentiment:(e,t)=>({positive:`ãƒã‚¸ãƒ†ã‚£ãƒ–ãªæ„Ÿæƒ…ãŒè¡¨ç¾ã•ã‚Œã¦ã„ã¾ã™ï¼ˆå¼·åº¦: ${Math.abs(100*t).toFixed(0)}%ï¼‰`,negative:`ãƒã‚¬ãƒ†ã‚£ãƒ–ãªæ„Ÿæƒ…ãŒè¡¨ç¾ã•ã‚Œã¦ã„ã¾ã™ï¼ˆå¼·åº¦: ${Math.abs(100*t).toFixed(0)}%ï¼‰`,neutral:"ä¸­æ€§çš„ãªè¡¨ç¾ã§ã™"}[e]||"åˆ†æžä¸­..."),formatKeywordAnalysis(e){return{total_keywords:e.length,top_keywords:e.slice(0,5),categories:this.groupKeywordsByCategory(e),importance_distribution:this.calculateImportanceDistribution(e)}},groupKeywordsByCategory(e){const t={};return e.forEach(e=>{const i=e.category||"general";t[i]||(t[i]=[]),t[i].push(e)}),Object.entries(t).map(([e,t])=>({category:e,count:t.length,keywords:t.slice(0,3).map(e=>e.word)}))},calculateImportanceDistribution(e){let t=0,i=0,n=0;return e.forEach(e=>{e.importance>=.7?t++:e.importance>=.4?i++:n++}),{high:t,medium:i,low:n}},formatThemeAnalysis:e=>({identified_themes:e.length,primary_theme:e[0]||null,theme_distribution:e.map(e=>({theme:e.theme,relevance:Math.round(100*e.relevance)+"%",strength:e.matches}))}),formatEmotionAnalysis:e=>({dominant_emotion:e.dominant_emotion,emotional_balance:{positive_ratio:Math.round(100*e.emotional_balance.ratio)+"%",balance_type:e.emotional_balance.ratio>.6?"positive":e.emotional_balance.ratio<.4?"negative":"balanced"},emotion_intensity:Math.round(100*e.overall_intensity)/100,detected_emotions:Object.entries(e.emotions).filter(([e,t])=>t.intensity>0).map(([e,t])=>({emotion:e,intensity:Math.round(100*t.intensity)+"%"}))}),formatHaQeiAnalysis:e=>({overall_alignment:Math.round(100*e.overall_score)+"%",classification:e.classification,principle_scores:Object.entries(e.principles).map(([e,t])=>({principle:e,score:Math.round(100*t.score)+"%",keywords:t.keywords})),recommendations:e.recommendations}),generateInsights(e){const t=[];return"neutral"!==e.sentiment.classification&&t.push(`æ–‡ç« ã¯${e.sentiment.classification}ãªãƒˆãƒ¼ãƒ³ã‚’æŒã£ã¦ã„ã¾ã™`),e.themes.length>0&&t.push(`ä¸»è¦ãƒ†ãƒ¼ãƒžã¯ã€Œ${e.themes[0].theme}ã€ã§ã™`),e.haqei_alignment.overall_score>.6&&t.push("HaQeiå“²å­¦ã®åŽŸç†ã¨é«˜ã„é©åˆæ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™"),t},generateRecommendations(e){const t=[];return e.haqei_alignment.recommendations.length>0&&t.push(...e.haqei_alignment.recommendations),e.emotions.emotional_balance.ratio<.3&&t.push("ã‚ˆã‚Šãƒã‚¸ãƒ†ã‚£ãƒ–ãªè¦–ç‚¹ã‚’å–ã‚Šå…¥ã‚Œã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™"),"low"===e.complexity.level&&t.push("ã‚ˆã‚Šè©³ç´°ãªèª¬æ˜Žã‚’åŠ ãˆã‚‹ã“ã¨ã§å†…å®¹ãŒå……å®Ÿã—ã¾ã™"),t}},this.safeMode={name:"ML Safe Mode OS",active:!1,activate(){return console.log("ðŸ›¡ï¸ MLIntegration Safe Mode activated"),this.active=!0,{basic_analysis:!0,advanced_features:!1,philosophy:"haqei-safe"}},performSafeAnalysis(e){const t=e.length,i=e.includes("è‰¯ã„")||e.includes("å¬‰ã—ã„")?"positive":e.includes("æ‚ªã„")||e.includes("æ‚²ã—ã„")?"negative":"neutral";return{text:e,analysis:{word_count:t,basic_sentiment:i,safe_mode:!0},confidence:.3,philosophy:"haqei-safe"}}},console.log("âœ… Triple OS Architecture setup complete")},async initializeMLModels(){console.log("ðŸ§  Initializing ML models..."),this.models={sentiment:{loaded:!0,type:"rule_based"},keyword_extraction:{loaded:!0,type:"frequency_based"},theme_detection:{loaded:!0,type:"pattern_matching"},emotion_detection:{loaded:!0,type:"lexicon_based"},complexity_analysis:{loaded:!0,type:"linguistic_features"}},console.log("âœ… ML models initialized")},async setupHaQeiEnhancement(){console.log("â˜¯ï¸ Setting up HaQei enhancement..."),this.haqeiEnhancement={harmony_enhancement:e=>(e.haqei_alignment.principles.harmony.score<.5&&(e.recommendations=e.recommendations||[],e.recommendations.push("èª¿å’Œã¨å”åŠ›ã®è¦–ç‚¹ã‚’åŠ ãˆã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™")),e),compassion_enhancement:e=>(e.emotions.emotional_balance.ratio<.4&&(e.recommendations=e.recommendations||[],e.recommendations.push("æ€ã„ã‚„ã‚Šã¨å…±æ„Ÿã®è¦ç´ ã‚’å–ã‚Šå…¥ã‚Œã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™")),e),wisdom_enhancement:e=>("low"===e.complexity.level&&(e.recommendations=e.recommendations||[],e.recommendations.push("ã‚ˆã‚Šæ·±ã„æ´žå¯Ÿã‚„å­¦ã³ã®è¦ç´ ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™")),e),authenticity_enhancement:e=>(e.haqei_alignment.principles.authenticity.score<.5&&(e.recommendations=e.recommendations||[],e.recommendations.push("èª å®Ÿã•ã¨çœŸå®Ÿã®è¡¨ç¾ã‚’é‡è¦–ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™")),e)},console.log("âœ… HaQei enhancement setup complete")},validateMLCapabilities(){console.log("ðŸ” Validating ML capabilities...");const e={text_analysis:!!this.engineOS,sentiment_analysis:!0,keyword_extraction:!0,theme_detection:!0,emotion_detection:!0,haqei_alignment:!0};this.capabilities=e,console.log("âœ… ML capabilities validated:",e)},activateSafeMode(){console.log("ðŸ›¡ï¸ Activating Safe Mode..."),this.safeMode.activate(),this.initialized=!0},async analyzeText(e,t={}){this.initialized||await this.init();try{if(this.safeMode.active)return this.safeMode.performSafeAnalysis(e);const i=await this.engineOS.analyzeText(e,t),n=this.applyHaQeiEnhancement(i);return this.interfaceOS.formatAnalysisResult(n)}catch(i){return console.error("âŒ Text analysis failed:",i),this.safeMode.activate(),this.safeMode.performSafeAnalysis(e)}},applyHaQeiEnhancement(e){let t={...e};return Object.values(this.haqeiEnhancement).forEach(e=>{t.analysis=e(t.analysis)}),t},getStatus(){return{initialized:this.initialized,safe_mode_active:this.safeMode?.active||!1,models_loaded:Object.keys(this.models||{}).length,capabilities:this.capabilities||{},philosophy:"haqei",architecture:"triple-os"}},getCapabilities(){const e=["basic_text_analysis"];return this.engineOS&&e.push("advanced_text_analysis","sentiment_analysis","keyword_extraction"),this.haqeiEnhancement&&e.push("haqei_alignment_analysis","philosophy_enhancement"),this.safeMode?.active||e.push("theme_detection","emotion_analysis","complexity_assessment"),e}},document.addEventListener("DOMContentLoaded",()=>{window.MLIntegration.init()}),console.log("âœ… ML Integration loaded with HaQei Philosophy");