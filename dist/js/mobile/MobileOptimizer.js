class MobileOptimizer{constructor(){this.deviceInfo=null,this.touchSupport=!1,this.orientationSupport=!1,this.performanceMode="auto",this.gestureManager=null,this.viewportManager=null,this.breakpoints={xs:320,sm:375,md:414,lg:768,xl:1024,xxl:1440},this.deviceProfiles={"iPhone SE":{width:320,height:568,density:2},"iPhone 12":{width:390,height:844,density:3},"iPhone 14 Pro":{width:393,height:852,density:3},"iPhone 14 Plus":{width:428,height:926,density:3},"iPad Mini":{width:768,height:1024,density:2},"iPad Air":{width:820,height:1180,density:2}},this.performanceSettings={low:{animations:!1,transitions:!1,backgroundEffects:!1,heavyInteractions:!1},medium:{animations:!0,transitions:!0,backgroundEffects:!1,heavyInteractions:!1},high:{animations:!0,transitions:!0,backgroundEffects:!0,heavyInteractions:!0}},this.init()}async init(){console.log("Mobile Optimizer initializing..."),this.detectDevice(),this.detectTouchSupport(),this.initializeViewportManager(),this.initializeGestureManager(),this.optimizePerformance(),this.setupEventListeners(),this.adjustInitialLayout(),console.log("Mobile Optimizer initialized:",{device:this.deviceInfo,touchSupport:this.touchSupport,performanceMode:this.performanceMode})}detectDevice(){const e=navigator.userAgent,t=navigator.platform,i=window.screen.width,o=window.screen.height,n=window.devicePixelRatio||1;this.deviceInfo={userAgent:e,platform:t,screenWidth:i,screenHeight:o,devicePixelRatio:n,isIOS:/iPad|iPhone|iPod/.test(e),isAndroid:/Android/.test(e),isMobile:/Mobi|Android/i.test(e),isTablet:/(iPad|Android(?!.*Mobile))/.test(e),orientation:window.screen.orientation?.type||"unknown",connectionType:navigator.connection?.effectiveType||"unknown",memorySize:navigator.deviceMemory||"unknown",cores:navigator.hardwareConcurrency||"unknown"},this.deviceInfo.deviceName=this.identifySpecificDevice(),this.deviceInfo.category=this.categorizeDevice(),document.body.classList.add(`device-${this.deviceInfo.category}`),this.deviceInfo.isIOS&&document.body.classList.add("ios"),this.deviceInfo.isAndroid&&document.body.classList.add("android")}identifySpecificDevice(){const{screenWidth:e,screenHeight:t,devicePixelRatio:i}=this.deviceInfo;for(const[o,n]of Object.entries(this.deviceProfiles))if(Math.abs(e-n.width)<=2&&Math.abs(i-n.density)<=.1)return o;return"Unknown"}categorizeDevice(){const e=window.innerWidth;return e<=this.breakpoints.xs?"xs-mobile":e<=this.breakpoints.sm?"sm-mobile":e<=this.breakpoints.md?"md-mobile":e<=this.breakpoints.lg?"tablet":e<=this.breakpoints.xl?"large-tablet":"desktop"}detectTouchSupport(){this.touchSupport="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,this.touchSupport?document.body.classList.add("touch-device"):document.body.classList.add("no-touch"),this.touchSupport&&window.matchMedia("(pointer: fine)").matches&&document.body.classList.add("hybrid-device")}initializeViewportManager(){this.viewportManager={initialHeight:window.innerHeight,currentHeight:window.innerHeight,isKeyboardOpen:!1,handleIOSViewport(){if(this.deviceInfo?.isIOS){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`),CSS.supports("padding: env(safe-area-inset-top)")&&document.body.classList.add("safe-area-supported")}},detectKeyboard(){const e=window.innerHeight,t=this.initialHeight-e,i=this.isKeyboardOpen;if(this.isKeyboardOpen=t>150,this.isKeyboardOpen!==i){document.body.classList.toggle("keyboard-open",this.isKeyboardOpen);const e=new CustomEvent("keyboardToggle",{detail:{isOpen:this.isKeyboardOpen,heightDifference:t}});document.dispatchEvent(e)}this.currentHeight=e}},this.viewportManager.handleIOSViewport.bind(this)()}initializeGestureManager(){this.touchSupport&&(this.gestureManager={swipeThreshold:50,tapThreshold:300,doubleTapThreshold:300,touches:[],lastTap:0,detectSwipe(e,t){const i=t.clientX-e.clientX,o=t.clientY-e.clientY;if(Math.abs(i)>this.swipeThreshold){const e=i>0?"right":"left";this.dispatchGestureEvent("swipe",{direction:e,deltaX:i,deltaY:o})}if(Math.abs(o)>this.swipeThreshold){const e=o>0?"down":"up";this.dispatchGestureEvent("swipe",{direction:e,deltaX:i,deltaY:o})}},detectDoubleTap(e){const t=Date.now();t-this.lastTap<this.doubleTapThreshold&&this.dispatchGestureEvent("doubletap",{x:e.clientX,y:e.clientY}),this.lastTap=t},dispatchGestureEvent(e,t){const i=new CustomEvent(`gesture-${e}`,{detail:t});document.dispatchEvent(i)}},this.setupTouchEventListeners())}setupTouchEventListeners(){let e=null;document.addEventListener("touchstart",t=>{1===t.touches.length&&(e=t.touches[0])},{passive:!0}),document.addEventListener("touchend",t=>{if(e&&1===t.changedTouches.length){const i=t.changedTouches[0];Date.now()-e.timestamp<this.gestureManager.tapThreshold&&this.gestureManager.detectDoubleTap(i),this.gestureManager.detectSwipe(e,i),e=null}},{passive:!0}),document.addEventListener("touchmove",e=>{e.touches.length>1&&e.preventDefault()},{passive:!1})}optimizePerformance(){const{connectionType:e,memorySize:t,cores:i}=this.deviceInfo;t<=2||i<=2||"slow-2g"===e?this.performanceMode="low":t<=4||i<=4||["2g","3g"].includes(e)?this.performanceMode="medium":this.performanceMode="high",this.applyPerformanceSettings();const o=this.performanceSettings[this.performanceMode];Object.entries(o).forEach(([e,t])=>{document.documentElement.style.setProperty(`--mobile-${e}`,t?"1":"0")})}applyPerformanceSettings(){const e=this.performanceSettings[this.performanceMode];e.animations||document.body.classList.add("reduce-animations"),e.backgroundEffects||document.body.classList.add("reduce-effects"),e.heavyInteractions||document.body.classList.add("reduce-interactions"),console.log(`Performance mode: ${this.performanceMode}`,e)}setupEventListeners(){window.addEventListener("resize",this.debounce(()=>{this.handleResize()},250)),screen.orientation?screen.orientation.addEventListener("change",()=>{this.handleOrientationChange()}):window.addEventListener("orientationchange",()=>{this.handleOrientationChange()}),document.addEventListener("visibilitychange",()=>{this.handleVisibilityChange()}),navigator.connection&&navigator.connection.addEventListener("change",()=>{this.handleNetworkChange()}),window.addEventListener("focus",()=>this.handleFocus(!0)),window.addEventListener("blur",()=>this.handleFocus(!1))}handleResize(){if(this.deviceInfo.isIOS){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}this.viewportManager.detectKeyboard();const e=this.categorizeDevice();e!==this.deviceInfo.category&&(document.body.classList.remove(`device-${this.deviceInfo.category}`),document.body.classList.add(`device-${e}`),this.deviceInfo.category=e);const t=new CustomEvent("mobileResize",{detail:{width:window.innerWidth,height:window.innerHeight,category:this.deviceInfo.category}});document.dispatchEvent(t)}handleOrientationChange(){const e=screen.orientation?.type||(window.innerHeight>window.innerWidth?"portrait-primary":"landscape-primary");document.body.classList.remove("portrait","landscape"),document.body.classList.add(e.includes("portrait")?"portrait":"landscape"),setTimeout(()=>{this.adjustLayoutForOrientation(e)},100),console.log("Orientation changed:",e)}adjustLayoutForOrientation(e){const t=e.includes("landscape"),i=document.querySelector(".zone-d-integration");i&&i.classList.toggle("landscape-mode",t);const o=document.querySelector(".question-container");o&&t&&(o.style.maxHeight="80vh",o.style.overflowY="auto")}handleVisibilityChange(){document.hidden?document.body.classList.add("background-mode"):(document.body.classList.remove("background-mode"),setTimeout(()=>this.handleResize(),100))}handleNetworkChange(){const e=navigator.connection.effectiveType;["slow-2g","2g"].includes(e)?this.performanceMode="low":this.performanceMode="3g"===e?"medium":"high",this.applyPerformanceSettings(),console.log("Network changed:",e,"Performance mode:",this.performanceMode)}handleFocus(e){e?document.body.classList.remove("app-blurred"):document.body.classList.add("app-blurred")}adjustInitialLayout(){this.adjustFontSizes(),this.adjustTouchTargets(),this.optimizeScrolling(),this.optimizeInputFields()}adjustFontSizes(){const e=this.deviceInfo.category;document.documentElement.style.setProperty("--mobile-base-font-size",{"xs-mobile":"14px","sm-mobile":"15px","md-mobile":"16px",tablet:"16px","large-tablet":"17px",desktop:"16px"}[e]||"16px")}adjustTouchTargets(){if(!this.touchSupport)return;document.querySelectorAll('button, a, input[type="button"], input[type="submit"], .clickable').forEach(e=>{const t=e.getBoundingClientRect();(t.width<44||t.height<44)&&e.classList.add("touch-target-enhanced")})}optimizeScrolling(){document.body.style.webkitOverflowScrolling="touch";document.querySelectorAll(".scrollable, .overflow-auto").forEach(e=>{e.style.webkitOverflowScrolling="touch"})}optimizeInputFields(){document.querySelectorAll("input, textarea, select").forEach(e=>{this.deviceInfo.isIOS&&e.style.fontSize&&parseFloat(e.style.fontSize)<16&&(e.style.fontSize="16px"),e.addEventListener("focus",()=>{setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"center"})},300)})})}optimizeZoneD(){const e=document.querySelector(".zone-d-integration");if(!e)return;e.classList.add("mobile-optimized");e.querySelectorAll(".confidence-section, .feedback-section, .handoff-section").forEach(e=>{e.classList.add("mobile-component")});e.querySelectorAll(".destination-card").forEach(e=>{e.classList.add("mobile-card")})}getDeviceInfo(){return this.deviceInfo}setPerformanceMode(e){this.performanceSettings[e]&&(this.performanceMode=e,this.applyPerformanceSettings(),console.log("Performance mode changed:",e))}destroy(){console.log("Mobile Optimizer destroyed")}debounce(e,t){let i;return function(...o){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),e(...o)},t)}}}"undefined"!=typeof window&&(window.mobileOptimizer=new MobileOptimizer),"undefined"!=typeof module&&module.exports&&(module.exports=MobileOptimizer);