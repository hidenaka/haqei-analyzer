class ConfidenceMeter{constructor(e="confidence-section"){this.container=document.querySelector(`.${e}`)||document.getElementById(e)||null,this.metrics={dataQuality:0,consistency:0,completeness:0,patternStrength:0},this.overallConfidence=0,this.confidenceLevel="",this.thresholds={high:75,medium:50,low:0}}calculateConfidence(e,t){return this.metrics.dataQuality=this.assessDataQuality(t),this.metrics.consistency=this.assessConsistency(t),this.metrics.completeness=this.assessCompleteness(t),this.metrics.patternStrength=this.assessPatternStrength(e),this.overallConfidence=this.calculateOverallConfidence(),this.confidenceLevel=this.getConfidenceLevel(),{overall:this.overallConfidence,level:this.confidenceLevel,metrics:this.metrics,explanation:this.generateExplanation()}}assessDataQuality(e){let t=1;t-=.3*(e.filter(e=>0===e||3===e).length/e.length);return e.filter(e=>-2===e||2===e).length===e.length&&(t-=.2),Math.max(0,Math.min(1,t))}assessConsistency(e){let t=1;const n=e.reduce((e,t)=>e+t,0)/e.length;e.reduce((e,t)=>e+Math.pow(t-n,2),0)/e.length>2.5&&(t-=.3);let s=0;for(let i=1;i<e.length;i++)Math.abs(e[i]-e[i-1])>3&&s++;return t-=s/e.length*.4,Math.max(0,Math.min(1,t))}assessCompleteness(e){return e.filter(e=>null!=e).length/e.length}assessPatternStrength(e){if(!e||!e.tripleOS)return.5;const{engineOS:t,interfaceOS:n,safeModeOS:s}=e.tripleOS,i=[t,n,s];return.6*((2*Math.abs(t-.5)+2*Math.abs(n-.5)+2*Math.abs(s-.5))/3)+.4*(Math.max(...i)-Math.min(...i))}calculateOverallConfidence(){const e={dataQuality:.25,consistency:.35,completeness:.2,patternStrength:.2};let t=0;for(const[n,s]of Object.entries(e))t+=this.metrics[n]*s;return Math.round(100*t)}getConfidenceLevel(){return this.overallConfidence>=this.thresholds.high?"high":this.overallConfidence>=this.thresholds.medium?"medium":"low"}generateExplanation(){const e=[];return this.metrics.dataQuality<.7&&e.push("回答に中間的な選択が多く、明確な傾向が読み取りにくい"),this.metrics.consistency<.7&&e.push("回答パターンに変動が見られ、一貫性がやや低い"),this.metrics.completeness<1&&e.push("一部の質問が未回答"),this.metrics.patternStrength<.5&&e.push("Triple OSのパターンが不明瞭"),0===e.length&&e.push("十分なデータと明確なパターンで高い確信度"),e}render(e){const t=`\n            <div class="confidence-meter">\n                <h3>診断の確信度</h3>\n                \n                <div class="confidence-gauge">\n                    <div class="gauge-container">\n                        <div class="gauge-fill" style="width: ${this.overallConfidence}%">\n                            <span class="gauge-value">${this.overallConfidence}%</span>\n                        </div>\n                    </div>\n                    <div class="confidence-level ${this.confidenceLevel}">\n                        ${this.getLevelLabel()}\n                    </div>\n                </div>\n                \n                <div class="confidence-breakdown">\n                    <h4>確信度の内訳</h4>\n                    <div class="metric-bars">\n                        ${this.renderMetricBar("データ品質",this.metrics.dataQuality)}\n                        ${this.renderMetricBar("一貫性",this.metrics.consistency)}\n                        ${this.renderMetricBar("完全性",this.metrics.completeness)}\n                        ${this.renderMetricBar("パターン強度",this.metrics.patternStrength)}\n                    </div>\n                </div>\n                \n                <div class="confidence-explanation">\n                    <h4>確信度の根拠</h4>\n                    <ul>\n                        ${this.generateExplanation().map(e=>`<li>${e}</li>`).join("")}\n                    </ul>\n                </div>\n                \n                <div class="uncertainty-notice">\n                    <p class="notice-text">\n                        ※ この診断は${this.overallConfidence}%の確信度で提供されています。\n                        結果は参考としてご利用ください。\n                    </p>\n                </div>\n            </div>\n        `;return e&&(e.innerHTML=t),t}renderMetricBar(e,t){const n=Math.round(100*t);return`\n            <div class="metric-bar">\n                <span class="metric-label">${e}</span>\n                <div class="bar-container">\n                    <div class="bar-fill" style="width: ${n}%"></div>\n                </div>\n                <span class="metric-value">${n}%</span>\n            </div>\n        `}getLevelLabel(){return{high:"高確信度",medium:"中確信度",low:"低確信度"}[this.confidenceLevel]||""}animateDisplay(e){this.render(e),setTimeout(()=>{const t=e.querySelector(".gauge-fill");t&&(t.style.transition="width 1s ease-out");e.querySelectorAll(".bar-fill").forEach((e,t)=>{setTimeout(()=>{e.style.transition="width 0.5s ease-out"},100*t)})},100)}}"undefined"!=typeof module&&module.exports&&(module.exports=ConfidenceMeter);