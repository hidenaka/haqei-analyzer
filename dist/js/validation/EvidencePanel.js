class EvidencePanel{constructor(){this.panelElement=null,this.isVisible=!1,this.currentEvidence=null,this.initializePanel(),console.log("📋 EvidencePanel initialized - 根拠表示システム起動")}initializePanel(){const e=document.getElementById("evidence-panel");e&&e.remove(),this.panelElement=document.createElement("div"),this.panelElement.id="evidence-panel",this.panelElement.className="evidence-panel",this.panelElement.innerHTML=this.getPanelHTML(),this.applyStyles(),document.body.appendChild(this.panelElement),this.setupEventListeners(),this.hide()}getPanelHTML(){return'\n            <div class="evidence-panel-header">\n                <h3>🔍 根拠・透明性情報</h3>\n                <button class="evidence-close-btn" title="パネルを閉じる">×</button>\n            </div>\n            <div class="evidence-panel-content">\n                <div class="evidence-section">\n                    <h4>📖 易経的根拠</h4>\n                    <div id="hexagram-info">\n                        <div class="evidence-item">\n                            <span class="evidence-label">本卦:</span>\n                            <span id="main-hexagram">未設定</span>\n                        </div>\n                        <div class="evidence-item">\n                            <span class="evidence-label">変爻:</span>\n                            <span id="changing-lines">未設定</span>\n                        </div>\n                        <div class="evidence-item">\n                            <span class="evidence-label">之卦:</span>\n                            <span id="derived-hexagram">未設定</span>\n                        </div>\n                        <div class="evidence-item">\n                            <span class="evidence-label">出典:</span>\n                            <span id="source-citation">未設定</span>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="evidence-section">\n                    <h4>⚠️ ヒューリスティック注記</h4>\n                    <div id="heuristic-note">\n                        <div class="evidence-warning">\n                            <strong>進爻について:</strong><br>\n                            「進爻」は易経の正典にない当システム独自のヒューリスティック手法です。\n                            爻位の段階的進行による解釈を提供していますが、古典的易経とは異なる\n                            現代的解釈であることをご理解ください。\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="evidence-section">\n                    <h4>🔄 処理レベル情報</h4>\n                    <div id="processing-info">\n                        <div class="evidence-item">\n                            <span class="evidence-label">Fallbackレベル:</span>\n                            <span id="fallback-level" class="fallback-full">Full</span>\n                        </div>\n                        <div class="evidence-item">\n                            <span class="evidence-label">信頼度:</span>\n                            <span id="confidence-level">高</span>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="evidence-section">\n                    <h4>🎯 HaQei哲学整合性</h4>\n                    <div id="haqei-alignment">\n                        <div class="evidence-item">\n                            <span class="evidence-label">主体性:</span>\n                            <span id="agency-note">あなたの選択・判断を支援</span>\n                        </div>\n                        <div class="evidence-item">\n                            <span class="evidence-label">非決定論:</span>\n                            <span id="non-deterministic-note">最終判断は常にあなたが行います</span>\n                        </div>\n                        <div class="evidence-item">\n                            <span class="evidence-label">矛盾受容:</span>\n                            <span id="contradiction-note">複数の道が同時に有効です</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '}applyStyles(){const e=document.createElement("style");e.textContent="\n            .evidence-panel {\n                position: fixed;\n                top: 20px;\n                right: 20px;\n                width: 400px;\n                max-height: 80vh;\n                background: #1e293b;\n                border: 1px solid #334155;\n                border-radius: 8px;\n                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);\n                z-index: 1000;\n                font-family: 'Inter', 'Noto Sans JP', sans-serif;\n                color: #ffffff;\n                overflow-y: auto;\n                opacity: 0;\n                transform: translateX(100%);\n                transition: all 0.3s ease;\n            }\n            \n            .evidence-panel.visible {\n                opacity: 1;\n                transform: translateX(0);\n            }\n            \n            .evidence-panel-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 16px 20px;\n                background: #2563eb;\n                border-radius: 8px 8px 0 0;\n                border-bottom: 1px solid #3b82f6;\n            }\n            \n            .evidence-panel-header h3 {\n                margin: 0;\n                font-size: 16px;\n                font-weight: 600;\n            }\n            \n            .evidence-close-btn {\n                background: none;\n                border: none;\n                color: #ffffff;\n                font-size: 18px;\n                cursor: pointer;\n                padding: 4px 8px;\n                border-radius: 4px;\n                transition: background 0.2s;\n            }\n            \n            .evidence-close-btn:hover {\n                background: rgba(255, 255, 255, 0.1);\n            }\n            \n            .evidence-panel-content {\n                padding: 20px;\n            }\n            \n            .evidence-section {\n                margin-bottom: 24px;\n            }\n            \n            .evidence-section:last-child {\n                margin-bottom: 0;\n            }\n            \n            .evidence-section h4 {\n                margin: 0 0 12px 0;\n                font-size: 14px;\n                font-weight: 600;\n                color: #60a5fa;\n                border-bottom: 1px solid #374151;\n                padding-bottom: 6px;\n            }\n            \n            .evidence-item {\n                display: flex;\n                margin-bottom: 8px;\n                align-items: flex-start;\n            }\n            \n            .evidence-label {\n                font-weight: 500;\n                color: #94a3b8;\n                min-width: 80px;\n                margin-right: 8px;\n                font-size: 13px;\n            }\n            \n            .evidence-item span:not(.evidence-label) {\n                color: #e2e8f0;\n                font-size: 13px;\n                line-height: 1.4;\n            }\n            \n            .evidence-warning {\n                background: #451a03;\n                border: 1px solid #92400e;\n                border-radius: 4px;\n                padding: 12px;\n                font-size: 12px;\n                line-height: 1.4;\n                color: #fed7aa;\n            }\n            \n            .fallback-full { color: #10b981; }\n            .fallback-partial { color: #f59e0b; }\n            .fallback-minimal { color: #ef4444; }\n            .fallback-emergency { color: #dc2626; font-weight: bold; }\n            \n            /* モバイル対応 */\n            @media (max-width: 640px) {\n                .evidence-panel {\n                    width: 90vw;\n                    right: 5vw;\n                    max-height: 70vh;\n                }\n            }\n        ",document.head.appendChild(e)}setupEventListeners(){this.panelElement.querySelector(".evidence-close-btn").addEventListener("click",()=>this.hide()),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isVisible&&this.hide()})}displayHexagramInfo(e){const n=this.panelElement.querySelector("#main-hexagram"),i=this.panelElement.querySelector("#changing-lines"),t=this.panelElement.querySelector("#derived-hexagram"),a=this.panelElement.querySelector("#source-citation");n.textContent=e.mainHexagram||"未設定",i.textContent=e.changingLines||"未設定",t.textContent=e.derivedHexagram||"未設定",a.textContent=e.citation||"システム生成",console.log("📖 卦情報表示更新:",e)}displayChangingLines(e){const n=this.panelElement.querySelector("#changing-lines");e&&e.length>0?n.textContent=e.join("、")+"爻":n.textContent="なし"}displayHeuristicNote(e){if(e){const n=this.panelElement.querySelector("#heuristic-note .evidence-warning");let i=e;(e.includes("進爻")||e.includes("advance")||e.includes("進む"))&&(i=`<strong>⚠️ 進爻について:</strong><br>\n                進爻は古典易経にない当システム独自の分析手法です。<br>\n                従来の変爻（陰陽反転）とは異なり、現在の爻位から次の段階へ進む動的解釈を提供します。<br><br>\n                <strong>手法の根拠:</strong> HaQei哲学の「非決定論的選択肢提示」に基づく<br>\n                <strong>限界:</strong> 古典的易経解釈とは異なる現代的適応<br>\n                <strong>代替解釈:</strong> 伝統的な変爻解釈も参考にすることを推奨<br><br>\n                <strong>分析内容:</strong><br>${e}`),n.innerHTML=i}}displayFallbackLevel(e){const n=this.panelElement.querySelector("#fallback-level"),i=this.panelElement.querySelector("#confidence-level");switch(n.className="",e){case"full":n.className="fallback-full",n.textContent="Full（完全データ）",i.textContent="高";break;case"partial":n.className="fallback-partial",n.textContent="Partial（部分データ）",i.textContent="中";break;case"minimal":n.className="fallback-minimal",n.textContent="Minimal（最小データ）",i.textContent="低";break;case"emergency":n.className="fallback-emergency",n.textContent="Emergency（緊急フォールバック）",i.textContent="要注意";break;default:n.textContent=e||"未設定",i.textContent="不明"}console.log("🔄 Fallbackレベル表示更新:",e)}show(){this.panelElement.classList.add("visible"),this.isVisible=!0,console.log("👁️ 根拠パネル表示")}hide(){this.panelElement.classList.remove("visible"),this.isVisible=!1,console.log("👁️ 根拠パネル非表示")}toggle(){this.isVisible?this.hide():this.show()}updateEvidence(e){this.currentEvidence=e,e.hexagram&&this.displayHexagramInfo(e.hexagram),e.changingLines&&this.displayChangingLines(e.changingLines),e.fallbackLevel&&this.displayFallbackLevel(e.fallbackLevel),e.heuristicNote&&this.displayHeuristicNote(e.heuristicNote),console.log("📋 根拠情報一括更新完了")}getSystemInfo(){return{version:"1.0.0",isVisible:this.isVisible,hasEvidence:!!this.currentEvidence,panelId:this.panelElement.id}}}"undefined"!=typeof window&&(window.EvidencePanel=EvidencePanel,console.log("📋 EvidencePanel registered to window object")),"undefined"!=typeof module&&module.exports&&(module.exports=EvidencePanel),console.log("📋 EvidencePanel.js loaded successfully - 7日間バリデーションスプリント用根拠表示システム");