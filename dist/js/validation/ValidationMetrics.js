class ValidationMetrics{constructor(){this.sessionId=this.generateSessionId(),this.startTime=Date.now(),this.events=[],this.currentMetrics={scenarioSelected:null,usefulnessRating:null,decisionTimeSec:null,fallbackLevel:"full"},console.log("📊 ValidationMetrics initialized - Session:",this.sessionId)}generateSessionId(){return`VAL-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}trackScenarioSelection(e,t=null){const s=t||Math.round((Date.now()-this.startTime)/1e3);this.currentMetrics.scenarioSelected=e,this.currentMetrics.decisionTimeSec=s,this.addEvent("scenario_selected",{scenarioId:e,decisionTimeSec:s,timestamp:Date.now()}),console.log("🎯 シナリオ選択記録:",e,"決定時間:",s+"秒")}trackUsefulnessRating(e,t=""){e<1||e>5?console.error("⚠️ 有用度評価は1-5の範囲で入力してください:",e):(this.currentMetrics.usefulnessRating=e,this.addEvent("usefulness_rated",{rating:e,reason:t,timestamp:Date.now()}),console.log("⭐ 有用度評価記録:",e+"/5",t?`理由: ${t}`:""))}trackDecisionTime(e){this.currentMetrics.decisionTimeSec=e,this.addEvent("decision_time_measured",{seconds:e,timestamp:Date.now()}),console.log("⏱️ 決定時間記録:",e+"秒")}trackFallbackLevel(e){const t=["full","partial","minimal","emergency"];t.includes(e)?(this.currentMetrics.fallbackLevel=e,this.addEvent("fallback_level_set",{level:e,timestamp:Date.now()}),console.log("🔄 Fallbackレベル記録:",e)):console.error("⚠️ 無効なfallbackレベル:",e,"有効値:",t)}addEvent(e,t){this.events.push({eventType:e,data:t,sessionId:this.sessionId,timestamp:Date.now()})}saveMetrics(){const e={sessionId:this.sessionId,startTime:this.startTime,endTime:Date.now(),currentMetrics:this.currentMetrics,events:this.events,savedAt:(new Date).toISOString()};try{const t=`validation_metrics_${this.sessionId}`;return localStorage.setItem(t,JSON.stringify(e)),this.updateMetricsIndex(),console.log("💾 メトリクス保存完了:",t),!0}catch(t){return console.error("❌ メトリクス保存失敗:",t),!1}}saveSession(e){const t=`validation_session_${e.sessionId||this.sessionId}`;try{return localStorage.setItem(t,JSON.stringify(e)),console.log("💾 セッション保存完了:",t),!0}catch(s){return console.error("❌ セッション保存失敗:",s),!1}}loadSession(e){const t=`validation_session_${e}`;try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(s){return console.error("❌ セッション読み込み失敗:",s),null}}updateMetricsIndex(){const e="validation_metrics_index";let t=[];try{const s=localStorage.getItem(e);t=s?JSON.parse(s):[]}catch(s){console.warn("既存インデックス読み込み失敗、新規作成します"),t=[]}t.find(e=>e.sessionId===this.sessionId)||(t.push({sessionId:this.sessionId,startTime:this.startTime,lastSaved:Date.now(),scenario:this.currentMetrics.scenarioSelected,rating:this.currentMetrics.usefulnessRating}),localStorage.setItem(e,JSON.stringify(t)))}static getAllSessions(){try{const e=localStorage.getItem("validation_metrics_index");return e?JSON.parse(e):[]}catch(e){return console.error("❌ セッション一覧取得失敗:",e),[]}}exportData(){return{sessionInfo:{sessionId:this.sessionId,startTime:this.startTime,endTime:Date.now(),duration:Math.round((Date.now()-this.startTime)/1e3)},metrics:this.currentMetrics,events:this.events,summary:{totalEvents:this.events.length,hasScenarioSelection:!!this.currentMetrics.scenarioSelected,hasRating:!!this.currentMetrics.usefulnessRating,fallbackLevel:this.currentMetrics.fallbackLevel}}}getSystemInfo(){return{version:"1.0.0",sessionId:this.sessionId,eventsCount:this.events.length,startTime:new Date(this.startTime).toISOString(),currentMetrics:this.currentMetrics}}}"undefined"!=typeof window&&(window.ValidationMetrics=ValidationMetrics,console.log("📊 ValidationMetrics registered to window object")),"undefined"!=typeof module&&module.exports&&(module.exports=ValidationMetrics),console.log("📊 ValidationMetrics.js loaded successfully - 7日間バリデーションスプリント用メトリクス収集システム");