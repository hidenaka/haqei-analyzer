console.log("ğŸš€ Future Simulator Integration Loading..."),function(){"use strict";class FutureSimulatorIntegration{constructor(){this.name="FutureSimulatorIntegration",this.version="3.0.0",this.isInitialized=!1,this.h384db=null,this.guidanceEngine=null,this.visualizer=null,this.scenariosDisplay=null,this.resultPageController=null,this.currentAnalysis=null}async initialize(){console.log("ğŸ”„ FutureSimulatorIntegration initializing...");try{return await this.initializeDatabase(),await this.initializeGuidanceEngine(),this.initializeVisualizers(),this.setupEventListeners(),this.isInitialized=!0,console.log("âœ… FutureSimulatorIntegration initialized successfully"),!0}catch(e){return console.error("âŒ FutureSimulatorIntegration initialization failed:",e),!1}}async initializeDatabase(){window.h384db?(this.h384db=window.h384db,this.h384db.isLoaded||await this.h384db.initialize(),console.log("âœ… H384 Database connected")):(console.warn("âš ï¸ H384 Database not available, creating new instance"),this.h384db=new window.H384DatabaseConnector,await this.h384db.initialize())}async initializeGuidanceEngine(){window.iChingGuidance?(this.guidanceEngine=window.iChingGuidance,this.guidanceEngine.isInitialized||await this.guidanceEngine.initialize(),console.log("âœ… I Ching Guidance Engine initialized")):(console.warn("âš ï¸ Creating new I Ching Guidance Engine"),this.guidanceEngine=new window.IChingGuidanceEngine,await this.guidanceEngine.initialize())}initializeVisualizers(){if(window.ThreeStageVisualizer){this.visualizer=new window.ThreeStageVisualizer;document.getElementById("three-stage-visualizer")&&this.visualizer.initialize("three-stage-visualizer")}if(window.EightScenariosDisplay){this.scenariosDisplay=new window.EightScenariosDisplay;document.getElementById("eight-scenarios-display")&&this.scenariosDisplay.initialize("eight-scenarios-display")}window.ResultPageController&&(this.resultPageController=new window.ResultPageController,this.resultPageController.initialize(),console.log("âœ… ResultPageController initialized")),console.log("âœ… Visualizers initialized")}setupEventListeners(){const e=document.getElementById("aiGuessBtn");e&&e.addEventListener("click",async()=>{await this.performAnalysis()});const t=document.getElementById("worryInput");t&&t.addEventListener("keypress",async e=>{"Enter"===e.key&&!1===e.shiftKey&&(e.preventDefault(),await this.performAnalysis())});const i=document.getElementById("eight-scenarios-display");i&&i.addEventListener("scenarioSelected",e=>{this.handleScenarioSelection(e.detail)})}async performAnalysis(){const e=document.getElementById("worryInput");if(!e)return;const t=e.value.trim();if(!t||t.length<10)alert("10æ–‡å­—ä»¥ä¸Šã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");else{this.showLoading(!0);try{const e=await this.guidanceEngine.performCompleteAnalysis(t);if(!e)throw new Error("åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ");this.currentAnalysis=e,await this.displayResults(e),this.saveAnalysis(e)}catch(i){console.error("âŒ Analysis failed:",i),alert("åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")}finally{this.showLoading(!1)}}}async displayResults(e){if(console.log("ğŸ“Š Displaying analysis results:",e),this.resultPageController){const t={currentHexagram:{number:e.currentSituation?.hexagramNumber||1,name:e.currentSituation?.hexagramName},currentYao:{position:e.currentSituation?.yaoPosition||1,name:e.currentSituation?.yaoName},theme:e.currentSituation?.theme,themeDetail:e.currentSituation?.description,scenarios:e.eightScenarios,progressTheme:e.threeStageProcess?.progressTheme,changeTheme:e.threeStageProcess?.changeTheme};await this.resultPageController.displayResults(t),e.currentSituation&&this.updateChoiceCards(e.currentSituation)}if(this.displayCurrentSituation(e.currentSituation),console.log("ğŸ¯ [CRITICAL DEBUG] threeStageProcess check:",{hasVisualizer:!!this.visualizer,hasThreeStageProcess:!!e.threeStageProcess,threeStageProcessData:e.threeStageProcess,stagesCount:e.threeStageProcess?.stages?.length}),this.visualizer&&e.threeStageProcess){if(!document.getElementById("three-stage-visualizer")){const e=document.createElement("div");e.id="three-stage-visualizer",e.style.marginTop="2rem";const t=document.getElementById("resultArea");t&&t.appendChild(e),this.visualizer.initialize("three-stage-visualizer")}this.visualizer.drawThreeStageProcess(e.threeStageProcess,e.eightScenarios)}if(this.scenariosDisplay&&e.eightScenarios){if(!document.getElementById("eight-scenarios-display")){const e=document.createElement("div");e.id="eight-scenarios-display",e.style.marginTop="2rem";const t=document.getElementById("resultArea");t&&t.appendChild(e),this.scenariosDisplay.initialize("eight-scenarios-display")}e.eightScenarios&&e.eightScenarios.length>0?(this.scenariosDisplay.displayScenarios(e.eightScenarios,e.threeStageProcess),setTimeout(()=>{this.scenariosDisplay.animateDisplay()},100)):console.warn("âš ï¸ No eightScenarios data available for display")}const t=document.getElementById("resultArea");t&&(t.style.display="block",t.scrollIntoView({behavior:"smooth"})),window.futureAnalysisCompleted=!0;const i=document.getElementById("iching-simulator-section");i&&(i.style.display="block",i.style.opacity="1")}displayCurrentSituation(e){const t=document.getElementById("currentTitle");if(t){const i=this.generateHexagramVisual(e["å¦ç•ªå·"]);t.innerHTML=`\n          <div style="display: flex; align-items: center; justify-content: center; gap: 1rem;">\n            ${i}\n            <span>${e["å¦å"]} ${e["çˆ»"]}</span>\n          </div>\n        `}const i=document.getElementById("currentKeywords");i&&e["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]&&(i.textContent=e["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"].join(" / "));const n=document.getElementById("currentSummary");n&&(n.textContent=e["ç¾ä»£è§£é‡ˆã®è¦ç´„"]);const s=document.getElementById("recommendedDirection");if(s){const t=e["S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹"];let i="";i="èƒ½å‹•"===t?"ç©æ¥µçš„ã«è¡Œå‹•ã‚’èµ·ã“ã—ã€ä¸»ä½“çš„ã«çŠ¶æ³ã‚’åˆ‡ã‚Šé–‹ã„ã¦ã„ãã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚":"å—å‹•"===t?"çŠ¶æ³ã‚’æ…é‡ã«è¦³å¯Ÿã—ã€é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å¾…ã¤ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚":"ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã¡ãªãŒã‚‰ã€çŠ¶æ³ã«å¿œã˜ã¦æŸ”è»Ÿã«å¯¾å¿œã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚",s.textContent=i}this.updateChoiceCards(e)}generateHexagramVisual(e){const t=({1:"111111",2:"000000",3:"010001",4:"100010",5:"010111",6:"111010",7:"000010",8:"010000"}[e]||"000000").split("").reverse();let i='<div style="display: flex; flex-direction: column; gap: 2px;">';return t.forEach(e=>{i+="1"===e?'<div style="width: 40px; height: 4px; background: currentColor;"></div>':'<div style="display: flex; gap: 4px;"><div style="width: 18px; height: 4px; background: currentColor;"></div><div style="width: 18px; height: 4px; background: currentColor;"></div></div>'}),i+="</div>",i}updateChoiceCards(e){const t=document.getElementById("choice1"),i=document.getElementById("choice2");if(t&&e){const i=e["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||[];t.innerHTML=`\n          <h3 class="text-lg font-bold text-blue-300 mb-2">ãƒ†ãƒ¼ãƒã«å¾“ã†é“</h3>\n          <p class="text-sm text-gray-300 mb-3">ã€Œ${i.join("ã€")}ã€ã‚’å—ã‘å…¥ã‚Œã¦è¡Œå‹•ã™ã‚‹</p>\n          <div class="text-xs bg-blue-500/20 text-blue-200 px-2 py-1 rounded">\n            ${"èƒ½å‹•"===e["S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹"]?"ç©æ¥µçš„è¡Œå‹•":"æ…é‡ãªè¦³å¯Ÿ"}\n          </div>\n        `}if(i&&e){const t=e["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||[];i.innerHTML=`\n          <h3 class="text-lg font-bold text-emerald-300 mb-2">æ–°ãŸãªé“ã‚’æ¢ã‚‹</h3>\n          <p class="text-sm text-gray-300 mb-3">ã€Œ${t.join("ã€")}ã€ã¨ã¯ç•°ãªã‚‹é¸æŠã‚’æ¨¡ç´¢</p>\n          <div class="text-xs bg-emerald-500/20 text-emerald-200 px-2 py-1 rounded">\n            ${"èƒ½å‹•"===e["S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹"]?"æ…é‡ãªè»¢æ›":"ç©æ¥µçš„å¤‰é©"}\n          </div>\n        `}}handleScenarioSelection(e){console.log("ğŸ¯ Scenario selected:",e),this.visualizer&&this.visualizer.selectPath(e.path),this.displayScenarioDetails(e)}displayScenarioDetails(e){let t=document.getElementById("scenario-details");if(!t){t=document.createElement("div"),t.id="scenario-details",t.style.marginTop="2rem",t.style.padding="1.5rem",t.style.background="linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1))",t.style.borderRadius="12px",t.style.border="1px solid rgba(99, 102, 241, 0.3)";const e=document.getElementById("resultArea");e&&e.appendChild(t)}t.innerHTML=`\n        <h3 style="color: #A5B4FC; margin-bottom: 1rem;">\n          é¸æŠã•ã‚ŒãŸã‚·ãƒŠãƒªã‚ª: ${e.title}\n        </h3>\n        <div style="color: #E5E7EB;">\n          <p style="margin-bottom: 1rem;">${e.description}</p>\n          <div style="display: flex; gap: 2rem; margin-bottom: 1rem;">\n            <div>\n              <strong style="color: #FDE047;">æˆåŠŸç¢ºç‡:</strong> ${e.probability}%\n            </div>\n            <div>\n              <strong style="color: #FDE047;">æ˜“çµŒå‚ç…§:</strong> ${e.iChingReference.hexagram}\n            </div>\n          </div>\n          <div style="margin-top: 1rem;">\n            <strong style="color: #10B981;">æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:</strong>\n            <p style="margin-top: 0.5rem;">\n              ${this.generateActionRecommendation(e)}\n            </p>\n          </div>\n        </div>\n      `,t.scrollIntoView({behavior:"smooth"})}generateActionRecommendation(e){return{"conservative,collaborative,cautious":"ç¾çŠ¶ã‚’åŸºç›¤ã«ã€ä¿¡é ¼ã§ãã‚‹ä»²é–“ã¨å…±ã«æ…é‡ã«é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚æ€¥ãŒãšã€ç€å®Ÿãªä¸€æ­©ã‚’é‡è¦–ã—ã¦ãã ã•ã„ã€‚","conservative,collaborative,decisive":"æ—¢å­˜ã®æ çµ„ã¿ã‚’æ´»ç”¨ã—ãªãŒã‚‰ã€ãƒãƒ¼ãƒ ã§è¿…é€Ÿãªæ„æ€æ±ºå®šã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚å”åŠ›é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã—ã¦ãã ã•ã„ã€‚","conservative,independent,cautious":"è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã‚’ä¿ã¡ãªãŒã‚‰ã€ç‹¬è‡ªã®é“ã‚’æ…é‡ã«é–‹æ‹“ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ç„¦ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚","conservative,independent,decisive":"æ—¢å­˜ã®è³‡æºã‚’æ´»ç”¨ã—ã¤ã¤ã€ç‹¬è‡ªã®åˆ¤æ–­ã§ç´ æ—©ãè¡Œå‹•ã—ã¾ã—ã‚‡ã†ã€‚è‡ªä¿¡ã‚’æŒã£ã¦é€²ã‚“ã§ãã ã•ã„ã€‚","progressive,collaborative,cautious":"æ–°ã—ã„å¯èƒ½æ€§ã‚’ä»²é–“ã¨å…±ã«æ…é‡ã«æ¢æ±‚ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚é©æ–°ã¨å®‰å…¨æ€§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ã¦ãã ã•ã„ã€‚","progressive,collaborative,decisive":"ãƒãƒ¼ãƒ ä¸€ä¸¸ã¨ãªã£ã¦ã€å¤§èƒ†ãªå¤‰é©ã‚’è¿…é€Ÿã«å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ã€‚å‹¢ã„ã‚’å¤§åˆ‡ã«ã—ã¦ãã ã•ã„ã€‚","progressive,independent,cautious":"ç‹¬è‡ªã®é©æ–°çš„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã€è¨ˆç”»çš„ã«å®Ÿç¾ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚æº–å‚™ã‚’æ€ ã‚‰ãªã„ã§ãã ã•ã„ã€‚","progressive,independent,decisive":"è‡ªåˆ†ã®ç›´æ„Ÿã‚’ä¿¡ã˜ã¦ã€é©æ–°çš„ãªé“ã‚’è¿·ã‚ãšé€²ã¿ã¾ã—ã‚‡ã†ã€‚ä»ŠãŒãã®æ™‚ã§ã™ã€‚"}[e.path.join(",")]||"çŠ¶æ³ã‚’ã‚ˆãè¦³å¯Ÿã—ã€æœ€é©ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¡Œå‹•ã‚’èµ·ã“ã—ã¾ã—ã‚‡ã†ã€‚"}showLoading(e){const t=document.getElementById("loadingSpinner"),i=document.getElementById("originalIcon"),n=document.getElementById("buttonText"),s=document.getElementById("aiGuessBtn");e?(t&&(t.style.display="block"),i&&(i.style.display="none"),n&&(n.textContent="åˆ†æä¸­..."),s&&(s.disabled=!0)):(t&&(t.style.display="none"),i&&(i.style.display="block"),n&&(n.textContent="åˆ†æå®Ÿè¡Œ"),s&&(s.disabled=!1))}saveAnalysis(e){if("undefined"!=typeof localStorage){const t=JSON.parse(localStorage.getItem("future_simulator_history")||"[]");t.unshift(e),t.length>10&&(t.length=10),localStorage.setItem("future_simulator_history",JSON.stringify(t))}}getAnalysisHistory(){return"undefined"!=typeof localStorage?JSON.parse(localStorage.getItem("future_simulator_history")||"[]"):[]}}"undefined"!=typeof window&&(window.FutureSimulatorIntegration=FutureSimulatorIntegration,window.futureSimulator=new FutureSimulatorIntegration,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.futureSimulator.initialize()}):setTimeout(()=>{window.futureSimulator.initialize()},100)),console.log("âœ… FutureSimulatorIntegration loaded")}("undefined"!=typeof window&&window);