window.BinaryTreeCompleteDisplay={display:function(n){console.log("ğŸŒ³ Binary Tree Complete Display v2.1 é–‹å§‹ - H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆç‰ˆ"),window.futureAnalysisCompleted?(n&&n.finalEightPaths?(console.log("ğŸŒ³ Using provided result data"),n.branchingData||(n.branchingData=this.generateBranchingData(n.finalEightPaths))):(console.log("ğŸŒ³ Generating H384-integrated result with advancing/changing line concepts"),n=this.generateDefaultResultWithH384Data()),this.loadChartJS(()=>{this.renderCompleteAnalysis(n)})):console.log("â³ Binary Tree waiting for analysis completion")},generateDefaultResultWithH384Data:function(){if(console.log("ğŸ¯ GENUINE TEXT ANALYSIS: Starting authentic I Ching text analysis..."),!window.H384_DATA||0===window.H384_DATA.length)throw console.error("âŒ H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"),new Error("H384 Database not loaded");if(!window.H64_DATA||0===window.H64_DATA.length)throw console.error("âŒ H64ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"),new Error("H64 Database not loaded");const n=window.latestUserInput||"çµ±åˆçš„ãªè¦–ç‚¹ã§æœªæ¥ã®é¸æŠè‚¢ã‚’æ¢ç´¢ã—ãŸã„ã€‚";console.log("ğŸ“ Analyzing user input:",n.substring(0,50)+"...");const e=this.analyzeTextToSelectHexagram(n);console.log("â˜¯ï¸ Selected hexagram based on text analysis:",e);const t=this.findAppropriateLineFromHexagram(e,n);if(console.log("ğŸ“Š Selected appropriate line:",t),window.BinaryTreeFutureEngine||"undefined"!=typeof BinaryTreeFutureEngine)try{const a=new(window.BinaryTreeFutureEngine||BinaryTreeFutureEngine);console.log("âœ… Using TEXT-BASED hexagram and line selection (NO RANDOM)");const r=a.generateBinaryTreeFutures(t,{inputText:n,useRealH384Data:!0,hexagramAnalysis:e,textAnalysisMode:!0});if(r&&r.finalEightPaths)return console.log("ğŸŒ³ Using GENUINE TEXT ANALYSIS with H384 database integration"),{currentLine:r.currentLine||t,lineData:r.lineData,finalEightPaths:r.finalEightPaths,branchingData:this.generateBranchingData(r.finalEightPaths),textAnalysis:e}}catch(a){console.error("âŒ BinaryTreeFutureEngine error:",a)}return console.warn("âš ï¸ BinaryTreeFutureEngine not available, using TEXT-BASED H384 database fallback"),this.generateTextBasedH384Result(n,e,t)},generateH384DatabaseOnlyResult:function(){console.log("ğŸ”„ Using H384 database-only fallback for scenario generation");const n=Math.floor(Math.random()*window.H384_DATA.length),e=window.H384_DATA[n].é€šã—ç•ªå·,t=this.getActualH384Data(e),a=[];return[{id:"progress_continue_a",name:"ç¶™ç¶šå¼·åŒ–ãƒ»å¼·åŒ–å‹",prob:.078},{id:"progress_continue_b",name:"ç¶™ç¶šå¼·åŒ–ãƒ»ç©å¥å‹",prob:.117},{id:"progress_adjust_a",name:"èª¿æ•´é€²è¡Œãƒ»å¼·åŒ–å‹",prob:.143},{id:"progress_adjust_b",name:"èª¿æ•´é€²è¡Œãƒ»ç©å¥å‹",prob:.214},{id:"transform_complete_a",name:"æ ¹æœ¬è»¢æ›ãƒ»å¼·åŒ–å‹",prob:.116},{id:"transform_complete_b",name:"æ ¹æœ¬è»¢æ›ãƒ»ç©å¥å‹",prob:.173},{id:"transform_integrate_a",name:"çµ±åˆç™ºå±•ãƒ»å¼·åŒ–å‹",prob:.211},{id:"transform_integrate_b",name:"çµ±åˆç™ºå±•ãƒ»ç©å¥å‹",prob:.316}].forEach((n,r)=>{const i=e+Math.floor(20*Math.random())-10,o=Math.max(1,Math.min(386,i)),s=this.getActualH384Data(o);a.push({pathIndex:r+1,pathId:n.id,name:n.name,probability:n.prob,currentLine:e,targetLine:o,lineData:s,score:Math.floor(50+50*Math.random()),keywords:s.ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰||["é€²æ­©","èª¿æ•´","å¤‰åŒ–"],description:`ç¬¬${r+1}ã®é“: ${n.name}`,hexagramTransformation:{from:{number:t.å¦ç•ªå·,name:t.å¦å,yao:t.çˆ»},to:{number:s.å¦ç•ªå·,name:s.å¦å,yao:s.çˆ»}}})}),{currentLine:e,lineData:t,finalEightPaths:a,branchingData:this.generateBranchingData(a)}},getActualH384Data:function(n){if(!window.H384_DATA)throw new Error("H384 Database not available");const e=window.H384_DATA.find(e=>e.é€šã—ç•ªå·===n);if(!e){const e=window.H384_DATA.reduce((e,t)=>Math.abs(t.é€šã—ç•ªå·-n)<Math.abs(e.é€šã—ç•ªå·-n)?t:e);return console.warn(`Line ${n} not found, using closest: ${e.é€šã—ç•ªå·}`),e}return e},getActualH64Data:function(n){if(!window.H64_DATA)throw new Error("H64 Database not available");const e=window.H64_DATA.find(e=>e.å¦ç•ªå·===n);if(!e)throw new Error(`Hexagram ${n} not found in database`);return e},calculateProbabilityFromLine:function(n,e){if(!n)return.25;const t=n.ä½ç½®||3,a="é™½"===n.é™°é™½;n.é€šã—ç•ªå·;switch(e){case"advancing_continue":const n=t<=3?.35:.25;return a?n+.05:n;case"advancing_transform":const e=t>=2&&t<=4?.3:.2;return a?e:e+.06;case"changing_integrate":return(t>=4?.32:.22)+.02*Math.abs(t-3.5);case"changing_complete":return t>=4&&a?.28:t<=3&&!a?.26:.22;case"continue_strong":return a?.3+.02*t:.2+.01*t;case"continue_transform":return a?.25-.01*t:.25+.01*t;case"transform_integrate":return a?.2+.02*t:.3+.01*t;case"transform_step":return a?.2+.01*t:.25-.01*t;default:return.25}},generateBranchingData:function(n){const e={x:0,y:.5,label:"ç¾åœ¨"},t=[{x:1,y:.3,probability:n.slice(0,4).reduce((n,e)=>n+e.probability,0),label:"ç¶™ç¶šè·¯ç·š",parent:0},{x:1,y:.7,probability:n.slice(4,8).reduce((n,e)=>n+e.probability,0),label:"è»¢æ›è·¯ç·š",parent:0}],a=[{x:2,y:.15,probability:n[0].probability+n[1].probability,label:"ç¶™ç¶šå¼·åŒ–",parent:0},{x:2,y:.35,probability:n[2].probability+n[3].probability,label:"ç¶™ç¶šèª¿æ•´",parent:0},{x:2,y:.55,probability:n[4].probability+n[5].probability,label:"è»¢æ›çµ±åˆ",parent:1},{x:2,y:.75,probability:n[6].probability+n[7].probability,label:"è»¢æ›æ®µéš",parent:1}],r=n.map((n,e)=>({x:3,y:.05+.125*e,probability:n.probability,label:`ãƒ‘ã‚¹${e+1}`,title:n.title,parent:Math.floor(e/2)}));return{phase1:e,phase2:t,phase3:a,phase4:r,allPhases:[e,...t,...a,...r]}},loadChartJS:function(n){if(window.Chart)return void n();const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js",e.onload=n,document.head.appendChild(e)},renderCompleteAnalysis:function(n){const e=document.getElementById("resultArea");e&&(e.style.display="block");const t=document.querySelector("#scenarioCardsContainer")||document.querySelector("#resultsContainer")||document.querySelector(".main-content")||document.querySelector("#results-container")||document.querySelector("#binary-tree-results")||document.body;if(t){if(console.log("âœ… BinaryTreeCompleteDisplay container found:",t.id||t.className),"scenarioCardsContainer"===t.id){t.innerHTML=n.finalEightPaths.map((n,e)=>this.generatePathCard(n,e)).join(""),console.log("âœ… Scenario cards generated directly in scenarioCardsContainer:",n.finalEightPaths.length,"cards"),this.integrateWithResultPageController(n);const e=document.getElementById("originalGraphsContainer");e&&(e.style.display="block",console.log("âœ… Original graphs container restored and visible"))}else t.innerHTML=this.generateHTML(n);setTimeout(()=>{this.renderBranchingChart(n)},100),this.setupDownload(n)}else console.error("âŒ No container found for BinaryTreeCompleteDisplay results")},generateHTML:function(n){if(!n||!n.finalEightPaths)throw console.error("âŒ åˆ†æçµæœãŒã‚ã‚Šã¾ã›ã‚“"),new Error("Analysis result required");const e=n.finalEightPaths.slice(4,8).reduce((n,e)=>n+e.probability,0),t=n.finalEightPaths.slice(0,4).reduce((n,e)=>n+e.probability,0),a=n.finalEightPaths.reduce((n,e)=>e.probability>n.probability?e:n);if(!n.lineData)throw new Error("Line data is required from database");const r=n.lineData.å¦å,i=n.lineData.çˆ»,o=n.lineData.å¦ç•ªå·;return`\n            <div class="binary-tree-complete-analysis" style="padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; color: white; margin: 20px 0;">\n                \n                \x3c!-- ã‚¿ã‚¤ãƒˆãƒ« --\x3e\n                <div style="text-align: center; margin-bottom: 40px;">\n                    <h2 style="font-size: 2em; margin-bottom: 10px; color: white; display: flex; align-items: center; justify-content: center; gap: 1rem;">\n                        ${this.generateHexagramVisual(o)}\n                        <span>ğŸŒ³ ã‚ãªãŸã®ç¾åœ¨åœ°ï¼š${r} ${i}</span>\n                    </h2>\n                    <p style="font-size: 1.2em; opacity: 0.95;">æ˜“çµŒã®å¤‰åŒ–ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆé€²çˆ»ãƒ»å¤‰çˆ»ï¼‰ã«ã‚ˆã‚‹8ã¤ã®æœªæ¥ãƒ‘ã‚¹</p>\n                    ${n.lineData?`<p style="font-size: 0.9em; opacity: 0.8;">åŸºæº–: ${n.lineData.å¦å} ${n.lineData.çˆ»å}</p>`:""}\n                </div>\n\n                \x3c!-- ROOT CAUSE FIX: ç¾åœ¨ã®çŠ¶æ³ãƒ†ãƒ¼ãƒãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç‰¹å®šè¡¨ç¤º --\x3e\n                <div style="background: rgba(255,255,255,0.15); border-radius: 16px; padding: 25px; margin-bottom: 30px; border-left: 4px solid #fbbf24;">\n                    <h3 style="color: #fbbf24; margin-bottom: 15px;">ğŸ” ç¾åœ¨ã®çŠ¶æ³è¨ºæ–­</h3>\n                    ${this.generateCurrentSituationAnalysis(n)}\n                </div>\n\n                \x3c!-- ROOT CAUSE FIX: é€²çˆ»ãƒ»å¤‰çˆ»ã®æ¦‚å¿µèª¬æ˜ --\x3e\n                <div style="background: rgba(255,255,255,0.15); border-radius: 16px; padding: 25px; margin-bottom: 30px; border-left: 4px solid #22c55e;">\n                    <h3 style="color: #22c55e; margin-bottom: 15px;">âš–ï¸ é€²çˆ»ãƒ»å¤‰çˆ»ã«ã‚ˆã‚‹é¸æŠè‚¢</h3>\n                    ${this.generateProgressChangeExplanation(n)}\n                </div>\n\n                \x3c!-- ROOT CAUSE FIX: 3æ®µéšãƒ•ã‚§ãƒ¼ã‚ºå¤‰åŒ–ãƒ—ãƒ­ã‚»ã‚¹ --\x3e\n                <div style="background: rgba(255,255,255,0.15); border-radius: 16px; padding: 25px; margin-bottom: 30px; border-left: 4px solid #3b82f6;">\n                    <h3 style="color: #3b82f6; margin-bottom: 15px;">ğŸ“Š 3æ®µéšå¤‰åŒ–ãƒ—ãƒ­ã‚»ã‚¹</h3>\n                    ${this.generateThreePhaseProcess(n)}\n                </div>\n\n                \x3c!-- åˆ†å²å‹æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ• --\x3e\n                <div style="background: white; border-radius: 16px; padding: 30px; margin-bottom: 30px;">\n                    <h3 style="color: #4338ca; margin-bottom: 20px;">ğŸ“ˆ æœªæ¥åˆ†å²ãƒ‘ã‚¹ã®å¯è¦–åŒ–</h3>\n                    <div style="height: 400px; position: relative;">\n                        <canvas id="branchingChart"></canvas>\n                    </div>\n                    <div style="margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 8px;">\n                        <p style="color: #4b5563; margin: 0; font-size: 0.9em;">\n                            <strong>èª¬æ˜:</strong> ç¾åœ¨ã‹ã‚‰å§‹ã¾ã‚Šã€2ã¤â†’4ã¤â†’æœ€çµ‚çš„ã«8ã¤ã®ãƒ‘ã‚¹ã¸åˆ†å²ã™ã‚‹æœªæ¥ã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚\n                            ç·šã®å¤ªã•ã¯ç¢ºç‡ã®é«˜ã•ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚\n                        </p>\n                    </div>\n                </div>\n\n                \x3c!-- 8ã‚·ãƒŠãƒªã‚ªã‚«ãƒ¼ãƒ‰ï¼ˆProgressive Disclosureï¼‰ --\x3e\n                <div id="scenariosSection" style="margin-bottom: 40px;">\n                    <div style="text-align: center; margin-bottom: 20px;">\n                        <button id="toggleScenariosBtn" onclick="window.BinaryTreeCompleteDisplay.toggleScenarios()" \n                                style="background: white; color: #4338ca; padding: 12px 30px; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">\n                            ğŸ”® 8ã¤ã®æœªæ¥ã‚·ãƒŠãƒªã‚ªã‚’è¡¨ç¤º\n                        </button>\n                    </div>\n                    <div id="scenariosContainer" style="display: none; animation: fadeIn 0.5s;">\n                        <div style="margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px; text-align: center;">\n                            <p style="margin: 0; opacity: 0.9;">3æ®µéšã®é¸æŠã«ã‚ˆã‚‹8ã¤ã®æœªæ¥ãƒ‘ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>\n                        </div>\n                        <div id="scenariosGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">\n                            ${n.finalEightPaths.map((n,e)=>this.generatePathCard(n,e)).join("")}\n                        </div>\n                    </div>\n                </div>\n                \n                <style>\n                    @keyframes fadeIn {\n                        from { opacity: 0; transform: translateY(-10px); }\n                        to { opacity: 1; transform: translateY(0); }\n                    }\n                    @keyframes fadeOut {\n                        from { opacity: 1; transform: translateY(0); }\n                        to { opacity: 0; transform: translateY(-10px); }\n                    }\n                </style>\n\n                \x3c!-- HaQeiçµ±åˆåˆ†æ --\x3e\n                ${this.generateInsightSection(n,e,t,a)}\n\n                \x3c!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ --\x3e\n                <div style="text-align: center; margin-top: 30px;">\n                    <button onclick="window.print()" style="background: white; color: #4338ca; padding: 12px 30px; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin: 0 10px;">\n                        ğŸ“„ PDFã§ä¿å­˜\n                    </button>\n                    <button onclick="window.BinaryTreeCompleteDisplay.downloadResults()" style="background: white; color: #4338ca; padding: 12px 30px; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin: 0 10px;">\n                        ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\n                    </button>\n                </div>\n            </div>\n        `},generatePathCard:function(n,e){const t=n.probability||0,a=t>.13?"Sãƒ©ãƒ³ã‚¯":t>.11?"Aãƒ©ãƒ³ã‚¯":"Bãƒ©ãƒ³ã‚¯",r=t>.13?"#22c55e":t>.11?"#3b82f6":"#f59e0b",i=n.pathIndex||e+1,o=n.title||`ã‚·ãƒŠãƒªã‚ª ${i}`,s=["ğŸ¯","ğŸš€","ğŸ’¡","ğŸŒŸ","ğŸ”®","âš¡","ğŸŒˆ","âœ¨"][e]||"ğŸ¯",l=["#22c55e","#3b82f6","#a855f7","#ec4899","#fb923c","#facc15","#0ea5e9","#6366f1"][e]||"#6366f1";n.transformationInfo&&(n.transformationInfo.hexagramChange,n.transformationInfo.lineChange,n.transformationInfo.type,n.transformationInfo.approach),n.targetHexagram&&(n.targetHexagram.name,n.targetHexagram.line,n.targetHexagram.interpretation,n.targetHexagram.keywords&&n.targetHexagram.keywords.join(", "),n.targetHexagram.score);return`\n            <div class="scenario-card scenario-item choice-card" style="background: rgba(255,255,255,0.95); border-radius: 12px; padding: 20px; color: #333; border-left: 4px solid ${l}; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;"\n                 onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.15)';"\n                 onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';"\n                 onclick="window.BinaryTreeCompleteDisplay.showPathTransformation(${i}, ${JSON.stringify(n).replace(/"/g,"&quot;")})">\n                \n                \x3c!-- ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ† --\x3e\n                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">\n                    <div style="display: flex; align-items: center;">\n                        <span style="font-size: 1.5em; margin-right: 10px;">${s}</span>\n                        <span style="font-weight: bold; color: ${l};">ãƒ‘ã‚¹${i}</span>\n                    </div>\n                    <span style="background: ${r}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8em; font-weight: 600;">${a}</span>\n                </div>\n                \n                \x3c!-- ã‚¿ã‚¤ãƒˆãƒ« --\x3e\n                <div style="font-size: 1.1em; font-weight: 600; margin-bottom: 10px; color: #4338ca;">\n                    ${o}\n                </div>\n                \n                \x3c!-- çµŒè·¯è¡¨ç¤º --\x3e\n                <div style="background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); padding: 8px 12px; border-radius: 8px; margin-bottom: 10px;">\n                    çµŒè·¯: ${n.route?n.route.join(" â†’ "):"transform â†’ integrate â†’ option_b"}\n                </div>\n                \n                \x3c!-- ç¢ºç‡è¡¨ç¤º --\x3e\n                <div style="background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); padding: 8px 12px; border-radius: 8px; margin-bottom: 10px;">\n                    ç¢ºç‡: ${(100*t).toFixed(1)}%\n                </div>\n                \n                \x3c!-- èª¬æ˜ --\x3e\n                <div style="font-size: 0.9em; color: #666; margin: 10px 0;">\n                    ${n.description||n.fullDescription||"ç¾çŠ¶ã‚’åŸºç›¤ã¨ã—ãªãŒã‚‰ã€æ…é‡ãªå”åŠ›é–¢ä¿‚ã‚’é‡è¦–ã—ãŸé“ç­‹ã€‚"}\n                </div>\n                \n                \x3c!-- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ --\x3e\n                <div style="margin: 10px 0;">\n                    <div style="font-size: 0.8em; color: #888; margin-bottom: 5px;">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</div>\n                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">\n                        ${(n.lineData?.ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰||n.targetHexagram?.keywords||["ä¿¡å¿µ","å …æŒ","å¿è€"]).map(n=>`<span style="background: rgba(99, 102, 241, 0.1); color: #6366f1; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">${n}</span>`).join("")}\n                    </div>\n                </div>\n                \n                \x3c!-- æ˜“çµŒæƒ…å ±ï¼ˆH384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è©³ç´°ï¼‰ --\x3e\n                <div style="margin: 10px 0; padding: 12px; background: linear-gradient(135deg, rgba(79, 70, 229, 0.1) 0%, rgba(99, 102, 241, 0.05) 100%); border-radius: 8px; border-left: 3px solid #6366f1;">\n                    <div style="font-size: 0.9em; color: #4338ca; margin-bottom: 8px; font-weight: 600;">\n                        â˜¯ ${n.lineData?.å¦å||n.targetHexagram?.name||"å¤©å±±é¯"} (ç¬¬${n.lineData?.å¦ç•ªå·||n.targetHexagram?.number||"33"}å¦)\n                    </div>\n                    <div style="font-size: 0.8em; color: #6366f1; margin-bottom: 5px;">\n                        <strong>çˆ»ä½:</strong> ${n.lineData?.çˆ»||n.targetHexagram?.line||"å…­äºŒ"}\n                    </div>\n                    <div style="font-size: 0.8em; color: #4f46e5; margin-bottom: 5px;">\n                        <strong>ç¾ä»£è§£é‡ˆ:</strong> ${n.lineData?.ç¾ä»£è§£é‡ˆã®è¦ç´„||n.targetHexagram?.interpretation||"ç‰©ç†çš„ã«é€€ã‘ãªã„çŠ¶æ³ã§ã€è‡ªã‚‰ã®ä¿¡å¿µã‚„åŸå‰‡ã‚’ã€ä¸ˆå¤«ãªé©ã®ã‚ˆã†ã«å›ºãå®ˆã‚ŠæŠœãã€‚å¤–éƒ¨ã®åœ§åŠ›ã‚„èª˜æƒ‘ã«å±ˆã—ãªã„ã€å†…ãªã‚‹å¼·å›ºãªæ„å¿—ã€‚"}\n                    </div>\n                    ${n.lineData?.S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢?`<div style="font-size: 0.8em; color: #7c3aed;">\n                        <strong>H384ã‚¹ã‚³ã‚¢:</strong> ${n.lineData.S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢}ç‚¹\n                    </div>`:""}\n                </div>\n                \n                \x3c!-- å¤‰åŒ–ãƒ—ãƒ­ã‚»ã‚¹è¡¨ç¤ºãƒœã‚¿ãƒ³ --\x3e\n                <div style="text-align: center; margin-top: 15px;">\n                    <div style="background: rgba(99, 102, 241, 0.2); color: #4338ca; padding: 8px 16px; border-radius: 6px; font-size: 0.9em;">\n                        ğŸ”® å¤‰åŒ–ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’è¦‹ã‚‹\n                    </div>\n                </div>\n            </div>\n        `},generateInsightSection:function(n,e,t,a){const r=e>t?"è»¢æ›":"ç¶™ç¶š";return`\n            <div style="background: rgba(255,255,255,0.98); border-radius: 16px; padding: 30px; color: #333;">\n                <h3 style="color: #4338ca; margin-bottom: 25px;">ğŸ” HaQeiå“²å­¦ã«ã‚ˆã‚‹çµ±åˆçš„æ´å¯Ÿ</h3>\n                \n                \x3c!-- æ˜“çµŒãƒ™ãƒ¼ã‚¹åˆ†æ --\x3e\n                ${n.lineData?`\n                <div style="margin-bottom: 25px;">\n                    <h4 style="color: #6366f1; margin-bottom: 15px;">ğŸ“– æ˜“çµŒãƒ™ãƒ¼ã‚¹åˆ†æ</h4>\n                    <div style="background: #f9fafb; padding: 20px; border-radius: 12px; line-height: 1.8;">\n                        <p style="margin-bottom: 10px;">\n                            <strong>å¦è±¡:</strong> ${n.lineData.å¦å} - ${n.lineData.çˆ»å}\n                        </p>\n                        <p style="margin-bottom: 10px;">\n                            <strong>ç¾ä»£è§£é‡ˆ:</strong> ${n.lineData.ç¾ä»£è§£é‡ˆ||"å¤‰åŒ–ã®æ™‚æœŸã«ãŠã‘ã‚‹æ–°ãŸãªæ©Ÿä¼š"}\n                        </p>\n                        <p>\n                            <strong>è¡Œå‹•æŒ‡é‡:</strong> ${n.lineData.è¡Œå‹•||"çŠ¶æ³ã‚’è¦‹æ¥µã‚ã¦æ…é‡ã«é€²ã‚€"}\n                        </p>\n                    </div>\n                </div>\n                `:""}\n                \n                \x3c!-- æœªæ¥å‚¾å‘åˆ†æ --\x3e\n                <div style="margin-bottom: 25px;">\n                    <h4 style="color: #6366f1; margin-bottom: 15px;">ğŸ“Š ã‚ãªãŸã®æœªæ¥å‚¾å‘åˆ†æ</h4>\n                    <div style="background: #f9fafb; padding: 20px; border-radius: 12px; line-height: 1.8;">\n                        <p style="margin-bottom: 15px;">\n                            <strong>ä¸»å‚¾å‘:</strong> ã€Œ${r}ã€ã®æµã‚ŒãŒå¼·ã¾ã£ã¦ã„ã¾ã™ï¼ˆ${r}ç³»ãƒ‘ã‚¹è¨ˆ: ${(100*("è»¢æ›"===r?e:t)).toFixed(0)}%ï¼‰ã€‚\n                        </p>\n                        <p style="margin-bottom: 15px;">\n                            <strong>æœ€æœ‰åŠ›ã‚·ãƒŠãƒªã‚ª:</strong> ã€Œ${a.title}ã€ï¼ˆ${(100*a.probability).toFixed(1)}%ï¼‰\n                        </p>\n                        <p>\n                            <strong>ãƒãƒ©ãƒ³ã‚¹æŒ‡æ¨™:</strong> ç¶™ç¶š${(100*t).toFixed(0)}% vs è»¢æ›${(100*e).toFixed(0)}%\n                        </p>\n                    </div>\n                </div>\n\n                \x3c!-- åˆ†å²é¸æŠã‚¬ã‚¤ãƒ‰ --\x3e\n                <div style="margin-bottom: 25px;">\n                    <h4 style="color: #6366f1; margin-bottom: 15px;">ğŸ§­ åˆ†å²é¸æŠã«ãŠã‘ã‚‹é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h4>\n                    <div style="display: grid; gap: 15px;">\n                        <div style="background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); padding: 15px; border-radius: 10px;">\n                            <strong>ç¬¬1åˆ†å²:</strong> ç¾çŠ¶ç¶­æŒã‹å¤‰é©ã‹ã®åŸºæœ¬æ–¹é‡\n                        </div>\n                        <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 15px; border-radius: 10px;">\n                            <strong>ç¬¬2åˆ†å²:</strong> ç©æ¥µæ€§ã‹æ…é‡æ€§ã‹ã®è¡Œå‹•æ§˜å¼\n                        </div>\n                        <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 15px; border-radius: 10px;">\n                            <strong>ç¬¬3åˆ†å²:</strong> å€‹äººæœ€é©ã‹å…¨ä½“æœ€é©ã‹ã®ä¾¡å€¤åŸºæº–\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ --\x3e\n                <div style="margin-bottom: 25px;">\n                    <h4 style="color: #6366f1; margin-bottom: 15px;">ğŸ’¡ å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h4>\n                    <div style="background: #f9fafb; padding: 20px; border-radius: 12px;">\n                        <ol style="line-height: 2; margin: 0; padding-left: 20px;">\n                            <li><strong>çŸ­æœŸï¼ˆ3ãƒ¶æœˆï¼‰:</strong> ç¾åœ¨ã®å¼·ã¿ã‚’èªè­˜ã—åŸºç›¤ã‚’å›ºã‚ã‚‹</li>\n                            <li><strong>ä¸­æœŸï¼ˆ6ãƒ¶æœˆï¼‰:</strong> é¸æŠã—ãŸæ–¹å‘æ€§ã¸ã®æ®µéšçš„ç§»è¡Œ</li>\n                            <li><strong>é•·æœŸï¼ˆ1å¹´ï¼‰:</strong> æ–°ãŸãªçŠ¶æ…‹ã§ã®å®‰å®šã¨æ¬¡ã®æˆé•·æº–å‚™</li>\n                        </ol>\n                    </div>\n                </div>\n\n                \x3c!-- HaQeiå“²å­¦ç·æ‹¬ --\x3e\n                <div>\n                    <h4 style="color: #6366f1; margin-bottom: 15px;">ğŸ¯ HaQeiå“²å­¦ã®æ ¸å¿ƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h4>\n                    <div style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); padding: 20px; border-radius: 12px; color: white; text-align: center; font-size: 1.1em; line-height: 1.6;">\n                        ã€Œ8ã¤ã®ãƒ‘ã‚¹ã¯å…¨ã¦å¯èƒ½æ€§ã§ã™ã€‚é‡è¦ãªã®ã¯é¸æŠã§ã¯ãªãã€é¸ã‚“ã é“ã§ã®å®Ÿè·µã§ã™ã€‚ã€\n                    </div>\n                </div>\n            </div>\n        `},renderBranchingChart:function(n){const e=document.getElementById("branchingChart");if(!e)return void console.warn("âš ï¸ branchingChart canvas element not found - skipping chart render");if(!window.Chart)return void console.warn("âš ï¸ Chart.js not available - skipping chart render");this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null,console.log("ğŸ—‘ï¸ Previous Chart.js instance destroyed")),Chart.getChart(e)?.destroy();const t=e.getContext("2d");if(!t)return void console.error("Could not get 2D context from canvas");const a=n.branchingData;if(!a)return;const r=this.generateBranchingDatasets(a);this.chartInstance=new Chart(t,{type:"line",data:{labels:["ç¾åœ¨","ãƒ•ã‚§ãƒ¼ã‚º1","ãƒ•ã‚§ãƒ¼ã‚º2","ãƒ•ã‚§ãƒ¼ã‚º3"],datasets:r},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom"},tooltip:{callbacks:{label:function(n){const e=n.dataset,t=n.parsed.y;return`${e.label}: ${t.toFixed(1)}ç‚¹ (${(100*e.probability).toFixed(1)}%)`}}}},scales:{x:{title:{display:!0,text:"æ™‚é–“çµŒé â†’"}},y:{min:0,max:100,title:{display:!0,text:"åŸºæœ¬ã‚¹ã‚³ã‚¢ (ç‚¹)"},ticks:{display:!0,callback:function(n){return n+"ç‚¹"}}}},elements:{line:{tension:.4},point:{radius:6,hoverRadius:8}}}}),console.log("âœ… åˆ†å²å‹æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•æç”»å®Œäº†")},generateBranchingDatasets:function(n){const e=[],t=["rgba(34, 197, 94, 0.8)","rgba(59, 130, 246, 0.8)","rgba(168, 85, 247, 0.8)","rgba(236, 72, 153, 0.8)","rgba(251, 146, 60, 0.8)","rgba(250, 204, 21, 0.8)","rgba(14, 165, 233, 0.8)","rgba(99, 102, 241, 0.8)"];return n.phase4.forEach((a,r)=>{const i=this.tracePath(n,r);e.push({label:a.title||`ãƒ‘ã‚¹${r+1}`,data:i,borderColor:t[r],backgroundColor:t[r].replace("0.8","0.2"),borderWidth:2+10*a.probability,probability:a.probability,fill:!1})}),e},tracePath:function(n,e){const t=[],a=n.phase4[e],calculateScore=n=>Math.max(10,Math.min(100,100*n+20*Math.random()-10));t.push({x:0,y:50});const r=calculateScore((e<4?n.phase2[0]:n.phase2[1]).probability);t.push({x:1,y:r});const i=Math.floor(e/2),o=calculateScore(n.phase3[i].probability);t.push({x:2,y:o});const s=calculateScore(a.probability);return t.push({x:3,y:s}),t},toggleScenarios:function(){const n=document.getElementById("scenariosContainer"),e=document.getElementById("toggleScenariosBtn");n&&("none"===n.style.display?(n.style.display="block",e.innerHTML="ğŸ” 8ã¤ã®ã‚·ãƒŠãƒªã‚ªã‚’éš ã™",e.style.background="rgba(255,255,255,0.9)",setTimeout(()=>{n.scrollIntoView({behavior:"smooth",block:"nearest"})},100)):(n.style.animation="fadeOut 0.3s",setTimeout(()=>{n.style.display="none",n.style.animation="fadeIn 0.5s",e.innerHTML="ğŸ”® 8ã¤ã®æœªæ¥ã‚·ãƒŠãƒªã‚ªã‚’è¡¨ç¤º",e.style.background="white"},300)))},togglePathDetails:function(n,e){const t=document.getElementById(n),a=document.getElementById(e);t&&a&&("none"===t.style.display?(t.style.display="block",a.innerHTML="ğŸ”¼ è©³ç´°ã‚’é–‰ã˜ã‚‹",a.style.background="rgba(239, 68, 68, 0.2)",a.style.color="#dc2626"):(t.style.display="none",a.innerHTML="ğŸ” è©³ç´°ã‚’è¦‹ã‚‹",a.style.background="rgba(99, 102, 241, 0.2)",a.style.color="#A5B4FC"))},showPathTransformation:function(n,e){console.log(`ğŸ”® Showing transformation process for path ${n}:`,e);const t=document.createElement("div");t.id="transformation-modal-overlay",t.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.8);\n            z-index: 1000;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            animation: fadeIn 0.3s ease-out;\n        ";const a=document.createElement("div");a.style.cssText="\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            border-radius: 20px;\n            padding: 30px;\n            max-width: 80%;\n            max-height: 80%;\n            overflow-y: auto;\n            color: white;\n            animation: slideInUp 0.4s ease-out;\n            position: relative;\n        ",a.innerHTML=this.generateTransformationProcessHTML(n,e),t.appendChild(a),document.body.appendChild(t),t.addEventListener("click",n=>{n.target===t&&this.closeTransformationModal()});const closeOnEscape=n=>{"Escape"===n.key&&(this.closeTransformationModal(),document.removeEventListener("keydown",closeOnEscape))};document.addEventListener("keydown",closeOnEscape),setTimeout(()=>this.animateTransformationProcess(),500)},closeTransformationModal:function(){const n=document.getElementById("transformation-modal-overlay");n&&(n.style.animation="fadeOut 0.3s ease-out",setTimeout(()=>{document.body.removeChild(n)},300))},generateTransformationProcessHTML:function(n,e){const t=["ğŸ¯","ğŸš€","ğŸ’¡","ğŸŒŸ","ğŸ”®","âš¡","ğŸŒˆ","âœ¨"];return`\n            \x3c!-- é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ --\x3e\n            <button onclick="window.BinaryTreeCompleteDisplay.closeTransformationModal()" \n                    style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2em;">\n                âœ•\n            </button>\n            \n            \x3c!-- ã‚¿ã‚¤ãƒˆãƒ« --\x3e\n            <div style="text-align: center; margin-bottom: 30px;">\n                <h2 style="font-size: 2em; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 1rem;">\n                    ${t[(n-1)%t.length]} å¤‰åŒ–ã®ãƒ—ãƒ­ã‚»ã‚¹ï¼šãƒ‘ã‚¹${n}\n                </h2>\n                <p style="font-size: 1.1em; opacity: 0.9;">${e.title||`ã‚·ãƒŠãƒªã‚ª ${n}`}</p>\n            </div>\n            \n            \x3c!-- å¤‰åŒ–ãƒ—ãƒ­ã‚»ã‚¹ã®æ®µéšè¡¨ç¤º --\x3e\n            <div id="transformation-stages" style="margin-bottom: 30px;">\n                <div class="transformation-stage" data-stage="0" style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px; opacity: 0.3; transform: translateX(-20px); transition: all 0.6s ease-out;">\n                    <div style="display: flex; align-items: center; margin-bottom: 10px;">\n                        <span style="background: #22c55e; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px;">1</span>\n                        <h3 style="margin: 0; font-size: 1.2em;">ç¾åœ¨ã®çŠ¶æ³</h3>\n                    </div>\n                    <div style="margin-left: 45px;">\n                        <p style="margin: 5px 0;"><strong>å¦:</strong> ${e.originalHexagram?.name||""}</p>\n                        <p style="margin: 5px 0;"><strong>çˆ»:</strong> ${e.originalHexagram?.line||"å…­äºŒ"}</p>\n                        <p style="margin: 5px 0;"><strong>çŠ¶æ³:</strong> ${e.originalHexagram?.interpretation||"ç¾åœ¨ã®å®‰å®šã—ãŸåŸºç›¤"}</p>\n                    </div>\n                </div>\n                \n                <div class="transformation-stage" data-stage="1" style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px; opacity: 0.3; transform: translateX(-20px); transition: all 0.6s ease-out;">\n                    <div style="display: flex; align-items: center; margin-bottom: 10px;">\n                        <span style="background: #3b82f6; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px;">2</span>\n                        <h3 style="margin: 0; font-size: 1.2em;">å¤‰åŒ–ã®é–‹å§‹</h3>\n                    </div>\n                    <div style="margin-left: 45px;">\n                        <p style="margin: 5px 0;"><strong>é¸æŠ:</strong> ${(e.route||["ä¿å®ˆçš„","å”èª¿çš„","æ…é‡"])[0]}</p>\n                        <p style="margin: 5px 0;"><strong>ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ:</strong> ${e.transformationInfo?.approach||"æ®µéšçš„ãªå¤‰åŒ–"}</p>\n                        <p style="margin: 5px 0;"><strong>ç¢ºç‡:</strong> ${(100*(e.probability||.12)).toFixed(1)}%</p>\n                    </div>\n                </div>\n                \n                <div class="transformation-stage" data-stage="2" style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px; opacity: 0.3; transform: translateX(-20px); transition: all 0.6s ease-out;">\n                    <div style="display: flex; align-items: center; margin-bottom: 10px;">\n                        <span style="background: #a855f7; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px;">3</span>\n                        <h3 style="margin: 0; font-size: 1.2em;">å¤‰åŒ–ã®æ·±åŒ–</h3>\n                    </div>\n                    <div style="margin-left: 45px;">\n                        <p style="margin: 5px 0;"><strong>æ–¹å‘æ€§:</strong> ${(e.route||["ä¿å®ˆçš„","å”èª¿çš„","æ…é‡"])[1]}</p>\n                        <p style="margin: 5px 0;"><strong>å¤‰åŒ–ã®ç¨®é¡:</strong> ${e.transformationInfo?.type||"é€²æ­©çš„å¤‰åŒ–"}</p>\n                        <p style="margin: 5px 0;"><strong>æ˜“çµŒçš„æ„å‘³:</strong> ${e.transformationInfo?.lineChange||"çˆ»ã®å¤‰åŒ–ã«ã‚ˆã‚‹æ–°å±•é–‹"}</p>\n                    </div>\n                </div>\n                \n                <div class="transformation-stage" data-stage="3" style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px; opacity: 0.3; transform: translateX(-20px); transition: all 0.6s ease-out;">\n                    <div style="display: flex; align-items: center; margin-bottom: 10px;">\n                        <span style="background: #ec4899; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px;">4</span>\n                        <h3 style="margin: 0; font-size: 1.2em;">æœ€çµ‚åˆ°é”çŠ¶æ…‹</h3>\n                    </div>\n                    <div style="margin-left: 45px;">\n                        <p style="margin: 5px 0;"><strong>åˆ°é”å¦:</strong> ${e.targetHexagram?.name||"å¤©ç«åŒäºº"}</p>\n                        <p style="margin: 5px 0;"><strong>åˆ°é”çˆ»:</strong> ${e.targetHexagram?.line||"ä¹ä¸‰"}</p>\n                        <p style="margin: 5px 0;"><strong>çµæœ:</strong> ${e.targetHexagram?.interpretation||"å”èª¿çš„ãªæ–°ã—ã„é–¢ä¿‚æ€§"}</p>\n                        <p style="margin: 5px 0;"><strong>ã‚¹ã‚³ã‚¢:</strong> ${e.targetHexagram?.score||75}ç‚¹</p>\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨æ´å¯Ÿ --\x3e\n            <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; margin-bottom: 20px;">\n                <h3 style="margin-bottom: 15px; color: #fbbf24;">ğŸ’¡ ã“ã®å¤‰åŒ–ãƒ—ãƒ­ã‚»ã‚¹ã®æ´å¯Ÿ</h3>\n                <div style="margin-bottom: 10px;">\n                    <strong>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</strong>\n                    <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 5px;">\n                        ${(e.targetHexagram?.keywords||["å”èª¿æ€§","å®‰å®šæ€§","æ…é‡ã•"]).map(n=>`<span style="background: rgba(251, 191, 36, 0.3); color: #fbbf24; padding: 4px 10px; border-radius: 15px; font-size: 0.9em;">${n}</span>`).join("")}\n                    </div>\n                </div>\n                <p style="line-height: 1.6; margin: 15px 0;">\n                    ${e.description||e.fullDescription||"ã“ã®å¤‰åŒ–ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ã€ç¾åœ¨ã®å®‰å®šã—ãŸåŸºç›¤ã‹ã‚‰å‡ºç™ºã—ã€æ…é‡ã‹ã¤å”èª¿çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’é€šã˜ã¦ã€ã‚ˆã‚Šè‰¯ã„çŠ¶æ…‹ã¸ã®å¤‰åŒ–ã‚’å®Ÿç¾ã—ã¾ã™ã€‚"}\n                </p>\n            </div>\n            \n            \x3c!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ --\x3e\n            <div style="text-align: center; margin-top: 20px;">\n                <button onclick="window.BinaryTreeCompleteDisplay.closeTransformationModal()" \n                        style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.5); padding: 12px 30px; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin: 0 10px;">\n                    ç†è§£ã—ã¾ã—ãŸ\n                </button>\n                <button onclick="window.BinaryTreeCompleteDisplay.exportPathDetails(${n}, ${JSON.stringify(e).replace(/"/g,"&quot;")})" \n                        style="background: rgba(34, 197, 94, 0.3); color: #22c55e; border: 2px solid rgba(34, 197, 94, 0.5); padding: 12px 30px; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin: 0 10px;">\n                    ğŸ“„ è©³ç´°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\n                </button>\n            </div>\n        `},animateTransformationProcess:function(){document.querySelectorAll(".transformation-stage").forEach((n,e)=>{setTimeout(()=>{n.style.opacity="1",n.style.transform="translateX(0px)",setTimeout(()=>{n.style.boxShadow="0 8px 25px rgba(255,255,255,0.2)",setTimeout(()=>{n.style.boxShadow="none"},800)},200)},400*e)})},exportPathDetails:function(n,e){const t={path:n,title:e.title,probability:e.probability,route:e.route,transformation:e.transformationInfo,target:e.targetHexagram,description:e.description,exportedAt:(new Date).toISOString()},a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=`future_path_${n}_details.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),console.log(`ğŸ“„ Path ${n} details exported:`,t)},setupDownload:function(n){window.BinaryTreeCompleteDisplay.downloadResults=function(){const e={timestamp:(new Date).toISOString(),analysis:n,insights:{generated:!0,version:"2.1.0-branching-graph",dataSource:"H384_DATABASE"}},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`binary-tree-analysis-${Date.now()}.json`,r.click()}},generateHexagramVisual:function(n){const e=({1:"111111",2:"000000",3:"010001",4:"100010",5:"010111",6:"111010",7:"000010",8:"010000",9:"110111",10:"111011",11:"000111",12:"111000",13:"111101",14:"101111",15:"000100",16:"001000",17:"011001",18:"100110",19:"000011",20:"110000",21:"101001",22:"100101",23:"100000",24:"000001",25:"111001",26:"100111",27:"100001",28:"011110",29:"010010",30:"101101",31:"011100",32:"001110",33:"111100",34:"001111",35:"101000",36:"000101",37:"110101",38:"101011",39:"010100",40:"001010",41:"100011",42:"110001",43:"011111",44:"111110",45:"011000",46:"000110",47:"011010",48:"010110",49:"011101",50:"101110",51:"001001",52:"100100",53:"110100",54:"001011",55:"001101",56:"101100",57:"110110",58:"011011",59:"110010",60:"010011",61:"110011",62:"001100",63:"010101",64:"101010"}[n]||"000000").split("").reverse();let t='<div style="display: inline-flex; flex-direction: column; gap: 3px; padding: 0 10px;">';return e.forEach(n=>{t+="1"===n?'<div style="width: 50px; height: 5px; background: #FFD700; border-radius: 1px; box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);"></div>':'<div style="display: flex; gap: 6px;"><div style="width: 20px; height: 5px; background: #87CEEB; border-radius: 1px; box-shadow: 0 0 3px rgba(135, 206, 235, 0.5);"></div><div style="width: 20px; height: 5px; background: #87CEEB; border-radius: 1px; box-shadow: 0 0 3px rgba(135, 206, 235, 0.5);"></div></div>'}),t+="</div>",t},getLinePosition:function(n){return{"åˆä¹":1,"åˆå…­":1,"ä¹äºŒ":2,"å…­äºŒ":2,"ä¹ä¸‰":3,"å…­ä¸‰":3,"ä¹å››":4,"å…­å››":4,"ä¹äº”":5,"å…­äº”":5,"ä¸Šä¹":6,"ä¸Šå…­":6}[n]||4},calculatePathTransformations:function(n,e){const t=window.H64_DATA?window.H64_DATA.find(e=>e.å¦ç•ªå·===n):{"å¦ç•ªå·":n,"åå‰":"ä¸æ˜","åˆçˆ»å¤‰":n};return[{type:"é€²çˆ»ç¶™ç¶š",approach:"ç©æ¥µçš„",title:"ã•ã‚‰ã«é€²ã‚€ãƒ»strengthen"},{type:"é€²çˆ»ç¶™ç¶š",approach:"æ…é‡",title:"ã•ã‚‰ã«é€²ã‚€ãƒ»moderate"},{type:"é€²çˆ»å¤‰åŒ–",approach:"ç©æ¥µçš„",title:"ä¸€éƒ¨è»¢æ›ãƒ»strengthen"},{type:"é€²çˆ»å¤‰åŒ–",approach:"æ…é‡",title:"ä¸€éƒ¨è»¢æ›ãƒ»moderate"},{type:"å¤‰çˆ»å®Œå…¨",approach:"ç©æ¥µçš„",title:"å®Œå…¨è»¢æ›ãƒ»strengthen"},{type:"å¤‰çˆ»å®Œå…¨",approach:"æ…é‡",title:"å®Œå…¨è»¢æ›ãƒ»moderate"},{type:"å¤‰çˆ»çµ±åˆ",approach:"ç©æ¥µçš„",title:"çµ±åˆçš„è»¢æ›ãƒ»strengthen"},{type:"å¤‰çˆ»çµ±åˆ",approach:"æ…é‡",title:"çµ±åˆçš„è»¢æ›ãƒ»moderate"}].map((n,a)=>{const r=this.calculateTargetHexagram(t,e,n.type,a),i=window.H64_DATA?window.H64_DATA.find(n=>n.å¦ç•ªå·===r):{"å¦ç•ªå·":r,"åå‰":"å¤‰åŒ–å¦"},o=this.getTargetLineData(r,e,a),s=this.calculateTransformationProbability(n.type,n.approach,e),l=this.generateRoute(n.type,n.approach);return{type:n.type,title:n.title,probability:s,route:l,transformationType:n.type,approach:n.approach,targetHexagram:i,targetLineData:o}})},calculateTargetHexagram:function(n,e,t,a){if(!n||!window.H64_DATA)throw new Error("Hexagram data and H64 database are required");let r=e;t.includes("é€²çˆ»")?e>3&&(r=a%3+1):t.includes("å¤‰çˆ»")&&e<=3&&(r=a%3+4);const i=a%3;return n[["åˆçˆ»å¤‰","äºŒçˆ»å¤‰","ä¸‰çˆ»å¤‰","å››çˆ»å¤‰","äº”çˆ»å¤‰","ä¸Šçˆ»å¤‰"][Math.max(1,Math.min(6,r+i))-1]]||n.å¦ç•ªå·},getTargetLineData:function(n,e,t){if(!window.H384_DATA)return null;const a=[e,Math.max(1,e-1),Math.min(6,e+1),e,Math.max(1,e-2),Math.min(6,e+2),Math.max(1,e%6+1),Math.max(1,(e+2)%6+1)][t%8];return window.H384_DATA.find(e=>e.å¦ç•ªå·===n&&this.getLinePosition(e.çˆ»)===a)||window.H384_DATA.find(e=>e.å¦ç•ªå·===n)||null},generateTransformationDescription:function(n,e,t,a){if(!e)return`${t}ã«ã‚ˆã‚‹${a}ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã€æ–°ã—ã„å¯èƒ½æ€§ã‚’æ¢ç´¢ã™ã‚‹é“ã€‚`;const r=n?.ç¾ä»£è§£é‡ˆ||"ç¾åœ¨ã®çŠ¶æ³",i=e.ç¾ä»£è§£é‡ˆ||e.ç¾ä»£è§£é‡ˆã®è¦ç´„||"å¤‰åŒ–ã®å…†ã—",o=e.ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰||["å¤‰åŒ–","é©å¿œ"];return`${r}ã‹ã‚‰ã€${i}ã¸ã®å¤‰åŒ–ã€‚${t}ã«ã‚ˆã‚‹${a}ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã€${Array.isArray(o)?o.join("ã€"):"é©å¿œ"}ã‚’é‡è¦–ã—ãŸé“ç­‹ã€‚`},calculateTransformationProbability:function(n,e,t){let a=.125;return n.includes("é€²çˆ»")?a+=t<=3?.05:-.02:n.includes("å¤‰çˆ»")&&(a+=t>=4?.05:-.02),"ç©æ¥µçš„"===e?a+=.02:"æ…é‡"===e&&(a+=.01),a+=.1*(Math.random()-.5),Math.max(.05,Math.min(.4,a))},generateRoute:function(n,e){return[...{"é€²çˆ»ç¶™ç¶š":["progress","continue"],"é€²çˆ»å¤‰åŒ–":["progress","adjust"],"å¤‰çˆ»å®Œå…¨":["transform","complete"],"å¤‰çˆ»çµ±åˆ":["transform","integrate"]}[n]||["progress","continue"],"ç©æ¥µçš„"===e?"option_a":"option_b"]},downloadResults:function(){window.BinaryTreeCompleteDisplay.downloadResults&&window.BinaryTreeCompleteDisplay.downloadResults()},generateCurrentSituationAnalysis:function(n){if(console.log("ğŸ” Generating current situation analysis with I Ching diagnosis..."),!n.lineData)throw new Error("Line data is required");const e=n.lineData,t=e.å¦å,a=e.çˆ»,r=e.ç¾ä»£è§£é‡ˆ||e.ç¾ä»£è§£é‡ˆã®è¦ç´„,i=e.ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰,o=e.S1_åŸºæœ¬ã‚¹ã‚³ã‚¢,s=n.userInput||window.latestUserInput||"";return`\n            <div style="display: grid; gap: 20px;">\n                \x3c!-- å¦ãƒ»çˆ»ã®è¨ºæ–­çµæœ --\x3e\n                <div style="background: rgba(255,200,0,0.1); padding: 20px; border-radius: 12px;">\n                    <h4 style="color: #fbbf24; margin-bottom: 10px;">ğŸ“– æ˜“çµŒã«ã‚ˆã‚‹è¨ºæ–­</h4>\n                    <p style="margin: 5px 0;"><strong>ç¾åœ¨ã®å¦:</strong> ${t}</p>\n                    <p style="margin: 5px 0;"><strong>çˆ»ã®ä½ç½®:</strong> ${a}</p>\n                    <p style="margin: 10px 0; line-height: 1.6;">${r}</p>\n                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);">\n                        <strong>åŸºæœ¬ã‚¹ã‚³ã‚¢:</strong> ${o}ç‚¹\n                    </div>\n                </div>\n                \n                \x3c!-- ãƒ†ãƒ¼ãƒãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç‰¹å®š --\x3e\n                <div style="background: rgba(255,200,0,0.1); padding: 20px; border-radius: 12px;">\n                    <h4 style="color: #fbbf24; margin-bottom: 10px;">ğŸ¯ ç‰¹å®šã•ã‚ŒãŸãƒ†ãƒ¼ãƒ</h4>\n                    <p style="margin: 5px 0;"><strong>æ‚©ã¿ã®å†…å®¹:</strong> ${s}</p>\n                    <p style="margin: 5px 0;"><strong>ä¸­å¿ƒãƒ†ãƒ¼ãƒ:</strong> ${this.identifyThemeFromWorry(s)}</p>\n                    <div style="margin-top: 15px;">\n                        <strong>é‡è¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</strong>\n                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">\n                            ${i.map(n=>`\n                                <span style="background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 20px; font-size: 0.9em;">\n                                    ${n}\n                                </span>\n                            `).join("")}\n                        </div>\n                    </div>\n                </div>\n                \n                \x3c!-- å…·ä½“ä¾‹ï¼šä¹¾ç‚ºå¤©ã®åˆçˆ»ã®å ´åˆ --\x3e\n                ${"ä¹¾ç‚ºå¤©"===t&&a.includes("åˆ")?'\n                <div style="background: rgba(255,200,0,0.1); padding: 20px; border-radius: 12px;">\n                    <h4 style="color: #fbbf24; margin-bottom: 10px;">ğŸ’¡ å…·ä½“ä¾‹ï¼šä¹¾ç‚ºå¤©ãƒ»åˆä¹</h4>\n                    <p style="line-height: 1.6;">\n                        ä¹¾ç‚ºå¤©ã®åˆçˆ»ã€Œæ½œé¾å‹¿ç”¨ã€ã¯ã€ã¾ã æ™‚æ©ŸãŒæ¥ã¦ã„ãªã„é¾ã®çŠ¶æ…‹ã‚’è¡¨ã—ã¾ã™ã€‚\n                        ä»Šã¯åŠ›ã‚’è“„ãˆã€æº–å‚™ã‚’æ•´ãˆã‚‹æ™‚æœŸã§ã™ã€‚\n                    </p>\n                </div>\n                ':""}\n            </div>\n        `},generateProgressChangeExplanation:function(n){if(console.log("âš–ï¸ Generating progress/change concept explanation..."),!n.lineData)throw new Error("Line data is required");const e=n.lineData,t=e.çˆ»,a=e.å¦å,r=this.calculateProgressState(a,t),i=this.calculateChangeState(a,t);return`\n            <div style="display: grid; gap: 20px;">\n                \x3c!-- é€²çˆ»ã®èª¬æ˜ --\x3e\n                <div style="background: rgba(34,197,94,0.1); padding: 20px; border-radius: 12px;">\n                    <h4 style="color: #22c55e; margin-bottom: 10px;">â¡ï¸ é€²çˆ»ï¼ˆãƒ†ãƒ¼ãƒã«å¾“ã†ï¼‰</h4>\n                    <p style="line-height: 1.6;">\n                        ç¾åœ¨ã®${a}ãƒ»${t}ã®ãƒ†ãƒ¼ãƒã«å¾“ã£ã¦é€²ã‚€é¸æŠã§ã™ã€‚\n                        è‡ªç„¶ãªæµã‚Œã«æ²¿ã£ã¦ã€ç¾åœ¨ã®æ–¹å‘æ€§ã‚’å¼·åŒ–ãƒ»ç™ºå±•ã•ã›ã¾ã™ã€‚\n                    </p>\n                    <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">\n                        <strong>æ¬¡ã®çŠ¶æ…‹:</strong> ${r.nextHexagram}ãƒ»${r.nextLine}\n                        <p style="margin: 5px 0; font-size: 0.9em;">${r.description}</p>\n                    </div>\n                </div>\n                \n                \x3c!-- å¤‰çˆ»ã®èª¬æ˜ --\x3e\n                <div style="background: rgba(34,197,94,0.1); padding: 20px; border-radius: 12px;">\n                    <h4 style="color: #22c55e; margin-bottom: 10px;">ğŸ”„ å¤‰çˆ»ï¼ˆé•ã†é¸æŠï¼‰</h4>\n                    <p style="line-height: 1.6;">\n                        ç¾åœ¨ã®${a}ãƒ»${t}ã¨ã¯ç•°ãªã‚‹æ–¹å‘ã‚’é¸ã¶é“ã§ã™ã€‚\n                        çˆ»ã®é™°é™½ã‚’å¤‰ãˆã‚‹ã“ã¨ã§ã€æ–°ã—ã„å¦ã¸ã®å¤‰åŒ–ã‚’ç”Ÿã¿å‡ºã—ã¾ã™ã€‚\n                    </p>\n                    <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">\n                        <strong>æ¬¡ã®çŠ¶æ…‹:</strong> ${i.nextHexagram}ãƒ»${i.nextLine}\n                        <p style="margin: 5px 0; font-size: 0.9em;">${i.description}</p>\n                    </div>\n                </div>\n                \n                \x3c!-- é¸æŠã®æ„å‘³ --\x3e\n                <div style="background: rgba(34,197,94,0.1); padding: 20px; border-radius: 12px;">\n                    <h4 style="color: #22c55e; margin-bottom: 10px;">ğŸ¤” ã©ã¡ã‚‰ã‚’é¸ã¶ã¹ãã‹</h4>\n                    <ul style="line-height: 1.8; margin: 0; padding-left: 20px;">\n                        <li><strong>é€²çˆ»ã‚’é¸ã¶å ´åˆ:</strong> ç¾åœ¨ã®æµã‚Œã‚’ä¿¡ã˜ã€æ—¢å­˜ã®å¼·ã¿ã‚’æ´»ã‹ã—ãŸã„æ™‚</li>\n                        <li><strong>å¤‰çˆ»ã‚’é¸ã¶å ´åˆ:</strong> ç¾çŠ¶ã‚’æ‰“ç ´ã—ã€æ–°ã—ã„å¯èƒ½æ€§ã‚’é–‹ããŸã„æ™‚</li>\n                    </ul>\n                </div>\n            </div>\n        `},generateThreePhaseProcess:function(n){if(console.log("ğŸ“Š Generating three-phase process visualization..."),!n.lineData)throw new Error("Line data is required");const e=n.lineData,t=e.å¦å,a=e.çˆ»,r=this.buildThreePhaseProcess(t,a);return`\n            <div style="display: grid; gap: 20px;">\n                \x3c!-- ãƒ•ã‚§ãƒ¼ã‚ºèª¬æ˜ --\x3e\n                <div style="background: rgba(59,130,246,0.1); padding: 20px; border-radius: 12px;">\n                    <h4 style="color: #3b82f6; margin-bottom: 10px;">ğŸ“ˆ 3æ®µéšã®å¤‰åŒ–ãƒ—ãƒ­ã‚»ã‚¹</h4>\n                    <p style="line-height: 1.6;">\n                        å„æ®µéšã§ã€Œé€²çˆ»ã€ã‹ã€Œå¤‰çˆ»ã€ã‚’é¸æŠã™ã‚‹ã“ã¨ã§ã€2â†’4â†’8ã¤ã®æœªæ¥ãƒ‘ã‚¹ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚\n                    </p>\n                </div>\n                \n                \x3c!-- Phase 1 --\x3e\n                <div style="background: rgba(59,130,246,0.1); padding: 20px; border-radius: 12px;">\n                    <h4 style="color: #3b82f6; margin-bottom: 10px;">Phase 1: åˆæœŸé¸æŠï¼ˆ2åˆ†å²ï¼‰</h4>\n                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">\n                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">\n                            <strong>ğŸŸ¢ é€²çˆ»é¸æŠ:</strong> ${r.phase1.progress.hexagram}ãƒ»${r.phase1.progress.line}\n                            <p style="margin: 5px 0; font-size: 0.9em;">${r.phase1.progress.description}</p>\n                        </div>\n                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">\n                            <strong>ğŸ”„ å¤‰çˆ»é¸æŠ:</strong> ${r.phase1.change.hexagram}ãƒ»${r.phase1.change.line}\n                            <p style="margin: 5px 0; font-size: 0.9em;">${r.phase1.change.description}</p>\n                        </div>\n                    </div>\n                </div>\n                \n                \x3c!-- Phase 2 --\x3e\n                <div style="background: rgba(59,130,246,0.1); padding: 20px; border-radius: 12px;">\n                    <h4 style="color: #3b82f6; margin-bottom: 10px;">Phase 2: ä¸­é–“é¸æŠï¼ˆ4åˆ†å²ï¼‰</h4>\n                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px;">\n                        ${r.phase2.map((n,e)=>`\n                            <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px;">\n                                <strong>${n.type}:</strong> ${n.hexagram}ãƒ»${n.line}\n                                <p style="margin: 3px 0; font-size: 0.85em;">${n.description}</p>\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n                \n                \x3c!-- Phase 3 --\x3e\n                <div style="background: rgba(59,130,246,0.1); padding: 20px; border-radius: 12px;">\n                    <h4 style="color: #3b82f6; margin-bottom: 10px;">Phase 3: æœ€çµ‚åˆ†å²ï¼ˆ8ãƒ‘ã‚¹ï¼‰</h4>\n                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 15px;">\n                        ${r.phase3.map((n,e)=>`\n                            <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center;">\n                                <strong>Path ${e+1}</strong>\n                                <p style="margin: 3px 0; font-size: 0.8em;">${n.hexagram}</p>\n                                <p style="margin: 0; font-size: 0.75em; opacity: 0.8;">${n.type}</p>\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n                \n                \x3c!-- å…·ä½“ä¾‹ï¼šä¹¾ç‚ºå¤©ã®å ´åˆ --\x3e\n                ${"ä¹¾ç‚ºå¤©"===t?'\n                <div style="background: rgba(59,130,246,0.1); padding: 20px; border-radius: 12px;">\n                    <h4 style="color: #3b82f6; margin-bottom: 10px;">ğŸ’¡ ä¹¾ç‚ºå¤©ã®åˆçˆ»â†’äºŒçˆ»ã¸ã®å¤‰åŒ–ä¾‹</h4>\n                    <p style="line-height: 1.6;">\n                        ä¹¾ç‚ºå¤©ãƒ»åˆä¹ã€Œæ½œé¾å‹¿ç”¨ã€ã‹ã‚‰äºŒçˆ»ã€Œè¦‹é¾åœ¨ç”°ã€ã¸ã®é€²çˆ»ã¯ã€\n                        æ½œã‚“ã§ã„ãŸé¾ãŒåœ°ä¸Šã«ç¾ã‚Œã‚‹è‡ªç„¶ãªæˆé•·ãƒ—ãƒ­ã‚»ã‚¹ã‚’è¡¨ã—ã¾ã™ã€‚\n                        ä¸€æ–¹ã€å¤‰çˆ»ã‚’é¸ã¶ã¨ã€Œå¤ç‚ºåœ°ã€ã¸ã®è»¢æ›ã¨ãªã‚Šã€\n                        å‰›ã‹ã‚‰æŸ”ã¸ã®å¤§ããªæ–¹å‘è»¢æ›ã‚’æ„å‘³ã—ã¾ã™ã€‚\n                    </p>\n                </div>\n                ':""}\n            </div>\n        `},identifyThemeFromWorry:function(n){const e={"ä»•äº‹":["ä»•äº‹","è»¢è·","ã‚­ãƒ£ãƒªã‚¢","è·å ´","æ˜‡é€²"],"äººé–“é–¢ä¿‚":["äººé–“é–¢ä¿‚","å‹äºº","å®¶æ—","æ‹æ„›","ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼"],"å¥åº·":["å¥åº·","ç—…æ°—","ä½“èª¿","ã‚¹ãƒˆãƒ¬ã‚¹","ç–²åŠ´"],"é‡‘éŠ­":["ãŠé‡‘","çµŒæ¸ˆ","åå…¥","æŠ•è³‡","è²¡å‹™"],"æˆé•·":["æˆé•·","å­¦ç¿’","å‹‰å¼·","ã‚¹ã‚­ãƒ«","å‘ä¸Š"],"æ±ºæ–­":["é¸æŠ","æ±ºæ–­","è¿·ã„","åˆ¤æ–­","æ–¹å‘æ€§"]};for(const[t,a]of Object.entries(e))if(a.some(e=>n.includes(e)))return t;return"äººç”Ÿã®é¸æŠ"},calculateProgressState:function(n,e){const t=this.getLinePosition(e);return{nextHexagram:n,nextLine:["åˆ","äºŒ","ä¸‰","å››","äº”","ä¸Š"][Math.min(t+1,6)-1]+"çˆ»",description:`ç¾åœ¨ã®${n}ã®æµã‚Œã«å¾“ã„ã€æ¬¡ã®æ®µéšã¸è‡ªç„¶ã«é€²åŒ–ã—ã¾ã™ã€‚`}},calculateChangeState:function(n,e){if(window.H64_DATA){const t=window.H64_DATA.find(e=>e.åå‰===n);if(t){const n=t[["åˆçˆ»å¤‰","äºŒçˆ»å¤‰","ä¸‰çˆ»å¤‰","å››çˆ»å¤‰","äº”çˆ»å¤‰","ä¸Šçˆ»å¤‰"][this.getLinePosition(e)-1]],a=window.H64_DATA.find(e=>e.å¦ç•ªå·===n);if(a)return{nextHexagram:a.åå‰,nextLine:e,description:`çˆ»ã®é™°é™½ã‚’å¤‰ãˆã‚‹ã“ã¨ã§ã€${a.åå‰}ã¸ã®è»¢æ›ã‚’ç”Ÿã¿å‡ºã—ã¾ã™ã€‚`}}}return{nextHexagram:"å¤‰åŒ–å¦",nextLine:e,description:"ç¾åœ¨ã¨ã¯ç•°ãªã‚‹æ–°ã—ã„æ–¹å‘ã¸ã®è»¢æ›ã‚’è¡¨ã—ã¾ã™ã€‚"}},buildThreePhaseProcess:function(n,e){const t={progress:this.calculateProgressState(n,e),change:this.calculateChangeState(n,e)},a=[{type:"é€²çˆ»â†’é€²çˆ»",...this.calculateProgressState(t.progress.nextHexagram,t.progress.nextLine)},{type:"é€²çˆ»â†’å¤‰çˆ»",...this.calculateChangeState(t.progress.nextHexagram,t.progress.nextLine)},{type:"å¤‰çˆ»â†’é€²çˆ»",...this.calculateProgressState(t.change.nextHexagram,t.change.nextLine)},{type:"å¤‰çˆ»â†’å¤‰çˆ»",...this.calculateChangeState(t.change.nextHexagram,t.change.nextLine)}],r=[];for(let i=0;i<4;i++){const n=a[i];r.push({type:"é€²çˆ»ç¶™ç¶š",hexagram:this.calculateProgressState(n.hexagram,n.line).nextHexagram},{type:"å¤‰çˆ»è»¢æ›",hexagram:this.calculateChangeState(n.hexagram,n.line).nextHexagram})}return{phase1:t,phase2:a,phase3:r}},integrateWithResultPageController:function(n){this.updateAnalysisSummary(n),console.log("ğŸ”— Integrating with existing ResultPageController system...");try{if(window.ResultPageController){console.log("âœ… ResultPageController found, initiating integration...");const e=this.convertToControllerFormat(n);(new window.ResultPageController).displayResults(e),console.log("âœ… ResultPageController integration complete")}else console.log("âš ï¸ ResultPageController not available, using fallback graph system"),this.renderBranchingChart(n)}catch(e){console.error("âŒ ResultPageController integration error:",e),console.log("ğŸ”„ Falling back to internal graph system"),this.renderBranchingChart(n)}},updateAnalysisSummary:function(n){console.log("ğŸ“Š Updating analysis summary section with H384 data");const e=document.getElementById("currentHexagramInfo");if(e&&n.lineData){const t=n.lineData.hexagramName||n.lineData.å¦å||"",a=n.lineData.lineName||n.lineData.çˆ»||"";t&&a&&(e.textContent=`${t} - ${a}`,console.log(`âœ… Updated currentHexagramInfo: ${t} - ${a}`))}const t=this.calculateSummaryMetrics(n),a=document.querySelector(".summary-option:nth-child(1) .option-description");a&&(a.textContent=t.reconciliation.description);const r=document.querySelector(".summary-option:nth-child(2) .option-description");r&&(r.textContent=t.unity.description);const i=document.querySelector(".summary-section:nth-child(2) .section-content");i&&(i.textContent=t.challenge.description),console.log("âœ… Analysis summary updated with real data")},calculateSummaryMetrics:function(n){const e=n.finalEightPaths||[],t=[...e].sort((n,e)=>e.probability-n.probability)[0]||{},a=e.filter(n=>n.route&&(n.route.includes("adjust")||n.route.includes("integrate"))),r=e.filter(n=>n.route&&(n.route.includes("continue")||n.route.includes("progress"))),i=e.filter(n=>n.route&&(n.route.includes("transform")||n.route.includes("complete")));return{reconciliation:{description:a.length>0?`æ·±åˆ»ãªå¯¾ç«‹ã‚„å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã€æœ€çµ‚çš„ã«çœŸã®å’Œè§£ã¨å”åŠ›é–¢ä¿‚ã‚’ç¯‰ãã€‚${a[0]?.description||""}`:"ç¾çŠ¶ã‚’ç¶­æŒã—ã¤ã¤ã€å†…ãªã‚‹åŠ›ã‚’è“„ãˆã‚‹"},unity:{description:r.length>0?`æ·±ã„è‹¦ã—ã¿ã®å¾Œã«ã€æœ€é«˜ã®å–œã³ã¨çµæŸãŒè¨ªã‚Œã‚‹ã€‚${r[0]?.description||""}`:"æ®µéšçš„ãªç™ºå±•ã¨æˆé•·ã‚’é‚ã’ã‚‹"},challenge:{description:i.length>0?`ç©æ¥µçš„ã«è¡Œå‹•ã‚’èµ·ã“ã—ã€ä¸»ä½“çš„ã«çŠ¶æ³ã‚’åˆ‡ã‚Šé–‹ã„ã¦ã„ãã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚${t.practical_guidance||t.description||""}`:"æ…é‡ã«çŠ¶æ³ã‚’è¦‹æ¥µã‚ã€é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å¾…ã¤"}}},convertToControllerFormat:function(n){console.log("ğŸ”„ Converting BinaryTree result to ResultPageController format..."),console.log("ğŸ” [DEBUG] Input result:",n),console.log("ğŸ” [DEBUG] result.lineData:",n.lineData),console.log("ğŸ” [DEBUG] result.finalEightPaths:",n.finalEightPaths);const e=n.finalEightPaths.map((e,t)=>{const a=t<4;let r=n.lineData?.S1_åŸºæœ¬ã‚¹ã‚³ã‚¢||n.currentScore||65;("number"!=typeof r||isNaN(r))&&(r=65);let i,o,s=e.targetHexagram?.score||e.score;if("number"!=typeof s||isNaN(s)){if(a){s=[75,82,68,71][t]||r+10}else{s=[58,91,45,76][t-4]||r+20}s=Math.max(10,Math.min(100,s))}if(console.log(`ğŸ” [DEBUG] Scenario ${t+1}: baseScore=${r}, finalScore=${s}, isContinue=${a}`),console.log("ğŸ” [DEBUG] path.targetHexagram:",e.targetHexagram),console.log("ğŸ” [DEBUG] path.probability:",e.probability),a){const n=s-r;i=Math.round(r+.25*n),o=Math.round(r+.6*n)}else{const n=s-r;n>0?(i=Math.round(r+.15*n),o=Math.round(r+.45*n)):(i=Math.round(r+.4*n),o=Math.round(r+.7*n))}("number"!=typeof i||isNaN(i))&&(i=Math.round(r+.3*(s-r))),("number"!=typeof o||isNaN(o))&&(o=Math.round(r+.65*(s-r)));const l=Math.max(10,Math.min(100,i)),g=Math.max(10,Math.min(100,o));return console.log(`ğŸ” [DEBUG] Final scores for scenario ${t+1}: phase1=${l}, phase2=${g}, phase3=${s}`),{title:e.title||e.description||`ç¬¬${t+1}ã®é“`,description:e.description||e.fullDescription||"çµ±åˆçš„ãªå¤‰åŒ–ã®ãƒ‘ã‚¹",score:s,probability:e.probability||.125,phase1Score:l,phase2Score:g,phase3Score:s,hexagramInfo:{number:e.targetHexagram?.number||e.originalHexagram?.number||15,name:e.targetHexagram?.name||e.originalHexagram?.name||"",line:e.targetHexagram?.line||e.originalHexagram?.line||"å…­å››",interpretation:e.targetHexagram?.interpretation||e.originalHexagram?.interpretation||"è¬™è™šãªå”åŠ›",keywords:e.targetHexagram?.keywords||["å”èª¿","æ…é‡","ç™ºå±•"],modernInterpretation:e.description||"ç¾ä»£çš„ãªè¦–ç‚¹ã§ã®è§£é‡ˆ"},route:e.route||["ä¿å®ˆçš„","å”èª¿çš„","æ…é‡"],transformationInfo:e.transformationInfo||{type:"é€²æ­©çš„å¤‰åŒ–",approach:"æ®µéšçš„",lineChange:"ç¾çŠ¶ â†’ ç™ºå±•",hexagramChange:"ç¾åœ¨ â†’ æœªæ¥"}}}),t={scenarios:e,overallScore:Math.round(e.reduce((n,e)=>n+e.score,0)/e.length),currentPosition:{hexagram:n.lineData?.å¦å||"",line:n.lineData?.çˆ»||"å…­å››",interpretation:n.lineData?.ç¾ä»£è§£é‡ˆ||n.lineData?.ç¾ä»£è§£é‡ˆã®è¦ç´„||"ç¾åœ¨ã®å®‰å®šã—ãŸçŠ¶æ³",keywords:n.lineData?.ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰||["è¬™è™š","å”åŠ›","ç™ºå±•"],score:n.lineData?.S1_åŸºæœ¬ã‚¹ã‚³ã‚¢||65},continuePaths:e.slice(0,4),transformPaths:e.slice(4,8),topPath:e.reduce((n,e)=>e.score>n.score?e:n,e[0]),timestamp:(new Date).toISOString(),analysisVersion:"2.1.0-h384-integrated",dataSource:"H384_DATABASE"};return console.log("âœ… Conversion complete:",t),t},downloadResults:function(){window.BinaryTreeCompleteDisplay.downloadResults&&window.BinaryTreeCompleteDisplay.downloadResults()},analyzeTextToSelectHexagram:function(n){if(console.log("ğŸ” Starting genuine text to hexagram analysis..."),!n||n.trim().length<3)return console.warn("âš ï¸ Input text too short, using default"),{hexagramNumber:15,confidence:.3,reason:"insufficient_input"};const e=this.analyzeEmotionalContent(n),t=this.analyzeSituationalContext(n),a=this.analyzeKeywords(n);console.log("ğŸ“Š Analysis results:",{emotionAnalysis:e,situationAnalysis:t,keywordAnalysis:a});const r=this.selectHexagramFromAnalysis(e,t,a);return console.log("â˜¯ï¸ Selected hexagram:",r),r},analyzeEmotionalContent:function(n){const e={positive:{patterns:/å¬‰ã—ã„|æ¥½ã—ã„|å¹¸ã›|æˆåŠŸ|é”æˆ|æº€è¶³|å¸Œæœ›|æ„›|å–œã³|æ„Ÿè¬|å……å®Ÿ/g,score:0},negative:{patterns:/æ‚©ã¿|å›°ã‚‹|ä¸å®‰|å¿ƒé…|å•é¡Œ|æ‚²ã—ã„|è¾›ã„|è‹¦ã—ã„|å¤±æ•—|æã‚Œ|æ€’ã‚Š|å­¤ç‹¬/g,score:0},seeking:{patterns:/ã—ãŸã„|æ¬²ã—ã„|é¡˜ã†|æœ›ã‚€|æ±‚ã‚ã‚‹|ç›®æŒ‡ã™|å¤‰ã‚ã‚ŠãŸã„|æˆé•·|å­¦ã³|æŒ‘æˆ¦/g,score:0}};Object.entries(e).forEach(([e,t])=>{const a=n.match(t.patterns)||[];t.score=a.length});const t=e.positive.score+e.negative.score+e.seeking.score;return t>0?{positive:e.positive.score/t,negative:e.negative.score/t,seeking:e.seeking.score/t}:{positive:.33,negative:.33,seeking:.34}},analyzeSituationalContext:function(n){const e={};Object.entries({work:/ä»•äº‹|ä¼šç¤¾|è·å ´|è»¢è·|ã‚­ãƒ£ãƒªã‚¢|ä¸Šå¸|éƒ¨ä¸‹|åŒåƒš|æ¥­å‹™|ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ|æ˜‡é€²/g,relationship:/æ‹æ„›|æ‹äºº|ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼|çµå©š|å¤«å©¦|å½¼æ°|å½¼å¥³|ç‰‡æ€ã„|åˆ¥ã‚Œ|å¾©ç¸/g,family:/å®¶æ—|ä¸¡è¦ª|çˆ¶|æ¯|å…„å¼Ÿ|å§‰å¦¹|å­ä¾›|å®¶åº­|è¦ªæˆš/g,health:/å¥åº·|ç—…æ°—|ä½“èª¿|åŒ»ç™‚|æ²»ç™‚|é‹å‹•|ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ|ç²¾ç¥|å¿ƒ|ã‚¹ãƒˆãƒ¬ã‚¹/g,learning:/å‹‰å¼·|å­¦ç¿’|æ•™è‚²|è³‡æ ¼|è©¦é¨“|ã‚¹ã‚­ãƒ«|æˆé•·|çŸ¥è­˜|ç¿’å¾—/g,finance:/ãŠé‡‘|åå…¥|æ”¯å‡º|æŠ•è³‡|è²¯é‡‘|å€Ÿé‡‘|çµŒæ¸ˆ|è²¡å‹™|å¹´å/g,personal:/è‡ªåˆ†|å€‹äºº|æ€§æ ¼|ä¾¡å€¤è¦³|å°†æ¥|äººç”Ÿ|ç›®æ¨™|å¤¢|è¶£å‘³/g}).forEach(([t,a])=>{const r=n.match(a)||[];e[t]=r.length});const t=Math.max(...Object.values(e));return{primary:Object.entries(e).find(([n,e])=>e===t)?.[0]||"personal",scores:e}},analyzeKeywords:function(n){const e={};return Object.entries({action:/è¡Œå‹•|å®Ÿè¡Œ|å§‹ã‚ã‚‹|ã‚„ã‚ã‚‹|å¤‰ãˆã‚‹|æŒ‘æˆ¦|æ±ºæ–­|é¸æŠ|é€²ã‚€|æˆ»ã‚‹/g,stability:/å®‰å®š|ç¶­æŒ|ç¶™ç¶š|ä¿ã¤|å®ˆã‚‹|ç¾çŠ¶|ãã®ã¾ã¾|å¤‰ã‚ã‚‰ãªã„/g,change:/å¤‰åŒ–|å¤‰ã‚ã‚‹|æ–°ã—ã„|é©æ–°|æ”¹é©|è»¢æ›|ç§»è¡Œ|é€²æ­©|ç™ºå±•/g,conflict:/å¯¾ç«‹|äº‰ã„|ç«¶äº‰|æˆ¦ã„|åå¯¾|æŠµæŠ—|è¡çª|æ‘©æ“¦/g,harmony:/èª¿å’Œ|å”åŠ›|å”èª¿|åˆæ„|ç†è§£|å—å®¹|å¹³å’Œ|ãƒãƒ©ãƒ³ã‚¹/g,growth:/æˆé•·|ç™ºé”|å‘ä¸Š|æ”¹å–„|é€²æ­©|å­¦ç¿’|ç¿’å¾—|æ·±ã¾ã‚‹/g}).forEach(([t,a])=>{const r=n.match(a)||[];e[t]=r.length}),e},selectHexagramFromAnalysis:function(n,e,t){console.log("ğŸ¯ Selecting hexagram from comprehensive analysis...");const a={work:{positive:{high_action:1,high_stability:11,high_growth:42},negative:{high_conflict:6,high_change:16,high_harmony:15},seeking:{high_action:25,high_growth:32,high_stability:23}},relationship:{positive:{high_harmony:31,high_growth:54,high_stability:37},negative:{high_conflict:43,high_change:28,high_harmony:61},seeking:{high_action:31,high_growth:44,high_stability:37}},personal:{positive:{high_growth:35,high_action:51,high_harmony:14},negative:{high_change:18,high_conflict:33,high_harmony:20},seeking:{high_action:3,high_growth:4,high_stability:52}},health:{positive:{high_stability:27,high_growth:48,high_harmony:50},negative:{high_change:23,high_conflict:36,high_harmony:48},seeking:{high_action:26,high_growth:27,high_stability:52}}},r=Object.entries(n).sort(([,n],[,e])=>e-n)[0][0],i=Object.entries(t).sort(([,n],[,e])=>e-n)[0][0],o=e.primary,s=r,l=`high_${i}`;let g=15,d=.5,c="default_selection";if(a[o]&&a[o][s]&&a[o][s][l])g=a[o][s][l],d=.85,c=`${o}_${s}_${i}`;else if(a[o]&&a[o][s]){const n=a[o][s];g=Object.values(n)[0],d=.7,c=`${o}_${s}_fallback`}return{hexagramNumber:g,confidence:d,reason:c,analysis:{situation:o,emotion:s,keyword:i,emotionScores:n,keywordScores:t}}},findAppropriateLineFromHexagram:function(n,e){if(console.log("ğŸ“ Finding appropriate line from hexagram:",n.hexagramNumber),!window.H384_DATA||0===window.H384_DATA.length)return console.error("âŒ H384ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“"),248;const t=window.H384_DATA.filter(e=>e.å¦ç•ªå·===n.hexagramNumber);if(0===t.length){console.warn(`âš ï¸ Hexagram ${n.hexagramNumber} not found, using closest match`);const e=[...new Set(window.H384_DATA.map(n=>n.å¦ç•ªå·))].reduce((e,t)=>Math.abs(t-n.hexagramNumber)<Math.abs(e-n.hexagramNumber)?t:e);return window.H384_DATA.find(n=>n.å¦ç•ªå·===e)?.é€šã—ç•ªå·||248}const a=n.analysis.emotionScores;let r;return r=a.negative>.6?t.find(n=>n.çˆ».includes("åˆ")||n.çˆ».includes("äºŒ"))||t[0]:a.seeking>.5?t.find(n=>n.çˆ».includes("ä¸‰")||n.çˆ».includes("å››"))||t[Math.floor(t.length/2)]:a.positive>.5?t.find(n=>n.çˆ».includes("äº”")||n.çˆ».includes("ä¸Š"))||t[t.length-1]:t.find(n=>n.çˆ».includes("ä¸‰")||n.çˆ».includes("å››"))||t[Math.floor(t.length/2)],console.log("âœ… Selected line based on emotional analysis:",r.é€šã—ç•ªå·,r.çˆ»),r.é€šã—ç•ªå·},generateTextBasedH384Result:function(n,e,t){console.log("ğŸ¨ Generating text-based H384 result (fallback mode)");const a=this.getActualH384Data(t),r=(this.getActualH64Data(e.hexagramNumber),this.generateContextualPaths(n,e,a));return{currentLine:t,lineData:a,finalEightPaths:r,branchingData:this.generateBranchingData(r),textAnalysis:e,analysisMode:"TEXT_BASED_FALLBACK"}},generateContextualPaths:function(n,e,t){console.log("ğŸ›¤ï¸ Generating contextual paths based on text analysis");const a=e.analysis.situation,r=e.analysis.emotionScores,i={work:{positive:["ç¶™ç¶šç™ºå±•ãƒ»ç©æ¥µå‹","ç¶™ç¶šç™ºå±•ãƒ»å®‰å®šå‹","éƒ¨åˆ†æ”¹å–„ãƒ»é©æ–°å‹","éƒ¨åˆ†æ”¹å–„ãƒ»å”èª¿å‹","å®Œå…¨è»¢æ›ãƒ»æŒ‘æˆ¦å‹","å®Œå…¨è»¢æ›ãƒ»æ…é‡å‹","çµ±åˆå‰µé€ ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼å‹","çµ±åˆå‰µé€ ãƒ»ãƒãƒ¼ãƒ å‹"],negative:["ç¾çŠ¶ç¶­æŒãƒ»å®‰å…¨å‹","ç¾çŠ¶ç¶­æŒãƒ»æ”¹å–„å‹","æ®µéšä¿®æ­£ãƒ»æ…é‡å‹","æ®µéšä¿®æ­£ãƒ»å”åŠ›å‹","æ ¹æœ¬è¦‹ç›´ã—ãƒ»å¤§èƒ†å‹","æ ¹æœ¬è¦‹ç›´ã—ãƒ»è¨ˆç”»å‹","æ–°å¤©åœ°é–‹æ‹“ãƒ»ç‹¬ç«‹å‹","æ–°å¤©åœ°é–‹æ‹“ãƒ»å”åŠ›å‹"],seeking:["ã‚¹ã‚­ãƒ«å¼·åŒ–ãƒ»å°‚é–€å‹","ã‚¹ã‚­ãƒ«å¼·åŒ–ãƒ»ç·åˆå‹","ãƒã‚¸ã‚·ãƒ§ãƒ³å¤‰æ›´ãƒ»æ˜‡é€²å‹","ãƒã‚¸ã‚·ãƒ§ãƒ³å¤‰æ›´ãƒ»è»¢è·å‹","ç’°å¢ƒä¸€æ–°ãƒ»è»¢è·å‹","ç’°å¢ƒä¸€æ–°ãƒ»èµ·æ¥­å‹","çµ±åˆæˆé•·ãƒ»ãƒãƒ«ãƒå‹","çµ±åˆæˆé•·ãƒ»å°‚é–€å‹"]},relationship:{positive:["é–¢ä¿‚æ·±åŒ–ãƒ»ç©æ¥µå‹","é–¢ä¿‚æ·±åŒ–ãƒ»è‡ªç„¶å‹","ç›¸äº’æˆé•·ãƒ»å”åŠ›å‹","ç›¸äº’æˆé•·ãƒ»ç‹¬ç«‹å‹","æ–°æ®µéšãƒ»é€²å±•å‹","æ–°æ®µéšãƒ»å®‰å®šå‹","çµ±åˆç™ºå±•ãƒ»çµåˆå‹","çµ±åˆç™ºå±•ãƒ»æˆç†Ÿå‹"],negative:["é–¢ä¿‚ä¿®å¾©ãƒ»å¯¾è©±å‹","é–¢ä¿‚ä¿®å¾©ãƒ»æ™‚é–“å‹","è·é›¢èª¿æ•´ãƒ»å†·å´å‹","è·é›¢èª¿æ•´ãƒ»ç†è§£å‹","æ ¹æœ¬è¦‹ç›´ã—ãƒ»åˆ¥é›¢å‹","æ ¹æœ¬è¦‹ç›´ã—ãƒ»å†æ§‹ç¯‰å‹","æ–°å‡ºç™ºãƒ»ç‹¬ç«‹å‹","æ–°å‡ºç™ºãƒ»æ–°ç¸å‹"],seeking:["ç›¸äº’ç†è§£ãƒ»æ·±åŒ–å‹","ç›¸äº’ç†è§£ãƒ»è¡¨ç¾å‹","é–¢ä¿‚æ”¹å–„ãƒ»æ­©ã¿å¯„ã‚Šå‹","é–¢ä¿‚æ”¹å–„ãƒ»å¤‰åŒ–å‹","æ–°ã—ã„é–¢ä¿‚ãƒ»ç™ºå±•å‹","æ–°ã—ã„é–¢ä¿‚ãƒ»æ¢æ±‚å‹","ç†æƒ³å®Ÿç¾ãƒ»å‰µé€ å‹","ç†æƒ³å®Ÿç¾ãƒ»è‡ªç„¶å‹"]}},o=Object.entries(r).sort(([,n],[,e])=>e-n)[0][0],s=(i[a]?.[o]||i.work.seeking).map((n,i)=>{const o=Math.floor(15*(i-4)),s=Math.max(1,Math.min(386,t.é€šã—ç•ªå·+o)),l=this.getActualH384Data(s);return{pathIndex:i+1,pathId:`contextual_${a}_${i}`,name:n,probability:this.calculateContextualProbability(i,r),currentLine:t.é€šã—ç•ªå·,targetLine:s,lineData:l,score:this.calculateContextualScore(l,e),keywords:l.ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰||["é€²æ­©","èª¿æ•´","ç™ºå±•"],description:`${n}: ${l.ç¾ä»£è§£é‡ˆã®è¦ç´„||l.ç¾ä»£è§£é‡ˆ}`.substring(0,100),hexagramTransformation:{from:{number:t.å¦ç•ªå·,name:t.å¦å,yao:t.çˆ»},to:{number:l.å¦ç•ªå·,name:l.å¦å,yao:l.çˆ»}},textAnalysisBased:!0}});return console.log("âœ… Generated contextual paths:",s.length),s},calculateContextualProbability:function(n,e){const t=1.2*e.positive+1.1*e.seeking-.8*e.negative;return Math.max(.05,Math.min(.35,[.078,.117,.143,.214,.116,.173,.211,.316][n]*(1+.3*t)))},calculateContextualScore:function(n,e){const t=n.S1_åŸºæœ¬ã‚¹ã‚³ã‚¢||65,a=20*e.confidence,r=10*(e.analysis.emotionScores.positive-e.analysis.emotionScores.negative);return Math.max(30,Math.min(95,Math.round(t+a+r)))}},"undefined"!=typeof window&&(window.BinaryTreeCompleteDisplay=BinaryTreeCompleteDisplay,console.log("âœ… BinaryTreeCompleteDisplay exported to global scope")),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{console.log("ğŸŒ³ Binary Tree Complete Display System v2.1 Ready")}):console.log("ğŸŒ³ Binary Tree Complete Display System v2.1 Loaded");