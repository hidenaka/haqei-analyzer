window.BinaryTreeCompleteDisplay={display:function(t){console.log("ğŸŒ³ Binary Tree Complete Display v2.1 é–‹å§‹"),t||(t=this.generateDefaultResultWithH384Data()),this.loadChartJS(()=>{this.renderCompleteAnalysis(t)})},generateDefaultResultWithH384Data:function(){let t=null;window.H384_DATA&&window.H384_DATA.length>0&&(t=window.H384_DATA.find(t=>248===t.é€šã—ç•ªå·)||window.H384_DATA[247]);const n=t?{"ç¶™ç¶šå¼·åŒ–":this.calculateProbabilityFromLine(t,"continue_strong"),"ç¶™ç¶šèª¿æ•´":this.calculateProbabilityFromLine(t,"continue_transform"),"è»¢æ›çµ±åˆ":this.calculateProbabilityFromLine(t,"transform_integrate"),"è»¢æ›æ®µéš":this.calculateProbabilityFromLine(t,"transform_step")}:{"ç¶™ç¶šå¼·åŒ–":.27,"ç¶™ç¶šèª¿æ•´":.24,"è»¢æ›çµ±åˆ":.27,"è»¢æ›æ®µéš":.22},e=[{pathIndex:1,title:"ç¶™ç¶šå¼·åŒ–ãƒ»çªç ´å‹",probability:.55*n.ç¶™ç¶šå¼·åŒ–,route:["é–‹å§‹","ç¶™ç¶šé¸æŠ","å¼·åŒ–æ–¹å‘"],description:"ç¾åœ¨ã®å¼·ã¿ã‚’æœ€å¤§é™ã«æ´»ã‹ã™é“"},{pathIndex:2,title:"ç¶™ç¶šå¼·åŒ–ãƒ»å®‰å®šå‹",probability:.45*n.ç¶™ç¶šå¼·åŒ–,route:["é–‹å§‹","ç¶™ç¶šé¸æŠ","å®‰å®šæ–¹å‘"],description:"ç€å®Ÿãªæˆé•·ã‚’é‡è¦–ã™ã‚‹é“"},{pathIndex:3,title:"ç¶™ç¶šèª¿æ•´ãƒ»é©æ–°å‹",probability:.54*n.ç¶™ç¶šèª¿æ•´,route:["é–‹å§‹","ç¶™ç¶šé¸æŠ","é©æ–°æ–¹å‘"],description:"æ—¢å­˜ã®æ çµ„ã¿ã‚’é©æ–°ã™ã‚‹é“"},{pathIndex:4,title:"ç¶™ç¶šèª¿æ•´ãƒ»æ”¹å–„å‹",probability:.46*n.ç¶™ç¶šèª¿æ•´,route:["é–‹å§‹","ç¶™ç¶šé¸æŠ","æ”¹å–„æ–¹å‘"],description:"æ®µéšçš„ãªæ”¹å–„ã‚’é‡ã­ã‚‹é“"},{pathIndex:5,title:"è»¢æ›çµ±åˆãƒ»èåˆå‹",probability:.52*n.è»¢æ›çµ±åˆ,route:["é–‹å§‹","è»¢æ›é¸æŠ","èåˆæ–¹å‘"],description:"æ–°æ—§ã®è¦ç´ ã‚’çµ±åˆã™ã‚‹é“"},{pathIndex:6,title:"è»¢æ›çµ±åˆãƒ»å‰µé€ å‹",probability:.48*n.è»¢æ›çµ±åˆ,route:["é–‹å§‹","è»¢æ›é¸æŠ","å‰µé€ æ–¹å‘"],description:"å…¨ãæ–°ã—ã„ä¾¡å€¤ã‚’å‰µé€ ã™ã‚‹é“"},{pathIndex:7,title:"è»¢æ›æ®µéšãƒ»é£›èºå‹",probability:.55*n.è»¢æ›æ®µéš,route:["é–‹å§‹","è»¢æ›é¸æŠ","é£›èºæ–¹å‘"],description:"å¤§ããªé£›èºã‚’ç›®æŒ‡ã™é“"},{pathIndex:8,title:"è»¢æ›æ®µéšãƒ»æ¢ç´¢å‹",probability:.45*n.è»¢æ›æ®µéš,route:["é–‹å§‹","è»¢æ›é¸æŠ","æ¢ç´¢æ–¹å‘"],description:"æ–°ãŸãªå¯èƒ½æ€§ã‚’æ¢ç´¢ã™ã‚‹é“"}],i=e.reduce((t,n)=>t+n.probability,0);return e.forEach(t=>t.probability=t.probability/i),{currentLine:248,lineData:t,finalEightPaths:e,branchingData:this.generateBranchingData(e)}},calculateProbabilityFromLine:function(t,n){if(!t)return.25;const e=t.ä½ç½®||3,i="é™½"===t.é™°é™½;switch(n){case"continue_strong":return i?.3+.02*e:.2+.01*e;case"continue_transform":return i?.25-.01*e:.25+.01*e;case"transform_integrate":return i?.2+.02*e:.3+.01*e;case"transform_step":return i?.2+.01*e:.25-.01*e;default:return.25}},generateBranchingData:function(t){const n={x:0,y:.5,label:"ç¾åœ¨"},e=[{x:1,y:.3,probability:t.slice(0,4).reduce((t,n)=>t+n.probability,0),label:"ç¶™ç¶šè·¯ç·š",parent:0},{x:1,y:.7,probability:t.slice(4,8).reduce((t,n)=>t+n.probability,0),label:"è»¢æ›è·¯ç·š",parent:0}],i=[{x:2,y:.15,probability:t[0].probability+t[1].probability,label:"ç¶™ç¶šå¼·åŒ–",parent:0},{x:2,y:.35,probability:t[2].probability+t[3].probability,label:"ç¶™ç¶šèª¿æ•´",parent:0},{x:2,y:.55,probability:t[4].probability+t[5].probability,label:"è»¢æ›çµ±åˆ",parent:1},{x:2,y:.75,probability:t[6].probability+t[7].probability,label:"è»¢æ›æ®µéš",parent:1}],a=t.map((t,n)=>({x:3,y:.05+.125*n,probability:t.probability,label:`ãƒ‘ã‚¹${n+1}`,title:t.title,parent:Math.floor(n/2)}));return{phase1:n,phase2:e,phase3:i,phase4:a,allPhases:[n,...e,...i,...a]}},loadChartJS:function(t){if(window.Chart)return void t();const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js",n.onload=t,document.head.appendChild(n)},renderCompleteAnalysis:function(t){const n=document.querySelector(".main-content")||document.querySelector("#results-container")||document.querySelector("#binary-tree-results")||document.body;n?(n.innerHTML=this.generateHTML(t),setTimeout(()=>{this.renderBranchingChart(t)},100),this.setupDownload(t)):console.error("No container found for results")},generateHTML:function(t){const n=t.finalEightPaths.slice(4,8).reduce((t,n)=>t+n.probability,0),e=t.finalEightPaths.slice(0,4).reduce((t,n)=>t+n.probability,0),i=t.finalEightPaths.reduce((t,n)=>n.probability>t.probability?n:t);return`\n            <div class="binary-tree-complete-analysis" style="padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; color: white; margin: 20px 0;">\n                \n                \x3c!-- ã‚¿ã‚¤ãƒˆãƒ« --\x3e\n                <div style="text-align: center; margin-bottom: 40px;">\n                    <h2 style="font-size: 2em; margin-bottom: 10px; color: white;">ğŸŒ³ Binary Tree æœªæ¥åˆ†å²åˆ†æ</h2>\n                    <p style="font-size: 1.2em; opacity: 0.95;">8ã¤ã®æœªæ¥ãƒ‘ã‚¹ã‹ã‚‰çµ±åˆçš„æ´å¯Ÿã‚’ç”Ÿæˆã—ã¾ã™</p>\n                    ${t.lineData?`<p style="font-size: 0.9em; opacity: 0.8;">åŸºæº–: ${t.lineData.å¦å} ${t.lineData.çˆ»å}</p>`:""}\n                </div>\n\n                \x3c!-- åˆ†å²å‹æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ• --\x3e\n                <div style="background: white; border-radius: 16px; padding: 30px; margin-bottom: 30px;">\n                    <h3 style="color: #4338ca; margin-bottom: 20px;">ğŸ“ˆ æœªæ¥åˆ†å²ãƒ‘ã‚¹ã®å¯è¦–åŒ–</h3>\n                    <div style="height: 400px; position: relative;">\n                        <canvas id="branchingChart"></canvas>\n                    </div>\n                    <div style="margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 8px;">\n                        <p style="color: #4b5563; margin: 0; font-size: 0.9em;">\n                            <strong>èª¬æ˜:</strong> ç¾åœ¨ã‹ã‚‰å§‹ã¾ã‚Šã€2ã¤â†’4ã¤â†’æœ€çµ‚çš„ã«8ã¤ã®ãƒ‘ã‚¹ã¸åˆ†å²ã™ã‚‹æœªæ¥ã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚\n                            ç·šã®å¤ªã•ã¯ç¢ºç‡ã®é«˜ã•ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚\n                        </p>\n                    </div>\n                </div>\n\n                \x3c!-- 8ã‚·ãƒŠãƒªã‚ªã‚«ãƒ¼ãƒ‰ --\x3e\n                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 40px;">\n                    ${t.finalEightPaths.map((t,n)=>this.generatePathCard(t,n)).join("")}\n                </div>\n\n                \x3c!-- HaQeiçµ±åˆåˆ†æ --\x3e\n                ${this.generateInsightSection(t,n,e,i)}\n\n                \x3c!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ --\x3e\n                <div style="text-align: center; margin-top: 30px;">\n                    <button onclick="window.print()" style="background: white; color: #4338ca; padding: 12px 30px; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin: 0 10px;">\n                        ğŸ“„ PDFã§ä¿å­˜\n                    </button>\n                    <button onclick="window.BinaryTreeCompleteDisplay.downloadResults()" style="background: white; color: #4338ca; padding: 12px 30px; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; margin: 0 10px;">\n                        ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\n                    </button>\n                </div>\n            </div>\n        `},generatePathCard:function(t,n){return`\n            <div style="background: rgba(255,255,255,0.95); border-radius: 12px; padding: 20px; color: #333; border-left: 4px solid ${["#22c55e","#3b82f6","#a855f7","#ec4899","#fb923c","#facc15","#0ea5e9","#6366f1"][n]};">\n                <div style="display: flex; align-items: center; margin-bottom: 15px;">\n                    <span style="font-size: 1.5em; margin-right: 10px;">${["ğŸ¯","ğŸš€","ğŸ’¡","ğŸŒŸ","ğŸ”®","âš¡","ğŸŒˆ","âœ¨"][n]}</span>\n                    <span style="font-weight: bold;">ãƒ‘ã‚¹${t.pathIndex}</span>\n                </div>\n                <div style="font-size: 1.1em; font-weight: 600; margin-bottom: 10px; color: #4338ca;">\n                    ${t.title}\n                </div>\n                <div style="background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); padding: 8px 12px; border-radius: 8px; margin-bottom: 10px;">\n                    ç¢ºç‡: ${(100*t.probability).toFixed(1)}%\n                </div>\n                <div style="font-size: 0.85em; color: #6b7280; margin-bottom: 10px;">\n                    çµŒè·¯: ${t.route.join(" â†’ ")}\n                </div>\n                <div style="font-size: 0.9em; color: #666;">\n                    ${t.description||""}\n                </div>\n            </div>\n        `},generateInsightSection:function(t,n,e,i){const a=n>e?"è»¢æ›":"ç¶™ç¶š";return`\n            <div style="background: rgba(255,255,255,0.98); border-radius: 16px; padding: 30px; color: #333;">\n                <h3 style="color: #4338ca; margin-bottom: 25px;">ğŸ” HaQeiå“²å­¦ã«ã‚ˆã‚‹çµ±åˆçš„æ´å¯Ÿ</h3>\n                \n                \x3c!-- æ˜“çµŒãƒ™ãƒ¼ã‚¹åˆ†æ --\x3e\n                ${t.lineData?`\n                <div style="margin-bottom: 25px;">\n                    <h4 style="color: #6366f1; margin-bottom: 15px;">ğŸ“– æ˜“çµŒãƒ™ãƒ¼ã‚¹åˆ†æ</h4>\n                    <div style="background: #f9fafb; padding: 20px; border-radius: 12px; line-height: 1.8;">\n                        <p style="margin-bottom: 10px;">\n                            <strong>å¦è±¡:</strong> ${t.lineData.å¦å} - ${t.lineData.çˆ»å}\n                        </p>\n                        <p style="margin-bottom: 10px;">\n                            <strong>ç¾ä»£è§£é‡ˆ:</strong> ${t.lineData.ç¾ä»£è§£é‡ˆ||"å¤‰åŒ–ã®æ™‚æœŸã«ãŠã‘ã‚‹æ–°ãŸãªæ©Ÿä¼š"}\n                        </p>\n                        <p>\n                            <strong>è¡Œå‹•æŒ‡é‡:</strong> ${t.lineData.è¡Œå‹•||"çŠ¶æ³ã‚’è¦‹æ¥µã‚ã¦æ…é‡ã«é€²ã‚€"}\n                        </p>\n                    </div>\n                </div>\n                `:""}\n                \n                \x3c!-- æœªæ¥å‚¾å‘åˆ†æ --\x3e\n                <div style="margin-bottom: 25px;">\n                    <h4 style="color: #6366f1; margin-bottom: 15px;">ğŸ“Š ã‚ãªãŸã®æœªæ¥å‚¾å‘åˆ†æ</h4>\n                    <div style="background: #f9fafb; padding: 20px; border-radius: 12px; line-height: 1.8;">\n                        <p style="margin-bottom: 15px;">\n                            <strong>ä¸»å‚¾å‘:</strong> ã€Œ${a}ã€ã®æµã‚ŒãŒå¼·ã¾ã£ã¦ã„ã¾ã™ï¼ˆ${a}ç³»ãƒ‘ã‚¹è¨ˆ: ${(100*("è»¢æ›"===a?n:e)).toFixed(0)}%ï¼‰ã€‚\n                        </p>\n                        <p style="margin-bottom: 15px;">\n                            <strong>æœ€æœ‰åŠ›ã‚·ãƒŠãƒªã‚ª:</strong> ã€Œ${i.title}ã€ï¼ˆ${(100*i.probability).toFixed(1)}%ï¼‰\n                        </p>\n                        <p>\n                            <strong>ãƒãƒ©ãƒ³ã‚¹æŒ‡æ¨™:</strong> ç¶™ç¶š${(100*e).toFixed(0)}% vs è»¢æ›${(100*n).toFixed(0)}%\n                        </p>\n                    </div>\n                </div>\n\n                \x3c!-- åˆ†å²é¸æŠã‚¬ã‚¤ãƒ‰ --\x3e\n                <div style="margin-bottom: 25px;">\n                    <h4 style="color: #6366f1; margin-bottom: 15px;">ğŸ§­ åˆ†å²é¸æŠã«ãŠã‘ã‚‹é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h4>\n                    <div style="display: grid; gap: 15px;">\n                        <div style="background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); padding: 15px; border-radius: 10px;">\n                            <strong>ç¬¬1åˆ†å²:</strong> ç¾çŠ¶ç¶­æŒã‹å¤‰é©ã‹ã®åŸºæœ¬æ–¹é‡\n                        </div>\n                        <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 15px; border-radius: 10px;">\n                            <strong>ç¬¬2åˆ†å²:</strong> ç©æ¥µæ€§ã‹æ…é‡æ€§ã‹ã®è¡Œå‹•æ§˜å¼\n                        </div>\n                        <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 15px; border-radius: 10px;">\n                            <strong>ç¬¬3åˆ†å²:</strong> å€‹äººæœ€é©ã‹å…¨ä½“æœ€é©ã‹ã®ä¾¡å€¤åŸºæº–\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ --\x3e\n                <div style="margin-bottom: 25px;">\n                    <h4 style="color: #6366f1; margin-bottom: 15px;">ğŸ’¡ å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h4>\n                    <div style="background: #f9fafb; padding: 20px; border-radius: 12px;">\n                        <ol style="line-height: 2; margin: 0; padding-left: 20px;">\n                            <li><strong>çŸ­æœŸï¼ˆ3ãƒ¶æœˆï¼‰:</strong> ç¾åœ¨ã®å¼·ã¿ã‚’èªè­˜ã—åŸºç›¤ã‚’å›ºã‚ã‚‹</li>\n                            <li><strong>ä¸­æœŸï¼ˆ6ãƒ¶æœˆï¼‰:</strong> é¸æŠã—ãŸæ–¹å‘æ€§ã¸ã®æ®µéšçš„ç§»è¡Œ</li>\n                            <li><strong>é•·æœŸï¼ˆ1å¹´ï¼‰:</strong> æ–°ãŸãªçŠ¶æ…‹ã§ã®å®‰å®šã¨æ¬¡ã®æˆé•·æº–å‚™</li>\n                        </ol>\n                    </div>\n                </div>\n\n                \x3c!-- HaQeiå“²å­¦ç·æ‹¬ --\x3e\n                <div>\n                    <h4 style="color: #6366f1; margin-bottom: 15px;">ğŸ¯ HaQeiå“²å­¦ã®æ ¸å¿ƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h4>\n                    <div style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); padding: 20px; border-radius: 12px; color: white; text-align: center; font-size: 1.1em; line-height: 1.6;">\n                        ã€Œ8ã¤ã®ãƒ‘ã‚¹ã¯å…¨ã¦å¯èƒ½æ€§ã§ã™ã€‚é‡è¦ãªã®ã¯é¸æŠã§ã¯ãªãã€é¸ã‚“ã é“ã§ã®å®Ÿè·µã§ã™ã€‚ã€\n                    </div>\n                </div>\n            </div>\n        `},renderBranchingChart:function(t){const n=document.getElementById("branchingChart");if(!n||!window.Chart)return;const e=t.branchingData;if(!e)return;const i=this.generateBranchingDatasets(e);new Chart(n,{type:"line",data:{labels:["ç¾åœ¨","ãƒ•ã‚§ãƒ¼ã‚º1","ãƒ•ã‚§ãƒ¼ã‚º2","ãƒ•ã‚§ãƒ¼ã‚º3"],datasets:i},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom"},tooltip:{callbacks:{label:function(t){const n=t.dataset;return`${n.label}: ${(100*n.probability).toFixed(1)}%`}}}},scales:{x:{title:{display:!0,text:"æ™‚é–“çµŒé â†’"}},y:{min:0,max:1,title:{display:!0,text:"åˆ†å²ä½ç½®"},ticks:{display:!1}}},elements:{line:{tension:.4}}}}),console.log("âœ… åˆ†å²å‹æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•æç”»å®Œäº†")},generateBranchingDatasets:function(t){const n=[],e=["rgba(34, 197, 94, 0.8)","rgba(59, 130, 246, 0.8)","rgba(168, 85, 247, 0.8)","rgba(236, 72, 153, 0.8)","rgba(251, 146, 60, 0.8)","rgba(250, 204, 21, 0.8)","rgba(14, 165, 233, 0.8)","rgba(99, 102, 241, 0.8)"];return t.phase4.forEach((i,a)=>{const r=this.tracePath(t,a);n.push({label:i.title||`ãƒ‘ã‚¹${a+1}`,data:r,borderColor:e[a],backgroundColor:e[a].replace("0.8","0.2"),borderWidth:2+10*i.probability,probability:i.probability,fill:!1})}),n},tracePath:function(t,n){const e=[],i=t.phase4[n];e.push({x:0,y:.5});const a=n<4?t.phase2[0]:t.phase2[1];e.push({x:1,y:a.y});const r=Math.floor(n/2),o=t.phase3[r];return e.push({x:2,y:o.y}),e.push({x:3,y:i.y}),e},setupDownload:function(t){window.BinaryTreeCompleteDisplay.downloadResults=function(){const n={timestamp:(new Date).toISOString(),analysis:t,insights:{generated:!0,version:"2.1.0-branching-graph",dataSource:"H384_DATABASE"}},e=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),i=URL.createObjectURL(e),a=document.createElement("a");a.href=i,a.download=`binary-tree-analysis-${Date.now()}.json`,a.click()}},downloadResults:function(){window.BinaryTreeCompleteDisplay.downloadResults&&window.BinaryTreeCompleteDisplay.downloadResults()}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{console.log("ğŸŒ³ Binary Tree Complete Display System v2.1 Ready")}):console.log("ğŸŒ³ Binary Tree Complete Display System v2.1 Loaded");