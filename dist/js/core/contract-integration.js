function showNotification(e,a="info"){const t=document.createElement("div");t.className=`fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${"success"===a?"bg-green-500":"error"===a?"bg-red-500":"bg-blue-500"} text-white`,t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transition="opacity 0.5s",setTimeout(()=>t.remove(),500)},3e3)}window.saveFuturePathsContract=async function(e){try{const a={paths:e.map((e,a)=>({id:e.id||`P${a+1}`,title:e.title||e.name||"",analysis:e.analysis||e.description||"",advice:e.advice||e.recommendation||"",hexagram:{id:e.hexagramId||e.hexagram?.id||1,name:e.hexagramName||e.hexagram?.name||"乾為天",symbol:e.symbol||e.hexagram?.symbol||"☰☰"},risk:e.risk||.5,potential:e.potential||.5,recommendation:e.recommendation_score||.5,rationale:e.rationale||"",milestones:e.milestones||["Step 1","Step 2","Step 3"]})),created_at:(new Date).toISOString()};window.dataPersistenceManager||(window.dataPersistenceManager=new DataPersistenceManager);const t=await window.dataPersistenceManager.saveContractB(a);return t&&(console.log("✅ Future Paths契約保存成功"),showNotification("シナリオ分析結果を保存しました","success")),t}catch(a){return console.error("契約B保存エラー:",a),showNotification("保存に失敗しました","error"),!1}},window.saveTripleOSContract=async function(e){try{const a={version:"1.0",engine_os:{id:e.engineOS?.id||1,name:e.engineOS?.name||"乾為天",score:e.engineOS?.score||.5},interface_os:{id:e.interfaceOS?.id||2,name:e.interfaceOS?.name||"坤為地",score:e.interfaceOS?.score||.5},safe_mode_os:{id:e.safeModeOS?.id||29,name:e.safeModeOS?.name||"坎為水",score:e.safeModeOS?.score||.5},synergy:e.synergy||{matrix:[[0,0,0]],notes:""},strengths:e.strengths||[],risks:e.risks||[],raw_answers:e.answers||{},created_at:(new Date).toISOString()};window.dataPersistenceManager||(window.dataPersistenceManager=new DataPersistenceManager);const t=await window.dataPersistenceManager.saveContractA(a);return t&&(console.log("✅ Triple OS契約保存成功"),showNotification("OS分析結果を保存しました","success")),t}catch(a){return console.error("契約A保存エラー:",a),showNotification("保存に失敗しました","error"),!1}},window.loadContracts=async function(){try{window.dataPersistenceManager||(window.dataPersistenceManager=new DataPersistenceManager);const[e,a]=await Promise.all([window.dataPersistenceManager.loadContractA(),window.dataPersistenceManager.loadContractB()]);return{tripleOS:e,futurePaths:a}}catch(e){return console.error("契約読み込みエラー:",e),{tripleOS:null,futurePaths:null}}},console.log("✅ 契約統合モジュール読み込み完了");