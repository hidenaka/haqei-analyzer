!function(e){"use strict";const t={version:"1.0.0-bootstrap",autoInitialize:!0,loadTimeout:1e4,retryAttempts:3,verboseLogging:!1,dependencies:["UnifiedErrorHandler.js","GlobalErrorSystemInitializer.js"],integrationTargets:["app.js","VirtualQuestionFlow","TripleOSEngine","CacheManager","PerformanceOptimizer"],performance:{enableLazyLoading:!0,enableCodeSplitting:!0,enableCaching:!0,memoryOptimization:!0}};class HAQEIErrorSystemBootstrap{constructor(){this.initialized=!1,this.loading=!1,this.loadAttempts=0,this.startTime=performance.now(),this.state={dependenciesLoaded:new Set,systemsIntegrated:new Set,errors:[],metrics:{loadTime:0,memoryBaseline:0,initializationTime:0}},this.config={...t},this.events=new Map,console.log(`üöÄ HAQEI Error System Bootstrap v${this.config.version} ready`)}async bootstrap(e={}){if(this.loading||this.initialized)console.warn("‚ö†Ô∏è Bootstrap already in progress or completed");else{this.loading=!0,this.state.metrics.memoryBaseline=this.getMemoryUsage();try{this.config={...this.config,...e},console.log("üöÄ Starting HAQEI Error System Bootstrap..."),this.validateEnvironment(),this.loadDependencies(),this.initializeSystem(),this.performIntegration(),this.validateBootstrap(),this.initialized=!0,this.loading=!1;const t=performance.now()-this.startTime;return this.state.metrics.loadTime=t,console.log(`‚úÖ HAQEI Error System Bootstrap completed in ${t.toFixed(2)}ms`),this.emit("bootstrap:complete",{success:!0,metrics:this.state.metrics,config:this.config}),{success:!0,metrics:this.state.metrics}}catch(t){return console.error("‚ùå Bootstrap failed:",t),this.state.errors.push(t),this.loading=!1,this.emit("bootstrap:error",{error:t,attempts:this.loadAttempts}),this.loadAttempts<this.config.retryAttempts?(this.loadAttempts++,console.log(`üîÑ Retrying bootstrap (attempt ${this.loadAttempts}/${this.config.retryAttempts})...`),this.bootstrap(e)):(await this.handleBootstrapFailure(t),{success:!1,error:t.message})}}}async validateEnvironment(){if(console.log("üîç Phase 1: Validating environment..."),!window.Promise||!window.fetch)throw new Error("Browser does not support required features (Promise, fetch)");document.readyState,this.checkForConflicts(),console.log("‚úÖ Environment validation passed")}checkForConflicts(){const e=[];window.onerror&&"function"==typeof window.onerror&&e.push("Global onerror handler detected"),window.onunhandledrejection&&"function"==typeof window.onunhandledrejection&&e.push("Global unhandledrejection handler detected");["Sentry","Bugsnag","LogRocket","Rollbar"].forEach(t=>{window[t]&&e.push(`${t} error tracking library detected`)}),e.length>0&&console.warn("‚ö†Ô∏è Potential conflicts detected:",e)}async loadDependencies(){console.log("üì¶ Phase 2: Loading dependencies...");const e=this.config.dependencies.map(e=>this.loadDependency(e));if((await Promise.allSettled(e)).forEach((e,t)=>{const r=this.config.dependencies[t];"fulfilled"===e.status?(this.state.dependenciesLoaded.add(r),console.log(`‚úÖ Loaded: ${r}`)):(console.error(`‚ùå Failed to load: ${r}`,e.reason),this.state.errors.push(e.reason))}),0===this.state.dependenciesLoaded.size)throw new Error("No dependencies could be loaded");console.log(`‚úÖ Dependencies loaded: ${this.state.dependenciesLoaded.size}/${this.config.dependencies.length}`)}async loadDependency(e){try{if(this.isDependencyLoaded(e))return void console.log(`‚è≠Ô∏è Already loaded: ${e}`);const t=this.buildScriptPath(e);if(this.config.performance.enableLazyLoading?await this.loadScriptAsync(t):await this.loadScriptSync(t),!this.isDependencyLoaded(e))throw new Error(`Dependency ${e} loaded but not available`)}catch(t){throw new Error(`Failed to load dependency ${e}: ${t.message}`)}}isDependencyLoaded(e){switch(e){case"UnifiedErrorHandler.js":return!!window.UnifiedErrorHandler;case"GlobalErrorSystemInitializer.js":return!!window.GlobalErrorSystemInitializer;default:return!1}}buildScriptPath(e){return"/js/core/"+e}async loadScriptAsync(e){return new Promise((t,r)=>{const o=document.createElement("script");o.src=e,o.async=!0,o.onload=()=>{console.log(`üì¶ Script loaded: ${e}`),t()},o.onerror=()=>{r(new Error(`Failed to load script: ${e}`))};const i=setTimeout(()=>{r(new Error(`Script load timeout: ${e}`))},this.config.loadTimeout);o.onload=()=>{clearTimeout(i),t()},document.head.appendChild(o)})}async loadScriptSync(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const r=await t.text(),o=document.createElement("script");o.textContent=r,document.head.appendChild(o)}catch(t){throw new Error(`Sync load failed for ${e}: ${t.message}`)}}async initializeSystem(){console.log("üéØ Phase 3: Initializing system...");const e=performance.now();if(!window.GlobalErrorSystemInitializer)throw new Error("GlobalErrorSystemInitializer not available");this.systemInitializer=new window.GlobalErrorSystemInitializer({migrationStrategy:"gradual",backwardCompatibility:!0,autoDiscovery:!0,debugMode:this.config.verboseLogging,integrateWithApp:!0,integrateWithVirtualQuestionFlow:!0,integrateWithTripleOS:!0,enablePerformanceMonitoring:!0,enableMetricsCollection:!0});const t=await this.systemInitializer.initialize();if(!t.success)throw new Error(`System initialization failed: ${t.error}`);this.state.metrics.initializationTime=performance.now()-e,console.log(`‚úÖ System initialized in ${this.state.metrics.initializationTime.toFixed(2)}ms`)}async performIntegration(){console.log("üîå Phase 4: Performing integration...");const e=this.discoverIntegrationTargets();for(const r of e)try{await this.integrateWithTarget(r),this.state.systemsIntegrated.add(r),console.log(`‚úÖ Integrated with: ${r}`)}catch(t){console.warn(`‚ö†Ô∏è Integration failed with ${r}:`,t),this.state.errors.push(t)}console.log(`‚úÖ Integration completed: ${this.state.systemsIntegrated.size} systems`)}discoverIntegrationTargets(){const e=[];return this.config.integrationTargets.forEach(t=>{this.isTargetAvailable(t)&&e.push(t)}),e}isTargetAvailable(e){switch(e){case"app.js":return!!window.app;case"VirtualQuestionFlow":return!!window.VirtualQuestionFlow;case"TripleOSEngine":return!!window.TripleOSEngine;case"CacheManager":return!!window.CacheManager;case"PerformanceOptimizer":return!!window.PerformanceOptimizer;default:return!!window[e]}}async integrateWithTarget(e){switch(e){case"CacheManager":await this.integrateCacheManager();break;case"PerformanceOptimizer":await this.integratePerformanceOptimizer()}}async integrateCacheManager(){if(window.CacheManager){const e=window.CacheManager.prototype.init;window.CacheManager.prototype.init=async function(){try{return await e.call(this)}catch(t){throw window.HAQEIErrorHandler&&await window.HAQEIErrorHandler.handleError(t,{source:"CacheManager",method:"init"}),t}}}}async integratePerformanceOptimizer(){if(window.PerformanceOptimizer){const e=window.PerformanceOptimizer.prototype.optimize;window.PerformanceOptimizer.prototype.optimize=async function(){try{return await e.call(this)}catch(t){throw window.HAQEIErrorHandler&&await window.HAQEIErrorHandler.handleError(t,{source:"PerformanceOptimizer",method:"optimize"}),t}}}}async validateBootstrap(){if(console.log("‚úÖ Phase 5: Validating bootstrap..."),!window.HAQEIErrorHandler)throw new Error("Unified error handler not available");try{if(!(await window.HAQEIErrorHandler.handleError(new Error("Bootstrap validation test"),{source:"bootstrap-validation",test:!0})).success)throw new Error("Error handler validation failed")}catch(t){throw new Error(`Error handler test failed: ${t.message}`)}const e=this.getMemoryUsage()-this.state.metrics.memoryBaseline;e>52428800&&console.warn(`‚ö†Ô∏è Significant memory increase detected: ${(e/1024/1024).toFixed(2)}MB`),console.log("‚úÖ Bootstrap validation passed")}async handleBootstrapFailure(e){console.error("üö® Bootstrap failed, activating fallback mode...");try{window.HAQEIErrorHandler={handleError:(e,t={})=>(console.error("[Fallback Handler]",e,t),Promise.resolve({success:!0,strategy:"fallback"}))},window.addEventListener("error",e=>{console.error("[Fallback] Global error:",e.error)}),window.addEventListener("unhandledrejection",e=>{console.error("[Fallback] Unhandled rejection:",e.reason)}),console.log("‚úÖ Fallback mode activated")}catch(t){console.error("‚ùå Fallback activation failed:",t)}}getMemoryUsage(){return performance.memory?performance.memory.usedJSHeapSize:0}on(e,t){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t)}emit(e,t){this.events.has(e)&&this.events.get(e).forEach(r=>{try{r(t)}catch(o){console.error(`Event callback error for ${e}:`,o)}})}getBootstrapStatus(){return{version:this.config.version,initialized:this.initialized,loading:this.loading,loadAttempts:this.loadAttempts,dependenciesLoaded:Array.from(this.state.dependenciesLoaded),systemsIntegrated:Array.from(this.state.systemsIntegrated),errors:this.state.errors.length,metrics:this.state.metrics}}}if(e.HAQEIErrorSystemBootstrap=HAQEIErrorSystemBootstrap,t.autoInitialize){const autoBootstrap=async()=>{try{const t=new HAQEIErrorSystemBootstrap;await t.bootstrap(),e.haqeiErrorBootstrap=t}catch(t){console.error("‚ùå Auto-bootstrap failed:",t)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",autoBootstrap,{once:!0}):setTimeout(autoBootstrap,100)}console.log("üåü HAQEI Error System Bootstrap ready for auto-initialization")}("undefined"!=typeof window?window:global);