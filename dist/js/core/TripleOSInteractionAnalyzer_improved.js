!function(e){"use strict";e.TripleOSInteractionAnalyzer=class{constructor(){try{this.version="1.2",console.log("ğŸ”® TripleOSInteractionAnalyzer v1.2 (improved) initialized"),this._keywordCombinationCache=new Map,this._hexagramCharCache=new Map,this._pairAnalysisCache=new Map,this._harmoniousRelationsCache=new Map,this.interactionPatterns=this.initializeInteractionPatterns(),this.hexagramCharacteristics=this.loadHexagramCharacteristics()}catch(e){throw console.error("âŒ TripleOSInteractionAnalyzer initialization error:",e),new Error("Failed to initialize TripleOSInteractionAnalyzer: "+e.message)}}_memoize(e,a,r){return function(...t){try{const i=r(...t);if(a.has(i))return a.get(i);const n=e.apply(this,t);if(a.size>200){const e=a.keys().next().value;a.delete(e)}return a.set(i,n),n}catch(i){throw console.error(`âŒ Error in memoized function ${e.name}:`,i),i}}}_withErrorHandling(e,a){return function(...r){try{return e.apply(this,r)}catch(t){return console.error(`âŒ Error in ${e.name}:`,t),a}}}getHexagramCharacteristics(e){try{const a=`hex_${e}`;if(this._hexagramCharCache.has(a))return this._hexagramCharCache.get(a);const r=this.hexagramCharacteristics[e];if(!r)return console.warn(`âš ï¸ Hexagram ${e} not found, using default`),this._getDefaultHexagramCharacteristics(e);const t={name:r.name||`ç¬¬${e}å¦`,keywords:r.keywords||[],strength:r.strength||"",weakness:r.weakness||"",energy:r.energy||""};return this._hexagramCharCache.set(a,t),t}catch(a){return console.error(`âŒ Error getting hexagram characteristics for ${e}:`,a),this._getDefaultHexagramCharacteristics(e)}}_getDefaultHexagramCharacteristics(e){return{name:`ç¬¬${e}å¦`,keywords:["å¤‰åŒ–","èª¿æ•´","ç™ºå±•"],strength:"é©å¿œåŠ›",weakness:"ä¸å®‰å®šæ€§",energy:"æµå‹•çš„"}}analyzeKeywordCombination(e,a){try{const r=`kwc_${e.name}_${a.name}`;if(this._keywordCombinationCache.has(r))return this._keywordCombinationCache.get(r);const t=e.keywords||[],i=a.keywords||[],n=this._detectKeywordConflicts(t,i);return this._keywordCombinationCache.set(r,n),n}catch(r){return console.error("âŒ Error analyzing keyword combination:",r),this._getDefaultCombinations()}}_getDefaultCombinations(){return{emotionConflict:!1,relationshipConflict:!1,materialConflict:!1,learningConflict:!1,culturalConflict:!1,vitalityConflict:!1,changeConflict:!1,actionConflict:!1,systemicConflict:!1,spatialConflict:!1,capabilityConflict:!1,temporalConflict:!1}}analyzePair(e,a,r){try{if(!(a&&r&&a.hexagramId&&r.hexagramId))throw new Error("Invalid OS parameters");const t=`pair_${e}_${a.hexagramId}_${r.hexagramId}`;if(this._pairAnalysisCache.has(t))return this._pairAnalysisCache.get(t);const i=this._performPairAnalysis(e,a,r);return this._pairAnalysisCache.set(t,i),i}catch(t){return console.error(`âŒ Error analyzing pair ${e}:`,t),this._getDefaultPairAnalysis(e,a,r)}}_getDefaultPairAnalysis(e,a,r){return{pairType:e,os1:a,os2:r,characteristics:{char1:{},char2:{}},combinations:this._getDefaultCombinations(),summary:"åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ä¸€èˆ¬çš„ãªè¡¨ç¾ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚",confidence:"low",score:0}}analyzeHarmoniousRelations(e,a){try{const r=`harm_${e.name}_${a.name}`;if(this._harmoniousRelationsCache.has(r))return this._harmoniousRelationsCache.get(r);const t=this._performHarmoniousAnalysis(e,a);return this._harmoniousRelationsCache.set(r,t),t}catch(r){return console.error("âŒ Error analyzing harmonious relations:",r),{hasSpecialMeaning:!1,ichingRelations:[],subtleDifferences:[]}}}clearCache(){try{this._keywordCombinationCache.clear(),this._hexagramCharCache.clear(),this._pairAnalysisCache.clear(),this._harmoniousRelationsCache.clear(),console.log("âœ… Cache cleared successfully")}catch(e){console.error("âŒ Error clearing cache:",e)}}getCacheStatistics(){return{keywordCombinationCache:this._keywordCombinationCache.size,hexagramCharCache:this._hexagramCharCache.size,pairAnalysisCache:this._pairAnalysisCache.size,harmoniousRelationsCache:this._harmoniousRelationsCache.size,totalCached:this._keywordCombinationCache.size+this._hexagramCharCache.size+this._pairAnalysisCache.size+this._harmoniousRelationsCache.size}}}}("undefined"!=typeof window?window:this);