console.log("📚 H384DatabaseConnector Loading..."),function(global){"use strict";class H384DatabaseConnector{constructor(){this.name="H384DatabaseConnector",this.version="2.0.0",this.database=null,this.isLoaded=!1,this.loadAttempts=0,this.maxAttempts=3}async initialize(){console.log("🔄 H384DatabaseConnector initializing...");try{if(this.database=await this.loadDatabase(),this.validateDatabase())return this.isLoaded=!0,console.log("✅ H384Database loaded successfully:",{entries:this.database.length,firstEntry:this.database[0],lastEntry:this.database[this.database.length-1]}),!0;throw new Error("Database validation failed")}catch(a){return console.error("❌ H384Database initialization failed:",a),this.initializeFallback()}}async loadDatabase(){if(void 0!==window.H384_DATA&&Array.isArray(window.H384_DATA))return console.log("✅ Method 1: Direct window.H384_DATA access successful"),window.H384_DATA;if("undefined"!=typeof H384_DATA&&Array.isArray(H384_DATA))return console.log("✅ Method 2: Global H384_DATA access successful"),window.H384_DATA=H384_DATA,H384_DATA;try{const response=await fetch("./assets/H384H64database.js"),scriptText=await response.text();if(eval(scriptText),"undefined"!=typeof H384_DATA)return console.log("✅ Method 3: Dynamic import successful"),window.H384_DATA=H384_DATA,H384_DATA}catch(error){console.warn("⚠️ Method 3 failed:",error)}return console.warn("⚠️ All methods failed, generating fallback data"),this.generateFallbackData()}validateDatabase(){if(!this.database||!Array.isArray(this.database))return console.error("❌ Database is not an array"),!1;if(386!==this.database.length){if(console.warn(`⚠️ Expected 386 entries, got ${this.database.length}`),384!==this.database.length)return!1;console.log("📝 Adding missing 用九・用六 entries"),this.addMissingEntries()}const a=["通し番号","卦番号","卦名","爻","キーワード","現代解釈の要約"],t=this.database[0];for(const e of a)if(!(e in t))return console.error(`❌ Missing required field: ${e}`),!1;return console.log("✅ Database validation passed"),!0}addMissingEntries(){this.database.push({"通し番号":385,"卦番号":0,"卦名":"用九","爻":"用九","キーワード":["群龍無首","吉","協力"],"現代解釈の要約":"全ての陽が極まった状態。リーダーなき群龍が自律的に協力する理想形。","S1_基本スコア":75,"S2_ポテンシャル":80,"S3_安定性スコア":60,"S4_リスク":-20,"S5_主体性推奨スタンス":"能動","S6_変動性スコア":40,"S7_総合評価スコア":70},{"通し番号":386,"卦番号":0,"卦名":"用六","爻":"用六","キーワード":["利永貞","堅実","持続"],"現代解釈の要約":"全ての陰が極まった状態。永続的な貞節を保つことで利を得る。","S1_基本スコア":70,"S2_ポテンシャル":60,"S3_安定性スコア":80,"S4_リスク":-15,"S5_主体性推奨スタンス":"受動","S6_変動性スコア":20,"S7_総合評価スコア":75}),console.log("✅ Added 用九・用六 entries")}generateFallbackData(){console.warn("⚠️ Generating minimal fallback data");const a=[],t=["乾為天","坤為地","水雷屯","山水蒙","水天需","天水訟","地水師","水地比","風天小畜","天澤履","地天泰","天地否","天火同人","火天大有","地山謙","雷地豫","澤雷随","山風蠱","地澤臨","風地観","火雷噬嗑","山火賁","山地剥","地雷復","天雷无妄","山天大畜","山雷頤","澤風大過","坎為水","離為火","澤山咸","雷風恒","天山遯","雷天大壮","火地晋","地火明夷","風火家人","火澤睽","水山蹇","雷水解","山澤損","風雷益","澤天夬","天風姤","澤地萃","地風升","澤水困","水風井","澤火革","火風鼎","震為雷","艮為山","風山漸","雷澤帰妹","雷火豊","火山旅","巽為風","兌為澤","風水渙","水澤節","風澤中孚","雷山小過","水火既済","火水未済"],e=["初爻","二爻","三爻","四爻","五爻","上爻"];let s=1;for(let n=1;n<=64;n++)for(let i=1;i<=6;i++)a.push({"通し番号":s++,"卦番号":n,"卦名":t[n-1],"爻":e[i-1],"キーワード":["変化","転機","選択"],"現代解釈の要約":`${t[n-1]}の${e[i-1]}の状態`,"S1_基本スコア":50+Math.floor(50*Math.random()),"S2_ポテンシャル":40+Math.floor(40*Math.random()),"S3_安定性スコア":30+Math.floor(50*Math.random()),"S4_リスク":-(20+Math.floor(60*Math.random())),"S5_主体性推奨スタンス":Math.random()>.5?"能動":"受動","S6_変動性スコア":20+Math.floor(60*Math.random()),"S7_総合評価スコア":30+Math.floor(50*Math.random())});return a.push({"通し番号":385,"卦番号":0,"卦名":"用九","爻":"用九","キーワード":["群龍無首","吉","協力"],"現代解釈の要約":"全陽極まる","S1_基本スコア":75,"S2_ポテンシャル":80,"S3_安定性スコア":60,"S4_リスク":-20,"S5_主体性推奨スタンス":"能動","S6_変動性スコア":40,"S7_総合評価スコア":70},{"通し番号":386,"卦番号":0,"卦名":"用六","爻":"用六","キーワード":["利永貞","堅実","持続"],"現代解釈の要約":"全陰極まる","S1_基本スコア":70,"S2_ポテンシャル":60,"S3_安定性スコア":80,"S4_リスク":-15,"S5_主体性推奨スタンス":"受動","S6_変動性スコア":20,"S7_総合評価スコア":75}),a}initializeFallback(){return console.warn("⚠️ Using fallback initialization"),this.database=this.generateFallbackData(),this.isLoaded=!0,!0}getDatabaseData(){return this.isLoaded?this.database:(console.warn("⚠️ Database not loaded, returning empty array"),[])}getHexagramYaoData(a,t){if(!this.isLoaded)return null;const e=6*(a-1)+t-1;return e>=0&&e<this.database.length?this.database[e]:(console.warn(`⚠️ No data found for 卦${a} 爻${t}`),null)}searchByKeyword(a){return this.isLoaded?this.database.filter(t=>t["キーワード"].some(t=>t.includes(a))||t["現代解釈の要約"].includes(a)||t["卦名"].includes(a)):[]}filterByScore(a,t,e=100){return this.isLoaded?this.database.filter(s=>{const n=s[a];return n>=t&&n<=e}):[]}getStatistics(){if(!this.isLoaded)return null;const a={totalEntries:this.database.length,hexagrams:new Set(this.database.map(a=>a["卦番号"])).size,averageScores:{},stanceDistribution:{"能動":0,"受動":0,"中立":0}};return["S1_基本スコア","S2_ポテンシャル","S3_安定性スコア","S6_変動性スコア","S7_総合評価スコア"].forEach(t=>{const e=this.database.reduce((a,e)=>a+(e[t]||0),0);a.averageScores[t]=Math.round(e/this.database.length)}),this.database.forEach(t=>{const e=t["S5_主体性推奨スタンス"]||"中立";a.stanceDistribution[e]++}),a}}"undefined"!=typeof window&&(window.H384DatabaseConnector=H384DatabaseConnector,window.h384db=new H384DatabaseConnector,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.h384db.initialize()}):window.h384db.initialize()),window.getDatabaseData=function(){return window.h384db&&window.h384db.isLoaded?window.h384db.getDatabaseData():window.H384_DATA&&Array.isArray(window.H384_DATA)?window.H384_DATA:(console.warn("⚠️ getDatabaseData: No data available"),[])},console.log("✅ H384DatabaseConnector loaded")}("undefined"!=typeof window?window:this);