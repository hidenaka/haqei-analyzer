console.log("â˜¯ï¸ IChingChoiceLogic Loading..."),function(){"use strict";class IChingChoiceLogic{constructor(){this.name="IChingChoiceLogic",this.version="2.0.0",this.h384db=null,this.hexagramSequence=["ä¹¾ç‚ºå¤©","å¤ç‚ºåœ°","æ°´é›·å±¯","å±±æ°´è’™","æ°´å¤©éœ€","å¤©æ°´è¨Ÿ","åœ°æ°´å¸«","æ°´åœ°æ¯”","é¢¨å¤©å°ç•œ","å¤©æ¾¤å±¥","åœ°å¤©æ³°","å¤©åœ°å¦","å¤©ç«åŒäºº","ç«å¤©å¤§æœ‰","åœ°å±±è¬™","é›·åœ°è±«","æ¾¤é›·éš","å±±é¢¨è ±","åœ°æ¾¤è‡¨","é¢¨åœ°è¦³","ç«é›·å™¬å—‘","å±±ç«è³","å±±åœ°å‰¥","åœ°é›·å¾©","å¤©é›·æ— å¦„","å±±å¤©å¤§ç•œ","å±±é›·é ¤","æ¾¤é¢¨å¤§é","åç‚ºæ°´","é›¢ç‚ºç«","æ¾¤å±±å’¸","é›·é¢¨æ’","å¤©å±±é¯","é›·å¤©å¤§å£®","ç«åœ°æ™‹","åœ°ç«æ˜å¤·","é¢¨ç«å®¶äºº","ç«æ¾¤ç½","æ°´å±±è¹‡","é›·æ°´è§£","å±±æ¾¤æ","é¢¨é›·ç›Š","æ¾¤å¤©å¤¬","å¤©é¢¨å§¤","æ¾¤åœ°èƒ","åœ°é¢¨å‡","æ¾¤æ°´å›°","æ°´é¢¨äº•","æ¾¤ç«é©","ç«é¢¨é¼","éœ‡ç‚ºé›·","è‰®ç‚ºå±±","é¢¨å±±æ¼¸","é›·æ¾¤å¸°å¦¹","é›·ç«è±Š","ç«å±±æ—…","å·½ç‚ºé¢¨","å…Œç‚ºæ¾¤","é¢¨æ°´æ¸™","æ°´æ¾¤ç¯€","é¢¨æ¾¤ä¸­å­š","é›·å±±å°é","æ°´ç«æ—¢æ¸ˆ","ç«æ°´æœªæ¸ˆ"],this.yaoNames={1:{yang:"åˆä¹",yin:"åˆå…­"},2:{yang:"ä¹äºŒ",yin:"å…­äºŒ"},3:{yang:"ä¹ä¸‰",yin:"å…­ä¸‰"},4:{yang:"ä¹å››",yin:"å…­å››"},5:{yang:"ä¹äº”",yin:"å…­äº”"},6:{yang:"ä¸Šä¹",yin:"ä¸Šå…­"}}}async initialize(){return console.log("ğŸ”„ IChingChoiceLogic initializing..."),window.h384db&&window.h384db.isLoaded?this.h384db=window.h384db:console.warn("âš ï¸ H384 Database not ready"),console.log("âœ… IChingChoiceLogic initialized"),!0}calculateChange(e,t){return console.log(`ğŸ”„ Calculating change: ${e["å¦å"]} ${e["çˆ»"]}, follow=${t}`),t?this.progressYao(e):this.changeYao(e)}progressYao(e){const t=this.getYaoNumber(e["çˆ»"]),o=e["å¦ç•ªå·"];if(t<6){const i=t+1,n=this.getHexagramYaoData(o,i);return console.log(`ğŸ“ˆ é€²çˆ»: ${e["çˆ»"]} â†’ ${n["çˆ»"]}`),n}{const t=this.getNextHexagramBySequence(o),i=this.getHexagramYaoData(t,1);return console.log(`ğŸ“ˆ æ¬¡å¦ã¸: ${e["å¦å"]} â†’ ${i["å¦å"]}`),i}}getNextHexagramBySequence(e){return 64===e?1:e+1}changeYao(e){const t=this.hexagramToBinary(e["å¦ç•ªå·"]),o=this.getYaoNumber(e["çˆ»"]),i=o-1,n=[...t];n[i]="1"===n[i]?"0":"1";const a=this.binaryToHexagram(n.join("")),r=this.getHexagramYaoData(a,o);return console.log(`ğŸ”„ å¤‰çˆ»: ${e["å¦å"]}${e["çˆ»"]} â†’ ${r["å¦å"]}${r["çˆ»"]}`),r}getYaoNumber(e){return{"åˆä¹":1,"åˆå…­":1,"ä¹äºŒ":2,"å…­äºŒ":2,"ä¹ä¸‰":3,"å…­ä¸‰":3,"ä¹å››":4,"å…­å››":4,"ä¹äº”":5,"å…­äº”":5,"ä¸Šä¹":6,"ä¸Šå…­":6,"ç”¨ä¹":7,"ç”¨å…­":7}[e]||1}isYangYao(e){return e.includes("ä¹")}hexagramToBinary(e){return this.getHexagramStructure(e)}binaryToHexagram(e){return this.findHexagramByStructure(e)}getHexagramStructure(e){const t={1:"111111",2:"000000",3:"010001",4:"100010",5:"010111",6:"111010",7:"000010",8:"010000",9:"110111",10:"111011",11:"000111",12:"111000",13:"111101",14:"101111",15:"000100",16:"001000",17:"011001",18:"100110",19:"000011",20:"110000",21:"101001",22:"100101",23:"100000",24:"000001",25:"111001",26:"100111",27:"100001",28:"011110",29:"010010",30:"101101",31:"011100",32:"001110",33:"111100",34:"001111",35:"101000",36:"000101",37:"110101",38:"101011",39:"010100",40:"001010",41:"100011",42:"110001",43:"011111",44:"111110",45:"011000",46:"000110",47:"011010",48:"010110",49:"011101",50:"101110",51:"001001",52:"100100",53:"110100",54:"001011",55:"001101",56:"101100",57:"110110",58:"011011",59:"110010",60:"010011",61:"110011",62:"001100",63:"010101",64:"101010"};return t[e]?t[e].split(""):["0","0","0","0","0","0"]}findHexagramByStructure(e){return{111111:1,"000000":2,"010001":3,100010:4,"010111":5,111010:6,"000010":7,"010000":8,110111:9,111011:10,"000111":11,111e3:12,111101:13,101111:14,"000100":15,"001000":16,"011001":17,100110:18,"000011":19,11e4:20,101001:21,100101:22,1e5:23,"000001":24,111001:25,100111:26,100001:27,"011110":28,"010010":29,101101:30,"011100":31,"001110":32,111100:33,"001111":34,101e3:35,"000101":36,110101:37,101011:38,"010100":39,"001010":40,100011:41,110001:42,"011111":43,111110:44,"011000":45,"000110":46,"011010":47,"010110":48,"011101":49,101110:50,"001001":51,100100:52,110100:53,"001011":54,"001101":55,101100:56,110110:57,"011011":58,110010:59,"010011":60,110011:61,"001100":62,"010101":63,101010:64}[e]||1}getHexagramYaoData(e,t){return this.h384db?this.h384db.getHexagramYaoData(e,t):(console.error("âŒ Database not connected"),null)}generateThreeStageChoices(e){const t=[];let o=e;for(let i=1;i<=3;i++){const e={stage:i,current:o,theme:this.extractTheme(o),choices:[{id:"follow",label:"ãƒ†ãƒ¼ãƒã«å¾“ã†",description:`ã€Œ${o["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"].join("ã€")}ã€ã‚’å—ã‘å…¥ã‚Œã¦è¡Œå‹•ã™ã‚‹`,next:this.calculateChange(o,!0),compatibility:this.calculateCompatibility(o,!0)},{id:"reject",label:"ãƒ†ãƒ¼ãƒã«å¾“ã‚ãªã„",description:`ã€Œ${o["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"].join("ã€")}ã€ã¨ã¯ç•°ãªã‚‹é“ã‚’é¸ã¶`,next:this.calculateChange(o,!1),compatibility:this.calculateCompatibility(o,!1)}]};t.push(e),o=e.choices[0].next}return t}extractTheme(e){return{keywords:e["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"],interpretation:e["ç¾ä»£è§£é‡ˆã®è¦ç´„"],stance:e["S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹"],action:this.getRecommendedAction(e)}}getRecommendedAction(e){const t=e["S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹"],o=e["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"];return"èƒ½å‹•"===t?`ç©æ¥µçš„ã«${o[0]}ã‚’å®Ÿè¡Œã™ã‚‹`:"å—å‹•"===t?`æ…é‡ã«${o[0]}ã®æ™‚æœŸã‚’å¾…ã¤`:`çŠ¶æ³ã‚’è¦‹æ¥µã‚ãªãŒã‚‰${o[0]}ã‚’æ„è­˜ã™ã‚‹`}calculateCompatibility(e,t){const o=e["S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢"],i=Math.abs(e["S4_ãƒªã‚¹ã‚¯"]);return t?Math.round(.8*o+.2*(100-i)):Math.round(.6*(100-o)+.4*i)}generate8Scenarios(e){const t=[];return[["follow","follow","follow"],["follow","follow","reject"],["follow","reject","follow"],["follow","reject","reject"],["reject","follow","follow"],["reject","follow","reject"],["reject","reject","follow"],["reject","reject","reject"]].forEach((o,i)=>{let n=e[0].current;const a=[];o.forEach((t,o)=>{const i=e[o],r=i.choices.find(e=>e.id===t);a.push({stage:o+1,hexagram:n,choice:t,choiceLabel:r.label,theme:i.theme}),n=r.next}),t.push({id:i+1,path:o,pathDetails:a,finalHexagram:n,title:this.generateScenarioTitle(o),description:this.generateScenarioDescription(a),probability:this.calculateScenarioProbability(a),recommendation:this.generateRecommendation(a)})}),t}generateScenarioTitle(e){return{"follow,follow,follow":"å®Œå…¨å—å®¹ã®é“","follow,follow,reject":"æœ€çµ‚è»¢æ›ã®é“","follow,reject,follow":"ä¸­é–“è»¢æ›ã®é“","follow,reject,reject":"å¾ŒåŠé©æ–°ã®é“","reject,follow,follow":"åˆæœŸé©æ–°ã®é“","reject,follow,reject":"ä¸¡ç«¯é©æ–°ã®é“","reject,reject,follow":"æœ€çµ‚å—å®¹ã®é“","reject,reject,reject":"å®Œå…¨é©æ–°ã®é“"}[e.join(",")]||"æœªå®šç¾©ã®é“"}generateScenarioDescription(e){let t="";return e.forEach((e,o)=>{const i="follow"===e.choice?"å—ã‘å…¥ã‚Œ":"æ‹’å¦ã—";t+=`ç¬¬${o+1}æ®µéšã§ã€Œ${e.theme.keywords[0]}ã€ã‚’${i}ã€`}),t+="æ–°ãŸãªé“ã‚’åˆ‡ã‚Šé–‹ãã€‚",t}calculateScenarioProbability(e){let t=0;return e.forEach(e=>{const o=e.hexagram,i="follow"===e.choice,n=this.calculateCompatibility(o,i);t+=n}),Math.round(t/e.length)}generateRecommendation(e){const t=e.filter(e=>"follow"===e.choice).length;return 3===t?"æ˜“çµŒã®æ•™ãˆã«å®Œå…¨ã«å¾“ã„ã€è‡ªç„¶ã®æµã‚Œã«èº«ã‚’ä»»ã›ã‚‹ã“ã¨ã§æœ€è‰¯ã®çµæœã‚’å¾—ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚":0===t?"æ—¢å­˜ã®æ çµ„ã¿ã«ã¨ã‚‰ã‚ã‚Œãšã€ç‹¬è‡ªã®é“ã‚’åˆ‡ã‚Šé–‹ãã“ã¨ã§æ–°ãŸãªå¯èƒ½æ€§ãŒé–‹ã‘ã‚‹ã§ã—ã‚‡ã†ã€‚":"ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã¡ãªãŒã‚‰ã€çŠ¶æ³ã«å¿œã˜ã¦æŸ”è»Ÿã«å¯¾å¿œã™ã‚‹ã“ã¨ãŒæˆåŠŸã¸ã®éµã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚"}}"undefined"!=typeof window&&(window.IChingChoiceLogic=IChingChoiceLogic,window.iChingChoice=new IChingChoiceLogic,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.iChingChoice.initialize()}):window.iChingChoice.initialize()),console.log("âœ… IChingChoiceLogic loaded")}("undefined"!=typeof window&&window);