function getOSDetailText(e,n){if(!e)return"";const t=e.name_jp||e.name||"åç§°ä¸æ˜Ž",i=e.catchphrase||"",r=e.description||"",s=(e.keywords,n?.keyword_short||""),o=n?.archetype_icon||"",a=n?.summary||"",l=n?.strategic_roles||[],c=n?.micro_examples||[];return`\nã€${t}ã€‘${o?" "+o:""}\n${i?"ã€Œ"+i+"ã€\n":""}\n${s?"ðŸ“ *"+s+"*\n":""}\n\n${r?r+"\n\n":""}\n${a?"ðŸŽ¯ **äººæ ¼ã®æ ¸å¿ƒ**\n"+a+"\n\n":""}\n${l.length>0?"ðŸ”§ **æˆ¦ç•¥çš„å½¹å‰²**\n"+l.map(e=>"â€¢ "+e).join("\n")+"\n\n":""}\n${c.length>0?"ðŸ’¡ **å…·ä½“ä¾‹**\n"+c.map(e=>"â€¢ "+e).join("\n")+"\n\n":""}\n${n?.proactive_use?"ðŸš€ **ã“ã®OSã‚’æ”»ã‚ã«ä½¿ã†ã¨ï¼Ÿ**\n"+n.proactive_use+"\n\n":""}\n${n?.defensive_use?"ðŸ›¡ï¸ **ã“ã®OSãŒå®ˆã‚Šã«å…¥ã‚‹ã¨ï¼Ÿ**\n"+n.defensive_use+"\n\n":""}\n${n?.debug_pattern||n?.debug_method?"ðŸ”§ **æš´èµ°æ™‚ã®ãƒ‡ãƒãƒƒã‚°æ–¹æ³•**\n"+(n.debug_pattern?"âš ï¸ ç—‡çŠ¶: "+n.debug_pattern+"\n":"")+(n.debug_method?"ðŸ’Š å¯¾å‡¦æ³•: "+n.debug_method+"\n":"")+"\n":""}\n${n?.quests&&n.quests.length>0?"ðŸŽ¯ **ä»Šé€±ã®ã‚¯ã‚¨ã‚¹ãƒˆ**\n"+n.quests.map((e,n)=>n+1+". "+e).join("\n")+"\n":""}\n`.trim()}function getElementRelationship(e,n,t){if(!e||!n)return"";const i=t.find(t=>t.source_element===e&&t.target_element===n);return i?i.relationship_type:""}function getPersonalizedInsight(e,n,t,i,r,s=null){const getElement=e=>{if(!e)return"";const n=i.find(n=>n.trigram_id===e.upper_trigram_id);return n?n.element:""},o=getElement(e),a=getElement(n),l=getElement(t),c=getElementRelationship(o,a,r),u=getElementRelationship(o,l,r),m=getElementRelationship(a,l,r),getHexagramName=e=>e?.name_jp||e?.name||"ä¸æ˜ŽãªOS",g=getHexagramName(e),p=getHexagramName(n),d=getHexagramName(t);let h="";if(h+="ðŸ§  **ã‚ãªãŸã®äººæ ¼æ§‹é€ ã®å…¨ä½“åƒ**\n",h+=`ã‚ãªãŸã¯ã€Œ${g}ã€ã‚’æ ¸ã¨ã—ã¦ã€ã€Œ${p}ã€ã§ä¸–ç•Œã¨é–¢ã‚ã‚Šã€ã€Œ${d}ã€ã§è‡ªåˆ†ã‚’å®ˆã‚‹å¤šå±¤æ§‹é€ ã‚’æŒã£ã¦ã„ã¾ã™ã€‚\n\n`,h+="âš¡ **ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æµã‚Œã¨ç›¸äº’ä½œç”¨**\n","ç›¸ç”Ÿ"===c){const e=r.find(e=>e.source_element===o&&e.target_element===a);e&&(h+=e.metaphor_text.replace("{source}",`ã‚ãªãŸã®æ ¸ã¨ãªã‚‹ã€Œ${g}ã€`).replace("{target}",`è¡¨é¢çš„ãªã€Œ${p}ã€`)+"\n"),h+="ã“ã‚Œã¯éžå¸¸ã«ç†æƒ³çš„ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æµã‚Œã§ã™ã€‚ã‚ãªãŸã®æœ¬è³ªãŒè‡ªç„¶ã«å¤–é¢ã«ç¾ã‚Œã€å‘¨å›²ã«è‰¯ã„å½±éŸ¿ã‚’ä¸Žãˆã¾ã™ã€‚\n\n"}else if("ç›¸å‰‹"===c){const e=r.find(e=>e.source_element===o&&e.target_element===a);e&&(h+=e.metaphor_text.replace("{source}",`ã‚ãªãŸã®æ ¸ã¨ãªã‚‹ã€Œ${g}ã€`).replace("{target}",`è¡¨é¢çš„ãªã€Œ${p}ã€`)+"\n"),h+="ã“ã®é–¢ä¿‚æ€§ã¯ã€å†…é¢ã¨å¤–é¢ã®é–“ã§è‘›è—¤ã‚’ç”Ÿã¿å‡ºã—ã‚„ã™ã„ã§ã™ãŒã€åŒæ™‚ã«ç‹¬ç‰¹ã®é­…åŠ›ã¨æˆé•·ã®æ©Ÿä¼šã‚’ã‚‚ãŸã‚‰ã—ã¾ã™ã€‚\n\n"}"ç›¸ç”Ÿ"===u?h+=`ã¾ãŸã€ã‚ãªãŸã®ã€Œ${g}ã€ã¨ã€Œ${d}ã€ã®çµ„ã¿åˆã‚ã›ã¯ã€å†…é¢ã®å®‰å®šã‚„å›žå¾©åŠ›ã‚’é«˜ã‚ã‚‹å¥½å¾ªç’°ã‚’ç”Ÿã¿å‡ºã—ã¾ã™ã€‚\n`:"ç›¸å‰‹"===u&&(h+=`ä¸€æ–¹ã§ã€ã€Œ${g}ã€ã¨ã€Œ${d}ã€ã®é–“ã«ã¯ã€ç„¡æ„è­˜ä¸‹ã§ã®è‘›è—¤ãŒç”Ÿã˜ã‚„ã™ã„å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®é•ã„ã‚’å—ã‘å…¥ã‚Œã€ä¸¡æ–¹ã®å´é¢ã‚’æ´»ã‹ã™å·¥å¤«ãŒå¤§åˆ‡ã§ã™ã€‚\n`),"ç›¸ç”Ÿ"===m?h+=`ã•ã‚‰ã«ã€ã€Œ${p}ã€ã¨ã€Œ${d}ã€ã®çµ„ã¿åˆã‚ã›ã‚‚ã€å…¬ç§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã¤ä¸Šã§æœ‰åŠ¹ã«åƒãã¾ã™ã€‚\n\n`:"ç›¸å‰‹"===m&&(h+=`ã€Œ${p}ã€ã¨ã€Œ${d}ã€ã®é–“ã«ã¯å¾®å¦™ãªç·Šå¼µé–¢ä¿‚ãŒã‚ã‚Šã€è¡¨ã®é¡”ã¨å†…é¢ã®æ•´åˆæ€§ã‚’ä¿ã¤ã“ã¨ãŒé‡è¦ã«ãªã‚Šã¾ã™ã€‚\n\n`),h+="ðŸŽ¯ **äººæ ¼ã®ä¸€è²«æ€§ã¨æˆé•·ã®ãƒ’ãƒ³ãƒˆ**\n";let $=0;return"ç›¸ç”Ÿ"===c&&($+=1),"ç›¸ç”Ÿ"===u&&($+=1),"ç›¸ç”Ÿ"===m&&($+=1),h+=3===$?"ã‚ãªãŸã®3ã¤ã®OSã¯éžå¸¸ã«èª¿å’Œã®ã¨ã‚ŒãŸé–¢ä¿‚ã«ã‚ã‚Šã€ä¸€è²«æ€§ã®é«˜ã„äººæ ¼ã‚’å½¢æˆã—ã¦ã„ã¾ã™ã€‚ã“ã®å®‰å®šæ„Ÿã‚’æ´»ã‹ã—ã¦ã€ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚\n":2===$?"ã‚ãªãŸã®äººæ ¼ã¯å…¨ä½“çš„ã«å®‰å®šã—ã¦ã„ã¾ã™ãŒã€ä¸€éƒ¨ã«æˆé•·ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®å¤šé¢æ€§ã“ããŒã€ã‚ãªãŸã®ç‹¬ç‰¹ã®é­…åŠ›ã¨ãªã£ã¦ã„ã¾ã™ã€‚\n":1===$?"ã‚ãªãŸã®äººæ ¼ã¯è¤‡é›‘ã§å¤šé¢çš„ã§ã™ã€‚æ™‚ã«å†…é¢çš„ãªè‘›è—¤ã‚’æ„Ÿã˜ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãã‚ŒãŒã‚ãªãŸã®æ·±ã¿ã¨å‰µé€ æ€§ã®æºã¨ãªã£ã¦ã„ã¾ã™ã€‚\n":"ã‚ãªãŸã®äººæ ¼ã¯éžå¸¸ã«è¤‡é›‘ã§ã€å†…é¢ã«å¼·ã„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ç§˜ã‚ã¦ã„ã¾ã™ã€‚ã“ã®è¤‡é›‘ã•ã‚’ç†è§£ã—ã€å—ã‘å…¥ã‚Œã‚‹ã“ã¨ã§ã€å¤§ããªå¯èƒ½æ€§ãŒé–‹èŠ±ã—ã¾ã™ã€‚\n",h.trim()}function getPersonalizedActionPlans(e,n,t,i,r){let s="";const o=i?.[e]?.[n];o&&o.length>0&&(s+="ðŸŽ¯ **ã‚ãªãŸã®çµ„ã¿åˆã‚ã›å°‚ç”¨æŽ¨å¥¨äº‹é …**\n",s+=o.slice(0,3).map((e,n)=>`${n+1}. ${e}`).join("\n"),s+="\n\n");const a=[];return[e,n,t].forEach(e=>{const n=r?.[e];n?.quests&&n.quests.length>0&&a.push(...n.quests)}),a.length>0&&(s+="ðŸŒŸ **ä»Šæœˆã®ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒ»ã‚¯ã‚¨ã‚¹ãƒˆ**\n",s+="ä»¥ä¸‹ã‹ã‚‰èˆˆå‘³ã®ã‚ã‚‹ã‚‚ã®ã‚’é¸ã‚“ã§å–ã‚Šçµ„ã‚“ã§ã¿ã¦ãã ã•ã„ï¼š\n\n",s+=a.slice(0,5).map((e,n)=>`${n+1}. ${e}`).join("\n"),s+="\n\n"),s+="ðŸ’¡ **åŸºæœ¬çš„ãªå¿ƒæ§‹ãˆ**\n",s+="â€¢ è‡ªåˆ†ã®3ã¤ã®OSã®ç‰¹æ€§ã‚’ç†è§£ã—ã€ãã‚Œãžã‚Œã®å¼·ã¿ã‚’æ´»ã‹ã™\n",s+="â€¢ å†…é¢ã¨å¤–é¢ã®ãƒãƒ©ãƒ³ã‚¹ã‚’æ„è­˜ã—ã€ç„¡ç†ã‚’ã—ã™ãŽãªã„\n",s+="â€¢ äº”è¡Œã®ç›¸æ€§ã‚’ç†è§£ã—ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æµã‚Œã‚’æ„è­˜ã™ã‚‹\n",s+="â€¢ å›°ã£ãŸæ™‚ã¯ã€è‡ªåˆ†ã®ã€Žã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰OSã€ã‚’æ´»ç”¨ã™ã‚‹\n",s.trim()}function calculateConsistencyScore(e,n,t,i,r){const getElement=e=>{if(!e)return"";const n=i.find(n=>n.trigram_id===e.upper_trigram_id);return n?n.element:""},s=getElement(e),o=getElement(n),a=getElement(t),l=getElementRelationship(s,o,r),c=getElementRelationship(s,a,r),u=getElementRelationship(o,a,r);let m=50;return"ç›¸ç”Ÿ"===l?m+=20:"ç›¸å‰‹"===l&&(m-=5),"ç›¸ç”Ÿ"===c?m+=15:"ç›¸å‰‹"===c&&(m-=5),"ç›¸ç”Ÿ"===u?m+=15:"ç›¸å‰‹"===u&&(m-=5),Math.max(0,Math.min(100,m))}window.getOSDetailText=getOSDetailText,window.getElementRelationship=getElementRelationship,window.getPersonalizedInsight=getPersonalizedInsight,window.getPersonalizedActionPlans=getPersonalizedActionPlans,window.calculateConsistencyScore=calculateConsistencyScore;