function getOSDetailText(e,n){if(!e)return"";const t=e.name_jp||e.name||"名称不明",i=e.catchphrase||"",r=e.description||"",s=(e.keywords,n?.keyword_short||""),o=n?.archetype_icon||"",a=n?.summary||"",l=n?.strategic_roles||[],c=n?.micro_examples||[];return`\n【${t}】${o?" "+o:""}\n${i?"「"+i+"」\n":""}\n${s?"📍 *"+s+"*\n":""}\n\n${r?r+"\n\n":""}\n${a?"🎯 **人格の核心**\n"+a+"\n\n":""}\n${l.length>0?"🔧 **戦略的役割**\n"+l.map(e=>"• "+e).join("\n")+"\n\n":""}\n${c.length>0?"💡 **具体例**\n"+c.map(e=>"• "+e).join("\n")+"\n\n":""}\n${n?.proactive_use?"🚀 **このOSを攻めに使うと？**\n"+n.proactive_use+"\n\n":""}\n${n?.defensive_use?"🛡️ **このOSが守りに入ると？**\n"+n.defensive_use+"\n\n":""}\n${n?.debug_pattern||n?.debug_method?"🔧 **暴走時のデバッグ方法**\n"+(n.debug_pattern?"⚠️ 症状: "+n.debug_pattern+"\n":"")+(n.debug_method?"💊 対処法: "+n.debug_method+"\n":"")+"\n":""}\n${n?.quests&&n.quests.length>0?"🎯 **今週のクエスト**\n"+n.quests.map((e,n)=>n+1+". "+e).join("\n")+"\n":""}\n`.trim()}function getElementRelationship(e,n,t){if(!e||!n)return"";const i=t.find(t=>t.source_element===e&&t.target_element===n);return i?i.relationship_type:""}function getPersonalizedInsight(e,n,t,i,r,s=null){const getElement=e=>{if(!e)return"";const n=i.find(n=>n.trigram_id===e.upper_trigram_id);return n?n.element:""},o=getElement(e),a=getElement(n),l=getElement(t),c=getElementRelationship(o,a,r),u=getElementRelationship(o,l,r),m=getElementRelationship(a,l,r),getHexagramName=e=>e?.name_jp||e?.name||"不明なOS",g=getHexagramName(e),p=getHexagramName(n),d=getHexagramName(t);let h="";if(h+="🧠 **あなたの人格構造の全体像**\n",h+=`あなたは「${g}」を核として、「${p}」で世界と関わり、「${d}」で自分を守る多層構造を持っています。\n\n`,h+="⚡ **エネルギーの流れと相互作用**\n","相生"===c){const e=r.find(e=>e.source_element===o&&e.target_element===a);e&&(h+=e.metaphor_text.replace("{source}",`あなたの核となる「${g}」`).replace("{target}",`表面的な「${p}」`)+"\n"),h+="これは非常に理想的なエネルギーの流れです。あなたの本質が自然に外面に現れ、周囲に良い影響を与えます。\n\n"}else if("相剋"===c){const e=r.find(e=>e.source_element===o&&e.target_element===a);e&&(h+=e.metaphor_text.replace("{source}",`あなたの核となる「${g}」`).replace("{target}",`表面的な「${p}」`)+"\n"),h+="この関係性は、内面と外面の間で葛藤を生み出しやすいですが、同時に独特の魅力と成長の機会をもたらします。\n\n"}"相生"===u?h+=`また、あなたの「${g}」と「${d}」の組み合わせは、内面の安定や回復力を高める好循環を生み出します。\n`:"相剋"===u&&(h+=`一方で、「${g}」と「${d}」の間には、無意識下での葛藤が生じやすい傾向があります。この違いを受け入れ、両方の側面を活かす工夫が大切です。\n`),"相生"===m?h+=`さらに、「${p}」と「${d}」の組み合わせも、公私のバランスを保つ上で有効に働きます。\n\n`:"相剋"===m&&(h+=`「${p}」と「${d}」の間には微妙な緊張関係があり、表の顔と内面の整合性を保つことが重要になります。\n\n`),h+="🎯 **人格の一貫性と成長のヒント**\n";let $=0;return"相生"===c&&($+=1),"相生"===u&&($+=1),"相生"===m&&($+=1),h+=3===$?"あなたの3つのOSは非常に調和のとれた関係にあり、一貫性の高い人格を形成しています。この安定感を活かして、リーダーシップを発揮できるでしょう。\n":2===$?"あなたの人格は全体的に安定していますが、一部に成長の余地があります。この多面性こそが、あなたの独特の魅力となっています。\n":1===$?"あなたの人格は複雑で多面的です。時に内面的な葛藤を感じるかもしれませんが、それがあなたの深みと創造性の源となっています。\n":"あなたの人格は非常に複雑で、内面に強いエネルギーを秘めています。この複雑さを理解し、受け入れることで、大きな可能性が開花します。\n",h.trim()}function getPersonalizedActionPlans(e,n,t,i,r){let s="";const o=i?.[e]?.[n];o&&o.length>0&&(s+="🎯 **あなたの組み合わせ専用推奨事項**\n",s+=o.slice(0,3).map((e,n)=>`${n+1}. ${e}`).join("\n"),s+="\n\n");const a=[];return[e,n,t].forEach(e=>{const n=r?.[e];n?.quests&&n.quests.length>0&&a.push(...n.quests)}),a.length>0&&(s+="🌟 **今月のパーソナル・クエスト**\n",s+="以下から興味のあるものを選んで取り組んでみてください：\n\n",s+=a.slice(0,5).map((e,n)=>`${n+1}. ${e}`).join("\n"),s+="\n\n"),s+="💡 **基本的な心構え**\n",s+="• 自分の3つのOSの特性を理解し、それぞれの強みを活かす\n",s+="• 内面と外面のバランスを意識し、無理をしすぎない\n",s+="• 五行の相性を理解し、エネルギーの流れを意識する\n",s+="• 困った時は、自分の『セーフモードOS』を活用する\n",s.trim()}function calculateConsistencyScore(e,n,t,i,r){const getElement=e=>{if(!e)return"";const n=i.find(n=>n.trigram_id===e.upper_trigram_id);return n?n.element:""},s=getElement(e),o=getElement(n),a=getElement(t),l=getElementRelationship(s,o,r),c=getElementRelationship(s,a,r),u=getElementRelationship(o,a,r);let m=50;return"相生"===l?m+=20:"相剋"===l&&(m-=5),"相生"===c?m+=15:"相剋"===c&&(m-=5),"相生"===u?m+=15:"相剋"===u&&(m-=5),Math.max(0,Math.min(100,m))}window.getOSDetailText=getOSDetailText,window.getElementRelationship=getElementRelationship,window.getPersonalizedInsight=getPersonalizedInsight,window.getPersonalizedActionPlans=getPersonalizedActionPlans,window.calculateConsistencyScore=calculateConsistencyScore;