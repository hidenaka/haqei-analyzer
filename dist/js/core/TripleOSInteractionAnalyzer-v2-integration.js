class SeededRandom{constructor(e=Date.now()){this.seed=e}next(){return this.seed=(1664525*this.seed+1013904223)%2147483647,this.seed/2147483647}}!function(){"use strict";if(void 0!==window.TripleOSInteractionAnalyzer){const e=window.TripleOSInteractionAnalyzer;e.prototype.calculateHexagramProbabilitiesV2=function(e,a="engine",n=null){console.log(`🔄 Calculating hexagram probabilities v2 for ${a} OS`);n&&new SeededRandom(n);const t=["乾","兌","離","震","巽","坎","艮","坤"],i=t.map(a=>e[a]||0),o={engine:1.2,interface:1.5,safemode:1.3}[a],r=Math.max(...i),l=i.map(e=>(e-r)/o).map(e=>Math.exp(e)),s=l.reduce((e,a)=>e+a,0),c=l.map(e=>e/s),g=c.reduce((e,a)=>e+a*a,0),h=1/8,d=(g-h)/.875,p={engine:{k:1.2,alphaMin:.12,alphaMax:.2},interface:{k:1,alphaMin:.1,alphaMax:.18},safemode:{k:1.1,alphaMin:.12,alphaMax:.22}}[a],u=p.alphaMin+(p.alphaMax-p.alphaMin)*p.k*d,m=Math.max(p.alphaMin,Math.min(p.alphaMax,u));console.log(`📊 ${a} OS - H=${g.toFixed(3)}, H8_norm=${d.toFixed(3)}, alpha=${m.toFixed(3)}`);const x={};let b=0;t.forEach((e,a)=>{t.forEach((e,n)=>{const t=8*a+n+1;if(a===n)x[t]=m/8;else{const e=c[a]*c[n],i=(1-m)/(1-c.reduce((e,a)=>e+a*a,0));x[t]=e*i}b+=x[t]})}),Object.keys(x).forEach(e=>{x[e]/=b});const f=[1,30,29,51,57,52,58,2].reduce((e,a)=>e+(x[a]||0),0);return console.log(`✅ ${a} OS - Actual pure hexagram rate: ${(100*f).toFixed(1)}%`),x},e.prototype.selectHexagramV2=function(e,a=null){const n=(a?new SeededRandom(a):{next:()=>Math.random()}).next();let t=0;for(const[i,o]of Object.entries(e))if(t+=o,n<t)return parseInt(i);return 1};const a=e.prototype.analyze;e.prototype.analyze=function(e,n,t,i={}){return console.log("🎯 Using v2 diagnostic logic with pure hexagram control"),!1!==i.useV2&&(e.baguaEnergies&&(e.hexagramProbabilities=this.calculateHexagramProbabilitiesV2(e.baguaEnergies,"engine",i.seed)),n.baguaEnergies&&(n.hexagramProbabilities=this.calculateHexagramProbabilitiesV2(n.baguaEnergies,"interface",i.seed)),t.baguaEnergies&&(t.hexagramProbabilities=this.calculateHexagramProbabilitiesV2(t.baguaEnergies,"safemode",i.seed))),a.call(this,e,n,t)},console.log("✅ TripleOSInteractionAnalyzer v2 integration complete"),console.log("📊 Pure hexagram rate target: 12-18%"),console.log("🔧 Using Herfindahl index-based linear mapping")}}();