console.log("â˜¯ï¸ IChingGuidanceEngine Loading..."),function(){"use strict";class IChingGuidanceEngine{constructor(){this.name="IChingGuidanceEngine",this.version="2.0.0",this.h384db=null,this.currentHexagram=null,this.currentYao=null,this.choiceHistory=[],this.isInitialized=!1}async initialize(){console.log("ğŸ”„ IChingGuidanceEngine initializing...");try{return await this.connectDatabase(),this.initializeChangePatterns(),this.initializeGuidanceSystem(),this.isInitialized=!0,console.log("âœ… IChingGuidanceEngine initialized successfully"),!0}catch(e){return console.error("âŒ IChingGuidanceEngine initialization failed:",e),!1}}async connectDatabase(){if(window.h384db&&window.h384db.isLoaded)this.h384db=window.h384db,console.log("âœ… Connected to H384 Database");else{console.warn("âš ï¸ H384db not ready, using getDatabaseData()");const e=window.getDatabaseData?window.getDatabaseData():[];e.length>0&&(this.h384db={getDatabaseData:()=>e})}}initializeChangePatterns(){this.changePatterns={yangToYin:{name:"é™½è»¢é™°",description:"ç©æ¥µçš„ãªçŠ¶æ…‹ã‹ã‚‰å—å®¹çš„ãªçŠ¶æ…‹ã¸ã®å¤‰åŒ–",guidance:"åŠ›ã‚’æŠœã„ã¦ã€è‡ªç„¶ã®æµã‚Œã«èº«ã‚’ä»»ã›ã‚‹æ™‚æœŸ"},yinToYang:{name:"é™°è»¢é™½",description:"å—å‹•çš„ãªçŠ¶æ…‹ã‹ã‚‰èƒ½å‹•çš„ãªçŠ¶æ…‹ã¸ã®å¤‰åŒ–",guidance:"è¡Œå‹•ã‚’èµ·ã“ã—ã€ä¸»ä½“çš„ã«å‹•ãå‡ºã™æ™‚æœŸ"},oldYang:{name:"è€é™½",description:"é™½ãŒæ¥µã¾ã‚Šã€å¤‰åŒ–ã®æ™‚ã‚’è¿ãˆã‚‹",guidance:"æˆåŠŸã®é ‚ç‚¹ã«ã‚ã‚‹ãŒã€è¬™è™šã•ã‚’å¿˜ã‚Œãšã«"},oldYin:{name:"è€é™°",description:"é™°ãŒæ¥µã¾ã‚Šã€è»¢æ›ç‚¹ã‚’è¿ãˆã‚‹",guidance:"æœ€ã‚‚æš—ã„æ™‚æœŸã‚’éãã€å…‰ãŒè¦‹ãˆå§‹ã‚ã‚‹"}}}initializeGuidanceSystem(){this.guidancePatterns={stage1:{conservative:{name:"ä¿å®ˆçš„é¸æŠ",keywords:["å®‰å®š","ç¶™ç¶š","å¿è€"],description:"ç¾çŠ¶ã‚’ç¶­æŒã—ã€å†…ãªã‚‹åŠ›ã‚’è“„ãˆã‚‹",iChingPrinciple:"æ½œé¾å‹¿ç”¨ - åŠ›ã‚’ç§˜ã‚ã¦æ™‚ã‚’å¾…ã¤"},progressive:{name:"é€²æ­©çš„é¸æŠ",keywords:["å¤‰é©","æŒ‘æˆ¦","é©æ–°"],description:"æ–°ã—ã„å¯èƒ½æ€§ã«å‘ã‹ã£ã¦ä¸€æ­©è¸ã¿å‡ºã™",iChingPrinciple:"è¦‹é¾åœ¨ç”° - æ‰èƒ½ã‚’ä¸–ã«ç¾ã™æ™‚"}},stage2:{collaborative:{name:"å”èª¿çš„é¸æŠ",keywords:["å”åŠ›","èª¿å’Œ","å…±ç”Ÿ"],description:"ä»–è€…ã¨ã®å”åŠ›é–¢ä¿‚ã‚’é‡è¦–ã™ã‚‹",iChingPrinciple:"ç¾¤é¾ç„¡é¦– - çš†ãŒå”åŠ›ã—ã¦é€²ã‚€"},independent:{name:"ç‹¬ç«‹çš„é¸æŠ",keywords:["è‡ªç«‹","ç‹¬å‰µ","å€‹æ€§"],description:"è‡ªåˆ†ã®é“ã‚’ç‹¬è‡ªã«åˆ‡ã‚Šé–‹ã",iChingPrinciple:"é£›é¾åœ¨å¤© - ç‹¬è‡ªã®é“ã‚’è¡Œã"}},stage3:{cautious:{name:"æ…é‡ãªé¸æŠ",keywords:["ç†Ÿæ…®","è¨ˆç”»","æº–å‚™"],description:"ååˆ†ãªæº–å‚™ã¨è¨ˆç”»ã‚’é‡è¦–",iChingPrinciple:"å›å­çµ‚æ—¥ä¹¾ä¹¾ - æ…é‡ã«åŠªåŠ›ã‚’ç¶šã‘ã‚‹"},decisive:{name:"æ±ºæ–­çš„é¸æŠ",keywords:["å³æ–­","ç›´æ„Ÿ","å‹‡æ°—"],description:"ç›´æ„Ÿã‚’ä¿¡ã˜ã¦è¿…é€Ÿã«è¡Œå‹•",iChingPrinciple:"æˆ–èºåœ¨æ·µ - æ©Ÿã‚’è¦‹ã¦èºå‹•ã™ã‚‹"}}}}calculateSituationHexagram(e){if(!this.h384db)return console.error("âŒ Database not connected"),null;const i=this.h384db.getDatabaseData();if(!i||0===i.length)return console.error("âŒ No database data available"),null;const t=this.analyzeText(e);let n=null,a=0;if(i.forEach(e=>{const i=this.calculateMatchScore(t,e);i>a&&(a=i,n=e)}),n){const e=n["å¦ç•ªå·"]||1,i=n["å¦å"]||"ä¹¾ç‚ºå¤©",t=n["çˆ»"]||"åˆä¹",a=n["é€šã—ç•ªå·"]||1;let o;if(this.currentHexagram=e,this.currentYao=t,console.log(`ğŸ“ çŠ¶æ³å¦: ${i} ${t}`),1===e)o=a;else if(2===e)o=a-7;else{o=a-(14+6*(e-3))+1}return(o<1||o>7)&&(o=1),{hexagramNumber:e,hexagramName:i,yaoPosition:o>6?6:o,yaoName:t,serialNumber:a,theme:n["ãƒ†ãƒ¼ãƒ"]||"åˆæœŸçŠ¶æ…‹",description:n["èª¬æ˜"]||"åˆæœŸã®çŠ¶æ…‹ã§ã™ã€‚",keywords:n["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||["é–‹å§‹"],modernInterpretation:n["ç¾ä»£è§£é‡ˆã®è¦ç´„"]||"æ–°ã—ã„å§‹ã¾ã‚Šã€‚","å¦å":i,"çˆ»":t,"ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰":n["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||["é–‹å§‹"],"ç¾ä»£è§£é‡ˆã®è¦ç´„":n["ç¾ä»£è§£é‡ˆã®è¦ç´„"]||"æ–°ã—ã„å§‹ã¾ã‚Šã€‚","S1_åŸºæœ¬ã‚¹ã‚³ã‚¢":n["S1_åŸºæœ¬ã‚¹ã‚³ã‚¢"]||50,"S2_ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«":n["S2_ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«"]||50,"S3_å®‰å®šæ€§ã‚¹ã‚³ã‚¢":n["S3_å®‰å®šæ€§ã‚¹ã‚³ã‚¢"]||50,"S4_ãƒªã‚¹ã‚¯":n["S4_ãƒªã‚¹ã‚¯"]||-35,"S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹":n["S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹"]||"ä¸­ç«‹","S6_å¤‰å‹•æ€§ã‚¹ã‚³ã‚¢":n["S6_å¤‰å‹•æ€§ã‚¹ã‚³ã‚¢"]||50,"S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢":n["S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢"]||50,rawData:n}}return console.error("âŒ No matching hexagram found for input"),null}analyzeText(e){const i={length:e.length,emotionScore:0,urgencyScore:0,complexityScore:0,keywords:[]};["å¸Œæœ›","æˆåŠŸ","è‰¯ã„","æ¥½ã—ã„","å¬‰ã—ã„","å‰å‘ã"].forEach(t=>{e.includes(t)&&(i.emotionScore+=10)}),["ä¸å®‰","å¿ƒé…","å›°é›£","å•é¡Œ","å¤±æ•—","æ‚©ã¿"].forEach(t=>{e.includes(t)&&(i.emotionScore-=10)});return["æ€¥ã","è‡³æ€¥","ç·Šæ€¥","ã™ã","ä»Šã™ã","ç· åˆ‡"].forEach(t=>{e.includes(t)&&(i.urgencyScore+=15)}),i.complexityScore=Math.min(100,e.length/5),i}calculateMatchScore(e,i){let t=0;return t+=.3*i["S1_åŸºæœ¬ã‚¹ã‚³ã‚¢"],(e.emotionScore>0&&"èƒ½å‹•"===i["S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹"]||e.emotionScore<0&&"å—å‹•"===i["S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹"])&&(t+=20),e.urgencyScore>30&&i["S6_å¤‰å‹•æ€§ã‚¹ã‚³ã‚¢"]>50&&(t+=15),e.complexityScore>50&&i["S3_å®‰å®šæ€§ã‚¹ã‚³ã‚¢"]>50&&(t+=10),t+=.1*i["S4_ãƒªã‚¹ã‚¯"],t+=.2*i["S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢"],t}generateThreeStageProcess(e){console.log("ğŸ¯ generateThreeStageProcess called with hexagram:",e),this.guidancePatterns||(console.log("âš ï¸ guidancePatterns not initialized, emergency initialization..."),this.initializeGuidanceSystem());const i={currentSituation:e,progressTheme:e?e.å¦å:"ç¾çŠ¶åˆ†æ",changeTheme:e?`${e.å¦å}ã‹ã‚‰ã®å¤‰åŒ–`:"å¤‰åŒ–ã®é“",stages:[]},t={stageNumber:1,title:"ç¬¬ä¸€æ®µéšï¼šåŸºæœ¬æ–¹é‡ã®é¸æŠ",description:"ç¾åœ¨ã®çŠ¶æ³ã«å¯¾ã™ã‚‹åŸºæœ¬çš„ãªæ…‹åº¦ã‚’æ±ºã‚ã‚‹",choices:[],iChingGuidance:this.getStageGuidance(e,1)},n=this.guidancePatterns?.stage1?.conservative||{name:"ä¿å®ˆçš„é¸æŠ",keywords:["å®‰å®š","ç¶™ç¶š","å¿è€"],description:"ç¾çŠ¶ã‚’ç¶­æŒã—ã€å†…ãªã‚‹åŠ›ã‚’è“„ãˆã‚‹",iChingPrinciple:"æ½œé¾å‹¿ç”¨ - åŠ›ã‚’ç§˜ã‚ã¦æ™‚ã‚’å¾…ã¤"};t.choices.push({id:"conservative",...n,compatibility:this.calculateChoiceCompatibility(e,"conservative"),outcome:this.predictOutcome(e,"conservative",1)});const a=this.guidancePatterns?.stage1?.progressive||{name:"é€²æ­©çš„é¸æŠ",keywords:["å‰é€²","é©æ–°","æ”¹é©"],description:"æ–°ã—ã„é“ã‚’åˆ‡ã‚Šé–‹ã",iChingPrinciple:"è¦‹é¾åœ¨ç”° - æ‰èƒ½ã‚’é–‹èŠ±ã•ã›ã‚‹æ™‚"};t.choices.push({id:"progressive",...a,compatibility:this.calculateChoiceCompatibility(e,"progressive"),outcome:this.predictOutcome(e,"progressive",1)}),i.stages.push(t);const o={stageNumber:2,title:"ç¬¬äºŒæ®µéšï¼šå®Ÿè¡Œæ–¹æ³•ã®é¸æŠ",description:"é¸ã‚“ã æ–¹é‡ã‚’ã©ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚‹ã‹",choices:[],iChingGuidance:this.getStageGuidance(e,2)},c=this.guidancePatterns?.stage2?.collaborative||{name:"å”èª¿çš„é¸æŠ",keywords:["å”åŠ›","èª¿å’Œ","å…±ç”Ÿ"],description:"ä»–è€…ã¨å…±ã«æ­©ã‚€é“",iChingPrinciple:"ç¾¤é¾ç„¡é¦– - çš†ã§åŠ›ã‚’åˆã‚ã›ã‚‹"};o.choices.push({id:"collaborative",...c,compatibility:this.calculateChoiceCompatibility(e,"collaborative"),outcome:this.predictOutcome(e,"collaborative",2)});const s=this.guidancePatterns?.stage2?.independent||{name:"ç‹¬ç«‹çš„é¸æŠ",keywords:["è‡ªç«‹","ç‹¬å‰µ","ä¸»å°"],description:"è‡ªã‚‰ã®åŠ›ã§é“ã‚’åˆ‡ã‚Šé–‹ã",iChingPrinciple:"é£›é¾åœ¨å¤© - é«˜ã„å¿—ã‚’æŒã£ã¦è¡Œå‹•ã™ã‚‹"};o.choices.push({id:"independent",...s,compatibility:this.calculateChoiceCompatibility(e,"independent"),outcome:this.predictOutcome(e,"independent",2)}),i.stages.push(o);const r={stageNumber:3,title:"ç¬¬ä¸‰æ®µéšï¼šã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®é¸æŠ",description:"è¡Œå‹•ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨é€Ÿåº¦ã‚’æ±ºã‚ã‚‹",choices:[],iChingGuidance:this.getStageGuidance(e,3)},l=this.guidancePatterns?.stage3?.cautious||{name:"æ…é‡ãªé¸æŠ",keywords:["æ…é‡","æº–å‚™","è¦³å¯Ÿ"],description:"æ™‚ã‚’è¦‹ã¦ç¢ºå®Ÿã«é€²ã‚€",iChingPrinciple:"æ½œé¾å‹¿ç”¨ - æ™‚æ©Ÿã‚’å¾…ã¤çŸ¥æµ"};r.choices.push({id:"cautious",...l,compatibility:this.calculateChoiceCompatibility(e,"cautious"),outcome:this.predictOutcome(e,"cautious",3)});const d=this.guidancePatterns?.stage3?.decisive||{name:"æ±ºæ–­çš„é¸æŠ",keywords:["æ±ºæ–­","è¿…é€Ÿ","è¡Œå‹•"],description:"æ©Ÿã‚’é€ƒã•ãšç´ æ—©ãè¡Œå‹•",iChingPrinciple:"äº¢é¾æœ‰æ‚” - å‹‡æ°—ã‚ã‚‹æ±ºæ–­"};return r.choices.push({id:"decisive",...d,compatibility:this.calculateChoiceCompatibility(e,"decisive"),outcome:this.predictOutcome(e,"decisive",3)}),i.stages.push(r),console.log("âœ… ThreeStageProcess generated successfully:",i),i}getStageGuidance(e,i){const t={principle:"",advice:"",warning:""},n=e["S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹"],a=e["S3_å®‰å®šæ€§ã‚¹ã‚³ã‚¢"],o=Math.abs(e["S4_ãƒªã‚¹ã‚¯"]);switch(i){case 1:"èƒ½å‹•"===n?(t.principle="é™½ã®æ°—ãŒå¼·ã„ - ç©æ¥µçš„ãªè¡Œå‹•ãŒå‰",t.advice="ä»Šã¯è¡Œå‹•ã‚’èµ·ã“ã™å¥½æ©Ÿã€‚è‡ªä¿¡ã‚’æŒã£ã¦å‰é€²ã›ã‚ˆã€‚"):(t.principle="é™°ã®æ°—ãŒå¼·ã„ - å—å®¹ã¨è¦³å¯ŸãŒå‰",t.advice="ä»Šã¯é™è¦³ã®æ™‚ã€‚çŠ¶æ³ã‚’ã‚ˆãè¦‹æ¥µã‚ã¦ã‹ã‚‰å‹•ãã¹ã—ã€‚"),t.warning=o>50?"å¤§ããªãƒªã‚¹ã‚¯ã‚ã‚Šã€‚æ…é‡ã«ã€‚":"ãƒªã‚¹ã‚¯ã¯ç®¡ç†å¯èƒ½ã€‚";break;case 2:a>60?(t.principle="å®‰å®šã®å¦ - ç€å®Ÿãªé€²æ­©ã‚’",t.advice="åŸºç›¤ã¯å›ºã„ã€‚è¨ˆç”»çš„ã«é€²ã‚ã‚‹ã“ã¨ã§æˆåŠŸã™ã‚‹ã€‚"):(t.principle="å¤‰å‹•ã®å¦ - æŸ”è»Ÿãªå¯¾å¿œã‚’",t.advice="çŠ¶æ³ã¯æµå‹•çš„ã€‚è‡¨æ©Ÿå¿œå¤‰ã«å¯¾å¿œã™ã‚‹ã“ã¨ãŒé‡è¦ã€‚"),t.warning="å›ºåŸ·ã¯é¿ã‘ã€çŠ¶æ³ã«å¿œã˜ã¦èª¿æ•´ã›ã‚ˆã€‚";break;case 3:e["S6_å¤‰å‹•æ€§ã‚¹ã‚³ã‚¢"]>50?(t.principle="å¤‰åŒ–æ¿€ã—ãæ™‚ - æ©Ÿã‚’è¦‹ã¦å‹•ã‘",t.advice="ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒé‡è¦ã€‚å¥½æ©Ÿã‚’é€ƒã•ã¬ã‚ˆã†æº–å‚™ã›ã‚ˆã€‚"):(t.principle="å®‰å®šã®æ™‚ - ç€å®Ÿã«é€²ã‚",t.advice="ç„¦ã‚‹å¿…è¦ãªã—ã€‚è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§é€²ã‚ã°ã‚ˆã„ã€‚"),t.warning="æ™‚æ©Ÿã‚’èª¤ã‚Œã°ã€åŠªåŠ›ã‚‚æ°´æ³¡ã«å¸°ã™ã€‚"}return t}calculateChoiceCompatibility(e,i){let t=50;const n=e["S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹"],a=e["S3_å®‰å®šæ€§ã‚¹ã‚³ã‚¢"],o=e["S2_ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«"];switch(i){case"conservative":"å—å‹•"===n&&(t+=30),a>60&&(t+=20);break;case"progressive":"èƒ½å‹•"===n&&(t+=30),o>60&&(t+=20);break;case"collaborative":e["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"].includes("å”åŠ›")&&(t+=25),t+=.3*a;break;case"independent":e["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"].includes("è‡ªç«‹")&&(t+=25),t+=.3*o;break;case"cautious":Math.abs(e["S4_ãƒªã‚¹ã‚¯"])>50&&(t+=30);break;case"decisive":e["S6_å¤‰å‹•æ€§ã‚¹ã‚³ã‚¢"]>50&&(t+=30)}return Math.min(100,Math.max(0,t))}predictOutcome(e,i,t){const n=.5*e["S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢"]+.5*this.calculateChoiceCompatibility(e,i);let a={probability:Math.round(n),description:"",nextStep:""};return n>70?(a.description="éå¸¸ã«è‰¯ã„é¸æŠã€‚é«˜ã„ç¢ºç‡ã§æœ›ã‚€çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã€‚",a.nextStep="è‡ªä¿¡ã‚’æŒã£ã¦é€²ã‚ã€‚"):n>50?(a.description="é©åˆ‡ãªé¸æŠã€‚åŠªåŠ›æ¬¡ç¬¬ã§è‰¯ã„çµæœãŒæœŸå¾…ã§ãã‚‹ã€‚",a.nextStep="ç€å®Ÿã«å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒé‡è¦ã€‚"):n>30?(a.description="æŒ‘æˆ¦çš„ãªé¸æŠã€‚å›°é›£ã¯ã‚ã‚‹ãŒä¸å¯èƒ½ã§ã¯ãªã„ã€‚",a.nextStep="ååˆ†ãªæº–å‚™ã¨è¦šæ‚ŸãŒå¿…è¦ã€‚"):(a.description="å›°é›£ãªé¸æŠã€‚åˆ¥ã®é“ã‚’æ¤œè¨ã™ã‚‹ã“ã¨ã‚‚è¦–é‡ã«ã€‚",a.nextStep="æ…é‡ã«å†è€ƒã™ã‚‹ã“ã¨ã‚’å‹§ã‚ã‚‹ã€‚"),a}generate8Scenarios(e){const i=[];return[["conservative","collaborative","cautious"],["conservative","collaborative","decisive"],["conservative","independent","cautious"],["conservative","independent","decisive"],["progressive","collaborative","cautious"],["progressive","collaborative","decisive"],["progressive","independent","cautious"],["progressive","independent","decisive"]].forEach((t,n)=>{const a={id:n+1,path:t,title:this.generateScenarioTitle(t),description:this.generateScenarioDescription(t,e.currentSituation),probability:this.calculateScenarioProbability(t,e),characteristics:this.getScenarioCharacteristics(t),iChingReference:this.getScenarioIChingReference(t,e.currentSituation),visualPath:this.createVisualPath(t)};i.push(a)}),i.sort((e,i)=>i.probability-e.probability),i}generateScenarioTitle(e){return{"conservative,collaborative,cautious":"å …å®Ÿãªå”èª¿è·¯ç·š","conservative,collaborative,decisive":"å”èª¿çš„ç¾çŠ¶æ”¹é©","conservative,independent,cautious":"ç‹¬ç«‹çš„ç¾çŠ¶ç¶­æŒ","conservative,independent,decisive":"ç‹¬è‡ªã®ä¿å®ˆé©æ–°","progressive,collaborative,cautious":"æ…é‡ãªå…±åŒé©æ–°","progressive,collaborative,decisive":"è¿…é€Ÿãªå”èª¿å¤‰é©","progressive,independent,cautious":"è¨ˆç”»çš„ç‹¬ç«‹é©æ–°","progressive,independent,decisive":"ç‹¬å‰µçš„å³æ–­é©æ–°"}[e.join(",")]||"æœªå®šç¾©ã®é“"}generateScenarioDescription(e,i){let t="";"conservative"===e[0]?t+="ç¾çŠ¶ã‚’åŸºç›¤ã¨ã—ãªãŒã‚‰ã€":t+="æ–°ã—ã„å¯èƒ½æ€§ã‚’è¿½æ±‚ã—ã€","collaborative"===e[1]?t+="å‘¨å›²ã¨ã®å”åŠ›é–¢ä¿‚ã‚’é‡è¦–ã—ã¦ã€":t+="ç‹¬è‡ªã®é“ã‚’åˆ‡ã‚Šé–‹ããªãŒã‚‰ã€","cautious"===e[2]?t+="æ…é‡ã«è¨ˆç”»ã‚’é€²ã‚ã‚‹é“ã€‚":t+="æ©Ÿã‚’è¦‹ã¦ç´ æ—©ãè¡Œå‹•ã™ã‚‹é“ã€‚";const n=i["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||[];return n.length>0&&(t+=`ç‰¹ã«ã€Œ${n[0]}ã€ã®è¦ç´ ãŒé‡è¦ã¨ãªã‚‹ã€‚`),t}calculateScenarioProbability(e,i){let t=0,n=0;return e.forEach((e,a)=>{const o=i.stages[a].choices.find(i=>i.id===e);o&&o.outcome&&(t+=o.outcome.probability,n++)}),n>0?Math.round(t/n):50}getScenarioCharacteristics(e){const i=[];return e.forEach(e=>{"conservative"===e&&i.push("å®‰å®šé‡è¦–"),"progressive"===e&&i.push("é©æ–°é‡è¦–"),"collaborative"===e&&i.push("å”èª¿æ€§"),"independent"===e&&i.push("ç‹¬ç«‹æ€§"),"cautious"===e&&i.push("æ…é‡ã•"),"decisive"===e&&i.push("æ±ºæ–­åŠ›")}),i}getScenarioIChingReference(e,i){const t={"conservative,collaborative,cautious":"åœ°å±±è¬™ - è¬™è™šã«å”åŠ›ã™ã‚‹","conservative,collaborative,decisive":"åœ°å¤©æ³° - å®‰å®šã®ä¸­ã®æ±ºæ–­","conservative,independent,cautious":"å±±å¤©å¤§ç•œ - å†…ã«åŠ›ã‚’è“„ãˆã‚‹","conservative,independent,decisive":"å¤©å±±é¯ - é€€ã„ã¦æ©Ÿã‚’å¾…ã¤","progressive,collaborative,cautious":"é¢¨å¤©å°ç•œ - å°ã•ãè“„ãˆã¦é€²ã‚€","progressive,collaborative,decisive":"å¤©ç«åŒäºº - å¿—ã‚’åŒã˜ãã™ã‚‹","progressive,independent,cautious":"ç«å¤©å¤§æœ‰ - å¤§ã„ã«ä¿ã¤","progressive,independent,decisive":"ä¹¾ç‚ºå¤© - å¤©ã®é“ã‚’è¡Œã"}[e.join(",")]||i["å¦å"];return{hexagram:t.split(" - ")[0],meaning:t.split(" - ")[1]||i["ç¾ä»£è§£é‡ˆã®è¦ç´„"]}}createVisualPath(e){return{stage1:{choice:e[0],position:"conservative"===e[0]?"left":"right",color:"conservative"===e[0]?"#3B82F6":"#10B981"},stage2:{choice:e[1],position:"collaborative"===e[1]?"left":"right",color:"collaborative"===e[1]?"#F59E0B":"#8B5CF6"},stage3:{choice:e[2],position:"cautious"===e[2]?"left":"right",color:"cautious"===e[2]?"#EF4444":"#06B6D4"}}}recordChoice(e,i){this.choiceHistory.push({stage:e,choice:i,timestamp:(new Date).toISOString()}),"undefined"!=typeof localStorage&&localStorage.setItem("iching_choice_history",JSON.stringify(this.choiceHistory))}getChoiceHistory(){if("undefined"!=typeof localStorage){const e=localStorage.getItem("iching_choice_history");e&&(this.choiceHistory=JSON.parse(e))}return this.choiceHistory}createEmergencyThreeStageProcess(e){console.log("ğŸ†˜ Creating emergency threeStageProcess...");const i=e?.å¦å||"ç¾çŠ¶åˆ†æ";return{currentSituation:e,progressTheme:`${i}ã‹ã‚‰ã®é“ç­‹`,changeTheme:`${i}ã‹ã‚‰ã®å¤‰åŒ–`,stages:[{stageNumber:1,title:"ç¬¬ä¸€æ®µéšï¼šåŸºæœ¬æ–¹é‡ã®é¸æŠ",description:"ç¾åœ¨ã®çŠ¶æ³ã«å¯¾ã™ã‚‹åŸºæœ¬çš„ãªæ…‹åº¦ã‚’æ±ºã‚ã‚‹",choices:[{id:"conservative",name:"ä¿å®ˆçš„é¸æŠ",keywords:["å®‰å®š","ç¶™ç¶š","å¿è€"],description:"ç¾çŠ¶ã‚’ç¶­æŒã—ã€å†…ãªã‚‹åŠ›ã‚’è“„ãˆã‚‹",iChingPrinciple:"æ½œé¾å‹¿ç”¨ - åŠ›ã‚’ç§˜ã‚ã¦æ™‚ã‚’å¾…ã¤",compatibility:75,outcome:{probability:70,description:"ç€å®Ÿãªé€²æ­©ãŒæœŸå¾…ã§ãã‚‹",nextStep:"æ…é‡ã«æº–å‚™ã‚’é€²ã‚ã‚‹"}},{id:"progressive",name:"é€²æ­©çš„é¸æŠ",keywords:["å‰é€²","é©æ–°","æ”¹é©"],description:"æ–°ã—ã„é“ã‚’åˆ‡ã‚Šé–‹ã",iChingPrinciple:"è¦‹é¾åœ¨ç”° - æ‰èƒ½ã‚’é–‹èŠ±ã•ã›ã‚‹æ™‚",compatibility:65,outcome:{probability:60,description:"æ–°ã—ã„å¯èƒ½æ€§ãŒé–‹ã‘ã‚‹",nextStep:"å‹‡æ°—ã‚’æŒã£ã¦å‰é€²ã™ã‚‹"}}],iChingGuidance:{principle:"æ™‚æ©Ÿã‚’è¦‹æ¥µã‚ã‚‹",advice:"ç¾çŠ¶ã‚’ã‚ˆãè¦³å¯Ÿã—ã¦ã‹ã‚‰è¡Œå‹•ã›ã‚ˆ",warning:"ç„¦ã‚Šã¯ç¦ç‰©ã€‚æº–å‚™ã‚’æ€ ã‚‰ãšã€‚"}},{stageNumber:2,title:"ç¬¬äºŒæ®µéšï¼šå®Ÿè¡Œæ–¹æ³•ã®é¸æŠ",description:"é¸ã‚“ã æ–¹é‡ã‚’ã©ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚‹ã‹",choices:[{id:"collaborative",name:"å”èª¿çš„é¸æŠ",keywords:["å”åŠ›","èª¿å’Œ","å…±ç”Ÿ"],description:"ä»–è€…ã¨å…±ã«æ­©ã‚€é“",iChingPrinciple:"ç¾¤é¾ç„¡é¦– - çš†ã§åŠ›ã‚’åˆã‚ã›ã‚‹",compatibility:70,outcome:{probability:75,description:"å”åŠ›ã«ã‚ˆã‚Šå¤§ããªæˆæœãŒå¾—ã‚‰ã‚Œã‚‹",nextStep:"ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’é‡è¦–ã™ã‚‹"}},{id:"independent",name:"ç‹¬ç«‹çš„é¸æŠ",keywords:["è‡ªç«‹","ç‹¬å‰µ","ä¸»å°"],description:"è‡ªã‚‰ã®åŠ›ã§é“ã‚’åˆ‡ã‚Šé–‹ã",iChingPrinciple:"é£›é¾åœ¨å¤© - é«˜ã„å¿—ã‚’æŒã£ã¦è¡Œå‹•ã™ã‚‹",compatibility:60,outcome:{probability:65,description:"ç‹¬è‡ªã®é“ãŒé–‹ã‘ã‚‹",nextStep:"è‡ªä¿¡ã‚’æŒã£ã¦é€²ã‚€"}}],iChingGuidance:{principle:"èª¿å’Œã¨ç‹¬ç«‹ã®ãƒãƒ©ãƒ³ã‚¹",advice:"ä»–è€…ã¨ã®é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã—ãªãŒã‚‰ã€è‡ªåˆ†ã®é“ã‚’æ­©ã‚",warning:"å­¤ç«‹ã¯é¿ã‘ã€é©åˆ‡ãªå”åŠ›é–¢ä¿‚ã‚’ç¯‰ãã¹ã—"}},{stageNumber:3,title:"ç¬¬ä¸‰æ®µéšï¼šã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®é¸æŠ",description:"è¡Œå‹•ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨é€Ÿåº¦ã‚’æ±ºã‚ã‚‹",choices:[{id:"cautious",name:"æ…é‡ãªé¸æŠ",keywords:["æ…é‡","æº–å‚™","è¦³å¯Ÿ"],description:"æ™‚ã‚’è¦‹ã¦ç¢ºå®Ÿã«é€²ã‚€",iChingPrinciple:"æ½œé¾å‹¿ç”¨ - æ™‚æ©Ÿã‚’å¾…ã¤çŸ¥æµ",compatibility:80,outcome:{probability:80,description:"ç€å®Ÿã§ç¢ºå®Ÿãªæˆæœã‚’å¾—ã‚‰ã‚Œã‚‹",nextStep:"ååˆ†ãªæº–å‚™ã§è‡¨ã‚€"}},{id:"decisive",name:"æ±ºæ–­çš„é¸æŠ",keywords:["æ±ºæ–­","è¿…é€Ÿ","è¡Œå‹•"],description:"æ©Ÿã‚’é€ƒã•ãšç´ æ—©ãè¡Œå‹•",iChingPrinciple:"äº¢é¾æœ‰æ‚” - å‹‡æ°—ã‚ã‚‹æ±ºæ–­",compatibility:55,outcome:{probability:55,description:"è¿…é€Ÿãªè¡Œå‹•ã§æ©Ÿä¼šã‚’æ´ã‚€",nextStep:"æ±ºæ–­åŠ›ã‚’ç™ºæ®ã™ã‚‹"}}],iChingGuidance:{principle:"ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã“ãå…¨ã¦",advice:"æ©Ÿã‚’è¦‹ã‚‹ã«æ•ã§ã‚ã‚Œã€‚ã—ã‹ã—ç„¦ã‚Šã¯ç¦ç‰©ã€‚",warning:"æ™‚æœŸã‚’èª¤ã‚Œã°ã€è‰¯ã„è¨ˆç”»ã‚‚å¤±æ•—ã«çµ‚ã‚ã‚‹"}}]}}async performCompleteAnalysis(e){this.isInitialized||await this.initialize();const i=this.calculateSituationHexagram(e);if(!i)return console.error("âŒ Failed to calculate situation hexagram"),null;console.log("ğŸ¯ [CRITICAL DEBUG] Generating threeStageProcess...");let t=this.generateThreeStageProcess(i);console.log("ğŸ¯ [CRITICAL DEBUG] threeStageProcess generated:",{hasProcess:!!t,stagesCount:t?.stages?.length,processData:t}),t&&t.stages&&0!==t.stages.length||(console.warn("âš ï¸ threeStageProcess generation failed, creating emergency fallback data..."),t=this.createEmergencyThreeStageProcess(i),console.log("ğŸ†˜ Emergency threeStageProcess created:",t)),console.log("ğŸ¯ [CRITICAL DEBUG] Generating 8 scenarios...");const n=this.generate8Scenarios(t);console.log("ğŸ¯ [CRITICAL DEBUG] Scenarios generated:",{hasScenarios:!!n,scenariosCount:n?.length});const a={inputText:e,currentSituation:i,threeStageProcess:t,eightScenarios:n,timestamp:(new Date).toISOString()};return console.log("âœ… Complete analysis performed:",a),a}}"undefined"!=typeof window&&(window.IChingGuidanceEngine=IChingGuidanceEngine,window.iChingGuidance=new IChingGuidanceEngine,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.iChingGuidance.initialize()}):window.iChingGuidance.initialize()),console.log("âœ… IChingGuidanceEngine loaded")}("undefined"!=typeof window&&window);