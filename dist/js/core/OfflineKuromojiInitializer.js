console.log("ðŸ“ OfflineKuromojiInitializer Loading with HaQei Philosophy..."),window.OfflineKuromojiInitializer={initialized:!1,kuromojiStatus:{available:!1,loading:!1,error:null,tokenizer:null,dictPath:null},haqeiAdaptation:{harmony:{seamless_fallback:!0,consistent_behavior:!0,balanced_performance:!0},compassion:{transparent_loading:!0,gentle_error_handling:!0,preserve_functionality:!0},wisdom:{context_aware_analysis:!0,intelligent_caching:!0,progressive_enhancement:!0},authenticity:{reliable_analysis:!0,honest_limitations:!0,transparent_confidence:!0}},fallbackAnalyzer:null,async init(){console.log("ðŸš€ OfflineKuromojiInitializer initializing...");try{await this.detectKuromojiAvailability(),await this.setupFallbackAnalyzer(),await this.initializeKuromoji(),this.setupProgressiveEnhancement(),this.initialized=!0,console.log("âœ… OfflineKuromojiInitializer initialized with HaQei philosophy")}catch(i){console.error("âŒ OfflineKuromojiInitializer initialization failed:",i),this.handleInitializationFailure(i)}},async detectKuromojiAvailability(){console.log("ðŸ” Detecting Kuromoji.js availability...");try{return"undefined"!=typeof kuromoji?(this.kuromojiStatus.available=!0,console.log("âœ… Kuromoji.js detected"),!0):(await this.attemptDynamicLoad(),this.kuromojiStatus.available)}catch(i){return console.warn("âš ï¸ Kuromoji.js not available:",i),this.kuromojiStatus.available=!1,this.kuromojiStatus.error=i.message,!1}},async attemptDynamicLoad(){return console.log("ðŸ“¦ Attempting dynamic Kuromoji.js load..."),new Promise((i,e)=>{const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/build/kuromoji.js",a.onload=()=>{"undefined"!=typeof kuromoji?(this.kuromojiStatus.available=!0,console.log("âœ… Kuromoji.js dynamically loaded"),i(!0)):e(new Error("Kuromoji.js loaded but not available"))},a.onerror=()=>{e(new Error("Failed to load Kuromoji.js"))},document.head.appendChild(a),setTimeout(()=>{e(new Error("Kuromoji.js load timeout"))},1e4)})},async setupFallbackAnalyzer(){console.log("ðŸ›¡ï¸ Setting up fallback analyzer..."),this.fallbackAnalyzer={tokenize:i=>{const e=[];return(i.match(/[\u3040-\u309F]+|[\u30A0-\u30FF]+|[\u4E00-\u9FAF]+|[a-zA-Z0-9]+|[^\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAFa-zA-Z0-9]/g)||[]).forEach((i,a)=>{e.push({surface_form:i,pos:this.estimatePartOfSpeech(i),pos_detail_1:"*",pos_detail_2:"*",pos_detail_3:"*",conjugated_type:"*",conjugated_form:"*",basic_form:i,reading:this.estimateReading(i),pronunciation:this.estimateReading(i),word_id:a,word_type:"KNOWN",word_position:a})}),e},estimatePartOfSpeech:i=>/^[\u3040-\u309F]+$/.test(i)?i.endsWith("ã‚‹")||i.endsWith("ã†")||i.endsWith("ã")?"å‹•è©ž":i.endsWith("ã„")?"å½¢å®¹è©ž":"åŠ©è©ž":/^[\u30A0-\u30FF]+$/.test(i)||/^[\u4E00-\u9FAF]+$/.test(i)||/^[a-zA-Z]+$/.test(i)||/^[0-9]+$/.test(i)?"åè©ž":"è¨˜å·",estimateReading:i=>/^[\u3040-\u309F]+$/.test(i)||/^[\u30A0-\u30FF]+$/.test(i)?i:"*"},console.log("âœ… Fallback analyzer setup complete")},async initializeKuromoji(){if(this.kuromojiStatus.available){console.log("ðŸ”§ Initializing Kuromoji.js..."),this.kuromojiStatus.loading=!0;try{this.kuromojiStatus.dictPath="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict/";const i=await this.buildTokenizer();this.kuromojiStatus.tokenizer=i,this.kuromojiStatus.loading=!1,console.log("âœ… Kuromoji.js initialized successfully")}catch(i){console.error("âŒ Kuromoji.js initialization failed:",i),this.kuromojiStatus.loading=!1,this.kuromojiStatus.error=i.message}}else console.log("ðŸ“ Using fallback analyzer (Kuromoji.js not available)")},buildTokenizer(){return new Promise((i,e)=>{kuromoji.builder({dicPath:this.kuromojiStatus.dictPath}).build((a,t)=>{a?e(a):i(t)})})},setupProgressiveEnhancement(){console.log("ðŸš€ Setting up progressive enhancement..."),this.progressiveEnhancement={basic:{available:!0,features:["simple_segmentation","character_type_detection"]},fallback:{available:!!this.fallbackAnalyzer,features:["part_of_speech_estimation","basic_tokenization"]},full:{available:!!this.kuromojiStatus.tokenizer,features:["accurate_morphological_analysis","reading_pronunciation","detailed_pos"]}},console.log("âœ… Progressive enhancement setup complete")},handleInitializationFailure(i){console.error("ðŸ’¥ OfflineKuromojiInitializer failed:",i),this.initialized=!0,this.kuromojiStatus.error=i.message,console.log("ðŸ›¡ï¸ Continuing with basic text analysis capabilities")},async analyzeText(i,e={}){this.initialized||await this.init();try{const a=this.determineAnalysisLevel(i,e);return await this.performAnalysis(i,a,e)}catch(a){return console.error("âŒ Text analysis failed:",a),this.createFallbackAnalysis(i)}},determineAnalysisLevel(i,e){return i.length>1e3&&!e.forceFullAnalysis?"fallback":this.kuromojiStatus.tokenizer&&!this.kuromojiStatus.loading?"full":this.fallbackAnalyzer?"fallback":"basic"},async performAnalysis(i,e,a){const t=performance.now();let o=[],n=0,s="";switch(e){case"full":o=this.kuromojiStatus.tokenizer.tokenize(i),n=.9,s="kuromoji";break;case"fallback":o=this.fallbackAnalyzer.tokenize(i),n=.6,s="fallback";break;default:o=this.basicTokenize(i),n=.3,s="basic"}return{text:i,tokens:o,analysis:{method:s,confidence:n,processing_time:performance.now()-t,token_count:o.length,haqei_enhanced:this.enhanceWithHaQeiWisdom(o)},metadata:{timestamp:Date.now(),level:e,philosophy:"haqei"}}},basicTokenize(i){const e=[];return Array.from(i).forEach((i,a)=>{e.push({surface_form:i,pos:this.classifyCharacterType(i),basic_form:i,word_position:a,word_type:"BASIC"})}),e},classifyCharacterType:i=>/[\u3040-\u309F]/.test(i)?"ã²ã‚‰ãŒãª":/[\u30A0-\u30FF]/.test(i)?"ã‚«ã‚¿ã‚«ãƒŠ":/[\u4E00-\u9FAF]/.test(i)?"æ¼¢å­—":/[a-zA-Z]/.test(i)?"è‹±å­—":/[0-9]/.test(i)?"æ•°å­—":"è¨˜å·",enhanceWithHaQeiWisdom(i){const e={harmony_indicators:[],compassion_indicators:[],wisdom_indicators:[],authenticity_indicators:[]};return i.forEach(i=>{const a=i.surface_form;["èª¿å’Œ","å¹³å’Œ","ãƒãƒ©ãƒ³ã‚¹","å”èª¿"].includes(a)&&e.harmony_indicators.push({word:a,position:i.word_position,principle:"harmony"}),["æ„›","æ€ã„ã‚„ã‚Š","æ…ˆæ‚²","å„ªã—ã•"].includes(a)&&e.compassion_indicators.push({word:a,position:i.word_position,principle:"compassion"}),["çŸ¥æµ","æ™ºæ…§","å­¦ã³","æˆé•·"].includes(a)&&e.wisdom_indicators.push({word:a,position:i.word_position,principle:"wisdom"}),["çœŸå®Ÿ","èª å®Ÿ","æ­£ç›´","ç´”ç²‹"].includes(a)&&e.authenticity_indicators.push({word:a,position:i.word_position,principle:"authenticity"})}),e},createFallbackAnalysis(i){return{text:i,tokens:this.basicTokenize(i),analysis:{method:"emergency_fallback",confidence:.1,processing_time:0,token_count:i.length,haqei_enhanced:{harmony_indicators:[],compassion_indicators:[],wisdom_indicators:[],authenticity_indicators:[]}},metadata:{timestamp:Date.now(),level:"emergency",philosophy:"haqei-safe"},warning:"Emergency fallback mode - limited analysis capabilities"}},async extractKeywords(i,e={}){const a=await this.analyzeText(i,e),t=[];return a.tokens.forEach(i=>{i.pos&&(i.pos.includes("åè©ž")||i.pos.includes("å‹•è©ž"))&&i.surface_form.length>=2&&t.push({word:i.surface_form,pos:i.pos,basic_form:i.basic_form||i.surface_form,reading:i.reading||"*",position:i.word_position})}),{keywords:t,analysis_info:a.analysis,haqei_enhancement:a.analysis.haqei_enhanced}},async analyzePOS(i,e={}){const a=await this.analyzeText(i,e),t={};return a.tokens.forEach(i=>{const e=i.pos||"unknown";t[e]=(t[e]||0)+1}),{pos_distribution:t,total_tokens:a.tokens.length,analysis_method:a.analysis.method,confidence:a.analysis.confidence}},getStatus(){return{initialized:this.initialized,kuromoji_available:this.kuromojiStatus.available,kuromoji_loading:this.kuromojiStatus.loading,kuromoji_error:this.kuromojiStatus.error,fallback_ready:!!this.fallbackAnalyzer,progressive_enhancement:this.progressiveEnhancement||null,philosophy:"haqei",architecture:"triple-os"}},getCapabilities(){const i=["basic_tokenization","character_classification"];return this.fallbackAnalyzer&&i.push("fallback_morphological_analysis","pos_estimation"),this.kuromojiStatus.tokenizer&&i.push("full_morphological_analysis","accurate_pos_tagging","reading_pronunciation"),i.push("haqei_wisdom_enhancement","keyword_extraction","pos_distribution"),i}},document.addEventListener("DOMContentLoaded",()=>{window.OfflineKuromojiInitializer.init()}),console.log("âœ… OfflineKuromojiInitializer loaded with HaQei Philosophy");