class MorphologyFallback{constructor(){this.hiraganaPattern=/[\u3042-\u3096]/g,this.katakanaPattern=/[\u30A0-\u30FF]/g,this.kanjiPattern=/[\u4E00-\u9FAF]/g,this.asciiPattern=/[\u0020-\u007E]/g,this.patterns={honorifics:/お[\u3042-\u3096]{1,3}|ご[\u4E00-\u9FAF]{1,3}/g,particles:/は|が|を|に|で|と|や|の|か|も|よ|ね|な|だ|である/g,verbs:/する|した|して|される|できる|ある|いる|なる|来る|行く/g,adjectives:/い$|な$|的$/g,negation:/ない|ません|しない|できない|ではない/g,positive:/良い|素晴らしい|優秀|成功|達成|満足/g,negative:/悪い|困難|問題|失敗|不安|心配/g},console.log("🔤 MorphologyFallback initialized - Basic Japanese analysis ready")}analyzeText(t){if(!t||"string"!=typeof t)return this.createEmptyResult();return{originalText:t,length:t.length,characterTypes:this.analyzeCharacterTypes(t),patterns:this.detectPatterns(t),sentiment:this.analyzeSentiment(t),keywords:this.extractKeywords(t),readability:this.calculateReadability(t)}}analyzeCharacterTypes(t){return{hiragana:(t.match(this.hiraganaPattern)||[]).length,katakana:(t.match(this.katakanaPattern)||[]).length,kanji:(t.match(this.kanjiPattern)||[]).length,ascii:(t.match(this.asciiPattern)||[]).length,total:t.length}}detectPatterns(t){const e={};for(const[a,n]of Object.entries(this.patterns)){const i=t.match(n)||[];e[a]={count:i.length,matches:i.slice(0,5)}}return e}analyzeSentiment(t){const e=t.match(this.patterns.positive)||[],a=t.match(this.patterns.negative)||[],n=t.match(this.patterns.negation)||[];let i=e.length-a.length;n.length>0&&(i-=.5*n.length);return{score:Math.max(-1,Math.min(1,i/Math.max(1,t.length/10))),confidence:Math.min(.7,(e.length+a.length)/10),positive:e.length,negative:a.length,negation:n.length}}extractKeywords(t){const e=t.split(/[\s、。！？\n\r\t]+/).filter(t=>t.length>1).filter(t=>!this.isStopWord(t)).slice(0,10),a={};return e.forEach(t=>{a[t]=(a[t]||0)+1}),Object.entries(a).sort(([,t],[,e])=>e-t).slice(0,5).map(([t,e])=>({word:t,count:e}))}isStopWord(t){return["の","に","は","を","が","で","と","から","まで","より","こと","もの","これ","それ","あれ","この","その","あの","です","である","だった","でした","します","された"].includes(t)||t.length<2}calculateReadability(t){const e=this.analyzeCharacterTypes(t),a=t.split(/[。！？]/).length-1,n=a>0?t.length/a:t.length,i=e.kanji/e.total,s=.7*i+.3*Math.min(2,n/20);return{score:Math.max(0,Math.min(1,1-s)),complexity:s,avgSentenceLength:n,kanjiRatio:i}}createEmptyResult(){return{originalText:"",length:0,characterTypes:{hiragana:0,katakana:0,kanji:0,ascii:0,total:0},patterns:{},sentiment:{score:0,confidence:0,positive:0,negative:0,negation:0},keywords:[],readability:{score:0,complexity:0,avgSentenceLength:0,kanjiRatio:0}}}tokenize(t){this.analyzeText(t);return t.split(/[\s、。！？\n\r\t]+/).filter(t=>t.length>0).map((t,e)=>({surface_form:t,pos:this.guessPartOfSpeech(t),pos_detail_1:"*",pos_detail_2:"*",pos_detail_3:"*",conjugated_type:"*",conjugated_form:"*",basic_form:t,reading:t,pronunciation:t,word_id:e,word_type:"KNOWN"}))}guessPartOfSpeech(t){return this.patterns.particles.test(t)?"助詞":this.patterns.verbs.test(t)?"動詞":this.patterns.adjectives.test(t)?"形容詞":this.kanjiPattern.test(t)?"名詞":this.hiraganaPattern.test(t)?"助詞":"名詞"}isFallbackMode(){return!0}getCapabilities(){return{morphologicalAnalysis:!1,sentimentAnalysis:!0,keywordExtraction:!0,characterAnalysis:!0,patternDetection:!0,readabilityAnalysis:!0,mode:"fallback"}}}window.MorphologyFallback=MorphologyFallback,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.morphologyFallback=new MorphologyFallback}):window.morphologyFallback=new MorphologyFallback;