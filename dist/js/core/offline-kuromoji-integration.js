console.log("ðŸ”Œ Offline Kuromoji Integration Loading with HaQei Philosophy..."),window.OfflineKuromojiIntegration={initialized:!1,integrationStatus:{kuromoji_initializer:null,offline_detector:null,ml_integration:null,dictionary_manager:null,cross_system_sync:!1},haqeiIntegration:{harmony:{seamless_integration:!0,unified_interface:!0,balanced_workload:!0,graceful_handoffs:!0},compassion:{transparent_processing:!0,gentle_error_recovery:!0,preserved_functionality:!0,minimal_disruption:!0},wisdom:{context_aware_routing:!0,performance_optimization:!0,resource_management:!0,learning_from_usage:!0},authenticity:{consistent_output:!0,reliable_analysis:!0,transparent_confidence:!0,honest_limitations:!0}},processingEngine:null,analysisCache:new Map,async init(){console.log("ðŸš€ OfflineKuromojiIntegration initializing...");try{await this.detectSystemDependencies(),await this.initializeProcessingEngine(),await this.setupCrossSystemIntegration(),await this.configureCaching(),this.establishHaQeiOrchestration(),this.initialized=!0,console.log("âœ… OfflineKuromojiIntegration initialized with HaQei philosophy")}catch(e){console.error("âŒ OfflineKuromojiIntegration initialization failed:",e),this.handleInitializationFailure(e)}},async detectSystemDependencies(){console.log("ðŸ” Detecting system dependencies..."),window.OfflineKuromojiInitializer&&(this.integrationStatus.kuromoji_initializer=window.OfflineKuromojiInitializer,console.log("âœ… OfflineKuromojiInitializer detected")),window.OfflineDetector&&(this.integrationStatus.offline_detector=window.OfflineDetector,console.log("âœ… OfflineDetector detected")),window.MLIntegration&&(this.integrationStatus.ml_integration=window.MLIntegration,console.log("âœ… MLIntegration detected")),window.DictionaryManager&&(this.integrationStatus.dictionary_manager=window.DictionaryManager,console.log("âœ… DictionaryManager detected")),await this.validateSystemIntegrity()},async validateSystemIntegrity(){console.log("ðŸ”§ Validating system integrity...");const e=Object.values(this.integrationStatus).filter(Boolean).map(async e=>{if(e.init&&!e.initialized)try{return await e.init(),{system:e.constructor.name,status:"ready"}}catch(t){return{system:e.constructor.name,status:"error",error:t}}return{system:e.constructor.name,status:"ready"}}),t=await Promise.allSettled(e);this.integrationStatus.cross_system_sync=t.every(e=>"fulfilled"===e.status&&"ready"===e.value.status),console.log("âœ… System integrity validated")},async initializeProcessingEngine(){console.log("âš™ï¸ Initializing processing engine..."),this.processingEngine={processText:async function(e,t={}){const i=performance.now();try{const n=this.determineProcessingRoute(e,t),a=await this.performMorphologicalAnalysis(e,n),o=await this.applyMLEnhancement(a,t),s=await this.integrateDictionaryLookup(o,t),r=this.applyHaQeiWisdom(s),l=this.consolidateResults({text:e,morphological:a,ml_enhancement:o,dictionary:s,haqei:r,processing_time:performance.now()-i,routing:n});return this.cacheResult(e,l),l}catch(n){return console.error("âŒ Processing pipeline error:",n),this.createErrorRecoveryResult(e,n)}}.bind(this),determineProcessingRoute:(e,t)=>{const i={morphological_analysis:"auto",ml_enhancement:!0,dictionary_lookup:!0,haqei_integration:!0,caching_enabled:!0};return this.integrationStatus.offline_detector&&!this.integrationStatus.offline_detector.isOnline()&&(i.dictionary_lookup="offline_only",i.ml_enhancement="basic_only"),e.length>5e3&&(i.morphological_analysis="chunked",i.caching_enabled=!0),Object.assign(i,t.routing||{}),i},performMorphologicalAnalysis:async(e,t)=>{if(!this.integrationStatus.kuromoji_initializer)throw new Error("Kuromoji initializer not available");const i={method:t.morphological_analysis,fallback_enabled:!0,haqei_enhancement:t.haqei_integration};return await this.integrationStatus.kuromoji_initializer.analyzeText(e,i)},applyMLEnhancement:async(e,t)=>{if(!this.integrationStatus.ml_integration||!t.ml_enhancement)return e;try{const t=await this.integrationStatus.ml_integration.analyzeText(e.text,{context:"morphological_enhancement"});return{...e,ml_enhancement:{sentiment:t.detailed?.sentiment_analysis||null,themes:t.detailed?.theme_analysis||null,emotions:t.detailed?.emotion_analysis||null,haqei_alignment:t.detailed?.haqei_analysis||null}}}catch(i){return console.warn("âš ï¸ ML enhancement failed:",i),e}},integrateDictionaryLookup:async(e,t)=>{if(!this.integrationStatus.dictionary_manager||!t.dictionary_lookup)return e;try{const t=e.tokens.filter(e=>e.pos&&(e.pos.includes("åè©ž")||e.pos.includes("å‹•è©ž"))).slice(0,10).map(async e=>{const t=await this.integrationStatus.dictionary_manager.lookupTerm(e.basic_form||e.surface_form);return{token:e.surface_form,lookup:t}}),i=await Promise.allSettled(t);return{...e,dictionary_integration:{lookups:i.filter(e=>"fulfilled"===e.status).map(e=>e.value),lookup_count:i.filter(e=>"fulfilled"===e.status).length}}}catch(i){return console.warn("âš ï¸ Dictionary integration failed:",i),e}},applyHaQeiWisdom:e=>{const t={harmony_assessment:this.assessTextualHarmony(e),compassion_indicators:this.identifyCompassionElements(e),wisdom_patterns:this.detectWisdomPatterns(e),authenticity_markers:this.findAuthenticityMarkers(e)};return{...e,haqei_wisdom:t,philosophical_integration:this.generatePhilosophicalInsights(t)}},consolidateResults:e=>({input_text:e.text,morphological_analysis:{tokens:e.morphological.tokens,method:e.morphological.analysis.method,confidence:e.morphological.analysis.confidence},semantic_enhancement:e.ml_enhancement||null,dictionary_insights:e.dictionary?.dictionary_integration||null,haqei_philosophy:e.haqei?.haqei_wisdom||null,philosophical_insights:e.haqei?.philosophical_integration||null,processing_metadata:{total_time:e.processing_time,routing_decisions:e.routing,timestamp:Date.now(),philosophy:"haqei-integrated"},confidence_scores:this.calculateConfidenceScores(e),recommendations:this.generateRecommendations(e)}),createErrorRecoveryResult:(e,t)=>({input_text:e,error_recovery:!0,error_details:t.message,basic_analysis:this.performBasicAnalysis(e),processing_metadata:{error_occurred:!0,fallback_mode:!0,timestamp:Date.now(),philosophy:"haqei-recovery"},recommendations:["ã‚·ã‚¹ãƒ†ãƒ ã®å†åˆæœŸåŒ–ã‚’ãŠè©¦ã—ãã ã•ã„"]})},console.log("âœ… Processing engine initialized")},async setupCrossSystemIntegration(){console.log("ðŸ”— Setting up cross-system integration..."),this.integrationStatus.offline_detector&&this.integrationStatus.offline_detector.addListener(e=>{this.handleConnectivityChange(e)}),this.crossSystemSync={enabled:!0,sync_interval:3e4,last_sync:Date.now()},console.log("âœ… Cross-system integration setup complete")},async configureCaching(){console.log("ðŸ’¾ Configuring caching system..."),this.cacheConfig={max_size:1e3,ttl:36e5,cleanup_interval:3e5},setInterval(()=>{this.cleanupCache()},this.cacheConfig.cleanup_interval),console.log("âœ… Caching system configured")},establishHaQeiOrchestration(){console.log("â˜¯ï¸ Establishing HaQei orchestration..."),this.haqeiOrchestrator={balanceSystemLoad:()=>{const e=this.monitorSystemLoads();return this.optimizeWorkDistribution(e)},compassionateErrorHandling:(e,t)=>(console.warn(`ðŸ¤ Compassionate error handling: ${e.message}`,t),this.createGentleErrorResponse(e,t)),wisdomBasedOptimization:e=>this.adaptSystemBehavior(e),authenticQualityReporting:e=>this.generateHonestQualityAssessment(e)},console.log("âœ… HaQei orchestration established")},handleConnectivityChange(e){console.log(`ðŸŒ Connectivity changed: ${e.type}`),"offline"===e.type?this.adaptToOfflineMode():"online"===e.type&&this.adaptToOnlineMode()},adaptToOfflineMode(){console.log("ðŸ“´ Adapting to offline mode..."),this.processingEngine&&(this.processingEngine.offline_mode=!0),this.cacheConfig.ttl*=2},adaptToOnlineMode(){console.log("ðŸŒ Adapting to online mode..."),this.processingEngine&&(this.processingEngine.offline_mode=!1),this.cacheConfig.ttl=36e5},assessTextualHarmony(e){let t=0;const i=e.tokens||[],n=["èª¿å’Œ","å¹³å’Œ","ãƒãƒ©ãƒ³ã‚¹","å”èª¿","çµ±åˆ"];t+=.2*i.filter(e=>n.some(t=>e.surface_form.includes(t))).length;const a=["å¯¾ç«‹","äº‰ã„","æ··ä¹±","åˆ†è£‚"];return t-=.1*i.filter(e=>a.some(t=>e.surface_form.includes(t))).length,Math.max(0,Math.min(1,t))},identifyCompassionElements(e){const t=[],i=e.tokens||[],n=["æ„›","æ€ã„ã‚„ã‚Š","æ…ˆæ‚²","å„ªã—ã•","å…±æ„Ÿ"];return i.forEach(e=>{n.some(t=>e.surface_form.includes(t))&&t.push({word:e.surface_form,position:e.word_position,context:"compassion_indicator"})}),t},detectWisdomPatterns(e){const t=[],i=e.tokens||[],n=["çŸ¥æµ","æ™ºæ…§","å­¦ã³","æˆé•·","ç†è§£"];return i.forEach(e=>{n.some(t=>e.surface_form.includes(t))&&t.push({word:e.surface_form,pattern:"wisdom_reference",context:this.getTokenContext(e,i)})}),t},findAuthenticityMarkers(e){const t=[],i=e.tokens||[],n=["çœŸå®Ÿ","èª å®Ÿ","æ­£ç›´","ç´”ç²‹","è‡ªç„¶"];return i.forEach(e=>{n.some(t=>e.surface_form.includes(t))&&t.push({word:e.surface_form,authenticity_type:this.classifyAuthenticityType(e.surface_form),strength:this.calculateAuthenticityStrength(e,i)})}),t},getTokenContext(e,t){const i=e.word_position||0,n=t.slice(Math.max(0,i-3),i),a=t.slice(i+1,i+3+1);return{before:n.map(e=>e.surface_form).join(""),after:a.map(e=>e.surface_form).join("")}},classifyAuthenticityType:e=>e.includes("çœŸå®Ÿ")?"truth":e.includes("èª å®Ÿ")?"sincerity":e.includes("æ­£ç›´")?"honesty":e.includes("ç´”ç²‹")?"purity":e.includes("è‡ªç„¶")?"naturalness":"general_authenticity",calculateAuthenticityStrength(e,t){const i=e.surface_form.length,n=this.getTokenContext(e,t);let a=Math.min(i/5,1);return(n.before.includes("æœ¬å½“")||n.after.includes("æœ¬å½“"))&&(a+=.2),Math.min(a,1)},generatePhilosophicalInsights(e){const t=[];return e.harmony_assessment>.7&&t.push("ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã¯é«˜ã„èª¿å’Œæ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™"),e.compassion_indicators.length>0&&t.push(`æ…ˆæ‚²çš„ãªè¦ç´ ãŒ${e.compassion_indicators.length}ç®‡æ‰€ã§è¦‹ã‚‰ã‚Œã¾ã™`),e.wisdom_patterns.length>0&&t.push("æ™ºæ…§ã¨å­¦ç¿’ã¸ã®è¨€åŠãŒå«ã¾ã‚Œã¦ã„ã¾ã™"),e.authenticity_markers.length>0&&t.push("çœŸå®Ÿæ€§ã¨èª å®Ÿã•ãŒè¡¨ç¾ã•ã‚Œã¦ã„ã¾ã™"),t},calculateConfidenceScores(e){const t={morphological:e.morphological?.analysis?.confidence||0,semantic:e.ml_enhancement?.8:0,dictionary:e.dictionary?.dictionary_integration?.9:0,haqei:e.haqei?.95:0},i=Object.values(t).reduce((e,t)=>e+t,0)/Object.keys(t).length;return{...t,overall:i,classification:i>.8?"high":i>.5?"medium":"low"}},generateRecommendations(e){const t=[];return e.morphological?.analysis?.confidence<.7&&t.push("å½¢æ…‹ç´ è§£æžã®ç²¾åº¦å‘ä¸Šã®ãŸã‚ã€ã‚ˆã‚Šè©³ç´°ãªãƒ†ã‚­ã‚¹ãƒˆã‚’ã”æä¾›ãã ã•ã„"),e.ml_enhancement||t.push("ã‚»ãƒžãƒ³ãƒ†ã‚£ãƒƒã‚¯åˆ†æžã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šæ·±ã„æ´žå¯ŸãŒå¾—ã‚‰ã‚Œã¾ã™"),e.haqei?.haqei_wisdom?.harmony_assessment<.5&&t.push("ãƒ†ã‚­ã‚¹ãƒˆã®èª¿å’Œæ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šè‰¯ã„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¯èƒ½ã«ãªã‚Šã¾ã™"),t},cacheResult(e,t){const i=this.generateCacheKey(e);if(this.analysisCache.size>=this.cacheConfig.max_size){const e=this.analysisCache.keys().next().value;this.analysisCache.delete(e)}this.analysisCache.set(i,{result:t,timestamp:Date.now(),ttl:this.cacheConfig.ttl})},generateCacheKey(e){let t=0;for(let i=0;i<e.length;i++){t=(t<<5)-t+e.charCodeAt(i),t&=t}return`cache_${Math.abs(t)}`},cleanupCache(){const e=Date.now(),t=[];for(const[i,n]of this.analysisCache)e-n.timestamp>n.ttl&&t.push(i);t.forEach(e=>this.analysisCache.delete(e)),t.length>0&&console.log(`ðŸ§¹ Cleaned up ${t.length} expired cache entries`)},performBasicAnalysis(e){const t=e.match(/[ä¸€-é¾¯]+/g)||[],i=Array.from(e);return{word_count:t.length,character_count:i.length,estimated_reading_time:Math.ceil(i.length/400),basic_keywords:t.slice(0,5)}},handleInitializationFailure(e){console.error("ðŸ’¥ Integration initialization failed:",e),this.initialized=!0;const t=this;this.processingEngine={processText:async function(e){return{input_text:e,fallback_mode:!0,basic_analysis:t.performBasicAnalysis(e),error_message:"Integration system not fully available",philosophy:"haqei-emergency"}}}},async processText(e,t={}){this.initialized||await this.init();const i=this.generateCacheKey(e),n=this.analysisCache.get(i);return n&&Date.now()-n.timestamp<n.ttl?(console.log("ðŸ’¾ Returning cached result"),n.result):await this.processingEngine.processText(e,t)},getIntegrationStatus(){return{initialized:this.initialized,systems:{kuromoji_initializer:!!this.integrationStatus.kuromoji_initializer,offline_detector:!!this.integrationStatus.offline_detector,ml_integration:!!this.integrationStatus.ml_integration,dictionary_manager:!!this.integrationStatus.dictionary_manager},cross_system_sync:this.integrationStatus.cross_system_sync,cache_size:this.analysisCache.size,philosophy:"haqei",architecture:"integrated-triple-os"}},getIntegratedCapabilities(){const e=["basic_text_analysis","caching","error_recovery"];return this.integrationStatus.kuromoji_initializer&&e.push("morphological_analysis","pos_tagging"),this.integrationStatus.ml_integration&&e.push("semantic_analysis","sentiment_analysis"),this.integrationStatus.dictionary_manager&&e.push("dictionary_lookup","term_expansion"),this.integrationStatus.offline_detector&&e.push("connectivity_adaptation","offline_mode"),e.push("haqei_philosophical_integration","wisdom_enhancement","holistic_analysis"),e}},document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{window.OfflineKuromojiIntegration.init()},1e3)}),console.log("âœ… Offline Kuromoji Integration loaded with HaQei Philosophy");