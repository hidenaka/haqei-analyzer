class AuthenticEnergyBalanceEngine{constructor(){console.log("ðŸŒŸ Initializing Authentic I-Ching Energy Balance Engine"),this.initializeAuthenticTheory(),this.initializeOSOptimalPatterns(),this.initializeHexagramDatabase(),console.log("âœ… Authentic Energy Balance Engine initialized successfully")}initializeAuthenticTheory(){this.polarPairs=[{yin:"å¤",yang:"ä¹¾",relationship:"heaven_earth",weight:.3},{yin:"è‰®",yang:"å…Œ",relationship:"mountain_lake",weight:.25},{yin:"åŽ",yang:"é›¢",relationship:"water_fire",weight:.25},{yin:"å·½",yang:"éœ‡",relationship:"wind_thunder",weight:.2}],this.elementalCycle={"éœ‡":{element:"wood",generates:"fire",destroys:"earth",generated_by:"water",destroyed_by:"metal"},"å·½":{element:"wood",generates:"fire",destroys:"earth",generated_by:"water",destroyed_by:"metal"},"é›¢":{element:"fire",generates:"earth",destroys:"metal",generated_by:"wood",destroyed_by:"water"},"è‰®":{element:"earth",generates:"metal",destroys:"water",generated_by:"fire",destroyed_by:"wood"},"å¤":{element:"earth",generates:"metal",destroys:"water",generated_by:"fire",destroyed_by:"wood"},"ä¹¾":{element:"metal",generates:"water",destroys:"wood",generated_by:"earth",destroyed_by:"fire"},"å…Œ":{element:"metal",generates:"water",destroys:"wood",generated_by:"earth",destroyed_by:"fire"},"åŽ":{element:"water",generates:"wood",destroys:"fire",generated_by:"metal",destroyed_by:"earth"}},this.familialStructure={father:"ä¹¾",mother:"å¤",eldest_son:"éœ‡",middle_son:"åŽ",youngest_son:"è‰®",eldest_daughter:"å·½",middle_daughter:"é›¢",youngest_daughter:"å…Œ"},this.spatialHarmony={"ä¹¾":{direction:"northwest",season:"late_autumn"},"å…Œ":{direction:"west",season:"autumn"},"é›¢":{direction:"south",season:"summer"},"éœ‡":{direction:"east",season:"spring"},"å·½":{direction:"southeast",season:"late_spring"},"åŽ":{direction:"north",season:"winter"},"è‰®":{direction:"northeast",season:"late_winter"},"å¤":{direction:"southwest",season:"late_summer"}}}initializeOSOptimalPatterns(){this.osOptimalPatterns={"Engine OS":{name:"Creative-Stable Harmony",primary_trigrams:["ä¹¾","è‰®"],supportive_trigrams:["éœ‡","åŽ"],ideal_ratios:{"ä¹¾":[.25,.3],"éœ‡":[.2,.25],"åŽ":[.15,.2],"è‰®":[.2,.25],"å¤":[.15,.2],"å·½":[.1,.15],"é›¢":[.1,.15],"å…Œ":[.08,.12]},balance_type:"yang_dominant",harmony_focus:"internal_consistency"},"Interface OS":{name:"Social-Expressive Harmony",primary_trigrams:["å…Œ","é›¢"],supportive_trigrams:["å·½","å¤"],ideal_ratios:{"å…Œ":[.25,.3],"é›¢":[.2,.25],"å·½":[.2,.25],"å¤":[.15,.2],"è‰®":[.1,.15],"åŽ":[.08,.12],"éœ‡":[.08,.12],"ä¹¾":[.1,.15]},balance_type:"yin_dominant",harmony_focus:"social_adaptation"},"Safe Mode OS":{name:"Defensive-Receptive Harmony",primary_trigrams:["è‰®","å¤"],supportive_trigrams:["åŽ","å·½"],ideal_ratios:{"è‰®":[.25,.3],"å¤":[.2,.25],"åŽ":[.15,.2],"å·½":[.15,.2],"å…Œ":[.1,.15],"é›¢":[.08,.12],"éœ‡":[.08,.12],"ä¹¾":[.08,.12]},balance_type:"balanced",harmony_focus:"protective_stability"}}}initializeHexagramDatabase(){this.authenticHexagramMatrix=[[1,43,14,34,9,5,26,11],[58,60,38,54,61,59,28,19],[50,64,56,62,55,63,35,8],[51,16,40,32,46,48,18,7],[57,20,53,42,37,45,22,36],[6,29,4,7,59,60,3,2],[33,52,39,15,53,56,31,12],[2,47,4,7,46,29,27,24]],this.trigramToIndex={"ä¹¾":0,"å…Œ":1,"é›¢":2,"éœ‡":3,"å·½":4,"åŽ":5,"è‰®":6,"å¤":7}}selectOptimalHexagramByEnergyBalance(e,t){console.log(`ðŸŒŸ [${t}] Selecting optimal hexagram with authentic energy balance`),console.log("ðŸ“Š Input energies:",e);try{const a=this.generateAllHexagramCandidates();console.log(`ðŸ” Generated ${a.length} hexagram candidates`);const r=a.map(a=>{const r=this.evaluateHexagramCandidate(a,e,t);return{...a,...r}});r.sort((e,t)=>t.totalHarmonyScore-e.totalHarmonyScore);const i=r[0],n=this.generateDetailedAnalysis(i,e,t);return console.log(`ðŸ† [${t}] Selected Hexagram ${i.hexagramId} (${i.name})`),console.log(`ðŸ“ˆ Harmony Score: ${i.totalHarmonyScore.toFixed(2)}/100`),{hexagramId:i.hexagramId,hexagramName:i.name,upperTrigram:i.upperTrigram,lowerTrigram:i.lowerTrigram,harmonyScore:i.totalHarmonyScore,energyUtilization:i.energyUtilization,osCompatibility:i.osCompatibility,detailedAnalysis:n,alternativeCandidates:r.slice(1,4),improvementRecommendations:this.generateImprovementRecommendations(i,e,t)}}catch(a){return console.error(`âŒ Error in energy balance selection for ${t}:`,a),this.getFallbackHexagram(e,t)}}generateAllHexagramCandidates(){const e=[],t=["ä¹¾","å…Œ","é›¢","éœ‡","å·½","åŽ","è‰®","å¤"];return t.forEach(a=>{t.forEach(t=>{const r=this.trigramToIndex[a],i=this.trigramToIndex[t],n=this.authenticHexagramMatrix[r][i],o=window.HEXAGRAMS?window.HEXAGRAMS.find(e=>e.hexagram_id===n):null;e.push({hexagramId:n,name:o?o.name_jp:`å¦${n}`,upperTrigram:a,lowerTrigram:t,hexagramData:o})})}),e}evaluateHexagramCandidate(e,t,a){const r=this.calculatePolarHarmony(e,t),i=this.calculateElementalFlow(e,t),n=this.calculateFamilialBalance(e,t),o=this.calculateSpatialStability(e,t),l=this.calculateOSCompatibility(e,a,t),s=this.calculateEnergyUtilization(e,t),m=r*.25+i*.2+n*.15+o*.1+l*.25+s*.05;return{polarHarmony:r,elementalFlow:i,familialBalance:n,spatialStability:o,osCompatibility:l,energyUtilization:s,totalHarmonyScore:Math.max(0,Math.min(100,m))}}calculatePolarHarmony(e,t){const a=t[e.upperTrigram]||0,r=t[e.lowerTrigram]||0;let i=!1,n=1;if(this.polarPairs.forEach(t=>{(e.upperTrigram===t.yang&&e.lowerTrigram===t.yin||e.upperTrigram===t.yin&&e.lowerTrigram===t.yang)&&(i=!0,n=t.weight)}),i){const e=a>r?a/Math.max(r,1):r/Math.max(a,1),t=1.618,i=100-Math.abs(e-t)/t*50;return Math.max(0,i*n*100)}return 60*(a+r>0?Math.min(a,r)/Math.max(a,r):0)}calculateElementalFlow(e,t){const a=this.elementalCycle[e.upperTrigram],r=this.elementalCycle[e.lowerTrigram];if(!a||!r)return 50;const i=t[e.upperTrigram]||0,n=t[e.lowerTrigram]||0;let o=50;return a.element===r.generated_by&&(o+=25),r.element===a.generated_by&&(o+=25),a.element===r.destroyed_by&&i<1.5*n&&(o+=15),r.element===a.destroyed_by&&n<1.5*i&&(o+=15),a.destroys===r.element&&i>2*n&&(o-=20),r.destroys===a.element&&n>2*i&&(o-=20),Math.max(0,Math.min(100,o))}calculateFamilialBalance(e,t){const a=this.getFamilialRole(e.upperTrigram),r=this.getFamilialRole(e.lowerTrigram);let i=50;return("father"===a&&"mother"===r||"mother"===a&&"father"===r)&&(i+=30),"father"===a&&r.includes("son")&&(i+=20),"mother"===a&&r.includes("daughter")&&(i+=20),"father"===r&&a.includes("son")&&(i+=15),"mother"===r&&a.includes("daughter")&&(i+=15),a.includes("son")&&r.includes("son")&&(i+=10),a.includes("daughter")&&r.includes("daughter")&&(i+=10),Math.max(0,Math.min(100,i))}calculateSpatialStability(e,t){const a=this.spatialHarmony[e.upperTrigram],r=this.spatialHarmony[e.lowerTrigram];if(!a||!r)return 50;const i=["north","northeast","east","southeast","south","southwest","west","northwest"],n=i.indexOf(a.direction.replace("_","")),o=i.indexOf(r.direction.replace("_",""));let l=50;const s=Math.abs(n-o);return 4===s?l+=30:2===s||6===s?l+=20:1!==s&&7!==s&&3!==s&&5!==s||(l+=10),Math.max(0,Math.min(100,l))}calculateOSCompatibility(e,t,a){const r=this.osOptimalPatterns[t];if(!r)return 50;let i=0;r.primary_trigrams.includes(e.upperTrigram)&&(i+=30),r.primary_trigrams.includes(e.lowerTrigram)&&(i+=25),r.supportive_trigrams.includes(e.upperTrigram)&&(i+=20),r.supportive_trigrams.includes(e.lowerTrigram)&&(i+=15);const n=a[e.upperTrigram]||0,o=a[e.lowerTrigram]||0,l=Object.values(a).reduce((e,t)=>e+t,0);if(l>0){const t=n/l,a=o/l,s=r.ideal_ratios[e.upperTrigram],m=r.ideal_ratios[e.lowerTrigram];s&&t>=s[0]&&t<=s[1]&&(i+=10),m&&a>=m[0]&&a<=m[1]&&(i+=10)}return Math.max(0,Math.min(100,i))}calculateEnergyUtilization(e,t){const a=t[e.upperTrigram]||0,r=t[e.lowerTrigram]||0,i=Object.values(t).reduce((e,t)=>e+t,0);if(0===i)return 0;const n=(a+r)/i;return n>=.3&&n<=.7?100:n>=.2&&n<=.8?80:n>=.15&&n<=.85?60:Math.max(20,100*n)}getFamilialRole(e){return{"ä¹¾":"father","å¤":"mother","éœ‡":"eldest_son","åŽ":"middle_son","è‰®":"youngest_son","å·½":"eldest_daughter","é›¢":"middle_daughter","å…Œ":"youngest_daughter"}[e]||"unknown"}generateDetailedAnalysis(e,t,a){return{energyDistribution:{upper:t[e.upperTrigram]||0,lower:t[e.lowerTrigram]||0,utilization:e.energyUtilization,balance:this.analyzeEnergyBalance(e,t)},harmonyBreakdown:{polarHarmony:e.polarHarmony,elementalFlow:e.elementalFlow,familialBalance:e.familialBalance,spatialStability:e.spatialStability,osCompatibility:e.osCompatibility},authenticInterpretation:this.generateAuthenticInterpretation(e,a),improvedAspects:this.identifyImprovedAspects(e,t)}}generateAuthenticInterpretation(e,t){const a=e.upperTrigram,r=e.lowerTrigram;return{traditional_meaning:`${a}å¦åœ¨ä¸Šï¼Œ${r}å¦åœ¨ä¸‹ï¼Œè±¡å¾´${this.getTrigramMeaning(a)}èˆ‡${this.getTrigramMeaning(r)}çš„èª¿å’Œçµ±ä¸€`,os_context:this.getOSContextInterpretation(e,t),practical_guidance:this.getPracticalGuidance(e,t),energy_wisdom:`æ‚¨çš„${a}èƒ½é‡èˆ‡${r}èƒ½é‡é”æˆæœ€ä½³å¹³è¡¡ï¼Œé«”ç¾äº†${t}ç³»çµ±çš„å’Œè«§é‹ä½œ`}}getTrigramMeaning(e){return{"ä¹¾":"ç´”é™½å‰µé€ åŠ›","å¤":"ç´”é™°åŒ…å®¹åŠ›","éœ‡":"é›·é³´è¡Œå‹•åŠ›","å·½":"é¢¨è¡Œæ»²é€åŠ›","åŽ":"æ°´æµæŽ¢ç´¢åŠ›","é›¢":"ç«ç„°è¡¨ç¾åŠ›","è‰®":"å±±å¶½å®‰å®šåŠ›","å…Œ":"æ²¼æ¾¤èª¿å’ŒåŠ›"}[e]||"æœªçŸ¥ã®åŠ›"}getOSContextInterpretation(e,t){return{"Engine OS":`å…§åœ¨åƒ¹å€¼ç³»çµ±ä»¥${e.upperTrigram}ç‚ºä¸»å°Žï¼Œ${e.lowerTrigram}ç‚ºæ”¯æ´ï¼Œå½¢æˆç©©å®šçš„æ ¸å¿ƒäººæ ¼æž¶æ§‹`,"Interface OS":`ç¤¾äº¤äº’å‹•ç³»çµ±é€šéŽ${e.upperTrigram}çš„å¤–åœ¨è¡¨ç¾ï¼Œçµåˆ${e.lowerTrigram}çš„å…§åœ¨èª¿ç¯€ï¼Œé”æˆå’Œè«§çš„äººéš›é—œä¿‚`,"Safe Mode OS":`é˜²è­·ç³»çµ±ä»¥${e.upperTrigram}ä½œç‚ºä¸»è¦é˜²ç·šï¼Œ${e.lowerTrigram}æä¾›å¾Œå‚™æ”¯æ´ï¼Œç¢ºä¿å¿ƒç†å®‰å…¨èˆ‡ç©©å®š`}[t]||"ç³»çµ±é‹ä½œæ­£å¸¸"}getPracticalGuidance(e,t){return`åœ¨${t}é‹ä½œæ™‚ï¼Œä¿æŒ${e.upperTrigram}èˆ‡${e.lowerTrigram}çš„å‹•æ…‹å¹³è¡¡ï¼Œé †æ‡‰è‡ªç„¶è®ŠåŒ–çš„ç¯€å¥`}generateImprovementRecommendations(e,t,a){const r=[],i=Object.values(t).reduce((e,t)=>e+t,0),n=i/8;Object.entries(t).forEach(([e,t])=>{t<.5*n&&r.push({type:"energy_boost",trigram:e,current:t,target:.7*n,suggestion:`${e}ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æ´»æ€§åŒ–ã‚’æŽ¨å¥¨ã—ã¾ã™ã€‚${this.getTrigramMeaning(e)}ã‚’æ„è­˜çš„ã«è‚²æˆã—ã¦ãã ã•ã„ã€‚`})});const o=this.osOptimalPatterns[a];return o&&o.primary_trigrams.forEach(e=>{const n=(t[e]||0)/i,l=o.ideal_ratios[e];l&&n<l[0]&&r.push({type:"os_optimization",trigram:e,currentRatio:n,targetRange:l,suggestion:`${a}ã®åŠ¹æžœçš„é‹ç”¨ã®ãŸã‚ã€${e}ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®å¢—å¼·ãŒæœ‰åŠ¹ã§ã™ã€‚`})}),r}getFallbackHexagram(e,t){return console.warn(`ðŸš¨ Using fallback hexagram selection for ${t}`),{hexagramId:1,hexagramName:"ä¹¾ç‚ºå¤©",upperTrigram:"ä¹¾",lowerTrigram:"ä¹¾",harmonyScore:75,energyUtilization:50,osCompatibility:60,detailedAnalysis:{note:"ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é¸æŠžï¼šå®‰å…¨ã§å®‰å®šã—ãŸå‰µé€ çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³"},alternativeCandidates:[],improvementRecommendations:[]}}analyzeEnergyBalance(e,t){const a=t[e.upperTrigram]||0,r=t[e.lowerTrigram]||0;if(0===a+r)return"balanced";const i=a/r;return i>2?"upper_dominant":i<.5?"lower_dominant":i>=1.2&&i<=2?"upper_leaning":i>=.5&&i<=.8?"lower_leaning":"balanced"}identifyImprovedAspects(e,t){return{energyUtilization:e.energyUtilization>70?"excellent":"good",trigramSynergy:this.calculateTrigramSynergy(e),authenticAlignment:e.totalHarmonyScore>80?"high":"moderate",practicalApplicability:"enhanced"}}calculateTrigramSynergy(e){const t=this.elementalCycle[e.upperTrigram],a=this.elementalCycle[e.lowerTrigram];return t&&a?t.generates===a.element||a.generates===t.element?"generative":t.destroys===a.element||a.destroys===t.element?"challenging":"neutral":"neutral"}}window.AuthenticEnergyBalanceEngine=AuthenticEnergyBalanceEngine,console.log("âœ… AuthenticEnergyBalanceEngine loaded successfully");