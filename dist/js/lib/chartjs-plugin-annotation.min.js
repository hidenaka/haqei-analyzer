!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","chart.js/helpers"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["chartjs-plugin-annotation"]=e(t.Chart,t.Chart.helpers)}(this,function(t,e){"use strict";const o=["click","dblclick"],n=["enter","leave"],i=o.concat(n);function s(t,o,n){e.callback(t,[o.$context,n])}function a(t,o){let n=Number.POSITIVE_INFINITY;return t.filter(t=>t.options.display&&t.inRange(o.x,o.y)).reduce((t,i)=>{const r=i.getCenterPoint(),f=e.distanceBetweenPoints(o,r);return f<n?(t=[i],n=f):f===n&&t.push(i),t},[]).sort((t,e)=>t._index-e._index).slice(0,1)[0]}function d(t,o,n){const i=function(t,o){const n=t.axis,i=t.id,r=n+"ScaleID",f={min:e.valueOrDefault(t.min,Number.NEGATIVE_INFINITY),max:e.valueOrDefault(t.max,Number.POSITIVE_INFINITY)};for(const e of o)e.scaleID===i?u(e,t,["value","endValue"],f):e[r]===i&&u(e,t,[n+"Min",n+"Max",n+"Value"],f);return f}(o,n);let r=l(o,i,"min","suggestedMin");r=l(o,i,"max","suggestedMax")||r,r&&"function"==typeof o.handleTickRangeOptions&&o.handleTickRangeOptions()}function l(t,o,n,i){if(e.isFinite(o[n])&&!function(t,o,n){return e.defined(t[o])||e.defined(t[n])}(t.options,n,i)){const e=t[n]!==o[n];return t[n]=o[n],e}}function h(t,e){for(const o of["scaleID","xScaleID","yScaleID"])t[o]&&!e[t[o]]&&c(t,o)&&console.warn(`No scale found with id '${t[o]}' for annotation '${t.id}'`)}function c(t,o){if("scaleID"===o)return!0;const n=o.charAt(0);for(const i of["Min","Max","Value"])if(e.defined(t[n+i]))return!0;return!1}function u(t,o,n,i){for(const r of n){const n=t[r];if(e.defined(n)){const t=o.parse(n);i.min=Math.min(i.min,t),i.max=Math.max(i.max,t)}}}const r=.001,b=(t,e,o)=>Math.min(o,Math.max(e,t));function x(t,e,o){for(const n of Object.keys(t))t[n]=b(t[n],e,o);return t}function y(t,e,{x:o,y:n,width:i,height:f},k){const q=k/2;return t>=o-q-r&&t<=o+i+q+r&&e>=n-q-r&&e<=n+f+q+r}function p(t,e){const{x:o,y:n}=t.getProps(["x","y"],e);return{x:o,y:n}}const g=(t,e)=>e>t||t.length>e.length&&t.substr(0,e.length)===e,w=t=>"string"==typeof t&&t.endsWith("%"),m=t=>b(parseFloat(t)/100,0,1);function v(t,e){return"start"===e?0:"end"===e?t:w(e)?m(e)*t:t/2}function S(t,e){return"number"==typeof e?e:w(e)?m(e)*t:t}function C(t){return e.isObject(t)?{x:e.valueOrDefault(t.x,"center"),y:e.valueOrDefault(t.y,"center")}:{x:t=e.valueOrDefault(t,"center"),y:t}}function M(t){return t&&(e.defined(t.xValue)||e.defined(t.yValue))}const f=new Map;function P(t){if(t&&"object"==typeof t){const e=t.toString();return"[object HTMLImageElement]"===e||"[object HTMLCanvasElement]"===e}}function D(t,o,n){if(n){const i=o.getCenterPoint();t.translate(i.x,i.y),t.rotate(e.toRadians(n)),t.translate(-i.x,-i.y)}}function O(t,e){if(e&&e.borderWidth)return t.lineCap=e.borderCapStyle,t.setLineDash(e.borderDash),t.lineDashOffset=e.borderDashOffset,t.lineJoin=e.borderJoinStyle,t.lineWidth=e.borderWidth,t.strokeStyle=e.borderColor,!0}function j(t,e){t.shadowColor=e.backgroundShadowColor,t.shadowBlur=e.shadowBlur,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY}function A(t,o){const n=o.content;if(P(n))return{width:S(n.width,o.width),height:S(n.height,o.height)};const i=e.toFont(o.font),r=o.textStrokeWidth,k=e.isArray(n)?n:[n],q=k.join()+i.string+r+(t._measureText?"-spriting":"");if(!f.has(q)){t.save(),t.font=i.string;const e=k.length;let o=0;for(let i=0;i<e;i++){const e=k[i];o=Math.max(o,t.measureText(e).width+r)}t.restore();const n=e*i.lineHeight+r;f.set(q,{width:o,height:n})}return f.get(q)}function I(t,o,n){const{x:i,y:r,width:f,height:k}=o;t.save(),j(t,n);const q=O(t,n);t.fillStyle=n.backgroundColor,t.beginPath(),e.addRoundedRectPath(t,{x:i,y:r,w:f,h:k,radius:x(e.toTRBLCorners(e.valueOrDefault(n.cornerRadius,n.borderRadius)),0,Math.min(f,k)/2)}),t.closePath(),t.fill(),q&&(t.shadowColor=n.borderShadowColor,t.stroke()),t.restore()}function W(t,o,n){const i=n.content;if(P(i))return void t.drawImage(i,o.x,o.y,o.width,o.height);const r=e.isArray(i)?i:[i],f=e.toFont(n.font),k=f.lineHeight,q=function(t,e){const{x:o,width:n}=t,i=e.textAlign;return"center"===i?o+n/2:"end"===i||"right"===i?o+n:o}(o,n),Q=o.y+k/2+n.textStrokeWidth/2;t.save(),t.font=f.string,t.textBaseline="middle",t.textAlign=n.textAlign,function(t,e){if(e.textStrokeWidth>0)return t.lineJoin="round",t.miterLimit=2,t.lineWidth=e.textStrokeWidth,t.strokeStyle=e.textStrokeColor,!0}(t,n)&&r.forEach((e,o)=>t.strokeText(e,q,Q+o*k)),t.fillStyle=n.color,r.forEach((e,o)=>t.fillText(e,q,Q+o*k)),t.restore()}function R(t){const{x:e,y:o,width:n,height:i}=t;return{x:e+n/2,y:o+i/2}}function T(t,e,o){const n=Math.cos(o),i=Math.sin(o),r=e.x,f=e.y;return{x:r+n*(t.x-r)-i*(t.y-f),y:f+i*(t.x-r)+n*(t.y-f)}}function E(t,o,n){return o="number"==typeof o?o:t.parse(o),e.isFinite(o)?t.getPixelForValue(o):n}function Y(t,e){if(t){const o=E(t,e.min,e.start),n=E(t,e.max,e.end);return{start:Math.min(o,n),end:Math.max(o,n)}}return{start:e.start,end:e.end}}function X(t,e){const{chartArea:o,scales:n}=t,i=n[e.xScaleID],r=n[e.yScaleID];let f=o.width/2,k=o.height/2;return i&&(f=E(i,e.xValue,f)),r&&(k=E(r,e.yValue,k)),{x:f,y:k}}function V(t,e){const o=t.scales[e.xScaleID],n=t.scales[e.yScaleID];let{top:i,left:r,bottom:f,right:k}=t.chartArea;if(!o&&!n)return{};const q=Y(o,{min:e.xMin,max:e.xMax,start:r,end:k});r=q.start,k=q.end;const Q=Y(n,{min:e.yMin,max:e.yMax,start:i,end:f});return i=Q.start,f=Q.end,{x:r,y:i,x2:k,y2:f,width:k-r,height:f-i}}function H(t,e){if(!M(e)){const o=V(t,e),n=R(o);let i=e.radius;return i&&!isNaN(i)||(i=Math.min(o.width,o.height)/2,e.radius=i),{x:n.x+e.xAdjust,y:n.y+e.yAdjust,width:2*i,height:2*i}}return function(t,e){const o=X(t,e);return{x:o.x+e.xAdjust,y:o.y+e.yAdjust,width:2*e.radius,height:2*e.radius}}(t,e)}class L extends t.Element{inRange(t,o,n){const{x:i,y:r}=T({x:t,y:o},this.getCenterPoint(n),e.toRadians(-this.options.rotation));return y(i,r,this.getProps(["x","y","width","height"],n),this.options.borderWidth)}getCenterPoint(t){return R(this.getProps(["x","y","width","height"],t))}draw(t){t.save(),D(t,this,this.options.rotation),I(t,this,this.options),t.restore()}drawLabel(t){const{x:o,y:n,width:i,height:r,options:f}=this,{label:k,borderWidth:q}=f,Q=q/2,st=C(k.position),lt=e.toPadding(k.padding),ht=A(t,k),wt={x:N(this,ht,st,lt),y:_(this,ht,st,lt),width:ht.width,height:ht.height};t.save(),D(t,this,k.rotation),t.beginPath(),t.rect(o+Q+lt.left,n+Q+lt.top,i-q-lt.width,r-q-lt.height),t.clip(),W(t,wt,k),t.restore()}resolveElementProperties(t,e){return V(t,e)}}function N(t,e,o,n){const{x:i,x2:r,width:f,options:k}=t,{xAdjust:q,borderWidth:Q}=k.label;return z({start:i,end:r,size:f},{position:o.x,padding:{start:n.left,end:n.right},adjust:q,borderWidth:Q,size:e.width})}function _(t,e,o,n){const{y:i,y2:r,height:f,options:k}=t,{yAdjust:q,borderWidth:Q}=k.label;return z({start:i,end:r,size:f},{position:o.y,padding:{start:n.top,end:n.bottom},adjust:q,borderWidth:Q,size:e.height})}function z(t,e){const{start:o,end:n}=t,{position:i,padding:{start:r,end:f},adjust:k,borderWidth:q}=e;return o+q/2+k+r+v(n-q-o-r-f-e.size,i)}L.id="boxAnnotation",L.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:1,cornerRadius:void 0,display:!0,label:{borderWidth:void 0,color:"black",content:null,drawTime:void 0,enabled:!1,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,padding:6,position:"center",rotation:void 0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,xAdjust:0,yAdjust:0,width:void 0},rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:"x",yMax:void 0,yMin:void 0,yScaleID:"y"},L.defaultRoutes={borderColor:"color",backgroundColor:"color"},L.descriptors={label:{_fallback:!0}};const B=(t,e,o)=>({x:t.x+o*(e.x-t.x),y:t.y+o*(e.y-t.y)}),$=(t,e,o)=>B(e,o,Math.abs((t-e.y)/(o.y-e.y))).x,F=(t,e,o)=>B(e,o,Math.abs((t-e.x)/(o.x-e.x))).y,J=t=>t*t,k=.001;function U({x:t,y:e,x2:o,y2:n},{top:i,right:r,bottom:f,left:k}){return!(t<k&&o<k||t>r&&o>r||e<i&&n<i||e>f&&n>f)}function G({x:t,y:e},o,{top:n,right:i,bottom:r,left:f}){return t<f&&(e=F(f,{x:t,y:e},o),t=f),t>i&&(e=F(i,{x:t,y:e},o),t=i),e<n&&(t=$(n,{x:t,y:e},o),e=n),e>r&&(t=$(r,{x:t,y:e},o),e=r),{x:t,y:e}}class K extends t.Element{intersects(t,e,o=.001,n){const{x:i,y:r,x2:f,y2:k}=this.getProps(["x","y","x2","y2"],n),q=f-i,Q=k-r,st=J(q)+J(Q),lt=0===st?-1:((t-i)*q+(e-r)*Q)/st;let ht,wt;return lt<0?(ht=i,wt=r):lt>1?(ht=f,wt=k):(ht=i+lt*q,wt=r+lt*Q),J(t-ht)+J(e-wt)<=o}labelIsVisible(t,e){const o=this.options.label;return!(!o||!o.enabled)&&(!e||U(this.getProps(["x","y","x2","y2"],t),e))}isOnLabel(t,e,o){if(!this.labelIsVisible(o))return!1;const{labelX:n,labelY:i,labelWidth:r,labelHeight:f,labelRotation:q}=this.getProps(["labelX","labelY","labelWidth","labelHeight","labelRotation"],o),{x:Q,y:st}=T({x:t,y:e},{x:n,y:i},-q),lt=this.options.label.borderWidth/2||0,ht=r/2+lt,wt=f/2+lt;return Q>=n-ht-k&&Q<=n+ht+k&&st>=i-wt-k&&st<=i+wt+k}inRange(t,e,o){const n=J(this.options.borderWidth/2);return this.intersects(t,e,n,o)||this.isOnLabel(t,e,o)}getCenterPoint(){return{x:(this.x2+this.x)/2,y:(this.y2+this.y)/2}}draw(t){const{x:e,y:o,x2:n,y2:i,options:r}=this;if(t.save(),!O(t,r))return t.restore();j(t,r);const f=Math.atan2(i-o,n-e),k=Math.sqrt(Math.pow(n-e,2)+Math.pow(i-o,2)),{startOpts:q,endOpts:Q,startAdjust:st,endAdjust:lt}=function(t){const e=t.options,o=e.arrowHeads&&e.arrowHeads.start,n=e.arrowHeads&&e.arrowHeads.end;return{startOpts:o,endOpts:n,startAdjust:et(t,o),endAdjust:et(t,n)}}(this);t.translate(e,o),t.rotate(f),t.beginPath(),t.moveTo(0+st,0),t.lineTo(k-lt,0),t.shadowColor=r.borderShadowColor,t.stroke(),ot(t,0,st,q),ot(t,k,-lt,Q),t.restore()}drawLabel(t,e){if(!this.labelIsVisible(!1,e))return;const{labelX:o,labelY:n,labelWidth:i,labelHeight:r,labelRotation:f,labelPadding:k,labelTextSize:q,options:{label:Q}}=this;t.save(),t.translate(o,n),t.rotate(f),I(t,{x:-i/2,y:-r/2,width:i,height:r},Q),W(t,{x:-i/2+k.left+Q.borderWidth/2,y:-r/2+k.top+Q.borderWidth/2,width:q.width,height:q.height},Q),t.restore()}resolveElementProperties(t,o){const n=t.scales[o.scaleID];let i,r,{top:f,left:k,bottom:q,right:Q}=t.chartArea;if(n)i=E(n,o.value,NaN),r=E(n,o.endValue,i),n.isHorizontal()?(k=i,Q=r):(f=i,q=r);else{const e=t.scales[o.xScaleID],n=t.scales[o.yScaleID];e&&(k=E(e,o.xMin,k),Q=E(e,o.xMax,Q)),n&&(f=E(n,o.yMin,f),q=E(n,o.yMax,q))}const st=U({x:k,y:f,x2:Q,y2:q},t.chartArea)?function(t,e,o){const{x:n,y:i}=G(t,e,o),{x:r,y:f}=G(e,t,o);return{x:n,y:i,x2:r,y2:f,width:Math.abs(r-n),height:Math.abs(f-i)}}({x:k,y:f},{x:Q,y:q},t.chartArea):{x:k,y:f,x2:Q,y2:q,width:Math.abs(Q-k),height:Math.abs(q-f)},lt=o.label;return lt&&lt.content?function(t,o,n){const{padding:i,xPadding:r,yPadding:f,borderWidth:k}=n,q=function(t,o,n){let i=t;return(o||n)&&(i={x:o||6,y:n||6}),e.toPadding(i)}(i,r,f),Q=A(o.ctx,n),st=function(t,o,n,i){const{width:r,height:f,padding:k}=n,{xAdjust:q,yAdjust:Q}=o,st={x:t.x,y:t.y},lt={x:t.x2,y:t.y2},ht="auto"===o.rotation?function(t){const{x:o,y:n,x2:i,y2:r}=t,f=Math.atan2(r-n,i-o);return f>e.PI/2?f-e.PI:f<e.PI/-2?f+e.PI:f}(t):e.toRadians(o.rotation),wt=function(t,e,o){const n=Math.cos(o),i=Math.sin(o);return{w:Math.abs(t*n)+Math.abs(e*i),h:Math.abs(t*i)+Math.abs(e*n)}}(r,f,ht),mt=function(t,e,o,n){let i;const r=function(t,e){const{x:o,x2:n,y:i,y2:r}=t,f=Math.min(i,r)-e.top,k=Math.min(o,n)-e.left,q=e.bottom-Math.max(i,r),Q=e.right-Math.max(o,n);return{x:Math.min(k,Q),y:Math.min(f,q),dx:k<=Q?1:-1,dy:f<=q?1:-1}}(t,n);return i="start"===e.position?Z({w:t.x2-t.x,h:t.y2-t.y},o,e,r):"end"===e.position?1-Z({w:t.x-t.x2,h:t.y-t.y2},o,e,r):v(1,e.position),i}(t,o,{labelSize:wt,padding:k},i),Ct=B(st,lt,mt),Mt={size:wt.w,min:i.left,max:i.right,padding:k.left},kt={size:wt.h,min:i.top,max:i.bottom,padding:k.top};return{x:tt(Ct.x,Mt)+q,y:tt(Ct.y,kt)+Q,width:r,height:f,rotation:ht}}(t,n,{width:Q.width+q.width+k,height:Q.height+q.height+k,padding:q},o.chartArea);return t.labelX=st.x,t.labelY=st.y,t.labelWidth=st.width,t.labelHeight=st.height,t.labelRotation=st.rotation,t.labelPadding=q,t.labelTextSize=Q,t}(st,t,lt):st}}K.id="lineAnnotation";const q={backgroundColor:void 0,backgroundShadowColor:void 0,borderColor:void 0,borderDash:void 0,borderDashOffset:void 0,borderShadowColor:void 0,borderWidth:void 0,enabled:void 0,fill:void 0,length:void 0,shadowBlur:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,width:void 0};function Z(t,e,o,n){const{labelSize:i,padding:r}=e,f=t.w*n.dx,k=t.h*n.dy,q=f>0&&(i.w/2+r.left-n.x)/f,Q=k>0&&(i.h/2+r.top-n.y)/k;return b(Math.max(q,Q),0,.25)}function tt(t,e){const{size:o,min:n,max:i,padding:r}=e,f=o/2;return o>i-n?(i+n)/2:(n>=t-r-f&&(t=n+r+f),i<=t+r+f&&(t=i-r-f),t)}function et(t,e){if(!e||!e.enabled)return 0;const{length:o,width:n}=e,i=t.options.borderWidth/2,r={x:o,y:n+i},f={x:0,y:i};return Math.abs($(0,r,f))}function ot(t,e,o,n){if(!n||!n.enabled)return;const{length:i,width:r,fill:f,backgroundColor:k,borderColor:q}=n,Q=Math.abs(e-i)+o;t.beginPath(),j(t,n),O(t,n),t.moveTo(Q,-r),t.lineTo(e+o,0),t.lineTo(Q,r),!0===f?(t.fillStyle=k||q,t.closePath(),t.fill(),t.shadowColor="transparent"):t.shadowColor=n.borderShadowColor,t.stroke()}K.defaults={adjustScaleRange:!0,arrowHeads:{enabled:!1,end:Object.assign({},q),fill:!1,length:12,start:Object.assign({},q),width:6},borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:2,display:!0,endValue:void 0,label:{backgroundColor:"rgba(0,0,0,0.8)",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderColor:"black",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:6,borderShadowColor:"transparent",borderWidth:0,color:"#fff",content:null,cornerRadius:void 0,drawTime:void 0,enabled:!1,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,padding:6,position:"center",rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,xPadding:void 0,yAdjust:0,yPadding:void 0},scaleID:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,value:void 0,xMax:void 0,xMin:void 0,xScaleID:"x",yMax:void 0,yMin:void 0,yScaleID:"y"},K.descriptors={arrowHeads:{start:{_fallback:!0},end:{_fallback:!0},_fallback:!0}},K.defaultRoutes={borderColor:"color"};class nt extends t.Element{inRange(t,o,n){return function(t,o,n,i){const{width:r,height:f}=o,k=o.getCenterPoint(!0),q=r/2,Q=f/2;if(q<=0||Q<=0)return!1;const st=e.toRadians(n||0),lt=i/2||0,ht=Math.cos(st),wt=Math.sin(st),mt=Math.pow(ht*(t.x-k.x)+wt*(t.y-k.y),2),Ct=Math.pow(wt*(t.x-k.x)-ht*(t.y-k.y),2);return mt/Math.pow(q+lt,2)+Ct/Math.pow(Q+lt,2)<=1.0001}({x:t,y:o},this.getProps(["width","height"],n),this.options.rotation,this.options.borderWidth)}getCenterPoint(t){return R(this.getProps(["x","y","width","height"],t))}draw(t){const{width:o,height:n,options:i}=this,r=this.getCenterPoint();t.save(),D(t,this,i.rotation),j(t,this.options),t.beginPath(),t.fillStyle=i.backgroundColor;const f=O(t,i);t.ellipse(r.x,r.y,n/2,o/2,e.PI/2,0,2*e.PI),t.fill(),f&&(t.shadowColor=i.borderShadowColor,t.stroke()),t.restore()}resolveElementProperties(t,e){return V(t,e)}}nt.id="ellipseAnnotation",nt.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:"x",yMax:void 0,yMin:void 0,yScaleID:"y"},nt.defaultRoutes={borderColor:"color",backgroundColor:"color"};class it extends t.Element{inRange(t,o,n){const{x:i,y:r}=T({x:t,y:o},this.getCenterPoint(n),e.toRadians(-this.options.rotation));return y(i,r,this.getProps(["x","y","width","height"],n),this.options.borderWidth)}getCenterPoint(t){return R(this.getProps(["x","y","width","height"],t))}draw(t){if(!this.options.content)return;const{labelX:o,labelY:n,labelWidth:i,labelHeight:r,options:f}=this;t.save(),D(t,this,f.rotation),function(t,o){const{pointX:n,pointY:i,calloutPosition:r,options:f}=o;if(!r||o.inRange(n,i))return;const k=f.callout;if(t.save(),t.beginPath(),!O(t,k))return t.restore();const{separatorStart:q,separatorEnd:Q}=function(t,e){const{x:o,y:n,width:i,height:r}=t,f=function(t,e){const{width:o,height:n,options:i}=t,r=i.callout.margin+i.borderWidth/2;return"right"===e?o+r:"bottom"===e?n+r:-r}(t,e);let k,q;return"left"===e||"right"===e?(k={x:o+f,y:n},q={x:k.x,y:k.y+r}):(k={x:o,y:n+f},q={x:k.x+i,y:k.y}),{separatorStart:k,separatorEnd:q}}(o,r),{sideStart:st,sideEnd:lt}=function(t,e,o){const{y:n,width:i,height:r,options:f}=t,k=f.callout.start,q=function(t,e){const o=e.side;return"left"===t||"top"===t?-o:o}(e,f.callout);let Q,st;return"left"===e||"right"===e?(Q={x:o.x,y:n+S(r,k)},st={x:Q.x+q,y:Q.y}):(Q={x:o.x+S(i,k),y:o.y},st={x:Q.x,y:Q.y+q}),{sideStart:Q,sideEnd:st}}(o,r,q);(k.margin>0||0===f.borderWidth)&&(t.moveTo(q.x,q.y),t.lineTo(Q.x,Q.y)),t.moveTo(st.x,st.y),t.lineTo(lt.x,lt.y);const ht=T({x:n,y:i},o.getCenterPoint(),e.toRadians(-f.rotation));t.lineTo(ht.x,ht.y),t.stroke(),t.restore()}(t,this),I(t,this,f),W(t,{x:o,y:n,width:i,height:r},f),t.restore()}resolveElementProperties(t,o){const n=M(o)?X(t,o):R(V(t,o)),i=e.toPadding(o.padding),r=A(t.ctx,o),f=function(t,e,o,n){const i=e.width+n.width+o.borderWidth,r=e.height+n.height+o.borderWidth,f=C(o.position);return{x:rt(t.x,i,o.xAdjust,f.x),y:rt(t.y,r,o.yAdjust,f.y),width:i,height:r}}(n,r,o,i),k=o.borderWidth/2,q={pointX:n.x,pointY:n.y,...f,labelX:f.x+i.left+k,labelY:f.y+i.top+k,labelWidth:r.width,labelHeight:r.height};return q.calloutPosition=o.callout.enabled&&function(t,o,n){const i=o.position;return"left"===i||"right"===i||"top"===i||"bottom"===i?i:function(t,o,n){const{x:i,y:r,width:f,height:k,pointX:q,pointY:st}=t,lt={x:i+f/2,y:r+k/2},ht=o.start,wt=S(f,ht),mt=S(k,ht),Ct=[i,i+wt,i+wt,i+f],Mt=[r+mt,r+k,r,r+mt],kt=[];for(let Dt=0;Dt<4;Dt++){const t=T({x:Ct[Dt],y:Mt[Dt]},lt,e.toRadians(n));kt.push({position:Q[Dt],distance:e.distanceBetweenPoints(t,{x:q,y:st})})}return kt.sort((t,e)=>t.distance-e.distance)[0].position}(t,o,n)}(q,o.callout,o.rotation),q}}function rt(t,e,o=0,n){return t-v(e,n)+o}it.id="labelAnnotation",it.defaults={adjustScaleRange:!0,backgroundColor:"transparent",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:0,callout:{borderCapStyle:"butt",borderColor:void 0,borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:1,enabled:!1,margin:5,position:"auto",side:5,start:"50%"},color:"black",content:null,display:!0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:void 0},height:void 0,padding:6,position:"center",rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:"x",xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:"y",yValue:void 0},it.defaultRoutes={borderColor:"color"};const Q=["left","bottom","top","right"];class at extends t.Element{inRange(t,e,o){const{width:n}=this.getProps(["width"],o);return function(t,e,o,n){if(!t||!e||o<=0)return!1;const i=n/2||0;return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<=Math.pow(o+i,2)}({x:t,y:e},this.getCenterPoint(o),n/2,this.options.borderWidth)}getCenterPoint(t){return p(this,t)}draw(t){const o=this.options,n=o.borderWidth;if(o.radius<.1)return;t.save(),t.fillStyle=o.backgroundColor,j(t,o);const i=O(t,o);o.borderWidth=0,e.drawPoint(t,o,this.x,this.y),i&&!P(o.pointStyle)&&(t.shadowColor=o.borderShadowColor,t.stroke()),t.restore(),o.borderWidth=n}resolveElementProperties(t,e){return H(t,e)}}at.id="pointAnnotation",at.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,pointStyle:"circle",radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:"x",xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:"y",yValue:void 0},at.defaultRoutes={borderColor:"color",backgroundColor:"color"};class dt extends t.Element{inRange(t,e,o){return this.options.radius>=.1&&this.elements.length>1&&function(t,e,o,n){let i=!1,r=t[t.length-1].getProps(["bX","bY"],n);for(const f of t){const t=f.getProps(["bX","bY"],n);t.bY>o!=r.bY>o&&e<(r.bX-t.bX)*(o-t.bY)/(r.bY-t.bY)+t.bX&&(i=!i),r=t}return i}(this.elements,t,e,o)}getCenterPoint(t){return p(this,t)}draw(t){const{elements:e,options:o}=this;t.save(),t.beginPath(),t.fillStyle=o.backgroundColor,j(t,o);const n=O(t,o);let i=!0;for(const r of e)i?(t.moveTo(r.x,r.y),i=!1):t.lineTo(r.x,r.y);t.closePath(),t.fill(),n&&(t.shadowColor=o.borderShadowColor,t.stroke()),t.restore()}resolveElementProperties(t,o){const{x:n,y:i,width:r,height:f}=H(t,o),{sides:k,radius:q,rotation:Q,borderWidth:st}=o,lt=st/2,ht=[],wt=2*e.PI/k;let mt=Q*e.RAD_PER_DEG;for(let e=0;e<k;e++,mt+=wt){const t=Math.sin(mt),e=Math.cos(mt);ht.push({type:"point",optionScope:"point",properties:{x:n+t*q,y:i-e*q,bX:n+t*(q+lt),bY:i-e*(q+lt)}})}return{x:n,y:i,width:r,height:f,elements:ht,initProperties:{x:n,y:i}}}}dt.id="polygonAnnotation",dt.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderShadowColor:"transparent",borderWidth:1,display:!0,point:{radius:0},radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,sides:3,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:"x",xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:"y",yValue:void 0},dt.defaultRoutes={borderColor:"color",backgroundColor:"color"};const st={box:L,ellipse:nt,label:it,line:K,point:at,polygon:dt};Object.keys(st).forEach(e=>{t.defaults.describe(`elements.${st[e].id}`,{_fallback:"plugins.annotation"})});const lt={update:Object.assign};function ct(t="line"){return st[t]?t:(console.warn(`Unknown annotation type: '${t}', defaulting to 'line'`),"line")}function ut(o,n,i,r){const f=function(e,o,n){return"reset"===n||"none"===n||"resize"===n?lt:new t.Animations(e,o)}(o,i.animations,r),k=n.annotations,q=function(t,e){const o=e.length,n=t.length;if(n<o){const e=o-n;t.splice(n,0,...new Array(e))}else n>o&&t.splice(o,n-o);return t}(n.elements,k);for(let t=0;t<k.length;t++){const n=k[t],i=xt(q,t,n.type),r=n.setContext(gt(o,i,n)),Q=i.resolveElementProperties(o,r);Q.skip=ft(Q),"elements"in Q&&(bt(i,Q,r,f),delete Q.elements),e.defined(i.x)||Object.assign(i,Q),Q.options=yt(r),f.update(i,Q)}}function ft(t){return isNaN(t.x)||isNaN(t.y)}function bt(t,{elements:e,initProperties:o},n,i){const r=t.elements||(t.elements=[]);r.length=e.length;for(let f=0;f<e.length;f++){const t=e[f],k=t.properties,q=xt(r,f,t.type,o),Q=n[t.optionScope].override(t);k.options=yt(Q),i.update(q,k)}}function xt(t,o,n,i){const r=st[ct(n)];let f=t[o];return f&&f instanceof r||(f=t[o]=new r,e.isObject(i)&&Object.assign(f,i)),f}function yt(t){const e=st[ct(t.type)],o={};o.id=t.id,o.type=t.type,o.drawTime=t.drawTime,Object.assign(o,pt(t,e.defaults),pt(t,e.defaultRoutes));for(const n of i)o[n]=t[n];return o}function pt(t,o){const n={};for(const i of Object.keys(o)){const r=o[i],f=t[i];n[i]=e.isObject(r)?pt(f,r):f}return n}function gt(t,e,o){return e.$context||(e.$context=Object.assign(Object.create(t.getContext()),{element:e,id:o.id,type:"annotation"}))}const ht=new Map;var wt={id:"annotation",version:"1.4.0",afterRegister(){t.Chart.register(st),function(t,e,o,n=!0){const i=o.split(".");let r=0;for(const f of e.split(".")){const k=i[r++];if(parseInt(f,10)<parseInt(k,10))break;if(g(k,f)){if(n)throw new Error(`${t} v${o} is not supported. v${e} or newer is required.`);return!1}}return!0}("chart.js","3.7",t.Chart.version,!1)||(console.warn("chartjs-plugin-annotation has known issues with chart.js versions prior to 3.7, please consider upgrading."),t.Chart.defaults.set("elements.lineAnnotation",{callout:{},font:{},padding:6}))},afterUnregister(){t.Chart.unregister(st)},beforeInit(t){ht.set(t,{annotations:[],elements:[],visibleElements:[],listeners:{},listened:!1,moveListened:!1})},beforeUpdate(t,o,n){const i=ht.get(t).annotations=[];let r=n.annotations;e.isObject(r)?Object.keys(r).forEach(t=>{const o=r[t];e.isObject(o)&&(o.id=t,i.push(o))}):e.isArray(r)&&i.push(...r),function(t,e){for(const o of t)h(o,e)}(i,t.scales)},afterDataLimits(t,e){const o=ht.get(t);d(0,e.scale,o.annotations.filter(t=>t.display&&t.adjustScaleRange))},afterUpdate(t,r,f){const k=ht.get(t);!function(t,r,f){r.listened=!1,r.moveListened=!1,i.forEach(t=>{"function"==typeof f[t]?(r.listened=!0,r.listeners[t]=f[t]):e.defined(r.listeners[t])&&delete r.listeners[t]}),n.forEach(t=>{"function"==typeof f[t]&&(r.moveListened=!0)}),r.listened&&r.moveListened||r.annotations.forEach(t=>{r.listened||o.forEach(e=>{"function"==typeof t[e]&&(r.listened=!0)}),r.moveListened||n.forEach(e=>{"function"==typeof t[e]&&(r.listened=!0,r.moveListened=!0)})})}(0,k,f),ut(t,k,f,r.mode),k.visibleElements=k.elements.filter(t=>!t.skip&&t.options.display)},beforeDatasetsDraw(t,e,o){vt(t,"beforeDatasetsDraw",o.clip)},afterDatasetsDraw(t,e,o){vt(t,"afterDatasetsDraw",o.clip)},beforeDraw(t,e,o){vt(t,"beforeDraw",o.clip)},afterDraw(t,e,o){vt(t,"afterDraw",o.clip)},beforeEvent(t,e,o){!function(t,e,o){if(t.listened)switch(e.type){case"mousemove":case"mouseout":!function(t,e){if(!t.moveListened)return;let o;"mousemove"===e.type&&(o=a(t.elements,e));const n=t.hovered;t.hovered=o,function(t,e,o){const{previous:n,element:i}=e;n&&n!==i&&s(n.options.leave||t.listeners.leave,n,o),i&&i!==n&&s(i.options.enter||t.listeners.enter,i,o)}(t,{previous:n,element:o},e)}(t,e);break;case"click":!function(t,e,o){const n=t.listeners,i=a(t.elements,e);if(i){const t=i.options,r=t.dblclick||n.dblclick,f=t.click||n.click;i.clickTimeout?(clearTimeout(i.clickTimeout),delete i.clickTimeout,s(r,i,e)):r?i.clickTimeout=setTimeout(()=>{delete i.clickTimeout,s(f,i,e)},o.dblClickSpeed):s(f,i,e)}}(t,e,o)}}(ht.get(t),e.event,o)},destroy(t){ht.delete(t)},_getState:t=>ht.get(t),defaults:{animations:{numbers:{properties:["x","y","x2","y2","width","height","pointX","pointY","labelX","labelY","labelWidth","labelHeight","radius"],type:"number"}},clip:!0,dblClickSpeed:350,drawTime:"afterDatasetsDraw",label:{drawTime:null}},descriptors:{_indexable:!1,_scriptable:t=>!i.includes(t),annotations:{_allKeys:!1,_fallback:(t,e)=>`elements.${st[ct(e.type)].id}`}},additionalOptionScopes:[""]};function vt(t,o,n){const{ctx:i,chartArea:r}=t,{visibleElements:f}=ht.get(t);n&&e.clipArea(i,r),St(i,f,o),function(t,o,n){for(const i of o)e.isArray(i.elements)&&St(t,i.elements,n)}(i,f,o),n&&e.unclipArea(i),f.forEach(t=>{if(!("drawLabel"in t))return;const e=t.options.label;e&&e.enabled&&e.content&&(e.drawTime||t.options.drawTime)===o&&t.drawLabel(i,r)})}function St(t,e,o){for(const n of e)n.options.drawTime===o&&n.draw(t)}return t.Chart.register(wt),wt});