export class MultiLineInterpreter{constructor(){this.interpretationRules={1:"single",2:"dual",3:"triple",4:"hexagram",5:"hexagram",6:"total"},this.mainLinePriority={default:[5,"lowest"],upperFirst:["highest",5],balanced:["middle"]}}interpretMultipleChanges(e,t,i,n="default"){const r=t.length;switch(this.interpretationRules[r]){case"single":return this.interpretSingleLine(e,t[0]);case"dual":case"triple":default:return this.interpretMainLine(e,t,i,n);case"hexagram":return this.interpretHexagramFocus(e,i,t);case"total":return this.interpretTotalTransformation(e,i)}}interpretSingleLine(e,t){const i=this.getLineData(e,t);return{focus:"line",primaryLine:t,interpretation:`第${t}爻が示す「${i.keyword}」が中心的メッセージ。`,detail:i.description,emphasis:"この爻の指示に従うことが重要",guidance:this.generateLineGuidance(t,i),confidence:.95}}interpretMainLine(e,t,i,n="default"){const r=this.selectMainLine(t,n),a=t.filter(e=>e!==r),s=this.getLineData(e,r),o=a.map(t=>this.getLineData(e,t));return{focus:"main_line_with_support",primaryLine:r,secondaryLines:a,interpretation:`第${r}爻「${s.keyword}」を中心に、${a.join("・")}爻が補助的に作用。`,mainMessage:s.description,supportMessages:o.map(e=>e.description),toHex:i,emphasis:"主爻の方向性を軸に、他の爻が状況を修飾",guidance:this.generateMultiLineGuidance(s,o),confidence:.8}}interpretHexagramFocus(e,t,i){const n=this.getHexagramData(e),r=this.getHexagramData(t);return{focus:"hexagram_transition",fromHex:e,toHex:t,changedLines:i,interpretation:`${i.length}本の変爻により、${n.name}から${r.name}への大きな変化。本卦の全体的メッセージから之卦の方向性への移行が重要。`,fromMeaning:n.meaning,toMeaning:r.meaning,transitionAdvice:this.generateTransitionAdvice(n,r),linesSummary:"個々の爻辞は参考程度に留める",emphasis:"卦の大局的変化に注目",confidence:.7}}interpretTotalTransformation(e,t){const i=this.getHexagramData(e),n=this.getHexagramData(t);return{focus:"complete_reversal",fromHex:e,toHex:t,interpretation:`全爻が変化する完全な転換。${i.name}から${n.name}への根本的な反転。現状の完全な逆転・革命的変化を示す。`,warning:"極めて稀な状況。慎重な判断が必要。",guidance:"根本的な価値観や方向性の見直しが求められています",philosophicalMeaning:this.getPhilosophicalMeaning(e,t),emphasis:"根本的な価値観・方向性の転換",confidence:.9}}selectMainLine(e,t="default"){const i=this.mainLinePriority[t]||this.mainLinePriority.default;for(const n of i){if(5===n&&e.includes(5))return 5;if("lowest"===n)return Math.min(...e);if("highest"===n)return Math.max(...e);if("middle"===n){return e[Math.floor(e.length/2)]}}return e[0]}getLineData(e,t){if("undefined"!=typeof window&&window.H384_DATA){const i=window.H384_DATA.find(i=>i["卦番号"]===e&&i["爻位"]===t);if(i)return{keyword:i["キーワード"]||`第${t}爻`,description:i["現代解釈の要約"]||"変化の兆し",action:i["行動指針"]||"慎重に進む"}}return{keyword:this.getDefaultLineKeyword(t),description:this.getDefaultLineDescription(e,t),action:this.getDefaultLineAction(t)}}getHexagramData(e){return{name:{1:"乾為天",2:"坤為地",11:"地天泰",12:"天地否",63:"水火既済",64:"火水未済"}[e]||`第${e}卦`,meaning:this.getHexagramMeaning(e)}}getDefaultLineKeyword(e){return{1:"潜在",2:"内省",3:"決断",4:"進展",5:"統率",6:"極限"}[e]||`第${e}爻`}getDefaultLineDescription(e,t){return`卦${e}の第${t}爻における変化の意味`}getDefaultLineAction(e){return{1:"慎重に準備を進める",2:"内面を見つめ直す",3:"勇気を持って踏み出す",4:"着実に前進する",5:"全体を統括する",6:"新たな転換に備える"}[e]||"状況を見極めて行動する"}getHexagramMeaning(e){return{1:"創造と力強さ",2:"受容と柔軟性",11:"調和と繁栄",12:"停滞と困難",63:"完成と安定",64:"未完と可能性"}[e]||"変化と発展"}generateLineGuidance(e,t){return`${t.keyword}の段階において、${t.action}ことが重要です。`}generateMultiLineGuidance(e,t){const i=t.map(e=>e.keyword).join("・");return`${e.keyword}を中心に、${i}の要素も考慮しながら進めましょう。`}generateTransitionAdvice(e,t){return`${e.meaning}から${t.meaning}への移行期にあります。大きな視点で変化を受け入れることが大切です。`}getPhilosophicalMeaning(e,t){return 1===e&&2===t?"純陽から純陰への完全な転換。積極性から受容性への根本的な変化。":2===e&&1===t?"純陰から純陽への完全な転換。受容性から積極性への根本的な変化。":"陰陽の完全な反転。物事の根本的な転換期。"}}