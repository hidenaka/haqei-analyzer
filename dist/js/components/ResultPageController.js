class ResultPageController{constructor(){this.name="ResultPageController",this.version="2.0.0",this.analysisData=null,this.charts={},this.initialized=!1,console.log("ğŸ¯ ResultPageController v2.0.0 initializing...")}async initialize(){try{return console.log("ğŸ”„ Initializing ResultPageController..."),"undefined"==typeof Chart&&(console.warn("âš ï¸ Chart.js not loaded, loading now..."),await this.loadChartJS()),await this.initializeComponents(),this.initialized=!0,console.log("âœ… ResultPageController initialized"),!0}catch(e){return console.error("âŒ ResultPageController initialization failed:",e),!1}}async loadChartJS(){return new Promise((e,t)=>{const a=document.createElement("script");a.src="/js/lib/chart.min.js",a.onload=()=>{console.log("âœ… Chart.js loaded"),e()},a.onerror=t,document.head.appendChild(a)})}async initializeComponents(){console.log("ğŸ“¦ Initializing components...")}async displayResults(e){try{console.log("ğŸ¨ Displaying analysis results..."),this.analysisData=e,await this.loadH384Data(e);const t=document.getElementById("resultArea");t&&(t.style.display="block"),await this.updateCurrentPosition(e),await this.updateScores(e),await this.renderCurrentGraph(e),await this.updateIChingInterpretation(e),await this.renderFutureBranchingGraph(e),await this.updateThemeBoxes(e),await this.renderEightScenarios(e),console.log("âœ… Results displayed successfully")}catch(t){console.error("âŒ Failed to display results:",t)}}async loadH384Data(e){try{if("undefined"==typeof H384_DATA&&(console.warn("âš ï¸ H384_DATA not loaded, loading now..."),await this.loadH384Database()),e.currentHexagram&&e.currentYao){const t=e.currentHexagram.number||1,a=7*(t-1)+(e.currentYao.position||1),r=H384_DATA.find(e=>e["é€šã—ç•ªå·"]===a);r?(e.h384Data=r,e.overallScore=r["S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢"]||50,e.currentGraph={basic:r["S1_åŸºæœ¬ã‚¹ã‚³ã‚¢"]||50,potential:r["S2_ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«"]||50,stability:r["S3_å®‰å®šæ€§ã‚¹ã‚³ã‚¢"]||50,risk:Math.abs(r["S4_ãƒªã‚¹ã‚¯"]||-35),volatility:r["S6_å¤‰å‹•æ€§ã‚¹ã‚³ã‚¢"]||50},e.currentHexagram.name||(e.currentHexagram.name=r["å¦å"]),e.currentYao.name||(e.currentYao.name=r["çˆ»"]),e.keywords=r["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||[],e.modernInterpretation=r["ç¾ä»£è§£é‡ˆã®è¦ç´„"]||"",console.log("âœ… H384 data loaded:",r)):console.warn(`âš ï¸ No H384 data found for serial number: ${a}`)}}catch(t){console.error("âŒ Failed to load H384 data:",t)}}async loadH384Database(){return new Promise((e,t)=>{const a=document.createElement("script");a.src="/assets/H384H64database.js",a.onload=()=>{console.log("âœ… H384 database loaded"),e()},a.onerror=t,document.head.appendChild(a)})}async updateCurrentPosition(e){try{const t=document.getElementById("currentHexagramInfo"),a=document.getElementById("currentThemeDescription");if(e.h384Data){const r=e.h384Data["å¦å"]||"ä¹¾ç‚ºå¤©",n=e.h384Data["çˆ»"]||"åˆçˆ»",o=e.h384Data["ç¾ä»£è§£é‡ˆã®è¦ç´„"]||"";t&&(t.textContent=`${r} ${n}`),a&&(a.innerHTML=`<p>${o}</p>`)}}catch(t){console.error("âŒ Failed to update current position:",t)}}async updateScores(e){try{const t=document.getElementById("overall-score"),a=document.getElementById("overall-label");if(t&&void 0!==e.overallScore&&(t.textContent=Math.round(e.overallScore),a)){const t=this.getScoreLabel(e.overallScore);a.textContent=`ç‚¹ ${t}`}const r=document.getElementById("transition-score"),n=document.getElementById("transition-label");let o=e.transitionCost;if(e.h384Data&&void 0!==e.h384Data["S6_å¤‰å‹•æ€§ã‚¹ã‚³ã‚¢"]&&(o=e.h384Data["S6_å¤‰å‹•æ€§ã‚¹ã‚³ã‚¢"]),r&&void 0!==o&&(r.textContent=Math.round(o),n)){const e=this.getTransitionLabel(o);n.textContent=`ç‚¹ ${e}`}}catch(t){console.error("âŒ Failed to update scores:",t)}}async renderCurrentGraph(e){try{const t=document.getElementById("currentPositionChart");if(!t)return;const a=t.getContext("2d");this.charts.currentPosition&&this.charts.currentPosition.destroy(),Chart.getChart(t)?.destroy();const r={labels:["åŸºæœ¬","æ½œåœ¨åŠ›","å®‰å®šæ€§","ãƒªã‚¹ã‚¯","å¤‰å‹•æ€§"],datasets:[{data:[e.currentGraph?.basic||60,e.currentGraph?.potential||80,e.currentGraph?.stability||40,e.currentGraph?.risk||70,e.currentGraph?.volatility||90],backgroundColor:["rgba(59, 130, 246, 0.7)","rgba(16, 185, 129, 0.7)","rgba(251, 191, 36, 0.7)","rgba(239, 68, 68, 0.7)","rgba(139, 92, 246, 0.7)"],borderColor:["rgba(59, 130, 246, 1)","rgba(16, 185, 129, 1)","rgba(251, 191, 36, 1)","rgba(239, 68, 68, 1)","rgba(139, 92, 246, 1)"],borderWidth:1}]};this.charts.currentPosition=new Chart(a,{type:"bar",data:r,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,max:100,ticks:{color:"#cbd5e0"},grid:{color:"rgba(75, 85, 99, 0.3)"}},y:{ticks:{color:"#cbd5e0"},grid:{color:"rgba(75, 85, 99, 0.3)"}}}}})}catch(t){console.error("âŒ Failed to render current graph:",t)}}async updateIChingInterpretation(e){try{const t=document.getElementById("ichingInterpretation");if(!t)return;if(e.h384Data){const a=e.h384Data["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||[],r=e.h384Data["ç¾ä»£è§£é‡ˆã®è¦ç´„"]||"",n=e.h384Data["S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹"]||"ä¸­ç«‹";t.innerHTML=`\n          <p class="stage-title">\n            ${a.length>0?a.join("ãƒ»"):"ç¾åœ¨ã®çŠ¶æ³"}\n          </p>\n          <p class="stage-description">${r}</p>\n          <p class="stage-advice">æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹: ${"èƒ½å‹•"===n?"ç©æ¥µçš„ã«è¡Œå‹•ã™ã‚‹":"å—å‹•"===n?"çŠ¶æ³ã‚’è¦‹å®ˆã‚‹":"ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã¤"}</p>\n        `}else e.ichingInterpretation&&(t.innerHTML=`\n          <p class="stage-title">${e.ichingInterpretation.title||"ç¾åœ¨ã®çŠ¶æ³"}</p>\n          <p class="stage-description">${e.ichingInterpretation.description||"è©³ç´°ãªè§£é‡ˆã‚’èª­ã¿è¾¼ã¿ä¸­..."}</p>\n        `)}catch(t){console.error("âŒ Failed to update I Ching interpretation:",t)}}async renderFutureBranchingGraph(e){try{const t=document.getElementById("futureBranchingChart");if(!t)return;const a=t.getContext("2d");this.charts.futureBranching&&this.charts.futureBranching.destroy(),Chart.getChart(t)?.destroy();const r=["rgba(16, 185, 129, 1)","rgba(59, 130, 246, 1)","rgba(139, 92, 246, 1)","rgba(251, 191, 36, 1)","rgba(239, 68, 68, 1)","rgba(156, 163, 175, 1)","rgba(245, 158, 11, 1)","rgba(236, 72, 153, 1)"],n=[];e.scenarios&&e.scenarios.length>0&&e.scenarios.forEach((t,a)=>{console.log(`ğŸ“Š [DEBUG] Scenario ${a+1} phase scores:`,{phase1:t.phase1Score,phase2:t.phase2Score,phase3:t.phase3Score||t.score}),n.push({label:`ã‚·ãƒŠãƒªã‚ª${a+1} (${t.score}ç‚¹)`,data:[e.overallScore||e.currentPosition?.score||36,t.phase1Score||e.overallScore||40,t.phase2Score||Math.round((t.phase1Score+t.score)/2)||50,t.phase3Score||t.score],borderColor:r[a],backgroundColor:r[a].replace("1)","0.2)"),fill:!1,tension:.2})}),this.charts.futureBranching=new Chart(a,{type:"line",data:{labels:["ç¾åœ¨åœ°","ãƒ•ã‚§ãƒ¼ã‚º1","ãƒ•ã‚§ãƒ¼ã‚º2","ãƒ•ã‚§ãƒ¼ã‚º3"],datasets:n},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom",labels:{color:"#cbd5e0",font:{size:10}}}},scales:{y:{beginAtZero:!0,max:100,ticks:{color:"#cbd5e0"},grid:{color:"rgba(75, 85, 99, 0.3)"}},x:{ticks:{color:"#cbd5e0"},grid:{color:"rgba(75, 85, 99, 0.3)"}}}}})}catch(t){console.error("âŒ Failed to render future branching graph:",t)}}async updateThemeBoxes(e){try{const t=document.getElementById("progress-theme-content"),a=document.getElementById("change-theme-content");t&&e.progressTheme&&(t.textContent=e.progressTheme),a&&e.changeTheme&&(a.textContent=e.changeTheme)}catch(t){console.error("âŒ Failed to update theme boxes:",t)}}async renderEightScenarios(e){try{const t=document.getElementById("eight-scenarios-display");if(t&&t.children.length>0)return void console.log("â„¹ï¸ EightScenariosDisplay already rendered, skipping duplicate");const a=document.getElementById("scenarios-grid");if(!a)return;a.innerHTML="",e.scenarios&&e.scenarios.length>0&&e.scenarios.forEach((e,t)=>{const r=this.createScenarioCard(e,t+1);a.appendChild(r)})}catch(t){console.error("âŒ Failed to render eight scenarios:",t)}}createScenarioCard(e,t){const a=document.createElement("div");a.className="scenario-card-new";const r=this.getScenarioRank(e.score);return a.innerHTML=`\n      <div class="scenario-header">\n        <span class="scenario-rank rank-${r.toLowerCase()}">${r}</span>\n        <span class="scenario-score">${Math.round(e.score)}ç‚¹</span>\n      </div>\n      <div class="scenario-name">ã‚·ãƒŠãƒªã‚ª ${t}</div>\n      <div class="scenario-name">${e.name||"å¤©åœ°å¦ ä¹äº”"}</div>\n      <div class="scenario-steps">\n        <div>åˆå‹•: ${e.initialStep||"æ…é‡ã‚¹ã‚¿ãƒ¼ãƒˆ"}</div>\n        <div>å®‰å®š: ${e.stableStep||"ç€å®Ÿãªæˆé•·"}</div>\n      </div>\n      <canvas class="scenario-mini-graph" id="scenario-graph-${t}"></canvas>\n    `,setTimeout(()=>{this.renderMiniGraph(`scenario-graph-${t}`,e)},100),a}renderMiniGraph(e,t){const a=document.getElementById(e);if(!a)return;const r=a.getContext("2d");a.chartInstance&&a.chartInstance.destroy(),a.chartInstance=new Chart(r,{type:"bar",data:{labels:["åŸº","æ½œ","å®‰","ãƒª","å¤‰"],datasets:[{data:[t.basic||50,t.potential||60,t.stability||40,t.risk||30,t.volatility||70],backgroundColor:["rgba(59, 130, 246, 0.6)","rgba(16, 185, 129, 0.6)","rgba(251, 191, 36, 0.6)","rgba(239, 68, 68, 0.6)","rgba(139, 92, 246, 0.6)"]}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!1,beginAtZero:!0,max:100},y:{display:!0,ticks:{font:{size:8},color:"#a0aec0"}}}}})}getYaoName(e,t){if(this.analysisData&&this.analysisData.h384Data&&this.analysisData.h384Data["çˆ»"])return this.analysisData.h384Data["çˆ»"];return{1:"åˆä¹",2:"ä¹äºŒ",3:"å…­ä¸‰",4:"ä¹å››",5:"ä¹äº”",6:"ä¸Šä¹"}[e]||"åˆä¹"}getScoreLabel(e){return e>=80?"Excellent":e>=60?"Good":e>=40?"Fair":"Poor"}getTransitionLabel(e){return e>=70?"å›°é›£":e>=40?"æ™®é€š":"å®¹æ˜“"}getScenarioRank(e){return e>=90?"S":e>=80?"A":e>=70?"B":e>=60?"C":e>=50?"D":e>=40?"E":"F"}}"undefined"!=typeof window&&(window.ResultPageController=ResultPageController);