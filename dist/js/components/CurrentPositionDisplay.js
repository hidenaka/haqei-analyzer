class CurrentPositionDisplay{constructor(n,i){this.container=n,this.engine=i,this.currentData=null,this.initializeDisplay(),console.log("🎯 現在地表示コンポーネント初期化完了")}initializeDisplay(){this.container.innerHTML=this.createDisplayStructure(),this.attachEventListeners()}createDisplayStructure(){return'\n      <div class="current-position-container">\n        \x3c!-- ヘッダー --\x3e\n        <div class="position-header">\n          <h2 class="position-title">\n            <span class="icon">🎯</span>\n            あなたの現在地\n          </h2>\n          <div class="position-subtitle">\n            易経による現在の状況分析\n          </div>\n        </div>\n\n        \x3c!-- メイン表示エリア --\x3e\n        <div class="position-main" id="positionMain">\n          <div class="loading-state">\n            <div class="loading-spinner"></div>\n            <p>現在地を分析中...</p>\n          </div>\n        </div>\n\n        \x3c!-- 詳細情報エリア --\x3e\n        <div class="position-details" id="positionDetails" style="display: none;">\n          \x3c!-- 詳細内容は動的に生成 --\x3e\n        </div>\n\n        \x3c!-- HaQei分人間分析 --\x3e\n        <div class="HaQei-analysis" id="HaQeiAnalysis" style="display: none;">\n          \x3c!-- HaQei分析は動的に生成 --\x3e\n        </div>\n      </div>\n    '}updatePosition(n){console.log("🔄 現在地表示を更新:",n),this.currentData=n,this.updateMainDisplay(n),this.updateDetailsDisplay(n),this.updateHaQeiDisplay(n),this.animateUpdate()}updateMainDisplay(n){const i=document.getElementById("positionMain"),e=this.engine.findLineData(n.卦番号,this.parseLinePosition(n.爻));i.innerHTML=`\n      <div class="hexagram-display fade-in">\n        \x3c!-- 卦の視覚表現 --\x3e\n        <div class="hexagram-visual">\n          <div class="hexagram-symbol">\n            ${this.createHexagramVisual(n.卦番号,this.parseLinePosition(n.爻))}\n          </div>\n          <div class="hexagram-info">\n            <div class="hexagram-number">第${n.卦番号}卦</div>\n            <div class="hexagram-name">${n.卦名}</div>\n            <div class="current-line">${n.爻}</div>\n          </div>\n        </div>\n\n        \x3c!-- 爻辞表示 --\x3e\n        <div class="line-text-display">\n          <div class="line-text-header">\n            <h3>爻辞</h3>\n          </div>\n          <div class="line-text-content">\n            <div class="classical-text">\n              ${this.getClassicalLineText(n.卦番号,n.爻)}\n            </div>\n            <div class="modern-interpretation">\n              <h4>現代解釈</h4>\n              <p>${e?.現代解釈の要約||"状況を分析中..."}</p>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- 現在の状況サマリー --\x3e\n        <div class="situation-summary">\n          <div class="summary-stats">\n            <div class="stat-item">\n              <span class="stat-label">基本スコア</span>\n              <span class="stat-value">${e?.S1_基本スコア||50}</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">ポテンシャル</span>\n              <span class="stat-value">${e?.S2_ポテンシャル||50}</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">安定性</span>\n              <span class="stat-value">${e?.S3_安定性スコア||50}</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">リスク</span>\n              <span class="stat-value risk">${Math.abs(e?.S4_リスク||30)}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}createHexagramVisual(n,i){const e=this.engine.hexagramBinary[n];if(!e)return'<div class="error">卦データエラー</div>';return`\n      <div class="hexagram-lines">\n        ${e.map((n,e)=>{const s=6-e,a=1===n;return`\n        <div class="hexagram-line ${a?"yang":"yin"} ${s===i?"current":""}">\n          <div class="line-symbol">\n            ${a?"━━━━━━":"━━  ━━"}\n          </div>\n          <div class="line-label">\n            ${this.getLineLabel(s)}\n          </div>\n        </div>\n      `}).join("")}\n      </div>\n    `}getLineLabel(n){return{6:"上爻",5:"五爻",4:"四爻",3:"三爻",2:"二爻",1:"初爻"}[n]||""}getClassicalLineText(n,i){return{"1-1":"潜龍勿用（せんりゅう もちいるなかれ）","1-2":"見龍在田、利見大人（けんりゅう でんにあり、たいじんにあうによろし）","1-3":"君子終日乾乾、夕惕若、厲无咎（くんし しゅうじつけんけん）","1-4":"或躍在淵、无咎（あるいはおどってふちにあり、とがなし）","1-5":"飛龍在天、利見大人（ひりゅう てんにあり、たいじんにあう）","1-6":"亢龍有悔（こうりゅう くいあり）","12-3":"包羞（ほうしゅう）"}[`${n}-${this.parseLinePosition(i)}`]||"爻辞を確認中..."}updateDetailsDisplay(n){const i=document.getElementById("positionDetails"),e=this.engine.findLineData(n.卦番号,this.parseLinePosition(n.爻));i.innerHTML=`\n      <div class="details-content">\n        <h3>詳細分析</h3>\n        \n        \x3c!-- キーワード分析 --\x3e\n        <div class="keyword-analysis">\n          <h4>関連キーワード</h4>\n          <div class="keyword-tags">\n            ${(e?.キーワード||[]).map(n=>`<span class="keyword-tag">${n}</span>`).join("")}\n          </div>\n        </div>\n\n        \x3c!-- 状況の性質 --\x3e\n        <div class="situation-nature">\n          <h4>状況の性質</h4>\n          <div class="nature-grid">\n            <div class="nature-item">\n              <span class="nature-label">主体性</span>\n              <span class="nature-value">${e?.S5_主体性推奨スタンス||"中立"}</span>\n            </div>\n            <div class="nature-item">\n              <span class="nature-label">変動性</span>\n              <span class="nature-value">${e?.S6_変動性スコア||50}</span>\n            </div>\n            <div class="nature-item">\n              <span class="nature-label">総合評価</span>\n              <span class="nature-value">${e?.S7_総合評価スコア||50}</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- 易経の教え --\x3e\n        <div class="iching-teaching">\n          <h4>易経の教え</h4>\n          <div class="teaching-content">\n            <p>${this.generateTeachingContent(n,e)}</p>\n          </div>\n        </div>\n      </div>\n    `,i.style.display="block"}updateHaQeiDisplay(n){const i=document.getElementById("HaQeiAnalysis"),e=this.engine.findLineData(n.卦番号,this.parseLinePosition(n.爻)),s=this.generatePersonaAnalyses(n,e);i.innerHTML=`\n      <div class="HaQei-content">\n        <h3>HaQei分人間分析</h3>\n        <div class="HaQei-subtitle">\n          あなたの中の異なる分人から見た、この状況の意味\n        </div>\n        \n        <div class="persona-analyses">\n          ${Object.entries(s).map(([n,i])=>`\n            <div class="persona-analysis">\n              <div class="persona-header">\n                <h4>${i.title}</h4>\n                <div class="persona-icon">${i.icon}</div>\n              </div>\n              <div class="persona-content">\n                <div class="persona-perspective">\n                  <strong>この分人の視点：</strong>\n                  <p>${i.perspective}</p>\n                </div>\n                <div class="persona-guidance">\n                  <strong>推奨される行動：</strong>\n                  <p>${i.guidance}</p>\n                </div>\n              </div>\n            </div>\n          `).join("")}\n        </div>\n\n        \x3c!-- 分人間の調和 --\x3e\n        <div class="persona-harmony">\n          <h4>分人間の調和</h4>\n          <div class="harmony-content">\n            <p>${this.generateHarmonyGuidance(s,n)}</p>\n          </div>\n        </div>\n      </div>\n    `,i.style.display="block"}generatePersonaAnalyses(n,i){return{analytical:{title:"分析的な分人",icon:"🧠",perspective:`第${n.卦番号}卦${n.爻}の状況を、データと論理から分析します。現在のスコア（基本${i?.S1_基本スコア||50}、安定性${i?.S3_安定性スコア||50}）から見て、${this.getAnalyticalPerspective(i)}`,guidance:this.getAnalyticalGuidance(i)},emotional:{title:"感情的な分人",icon:"❤️",perspective:`この状況に対して、心の奥深くで感じていること。${this.getEmotionalPerspective(n,i)}`,guidance:this.getEmotionalGuidance(i)},social:{title:"社会的な分人",icon:"👥",perspective:`周囲との関係性や社会的な文脈から見た、この状況の位置づけ。${this.getSocialPerspective(n,i)}`,guidance:this.getSocialGuidance(i)},spiritual:{title:"精神的な分人",icon:"🌟",perspective:`より深い智慧や精神的な成長の観点から。易経の教えとして、${this.getSpiritualPerspective(n,i)}`,guidance:this.getSpiritualGuidance(n,i)}}}getAnalyticalPerspective(n){const i=n?.S7_総合評価スコア||50;return i>=60?"客観的に見て改善の余地がある状況です。":i>=40?"注意深い分析と戦略的な判断が必要な状況です。":"現実的なリスク管理が最優先の状況です。"}getAnalyticalGuidance(n){const i=n?.S5_主体性推奨スタンス||"中立";return"能動"===i?"データに基づいた積極的な行動計画を立てましょう。":"受動"===i?"情報収集と状況分析を徹底し、慎重に判断しましょう。":"バランスの取れた分析的アプローチで臨みましょう。"}getEmotionalPerspective(n,i){const e=i?.キーワード||[];return e.includes("不安")||e.includes("心配")?"不安や心配を感じるのは自然なことです。":e.includes("希望")||e.includes("期待")?"心の中で新しい可能性への期待を感じているでしょう。":"複雑な感情を抱えながらも、内なる智慧が答えを知っています。"}getEmotionalGuidance(n){return"自分の感情を否定せず、そこから得られるメッセージに耳を傾けましょう。"}getSocialPerspective(n,i){return"周囲の人々や社会的な期待との関係において、この状況がどのような意味を持つかを考えてみましょう。"}getSocialGuidance(n){return"他者との調和を保ちながら、自分らしい道を歩む方法を探しましょう。"}getSpiritualPerspective(n,i){return`${n.卦名}の教えは、人生の深い智慧を示しています。この経験を通じて、より大きな理解に到達する機会です。`}getSpiritualGuidance(n,i){return"易経の智慧に導かれ、この状況から学ぶべき真理を受け取りましょう。"}generateHarmonyGuidance(n,i){return`あなたの中の4つの分人それぞれが、この${i.卦名}の状況に対して異なる視点を持っています。これらの視点すべてが「あなた」であり、状況に応じて最適な分人を前面に出すことで、より調和の取れた判断と行動が可能になります。統一された単一の自己にこだわるのではなく、状況に応じた柔軟な対応を心がけましょう。`}generateTeachingContent(n,i){const e=Math.abs(i?.S4_リスク||30),s=i?.S2_ポテンシャル||50;let a=`第${n.卦番号}卦「${n.卦名}」の${n.爻}は、`;return a+=e>50?"リスクの高い状況であることを示しています。慎重な判断と準備が必要です。":s>60?"大きな可能性を秘めた状況です。適切なタイミングで行動すれば良い結果が期待できます。":"バランスの取れた状況です。現状を維持しながら、機会を見極めることが大切です。",a}parseLinePosition(n){return{"初九":1,"初六":1,"九二":2,"六二":2,"九三":3,"六三":3,"九四":4,"六四":4,"九五":5,"六五":5,"上九":6,"上六":6}[n]||1}animateUpdate(){this.container.querySelectorAll(".fade-in").forEach((n,i)=>{setTimeout(()=>{n.classList.add("visible")},200*i)})}attachEventListeners(){this.container.querySelectorAll(".toggle-details").forEach(n=>{n.addEventListener("click",n=>{const i=n.target.dataset.target,e=document.getElementById(i);e&&(e.style.display="none"===e.style.display?"block":"none")})})}getCurrentData(){return this.currentData}reset(){this.currentData=null,this.initializeDisplay()}}"undefined"!=typeof window&&(window.CurrentPositionDisplay=CurrentPositionDisplay),"undefined"!=typeof module&&module.exports&&(module.exports=CurrentPositionDisplay),console.log("🎯 CurrentPositionDisplay.js 読み込み完了");