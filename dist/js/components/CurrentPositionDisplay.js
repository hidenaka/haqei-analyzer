class CurrentPositionDisplay{constructor(n,i){this.container=n,this.engine=i,this.currentData=null,this.initializeDisplay(),console.log("ğŸ¯ ç¾åœ¨åœ°è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆæœŸåŒ–å®Œäº†")}initializeDisplay(){this.container.innerHTML=this.createDisplayStructure(),this.attachEventListeners()}createDisplayStructure(){return'\n      <div class="current-position-container">\n        \x3c!-- ãƒ˜ãƒƒãƒ€ãƒ¼ --\x3e\n        <div class="position-header">\n          <h2 class="position-title">\n            <span class="icon">ğŸ¯</span>\n            ã‚ãªãŸã®ç¾åœ¨åœ°\n          </h2>\n          <div class="position-subtitle">\n            æ˜“çµŒã«ã‚ˆã‚‹ç¾åœ¨ã®çŠ¶æ³åˆ†æ\n          </div>\n        </div>\n\n        \x3c!-- ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºã‚¨ãƒªã‚¢ --\x3e\n        <div class="position-main" id="positionMain">\n          <div class="loading-state">\n            <div class="loading-spinner"></div>\n            <p>ç¾åœ¨åœ°ã‚’åˆ†æä¸­...</p>\n          </div>\n        </div>\n\n        \x3c!-- è©³ç´°æƒ…å ±ã‚¨ãƒªã‚¢ --\x3e\n        <div class="position-details" id="positionDetails" style="display: none;">\n          \x3c!-- è©³ç´°å†…å®¹ã¯å‹•çš„ã«ç”Ÿæˆ --\x3e\n        </div>\n\n        \x3c!-- HaQeiåˆ†äººé–“åˆ†æ --\x3e\n        <div class="HaQei-analysis" id="HaQeiAnalysis" style="display: none;">\n          \x3c!-- HaQeiåˆ†æã¯å‹•çš„ã«ç”Ÿæˆ --\x3e\n        </div>\n      </div>\n    '}updatePosition(n){console.log("ğŸ”„ ç¾åœ¨åœ°è¡¨ç¤ºã‚’æ›´æ–°:",n),this.currentData=n,this.updateMainDisplay(n),this.updateDetailsDisplay(n),this.updateHaQeiDisplay(n),this.animateUpdate()}updateMainDisplay(n){const i=document.getElementById("positionMain"),e=this.engine.findLineData(n.å¦ç•ªå·,this.parseLinePosition(n.çˆ»));i.innerHTML=`\n      <div class="hexagram-display fade-in">\n        \x3c!-- å¦ã®è¦–è¦šè¡¨ç¾ --\x3e\n        <div class="hexagram-visual">\n          <div class="hexagram-symbol">\n            ${this.createHexagramVisual(n.å¦ç•ªå·,this.parseLinePosition(n.çˆ»))}\n          </div>\n          <div class="hexagram-info">\n            <div class="hexagram-number">ç¬¬${n.å¦ç•ªå·}å¦</div>\n            <div class="hexagram-name">${n.å¦å}</div>\n            <div class="current-line">${n.çˆ»}</div>\n          </div>\n        </div>\n\n        \x3c!-- çˆ»è¾è¡¨ç¤º --\x3e\n        <div class="line-text-display">\n          <div class="line-text-header">\n            <h3>çˆ»è¾</h3>\n          </div>\n          <div class="line-text-content">\n            <div class="classical-text">\n              ${this.getClassicalLineText(n.å¦ç•ªå·,n.çˆ»)}\n            </div>\n            <div class="modern-interpretation">\n              <h4>ç¾ä»£è§£é‡ˆ</h4>\n              <p>${e?.ç¾ä»£è§£é‡ˆã®è¦ç´„||"çŠ¶æ³ã‚’åˆ†æä¸­..."}</p>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- ç¾åœ¨ã®çŠ¶æ³ã‚µãƒãƒªãƒ¼ --\x3e\n        <div class="situation-summary">\n          <div class="summary-stats">\n            <div class="stat-item">\n              <span class="stat-label">åŸºæœ¬ã‚¹ã‚³ã‚¢</span>\n              <span class="stat-value">${e?.S1_åŸºæœ¬ã‚¹ã‚³ã‚¢||50}</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</span>\n              <span class="stat-value">${e?.S2_ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«||50}</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">å®‰å®šæ€§</span>\n              <span class="stat-value">${e?.S3_å®‰å®šæ€§ã‚¹ã‚³ã‚¢||50}</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">ãƒªã‚¹ã‚¯</span>\n              <span class="stat-value risk">${Math.abs(e?.S4_ãƒªã‚¹ã‚¯||30)}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}createHexagramVisual(n,i){const e=this.engine.hexagramBinary[n];if(!e)return'<div class="error">å¦ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼</div>';return`\n      <div class="hexagram-lines">\n        ${e.map((n,e)=>{const s=6-e,a=1===n;return`\n        <div class="hexagram-line ${a?"yang":"yin"} ${s===i?"current":""}">\n          <div class="line-symbol">\n            ${a?"â”â”â”â”â”â”":"â”â”  â”â”"}\n          </div>\n          <div class="line-label">\n            ${this.getLineLabel(s)}\n          </div>\n        </div>\n      `}).join("")}\n      </div>\n    `}getLineLabel(n){return{6:"ä¸Šçˆ»",5:"äº”çˆ»",4:"å››çˆ»",3:"ä¸‰çˆ»",2:"äºŒçˆ»",1:"åˆçˆ»"}[n]||""}getClassicalLineText(n,i){return{"1-1":"æ½œé¾å‹¿ç”¨ï¼ˆã›ã‚“ã‚Šã‚…ã† ã‚‚ã¡ã„ã‚‹ãªã‹ã‚Œï¼‰","1-2":"è¦‹é¾åœ¨ç”°ã€åˆ©è¦‹å¤§äººï¼ˆã‘ã‚“ã‚Šã‚…ã† ã§ã‚“ã«ã‚ã‚Šã€ãŸã„ã˜ã‚“ã«ã‚ã†ã«ã‚ˆã‚ã—ï¼‰","1-3":"å›å­çµ‚æ—¥ä¹¾ä¹¾ã€å¤•æƒ•è‹¥ã€å²æ— å’ï¼ˆãã‚“ã— ã—ã‚…ã†ã˜ã¤ã‘ã‚“ã‘ã‚“ï¼‰","1-4":"æˆ–èºåœ¨æ·µã€æ— å’ï¼ˆã‚ã‚‹ã„ã¯ãŠã©ã£ã¦ãµã¡ã«ã‚ã‚Šã€ã¨ãŒãªã—ï¼‰","1-5":"é£›é¾åœ¨å¤©ã€åˆ©è¦‹å¤§äººï¼ˆã²ã‚Šã‚…ã† ã¦ã‚“ã«ã‚ã‚Šã€ãŸã„ã˜ã‚“ã«ã‚ã†ï¼‰","1-6":"äº¢é¾æœ‰æ‚”ï¼ˆã“ã†ã‚Šã‚…ã† ãã„ã‚ã‚Šï¼‰","12-3":"åŒ…ç¾ï¼ˆã»ã†ã—ã‚…ã†ï¼‰"}[`${n}-${this.parseLinePosition(i)}`]||"çˆ»è¾ã‚’ç¢ºèªä¸­..."}updateDetailsDisplay(n){const i=document.getElementById("positionDetails"),e=this.engine.findLineData(n.å¦ç•ªå·,this.parseLinePosition(n.çˆ»));i.innerHTML=`\n      <div class="details-content">\n        <h3>è©³ç´°åˆ†æ</h3>\n        \n        \x3c!-- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åˆ†æ --\x3e\n        <div class="keyword-analysis">\n          <h4>é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</h4>\n          <div class="keyword-tags">\n            ${(e?.ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰||[]).map(n=>`<span class="keyword-tag">${n}</span>`).join("")}\n          </div>\n        </div>\n\n        \x3c!-- çŠ¶æ³ã®æ€§è³ª --\x3e\n        <div class="situation-nature">\n          <h4>çŠ¶æ³ã®æ€§è³ª</h4>\n          <div class="nature-grid">\n            <div class="nature-item">\n              <span class="nature-label">ä¸»ä½“æ€§</span>\n              <span class="nature-value">${e?.S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹||"ä¸­ç«‹"}</span>\n            </div>\n            <div class="nature-item">\n              <span class="nature-label">å¤‰å‹•æ€§</span>\n              <span class="nature-value">${e?.S6_å¤‰å‹•æ€§ã‚¹ã‚³ã‚¢||50}</span>\n            </div>\n            <div class="nature-item">\n              <span class="nature-label">ç·åˆè©•ä¾¡</span>\n              <span class="nature-value">${e?.S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢||50}</span>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- æ˜“çµŒã®æ•™ãˆ --\x3e\n        <div class="iching-teaching">\n          <h4>æ˜“çµŒã®æ•™ãˆ</h4>\n          <div class="teaching-content">\n            <p>${this.generateTeachingContent(n,e)}</p>\n          </div>\n        </div>\n      </div>\n    `,i.style.display="block"}updateHaQeiDisplay(n){const i=document.getElementById("HaQeiAnalysis"),e=this.engine.findLineData(n.å¦ç•ªå·,this.parseLinePosition(n.çˆ»)),s=this.generatePersonaAnalyses(n,e);i.innerHTML=`\n      <div class="HaQei-content">\n        <h3>HaQeiåˆ†äººé–“åˆ†æ</h3>\n        <div class="HaQei-subtitle">\n          ã‚ãªãŸã®ä¸­ã®ç•°ãªã‚‹åˆ†äººã‹ã‚‰è¦‹ãŸã€ã“ã®çŠ¶æ³ã®æ„å‘³\n        </div>\n        \n        <div class="persona-analyses">\n          ${Object.entries(s).map(([n,i])=>`\n            <div class="persona-analysis">\n              <div class="persona-header">\n                <h4>${i.title}</h4>\n                <div class="persona-icon">${i.icon}</div>\n              </div>\n              <div class="persona-content">\n                <div class="persona-perspective">\n                  <strong>ã“ã®åˆ†äººã®è¦–ç‚¹ï¼š</strong>\n                  <p>${i.perspective}</p>\n                </div>\n                <div class="persona-guidance">\n                  <strong>æ¨å¥¨ã•ã‚Œã‚‹è¡Œå‹•ï¼š</strong>\n                  <p>${i.guidance}</p>\n                </div>\n              </div>\n            </div>\n          `).join("")}\n        </div>\n\n        \x3c!-- åˆ†äººé–“ã®èª¿å’Œ --\x3e\n        <div class="persona-harmony">\n          <h4>åˆ†äººé–“ã®èª¿å’Œ</h4>\n          <div class="harmony-content">\n            <p>${this.generateHarmonyGuidance(s,n)}</p>\n          </div>\n        </div>\n      </div>\n    `,i.style.display="block"}generatePersonaAnalyses(n,i){return{analytical:{title:"åˆ†æçš„ãªåˆ†äºº",icon:"ğŸ§ ",perspective:`ç¬¬${n.å¦ç•ªå·}å¦${n.çˆ»}ã®çŠ¶æ³ã‚’ã€ãƒ‡ãƒ¼ã‚¿ã¨è«–ç†ã‹ã‚‰åˆ†æã—ã¾ã™ã€‚ç¾åœ¨ã®ã‚¹ã‚³ã‚¢ï¼ˆåŸºæœ¬${i?.S1_åŸºæœ¬ã‚¹ã‚³ã‚¢||50}ã€å®‰å®šæ€§${i?.S3_å®‰å®šæ€§ã‚¹ã‚³ã‚¢||50}ï¼‰ã‹ã‚‰è¦‹ã¦ã€${this.getAnalyticalPerspective(i)}`,guidance:this.getAnalyticalGuidance(i)},emotional:{title:"æ„Ÿæƒ…çš„ãªåˆ†äºº",icon:"â¤ï¸",perspective:`ã“ã®çŠ¶æ³ã«å¯¾ã—ã¦ã€å¿ƒã®å¥¥æ·±ãã§æ„Ÿã˜ã¦ã„ã‚‹ã“ã¨ã€‚${this.getEmotionalPerspective(n,i)}`,guidance:this.getEmotionalGuidance(i)},social:{title:"ç¤¾ä¼šçš„ãªåˆ†äºº",icon:"ğŸ‘¥",perspective:`å‘¨å›²ã¨ã®é–¢ä¿‚æ€§ã‚„ç¤¾ä¼šçš„ãªæ–‡è„ˆã‹ã‚‰è¦‹ãŸã€ã“ã®çŠ¶æ³ã®ä½ç½®ã¥ã‘ã€‚${this.getSocialPerspective(n,i)}`,guidance:this.getSocialGuidance(i)},spiritual:{title:"ç²¾ç¥çš„ãªåˆ†äºº",icon:"ğŸŒŸ",perspective:`ã‚ˆã‚Šæ·±ã„æ™ºæ…§ã‚„ç²¾ç¥çš„ãªæˆé•·ã®è¦³ç‚¹ã‹ã‚‰ã€‚æ˜“çµŒã®æ•™ãˆã¨ã—ã¦ã€${this.getSpiritualPerspective(n,i)}`,guidance:this.getSpiritualGuidance(n,i)}}}getAnalyticalPerspective(n){const i=n?.S7_ç·åˆè©•ä¾¡ã‚¹ã‚³ã‚¢||50;return i>=60?"å®¢è¦³çš„ã«è¦‹ã¦æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚‹çŠ¶æ³ã§ã™ã€‚":i>=40?"æ³¨æ„æ·±ã„åˆ†æã¨æˆ¦ç•¥çš„ãªåˆ¤æ–­ãŒå¿…è¦ãªçŠ¶æ³ã§ã™ã€‚":"ç¾å®Ÿçš„ãªãƒªã‚¹ã‚¯ç®¡ç†ãŒæœ€å„ªå…ˆã®çŠ¶æ³ã§ã™ã€‚"}getAnalyticalGuidance(n){const i=n?.S5_ä¸»ä½“æ€§æ¨å¥¨ã‚¹ã‚¿ãƒ³ã‚¹||"ä¸­ç«‹";return"èƒ½å‹•"===i?"ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸç©æ¥µçš„ãªè¡Œå‹•è¨ˆç”»ã‚’ç«‹ã¦ã¾ã—ã‚‡ã†ã€‚":"å—å‹•"===i?"æƒ…å ±åé›†ã¨çŠ¶æ³åˆ†æã‚’å¾¹åº•ã—ã€æ…é‡ã«åˆ¤æ–­ã—ã¾ã—ã‚‡ã†ã€‚":"ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸåˆ†æçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§è‡¨ã¿ã¾ã—ã‚‡ã†ã€‚"}getEmotionalPerspective(n,i){const e=i?.ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰||[];return e.includes("ä¸å®‰")||e.includes("å¿ƒé…")?"ä¸å®‰ã‚„å¿ƒé…ã‚’æ„Ÿã˜ã‚‹ã®ã¯è‡ªç„¶ãªã“ã¨ã§ã™ã€‚":e.includes("å¸Œæœ›")||e.includes("æœŸå¾…")?"å¿ƒã®ä¸­ã§æ–°ã—ã„å¯èƒ½æ€§ã¸ã®æœŸå¾…ã‚’æ„Ÿã˜ã¦ã„ã‚‹ã§ã—ã‚‡ã†ã€‚":"è¤‡é›‘ãªæ„Ÿæƒ…ã‚’æŠ±ãˆãªãŒã‚‰ã‚‚ã€å†…ãªã‚‹æ™ºæ…§ãŒç­”ãˆã‚’çŸ¥ã£ã¦ã„ã¾ã™ã€‚"}getEmotionalGuidance(n){return"è‡ªåˆ†ã®æ„Ÿæƒ…ã‚’å¦å®šã›ãšã€ãã“ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«è€³ã‚’å‚¾ã‘ã¾ã—ã‚‡ã†ã€‚"}getSocialPerspective(n,i){return"å‘¨å›²ã®äººã€…ã‚„ç¤¾ä¼šçš„ãªæœŸå¾…ã¨ã®é–¢ä¿‚ã«ãŠã„ã¦ã€ã“ã®çŠ¶æ³ãŒã©ã®ã‚ˆã†ãªæ„å‘³ã‚’æŒã¤ã‹ã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚"}getSocialGuidance(n){return"ä»–è€…ã¨ã®èª¿å’Œã‚’ä¿ã¡ãªãŒã‚‰ã€è‡ªåˆ†ã‚‰ã—ã„é“ã‚’æ­©ã‚€æ–¹æ³•ã‚’æ¢ã—ã¾ã—ã‚‡ã†ã€‚"}getSpiritualPerspective(n,i){return`${n.å¦å}ã®æ•™ãˆã¯ã€äººç”Ÿã®æ·±ã„æ™ºæ…§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã“ã®çµŒé¨“ã‚’é€šã˜ã¦ã€ã‚ˆã‚Šå¤§ããªç†è§£ã«åˆ°é”ã™ã‚‹æ©Ÿä¼šã§ã™ã€‚`}getSpiritualGuidance(n,i){return"æ˜“çµŒã®æ™ºæ…§ã«å°ã‹ã‚Œã€ã“ã®çŠ¶æ³ã‹ã‚‰å­¦ã¶ã¹ãçœŸç†ã‚’å—ã‘å–ã‚Šã¾ã—ã‚‡ã†ã€‚"}generateHarmonyGuidance(n,i){return`ã‚ãªãŸã®ä¸­ã®4ã¤ã®åˆ†äººãã‚Œãã‚ŒãŒã€ã“ã®${i.å¦å}ã®çŠ¶æ³ã«å¯¾ã—ã¦ç•°ãªã‚‹è¦–ç‚¹ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®è¦–ç‚¹ã™ã¹ã¦ãŒã€Œã‚ãªãŸã€ã§ã‚ã‚Šã€çŠ¶æ³ã«å¿œã˜ã¦æœ€é©ãªåˆ†äººã‚’å‰é¢ã«å‡ºã™ã“ã¨ã§ã€ã‚ˆã‚Šèª¿å’Œã®å–ã‚ŒãŸåˆ¤æ–­ã¨è¡Œå‹•ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚çµ±ä¸€ã•ã‚ŒãŸå˜ä¸€ã®è‡ªå·±ã«ã“ã ã‚ã‚‹ã®ã§ã¯ãªãã€çŠ¶æ³ã«å¿œã˜ãŸæŸ”è»Ÿãªå¯¾å¿œã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ã€‚`}generateTeachingContent(n,i){const e=Math.abs(i?.S4_ãƒªã‚¹ã‚¯||30),s=i?.S2_ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«||50;let a=`ç¬¬${n.å¦ç•ªå·}å¦ã€Œ${n.å¦å}ã€ã®${n.çˆ»}ã¯ã€`;return a+=e>50?"ãƒªã‚¹ã‚¯ã®é«˜ã„çŠ¶æ³ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚æ…é‡ãªåˆ¤æ–­ã¨æº–å‚™ãŒå¿…è¦ã§ã™ã€‚":s>60?"å¤§ããªå¯èƒ½æ€§ã‚’ç§˜ã‚ãŸçŠ¶æ³ã§ã™ã€‚é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¡Œå‹•ã™ã‚Œã°è‰¯ã„çµæœãŒæœŸå¾…ã§ãã¾ã™ã€‚":"ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸçŠ¶æ³ã§ã™ã€‚ç¾çŠ¶ã‚’ç¶­æŒã—ãªãŒã‚‰ã€æ©Ÿä¼šã‚’è¦‹æ¥µã‚ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚",a}parseLinePosition(n){return{"åˆä¹":1,"åˆå…­":1,"ä¹äºŒ":2,"å…­äºŒ":2,"ä¹ä¸‰":3,"å…­ä¸‰":3,"ä¹å››":4,"å…­å››":4,"ä¹äº”":5,"å…­äº”":5,"ä¸Šä¹":6,"ä¸Šå…­":6}[n]||1}animateUpdate(){this.container.querySelectorAll(".fade-in").forEach((n,i)=>{setTimeout(()=>{n.classList.add("visible")},200*i)})}attachEventListeners(){this.container.querySelectorAll(".toggle-details").forEach(n=>{n.addEventListener("click",n=>{const i=n.target.dataset.target,e=document.getElementById(i);e&&(e.style.display="none"===e.style.display?"block":"none")})})}getCurrentData(){return this.currentData}reset(){this.currentData=null,this.initializeDisplay()}}"undefined"!=typeof window&&(window.CurrentPositionDisplay=CurrentPositionDisplay),"undefined"!=typeof module&&module.exports&&(module.exports=CurrentPositionDisplay),console.log("ğŸ¯ CurrentPositionDisplay.js èª­ã¿è¾¼ã¿å®Œäº†");