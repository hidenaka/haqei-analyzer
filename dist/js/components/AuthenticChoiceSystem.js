class AuthenticChoiceSystem{constructor(n,i){this.container=n,this.engine=i,this.currentChoices=null,this.selectedPath=null,this.initializeChoiceSystem(),console.log("ğŸ­ æ­£çµ±æ˜“çµŒé¸æŠã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†")}initializeChoiceSystem(){this.container.innerHTML=this.createChoiceStructure(),this.attachEventListeners()}createChoiceStructure(){return'\n      <div class="authentic-choice-container">\n        \x3c!-- ãƒ˜ãƒƒãƒ€ãƒ¼ --\x3e\n        <div class="choice-header">\n          <h2 class="choice-title">\n            <span class="icon">ğŸ­</span>\n            æ˜“çµŒã®åˆ†å²ç‚¹\n          </h2>\n          <div class="choice-subtitle">\n            ä»Šã®çŠ¶æ³ã®ãƒ†ãƒ¼ãƒã«ã€ã‚ãªãŸã¯ã©ã†å¿œãˆã¾ã™ã‹ï¼Ÿ\n          </div>\n        </div>\n\n        \x3c!-- ç¾åœ¨ã®çŠ¶æ³ãƒ†ãƒ¼ãƒè¡¨ç¤º --\x3e\n        <div class="current-line-display" id="currentLineDisplay">\n          \x3c!-- å‹•çš„ã«ç”Ÿæˆ --\x3e\n        </div>\n\n        \x3c!-- é¸æŠè‚¢è¡¨ç¤º --\x3e\n        <div class="choice-options" id="choiceOptions">\n          \x3c!-- å‹•çš„ã«ç”Ÿæˆ --\x3e\n        </div>\n\n        \x3c!-- å¤‰åŒ–äºˆæ¸¬è¡¨ç¤º --\x3e\n        <div class="transformation-preview" id="transformationPreview" style="display: none;">\n          \x3c!-- å‹•çš„ã«ç”Ÿæˆ --\x3e\n        </div>\n\n        \x3c!-- HaQeiåˆ†äººé–“åˆ†æ --\x3e\n        <div class="HaQei-choice-analysis" id="HaQeiChoiceAnalysis" style="display: none;">\n          \x3c!-- å‹•çš„ã«ç”Ÿæˆ --\x3e\n        </div>\n\n        \x3c!-- é¸æŠç¢ºå®šãƒœã‚¿ãƒ³ --\x3e\n        <div class="choice-confirmation" id="choiceConfirmation" style="display: none;">\n          <button class="confirm-button" id="confirmChoiceBtn">\n            ã“ã®é“ã‚’é¸æŠã™ã‚‹\n          </button>\n        </div>\n      </div>\n    '}generateChoices(n){console.log("ğŸ¯ é¸æŠè‚¢ç”Ÿæˆé–‹å§‹:",n);try{this.currentChoices=this.engine.generateAuthenticChoices(n.å¦ç•ªå·,this.parseLinePosition(n.çˆ»)),this.displayCurrentLine(this.currentChoices.situation),this.displayChoiceOptions(this.currentChoices),console.log("âœ… é¸æŠè‚¢ç”Ÿæˆå®Œäº†:",this.currentChoices)}catch(i){console.error("âŒ é¸æŠè‚¢ç”Ÿæˆã‚¨ãƒ©ãƒ¼:",i),this.displayErrorState()}}displayCurrentLine(n){document.getElementById("currentLineDisplay").innerHTML=`\n      <div class="line-situation fade-in">\n        <div class="situation-header">\n          <h3>ç¾åœ¨ã®çŠ¶æ³</h3>\n          <div class="hexagram-info">\n            <span class="hexagram-number">ç¬¬${n.hexagram}å¦</span>\n            <span class="hexagram-name">${n.hexagramName}</span>\n            <span class="line-position">${n.lineText}</span>\n          </div>\n        </div>\n        \n        <div class="situation-content">\n          <div class="line-meaning">\n            <h4>ä»Šã®çŠ¶æ³ã®ãƒ†ãƒ¼ãƒ</h4>\n            <div class="meaning-text">\n              ${n.meaning}\n            </div>\n          </div>\n          \n          <div class="situation-keywords">\n            <h4>é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</h4>\n            <div class="keyword-tags">\n              ${n.keywords.map(n=>`<span class="keyword-tag">${n}</span>`).join("")}\n            </div>\n          </div>\n        </div>\n        \n        <div class="choice-question">\n          <h3>ğŸ¤” ã“ã®ãƒ†ãƒ¼ãƒã«ã€ã‚ãªãŸã¯ã©ã†å¿œãˆã¾ã™ã‹ï¼Ÿ</h3>\n        </div>\n      </div>\n    `}displayChoiceOptions(n){document.getElementById("choiceOptions").innerHTML=`\n      <div class="choice-cards">\n        \x3c!-- é¸æŠA: ä»Šã®çŠ¶æ³ã®ãƒ†ãƒ¼ãƒã§é€²ã‚€é“ --\x3e\n        <div class="choice-card path-a" data-path="pathA">\n          <div class="card-header">\n            <h3>ğŸ›¤ï¸ ${n.pathA.title}</h3>\n            <div class="path-type">ä»Šã®çŠ¶æ³ã®ãƒ†ãƒ¼ãƒã§é€²ã‚€</div>\n          </div>\n          \n          <div class="card-content">\n            <div class="path-description">\n              <p>${n.pathA.description}</p>\n            </div>\n            \n            <div class="path-action">\n              <h4>å…·ä½“çš„ãªè¡Œå‹•</h4>\n              <p>${n.pathA.action}</p>\n            </div>\n            \n            <div class="outcome-preview">\n              <h4>äºˆæƒ³ã•ã‚Œã‚‹å±•é–‹</h4>\n              <div class="outcome-stats">\n                <div class="stat-item positive">\n                  <span class="stat-label">ãƒªã‚¹ã‚¯</span>\n                  <span class="stat-value">${n.pathA.outcome.risk}</span>\n                </div>\n                <div class="stat-item positive">\n                  <span class="stat-label">å¯èƒ½æ€§</span>\n                  <span class="stat-value">${n.pathA.outcome.potential}</span>\n                </div>\n              </div>\n              \n              <div class="transformation-hint">\n                <span class="from-hex">${n.situation.hexagramName}</span>\n                <span class="arrow">â†’</span>\n                <span class="to-hex">${n.pathA.outcome.transformation?.toHexagram?.name||"å¤‰åŒ–äºˆæ¸¬ä¸­"}</span>\n              </div>\n            </div>\n          </div>\n          \n          <div class="card-footer">\n            <button class="select-path-btn" data-path="pathA">\n              ã“ã®é“ã‚’è©³ã—ãè¦‹ã‚‹\n            </button>\n          </div>\n        </div>\n\n        \x3c!-- é¸æŠB: åˆ¥ã®è§’åº¦ã‹ã‚‰è€ƒãˆã‚‹é“ --\x3e\n        <div class="choice-card path-b" data-path="pathB">\n          <div class="card-header">\n            <h3>âš¡ ${n.pathB.title}</h3>\n            <div class="path-type">é•ã†ãƒ†ãƒ¼ãƒã‚’é¸æŠã™ã‚‹</div>\n          </div>\n          \n          <div class="card-content">\n            <div class="path-description">\n              <p>${n.pathB.description}</p>\n            </div>\n            \n            <div class="path-action">\n              <h4>å…·ä½“çš„ãªè¡Œå‹•</h4>\n              <p>${n.pathB.action}</p>\n            </div>\n            \n            <div class="outcome-preview">\n              <h4>äºˆæƒ³ã•ã‚Œã‚‹å±•é–‹</h4>\n              <div class="outcome-stats">\n                <div class="stat-item warning">\n                  <span class="stat-label">ãƒªã‚¹ã‚¯</span>\n                  <span class="stat-value">${n.pathB.outcome.risk}</span>\n                </div>\n                <div class="stat-item warning">\n                  <span class="stat-label">å¯èƒ½æ€§</span>\n                  <span class="stat-value">${n.pathB.outcome.potential}</span>\n                </div>\n              </div>\n              \n              <div class="transformation-hint">\n                <span class="from-hex">${n.situation.hexagramName}</span>\n                <span class="arrow">â†’</span>\n                <span class="to-hex">${n.pathB.outcome.transformation?.toHexagram?.name||"å¤‰åŒ–äºˆæ¸¬ä¸­"}</span>\n              </div>\n            </div>\n          </div>\n          \n          <div class="card-footer">\n            <button class="select-path-btn" data-path="pathB">\n              ã“ã®é“ã‚’è©³ã—ãè¦‹ã‚‹\n            </button>\n          </div>\n        </div>\n      </div>\n    `}displayPathDetails(n){console.log("ğŸ” é“ã®è©³ç´°è¡¨ç¤º:",n),this.selectedPath=n;const i=this.currentChoices[n];this.highlightSelectedCard(n),this.displayTransformationPreview(i),this.displayHaQeiChoiceAnalysis(i),this.showConfirmationButton()}highlightSelectedCard(n){this.container.querySelectorAll(".choice-card").forEach(n=>{n.classList.remove("selected")});const i=this.container.querySelector(`[data-path="${n}"]`);i&&i.classList.add("selected")}displayTransformationPreview(n){const i=document.getElementById("transformationPreview"),s=n.outcome.transformation;s?(i.innerHTML=`\n      <div class="transformation-content">\n        <h3>ğŸ”® å¤‰åŒ–ã®äºˆæ¸¬</h3>\n        \n        <div class="transformation-visual">\n          <div class="transformation-stages">\n            <div class="stage current">\n              <div class="hexagram-display">\n                <div class="hex-name">${s.fromHexagram.name}</div>\n                <div class="hex-binary">${this.formatBinary(s.fromHexagram.binary)}</div>\n                <div class="stage-label">ç¾åœ¨ã®çŠ¶æ³</div>\n              </div>\n            </div>\n            \n            <div class="transformation-arrow">\n              <div class="changing-info">\n                <div class="changing-lines">\n                  ${s.changingLines.map(n=>`<span class="changing-line">ç¬¬${n}çˆ»å¤‰åŒ–</span>`).join("")}\n                </div>\n                <div class="arrow-symbol">âŸ¶</div>\n              </div>\n            </div>\n            \n            <div class="stage future">\n              <div class="hexagram-display">\n                <div class="hex-name">${s.toHexagram.name}</div>\n                <div class="hex-binary">${this.formatBinary(s.toHexagram.binary)}</div>\n                <div class="stage-label">å¤‰åŒ–å¾Œã®çŠ¶æ³</div>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <div class="transformation-details">\n          <div class="transformation-nature">\n            <h4>å¤‰åŒ–ã®æ€§è³ª</h4>\n            <p>${s.transformationNature?.description||"å¤‰åŒ–ã®æ€§è³ªã‚’åˆ†æä¸­..."}</p>\n          </div>\n          \n          <div class="transformation-timeline">\n            <h4>å¤‰åŒ–ã®æ™‚é–“è»¸</h4>\n            <div class="timeline-phases">\n              ${s.timeline?.phases?.map(n=>`\n                <div class="timeline-phase">\n                  <span class="phase-name">${n.name}</span>\n                  <span class="phase-duration">${n.duration}</span>\n                </div>\n              `).join("")||'<div class="timeline-phase">æ™‚é–“è»¸ã‚’åˆ†æä¸­...</div>'}\n            </div>\n          </div>\n        </div>\n        \n        <div class="transformation-guidance">\n          <h4>å¤‰åŒ–ã¸ã®æŒ‡é‡</h4>\n          <div class="guidance-content">\n            <p>${s.guidance||n.outcome.guidance||"ã“ã®é“ã‚’é€²ã‚€å ´åˆã®å…·ä½“çš„ãªæŒ‡é‡ã‚’æº–å‚™ä¸­..."}</p>\n          </div>\n        </div>\n      </div>\n    `,i.style.display="block"):i.style.display="none"}displayHaQeiChoiceAnalysis(n){const i=document.getElementById("HaQeiChoiceAnalysis"),s=n.HaQeiGuidance;s?(i.innerHTML=`\n      <div class="HaQei-choice-content">\n        <h3>ğŸ‘¥ HaQeiåˆ†äººé–“é¸æŠåˆ†æ</h3>\n        <div class="HaQei-subtitle">\n          ã“ã®é¸æŠã«å¯¾ã™ã‚‹ã€ã‚ãªãŸã®å„åˆ†äººã®åå¿œ\n        </div>\n        \n        <div class="persona-choice-reactions">\n          ${Object.entries(s).filter(([n])=>"integration"!==n).map(([n,i])=>`\n            <div class="persona-reaction">\n              <div class="persona-header">\n                <h4>${this.getPersonaTitle(n)}</h4>\n                <div class="persona-icon">${this.getPersonaIcon(n)}</div>\n              </div>\n              <div class="persona-response">\n                <div class="response-section">\n                  <strong>ã“ã®åˆ†äººã®è¦–ç‚¹ï¼š</strong>\n                  <p>${i.perspective||"ã“ã®é¸æŠã«å¯¾ã™ã‚‹è¦‹è§£ã‚’åˆ†æä¸­..."}</p>\n                </div>\n                <div class="response-section">\n                  <strong>æ¨å¥¨ã•ã‚Œã‚‹è¡Œå‹•ï¼š</strong>\n                  <p>${i.action||"å…·ä½“çš„ãªè¡Œå‹•æŒ‡é‡ã‚’æº–å‚™ä¸­..."}</p>\n                </div>\n                <div class="response-section">\n                  <strong>æ³¨æ„ã™ã¹ãç‚¹ï¼š</strong>\n                  <p>${i.caution||"æ³¨æ„ç‚¹ã‚’ç¢ºèªä¸­..."}</p>\n                </div>\n              </div>\n            </div>\n          `).join("")}\n        </div>\n        \n        <div class="integration-guidance">\n          <h4>ğŸŒŸ åˆ†äººé–“çµ±åˆã‚¬ã‚¤ãƒ€ãƒ³ã‚¹</h4>\n          <div class="integration-content">\n            <p>${s.integration?.guidance||"ã“ã®é¸æŠã«ãŠã„ã¦ã€ã‚ãªãŸã®ç•°ãªã‚‹åˆ†äººãŒã©ã®ã‚ˆã†ã«å”åŠ›ã—åˆã†ã‹ã‚’åˆ†æä¸­..."}</p>\n          </div>\n        </div>\n      </div>\n    `,i.style.display="block"):i.style.display="none"}getPersonaTitle(n){return{analyticalSelf:"åˆ†æçš„ãªåˆ†äºº",emotionalSelf:"æ„Ÿæƒ…çš„ãªåˆ†äºº",socialSelf:"ç¤¾ä¼šçš„ãªåˆ†äºº",spiritualSelf:"ç²¾ç¥çš„ãªåˆ†äºº"}[n]||n}getPersonaIcon(n){return{analyticalSelf:"ğŸ§ ",emotionalSelf:"â¤ï¸",socialSelf:"ğŸ‘¥",spiritualSelf:"ğŸŒŸ"}[n]||"ğŸ­"}showConfirmationButton(){document.getElementById("choiceConfirmation").style.display="block"}confirmChoice(){if(!this.selectedPath||!this.currentChoices)return console.warn("âš ï¸ é¸æŠãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“"),null;const n={selectedPath:this.selectedPath,choiceData:this.currentChoices[this.selectedPath],timestamp:(new Date).toISOString(),situation:this.currentChoices.situation};return console.log("âœ… é¸æŠç¢ºå®š:",n),this.dispatchChoiceConfirmed(n),n}dispatchChoiceConfirmed(n){const i=new CustomEvent("choiceConfirmed",{detail:n,bubbles:!0});this.container.dispatchEvent(i)}formatBinary(n){return n&&Array.isArray(n)?n.map(n=>1===n?"â”â”â”":"â” â”").reverse().join("<br>"):""}parseLinePosition(n){return{"åˆä¹":1,"åˆå…­":1,"ä¹äºŒ":2,"å…­äºŒ":2,"ä¹ä¸‰":3,"å…­ä¸‰":3,"ä¹å››":4,"å…­å››":4,"ä¹äº”":5,"å…­äº”":5,"ä¸Šä¹":6,"ä¸Šå…­":6}[n]||1}displayErrorState(){document.getElementById("choiceOptions").innerHTML='\n      <div class="error-state">\n        <div class="error-icon">âš ï¸</div>\n        <h3>é¸æŠè‚¢ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ</h3>\n        <p>ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚</p>\n        <button class="retry-button" onclick="location.reload()">\n          å†è©¦è¡Œ\n        </button>\n      </div>\n    '}attachEventListeners(){this.container.addEventListener("click",n=>{if(n.target.classList.contains("select-path-btn")){const i=n.target.dataset.path;this.displayPathDetails(i)}"confirmChoiceBtn"===n.target.id&&this.confirmChoice()})}getCurrentChoices(){return this.currentChoices}getSelectedPath(){return this.selectedPath}reset(){this.currentChoices=null,this.selectedPath=null,this.initializeChoiceSystem()}}"undefined"!=typeof window&&(window.AuthenticChoiceSystem=AuthenticChoiceSystem),"undefined"!=typeof module&&module.exports&&(module.exports=AuthenticChoiceSystem),console.log("ğŸ­ AuthenticChoiceSystem.js èª­ã¿è¾¼ã¿å®Œäº†");