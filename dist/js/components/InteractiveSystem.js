class InteractiveSystem extends BaseComponent{constructor(t,e={}){super(t,e),this.expandedCards=new Set,this.activeTooltips=new Map,this.termsDatabase=null,this.tabStates=new Map,this.init()}get defaultOptions(){return{...super.defaultOptions,enableCardExpansion:!0,enableTooltips:!0,enableTabs:!0,animationDuration:300,tooltipDelay:500,maxExpandedCards:3}}init(){this.initializeTermsDatabase(),this.setupEventListeners(),this.initializeTooltipSystem()}initializeTermsDatabase(){this.termsDatabase={"ä¹¾ç‚ºå¤©":{reading:"ã‘ã‚“ã„ã¦ã‚“",category:"hexagram",description:"å‰µé€ åŠ›ã¨æŒ‡å°åŠ›ã‚’è¡¨ã™64å¦ã®ç¬¬1ç•ªã€‚å¤©ã®è±¡å¾´ã§ã€ç©æ¥µçš„ã§å‰µé€ çš„ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’æ„å‘³ã—ã¾ã™ã€‚",context:"ã‚¨ãƒ³ã‚¸ãƒ³OSã¨ã—ã¦ç¾ã‚Œã‚‹ã¨ã€å¼·ã„æ„å¿—åŠ›ã¨é©æ–°æ€§ã‚’æŒã¤ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚"},"ç«é¢¨é¼":{reading:"ã‹ãµã†ã¦ã„",category:"hexagram",description:"å¤‰é©ã¨å®‰å®šåŒ–ã‚’è¡¨ã™64å¦ã®ç¬¬50ç•ªã€‚å¤ã„ç§©åºã‚’æ”¹é©ã—ã€æ–°ã—ã„å®‰å®šã‚’ç¯‰ãåŠ›ã‚’æ„å‘³ã—ã¾ã™ã€‚",context:"èª¿å’Œã‚’é‡è¦–ã—ãªãŒã‚‰å¿…è¦ãªå¤‰é©ã‚’è¡Œã†ã€ãƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šã«å„ªã‚ŒãŸç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚"},"ã‚¨ãƒ³ã‚¸ãƒ³OS":{category:"system",description:"å€‹äººã®æ ¹æºçš„ãªä¾¡å€¤è¦³ã‚„å‹•æ©Ÿã‚’è¡¨ã™ã‚·ã‚¹ãƒ†ãƒ ã€‚å†…é¢çš„ãªé§†å‹•åŠ›ã‚„å‰µé€ æ€§ã®æºæ³‰ã¨ãªã‚Šã¾ã™ã€‚",context:"è¨ºæ–­ã§ã¯ä¸»ã«è³ªå•1-20ã®å›ç­”ã‹ã‚‰åˆ†æã•ã‚Œã€ãã®äººã®æ ¸ã¨ãªã‚‹å¿—å‘æ€§ã‚’ç¤ºã—ã¾ã™ã€‚"},"ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹OS":{category:"system",description:"å¤–é¢çš„ãªè¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„ä»–è€…ã¨ã®é–¢ã‚ã‚Šæ–¹ã‚’è¡¨ã™ã‚·ã‚¹ãƒ†ãƒ ã€‚ç¤¾ä¼šçš„ãªé¡”ã‚„è¡¨ç¾æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚",context:"è³ªå•21-40ã®å›ç­”ã‹ã‚‰åˆ†æã•ã‚Œã€è·å ´ã‚„ç¤¾ä¼šã§ã®æŒ¯ã‚‹èˆã„æ–¹ã®ç‰¹å¾´ã‚’è¡¨ã—ã¾ã™ã€‚"},"ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰OS":{category:"system",description:"ã‚¹ãƒˆãƒ¬ã‚¹ã‚„å›°é›£ãªçŠ¶æ³ã§ã®é˜²å¾¡æ©Ÿåˆ¶ã‚’è¡¨ã™ã‚·ã‚¹ãƒ†ãƒ ã€‚å¿ƒã®å®‰å…¨è£…ç½®ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚",context:"è³ªå•41-60ã®å›ç­”ã‹ã‚‰åˆ†æã•ã‚Œã€å±æ©Ÿçš„çŠ¶æ³ã§ã®å¯¾å‡¦ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¤ºã—ã¾ã™ã€‚"},"å…«å¦":{reading:"ã¯ã£ã‘",category:"concept",description:"æ˜“çµŒã®åŸºæœ¬è¦ç´ ã§ã€8ã¤ã®åŸºæœ¬çš„ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¡¨ã—ã¾ã™ã€‚ä¹¾ãƒ»å…Œãƒ»é›¢ãƒ»éœ‡ãƒ»å·½ãƒ»åãƒ»è‰®ãƒ»å¤ã®8ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚",context:"64å¦ã¯2ã¤ã®å…«å¦ã®çµ„ã¿åˆã‚ã›ã§æ§‹æˆã•ã‚Œã€ä¸Šå¦ã¨ä¸‹å¦ã¨ã„ã†å½¢ã§è¡¨ç¾ã•ã‚Œã¾ã™ã€‚"},"ä¸€è²«æ€§ã‚¹ã‚³ã‚¢":{category:"metric",description:"3ã¤ã®OSé–“ã®èª¿å’Œåº¦ã‚’0-100%ã§è¡¨ã—ãŸã‚¹ã‚³ã‚¢ã€‚é«˜ã„ã»ã©å†…é¢ã¨å¤–é¢ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚",context:"70%ä»¥ä¸Šã¯é«˜ã„ä¸€è²«æ€§ã€50-69%ã¯ä¸­ç¨‹åº¦ã€50%æœªæº€ã¯å¤šæ§˜æ€§ã«å¯Œã‚€è¤‡é›‘ãªäººæ ¼ã‚’ç¤ºã—ã¾ã™ã€‚"},"ç›¸æ€§ã‚¿ã‚¤ãƒ—":{category:"compatibility",description:"OSé–“ã®é–¢ä¿‚æ€§ã‚’5ã¤ã®ã‚¿ã‚¤ãƒ—ã§åˆ†é¡ã—ãŸã‚‚ã®ã€‚SYNERGYï¼ˆç›¸ä¹—åŠ¹æœï¼‰ã€HARMONYï¼ˆèª¿å’Œï¼‰ã€TENSIONï¼ˆç·Šå¼µï¼‰ã€CONFLICTï¼ˆè‘›è—¤ï¼‰ã€CHAOSï¼ˆæ··æ²Œï¼‰ãŒã‚ã‚Šã¾ã™ã€‚",context:"å„ã‚¿ã‚¤ãƒ—ã«ã¯ç‰¹æœ‰ã®ç‰¹å¾´ã¨æˆé•·ã®ãƒ’ãƒ³ãƒˆãŒã‚ã‚Šã€å†…çš„çµ±åˆã®æŒ‡é‡ã¨ãªã‚Šã¾ã™ã€‚"},SYNERGY:{category:"compatibility_type",description:"ç›¸ä¹—åŠ¹æœå‹ã€‚2ã¤ã®OSãŒäº’ã„ã‚’é«˜ã‚åˆã„ã€1+1ãŒ3ä»¥ä¸Šã«ãªã‚‹é–¢ä¿‚æ€§ã€‚",context:"ã“ã®é–¢ä¿‚ã‚’æ´»ã‹ã™ã“ã¨ã§ã€å€‹äººã®å¯èƒ½æ€§ã‚’æœ€å¤§é™ã«ç™ºæ®ã§ãã¾ã™ã€‚"},HARMONY:{category:"compatibility_type",description:"èª¿å’Œå‹ã€‚2ã¤ã®OSãŒè‡ªç„¶ã«æº¶ã‘åˆã„ã€å®‰å®šã—ãŸçµ±åˆã‚’ç¤ºã™é–¢ä¿‚æ€§ã€‚",context:"ã‚¹ãƒˆãƒ¬ã‚¹ãŒå°‘ãªãã€æŒç¶šå¯èƒ½ãªæˆé•·ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¯‰ãã‚„ã™ã„ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚"},TENSION:{category:"compatibility_type",description:"ç·Šå¼µå‹ã€‚2ã¤ã®OSã«é©åº¦ãªç·Šå¼µé–¢ä¿‚ãŒã‚ã‚Šã€å‰µé€ çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ç”Ÿã¿å‡ºã™é–¢ä¿‚æ€§ã€‚",context:"ã“ã®ç·Šå¼µã‚’å»ºè¨­çš„ã«æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€æ–°ã—ã„ç™ºè¦‹ã‚„æˆé•·ã«ã¤ãªãŒã‚Šã¾ã™ã€‚"},CONFLICT:{category:"compatibility_type",description:"è‘›è—¤å‹ã€‚2ã¤ã®OSãŒå¯¾ç«‹çš„ãªé–¢ä¿‚ã«ã‚ã‚Šã€å†…çš„ãªè‘›è—¤ã‚’ç”Ÿã˜ã•ã›ã‚‹é–¢ä¿‚æ€§ã€‚",context:"é©åˆ‡ã«çµ±åˆã™ã‚‹ã“ã¨ã§ã€å¤šæ§˜æ€§ã«å¯Œã‚“ã è±Šã‹ãªäººæ ¼ã®å½¢æˆãŒå¯èƒ½ã§ã™ã€‚"},CHAOS:{category:"compatibility_type",description:"æ··æ²Œå‹ã€‚2ã¤ã®OSã®é–¢ä¿‚æ€§ãŒäºˆæ¸¬å›°é›£ã§ã€å¤‰åŒ–ã«å¯Œã‚“ã ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãªé–¢ä¿‚æ€§ã€‚",context:"æŸ”è»Ÿæ€§ã¨é©å¿œåŠ›ã«å„ªã‚Œã€å¤‰åŒ–ã®å¤šã„ç’°å¢ƒã§åŠ›ã‚’ç™ºæ®ã—ã‚„ã™ã„ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚"}}}initializeCardExpansion(){this.container.querySelectorAll(".os-detail-card, .os-card").forEach(t=>{const e=t.dataset.cardId||t.className.split(" ").find(t=>t.includes("card"));if(!t.querySelector(".expand-button")){const i=document.createElement("button");i.className="expand-button",i.innerHTML='<span class="expand-icon">â¬‡</span> è©³ç´°ã‚’è¡¨ç¤º',i.setAttribute("aria-label","ã‚«ãƒ¼ãƒ‰ã®è©³ç´°æƒ…å ±ã‚’å±•é–‹"),t.appendChild(i),i.addEventListener("click",i=>{i.stopPropagation(),this.toggleCardExpansion(t,e)})}})}toggleCardExpansion(t,e){if(this.expandedCards.has(e))this.collapseCard(t,e);else{if(this.expandedCards.size>=this.options.maxExpandedCards)return void this.showMessage("ä¸€åº¦ã«å±•é–‹ã§ãã‚‹ã‚«ãƒ¼ãƒ‰ã¯"+this.options.maxExpandedCards+"æšã¾ã§ã§ã™ã€‚","warning");this.expandCard(t,e)}}expandCard(t,e){this.expandedCards.add(e),t.style.transition=`all ${this.options.animationDuration}ms cubic-bezier(0.4, 0, 0.2, 1)`,t.classList.add("expanded"),this.showExpandedContent(t,e);const i=t.querySelector(".expand-button");i&&(i.innerHTML='<span class="expand-icon">â¬†</span> è©³ç´°ã‚’é–‰ã˜ã‚‹'),t.setAttribute("aria-expanded","true"),this.trackEvent("card_expanded",{cardId:e})}collapseCard(t,e){this.expandedCards.delete(e),t.style.transition=`all ${this.options.animationDuration}ms cubic-bezier(0.4, 0, 0.2, 1)`,t.classList.remove("expanded"),this.hideExpandedContent(t,e);const i=t.querySelector(".expand-button");i&&(i.innerHTML='<span class="expand-icon">â¬‡</span> è©³ç´°ã‚’è¡¨ç¤º'),t.setAttribute("aria-expanded","false"),this.trackEvent("card_collapsed",{cardId:e})}showExpandedContent(t,e){let i=t.querySelector(".expanded-content");i||(i=document.createElement("div"),i.className="expanded-content",t.appendChild(i));const n=this.getCardContentType(t);i.innerHTML=this.generateExpandedContent(e,n),setTimeout(()=>{i.style.opacity="1",i.style.transform="translateY(0)"},50)}hideExpandedContent(t,e){const i=t.querySelector(".expanded-content");i&&(i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>{i.parentNode&&i.remove()},this.options.animationDuration))}getCardContentType(t){return t.classList.contains("os-detail-card-engine")?"engine":t.classList.contains("os-detail-card-interface")?"interface":t.classList.contains("os-detail-card-safemode")?"safemode":"general"}generateExpandedContent(t,e){const i=`\n            <div class="expanded-tabs">\n                <div class="tab-headers">\n                    <button class="tab-header active" data-tab="overview">æ¦‚è¦</button>\n                    <button class="tab-header" data-tab="details">è©³ç´°</button>\n                    <button class="tab-header" data-tab="advice">ã‚¢ãƒ‰ãƒã‚¤ã‚¹</button>\n                </div>\n                <div class="tab-contents">\n                    <div class="tab-content active" data-tab="overview">\n                        ${this.generateOverviewContent(e)}\n                    </div>\n                    <div class="tab-content" data-tab="details">\n                        ${this.generateDetailsContent(e)}\n                    </div>\n                    <div class="tab-content" data-tab="advice">\n                        ${this.generateAdviceContent(e)}\n                    </div>\n                </div>\n            </div>\n            <div class="expanded-actions">\n                <button class="btn btn-primary more-info-btn">\n                    ğŸ“š ã‚‚ã£ã¨è©³ã—ã\n                </button>\n                <button class="btn btn-secondary share-btn">\n                    ğŸ“¤ ã“ã®æƒ…å ±ã‚’å…±æœ‰\n                </button>\n            </div>\n        `;return setTimeout(()=>this.initializeTabSystem(t),100),i}generateOverviewContent(t){const e={engine:"\n                <h4>ğŸ”§ ã‚¨ãƒ³ã‚¸ãƒ³OSã®ç‰¹å¾´</h4>\n                <p>ã‚ãªãŸã®æ ¹æºçš„ãªä¾¡å€¤è¦³ã¨å‹•æ©Ÿã‚’è¡¨ã™ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚å‰µé€ æ€§ã€æƒ…ç†±ã€ãã—ã¦å†…ãªã‚‹ç›®æ¨™ãŒã“ã“ã«ç¾ã‚Œã¾ã™ã€‚</p>\n                <ul>\n                    <li>å€‹äººã®æ ¸ã¨ãªã‚‹ä¾¡å€¤è¦³</li>\n                    <li>å‰µé€ çš„ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æºæ³‰</li>\n                    <li>é•·æœŸçš„ãªäººç”Ÿã®æ–¹å‘æ€§</li>\n                </ul>\n            ",interface:"\n                <h4>ğŸ–¥ï¸ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹OSã®ç‰¹å¾´</h4>\n                <p>å¤–éƒ¨ä¸–ç•Œã¨ã®é–¢ã‚ã‚Šæ–¹ã‚’è¡¨ã™ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ç¤¾ä¼šçš„ãªé¡”ãŒã“ã“ã«ç¾ã‚Œã¾ã™ã€‚</p>\n                <ul>\n                    <li>ä»–è€…ã¨ã®é–¢ã‚ã‚Šæ–¹</li>\n                    <li>è·å ´ã§ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«</li>\n                    <li>ç¤¾ä¼šçš„ãªè¡¨ç¾æ–¹æ³•</li>\n                </ul>\n            ",safemode:"\n                <h4>ğŸ›¡ï¸ ã‚»ãƒ¼ãƒ•ãƒ¢ãƒ¼ãƒ‰OSã®ç‰¹å¾´</h4>\n                <p>å›°é›£ãªçŠ¶æ³ã§ã®å¯¾å‡¦æ–¹æ³•ã‚’è¡¨ã™ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã‚¹ãƒˆãƒ¬ã‚¹å¯¾å¿œã€é˜²å¾¡æ©Ÿåˆ¶ã€å†…é¢ã®å®‰å…¨è£…ç½®ãŒã“ã“ã«ç¾ã‚Œã¾ã™ã€‚</p>\n                <ul>\n                    <li>ã‚¹ãƒˆãƒ¬ã‚¹çŠ¶æ³ã§ã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³</li>\n                    <li>å¿ƒç†çš„ãªé˜²å¾¡ãƒ¡ã‚«ãƒ‹ã‚ºãƒ </li>\n                    <li>å±æ©Ÿç®¡ç†ã¨ãƒªã‚¹ã‚¯å¯¾å¿œ</li>\n                </ul>\n            "};return e[t]||e.engine}generateDetailsContent(t){return'\n            <h4>ğŸ“Š è©³ç´°åˆ†æãƒ‡ãƒ¼ã‚¿</h4>\n            <div class="detail-metrics">\n                <div class="metric-item">\n                    <span class="metric-label">ä¸»è¦ç‰¹å¾´:</span>\n                    <span class="metric-value">å‰µé€ æ€§é‡è¦–å‹</span>\n                </div>\n                <div class="metric-item">\n                    <span class="metric-label">ã‚¨ãƒãƒ«ã‚®ãƒ¼å‚¾å‘:</span>\n                    <span class="metric-value">å¤–å‘æ€§ 85%</span>\n                </div>\n                <div class="metric-item">\n                    <span class="metric-label">å®‰å®šæ€§:</span>\n                    <span class="metric-value">ä¸­ç¨‹åº¦</span>\n                </div>\n            </div>\n            <p>ã“ã®OSã¯ç‰¹ã«å‰µé€ çš„ãªå ´é¢ã§åŠ›ã‚’ç™ºæ®ã—ã€æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚„è§£æ±ºç­–ã‚’ç”Ÿã¿å‡ºã™ã“ã¨ã«é•·ã‘ã¦ã„ã¾ã™ã€‚</p>\n        '}generateAdviceContent(t){return'\n            <h4>ğŸ’¡ å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h4>\n            <div class="advice-sections">\n                <div class="advice-section">\n                    <h5>ğŸ¯ å¼·ã¿ã‚’æ´»ã‹ã™ãŸã‚ã«</h5>\n                    <ul>\n                        <li>å‰µé€ çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç©æ¥µçš„ã«å‚åŠ ã™ã‚‹</li>\n                        <li>æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å½¢ã«ã™ã‚‹æ©Ÿä¼šã‚’æ±‚ã‚ã‚‹</li>\n                        <li>ãƒãƒ¼ãƒ ã®ç™ºæƒ³åŠ›ã‚’å‘ä¸Šã•ã›ã‚‹å½¹å‰²ã‚’æ‹…ã†</li>\n                    </ul>\n                </div>\n                <div class="advice-section">\n                    <h5>âš ï¸ æ³¨æ„ã™ã¹ããƒã‚¤ãƒ³ãƒˆ</h5>\n                    <ul>\n                        <li>ç´°ã‹ã„ä½œæ¥­ã¸ã®é›†ä¸­åŠ›ä¸è¶³ã«æ³¨æ„</li>\n                        <li>å®Œç’§ä¸»ç¾©ã«é™¥ã‚‰ãªã„ã‚ˆã†æ„è­˜ã™ã‚‹</li>\n                        <li>ä»–è€…ã®æ„è¦‹ã«ã‚‚è€³ã‚’å‚¾ã‘ã‚‹</li>\n                    </ul>\n                </div>\n            </div>\n        '}initializeTooltipSystem(){this.addTooltipsToTerms(),this.setupDynamicTooltips()}addTooltipsToTerms(){const t=this.getAllTextNodes();Object.keys(this.termsDatabase).forEach(e=>{t.forEach(t=>{t.textContent.includes(e)&&this.wrapTermWithTooltip(t,e)})})}wrapTermWithTooltip(t,e){const i=t.parentNode;if(i.classList.contains("tooltip-term"))return;const n=t.textContent,a=n.indexOf(e);if(-1!==a){const s=n.substring(0,a),o=n.substring(a+e.length),d=document.createElement("span");d.className="tooltip-term",d.setAttribute("data-term",e),d.textContent=e,s&&i.insertBefore(document.createTextNode(s),t),i.insertBefore(d,t),o&&i.insertBefore(document.createTextNode(o),t),i.removeChild(t),this.attachTooltipEvents(d,e)}}attachTooltipEvents(t,e){let i,n;t.addEventListener("mouseenter",a=>{clearTimeout(n),i=setTimeout(()=>{this.showTooltip(t,e,a)},this.options.tooltipDelay)}),t.addEventListener("mouseleave",()=>{clearTimeout(i),n=setTimeout(()=>{this.hideTooltip(e)},100)}),t.addEventListener("focus",i=>{this.showTooltip(t,e,i)}),t.addEventListener("blur",()=>{this.hideTooltip(e)}),t.addEventListener("touchstart",i=>{i.preventDefault(),this.showTooltip(t,e,i)})}showTooltip(t,e,i){if(this.activeTooltips.has(e))return;const n=this.termsDatabase[e];if(!n)return;const a=document.createElement("div");a.className="tooltip-popup",a.innerHTML=`\n            <div class="tooltip-header">\n                <h4>${e}</h4>\n                ${n.reading?`<span class="tooltip-reading">(${n.reading})</span>`:""}\n                <span class="tooltip-category">${this.getCategoryLabel(n.category)}</span>\n            </div>\n            <div class="tooltip-content">\n                <p class="tooltip-description">${n.description}</p>\n                ${n.context?`<p class="tooltip-context"><strong>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ:</strong> ${n.context}</p>`:""}\n            </div>\n        `,document.body.appendChild(a),this.positionTooltip(a,t,i),setTimeout(()=>{a.classList.add("visible")},10),this.activeTooltips.set(e,a),this.trackEvent("tooltip_shown",{term:e})}hideTooltip(t){const e=this.activeTooltips.get(t);e&&(e.classList.remove("visible"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),this.activeTooltips.delete(t)},200))}positionTooltip(t,e,i){const n=e.getBoundingClientRect(),a=t.getBoundingClientRect();let s=n.left+n.width/2-a.width/2,o=n.top-a.height-10;s<10&&(s=10),s+a.width>window.innerWidth-10&&(s=window.innerWidth-a.width-10),o<10&&(o=n.bottom+10,t.classList.add("bottom")),t.style.left=s+"px",t.style.top=o+"px"}getCategoryLabel(t){return{hexagram:"64å¦",system:"ã‚·ã‚¹ãƒ†ãƒ ",concept:"æ¦‚å¿µ",metric:"æŒ‡æ¨™",compatibility:"ç›¸æ€§",compatibility_type:"ç›¸æ€§ã‚¿ã‚¤ãƒ—"}[t]||"ç”¨èª"}initializeTabSystem(t){const e=this.container.querySelectorAll(`[data-card-id="${t}"] .tab-header`),i=this.container.querySelectorAll(`[data-card-id="${t}"] .tab-content`);e.forEach(n=>{n.addEventListener("click",n=>{const a=n.target.dataset.tab;this.switchTab(t,a,e,i)})}),this.tabStates.set(t,"overview")}switchTab(t,e,i,n){i.forEach(t=>{t.classList.remove("active"),t.dataset.tab===e&&t.classList.add("active")}),n.forEach(t=>{t.classList.remove("active"),t.dataset.tab===e&&t.classList.add("active")}),this.tabStates.set(t,e),this.trackEvent("tab_switched",{cardId:t,targetTab:e})}setupDynamicTooltips(){new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&this.addTooltipsToElement(t)})})}).observe(this.container,{childList:!0,subtree:!0})}addTooltipsToElement(t){const e=this.getAllTextNodes(t);Object.keys(this.termsDatabase).forEach(t=>{e.forEach(e=>{e.textContent.includes(t)&&this.wrapTermWithTooltip(e,t)})})}getAllTextNodes(t=this.container){const e=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let n;for(;n=i.nextNode();)n.textContent.trim()&&e.push(n);return e}setupEventListeners(){document.addEventListener("keydown",t=>{"Escape"===t.key&&this.collapseAllCards()}),window.addEventListener("resize",()=>{this.activeTooltips.forEach((t,e)=>{this.hideTooltip(e)})})}collapseAllCards(){Array.from(this.expandedCards).forEach(t=>{const e=this.container.querySelector(`[data-card-id="${t}"]`);e&&this.collapseCard(e,t)})}showMessage(t,e="info"){const i=document.createElement("div");i.className=`interactive-message ${e}`,i.textContent=t,this.container.appendChild(i),setTimeout(()=>{i.classList.add("visible")},10),setTimeout(()=>{i.classList.remove("visible"),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300)},3e3)}trackEvent(t,e={}){console.log(`ğŸ“Š Event tracked: ${t}`,e)}activate(){this.options.enableCardExpansion&&this.initializeCardExpansion(),this.options.enableTooltips&&this.initializeTooltipSystem(),console.log("âœ… Interactive System activated")}destroy(){this.activeTooltips.forEach((t,e)=>{this.hideTooltip(e)}),this.collapseAllCards(),super.destroy()}}export default InteractiveSystem;