class CriticalProductiveCard{constructor(i,e={}){this.containerId=i,this.container=document.getElementById(i),this.shadowAnalyzer=e.shadowAnalyzer||(window.ShadowAnalyzer?new window.ShadowAnalyzer:null),this.criticalThinkingEngine=e.criticalThinkingEngine||(window.CriticalThinkingEngine?new window.CriticalThinkingEngine:null),this.analysisResult=e.analysisResult,this.osData=e.osData,this.score=e.score,this.hexagramDetails=e.hexagramDetails,this.isInitialized=!1,this.cardData=null,console.log("ğŸ§  [CriticalProductiveCard] åˆæœŸåŒ–å®Œäº†",{containerId:i,hasShadowAnalyzer:!!this.shadowAnalyzer,hasCriticalEngine:!!this.criticalThinkingEngine,score:this.score})}async init(){try{if(console.log("ğŸš€ [CriticalProductiveCard] ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–‹å§‹"),!this.container)throw new Error(`Container not found: ${this.containerId}`);await this._generateCardData(),await this._render(),this._setupEventListeners(),this.isInitialized=!0,console.log("âœ… [CriticalProductiveCard] ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†")}catch(i){console.error("âŒ [CriticalProductiveCard] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:",i),this._renderError(i.message)}}async _generateCardData(){console.log("ğŸ”„ [CriticalProductiveCard] ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆé–‹å§‹"),this.cardData={osName:this.osData?.osName||"æœªç‰¹å®šOS",score:this.score||0,scoreRange:this._getScoreRange(this.score),critical:await this._generateCriticalContent(),productive:await this._generateProductiveContent(),dynamicInsights:await this._generateDynamicInsights()},console.log("âœ… [CriticalProductiveCard] ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†",this.cardData)}async _generateCriticalContent(){if(!this.shadowAnalyzer||!this.osData)return console.warn("âš ï¸ [CriticalProductiveCard] ShadowAnalyzeræœªåˆ©ç”¨ã¾ãŸã¯ osData ä¸è¶³"),this._getFallbackCriticalContent();try{const i=this.shadowAnalyzer.analyzeShadow(this.osData,this.score);return{shadowAspects:i.shadowAspects,blindSpotQuestions:i.selfInquiryQuestions||[],growthChallenges:i.growthChallenges,integrationGuidance:i.integrationGuidance}}catch(i){return console.error("âŒ [CriticalProductiveCard] æ‰¹åˆ¤çš„è¦–ç‚¹ç”Ÿæˆã‚¨ãƒ©ãƒ¼:",i),this._getFallbackCriticalContent()}}async _generateProductiveContent(){if(!this.criticalThinkingEngine)return console.warn("âš ï¸ [CriticalProductiveCard] CriticalThinkingEngineæœªåˆ©ç”¨"),this._getFallbackProductiveContent();try{const i=this._generateScoreBasedQuestions(),e=this._generatePracticalSteps(),n=this._generateBiasRecognition();return{scoreBasedQuestions:i,practicalSteps:e,integrationGuidance:this._generateIntegrationGuidance(),biasRecognition:n}}catch(i){return console.error("âŒ [CriticalProductiveCard] ç”Ÿç”£çš„è¦–ç‚¹ç”Ÿæˆã‚¨ãƒ©ãƒ¼:",i),this._getFallbackProductiveContent()}}async _generateDynamicInsights(){if(!this.hexagramDetails&&!window.HEXAGRAM_DETAILS)return console.warn("âš ï¸ [CriticalProductiveCard] hexagram_detailsæœªåˆ©ç”¨"),null;try{const i=this.osData?.hexagramId||this.osData?.osId,e=this.hexagramDetails||window.HEXAGRAM_DETAILS&&window.HEXAGRAM_DETAILS[i];return e?{engineWeaknesses:e.engine?.potential_weaknesses||[],triggerSituations:e.safe_mode?.trigger_situations||[],defensivePatterns:e.safe_mode?.defensive_patterns||[],strengthToShadowMapping:this._mapStrengthsToShadows(e.engine?.potential_strengths||[])}:(console.warn(`âš ï¸ [CriticalProductiveCard] å¦${i}ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ãªã—`),null)}catch(i){return console.error("âŒ [CriticalProductiveCard] å‹•çš„ã‚¤ãƒ³ã‚µã‚¤ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼:",i),null}}async _render(){const i=`\n            <div class="critical-productive-card" data-score-range="${this.cardData.scoreRange}">\n                ${this._renderHeader()}\n                ${this._renderCriticalSection()}\n                ${this._renderProductiveSection()}\n                ${this._renderDynamicInsightsSection()}\n            </div>\n        `;this.container.innerHTML=i}_renderHeader(){return`\n            <div class="card-header">\n                <h3 class="card-title">ğŸ§  æ‰¹åˆ¤çš„ãƒ»ç”Ÿç”£çš„è¦–ç‚¹</h3>\n                <div class="score-indicator" data-score="${this.cardData.score}%">\n                    <span class="score-value">${this.cardData.score}%</span>\n                    <span class="score-label">${this.cardData.osName}</span>\n                </div>\n            </div>\n        `}_renderCriticalSection(){const i=this.cardData.critical;return`\n            <div class="critical-section collapsible" data-expanded="false">\n                <div class="section-header" onclick="window.criticalProductiveCard.toggleSection(this)">\n                    <h4>ğŸŒ‘ æ‰¹åˆ¤çš„è¦–ç‚¹ <span class="expand-indicator">â–¼</span></h4>\n                </div>\n                <div class="section-content">\n                    ${this._renderShadowAnalysis(i.shadowAspects)}\n                    ${this._renderBlindSpotQuestions(i.blindSpotQuestions)}\n                    ${this._renderGrowthChallenges(i.growthChallenges)}\n                </div>\n            </div>\n        `}_renderProductiveSection(){const i=this.cardData.productive;return`\n            <div class="productive-section collapsible" data-expanded="true">\n                <div class="section-header" onclick="window.criticalProductiveCard.toggleSection(this)">\n                    <h4>ğŸŒ± ç”Ÿç”£çš„è¦–ç‚¹ <span class="expand-indicator">â–²</span></h4>\n                </div>\n                <div class="section-content">\n                    ${this._renderActionQuestions(i.scoreBasedQuestions)}\n                    ${this._renderPracticalSteps(i.practicalSteps)}\n                    ${this._renderIntegrationGuidance(i.integrationGuidance)}\n                </div>\n            </div>\n        `}_renderDynamicInsightsSection(){if(!this.cardData.dynamicInsights)return"";const i=this.cardData.dynamicInsights;return`\n            <div class="dynamic-insights-section collapsible" data-expanded="false">\n                <div class="section-header" onclick="window.criticalProductiveCard.toggleSection(this)">\n                    <h4>ğŸ’¡ å‹•çš„ã‚¤ãƒ³ã‚µã‚¤ãƒˆ <span class="expand-indicator">â–¼</span></h4>\n                </div>\n                <div class="section-content">\n                    ${this._renderHexagramInsights(i)}\n                </div>\n            </div>\n        `}_renderShadowAnalysis(i){if(!i)return"<p>ã‚·ãƒ£ãƒ‰ã‚¦åˆ†æãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>";const e=i.intensity_level||"ä¸æ˜",n=i.likelihood||"0%";return`\n            <div class="shadow-analysis">\n                <h5>å½±ã®å´é¢</h5>\n                <div class="shadow-item" data-intensity="${e}">\n                    <p class="primary-shadow">${i.primary_shadow||"å½±ã®å´é¢ã‚’åˆ†æä¸­..."}</p>\n                    <div class="behavioral-risks">${i.behavioral_risks||""}</div>\n                    <div class="likelihood-meter">\n                        <span class="likelihood-label">ç™ºç¾å¯èƒ½æ€§</span>\n                        <div class="likelihood-bar-container">\n                            <div class="likelihood-bar" style="width: ${n}"></div>\n                        </div>\n                        <span class="likelihood-value">${n}</span>\n                    </div>\n                </div>\n            </div>\n        `}_renderBlindSpotQuestions(i){if(!i||0===i.length)return'<div class="blind-spot-questions"><h5>ç›²ç‚¹ã¸ã®æ°—ã¥ã</h5><p>è³ªå•ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ä¸­...</p></div>';return`\n            <div class="blind-spot-questions">\n                <h5>ç›²ç‚¹ã¸ã®æ°—ã¥ã</h5>\n                <div class="question-list">${i.map(i=>`\n            <div class="question-card">\n                <div class="question-text">${i.question}</div>\n                <div class="question-purpose">${i.purpose}</div>\n            </div>\n        `).join("")}</div>\n            </div>\n        `}_renderGrowthChallenges(i){return i?`\n            <div class="growth-challenges">\n                <h5>æˆé•·èª²é¡Œ</h5>\n                <div class="primary-challenge">${i.primary_challenge||""}</div>\n                <div class="development-areas">\n                    ${(i.development_areas||[]).map(i=>`<span class="area-tag">${i}</span>`).join("")}\n                </div>\n            </div>\n        `:""}_renderActionQuestions(i){if(!i||0===i.length)return'<div class="action-questions"><h5>å»ºè¨­çš„ãªå•ã„ã‹ã‘</h5><p>è³ªå•ã‚’ç”Ÿæˆä¸­...</p></div>';return`\n            <div class="action-questions">\n                <h5>å»ºè¨­çš„ãªå•ã„ã‹ã‘</h5>\n                <div class="question-cards">${i.map(i=>`\n            <div class="question-card">\n                <div class="question-category">${i.category}</div>\n                <div class="question-text">${i.question}</div>\n                <div class="question-purpose">${i.purpose}</div>\n            </div>\n        `).join("")}</div>\n            </div>\n        `}_renderPracticalSteps(i){if(!i||0===i.length)return'<div class="practical-steps"><h5>å®Ÿè·µçš„ã‚¹ãƒ†ãƒƒãƒ—</h5><p>ã‚¹ãƒ†ãƒƒãƒ—ã‚’æº–å‚™ä¸­...</p></div>';return`\n            <div class="practical-steps">\n                <h5>å®Ÿè·µçš„ã‚¹ãƒ†ãƒƒãƒ—</h5>\n                <div class="steps-timeline">${i.map(i=>`\n            <div class="step-item">\n                <div class="step-number">${i.step}</div>\n                <div class="step-content">\n                    <div class="step-action">${i.action}</div>\n                    <div class="step-description">${i.description}</div>\n                </div>\n            </div>\n        `).join("")}</div>\n            </div>\n        `}_renderIntegrationGuidance(i){if(!i)return"";const e=this.cardData?.osName||this.osData?.osName||"æœªç‰¹å®šOS";return`\n            <div class="integration-guidance">\n                <h5>çµ±åˆã‚¬ã‚¤ãƒ€ãƒ³ã‚¹</h5>\n                <div class="mindset-shift">\n                    <div class="from-to-display">\n                        <div class="from">From: ã€Œç§ã¯${e}ã ã€ï¼ˆå›ºå®šçš„æ€è€ƒï¼‰</div>\n                        <div class="arrow">â†’</div>\n                        <div class="to">To: ã€Œç§ã¯${e}ã®å‚¾å‘ãŒã‚ã‚Šã€å½±ã‚‚å«ã‚ã¦æˆé•·ã§ãã‚‹ã€ï¼ˆæˆé•·çš„æ€è€ƒï¼‰</div>\n                    </div>\n                </div>\n            </div>\n        `}_renderHexagramInsights(i){return`\n            <div class="hexagram-insights">\n                <h5>æ˜“çµŒã‹ã‚‰ã®æ´å¯Ÿ</h5>\n                <div class="insights-grid">\n                    <div class="insight-item">\n                        <h6>æ½œåœ¨çš„å¼±ç‚¹</h6>\n                        <ul>${i.engineWeaknesses.map(i=>`<li>${i}</li>`).join("")}</ul>\n                    </div>\n                    <div class="insight-item">\n                        <h6>ãƒˆãƒªã‚¬ãƒ¼çŠ¶æ³</h6>\n                        <ul>${i.triggerSituations.map(i=>`<li>${i}</li>`).join("")}</ul>\n                    </div>\n                    <div class="insight-item">\n                        <h6>é˜²å¾¡ãƒ‘ã‚¿ãƒ¼ãƒ³</h6>\n                        <ul>${i.defensivePatterns.map(i=>`<li>${i}</li>`).join("")}</ul>\n                    </div>\n                </div>\n            </div>\n        `}toggleSection(i){const e=i.parentElement,n="true"===e.getAttribute("data-expanded"),t=i.querySelector(".expand-indicator");e.setAttribute("data-expanded",(!n).toString()),t.textContent=n?"â–¼":"â–²",console.log("ğŸ”„ [CriticalProductiveCard] ã‚»ã‚¯ã‚·ãƒ§ãƒ³"+(n?"æŠ˜ã‚ŠãŸãŸã¿":"å±•é–‹"))}_setupEventListeners(){window.criticalProductiveCard=this,console.log("ğŸ§ [CriticalProductiveCard] ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†")}_getScoreRange(i){return i>=70?"high":i>=30?"medium":"low"}_generateScoreBasedQuestions(){const i=this._getScoreRange(this.score),e=this.cardData?.osName||this.osData?.osName||"æœªç‰¹å®šOS",n=this.score;return{high:[{category:"identity_fixation",question:`ã€Œç§ã¯${e}ã ã‹ã‚‰ã€ã¨ã„ã†è€ƒãˆã§ã€æœ¬æ¥ãªã‚‰å–ã‚‹ã¹ãè¡Œå‹•ã‚’é¿ã‘ãŸçµŒé¨“ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ`,purpose:"ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£å›ºç€ã®æ¤œè¨¼"},{category:"environmental_limits",question:`ã“ã®${e}ã®ç‰¹æ€§ãŒé€šç”¨ã—ãªã„ç’°å¢ƒã‚„ç›¸æ‰‹ã¯ã€å…·ä½“çš„ã«ã©ã®ã‚ˆã†ãªå ´åˆã§ã—ã‚‡ã†ã‹ï¼Ÿ`,purpose:"é©ç”¨é™ç•Œã®ç†è§£"}],medium:[{category:"potential_expansion",question:`ã“ã®${n}%ã¨ã„ã†çµæœã¯ã€ã‚ãªãŸã®æ½œåœ¨çš„ãªå¯èƒ½æ€§ã‚’é©åˆ‡ã«è¡¨ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ`,purpose:"æ½œåœ¨å¯èƒ½æ€§ã®æ¢æ±‚"}],low:[{category:"hidden_potential",question:`ã“ã®${n}%ã¨ã„ã†ä½ã„æ•°å€¤ã¯ã€æœ¬å½“ã«ã‚ãªãŸã®é™ç•Œã‚’ç¤ºã—ã¦ã„ã¾ã™ã‹ï¼Ÿ`,purpose:"éš ã‚ŒãŸå¯èƒ½æ€§ã®ç™ºè¦‹"}]}[i]||[]}_generatePracticalSteps(){return[{step:1,action:"è¦³å¯Ÿ",description:"æ—¥å¸¸ã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ„è­˜çš„ã«è¦³å¯Ÿã™ã‚‹"},{step:2,action:"ä¸€æ™‚åœæ­¢",description:"å•é¡Œã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå‡ºãã†ãªæ™‚ã«ã€ä¸€åº¦ç«‹ã¡æ­¢ã¾ã£ã¦è€ƒãˆã‚‹ç¿’æ…£ã‚’ã¤ã‘ã‚‹"},{step:3,action:"ä»£æ›¿é¸æŠ",description:"ãƒãƒ©ãƒ³ã‚¹ã‚’æ„è­˜ã—ãŸåˆ¥ã®é¸æŠè‚¢ã‚’æ¤œè¨ã™ã‚‹"},{step:4,action:"å°ã•ãªå®Ÿé¨“",description:"ãƒªã‚¹ã‚¯ã®å°‘ãªã„å ´é¢ã§ã€æ–°ã—ã„è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è©¦ã—ã¦ã¿ã‚‹"},{step:5,action:"æŒ¯ã‚Šè¿”ã‚Š",description:"çµæœã‚’æŒ¯ã‚Šè¿”ã‚Šã€å­¦ã³ã‚’æ¬¡ã«æ´»ã‹ã™"}]}_generateBiasRecognition(){return{common_biases:["ç¢ºè¨¼ãƒã‚¤ã‚¢ã‚¹","è‡ªå·±å¥‰ä»•ãƒã‚¤ã‚¢ã‚¹","ãƒ€ãƒ‹ãƒ³ã‚°ãƒ»ã‚¯ãƒ«ãƒ¼ã‚¬ãƒ¼åŠ¹æœ"],measurement_limits:"64é€šã‚Šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§äººé–“ã®è¤‡é›‘ã•ã‚’å®Œå…¨ã«æ‰ãˆã‚‹ã“ã¨ã®é™ç•Œ"}}_generateIntegrationGuidance(){const i=this.cardData?.osName||this.osData?.osName||"æœªç‰¹å®šOS";return{shadow_acceptance:"å½±ã®éƒ¨åˆ†ã‚‚ã€Œã‚ãªãŸã®ä¸€éƒ¨ã€ã¨ã—ã¦å—ã‘å…¥ã‚Œã‚‹ã“ã¨ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™",mindset_shift:{from:`ã€Œç§ã¯${i}ã ã€ï¼ˆå›ºå®šçš„æ€è€ƒï¼‰`,to:`ã€Œç§ã¯${i}ã®å‚¾å‘ãŒã‚ã‚Šã€å½±ã‚‚å«ã‚ã¦æˆé•·ã§ãã‚‹ã€ï¼ˆæˆé•·çš„æ€è€ƒï¼‰`},integration_timeline:"ã™ãã«å¤‰ã‚ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ã€Œæ°—ã¥ãã€ã‹ã‚‰å§‹ã‚ã¦ãã ã•ã„"}}_mapStrengthsToShadows(i){return i.map(i=>`${i} â†’ éåº¦ãªä¾å­˜ã‚„æ¥µç«¯ãªè¡¨ç¾ã«ã‚ˆã‚‹å¼Šå®³`)}_getFallbackCriticalContent(){return{shadowAspects:{primary_shadow:`${this.cardData?.osName||this.osData?.osName||"æœªç‰¹å®šOS"}ã®ç‰¹æ€§ã®éåº¦ãªè¡¨ç¾ã‚„èª¤ç”¨`,behavioral_risks:"ãƒãƒ©ãƒ³ã‚¹ã‚’æ¬ ã„ãŸè¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³",intensity_level:"ä¸­",likelihood:"50%"},blindSpotQuestions:[{type:"generic",question:"ã“ã®ç‰¹æ€§ã«é ¼ã‚Šã™ãã¦ã€ä»–ã®èƒ½åŠ›ã®ç™ºé”ã‚’æ€ ã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ",purpose:"ãƒãƒ©ãƒ³ã‚¹ã®ç¢ºèª"}],growthChallenges:{primary_challenge:"ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸè‡ªå·±è¡¨ç¾",development_areas:["è‡ªå·±è¦³å¯Ÿ","ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†"],recommended_practices:["æ—¥è¨˜ã«ã‚ˆã‚‹è‡ªå·±è¦³å¯Ÿ","ä»–è€…ã‹ã‚‰ã®æ„è¦‹åé›†"]}}}_getFallbackProductiveContent(){return{scoreBasedQuestions:this._generateScoreBasedQuestions(),practicalSteps:this._generatePracticalSteps(),integrationGuidance:this._generateIntegrationGuidance(),biasRecognition:this._generateBiasRecognition()}}_renderError(i){this.container.innerHTML=`\n            <div class="critical-productive-card error">\n                <div class="error-message">\n                    <h3>ğŸ§  æ‰¹åˆ¤çš„ãƒ»ç”Ÿç”£çš„è¦–ç‚¹</h3>\n                    <p>ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>\n                    <p class="error-details">${i}</p>\n                </div>\n            </div>\n        `}}"undefined"!=typeof window&&(window.CriticalProductiveCard=CriticalProductiveCard,console.log("âœ… [CriticalProductiveCard] ã‚°ãƒ­ãƒ¼ãƒãƒ«ç™»éŒ²å®Œäº†")),"undefined"!=typeof module&&module.exports&&(module.exports=CriticalProductiveCard);