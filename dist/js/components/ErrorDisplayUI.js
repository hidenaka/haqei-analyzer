class ErrorDisplayUI{constructor(e={}){this.version="2.0.0",this.philosophy="HaQei-iching-guidance",this.config={containerId:e.containerId||"error-display-container",theme:e.theme||"haqei-dark",animations:!1!==e.animations,showPhilosophicalGuidance:!1!==e.showPhilosophicalGuidance,showRecoveryActions:!1!==e.showRecoveryActions,autoHide:!1!==e.autoHide,autoHideDelay:e.autoHideDelay||1e4,...e},this.currentError=null,this.isVisible=!1,this.displayQueue=[],this.isProcessingQueue=!1,this.container=null,this.modal=null,this.notification=null,this.hexagramGuidance=this.initializeHexagramGuidance(),this.HaQeiMessages=this.initializeHaQeiMessages(),this.initialize()}initialize(){this.createContainer(),this.injectStyles(),this.setupEventListeners(),console.log("✅ Error Display UI v2.0.0 initialized")}createContainer(){this.container=document.createElement("div"),this.container.id=this.config.containerId,this.container.className="haqei-error-display-container",document.body.appendChild(this.container),console.log("✅ Error display container created")}injectStyles(){const e="haqei-error-display-styles";if(document.getElementById(e))return;const n=document.createElement("style");n.id=e,n.textContent="\n            /* HAQEI Error Display Styles v2.0.0 */\n            .haqei-error-display-container {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                z-index: 999999;\n                pointer-events: none;\n                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            }\n\n            /* Modal Error Display */\n            .haqei-error-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.85);\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                pointer-events: auto;\n                opacity: 0;\n                transition: opacity 0.3s ease;\n            }\n\n            .haqei-error-modal.visible {\n                opacity: 1;\n            }\n\n            .haqei-error-card {\n                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);\n                border: 2px solid #4a90e2;\n                border-radius: 16px;\n                max-width: 600px;\n                width: 90%;\n                max-height: 80vh;\n                overflow-y: auto;\n                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n                color: #ffffff;\n                transform: scale(0.8);\n                transition: transform 0.3s ease;\n            }\n\n            .haqei-error-modal.visible .haqei-error-card {\n                transform: scale(1);\n            }\n\n            .haqei-error-header {\n                padding: 24px 24px 16px;\n                border-bottom: 1px solid rgba(74, 144, 226, 0.3);\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n            }\n\n            .haqei-error-title {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                margin: 0;\n                font-size: 24px;\n                font-weight: 600;\n                color: #4a90e2;\n            }\n\n            .haqei-error-hexagram {\n                font-size: 32px;\n                filter: drop-shadow(0 0 8px rgba(74, 144, 226, 0.5));\n            }\n\n            .haqei-error-close {\n                background: none;\n                border: none;\n                color: #999;\n                font-size: 28px;\n                cursor: pointer;\n                transition: color 0.2s ease;\n                padding: 0;\n                width: 32px;\n                height: 32px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .haqei-error-close:hover {\n                color: #ffffff;\n                background: rgba(255, 255, 255, 0.1);\n                border-radius: 50%;\n            }\n\n            .haqei-error-content {\n                padding: 24px;\n            }\n\n            .haqei-error-message {\n                font-size: 16px;\n                line-height: 1.6;\n                margin-bottom: 20px;\n                padding: 16px;\n                background: rgba(74, 144, 226, 0.1);\n                border-left: 4px solid #4a90e2;\n                border-radius: 4px;\n            }\n\n            .haqei-philosophical-guidance {\n                background: rgba(255, 215, 0, 0.1);\n                border: 1px solid rgba(255, 215, 0, 0.3);\n                border-radius: 8px;\n                padding: 16px;\n                margin-bottom: 20px;\n            }\n\n            .haqei-philosophical-guidance h4 {\n                margin: 0 0 12px 0;\n                color: #ffd700;\n                font-size: 16px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .haqei-philosophical-guidance p {\n                margin: 0;\n                line-height: 1.5;\n                color: #e0e0e0;\n            }\n\n            .haqei-HaQei-personas {\n                display: grid;\n                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n                gap: 12px;\n                margin-bottom: 20px;\n            }\n\n            .haqei-persona-card {\n                background: rgba(255, 255, 255, 0.05);\n                border: 1px solid rgba(255, 255, 255, 0.1);\n                border-radius: 8px;\n                padding: 12px;\n                text-align: center;\n            }\n\n            .haqei-persona-card.active {\n                border-color: #4a90e2;\n                background: rgba(74, 144, 226, 0.1);\n            }\n\n            .haqei-persona-icon {\n                font-size: 24px;\n                margin-bottom: 8px;\n                display: block;\n            }\n\n            .haqei-persona-name {\n                font-weight: 600;\n                font-size: 14px;\n                margin-bottom: 4px;\n            }\n\n            .haqei-persona-approach {\n                font-size: 12px;\n                color: #aaa;\n            }\n\n            .haqei-error-actions {\n                display: flex;\n                flex-wrap: wrap;\n                gap: 12px;\n                margin-bottom: 20px;\n            }\n\n            .haqei-action-button {\n                background: linear-gradient(135deg, #4a90e2, #357abd);\n                border: none;\n                border-radius: 8px;\n                color: white;\n                padding: 12px 20px;\n                font-size: 14px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s ease;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .haqei-action-button:hover {\n                background: linear-gradient(135deg, #357abd, #2968a3);\n                transform: translateY(-1px);\n                box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);\n            }\n\n            .haqei-action-button:active {\n                transform: translateY(0);\n            }\n\n            .haqei-action-button.secondary {\n                background: linear-gradient(135deg, #6c757d, #5a6268);\n            }\n\n            .haqei-action-button.secondary:hover {\n                background: linear-gradient(135deg, #5a6268, #495057);\n            }\n\n            .haqei-action-button.danger {\n                background: linear-gradient(135deg, #dc3545, #c82333);\n            }\n\n            .haqei-action-button.danger:hover {\n                background: linear-gradient(135deg, #c82333, #bd2130);\n            }\n\n            .haqei-action-button:disabled {\n                opacity: 0.6;\n                cursor: not-allowed;\n                transform: none !important;\n            }\n\n            .haqei-error-details {\n                margin-top: 20px;\n            }\n\n            .haqei-error-details summary {\n                cursor: pointer;\n                font-weight: 500;\n                color: #4a90e2;\n                margin-bottom: 12px;\n                outline: none;\n            }\n\n            .haqei-error-details summary:hover {\n                color: #357abd;\n            }\n\n            .haqei-error-details pre {\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid rgba(255, 255, 255, 0.1);\n                border-radius: 4px;\n                padding: 12px;\n                font-size: 12px;\n                line-height: 1.4;\n                overflow-x: auto;\n                color: #e0e0e0;\n            }\n\n            /* Notification Style */\n            .haqei-error-notification {\n                position: fixed;\n                top: 20px;\n                right: 20px;\n                max-width: 400px;\n                background: linear-gradient(135deg, #1a1a2e, #16213e);\n                border: 1px solid #4a90e2;\n                border-radius: 8px;\n                color: white;\n                padding: 16px;\n                pointer-events: auto;\n                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);\n                transform: translateX(100%);\n                transition: transform 0.3s ease;\n                z-index: 1000000;\n            }\n\n            .haqei-error-notification.visible {\n                transform: translateX(0);\n            }\n\n            .haqei-error-notification.success {\n                border-color: #28a745;\n                background: linear-gradient(135deg, #1a2e1a, #162116);\n            }\n\n            .haqei-error-notification.warning {\n                border-color: #ffc107;\n                background: linear-gradient(135deg, #2e2a1a, #212116);\n            }\n\n            .haqei-error-notification.info {\n                border-color: #17a2b8;\n                background: linear-gradient(135deg, #1a2a2e, #162121);\n            }\n\n            .haqei-notification-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                margin-bottom: 8px;\n            }\n\n            .haqei-notification-title {\n                font-weight: 600;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .haqei-notification-close {\n                background: none;\n                border: none;\n                color: #999;\n                cursor: pointer;\n                font-size: 18px;\n                padding: 0;\n                width: 24px;\n                height: 24px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .haqei-notification-close:hover {\n                color: white;\n            }\n\n            .haqei-notification-message {\n                font-size: 14px;\n                line-height: 1.4;\n                margin-bottom: 8px;\n            }\n\n            .haqei-notification-guidance {\n                font-size: 12px;\n                color: #ccc;\n                font-style: italic;\n            }\n\n            /* Animations */\n            @keyframes haqeiPulse {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.7; }\n            }\n\n            .haqei-pulse {\n                animation: haqeiPulse 2s infinite;\n            }\n\n            @keyframes haqeiSlideDown {\n                from {\n                    opacity: 0;\n                    transform: translateY(-20px);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateY(0);\n                }\n            }\n\n            .haqei-slide-down {\n                animation: haqeiSlideDown 0.3s ease;\n            }\n\n            /* Responsive Design */\n            @media (max-width: 768px) {\n                .haqei-error-card {\n                    width: 95%;\n                    margin: 10px;\n                    max-height: 90vh;\n                }\n                \n                .haqei-error-header,\n                .haqei-error-content {\n                    padding: 16px;\n                }\n                \n                .haqei-HaQei-personas {\n                    grid-template-columns: 1fr;\n                }\n                \n                .haqei-error-actions {\n                    flex-direction: column;\n                }\n                \n                .haqei-action-button {\n                    width: 100%;\n                    justify-content: center;\n                }\n                \n                .haqei-error-notification {\n                    right: 10px;\n                    left: 10px;\n                    max-width: none;\n                }\n            }\n\n            /* Dark theme adjustments */\n            .haqei-error-display-container.theme-light .haqei-error-card {\n                background: linear-gradient(135deg, #f8f9fa, #e9ecef);\n                color: #333;\n                border-color: #4a90e2;\n            }\n\n            .haqei-error-display-container.theme-light .haqei-error-message {\n                background: rgba(74, 144, 226, 0.1);\n                color: #333;\n            }\n        ",document.head.appendChild(n),console.log("✅ Error display styles injected")}setupEventListeners(){window.addEventListener("haqei-error",e=>{this.displayError(e.detail)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isVisible&&this.hideError()})}initializeHexagramGuidance(){return{1:{name:"乾為天",symbol:"☰",guidance:"創造力と行動力で困難を乗り越える時です。積極的に解決策を見つけ、前進しましょう。",keywords:["創造","行動","リーダーシップ"]},2:{name:"坤為地",symbol:"☷",guidance:"受容性と忍耐力で状況を受け入れ、適応することが重要です。焦らず着実に進みましょう。",keywords:["受容","忍耐","適応"]},3:{name:"水雷屯",symbol:"☵☳",guidance:"困難の始まりですが、これは成長の機会でもあります。慎重に準備を進めましょう。",keywords:["困難","準備","成長"]},5:{name:"水天需",symbol:"☵☰",guidance:"待機の智慧を発揮する時です。適切なタイミングを待ち、準備を怠らないことが大切です。",keywords:["待機","タイミング","準備"]},7:{name:"地水師",symbol:"☷☵",guidance:"組織と統率力で問題を解決します。チームワークと規律が成功の鍵です。",keywords:["組織","統率","チームワーク"]},11:{name:"地天泰",symbol:"☷☰",guidance:"天地泰平の時です。調和とバランスを保ち、安定した状態を維持しましょう。",keywords:["調和","安定","泰平"]},15:{name:"地山謙",symbol:"☷☶",guidance:"謙虚さが解決への道です。自分を省み、他者から学ぶ姿勢を大切にしましょう。",keywords:["謙虚","学習","改善"]},30:{name:"離為火",symbol:"☲",guidance:"明晰さと洞察力で真相を見抜きます。明るい視点で問題を照らし出しましょう。",keywords:["明晰","洞察","照明"]},31:{name:"沢山咸",symbol:"☱☶",guidance:"感応と相互理解が重要です。相手の立場に立って考え、共感を示しましょう。",keywords:["感応","理解","共感"]},32:{name:"雷風恒",symbol:"☳☴",guidance:"持続性と一貫性を保つことが大切です。着実に継続することが成功につながります。",keywords:["持続","一貫","継続"]}}}initializeHaQeiMessages(){return{analyticalSelf:{name:"分析的分人",icon:"🔍",approach:"論理的分析",messages:{network:"ネットワーク接続の問題を分析し、最適な解決策を検討します。",memory:"メモリ使用量を分析し、効率的な最適化手順を実行します。",ui:"UI要素の構造を分析し、レンダリング問題を特定します。",default:"問題を論理的に分析し、系統的な解決アプローチを提案します。"}},intuitiveSelf:{name:"直感的分人",icon:"✨",approach:"精神的洞察",messages:{network:"接続の流れを感じ取り、自然なタイミングで再試行します。",memory:"システムの負荷を感じ取り、調和のとれた状態に導きます。",ui:"ユーザーの期待を感じ取り、直感的な表示を復元します。",default:"直感的な洞察で問題の本質を見抜き、自然な解決を促します。"}},socialSelf:{name:"社会的分人",icon:"🤝",approach:"関係性重視",messages:{network:"ユーザーとの接続を大切にし、円滑なコミュニケーションを回復します。",memory:"システムとユーザーの調和を考慮し、快適な環境を整えます。",ui:"ユーザーの使いやすさを最優先に、親しみやすい画面を提供します。",default:"ユーザーとの良好な関係を保ちながら、問題を解決します。"}}}}displayError(e){this.displayQueue.push(e),this.isProcessingQueue||this.processDisplayQueue()}async processDisplayQueue(){for(this.isProcessingQueue=!0;this.displayQueue.length>0;){const e=this.displayQueue.shift();await this.showErrorModal(e),await this.waitForUserInteraction(e)}this.isProcessingQueue=!1}async showErrorModal(e){this.currentError=e,"critical"===e.classification?.severity?this.showModal(e):this.showNotification(e)}showModal(e){this.modal||(this.modal=this.createModal()),this.populateModal(e),this.container.appendChild(this.modal),requestAnimationFrame(()=>{this.modal.classList.add("visible")}),this.isVisible=!0,this.config.autoHide&&"critical"!==e.classification?.severity&&setTimeout(()=>{this.hideError()},this.config.autoHideDelay)}showNotification(e){const n=this.createNotification(e);this.container.appendChild(n),requestAnimationFrame(()=>{n.classList.add("visible")}),setTimeout(()=>{this.hideNotification(n)},this.config.autoHideDelay)}createModal(){const e=document.createElement("div");e.className="haqei-error-modal",e.innerHTML='\n            <div class="haqei-error-card">\n                <div class="haqei-error-header">\n                    <h2 class="haqei-error-title">\n                        <span class="haqei-error-hexagram"></span>\n                        <span class="haqei-error-title-text">システムエラー</span>\n                    </h2>\n                    <button class="haqei-error-close">&times;</button>\n                </div>\n                <div class="haqei-error-content">\n                    <div class="haqei-error-message"></div>\n                    <div class="haqei-philosophical-guidance"></div>\n                    <div class="haqei-HaQei-personas"></div>\n                    <div class="haqei-error-actions"></div>\n                    <details class="haqei-error-details">\n                        <summary>詳細情報（開発者向け）</summary>\n                        <pre class="haqei-error-debug"></pre>\n                    </details>\n                </div>\n            </div>\n        ';return e.querySelector(".haqei-error-close").addEventListener("click",()=>this.hideError()),e.addEventListener("click",n=>{n.target===e&&this.hideError()}),e}createNotification(e){const n=document.createElement("div");n.className=`haqei-error-notification ${this.getSeverityClass(e.classification?.severity)}`;const i=this.getHexagramGuidance(e.classification?.hexagram),a=this.getActivePersona(e.classification?.HaQeiPersona);n.innerHTML=`\n            <div class="haqei-notification-header">\n                <div class="haqei-notification-title">\n                    <span>${i.symbol}</span>\n                    <span>${this.getErrorTitle(e)}</span>\n                </div>\n                <button class="haqei-notification-close">&times;</button>\n            </div>\n            <div class="haqei-notification-message">\n                ${this.getErrorMessage(e)}\n            </div>\n            <div class="haqei-notification-guidance">\n                ${a.icon} ${a.messages[this.getErrorCategory(e)]||a.messages.default}\n            </div>\n        `;return n.querySelector(".haqei-notification-close").addEventListener("click",()=>this.hideNotification(n)),n}populateModal(e){if(!this.modal)return;const n=e.classification?.hexagram||1,i=this.getHexagramGuidance(n),a=this.getHaQeiPersonas(e),t=this.modal.querySelector(".haqei-error-hexagram"),r=this.modal.querySelector(".haqei-error-title-text");t.textContent=i.symbol,r.textContent=this.getErrorTitle(e);this.modal.querySelector(".haqei-error-message").textContent=this.getErrorMessage(e);this.modal.querySelector(".haqei-philosophical-guidance").innerHTML=`\n            <h4>🔮 ${i.name} - 易経からの導き</h4>\n            <p>${i.guidance}</p>\n        `;this.modal.querySelector(".haqei-HaQei-personas").innerHTML=a.map(e=>`\n            <div class="haqei-persona-card ${e.active?"active":""}">\n                <span class="haqei-persona-icon">${e.icon}</span>\n                <div class="haqei-persona-name">${e.name}</div>\n                <div class="haqei-persona-approach">${e.approach}</div>\n            </div>\n        `).join("");this.modal.querySelector(".haqei-error-actions").innerHTML=this.generateActionButtons(e);this.modal.querySelector(".haqei-error-debug").textContent=this.formatDebugInfo(e),this.setupActionListeners(e)}generateActionButtons(e){const n=[];return e.recovery?.strategy&&n.push('\n                <button class="haqei-action-button" data-action="recover">\n                    🔧 自動修復\n                </button>\n            '),n.push('\n            <button class="haqei-action-button secondary" data-action="retry">\n                🔄 再試行\n            </button>\n        '),n.push('\n            <button class="haqei-action-button secondary" data-action="reload">\n                ⟳ ページ再読み込み\n            </button>\n        '),n.push('\n            <button class="haqei-action-button secondary" data-action="report">\n                📊 エラー報告\n            </button>\n        '),n.join("")}setupActionListeners(e){this.modal.querySelectorAll("[data-action]").forEach(n=>{n.addEventListener("click",async i=>{const a=i.target.dataset.action;await this.handleAction(a,e,n)})})}async handleAction(e,n,i){i.disabled=!0;const a=i.textContent;i.textContent="処理中...";try{switch(e){case"recover":await this.performRecovery(n);break;case"retry":await this.performRetry(n);break;case"reload":window.location.reload();break;case"report":await this.reportError(n)}this.showNotification({classification:{severity:"info"},message:"アクションが正常に実行されました"}),this.hideError()}catch(t){console.error("Action failed:",t),i.textContent="エラー",setTimeout(()=>{i.textContent=a,i.disabled=!1},2e3)}}hideError(){this.modal&&this.modal.classList.contains("visible")&&(this.modal.classList.remove("visible"),setTimeout(()=>{this.modal.parentNode&&this.modal.parentNode.removeChild(this.modal),this.isVisible=!1,this.currentError=null},300))}hideNotification(e){e.classList.remove("visible"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)}getHexagramGuidance(e){return this.hexagramGuidance[e]||this.hexagramGuidance[1]}getActivePersona(e){const n=e||"analyticalSelf";return this.HaQeiMessages[n]||this.HaQeiMessages.analyticalSelf}getHaQeiPersonas(e){const n=e.classification?.HaQeiPersona||"analyticalSelf";return Object.entries(this.HaQeiMessages).map(([e,i])=>({...i,active:e===n}))}getErrorTitle(e){return{NETWORK_ERROR:"ネットワークエラー",STORAGE_ERROR:"データ保存エラー",MEMORY_ERROR:"メモリエラー",UI_RENDER_ERROR:"画面表示エラー",VALIDATION_ERROR:"入力検証エラー",COMPUTATION_ERROR:"計算エラー",INITIALIZATION_ERROR:"システム初期化エラー",CONFIGURATION_ERROR:"設定エラー",BUNENJIN_CONFLICT:"分人思想調和エラー",TRIPLE_OS_MISALIGNMENT:"Triple OS不整合エラー"}[e.classification?.type||"UNKNOWN_ERROR"]||"システムエラー"}getErrorMessage(e){return e.userMessage||e.message||e.error?.message||"予期せぬエラーが発生しました"}getErrorCategory(e){const n=e.classification?.type||"";return n.includes("NETWORK")?"network":n.includes("MEMORY")?"memory":n.includes("UI")?"ui":"default"}getSeverityClass(e){return{critical:"error",high:"warning",medium:"warning",low:"info"}[e]||"info"}formatDebugInfo(e){return JSON.stringify({timestamp:e.timestamp,classification:e.classification,error:{name:e.error?.name,message:e.error?.message,stack:e.error?.stack},context:e.context,recovery:e.recovery},null,2)}async waitForUserInteraction(e){return new Promise(n=>{if("critical"!==e.classification?.severity)return void setTimeout(n,this.config.autoHideDelay);const checkVisibility=()=>{this.isVisible?setTimeout(checkVisibility,100):n()};checkVisibility()})}async performRecovery(e){return window.dispatchEvent(new CustomEvent("haqei-error-recovery",{detail:e})),new Promise(e=>setTimeout(e,1e3))}async performRetry(e){return window.dispatchEvent(new CustomEvent("haqei-error-retry",{detail:e})),new Promise(e=>setTimeout(e,500))}async reportError(e){return window.dispatchEvent(new CustomEvent("haqei-error-report",{detail:e})),new Promise(e=>setTimeout(e,500))}cleanup(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.displayQueue=[],this.currentError=null,this.isVisible=!1,console.log("🧹 Error Display UI cleanup completed")}}"undefined"!=typeof window&&(window.ErrorDisplayUI=ErrorDisplayUI),"undefined"!=typeof module&&module.exports&&(module.exports=ErrorDisplayUI),console.log("✅ Error Display UI v2.0.0 loaded - HaQei philosophy & I Ching guidance ready");