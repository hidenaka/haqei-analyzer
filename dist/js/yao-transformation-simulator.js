class YaoTransformationSimulator{constructor(e){this.ichingAnalyzer=e,this.h384Data=null,this.transformationRules=this.initTransformationRules(),console.log("ğŸ”„ Yao Transformation Simulator initialized")}async init(){try{return window.H384_DATA&&Array.isArray(window.H384_DATA)?(this.h384Data=window.H384_DATA,console.log("âœ… YaoTransformationSimulator H384_DATA loaded:",this.h384Data.length,"entries"),!0):(console.error("âŒ H384_DATA not available for YaoTransformationSimulator"),!1)}catch(e){return console.error("âŒ Failed to initialize YaoTransformationSimulator:",e),!1}}simulateTransformation(e,t){console.log("ğŸ”„ Simulating transformation for choice:",t);try{const a=this.determineTransformationPattern(e,t),n=this.calculateNewYaoPosition(e.yao.position,a),i=this.calculateHexagramChange(e.hexagram,e.yao.position,n),r=this.ichingAnalyzer.getH384Entry(i.newHexagram.number,n),o=this.generateFutureScenarios(e,r,t,a),s=this.generateTransformationMetaphor(e,r,a),l={choice:t,transformation:{pattern:a,confidence:this.calculateTransformationConfidence(a),metaphor:s},newSituation:{hexagram:i.newHexagram,yao:{position:n,name:this.getYaoName(n),description:this.ichingAnalyzer.getYaoDescription(n)},h384Entry:r},scenarios:o,comparison:this.compareWithCurrent(e,r)};return console.log("âœ… Transformation simulation complete:",l),l}catch(a){return console.error("âŒ Transformation simulation failed:",a),this.getFallbackTransformation(e,t)}}determineTransformationPattern(e,t){const a=e.yao.position,n=e.analysis.emotion,i=e.analysis.pattern;let r={type:t,direction:"stable",intensity:.5,risk:.3,opportunity:.6};switch(t){case"follow":r.direction=this.getFollowDirection(a,i),r.intensity=.3,r.risk=.2,r.opportunity=.5;break;case"change":r.direction=this.getChangeDirection(a,n),r.intensity=.7,r.risk=.6,r.opportunity=.8;break;case"create":r.direction=this.getCreativeDirection(a,i),r.intensity=.9,r.risk=.8,r.opportunity=.9}return"anxiety"===n.dominant&&n.intensity>.7&&(r.risk+=.2,r.intensity=Math.max(.1,r.intensity-.3)),r}getFollowDirection(e,t){return"growth"===t.primary?"up":"completion"===t.primary?"stable":"crisis"===t.primary?"down":e<=2?"up":e>=5?"stable":"up"}getChangeDirection(e,t){return"confusion"===t.dominant?"reverse":"stagnation"===t.dominant?"up":6===e?"down":e<=3||Math.random()>.5?"up":"down"}getCreativeDirection(e,t){return"stagnation"===t.primary||"completion"===t.primary?"reverse":["up","down","reverse"][Math.floor(3*Math.random())]}calculateNewYaoPosition(e,t){let a=e;switch(t.direction){case"up":a=Math.min(6,e+Math.ceil(2*t.intensity));break;case"down":a=Math.max(1,e-Math.ceil(2*t.intensity));break;case"reverse":a=7-e;break;case"stable":Math.random()<t.intensity&&(a=e+(Math.random()>.5?1:-1),a=Math.max(1,Math.min(6,a)))}return a}calculateHexagramChange(e,t,a){console.log("ğŸ”„ [DEBUG] calculateHexagramChange called:",{currentHexagram:e?.name,oldYao:t,newYao:a});const n=Math.abs(a-t);let i=e,r="minimal";n>=1&&(r=n>=3?"major_transformation":"progression",console.log("ğŸ”„ [DEBUG] Change type determined:",r),i=this.calculateProgressingHexagram(e,t,a,r));const o={upward_strong:{number:1,name:"ä¹¾ç‚ºå¤©",symbol:"â˜°â˜°"},upward_gentle:{number:57,name:"å·½ç‚ºé¢¨",symbol:"â˜´â˜´"},downward_adaptive:{number:2,name:"å¤ç‚ºåœ°",symbol:"â˜·â˜·"},downward_retreat:{number:33,name:"å¤©å±±é¯",symbol:"â˜°â˜¶"},revolutionary:{number:49,name:"æ²¢ç«é©",symbol:"â˜±â˜²"},innovative:{number:50,name:"ç«é¢¨é¼",symbol:"â˜²â˜´"},shocking:{number:51,name:"éœ‡ç‚ºé›·",symbol:"â˜³â˜³"},penetrating:{number:57,name:"å·½ç‚ºé¢¨",symbol:"â˜´â˜´"}};"major_transformation"===r?i=a>t?n>=4?o.revolutionary:o.upward_strong:a<t?n>=4?o.shocking:o.downward_adaptive:o.innovative:"progression"===r&&(i=a>t?o.upward_gentle:o.downward_retreat);const s={changed:i.number!==e.number,oldHexagram:e,newHexagram:i,changeType:r,yaoMovement:{from:t,to:a,direction:a>t?"ascending":a<t?"descending":"stable",magnitude:n},lineChanges:this.calculateLineChanges(t,a),changeReason:this.getChangeReason(r,n)};return console.log("ğŸ”„ [DEBUG] Calculated hexagram change result:",{changed:s.changed,oldName:s.oldHexagram.name,newName:s.newHexagram.name,changeType:s.changeType}),s}calculateProgressingHexagram(e,t,a,n){console.log("ğŸ”„ [DEBUG] calculateProgressingHexagram:",{currentHexagram:e?.name,oldYao:t,newYao:a,changeType:n});const i=e.number,r=a>t?"ascending":"descending",o=Math.abs(a-t),s={ascending:{1:{small:i<32?i+1:i,medium:i<30?i+3:i,large:Math.min(64,i+10)},2:{small:i<32?i+2:i,medium:Math.min(64,i+5),large:Math.min(64,i+12)},3:{small:Math.min(64,i+1),medium:Math.min(64,i+7),large:Math.min(64,i+15)}},descending:{6:{small:i>1?i-1:i,medium:Math.max(1,i-5),large:Math.max(1,i-12)},5:{small:Math.max(1,i-2),medium:Math.max(1,i-7),large:Math.max(1,i-15)},4:{small:Math.max(1,i-1),medium:Math.max(1,i-3),large:Math.max(1,i-10)}}};let l=o<=1?"small":o<=3?"medium":"large";const c=s[r]?.[t];let m=i;c&&c[l]&&(m=c[l],console.log("ğŸ”„ [DEBUG] Applied progression rule:",{direction:r,oldYao:t,intensityLevel:l,newNumber:m}));const g=this.getHexagramByNumber(m)||e;return console.log("ğŸ”„ [DEBUG] Progression result:",{oldNumber:i,newNumber:m,newName:g.name}),g}getHexagramByNumber(e){const t={1:{number:1,name:"ä¹¾ç‚ºå¤©",symbol:"â˜°â˜°"},2:{number:2,name:"å¤ç‚ºåœ°",symbol:"â˜·â˜·"},3:{number:3,name:"æ°´é›·å±¯",symbol:"â˜µâ˜³"},4:{number:4,name:"å±±æ°´è’™",symbol:"â˜¶â˜µ"},5:{number:5,name:"æ°´å¤©éœ€",symbol:"â˜µâ˜°"},6:{number:6,name:"å¤©æ°´è¨Ÿ",symbol:"â˜°â˜µ"},7:{number:7,name:"åœ°æ°´å¸«",symbol:"â˜·â˜µ"},8:{number:8,name:"æ°´åœ°æ¯”",symbol:"â˜µâ˜·"},33:{number:33,name:"å¤©å±±é¯",symbol:"â˜°â˜¶"},49:{number:49,name:"æ²¢ç«é©",symbol:"â˜±â˜²"},50:{number:50,name:"ç«é¢¨é¼",symbol:"â˜²â˜´"},51:{number:51,name:"éœ‡ç‚ºé›·",symbol:"â˜³â˜³"},57:{number:57,name:"å·½ç‚ºé¢¨",symbol:"â˜´â˜´"}}[e];return!t&&e>=1&&e<=64?{number:e,name:`ç¬¬${e}å¦`,symbol:"â˜°â˜°"}:t}calculateLineChanges(e,t){const a={type:t>e?"progressing":t<e?"regressing":"stable",steps:Math.abs(t-e),trajectory:[],significance:this.getChangeSignificance(e,t)};if(a.steps>0){const n=t>e?1:-1;for(let i=e;i!==t;i+=n){const e=i+n;a.trajectory.push({from:i,to:e,significance:this.getPositionSignificance(e)})}}return a}getChangeSignificance(e,t){return{"1-6":"complete_cycle","6-1":"renewal","3-4":"critical_transition","2-5":"elevation","5-2":"humility"}[`${e}-${t}`]||"normal"}getPositionSignificance(e){return{1:{level:"foundation",meaning:"åŸºç¤ãƒ»å§‹ã¾ã‚Š"},2:{level:"support",meaning:"å”åŠ›ãƒ»æ”¯æ´"},3:{level:"challenge",meaning:"è©¦ç·´ãƒ»å›°é›£"},4:{level:"transition",meaning:"å¤‰åŒ–ãƒ»è»¢æ›"},5:{level:"leadership",meaning:"æŒ‡å°ãƒ»çµ±ç‡"},6:{level:"completion",meaning:"å®Œæˆãƒ»çµ‚äº†"}}[e]||{level:"neutral",meaning:"ä¸­ç«‹"}}getChangeReason(e,t){return{minimal:"å°å¹…ãªèª¿æ•´ã«ã‚ˆã‚‹å®‰å®šåŒ–",progression:`${t}æ®µéšã®é€²å±•ã«ã‚ˆã‚‹ç™ºå±•`,major_transformation:`${t}æ®µéšã®å¤§å¤‰åŒ–ã«ã‚ˆã‚‹é©æ–°`}[e]||"çŠ¶æ³ã®è‡ªç„¶ãªç™ºå±•"}generateFutureScenarios(e,t,a,n){console.log("ğŸ”® [DEBUG] generateFutureScenarios with é€²çˆ»ãƒ»å¤‰çˆ» integration");const i=[],r=t?t["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||[]:["å¤‰åŒ–"],o=["1ãƒ¶æœˆå¾Œ","3ãƒ¶æœˆå¾Œ","6ãƒ¶æœˆå¾Œ","1å¹´å¾Œ"],s=[{type:"optimistic_strong",hexagramPattern:"ascending_major",probability:.9*this.calculateOptimisticProbability(n,t),title:"æœ€è‰¯ãƒ»ç©æ¥µå±•é–‹",icon:"ğŸŒŸ",yaoMovement:"strong_upward"},{type:"optimistic_gentle",hexagramPattern:"ascending_gradual",probability:.7*this.calculateOptimisticProbability(n,t),title:"è‰¯å¥½ãƒ»ç€å®Ÿæˆé•·",icon:"ğŸ“ˆ",yaoMovement:"gentle_upward"},{type:"realistic_stable",hexagramPattern:"stable_progression",probability:.6,title:"ç¾å®Ÿçš„ãƒ»å®‰å®šå±•é–‹",icon:"âš–ï¸",yaoMovement:"stable"},{type:"realistic_adaptive",hexagramPattern:"adaptive_change",probability:.65,title:"ç¾å®Ÿçš„ãƒ»é©å¿œå±•é–‹",icon:"ğŸ”„",yaoMovement:"adaptive"},{type:"challenging_manageable",hexagramPattern:"descending_controlled",probability:.6*this.calculateChallengingProbability(n,t),title:"è©¦ç·´ãƒ»ç®¡ç†å¯èƒ½",icon:"âš¡",yaoMovement:"controlled_descent"},{type:"challenging_severe",hexagramPattern:"descending_major",probability:.8*this.calculateChallengingProbability(n,t),title:"å›°é›£ãƒ»å¤§ããªè©¦ç·´",icon:"ğŸŒªï¸",yaoMovement:"strong_downward"},{type:"transformative_breakthrough",hexagramPattern:"revolutionary",probability:.7*n.opportunity,title:"å¤‰é©ãƒ»ãƒ–ãƒ¬ãƒ¼ã‚¯ã‚¹ãƒ«ãƒ¼",icon:"ğŸš€",yaoMovement:"revolutionary"},{type:"transformative_cyclical",hexagramPattern:"cyclical_return",probability:.5*n.intensity,title:"å¤‰é©ãƒ»å¾ªç’°çš„å±•é–‹",icon:"ğŸ”",yaoMovement:"cyclical"}];for(const l of s){const s={id:`scenario_${l.type}_${Date.now()}`,type:l.type,title:l.title,icon:l.icon,probability:l.probability,hexagramPattern:l.hexagramPattern,yaoMovement:l.yaoMovement,timeline:this.generateProgressionTimeline(l,r,o,e),outcomes:this.generateHexagramBasedOutcomes(l,t,a,e),risks:this.generateYaoBasedRisks(l,n),opportunities:this.generateProgressionOpportunities(l,n),metaphor:this.generateHexagramMetaphor(l,t,e)};i.push(s)}return console.log("ğŸ”® [DEBUG] Generated 8 scenarios with é€²çˆ»ãƒ»å¤‰çˆ» integration:",i.length),i}generateProgressionTimeline(e,t,a,n){const i=[],r=this.calculateYaoProgression(e.yaoMovement,a.length);for(let o=0;o<a.length;o++){const s=a[o],l=t[o%t.length]||"ç™ºå±•",c=r[o];let m=this.generateProgressionDescription(e.hexagramPattern,c,l,n);i.push({timeframe:s,keyword:l,description:m,yaoPosition:c.position,yaoSignificance:c.significance,milestone:this.generateProgressionMilestone(e.type,o,c)})}return i}calculateYaoProgression(e,t){const a=[];for(let n=0;n<t;n++){let t,i;switch(e){case"strong_upward":t=Math.min(6,1+2*n),i="rapid_growth";break;case"gentle_upward":t=Math.min(6,1+n),i="steady_progress";break;case"strong_downward":t=Math.max(1,6-2*n),i="rapid_decline";break;case"controlled_descent":t=Math.max(1,6-n),i="managed_challenge";break;case"stable":t=3+n%2,i="stable_foundation";break;case"revolutionary":t=[1,6,3,4][n%4],i="transformative_leap";break;case"cyclical":t=[1,3,6,2][n%4],i="cyclical_renewal";break;default:t=Math.min(6,1+n),i="natural_flow"}a.push({position:t,significance:i,stage:n+1})}return a}generateProgressionDescription(e,t,a,n){return{ascending_major:`${a}ã‚’è»¸ã¨ã—ã¦åŠ›å¼·ãä¸Šæ˜‡ã—ã€ç¬¬${t.position}çˆ»ã®æ®µéšã§å¤§ããªå¤‰åŒ–ã‚’å®Ÿç¾`,ascending_gradual:`${a}ã‚’é€šã˜ã¦ç€å®Ÿã«é€²å±•ã—ã€ç¬¬${t.position}çˆ»ã§å®‰å®šã—ãŸæˆé•·ã‚’ç¶™ç¶š`,stable_progression:`${a}ã®åŸºç›¤ã®ä¸Šã§ç¬¬${t.position}çˆ»ã®å®‰å®šã—ãŸç«‹å ´ã‚’ç¯‰ã`,adaptive_change:`${a}ã«æŸ”è»Ÿã«å¯¾å¿œã—ã€ç¬¬${t.position}çˆ»ã§é©å¿œçš„ãªå¤‰åŒ–ã‚’é‚ã’ã‚‹`,descending_controlled:`${a}ã®èª¿æ•´æœŸé–“ã¨ã—ã¦ç¬¬${t.position}çˆ»ã§æˆ¦ç•¥çš„ãªè¦‹ç›´ã—ã‚’å®Ÿè¡Œ`,descending_major:`${a}ã«é–¢ã™ã‚‹å¤§ããªè©¦ç·´ã‚’ç¬¬${t.position}çˆ»ã§çµŒé¨“ã—å­¦ã³ã‚’å¾—ã‚‹`,revolutionary:`${a}ã«ã‚ˆã‚‹é©å‘½çš„ãªå¤‰åŒ–ãŒç¬¬${t.position}çˆ»ã§ç™ºç¾ã™ã‚‹`,cyclical_return:`${a}ã‚’é€šã˜ãŸå¾ªç’°çš„ãªå±•é–‹ãŒç¬¬${t.position}çˆ»ã§æ–°ãŸãªå‘¨æœŸã‚’é–‹å§‹`}[e]||`${a}ã«ã‚ˆã‚‹ç¬¬${t.position}çˆ»ã§ã®å±•é–‹`}generateHexagramBasedOutcomes(e,t,a,n){const i=t?t["ç¾ä»£è§£é‡ˆã®è¦ç´„"]:"",r=t&&t["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||[],o=[];return o.push({category:"primary",title:this.generateHexagramOutcomeTitle(e.hexagramPattern,r[0]),description:this.adaptOutcomeToHexagramPattern(i,e.hexagramPattern,a),impact:this.calculateHexagramImpact(e.type,e.yaoMovement),hexagramInfluence:e.hexagramPattern}),r.length>1&&o.push({category:"secondary",title:this.generateYaoOutcomeTitle(e.yaoMovement,r[1]),description:this.generateYaoInfluencedOutcome(r[1],e.yaoMovement),impact:.7*this.calculateHexagramImpact(e.type,e.yaoMovement),yaoInfluence:e.yaoMovement}),o}generateHexagramOutcomeTitle(e,t){t||(t="å¤‰åŒ–");return{ascending_major:`${t}ã«ã‚ˆã‚‹åŠ›å¼·ã„é£›èºçš„æˆåŠŸ`,ascending_gradual:`${t}ã‚’é€šã˜ãŸç€å®Ÿã§æŒç¶šçš„ãªæˆé•·`,stable_progression:`${t}ã«ã‚ˆã‚‹å®‰å®šã—ãŸåŸºç›¤ã®ç¢ºç«‹`,adaptive_change:`${t}ã¸ã®æŸ”è»Ÿãªé©å¿œã«ã‚ˆã‚‹èª¿å’Œ`,descending_controlled:`${t}ã®èª¿æ•´ã«ã‚ˆã‚‹æˆ¦ç•¥çš„ç«‹ã¦ç›´ã—`,descending_major:`${t}ã®è©¦ç·´ã‚’é€šã˜ãŸæ ¹æœ¬çš„ãªå¤‰é©`,revolutionary:`${t}ã«ã‚ˆã‚‹é©å‘½çš„ãªãƒ–ãƒ¬ãƒ¼ã‚¯ã‚¹ãƒ«ãƒ¼`,cyclical_return:`${t}ã®å¾ªç’°ã«ã‚ˆã‚‹æ–°ãŸãªå§‹ã¾ã‚Š`}[e]||`${t}ã«ã‚ˆã‚‹å¤‰åŒ–`}generateYaoOutcomeTitle(e,t){t||(t="å¤‰åŒ–");return{strong_upward:`${t}ã®å‹¢ã„ã«ã‚ˆã‚‹æ€¥é€Ÿãªå‘ä¸Š`,gentle_upward:`${t}ã®åŠ›ã«ã‚ˆã‚‹æ®µéšçš„ãªç™ºå±•`,controlled_descent:`${t}ã¸ã®å¯¾å‡¦ã«ã‚ˆã‚‹è³¢æ˜ãªèª¿æ•´`,strong_downward:`${t}ã®å›°é›£ã«ã‚ˆã‚‹æ·±ã„å­¦ã³`,stable:`${t}ã«ã‚ˆã‚‹å®‰å®šã—ãŸæŒç¶š`,revolutionary:`${t}ã®é©æ–°ã«ã‚ˆã‚‹é£›èº`,cyclical:`${t}ã®å¾ªç’°ã«ã‚ˆã‚‹å†ç”Ÿ`,adaptive:`${t}ã¸ã®é©å¿œã«ã‚ˆã‚‹é€²åŒ–`}[e]||`${t}ã®å½±éŸ¿`}adaptOutcomeToHexagramPattern(e,t,a){if(!e)return`${a}ã®é¸æŠã«ã‚ˆã‚Š${t}ã®å±•é–‹ãŒå§‹ã¾ã‚Šã¾ã™ã€‚`;return`${{ascending_major:"åŠ›å¼·ã„ä¸Šæ˜‡æ°—æµã«ä¹—ã‚Šã€",ascending_gradual:"ç€å®Ÿãªæ­©ã¿ã‚’ç¶šã‘ãªãŒã‚‰ã€",stable_progression:"å®‰å®šã—ãŸåŸºç›¤ã®ä¸Šã§ã€",adaptive_change:"çŠ¶æ³ã«æŸ”è»Ÿã«é©å¿œã—ã¤ã¤ã€",descending_controlled:"æˆ¦ç•¥çš„ãªèª¿æ•´ã‚’è¡Œã„ãªãŒã‚‰ã€",descending_major:"å¤§ããªè©¦ç·´ã‚’é€šã˜ã¦ã€",revolutionary:"é©å‘½çš„ãªå¤‰åŒ–ã®ä¸­ã§ã€",cyclical_return:"æ–°ãŸãªå‘¨æœŸã®å§‹ã¾ã‚Šã¨ã—ã¦ã€"}[t]||""}${e}`}calculateHexagramImpact(e,t){const a={optimistic_strong:.9,optimistic_gentle:.7,realistic_stable:.6,realistic_adaptive:.65,challenging_manageable:.5,challenging_severe:.4,transformative_breakthrough:.85,transformative_cyclical:.75}[e]||.6,n={strong_upward:1.2,gentle_upward:1,stable:.9,adaptive:1,controlled_descent:.8,strong_downward:.6,revolutionary:1.3,cyclical:1.1}[t]||1;return Math.min(1,a*n)}generateYaoBasedRisks(e,t){const a=[],n=t.risk,i={strong_upward:{type:"overextension",description:"æ€¥é€Ÿãªä¸Šæ˜‡ã«ã‚ˆã‚‹åŸºç›¤ã®ä¸å®‰å®šåŒ–",probability:.8*n,mitigation:"æ®µéšçš„ãªåŸºç›¤å¼·åŒ–ã¨æ…é‡ãªæ‹¡å¤§"},strong_downward:{type:"spiral_decline",description:"ä¸‹é™ã®å‹¢ã„ãŒåˆ¶å¾¡å›°é›£ã«ãªã‚‹ãƒªã‚¹ã‚¯",probability:.9*n,mitigation:"æ—©æœŸã®ä»‹å…¥ã¨æ”¯æ´ä½“åˆ¶ã®æ§‹ç¯‰"},revolutionary:{type:"disruption_chaos",description:"é©å‘½çš„å¤‰åŒ–ã«ã‚ˆã‚‹æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®æ··ä¹±",probability:.7*n,mitigation:"å¤‰åŒ–ç®¡ç†ã¨æ®µéšçš„ãªç§»è¡Œè¨ˆç”»"},cyclical:{type:"repetitive_pattern",description:"åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¹°ã‚Šè¿”ã—ã«ã‚ˆã‚‹åœæ»",probability:.6*n,mitigation:"æ–°ãŸãªè¦ç´ ã®å°å…¥ã¨å­¦ç¿’ã®ç¶™ç¶š"}}[e.yaoMovement];return i&&a.push(i),a}generateProgressionOpportunities(e,t){const a=[],n=t.opportunity,i={strong_upward:{type:"acceleration",description:"ä¸Šæ˜‡ã®å‹¢ã„ã‚’æ´»ã‹ã—ãŸæ›´ãªã‚‹é£›èºã®æ©Ÿä¼š",probability:.9*n,action:"å‹¢ã„ã‚’ç¶­æŒã—ãªãŒã‚‰æˆ¦ç•¥çš„ãªæ‹¡å¤§ã‚’å›³ã‚‹"},gentle_upward:{type:"sustainable_growth",description:"æŒç¶šå¯èƒ½ãªæˆé•·åŸºç›¤ã®ç¢ºç«‹æ©Ÿä¼š",probability:.8*n,action:"ç€å®Ÿãªæ­©ã¿ã§é•·æœŸçš„ãªä¾¡å€¤ã‚’ç¯‰ã"},revolutionary:{type:"paradigm_shift",description:"ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ã‚·ãƒ•ãƒˆã«ã‚ˆã‚‹å…ˆé§†è€…å„ªä½ã®æ©Ÿä¼š",probability:.85*n,action:"å¤‰é©ã®æ³¢ã«ä¹—ã‚Šæ–°ã—ã„ä¾¡å€¤ã‚’å‰µé€ "},adaptive:{type:"flexibility_advantage",description:"é©å¿œæ€§ã‚’æ´»ã‹ã—ãŸå¤šæ§˜ãªå±•é–‹ã®æ©Ÿä¼š",probability:.75*n,action:"æŸ”è»Ÿæ€§ã‚’æ­¦å™¨ã«å¤‰åŒ–ã™ã‚‹ç’°å¢ƒã§å„ªä½ã‚’ç¢ºç«‹"}}[e.yaoMovement];return i&&a.push(i),a}generateHexagramMetaphor(e,t,a){if(!t)return{symbol:"å¤‰åŒ–ã®æµã‚Œ",meaning:`${e.hexagramPattern}ã«ã‚ˆã‚‹æ–°ã—ã„å±•é–‹ã®æ™‚`};const n=t["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||["å¤‰åŒ–"],i=t["å¦å"]||"";return{ascending_major:{symbol:`${n[0]}ã®é¾ãŒæ˜‡å¤©ã™ã‚‹å¦‚ã`,meaning:`${i}ã®åŠ›ãŒæœ€ã‚‚å¼·ãç™ºç¾ã—ã€å¤§ããªé£›èºã‚’é‚ã’ã‚‹æ™‚`},ascending_gradual:{symbol:`${n[0]}ã®é¢¨ãŒå±±ã‚’ç™»ã‚‹å¦‚ã`,meaning:`${i}ã®æ•™ãˆã«å¾“ã„ã€ä¸€æ­©ãšã¤é«˜ã¿ã«å‘ã‹ã†æ™‚`},stable_progression:{symbol:`${n[0]}ã®å¤§åœ°ãŒä¸‡ç‰©ã‚’æ”¯ãˆã‚‹å¦‚ã`,meaning:`${i}ã®å®‰å®šã—ãŸåŠ›ã§åŸºç›¤ã‚’å›ºã‚ã‚‹æ™‚`},revolutionary:{symbol:`${n[0]}ã®é›·ãŒå¤©åœ°ã‚’éœ‡ã‚ã™å¦‚ã`,meaning:`${i}ã®é©æ–°ã®åŠ›ã§ä¸–ç•Œã‚’å¤‰ãˆã‚‹æ™‚`},cyclical_return:{symbol:`${n[0]}ã®å­£ç¯€ãŒå·¡ã‚Šæ¥ã‚‹å¦‚ã`,meaning:`${i}ã®å¾ªç’°ã®ä¸­ã§æ–°ãŸãªå§‹ã¾ã‚Šã‚’è¿ãˆã‚‹æ™‚`}}[e.hexagramPattern]||{symbol:`${n[0]}ã®æµã‚Œ`,meaning:`${i}ã«ã‚ˆã‚‹å¤‰åŒ–ã®æ™‚`}}generateYaoInfluencedOutcome(e,t){return{strong_upward:`${e}ã®å‹¢ã„ã«ã‚ˆã‚Šäºˆæƒ³ã‚’ä¸Šå›ã‚‹æˆæœãŒæœŸå¾…ã•ã‚Œã‚‹`,gentle_upward:`${e}ã‚’é€šã˜ã¦æŒç¶šå¯èƒ½ãªç™ºå±•ãŒè¦‹è¾¼ã¾ã‚Œã‚‹`,controlled_descent:`${e}ã®èª¿æ•´ã«ã‚ˆã‚Šå¿…è¦ãªä¿®æ­£ãŒå®Ÿç¾ã•ã‚Œã‚‹`,strong_downward:`${e}ã®å›°é›£ã‚’é€šã˜ã¦é‡è¦ãªæ°—ã¥ãã‚’å¾—ã‚‹`,stable:`${e}ã«ã‚ˆã‚Šå®‰å®šã—ãŸçŠ¶æ…‹ãŒç¶­æŒã•ã‚Œã‚‹`,revolutionary:`${e}ã®é©æ–°ã«ã‚ˆã‚Šå¾“æ¥ã®æ ã‚’è¶…ãˆãŸå±•é–‹ã¨ãªã‚‹`,cyclical:`${e}ã®å¾ªç’°ã«ã‚ˆã‚Šæ–°ãŸãªå¯èƒ½æ€§ãŒé–‹ã‹ã‚Œã‚‹`,adaptive:`${e}ã¸ã®é©å¿œã«ã‚ˆã‚ŠæŸ”è»Ÿãªå¯¾å¿œåŠ›ã‚’ç²å¾—ã™ã‚‹`}[t]||`${e}ã«ã‚ˆã‚‹å¤‰åŒ–ãŒèµ·ã“ã‚‹`}generateProgressionMilestone(e,t,a){return`${["æº–å‚™æœŸ","å±•é–‹æœŸ","ç™ºå±•æœŸ","å®ŒæˆæœŸ"][t]||"ç¶™ç¶šæœŸ"}ï¼š${{1:"åŸºç¤ç¢ºç«‹",2:"å”åŠ›ç²å¾—",3:"è©¦ç·´å…‹æœ",4:"è»¢æ›å®Ÿç¾",5:"é ‚ç‚¹é”æˆ",6:"å®Œæˆåˆ°é”"}[a.position]||"é€²å±•"}`}generateTimeline(e,t,a){const n=[];for(let i=0;i<a.length;i++){const r=a[i],o=t[i%t.length]||"ç™ºå±•";let s;switch(e.type){case"optimistic":s=`${o}ã‚’æ´»ã‹ã—ã¦é †èª¿ã«é€²å±•ã€‚æ–°ã—ã„æ©Ÿä¼šãŒç”Ÿã¾ã‚Œã‚‹ã€‚`;break;case"realistic":s=`${o}ã«é–¢ã™ã‚‹èª²é¡Œã«å–ã‚Šçµ„ã¿ã€ç€å®Ÿã«å‰é€²ã€‚`;break;case"challenging":s=`${o}ã«é–¢ã™ã‚‹å›°é›£ã«ç›´é¢ã™ã‚‹ãŒã€å­¦ã³ã‚’å¾—ã‚‹ã€‚`}n.push({timeframe:r,keyword:o,description:s,milestone:this.generateMilestone(e.type,i)})}return n}generateMilestone(e,t){return{optimistic:["åŸºç›¤æ§‹ç¯‰å®Œäº†","ç¬¬ä¸€ç›®æ¨™é”æˆ","å¤§ããªæˆæœå®Ÿç¾","æ–°ãŸãªã‚¹ãƒ†ãƒ¼ã‚¸ã¸"],realistic:["æº–å‚™æ®µéšå®Œäº†","ä¸­é–“ç›®æ¨™é”æˆ","èª²é¡Œå…‹æœ","å®‰å®šã—ãŸæˆé•·"],challenging:["å›°é›£èªè­˜","å¯¾ç­–ç«‹æ¡ˆ","è©¦ç·´å…‹æœ","å¼·é­æ€§ç²å¾—"]}[e][t]||"é€²å±•"}calculateOptimisticProbability(e,t){let a=.3;if(a+=.4*e.opportunity,t){a+=((t["S2_ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«"]||50)+(t["S1_åŸºæœ¬ã‚¹ã‚³ã‚¢"]||50))/200*.3}return Math.min(.8,Math.max(.1,a))}calculateChallengingProbability(e,t){let a=.2;if(a+=.3*e.risk,t){a+=(t["S4_ãƒªã‚¹ã‚¯"]||30)/100*.2}return Math.min(.6,Math.max(.1,a))}generateOutcomes(e,t,a){const n=t?t["ç¾ä»£è§£é‡ˆã®è¦ç´„"]:"",i=t&&t["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||[],r=[];return r.push({category:"primary",title:this.generateOutcomeTitle(e.type,i[0]),description:this.adaptOutcomeToChoice(n,a,e.type),impact:this.calculateImpact(e.type)}),i.length>1&&r.push({category:"secondary",title:this.generateOutcomeTitle(e.type,i[1]),description:this.generateSecondaryOutcome(i[1],e.type),impact:.7*this.calculateImpact(e.type)}),r}generateOutcomeTitle(e,t){t||(t="å¤‰åŒ–");return{optimistic:`${t}ã«ã‚ˆã‚‹å¤§ããªæˆåŠŸ`,realistic:`${t}ã‚’é€šã˜ãŸç€å®Ÿãªæˆé•·`,challenging:`${t}ã®è©¦ç·´ã‚’çµŒãŸæˆç†Ÿ`}[e]||`${t}ã«ã‚ˆã‚‹å¤‰åŒ–`}adaptOutcomeToChoice(e,t,a){if(!e)return`${t}ã®é¸æŠã«ã‚ˆã‚Šæ–°ã—ã„å±•é–‹ãŒå§‹ã¾ã‚Šã¾ã™ã€‚`;return`${{follow:"ã“ã®ãƒ†ãƒ¼ãƒã«å¾“ã†ã“ã¨ã§ã€",change:"ãƒ†ãƒ¼ãƒã‚’å¤‰ãˆã‚‹ã“ã¨ã§ã€",create:"æ–°ã—ã„ãƒ†ãƒ¼ãƒã‚’å‰µã‚‹ã“ã¨ã§ã€"}[t]||""}${e}`}calculateImpact(e){return{optimistic:.8,realistic:.6,challenging:.4}[e]||.5}generateRisks(e,t){const a=[],n=t.risk;switch(e.type){case"optimistic":n>.3&&a.push({type:"overconfidence",description:"æˆåŠŸã«ã‚ˆã‚‹æ…¢å¿ƒã®ãƒªã‚¹ã‚¯",probability:.5*n,mitigation:"è¬™è™šã•ã‚’ä¿ã¤"});break;case"realistic":a.push({type:"stagnation",description:"é€²å±•ã®åœæ»",probability:.7*n,mitigation:"å®šæœŸçš„ãªè¦‹ç›´ã—ã¨èª¿æ•´"});break;case"challenging":a.push({type:"overwhelm",description:"å›°é›£ã®é‡è¤‡ã«ã‚ˆã‚‹ç–²å¼Š",probability:.9*n,mitigation:"ã‚µãƒãƒ¼ãƒˆã®æ±‚ã‚æ–¹ã‚’å­¦ã¶"})}return a}generateOpportunities(e,t){const a=[],n=t.opportunity;switch(e.type){case"optimistic":a.push({type:"expansion",description:"æ›´ãªã‚‹ç™ºå±•ã®æ©Ÿä¼š",probability:.9*n,action:"ç©æ¥µçš„ãªè¡Œå‹•ã§æ©Ÿä¼šã‚’æ´»ã‹ã™"});break;case"realistic":a.push({type:"learning",description:"ã‚¹ã‚­ãƒ«å‘ä¸Šã®æ©Ÿä¼š",probability:.7*n,action:"ç¶™ç¶šçš„ãªå­¦ç¿’ã¨æ”¹å–„"});break;case"challenging":a.push({type:"resilience",description:"ç²¾ç¥çš„å¼·ã•ã‚’ç²å¾—ã™ã‚‹æ©Ÿä¼š",probability:.8*n,action:"å›°é›£ã‚’æˆé•·ã®ç³§ã¨ã™ã‚‹"})}return a}generateScenarioMetaphor(e,t){if(!t)return{symbol:"å¤‰åŒ–ã®æ³¢",meaning:"æ–°ã—ã„æµã‚ŒãŒç”Ÿã¾ã‚Œã‚‹æ™‚"};const a=t["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]||["å¤‰åŒ–"],n=t["å¦å"]||"";return{optimistic:{symbol:`${a[0]}ã®èŠ±é–‹ã`,meaning:`${n}ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒæœ€é«˜ã®å½¢ã§ç¾ã‚Œã‚‹æ™‚`},realistic:{symbol:`${a[0]}ã®æˆé•·`,meaning:`${n}ã®æ•™ãˆã«å¾“ã„ç€å®Ÿã«é€²ã‚€æ™‚`},challenging:{symbol:`${a[0]}ã®è©¦ç·´`,meaning:`${n}ã®æ·±ã„æ„å‘³ã‚’ç†è§£ã™ã‚‹æ™‚`}}[e.type]||{symbol:"å¤‰åŒ–ã®æ™‚",meaning:"æ–°ã—ã„æ®µéšã¸ã®ç§»è¡Œ"}}compareWithCurrent(e,t){if(!t||!e.h384Entry)return{improvement:0,changes:["çŠ¶æ³ãŒå¤‰åŒ–ã—ã¾ã™"]};const a=e.h384Entry,n=[],i=(t["S1_åŸºæœ¬ã‚¹ã‚³ã‚¢"]||50)-(a["S1_åŸºæœ¬ã‚¹ã‚³ã‚¢"]||50),r=(t["S2_ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«"]||50)-(a["S2_ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«"]||50),o=(t["S4_ãƒªã‚¹ã‚¯"]||30)-(a["S4_ãƒªã‚¹ã‚¯"]||30);i>10&&n.push("åŸºæœ¬çš„ãªé‹å‹¢ãŒå‘ä¸Š"),i<-10&&n.push("åŸºæœ¬çš„ãªé‹å‹¢ã«æ³¨æ„ãŒå¿…è¦"),r>10&&n.push("å°†æ¥ã®å¯èƒ½æ€§ãŒæ‹¡å¤§"),r<-10&&n.push("å¯èƒ½æ€§ã®æ…é‡ãªè¦‹æ¥µã‚ãŒå¿…è¦"),o>10&&n.push("ãƒªã‚¹ã‚¯ãŒå¢—åŠ ã€æ³¨æ„æ·±ã„è¡Œå‹•ã‚’"),o<-10&&n.push("ãƒªã‚¹ã‚¯ãŒæ¸›å°‘ã€ç©æ¥µçš„ã«è¡Œå‹•å¯èƒ½");const s=(i+r-o)/30;return{improvement:Math.max(-1,Math.min(1,s)),changes:n.length>0?n:["çŠ¶æ³ã«å¤§ããªå¤‰åŒ–ã¯ã‚ã‚Šã¾ã›ã‚“"]}}calculateTransformationConfidence(e){let t=.5;return t+=.3*e.intensity,"stable"!==e.direction&&(t+=.2),Math.min(1,Math.max(.3,t))}generateTransformationMetaphor(e,t,a){const n=e.analysis.metaphor.primary||"ç¾åœ¨",i=t&&t["ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"][0]||"å¤‰åŒ–";return{transformation:{follow:`${n}ã®æµã‚Œã«æ²¿ã£ã¦${i}ã¸`,change:`${n}ã‹ã‚‰${i}ã¸ã®è»¢æ›`,create:`${n}ã‚’è¶…ãˆã¦${i}ã‚’å‰µé€ `}[a.type]||`${n}ã‹ã‚‰${i}ã¸`,direction:a.direction,intensity:a.intensity,symbol:this.getTransformationSymbol(a)}}getTransformationSymbol(e){return{up:"â†—ï¸",down:"â†˜ï¸",reverse:"ğŸ”„",stable:"â¡ï¸"}[e.direction]||"ğŸ”„"}getYaoName(e){return["åˆ","äºŒ","ä¸‰","å››","äº”","ä¸Š"][e-1]||"åˆ"}getFallbackTransformation(e,t){return{choice:t,transformation:{pattern:{type:t,direction:"stable",intensity:.5,risk:.3,opportunity:.6},confidence:.3,metaphor:{transformation:"æ–°ã—ã„å±•é–‹ã¸",symbol:"ğŸ”„"}},newSituation:{hexagram:e.hexagram,yao:{position:e.yao.position,name:e.yao.name},h384Entry:e.h384Entry},scenarios:[{id:"fallback_scenario",type:"realistic",title:"åŸºæœ¬ã‚·ãƒŠãƒªã‚ª",icon:"âš–ï¸",probability:.6,timeline:[{timeframe:"è¿‘ã„å°†æ¥",description:"æ–°ã—ã„å±•é–‹ãŒå§‹ã¾ã‚Šã¾ã™"}],outcomes:[{category:"primary",title:"å¤‰åŒ–ã¸ã®é©å¿œ",description:"ã“ã®é¸æŠã«ã‚ˆã‚Šæ–°ã—ã„çŠ¶æ³ã«é©å¿œã—ã¦ã„ãã¾ã™",impact:.5}]}],comparison:{improvement:0,changes:["çŠ¶æ³ãŒå¤‰åŒ–ã—ã¾ã™"]}}}generateSecondaryOutcome(e,t){const a={optimistic:[`${e}ã‚’é€šã˜ã¦æ–°ã—ã„å¯èƒ½æ€§ãŒé–‹ã‹ã‚Œã¾ã™`,`${e}ã®å½±éŸ¿ã§äºˆæœŸã—ãªã„è‰¯ã„å¤‰åŒ–ãŒèµ·ã“ã‚Šã¾ã™`,`${e}ã«ã‚ˆã‚Šå‘¨å›²ã®ç’°å¢ƒã‚‚å¥½è»¢ã—ã¾ã™`],realistic:[`${e}ã«é–¢é€£ã—ã¦ç€å®Ÿãªé€²æ­©ãŒè¦‹ã‚‰ã‚Œã¾ã™`,`${e}ã‚’è»¸ã¨ã—ãŸå®‰å®šçš„ãªç™ºå±•ãŒæœŸå¾…ã§ãã¾ã™`,`${e}ã«ã‚ˆã‚‹å …å®ŸãªæˆæœãŒå¾—ã‚‰ã‚Œã¾ã™`],cautious:[`${e}ã«ã¤ã„ã¦æ…é‡ãªæ¤œè¨ãŒå¿…è¦ã§ã™`,`${e}ã«å¯¾ã™ã‚‹æº–å‚™ã‚’æ€ ã‚‰ãªã„ã“ã¨ãŒé‡è¦ã§ã™`,`${e}ã®ç®¡ç†ã«æ³¨æ„ã‚’æ‰•ã†å¿…è¦ãŒã‚ã‚Šã¾ã™`],challenging:[`${e}ã‚’å…‹æœã™ã‚‹ã“ã¨ã§æˆé•·ãŒæœŸå¾…ã§ãã¾ã™`,`${e}ã¨ã®å‘ãåˆã„æ–¹ãŒè©¦ã•ã‚Œã¾ã™`,`${e}ã¸ã®å¯¾å‡¦ã«ã‚ˆã‚Šæ–°ãŸãªåŠ›ã‚’ç²å¾—ã—ã¾ã™`]},n=a[t]||a.realistic;return n[Math.floor(Math.random()*n.length)]}initTransformationRules(){return{followRules:{},changeRules:{},createRules:{}}}}window.YaoTransformationSimulator=YaoTransformationSimulator;