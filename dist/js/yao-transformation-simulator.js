class YaoTransformationSimulator{constructor(e){this.ichingAnalyzer=e,this.h384Data=null,this.transformationRules=this.initTransformationRules(),console.log("🔄 Yao Transformation Simulator initialized")}async init(){try{return window.H384_DATA&&Array.isArray(window.H384_DATA)?(this.h384Data=window.H384_DATA,console.log("✅ YaoTransformationSimulator H384_DATA loaded:",this.h384Data.length,"entries"),!0):(console.error("❌ H384_DATA not available for YaoTransformationSimulator"),!1)}catch(e){return console.error("❌ Failed to initialize YaoTransformationSimulator:",e),!1}}simulateTransformation(e,t){console.log("🔄 Simulating transformation for choice:",t);try{const a=this.determineTransformationPattern(e,t),n=this.calculateNewYaoPosition(e.yao.position,a),i=this.calculateHexagramChange(e.hexagram,e.yao.position,n),r=this.ichingAnalyzer.getH384Entry(i.newHexagram.number,n),o=this.generateFutureScenarios(e,r,t,a),s=this.generateTransformationMetaphor(e,r,a),l={choice:t,transformation:{pattern:a,confidence:this.calculateTransformationConfidence(a),metaphor:s},newSituation:{hexagram:i.newHexagram,yao:{position:n,name:this.getYaoName(n),description:this.ichingAnalyzer.getYaoDescription(n)},h384Entry:r},scenarios:o,comparison:this.compareWithCurrent(e,r)};return console.log("✅ Transformation simulation complete:",l),l}catch(a){return console.error("❌ Transformation simulation failed:",a),this.getFallbackTransformation(e,t)}}determineTransformationPattern(e,t){const a=e.yao.position,n=e.analysis.emotion,i=e.analysis.pattern;let r={type:t,direction:"stable",intensity:.5,risk:.3,opportunity:.6};switch(t){case"follow":r.direction=this.getFollowDirection(a,i),r.intensity=.3,r.risk=.2,r.opportunity=.5;break;case"change":r.direction=this.getChangeDirection(a,n),r.intensity=.7,r.risk=.6,r.opportunity=.8;break;case"create":r.direction=this.getCreativeDirection(a,i),r.intensity=.9,r.risk=.8,r.opportunity=.9}return"anxiety"===n.dominant&&n.intensity>.7&&(r.risk+=.2,r.intensity=Math.max(.1,r.intensity-.3)),r}getFollowDirection(e,t){return"growth"===t.primary?"up":"completion"===t.primary?"stable":"crisis"===t.primary?"down":e<=2?"up":e>=5?"stable":"up"}getChangeDirection(e,t){return"confusion"===t.dominant?"reverse":"stagnation"===t.dominant?"up":6===e?"down":e<=3||Math.random()>.5?"up":"down"}getCreativeDirection(e,t){return"stagnation"===t.primary||"completion"===t.primary?"reverse":["up","down","reverse"][Math.floor(3*Math.random())]}calculateNewYaoPosition(e,t){let a=e;switch(t.direction){case"up":a=Math.min(6,e+Math.ceil(2*t.intensity));break;case"down":a=Math.max(1,e-Math.ceil(2*t.intensity));break;case"reverse":a=7-e;break;case"stable":Math.random()<t.intensity&&(a=e+(Math.random()>.5?1:-1),a=Math.max(1,Math.min(6,a)))}return a}calculateHexagramChange(e,t,a){console.log("🔄 [DEBUG] calculateHexagramChange called:",{currentHexagram:e?.name,oldYao:t,newYao:a});const n=Math.abs(a-t);let i=e,r="minimal";n>=1&&(r=n>=3?"major_transformation":"progression",console.log("🔄 [DEBUG] Change type determined:",r),i=this.calculateProgressingHexagram(e,t,a,r));const o={upward_strong:{number:1,name:"乾為天",symbol:"☰☰"},upward_gentle:{number:57,name:"巽為風",symbol:"☴☴"},downward_adaptive:{number:2,name:"坤為地",symbol:"☷☷"},downward_retreat:{number:33,name:"天山遯",symbol:"☰☶"},revolutionary:{number:49,name:"沢火革",symbol:"☱☲"},innovative:{number:50,name:"火風鼎",symbol:"☲☴"},shocking:{number:51,name:"震為雷",symbol:"☳☳"},penetrating:{number:57,name:"巽為風",symbol:"☴☴"}};"major_transformation"===r?i=a>t?n>=4?o.revolutionary:o.upward_strong:a<t?n>=4?o.shocking:o.downward_adaptive:o.innovative:"progression"===r&&(i=a>t?o.upward_gentle:o.downward_retreat);const s={changed:i.number!==e.number,oldHexagram:e,newHexagram:i,changeType:r,yaoMovement:{from:t,to:a,direction:a>t?"ascending":a<t?"descending":"stable",magnitude:n},lineChanges:this.calculateLineChanges(t,a),changeReason:this.getChangeReason(r,n)};return console.log("🔄 [DEBUG] Calculated hexagram change result:",{changed:s.changed,oldName:s.oldHexagram.name,newName:s.newHexagram.name,changeType:s.changeType}),s}calculateProgressingHexagram(e,t,a,n){console.log("🔄 [DEBUG] calculateProgressingHexagram:",{currentHexagram:e?.name,oldYao:t,newYao:a,changeType:n});const i=e.number,r=a>t?"ascending":"descending",o=Math.abs(a-t),s={ascending:{1:{small:i<32?i+1:i,medium:i<30?i+3:i,large:Math.min(64,i+10)},2:{small:i<32?i+2:i,medium:Math.min(64,i+5),large:Math.min(64,i+12)},3:{small:Math.min(64,i+1),medium:Math.min(64,i+7),large:Math.min(64,i+15)}},descending:{6:{small:i>1?i-1:i,medium:Math.max(1,i-5),large:Math.max(1,i-12)},5:{small:Math.max(1,i-2),medium:Math.max(1,i-7),large:Math.max(1,i-15)},4:{small:Math.max(1,i-1),medium:Math.max(1,i-3),large:Math.max(1,i-10)}}};let l=o<=1?"small":o<=3?"medium":"large";const c=s[r]?.[t];let m=i;c&&c[l]&&(m=c[l],console.log("🔄 [DEBUG] Applied progression rule:",{direction:r,oldYao:t,intensityLevel:l,newNumber:m}));const g=this.getHexagramByNumber(m)||e;return console.log("🔄 [DEBUG] Progression result:",{oldNumber:i,newNumber:m,newName:g.name}),g}getHexagramByNumber(e){const t={1:{number:1,name:"乾為天",symbol:"☰☰"},2:{number:2,name:"坤為地",symbol:"☷☷"},3:{number:3,name:"水雷屯",symbol:"☵☳"},4:{number:4,name:"山水蒙",symbol:"☶☵"},5:{number:5,name:"水天需",symbol:"☵☰"},6:{number:6,name:"天水訟",symbol:"☰☵"},7:{number:7,name:"地水師",symbol:"☷☵"},8:{number:8,name:"水地比",symbol:"☵☷"},33:{number:33,name:"天山遯",symbol:"☰☶"},49:{number:49,name:"沢火革",symbol:"☱☲"},50:{number:50,name:"火風鼎",symbol:"☲☴"},51:{number:51,name:"震為雷",symbol:"☳☳"},57:{number:57,name:"巽為風",symbol:"☴☴"}}[e];return!t&&e>=1&&e<=64?{number:e,name:`第${e}卦`,symbol:"☰☰"}:t}calculateLineChanges(e,t){const a={type:t>e?"progressing":t<e?"regressing":"stable",steps:Math.abs(t-e),trajectory:[],significance:this.getChangeSignificance(e,t)};if(a.steps>0){const n=t>e?1:-1;for(let i=e;i!==t;i+=n){const e=i+n;a.trajectory.push({from:i,to:e,significance:this.getPositionSignificance(e)})}}return a}getChangeSignificance(e,t){return{"1-6":"complete_cycle","6-1":"renewal","3-4":"critical_transition","2-5":"elevation","5-2":"humility"}[`${e}-${t}`]||"normal"}getPositionSignificance(e){return{1:{level:"foundation",meaning:"基礎・始まり"},2:{level:"support",meaning:"協力・支援"},3:{level:"challenge",meaning:"試練・困難"},4:{level:"transition",meaning:"変化・転換"},5:{level:"leadership",meaning:"指導・統率"},6:{level:"completion",meaning:"完成・終了"}}[e]||{level:"neutral",meaning:"中立"}}getChangeReason(e,t){return{minimal:"小幅な調整による安定化",progression:`${t}段階の進展による発展`,major_transformation:`${t}段階の大変化による革新`}[e]||"状況の自然な発展"}generateFutureScenarios(e,t,a,n){console.log("🔮 [DEBUG] generateFutureScenarios with 進爻・変爻 integration");const i=[],r=t?t["キーワード"]||[]:["変化"],o=["1ヶ月後","3ヶ月後","6ヶ月後","1年後"],s=[{type:"optimistic_strong",hexagramPattern:"ascending_major",probability:.9*this.calculateOptimisticProbability(n,t),title:"最良・積極展開",icon:"🌟",yaoMovement:"strong_upward"},{type:"optimistic_gentle",hexagramPattern:"ascending_gradual",probability:.7*this.calculateOptimisticProbability(n,t),title:"良好・着実成長",icon:"📈",yaoMovement:"gentle_upward"},{type:"realistic_stable",hexagramPattern:"stable_progression",probability:.6,title:"現実的・安定展開",icon:"⚖️",yaoMovement:"stable"},{type:"realistic_adaptive",hexagramPattern:"adaptive_change",probability:.65,title:"現実的・適応展開",icon:"🔄",yaoMovement:"adaptive"},{type:"challenging_manageable",hexagramPattern:"descending_controlled",probability:.6*this.calculateChallengingProbability(n,t),title:"試練・管理可能",icon:"⚡",yaoMovement:"controlled_descent"},{type:"challenging_severe",hexagramPattern:"descending_major",probability:.8*this.calculateChallengingProbability(n,t),title:"困難・大きな試練",icon:"🌪️",yaoMovement:"strong_downward"},{type:"transformative_breakthrough",hexagramPattern:"revolutionary",probability:.7*n.opportunity,title:"変革・ブレークスルー",icon:"🚀",yaoMovement:"revolutionary"},{type:"transformative_cyclical",hexagramPattern:"cyclical_return",probability:.5*n.intensity,title:"変革・循環的展開",icon:"🔁",yaoMovement:"cyclical"}];for(const l of s){const s={id:`scenario_${l.type}_${Date.now()}`,type:l.type,title:l.title,icon:l.icon,probability:l.probability,hexagramPattern:l.hexagramPattern,yaoMovement:l.yaoMovement,timeline:this.generateProgressionTimeline(l,r,o,e),outcomes:this.generateHexagramBasedOutcomes(l,t,a,e),risks:this.generateYaoBasedRisks(l,n),opportunities:this.generateProgressionOpportunities(l,n),metaphor:this.generateHexagramMetaphor(l,t,e)};i.push(s)}return console.log("🔮 [DEBUG] Generated 8 scenarios with 進爻・変爻 integration:",i.length),i}generateProgressionTimeline(e,t,a,n){const i=[],r=this.calculateYaoProgression(e.yaoMovement,a.length);for(let o=0;o<a.length;o++){const s=a[o],l=t[o%t.length]||"発展",c=r[o];let m=this.generateProgressionDescription(e.hexagramPattern,c,l,n);i.push({timeframe:s,keyword:l,description:m,yaoPosition:c.position,yaoSignificance:c.significance,milestone:this.generateProgressionMilestone(e.type,o,c)})}return i}calculateYaoProgression(e,t){const a=[];for(let n=0;n<t;n++){let t,i;switch(e){case"strong_upward":t=Math.min(6,1+2*n),i="rapid_growth";break;case"gentle_upward":t=Math.min(6,1+n),i="steady_progress";break;case"strong_downward":t=Math.max(1,6-2*n),i="rapid_decline";break;case"controlled_descent":t=Math.max(1,6-n),i="managed_challenge";break;case"stable":t=3+n%2,i="stable_foundation";break;case"revolutionary":t=[1,6,3,4][n%4],i="transformative_leap";break;case"cyclical":t=[1,3,6,2][n%4],i="cyclical_renewal";break;default:t=Math.min(6,1+n),i="natural_flow"}a.push({position:t,significance:i,stage:n+1})}return a}generateProgressionDescription(e,t,a,n){return{ascending_major:`${a}を軸として力強く上昇し、第${t.position}爻の段階で大きな変化を実現`,ascending_gradual:`${a}を通じて着実に進展し、第${t.position}爻で安定した成長を継続`,stable_progression:`${a}の基盤の上で第${t.position}爻の安定した立場を築く`,adaptive_change:`${a}に柔軟に対応し、第${t.position}爻で適応的な変化を遂げる`,descending_controlled:`${a}の調整期間として第${t.position}爻で戦略的な見直しを実行`,descending_major:`${a}に関する大きな試練を第${t.position}爻で経験し学びを得る`,revolutionary:`${a}による革命的な変化が第${t.position}爻で発現する`,cyclical_return:`${a}を通じた循環的な展開が第${t.position}爻で新たな周期を開始`}[e]||`${a}による第${t.position}爻での展開`}generateHexagramBasedOutcomes(e,t,a,n){const i=t?t["現代解釈の要約"]:"",r=t&&t["キーワード"]||[],o=[];return o.push({category:"primary",title:this.generateHexagramOutcomeTitle(e.hexagramPattern,r[0]),description:this.adaptOutcomeToHexagramPattern(i,e.hexagramPattern,a),impact:this.calculateHexagramImpact(e.type,e.yaoMovement),hexagramInfluence:e.hexagramPattern}),r.length>1&&o.push({category:"secondary",title:this.generateYaoOutcomeTitle(e.yaoMovement,r[1]),description:this.generateYaoInfluencedOutcome(r[1],e.yaoMovement),impact:.7*this.calculateHexagramImpact(e.type,e.yaoMovement),yaoInfluence:e.yaoMovement}),o}generateHexagramOutcomeTitle(e,t){t||(t="変化");return{ascending_major:`${t}による力強い飛躍的成功`,ascending_gradual:`${t}を通じた着実で持続的な成長`,stable_progression:`${t}による安定した基盤の確立`,adaptive_change:`${t}への柔軟な適応による調和`,descending_controlled:`${t}の調整による戦略的立て直し`,descending_major:`${t}の試練を通じた根本的な変革`,revolutionary:`${t}による革命的なブレークスルー`,cyclical_return:`${t}の循環による新たな始まり`}[e]||`${t}による変化`}generateYaoOutcomeTitle(e,t){t||(t="変化");return{strong_upward:`${t}の勢いによる急速な向上`,gentle_upward:`${t}の力による段階的な発展`,controlled_descent:`${t}への対処による賢明な調整`,strong_downward:`${t}の困難による深い学び`,stable:`${t}による安定した持続`,revolutionary:`${t}の革新による飛躍`,cyclical:`${t}の循環による再生`,adaptive:`${t}への適応による進化`}[e]||`${t}の影響`}adaptOutcomeToHexagramPattern(e,t,a){if(!e)return`${a}の選択により${t}の展開が始まります。`;return`${{ascending_major:"力強い上昇気流に乗り、",ascending_gradual:"着実な歩みを続けながら、",stable_progression:"安定した基盤の上で、",adaptive_change:"状況に柔軟に適応しつつ、",descending_controlled:"戦略的な調整を行いながら、",descending_major:"大きな試練を通じて、",revolutionary:"革命的な変化の中で、",cyclical_return:"新たな周期の始まりとして、"}[t]||""}${e}`}calculateHexagramImpact(e,t){const a={optimistic_strong:.9,optimistic_gentle:.7,realistic_stable:.6,realistic_adaptive:.65,challenging_manageable:.5,challenging_severe:.4,transformative_breakthrough:.85,transformative_cyclical:.75}[e]||.6,n={strong_upward:1.2,gentle_upward:1,stable:.9,adaptive:1,controlled_descent:.8,strong_downward:.6,revolutionary:1.3,cyclical:1.1}[t]||1;return Math.min(1,a*n)}generateYaoBasedRisks(e,t){const a=[],n=t.risk,i={strong_upward:{type:"overextension",description:"急速な上昇による基盤の不安定化",probability:.8*n,mitigation:"段階的な基盤強化と慎重な拡大"},strong_downward:{type:"spiral_decline",description:"下降の勢いが制御困難になるリスク",probability:.9*n,mitigation:"早期の介入と支援体制の構築"},revolutionary:{type:"disruption_chaos",description:"革命的変化による既存システムの混乱",probability:.7*n,mitigation:"変化管理と段階的な移行計画"},cyclical:{type:"repetitive_pattern",description:"同じパターンの繰り返しによる停滞",probability:.6*n,mitigation:"新たな要素の導入と学習の継続"}}[e.yaoMovement];return i&&a.push(i),a}generateProgressionOpportunities(e,t){const a=[],n=t.opportunity,i={strong_upward:{type:"acceleration",description:"上昇の勢いを活かした更なる飛躍の機会",probability:.9*n,action:"勢いを維持しながら戦略的な拡大を図る"},gentle_upward:{type:"sustainable_growth",description:"持続可能な成長基盤の確立機会",probability:.8*n,action:"着実な歩みで長期的な価値を築く"},revolutionary:{type:"paradigm_shift",description:"パラダイムシフトによる先駆者優位の機会",probability:.85*n,action:"変革の波に乗り新しい価値を創造"},adaptive:{type:"flexibility_advantage",description:"適応性を活かした多様な展開の機会",probability:.75*n,action:"柔軟性を武器に変化する環境で優位を確立"}}[e.yaoMovement];return i&&a.push(i),a}generateHexagramMetaphor(e,t,a){if(!t)return{symbol:"変化の流れ",meaning:`${e.hexagramPattern}による新しい展開の時`};const n=t["キーワード"]||["変化"],i=t["卦名"]||"";return{ascending_major:{symbol:`${n[0]}の龍が昇天する如く`,meaning:`${i}の力が最も強く発現し、大きな飛躍を遂げる時`},ascending_gradual:{symbol:`${n[0]}の風が山を登る如く`,meaning:`${i}の教えに従い、一歩ずつ高みに向かう時`},stable_progression:{symbol:`${n[0]}の大地が万物を支える如く`,meaning:`${i}の安定した力で基盤を固める時`},revolutionary:{symbol:`${n[0]}の雷が天地を震わす如く`,meaning:`${i}の革新の力で世界を変える時`},cyclical_return:{symbol:`${n[0]}の季節が巡り来る如く`,meaning:`${i}の循環の中で新たな始まりを迎える時`}}[e.hexagramPattern]||{symbol:`${n[0]}の流れ`,meaning:`${i}による変化の時`}}generateYaoInfluencedOutcome(e,t){return{strong_upward:`${e}の勢いにより予想を上回る成果が期待される`,gentle_upward:`${e}を通じて持続可能な発展が見込まれる`,controlled_descent:`${e}の調整により必要な修正が実現される`,strong_downward:`${e}の困難を通じて重要な気づきを得る`,stable:`${e}により安定した状態が維持される`,revolutionary:`${e}の革新により従来の枠を超えた展開となる`,cyclical:`${e}の循環により新たな可能性が開かれる`,adaptive:`${e}への適応により柔軟な対応力を獲得する`}[t]||`${e}による変化が起こる`}generateProgressionMilestone(e,t,a){return`${["準備期","展開期","発展期","完成期"][t]||"継続期"}：${{1:"基礎確立",2:"協力獲得",3:"試練克服",4:"転換実現",5:"頂点達成",6:"完成到達"}[a.position]||"進展"}`}generateTimeline(e,t,a){const n=[];for(let i=0;i<a.length;i++){const r=a[i],o=t[i%t.length]||"発展";let s;switch(e.type){case"optimistic":s=`${o}を活かして順調に進展。新しい機会が生まれる。`;break;case"realistic":s=`${o}に関する課題に取り組み、着実に前進。`;break;case"challenging":s=`${o}に関する困難に直面するが、学びを得る。`}n.push({timeframe:r,keyword:o,description:s,milestone:this.generateMilestone(e.type,i)})}return n}generateMilestone(e,t){return{optimistic:["基盤構築完了","第一目標達成","大きな成果実現","新たなステージへ"],realistic:["準備段階完了","中間目標達成","課題克服","安定した成長"],challenging:["困難認識","対策立案","試練克服","強靭性獲得"]}[e][t]||"進展"}calculateOptimisticProbability(e,t){let a=.3;if(a+=.4*e.opportunity,t){a+=((t["S2_ポテンシャル"]||50)+(t["S1_基本スコア"]||50))/200*.3}return Math.min(.8,Math.max(.1,a))}calculateChallengingProbability(e,t){let a=.2;if(a+=.3*e.risk,t){a+=(t["S4_リスク"]||30)/100*.2}return Math.min(.6,Math.max(.1,a))}generateOutcomes(e,t,a){const n=t?t["現代解釈の要約"]:"",i=t&&t["キーワード"]||[],r=[];return r.push({category:"primary",title:this.generateOutcomeTitle(e.type,i[0]),description:this.adaptOutcomeToChoice(n,a,e.type),impact:this.calculateImpact(e.type)}),i.length>1&&r.push({category:"secondary",title:this.generateOutcomeTitle(e.type,i[1]),description:this.generateSecondaryOutcome(i[1],e.type),impact:.7*this.calculateImpact(e.type)}),r}generateOutcomeTitle(e,t){t||(t="変化");return{optimistic:`${t}による大きな成功`,realistic:`${t}を通じた着実な成長`,challenging:`${t}の試練を経た成熟`}[e]||`${t}による変化`}adaptOutcomeToChoice(e,t,a){if(!e)return`${t}の選択により新しい展開が始まります。`;return`${{follow:"このテーマに従うことで、",change:"テーマを変えることで、",create:"新しいテーマを創ることで、"}[t]||""}${e}`}calculateImpact(e){return{optimistic:.8,realistic:.6,challenging:.4}[e]||.5}generateRisks(e,t){const a=[],n=t.risk;switch(e.type){case"optimistic":n>.3&&a.push({type:"overconfidence",description:"成功による慢心のリスク",probability:.5*n,mitigation:"謙虚さを保つ"});break;case"realistic":a.push({type:"stagnation",description:"進展の停滞",probability:.7*n,mitigation:"定期的な見直しと調整"});break;case"challenging":a.push({type:"overwhelm",description:"困難の重複による疲弊",probability:.9*n,mitigation:"サポートの求め方を学ぶ"})}return a}generateOpportunities(e,t){const a=[],n=t.opportunity;switch(e.type){case"optimistic":a.push({type:"expansion",description:"更なる発展の機会",probability:.9*n,action:"積極的な行動で機会を活かす"});break;case"realistic":a.push({type:"learning",description:"スキル向上の機会",probability:.7*n,action:"継続的な学習と改善"});break;case"challenging":a.push({type:"resilience",description:"精神的強さを獲得する機会",probability:.8*n,action:"困難を成長の糧とする"})}return a}generateScenarioMetaphor(e,t){if(!t)return{symbol:"変化の波",meaning:"新しい流れが生まれる時"};const a=t["キーワード"]||["変化"],n=t["卦名"]||"";return{optimistic:{symbol:`${a[0]}の花開く`,meaning:`${n}のエネルギーが最高の形で現れる時`},realistic:{symbol:`${a[0]}の成長`,meaning:`${n}の教えに従い着実に進む時`},challenging:{symbol:`${a[0]}の試練`,meaning:`${n}の深い意味を理解する時`}}[e.type]||{symbol:"変化の時",meaning:"新しい段階への移行"}}compareWithCurrent(e,t){if(!t||!e.h384Entry)return{improvement:0,changes:["状況が変化します"]};const a=e.h384Entry,n=[],i=(t["S1_基本スコア"]||50)-(a["S1_基本スコア"]||50),r=(t["S2_ポテンシャル"]||50)-(a["S2_ポテンシャル"]||50),o=(t["S4_リスク"]||30)-(a["S4_リスク"]||30);i>10&&n.push("基本的な運勢が向上"),i<-10&&n.push("基本的な運勢に注意が必要"),r>10&&n.push("将来の可能性が拡大"),r<-10&&n.push("可能性の慎重な見極めが必要"),o>10&&n.push("リスクが増加、注意深い行動を"),o<-10&&n.push("リスクが減少、積極的に行動可能");const s=(i+r-o)/30;return{improvement:Math.max(-1,Math.min(1,s)),changes:n.length>0?n:["状況に大きな変化はありません"]}}calculateTransformationConfidence(e){let t=.5;return t+=.3*e.intensity,"stable"!==e.direction&&(t+=.2),Math.min(1,Math.max(.3,t))}generateTransformationMetaphor(e,t,a){const n=e.analysis.metaphor.primary||"現在",i=t&&t["キーワード"][0]||"変化";return{transformation:{follow:`${n}の流れに沿って${i}へ`,change:`${n}から${i}への転換`,create:`${n}を超えて${i}を創造`}[a.type]||`${n}から${i}へ`,direction:a.direction,intensity:a.intensity,symbol:this.getTransformationSymbol(a)}}getTransformationSymbol(e){return{up:"↗️",down:"↘️",reverse:"🔄",stable:"➡️"}[e.direction]||"🔄"}getYaoName(e){return["初","二","三","四","五","上"][e-1]||"初"}getFallbackTransformation(e,t){return{choice:t,transformation:{pattern:{type:t,direction:"stable",intensity:.5,risk:.3,opportunity:.6},confidence:.3,metaphor:{transformation:"新しい展開へ",symbol:"🔄"}},newSituation:{hexagram:e.hexagram,yao:{position:e.yao.position,name:e.yao.name},h384Entry:e.h384Entry},scenarios:[{id:"fallback_scenario",type:"realistic",title:"基本シナリオ",icon:"⚖️",probability:.6,timeline:[{timeframe:"近い将来",description:"新しい展開が始まります"}],outcomes:[{category:"primary",title:"変化への適応",description:"この選択により新しい状況に適応していきます",impact:.5}]}],comparison:{improvement:0,changes:["状況が変化します"]}}}generateSecondaryOutcome(e,t){const a={optimistic:[`${e}を通じて新しい可能性が開かれます`,`${e}の影響で予期しない良い変化が起こります`,`${e}により周囲の環境も好転します`],realistic:[`${e}に関連して着実な進歩が見られます`,`${e}を軸とした安定的な発展が期待できます`,`${e}による堅実な成果が得られます`],cautious:[`${e}について慎重な検討が必要です`,`${e}に対する準備を怠らないことが重要です`,`${e}の管理に注意を払う必要があります`],challenging:[`${e}を克服することで成長が期待できます`,`${e}との向き合い方が試されます`,`${e}への対処により新たな力を獲得します`]},n=a[t]||a.realistic;return n[Math.floor(Math.random()*n.length)]}initTransformationRules(){return{followRules:{},changeRules:{},createRules:{}}}}window.YaoTransformationSimulator=YaoTransformationSimulator;