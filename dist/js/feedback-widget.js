class FeedbackWidget{constructor(){this.feedbackData={satisfaction:0,accuracy:0,helpful:null,comments:"",timestamp:null},this.isVisible=!1}createWidget(){const e=document.createElement("div");e.id="feedback-widget",e.className="feedback-widget",e.innerHTML=`\n            <div class="feedback-container">\n                <button class="feedback-toggle" onclick="window.feedbackWidget.toggle()">\n                    üìù „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ\n                </button>\n                <div class="feedback-panel" style="display: none;">\n                    <h3>ÂàÜÊûêÁµêÊûú„ÅØ„ÅÑ„Åã„Åå„Åß„Åó„Åü„ÅãÔºü</h3>\n                    \n                    <div class="feedback-section">\n                        <label>Ê∫ÄË∂≥Â∫¶</label>\n                        <div class="rating-stars" data-rating="satisfaction">\n                            ${this.createStars("satisfaction")}\n                        </div>\n                    </div>\n                    \n                    <div class="feedback-section">\n                        <label>Á≤æÂ∫¶„ÅÆÈ´ò„Åï</label>\n                        <div class="rating-stars" data-rating="accuracy">\n                            ${this.createStars("accuracy")}\n                        </div>\n                    </div>\n                    \n                    <div class="feedback-section">\n                        <label>„Åì„ÅÆÂàÜÊûê„ÅØÂΩπ„Å´Á´ã„Å°„Åæ„Åó„Åü„ÅãÔºü</label>\n                        <div class="helpful-buttons">\n                            <button class="helpful-btn" data-helpful="yes" onclick="window.feedbackWidget.setHelpful(true)">\n                                üëç „ÅØ„ÅÑ\n                            </button>\n                            <button class="helpful-btn" data-helpful="no" onclick="window.feedbackWidget.setHelpful(false)">\n                                üëé „ÅÑ„ÅÑ„Åà\n                            </button>\n                        </div>\n                    </div>\n                    \n                    <div class="feedback-section">\n                        <label>„ÅîÊÑèË¶ã„Éª„ÅîÊÑüÊÉ≥Ôºà‰ªªÊÑèÔºâ</label>\n                        <textarea \n                            id="feedback-comments" \n                            placeholder="ÊîπÂñÑÁÇπ„ÇÑ„ÅîË¶ÅÊúõ„Åå„ÅÇ„Çå„Å∞„ÅäËÅû„Åã„Åõ„Åè„Å†„Åï„ÅÑ"\n                            maxlength="500"\n                        ></textarea>\n                    </div>\n                    \n                    <div class="feedback-actions">\n                        <button class="btn-submit" onclick="window.feedbackWidget.submit()">\n                            ÈÄÅ‰ø°\n                        </button>\n                        <button class="btn-cancel" onclick="window.feedbackWidget.close()">\n                            „Ç≠„É£„É≥„Çª„É´\n                        </button>\n                    </div>\n                    \n                    <div class="feedback-message" style="display: none;"></div>\n                </div>\n            </div>\n        `;const n=document.createElement("style");n.textContent="\n            .feedback-widget {\n                position: fixed;\n                bottom: 20px;\n                right: 20px;\n                z-index: 10000;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            }\n            \n            .feedback-toggle {\n                background: #4a90e2;\n                color: white;\n                border: none;\n                padding: 12px 20px;\n                border-radius: 25px;\n                cursor: pointer;\n                font-size: 14px;\n                box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n                transition: all 0.3s ease;\n            }\n            \n            .feedback-toggle:hover {\n                background: #357abd;\n                transform: translateY(-2px);\n                box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n            }\n            \n            .feedback-panel {\n                position: absolute;\n                bottom: 60px;\n                right: 0;\n                background: white;\n                border-radius: 12px;\n                box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n                padding: 20px;\n                width: 320px;\n                max-height: 500px;\n                overflow-y: auto;\n            }\n            \n            .feedback-panel h3 {\n                margin: 0 0 20px 0;\n                color: #333;\n                font-size: 16px;\n            }\n            \n            .feedback-section {\n                margin-bottom: 20px;\n            }\n            \n            .feedback-section label {\n                display: block;\n                margin-bottom: 8px;\n                color: #666;\n                font-size: 14px;\n            }\n            \n            .rating-stars {\n                display: flex;\n                gap: 8px;\n            }\n            \n            .star {\n                font-size: 24px;\n                cursor: pointer;\n                transition: transform 0.2s ease;\n                user-select: none;\n            }\n            \n            .star:hover {\n                transform: scale(1.2);\n            }\n            \n            .star.active {\n                color: #ffd700;\n            }\n            \n            .helpful-buttons {\n                display: flex;\n                gap: 10px;\n            }\n            \n            .helpful-btn {\n                flex: 1;\n                padding: 8px 16px;\n                border: 1px solid #ddd;\n                background: white;\n                border-radius: 6px;\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n            \n            .helpful-btn:hover {\n                background: #f5f5f5;\n            }\n            \n            .helpful-btn.selected {\n                background: #4a90e2;\n                color: white;\n                border-color: #4a90e2;\n            }\n            \n            #feedback-comments {\n                width: 100%;\n                min-height: 80px;\n                padding: 8px;\n                border: 1px solid #ddd;\n                border-radius: 6px;\n                resize: vertical;\n                font-size: 14px;\n                font-family: inherit;\n            }\n            \n            .feedback-actions {\n                display: flex;\n                gap: 10px;\n                margin-top: 20px;\n            }\n            \n            .btn-submit, .btn-cancel {\n                flex: 1;\n                padding: 10px;\n                border: none;\n                border-radius: 6px;\n                cursor: pointer;\n                font-size: 14px;\n                transition: all 0.2s ease;\n            }\n            \n            .btn-submit {\n                background: #4a90e2;\n                color: white;\n            }\n            \n            .btn-submit:hover {\n                background: #357abd;\n            }\n            \n            .btn-cancel {\n                background: #f5f5f5;\n                color: #666;\n            }\n            \n            .btn-cancel:hover {\n                background: #e0e0e0;\n            }\n            \n            .feedback-message {\n                margin-top: 15px;\n                padding: 10px;\n                border-radius: 6px;\n                font-size: 14px;\n                text-align: center;\n            }\n            \n            .feedback-message.success {\n                background: #d4edda;\n                color: #155724;\n                border: 1px solid #c3e6cb;\n            }\n            \n            .feedback-message.error {\n                background: #f8d7da;\n                color: #721c24;\n                border: 1px solid #f5c6cb;\n            }\n        ",document.head.appendChild(n),document.body.appendChild(e),this.attachEventListeners()}createStars(e){let n="";for(let t=1;t<=5;t++)n+=`<span class="star" data-value="${t}" data-type="${e}" onclick="window.feedbackWidget.setRating('${e}', ${t})">‚òÜ</span>`;return n}attachEventListeners(){const e=document.getElementById("feedback-comments");e&&e.addEventListener("input",e=>{this.feedbackData.comments=e.target.value})}toggle(){const e=document.querySelector(".feedback-panel");e&&(this.isVisible=!this.isVisible,e.style.display=this.isVisible?"block":"none")}close(){const e=document.querySelector(".feedback-panel");e&&(e.style.display="none",this.isVisible=!1)}setRating(e,n){this.feedbackData[e]=n;document.querySelectorAll(`.star[data-type="${e}"]`).forEach((e,t)=>{t<n?(e.textContent="‚òÖ",e.classList.add("active")):(e.textContent="‚òÜ",e.classList.remove("active"))})}setHelpful(e){this.feedbackData.helpful=e;document.querySelectorAll(".helpful-btn").forEach(e=>{e.classList.remove("selected")});const n=document.querySelector(`.helpful-btn[data-helpful="${e?"yes":"no"}"]`);n&&n.classList.add("selected")}submit(){this.feedbackData.timestamp=(new Date).toISOString(),0!==this.feedbackData.satisfaction&&0!==this.feedbackData.accuracy?(window.haqeiABTest&&window.haqeiABTest.trackFeedback(this.feedbackData.satisfaction,this.feedbackData.accuracy,this.feedbackData.comments),this.storeFeedback(),this.showMessage("„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„ÅüÔºÅ","success"),setTimeout(()=>{this.close(),this.reset()},2e3)):this.showMessage("Ê∫ÄË∂≥Â∫¶„Å®Á≤æÂ∫¶„ÅÆË©ï‰æ°„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ","error")}storeFeedback(){const e=JSON.parse(localStorage.getItem("haqei_feedback")||"[]");e.push(this.feedbackData),e.length>50&&e.splice(0,e.length-50),localStorage.setItem("haqei_feedback",JSON.stringify(e))}showMessage(e,n){const t=document.querySelector(".feedback-message");t&&(t.textContent=e,t.className=`feedback-message ${n}`,t.style.display="block")}reset(){this.feedbackData={satisfaction:0,accuracy:0,helpful:null,comments:"",timestamp:null},document.querySelectorAll(".star").forEach(e=>{e.textContent="‚òÜ",e.classList.remove("active")}),document.querySelectorAll(".helpful-btn").forEach(e=>{e.classList.remove("selected")});const e=document.getElementById("feedback-comments");e&&(e.value="");const n=document.querySelector(".feedback-message");n&&(n.style.display="none")}showAfterAnalysis(e=5e3){setTimeout(()=>{const e=document.querySelector(".feedback-toggle");e&&(e.style.animation="pulse 2s ease-in-out 3")},e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.feedbackWidget=new FeedbackWidget,window.feedbackWidget.createWidget()}):(window.feedbackWidget=new FeedbackWidget,window.feedbackWidget.createWidget());const pulseStyle=document.createElement("style");pulseStyle.textContent="\n    @keyframes pulse {\n        0% { transform: scale(1); }\n        50% { transform: scale(1.1); }\n        100% { transform: scale(1); }\n    }\n",document.head.appendChild(pulseStyle);