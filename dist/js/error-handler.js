console.log("🚀 Error Handler Module loading...");class ComprehensiveErrorHandler{constructor(){this.errorLog=[],this.maxLogSize=100,this.retryAttempts=new Map,this.maxRetries=3,this.userNotifications=new Set,this.setupErrorHandling()}setupErrorHandling(){window.addEventListener("error",e=>this.handleGlobalError(e)),window.addEventListener("unhandledrejection",e=>this.handleUnhandledRejection(e)),window.addEventListener("online",()=>this.handleNetworkRestore()),window.addEventListener("offline",()=>this.handleNetworkLoss())}handleGlobalError(e){if(["chrome-extension://","moz-extension://","safari-extension://","extension:","content.js","background.js","popup.js","inject.js"].some(r=>e.filename?.includes(r)||e.message?.includes(r)))return e.preventDefault(),!0;this.logError({type:"javascript",message:e.message,filename:e.filename,lineno:e.lineno,error:e.error,timestamp:(new Date).toISOString()}),this.handleApplicationError(e.error||new Error(e.message))}handleUnhandledRejection(e){if(e.reason?.message&&["chrome-extension","moz-extension","safari-extension","Extension context","port closed","context invalidated"].some(r=>e.reason.message.includes(r)))return e.preventDefault(),!0;this.logError({type:"promise_rejection",reason:e.reason,timestamp:(new Date).toISOString()}),this.handleApplicationError(e.reason)}handleApplicationError(e){switch(this.categorizeError(e)){case"kuromoji":this.handleKuromojiError(e);break;case"network":this.handleNetworkError(e);break;case"data_loading":this.handleDataLoadingError(e);break;case"analysis":this.handleAnalysisError(e);break;case"input_validation":this.handleInputValidationError(e);break;default:this.handleGenericError(e)}}categorizeError(e){const r=e?.message?.toLowerCase()||"",o=e?.stack?.toLowerCase()||"";return r.includes("kuromoji")||o.includes("kuromoji")?"kuromoji":r.includes("network")||r.includes("fetch")?"network":r.includes("data")||r.includes("loading")?"data_loading":r.includes("analysis")||r.includes("分析")?"analysis":r.includes("validation")||r.includes("入力")?"input_validation":"generic"}logError(e){this.errorLog.push(e),this.errorLog.length>this.maxLogSize&&this.errorLog.shift(),console.error("📋 Error logged:",e)}async handleKuromojiError(e){console.warn("🔤 Kuromoji error handled gracefully:",e.message);try{if(window.dictionaryLoader){console.log("📚 Attempting to load essential dictionaries as fallback...");if(await window.dictionaryLoader.loadEssentialDictionaries())return void console.log("✅ Essential dictionaries loaded - basic functionality restored")}}catch(o){console.warn("⚠️ Dictionary fallback failed:",o)}const r=document.getElementById("error-container");if(r){const e='\n        <div class="fallback-notice bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">\n          <h4 class="text-yellow-800 font-semibold mb-2">日本語解析機能の制限</h4>\n          <p class="text-yellow-700 text-sm">\n            高度な日本語解析機能が利用できませんが、HAQEI分析の核心機能は正常に動作します。\n            より詳細な解析をご希望の場合は、下のボタンで追加機能を読み込めます。\n          </p>\n          <button onclick="window.dictionaryLoader?.loadAdvancedDictionaries().then(() => location.reload())" \n                  class="mt-2 px-3 py-1 bg-yellow-600 text-white text-xs rounded hover:bg-yellow-700 transition-colors">\n            高度機能を読み込む\n          </button>\n        </div>\n      ';r.innerHTML=e,setTimeout(()=>r.innerHTML="",15e3)}}handleNetworkError(e){console.warn("🌐 Network error handled:",e.message)}handleDataLoadingError(e){console.warn("📊 Data loading error handled:",e.message)}handleAnalysisError(e){console.warn("🔍 Analysis error handled:",e.message)}handleInputValidationError(e){console.warn("✏️ Input validation error handled:",e.message)}handleGenericError(e){console.warn("⚠️ Generic error handled:",e.message)}handleNetworkRestore(){console.log("🌐 Network restored")}handleNetworkLoss(){console.log("📡 Network lost - switching to offline mode")}}const errorHandler=new ComprehensiveErrorHandler;window.errorHandler=errorHandler;export{ComprehensiveErrorHandler};console.log("✅ Error Handler Module loaded");