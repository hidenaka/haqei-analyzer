class HAQEIABTesting{constructor(){this.testId=this.getOrCreateTestId(),this.variant=this.assignVariant(),this.events=[],this.startTime=Date.now(),this.initializeTracking()}getOrCreateTestId(){let t=localStorage.getItem("haqei_test_id");return t||(t="test_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),localStorage.setItem("haqei_test_id",t)),t}assignVariant(){let t=localStorage.getItem("haqei_test_variant");return t||(t=Math.random()<.5?"A":"B",localStorage.setItem("haqei_test_variant",t)),t}initializeTracking(){this.trackEvent("page_view",{url:window.location.href,referrer:document.referrer}),this.trackEvent("variant_assigned",{variant:this.variant})}applyVariant(){"B"===this.variant&&this.applyVariantB()}applyVariantB(){const t=document.querySelector('#startAnalysisBtn, button[onclick*="startAnalysis"]');t&&(t.textContent="🚀 あなたのOSを分析する"),document.body.classList.add("variant-b"),this.enhanceVisualFeedback()}enhanceVisualFeedback(){const t=document.createElement("style");t.textContent="\n            .variant-b .question-card {\n                transition: all 0.3s ease;\n            }\n            .variant-b .question-card:hover {\n                transform: translateY(-2px);\n                box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n            }\n            .variant-b .progress-bar {\n                background: linear-gradient(90deg, #4a90e2, #67b8ff);\n            }\n            .variant-b button {\n                transition: all 0.2s ease;\n            }\n            .variant-b button:active {\n                transform: scale(0.98);\n            }\n        ",document.head.appendChild(t)}trackEvent(t,e={}){const a={name:t,timestamp:Date.now(),variant:this.variant,testId:this.testId,data:e};this.events.push(a),this.saveEvents(),this.sendToAnalytics(a)}trackAnalysisStart(){this.trackEvent("analysis_started",{timestamp:Date.now()})}trackQuestionAnswered(t,e){this.trackEvent("question_answered",{question:t,answer:e,timeSpent:Date.now()-this.startTime})}trackAnalysisComplete(t){const e=Date.now()-this.startTime;this.trackEvent("analysis_completed",{completionTime:e,engineOS:t.engineOS,interfaceOS:t.interfaceOS,safeModeOS:t.safeModeOS})}trackFeedback(t,e,a){this.trackEvent("user_feedback",{satisfaction:t,accuracy:e,comments:a,variant:this.variant})}saveEvents(){const t=JSON.parse(localStorage.getItem("haqei_ab_events")||"[]");t.push(...this.events),t.length>100&&t.splice(0,t.length-100),localStorage.setItem("haqei_ab_events",JSON.stringify(t))}sendToAnalytics(t){"undefined"!=typeof gtag&&gtag("event",t.name,{event_category:"AB_Test",event_label:this.variant,value:t.data}),window.HAQEI_ANALYTICS_ENDPOINT&&fetch(window.HAQEI_ANALYTICS_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(t=>{})}getConversionRate(){const t=this.events.filter(t=>"analysis_completed"===t.name).length,e=this.events.filter(t=>"analysis_started"===t.name).length;return 0===e?0:t/e*100}getAverageCompletionTime(){const t=this.events.filter(t=>"analysis_completed"===t.name);if(0===t.length)return 0;return t.reduce((t,e)=>t+e.data.completionTime,0)/t.length}getMetrics(){return{variant:this.variant,testId:this.testId,conversionRate:this.getConversionRate(),averageCompletionTime:this.getAverageCompletionTime(),totalEvents:this.events.length,startTime:this.startTime}}exportTestData(){const t={testId:this.testId,variant:this.variant,events:this.events,metrics:this.getMetrics(),exportDate:(new Date).toISOString()},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=`haqei_ab_test_${this.testId}.json`,n.click(),URL.revokeObjectURL(a)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.haqeiABTest=new HAQEIABTesting,window.haqeiABTest.applyVariant()}):(window.haqeiABTest=new HAQEIABTesting,window.haqeiABTest.applyVariant()),"undefined"!=typeof module&&module.exports&&(module.exports=HAQEIABTesting);