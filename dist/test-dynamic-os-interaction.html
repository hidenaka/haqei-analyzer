<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>OS Analyzer 動的生成検証</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
        }
        .test-section { 
            margin: 30px 0; 
            padding: 20px; 
            border: 1px solid #444; 
            border-radius: 8px;
        }
        .os-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        .os-input {
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 5px;
        }
        .os-input label {
            display: block;
            color: #60a5fa;
            margin-bottom: 5px;
        }
        .os-input select {
            width: 100%;
            padding: 8px;
            background: #0f172a;
            color: #e5e7eb;
            border: 1px solid #475569;
            border-radius: 4px;
        }
        .os-input input[type="number"] {
            width: 100%;
            padding: 8px;
            background: #0f172a;
            color: #e5e7eb;
            border: 1px solid #475569;
            border-radius: 4px;
            margin-top: 5px;
        }
        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            opacity: 0.9;
        }
        #interaction-result {
            margin-top: 30px;
            padding: 20px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 8px;
            min-height: 200px;
        }
        .result-section {
            margin: 15px 0;
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 5px;
        }
        .pair-insight {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 4px;
        }
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .synergy { background: #10b981; }
        .harmony { background: #3b82f6; }
        .tension { background: #f59e0b; }
        .conflict { background: #ef4444; }
    </style>
</head>
<body>
    <h1>🔮 OS Analyzer 動的生成検証ツール</h1>
    <p>異なるOSの組み合わせで相互作用がどのように変化するか確認できます</p>

    <div class="test-section">
        <h2>📊 テストケース1: 異なる卦の組み合わせ</h2>
        
        <div class="os-selector">
            <div class="os-input">
                <label for="engine-hex-1">⚡ Engine OS</label>
                <select id="engine-hex-1">
                    <option value="1">1. 乾為天（天）</option>
                    <option value="2">2. 坤為地（地）</option>
                    <option value="3">3. 水雷屯（始動）</option>
                    <option value="29">29. 坎為水（水）</option>
                    <option value="30">30. 離為火（火）</option>
                    <option value="63">63. 水火既済（完成）</option>
                    <option value="64">64. 火水未済（未完）</option>
                </select>
                <input type="number" id="engine-score-1" min="0" max="1" step="0.1" value="0.8" placeholder="スコア (0-1)">
            </div>
            
            <div class="os-input">
                <label for="interface-hex-1">🔄 Interface OS</label>
                <select id="interface-hex-1">
                    <option value="2">2. 坤為地（地）</option>
                    <option value="11">11. 地天泰（調和）</option>
                    <option value="12">12. 天地否（閉塞）</option>
                    <option value="31">31. 沢山咸（感応）</option>
                    <option value="41">41. 山沢損（謙遜）</option>
                </select>
                <input type="number" id="interface-score-1" min="0" max="1" step="0.1" value="0.7" placeholder="スコア (0-1)">
            </div>
            
            <div class="os-input">
                <label for="safe-hex-1">🛡️ SafeMode OS</label>
                <select id="safe-hex-1">
                    <option value="29">29. 坎為水（水）</option>
                    <option value="52">52. 艮為山（静止）</option>
                    <option value="33">33. 天山遯（退避）</option>
                    <option value="39">39. 水山蹇（困難）</option>
                </select>
                <input type="number" id="safe-score-1" min="0" max="1" step="0.1" value="0.6" placeholder="スコア (0-1)">
            </div>
        </div>
        
        <button onclick="runTest(1)">🚀 テスト1実行</button>
        <div id="result-1" class="result-section"></div>
    </div>

    <div class="test-section">
        <h2>📊 テストケース2: スコアの変化による影響</h2>
        
        <div class="os-selector">
            <div class="os-input">
                <label for="engine-hex-2">⚡ Engine OS（固定）</label>
                <select id="engine-hex-2" disabled>
                    <option value="1">1. 乾為天（天）</option>
                </select>
                <input type="number" id="engine-score-2" min="0" max="1" step="0.1" value="0.9" placeholder="スコア (0-1)">
            </div>
            
            <div class="os-input">
                <label for="interface-hex-2">🔄 Interface OS（固定）</label>
                <select id="interface-hex-2" disabled>
                    <option value="2">2. 坤為地（地）</option>
                </select>
                <input type="number" id="interface-score-2" min="0" max="1" step="0.1" value="0.3" placeholder="スコア (0-1)">
            </div>
            
            <div class="os-input">
                <label for="safe-hex-2">🛡️ SafeMode OS（固定）</label>
                <select id="safe-hex-2" disabled>
                    <option value="29">29. 坎為水（水）</option>
                </select>
                <input type="number" id="safe-score-2" min="0" max="1" step="0.1" value="0.5" placeholder="スコア (0-1)">
            </div>
        </div>
        
        <button onclick="runTest(2)">🚀 テスト2実行（スコア差による葛藤）</button>
        <div id="result-2" class="result-section"></div>
    </div>

    <div class="test-section">
        <h2>📊 テストケース3: ランダム生成（動的確認）</h2>
        <button onclick="runRandomTest()">🎲 ランダムOS生成＆分析</button>
        <div id="random-config"></div>
        <div id="result-3" class="result-section"></div>
    </div>

    <script src="./js/core/TripleOSInteractionAnalyzer.js"></script>
    <script>
        const hexagramNames = {
            1: '乾為天', 2: '坤為地', 3: '水雷屯', 11: '地天泰', 12: '天地否',
            29: '坎為水', 30: '離為火', 31: '沢山咸', 33: '天山遯', 39: '水山蹇',
            41: '山沢損', 52: '艮為山', 63: '水火既済', 64: '火水未済'
        };

        function runTest(testNum) {
            const analyzer = new TripleOSInteractionAnalyzer();
            
            // テストケースからOS設定を取得
            const engineOS = {
                hexagramId: parseInt(document.getElementById(`engine-hex-${testNum}`).value),
                name: hexagramNames[parseInt(document.getElementById(`engine-hex-${testNum}`).value)],
                score: parseFloat(document.getElementById(`engine-score-${testNum}`).value)
            };
            
            const interfaceOS = {
                hexagramId: parseInt(document.getElementById(`interface-hex-${testNum}`).value),
                name: hexagramNames[parseInt(document.getElementById(`interface-hex-${testNum}`).value)],
                score: parseFloat(document.getElementById(`interface-score-${testNum}`).value)
            };
            
            const safeModeOS = {
                hexagramId: parseInt(document.getElementById(`safe-hex-${testNum}`).value),
                name: hexagramNames[parseInt(document.getElementById(`safe-hex-${testNum}`).value)],
                score: parseFloat(document.getElementById(`safe-score-${testNum}`).value)
            };
            
            // 分析実行
            const analysis = analyzer.analyze(engineOS, interfaceOS, safeModeOS);
            
            // 結果表示
            displayResult(analysis, `result-${testNum}`);
        }
        
        function runRandomTest() {
            const analyzer = new TripleOSInteractionAnalyzer();
            
            // ランダムOS生成
            const allHexagrams = [1, 2, 3, 11, 12, 29, 30, 31, 33, 39, 41, 52, 63, 64];
            const randomHexagrams = [];
            for (let i = 0; i < 3; i++) {
                const idx = Math.floor(Math.random() * allHexagrams.length);
                randomHexagrams.push(allHexagrams[idx]);
            }
            
            const engineOS = {
                hexagramId: randomHexagrams[0],
                name: hexagramNames[randomHexagrams[0]] || `第${randomHexagrams[0]}卦`,
                score: Math.random() * 0.4 + 0.6 // 0.6-1.0
            };
            
            const interfaceOS = {
                hexagramId: randomHexagrams[1],
                name: hexagramNames[randomHexagrams[1]] || `第${randomHexagrams[1]}卦`,
                score: Math.random() * 0.4 + 0.5 // 0.5-0.9
            };
            
            const safeModeOS = {
                hexagramId: randomHexagrams[2],
                name: hexagramNames[randomHexagrams[2]] || `第${randomHexagrams[2]}卦`,
                score: Math.random() * 0.4 + 0.4 // 0.4-0.8
            };
            
            // 設定表示
            document.getElementById('random-config').innerHTML = `
                <div style="margin: 10px 0; padding: 10px; background: rgba(30, 41, 59, 0.5); border-radius: 5px;">
                    <strong>生成されたOS構成:</strong><br>
                    ⚡ Engine: ${engineOS.name} (ID: ${engineOS.hexagramId}, Score: ${engineOS.score.toFixed(2)})<br>
                    🔄 Interface: ${interfaceOS.name} (ID: ${interfaceOS.hexagramId}, Score: ${interfaceOS.score.toFixed(2)})<br>
                    🛡️ SafeMode: ${safeModeOS.name} (ID: ${safeModeOS.hexagramId}, Score: ${safeModeOS.score.toFixed(2)})
                </div>
            `;
            
            // 分析実行
            const analysis = analyzer.analyze(engineOS, interfaceOS, safeModeOS);
            
            // 結果表示
            displayResult(analysis, 'result-3');
        }
        
        function displayResult(analysis, containerId) {
            const container = document.getElementById(containerId);
            const { interactions, synergy } = analysis;
            
            let html = '<h3>🔍 分析結果</h3>';
            
            // ペア分析
            html += '<h4>📊 ペア間相互作用（動的生成）</h4>';
            interactions.pair_insights.forEach(pair => {
                const badgeClass = pair.category.toLowerCase();
                html += `
                    <div class="pair-insight">
                        <span>${pair.summary}</span>
                        <span class="badge ${badgeClass}">${pair.category}</span>
                    </div>
                `;
            });
            
            // 内的葛藤（動的）
            html += '<h4>⚡ 内的葛藤テーマ（' + interactions.inner_conflicts.length + '個）</h4>';
            html += '<ul>';
            interactions.inner_conflicts.forEach(conflict => {
                html += `<li>${conflict}</li>`;
            });
            html += '</ul>';
            
            // アフォーダンス（一部）
            html += '<h4>💡 Engine OSの強み/弱み</h4>';
            html += '<div style="margin-left: 20px;">';
            html += '<strong style="color: #10b981;">強みが出る場面:</strong><ul>';
            interactions.affordances.engine.thrives_with.forEach(t => {
                html += `<li>${t}</li>`;
            });
            html += '</ul>';
            html += '<strong style="color: #f59e0b;">弱みが出る場面:</strong><ul>';
            interactions.affordances.engine.struggles_with.forEach(s => {
                html += `<li>${s}</li>`;
            });
            html += '</ul></div>';
            
            // シナジー
            html += `<h4>🌟 シナジー分析</h4>`;
            html += `<p>${synergy.notes}</p>`;
            
            // タイムスタンプ
            html += `<p style="color: #64748b; font-size: 0.875rem;">生成時刻: ${new Date(analysis.created_at).toLocaleString()}</p>`;
            
            container.innerHTML = html;
        }
    </script>
</body>
</html>