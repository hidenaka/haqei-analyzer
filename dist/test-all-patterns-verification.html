<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³å‹•çš„è¡¨ç¾æ¤œè¨¼</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
        }
        .test-section { 
            margin: 30px 0; 
            padding: 20px; 
            border: 1px solid #444; 
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        .result-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        .pattern-card {
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 5px;
            border-left: 4px solid #3b82f6;
        }
        .pattern-title {
            color: #60a5fa;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .expression-item {
            margin: 5px 0;
            padding: 5px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 3px;
        }
        .category-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        .synergy { background: #10b981; }
        .harmony { background: #3b82f6; }
        .tension { background: #f59e0b; }
        .conflict { background: #ef4444; }
        .statistics {
            padding: 20px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 8px;
            margin: 20px 0;
        }
        .stat-item {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
        }
        .unique-expressions {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            margin: 10px 0;
        }
        .expression-count {
            color: #fbbf24;
            font-weight: bold;
        }
        .warning {
            color: #ef4444;
            font-weight: bold;
        }
        .success {
            color: #10b981;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ” å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³å‹•çš„è¡¨ç¾æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </h1>
    <p>64Ã—64Ã—64 = 262,144é€šã‚Šã®çµ„ã¿åˆã‚ã›ã‹ã‚‰ä½“ç³»çš„ã«ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã—ã¦ã€å‹•çš„è¡¨ç¾ã®å¤šæ§˜æ€§ã‚’æ¤œè¨¼</p>

    <div class="test-section">
        <h2>ğŸ“Š ä½“ç³»çš„æ¤œè¨¼</h2>
        <button onclick="verifySystematicPatterns()">ğŸ¯ ä¸»è¦ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œè¨¼ï¼ˆ100çµ„ï¼‰</button>
        <button onclick="verifyRandomPatterns(1000)">ğŸ² ãƒ©ãƒ³ãƒ€ãƒ æ¤œè¨¼ï¼ˆ1000çµ„ï¼‰</button>
        <button onclick="verifyEdgeCases()">âš¡ ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹æ¤œè¨¼</button>
        <button onclick="verifyAllCategories()">ğŸ“ˆ å…¨ã‚«ãƒ†ã‚´ãƒªç¶²ç¾…æ¤œè¨¼</button>
        
        <div id="systematic-result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š çµ±è¨ˆåˆ†æ</h2>
        <div id="statistics"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ” ãƒ¦ãƒ‹ãƒ¼ã‚¯è¡¨ç¾ãƒªã‚¹ãƒˆ</h2>
        <div id="unique-expressions"></div>
    </div>

    <script src="./assets/H384H64database.js"></script>
    <script src="./js/core/TripleOSInteractionAnalyzer.js"></script>
    <script>
        let allExpressions = new Set();
        let categoryStats = { SYNERGY: 0, HARMONY: 0, TENSION: 0, CONFLICT: 0 };
        let patternTypes = new Map();
        
        function verifySystematicPatterns() {
            allExpressions.clear();
            categoryStats = { SYNERGY: 0, HARMONY: 0, TENSION: 0, CONFLICT: 0 };
            patternTypes.clear();
            
            const analyzer = new TripleOSInteractionAnalyzer();
            const patterns = [];
            
            // 1. åŒä¸€å¦ãƒ‘ã‚¿ãƒ¼ãƒ³ (1-1-1, 2-2-2, ..., 64-64-64)
            for (let i = 1; i <= 5; i++) {
                patterns.push({ 
                    type: 'åŒä¸€å¦', 
                    ids: [i, i, i],
                    description: `ã™ã¹ã¦åŒã˜å¦ï¼ˆ${i}-${i}-${i}ï¼‰`
                });
            }
            
            // 2. ç¶œå¦é–¢ä¿‚ãƒ‘ã‚¿ãƒ¼ãƒ³ (è£œå®Œé–¢ä¿‚)
            const zongguaPairs = [[1, 2], [3, 50], [11, 12], [13, 14], [31, 32]];
            zongguaPairs.forEach(([a, b]) => {
                patterns.push({ 
                    type: 'ç¶œå¦é–¢ä¿‚', 
                    ids: [a, b, 29],
                    description: `ç¶œå¦é–¢ä¿‚ã‚’å«ã‚€ï¼ˆ${a}-${b}-29ï¼‰`
                });
            });
            
            // 3. éŒ¯å¦é–¢ä¿‚ãƒ‘ã‚¿ãƒ¼ãƒ³ (å¯¾æ¥µé–¢ä¿‚ã€å·®ãŒ32)
            for (let i = 1; i <= 5; i++) {
                const opposite = i + 32 > 64 ? i - 32 : i + 32;
                patterns.push({ 
                    type: 'éŒ¯å¦é–¢ä¿‚', 
                    ids: [i, opposite, 30],
                    description: `éŒ¯å¦é–¢ä¿‚ã‚’å«ã‚€ï¼ˆ${i}-${opposite}-30ï¼‰`
                });
            }
            
            // 4. éš£æ¥å¦ãƒ‘ã‚¿ãƒ¼ãƒ³ (é€£ç¶šã™ã‚‹å¦)
            for (let i = 1; i <= 10; i++) {
                patterns.push({ 
                    type: 'éš£æ¥å¦', 
                    ids: [i, i+1, i+2],
                    description: `éš£æ¥ã™ã‚‹3å¦ï¼ˆ${i}-${i+1}-${i+2}ï¼‰`
                });
            }
            
            // 5. é™°é™½ãƒãƒ©ãƒ³ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
            const yinYangPatterns = [
                [1, 2, 29],  // ç´”é™½ã€ç´”é™°ã€æ°´
                [30, 29, 52], // ç«ã€æ°´ã€å±±
                [51, 57, 58], // éœ‡ã€å·½ã€å…Œ
            ];
            yinYangPatterns.forEach(ids => {
                patterns.push({ 
                    type: 'é™°é™½ãƒãƒ©ãƒ³ã‚¹', 
                    ids,
                    description: `é™°é™½ãƒãƒ©ãƒ³ã‚¹ï¼ˆ${ids.join('-')}ï¼‰`
                });
            });
            
            // 6. ãƒ©ãƒ³ãƒ€ãƒ ãƒ‘ã‚¿ãƒ¼ãƒ³
            for (let i = 0; i < 20; i++) {
                const ids = [
                    Math.floor(Math.random() * 64) + 1,
                    Math.floor(Math.random() * 64) + 1,
                    Math.floor(Math.random() * 64) + 1
                ];
                patterns.push({ 
                    type: 'ãƒ©ãƒ³ãƒ€ãƒ ', 
                    ids,
                    description: `ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆ${ids.join('-')}ï¼‰`
                });
            }
            
            // 7. ç‰¹æ®Šãªçµ„ã¿åˆã‚ã›
            const specialPatterns = [
                [1, 64, 32],  // å§‹ã¾ã‚Šã¨çµ‚ã‚ã‚Šã¨ä¸­é–“
                [63, 64, 1],  // æ—¢æ¸ˆã€æœªæ¸ˆã€ä¹¾
                [3, 4, 5],    // åˆæœŸã®å›°é›£ã‚·ãƒªãƒ¼ã‚º
                [61, 62, 63], // çµ‚ç›¤ã‚·ãƒªãƒ¼ã‚º
            ];
            specialPatterns.forEach(ids => {
                patterns.push({ 
                    type: 'ç‰¹æ®Š', 
                    ids,
                    description: `ç‰¹æ®Šãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ${ids.join('-')}ï¼‰`
                });
            });
            
            // åˆ†æå®Ÿè¡Œ
            let html = '<div class="result-grid">';
            
            patterns.forEach(pattern => {
                const result = analyzePattern(analyzer, pattern.ids);
                
                html += `
                    <div class="pattern-card">
                        <div class="pattern-title">${pattern.type}: ${pattern.description}</div>
                        ${result.expressions.map(exp => `
                            <div class="expression-item">
                                ${exp.pair}: ${exp.summary}
                                <span class="category-badge ${exp.category.toLowerCase()}">${exp.category}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                // çµ±è¨ˆåé›†
                result.expressions.forEach(exp => {
                    allExpressions.add(exp.summary);
                    categoryStats[exp.category]++;
                });
                
                patternTypes.set(pattern.type, (patternTypes.get(pattern.type) || 0) + 1);
            });
            
            html += '</div>';
            document.getElementById('systematic-result').innerHTML = html;
            
            updateStatistics();
            updateUniqueExpressions();
        }
        
        function verifyRandomPatterns(count) {
            allExpressions.clear();
            categoryStats = { SYNERGY: 0, HARMONY: 0, TENSION: 0, CONFLICT: 0 };
            
            const analyzer = new TripleOSInteractionAnalyzer();
            const sampleSize = Math.min(count, 10000);
            
            for (let i = 0; i < sampleSize; i++) {
                const ids = [
                    Math.floor(Math.random() * 64) + 1,
                    Math.floor(Math.random() * 64) + 1,
                    Math.floor(Math.random() * 64) + 1
                ];
                
                const result = analyzePattern(analyzer, ids);
                result.expressions.forEach(exp => {
                    allExpressions.add(exp.summary);
                    categoryStats[exp.category]++;
                });
            }
            
            updateStatistics();
            updateUniqueExpressions();
            
            document.getElementById('systematic-result').innerHTML = `
                <div class="statistics">
                    <h3>${sampleSize}çµ„ã®ãƒ©ãƒ³ãƒ€ãƒ ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å®Œäº†</h3>
                    <p>ãƒ¦ãƒ‹ãƒ¼ã‚¯è¡¨ç¾æ•°: <span class="expression-count">${allExpressions.size}</span></p>
                </div>
            `;
        }
        
        function verifyEdgeCases() {
            allExpressions.clear();
            categoryStats = { SYNERGY: 0, HARMONY: 0, TENSION: 0, CONFLICT: 0 };
            
            const analyzer = new TripleOSInteractionAnalyzer();
            const edgeCases = [
                // ã™ã¹ã¦åŒã˜å¦
                [1, 1, 1], [2, 2, 2], [64, 64, 64],
                // æœ€å¤§å·®
                [1, 32, 64], [64, 32, 1],
                // ç¶œå¦é–¢ä¿‚
                [1, 2, 3], [11, 12, 13],
                // éŒ¯å¦é–¢ä¿‚ï¼ˆå·®32ï¼‰
                [1, 33, 2], [32, 64, 33],
                // é€£ç¶š
                [1, 2, 3], [62, 63, 64],
                // ç´ æ•°ç•ªå·
                [2, 3, 5], [7, 11, 13], [17, 19, 23],
                // 2ã®ç´¯ä¹—
                [2, 4, 8], [16, 32, 64],
            ];
            
            let html = '<div class="result-grid">';
            
            edgeCases.forEach(ids => {
                const result = analyzePattern(analyzer, ids);
                
                html += `
                    <div class="pattern-card">
                        <div class="pattern-title">ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: ${ids.join('-')}</div>
                        ${result.expressions.map(exp => `
                            <div class="expression-item">
                                ${exp.pair}: ${exp.summary}
                                <span class="category-badge ${exp.category.toLowerCase()}">${exp.category}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                result.expressions.forEach(exp => {
                    allExpressions.add(exp.summary);
                    categoryStats[exp.category]++;
                });
            });
            
            html += '</div>';
            document.getElementById('systematic-result').innerHTML = html;
            
            updateStatistics();
            updateUniqueExpressions();
        }
        
        function verifyAllCategories() {
            const analyzer = new TripleOSInteractionAnalyzer();
            const categorySamples = {
                SYNERGY: [],
                HARMONY: [],
                TENSION: [],
                CONFLICT: []
            };
            
            // å„ã‚«ãƒ†ã‚´ãƒªã®ã‚µãƒ³ãƒ—ãƒ«ã‚’åé›†
            let attempts = 0;
            const maxAttempts = 10000;
            
            while (attempts < maxAttempts && 
                   (categorySamples.SYNERGY.length < 10 || 
                    categorySamples.HARMONY.length < 10 || 
                    categorySamples.TENSION.length < 10 || 
                    categorySamples.CONFLICT.length < 10)) {
                
                const ids = [
                    Math.floor(Math.random() * 64) + 1,
                    Math.floor(Math.random() * 64) + 1,
                    Math.floor(Math.random() * 64) + 1
                ];
                
                const result = analyzePattern(analyzer, ids);
                
                result.expressions.forEach(exp => {
                    if (categorySamples[exp.category].length < 10) {
                        categorySamples[exp.category].push({
                            ids: ids,
                            expression: exp
                        });
                    }
                });
                
                attempts++;
            }
            
            // çµæœè¡¨ç¤º
            let html = '<h3>ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚µãƒ³ãƒ—ãƒ«</h3>';
            
            Object.entries(categorySamples).forEach(([category, samples]) => {
                html += `<h4>${category} (${samples.length}ã‚µãƒ³ãƒ—ãƒ«)</h4>`;
                html += '<div class="unique-expressions">';
                samples.forEach(sample => {
                    html += `
                        <div class="expression-item">
                            <strong>${sample.ids.join('-')}:</strong> ${sample.expression.summary}
                        </div>
                    `;
                });
                html += '</div>';
            });
            
            document.getElementById('systematic-result').innerHTML = html;
        }
        
        function analyzePattern(analyzer, ids) {
            const [engineId, interfaceId, safeId] = ids;
            
            const engineOS = {
                hexagramId: engineId,
                name: `ç¬¬${engineId}å¦`,
                score: 0.5
            };
            
            const interfaceOS = {
                hexagramId: interfaceId,
                name: `ç¬¬${interfaceId}å¦`,
                score: 0.5
            };
            
            const safeModeOS = {
                hexagramId: safeId,
                name: `ç¬¬${safeId}å¦`,
                score: 0.5
            };
            
            const analysis = analyzer.analyze(engineOS, interfaceOS, safeModeOS);
            
            return {
                expressions: analysis.interactions.pair_insights
            };
        }
        
        function updateStatistics() {
            const total = Object.values(categoryStats).reduce((a, b) => a + b, 0);
            
            let html = `
                <h3>ğŸ“Š æ¤œè¨¼çµ±è¨ˆ</h3>
                <div class="stat-item">
                    <span>ç·ãƒšã‚¢åˆ†ææ•°:</span>
                    <span class="expression-count">${total}</span>
                </div>
                <div class="stat-item">
                    <span>ãƒ¦ãƒ‹ãƒ¼ã‚¯è¡¨ç¾æ•°:</span>
                    <span class="expression-count">${allExpressions.size}</span>
                </div>
                <div class="stat-item">
                    <span>è¡¨ç¾ã®å¤šæ§˜æ€§ç‡:</span>
                    <span class="${allExpressions.size / total > 0.3 ? 'success' : 'warning'}">
                        ${((allExpressions.size / total) * 100).toFixed(1)}%
                    </span>
                </div>
                <h4>ã‚«ãƒ†ã‚´ãƒªåˆ†å¸ƒ</h4>
            `;
            
            Object.entries(categoryStats).forEach(([category, count]) => {
                const percentage = total > 0 ? (count / total * 100).toFixed(1) : 0;
                html += `
                    <div class="stat-item">
                        <span>${category}:</span>
                        <span>${count} (${percentage}%)</span>
                    </div>
                `;
            });
            
            // è­¦å‘Šãƒã‚§ãƒƒã‚¯
            if (allExpressions.size < total * 0.2) {
                html += `
                    <div class="warning">
                        âš ï¸ è­¦å‘Š: è¡¨ç¾ã®å¤šæ§˜æ€§ãŒä½ã„ï¼ˆ20%æœªæº€ï¼‰
                    </div>
                `;
            } else if (allExpressions.size >= total * 0.5) {
                html += `
                    <div class="success">
                        âœ… å„ªç§€: é«˜ã„è¡¨ç¾ã®å¤šæ§˜æ€§ï¼ˆ50%ä»¥ä¸Šï¼‰
                    </div>
                `;
            }
            
            document.getElementById('statistics').innerHTML = html;
        }
        
        function updateUniqueExpressions() {
            const expressions = Array.from(allExpressions);
            expressions.sort();
            
            let html = `
                <h3>ãƒ¦ãƒ‹ãƒ¼ã‚¯è¡¨ç¾ä¸€è¦§ï¼ˆ${expressions.length}ç¨®é¡ï¼‰</h3>
                <div class="unique-expressions">
            `;
            
            expressions.forEach((exp, index) => {
                html += `<div>${index + 1}. ${exp}</div>`;
            });
            
            html += '</div>';
            
            document.getElementById('unique-expressions').innerHTML = html;
        }
    </script>
</body>
</html>