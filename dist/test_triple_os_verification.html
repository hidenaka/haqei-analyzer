<\!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triple OS Analysis Engine - Verification Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .test-container { max-width: 1200px; margin: 0 auto; }
        .test-section { background: #2a2a2a; padding: 20px; margin: 20px 0; border-radius: 8px; border: 1px solid #333; }
        .test-title { color: #4CAF50; font-size: 1.5em; margin-bottom: 15px; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .pass { background: #1b5e20; border-left: 4px solid #4CAF50; }
        .fail { background: #b71c1c; border-left: 4px solid #f44336; }
        .info { background: #1a237e; border-left: 4px solid #2196F3; }
        .hexagram-result { background: #3e2723; border: 1px solid #8d6e63; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .hexagram-name { color: #ffab91; font-weight: bold; font-size: 1.1em; }
        .hexagram-id { color: #81c784; font-weight: bold; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        .progress { background: #333; height: 4px; border-radius: 2px; margin: 10px 0; overflow: hidden; }
        .progress-bar { background: #4CAF50; height: 100%; transition: width 0.3s; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª HAQEI Triple OS Analysis Engine - å®Œå…¨æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <div class="test-title">ğŸ“‹ æ¤œè¨¼é …ç›®ä¸€è¦§</div>
            <div class="test-result info">
                <strong>æ¤œè¨¼é …ç›®:</strong>
                <ul>
                    <li>âœ… UltraAnalysisEngine ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…ç¢ºèª</li>
                    <li>âœ… analyzeTripleOS ãƒ¡ã‚½ãƒƒãƒ‰ã®å‹•ä½œç¢ºèª</li>
                    <li>âœ… 64å¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ•´åˆæ€§ç¢ºèª</li>
                    <li>âœ… Engine OS: 8æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«â†’64å¦å¤‰æ›</li>
                    <li>âœ… Interface OS: ç¤¾ä¼šçš„ãƒ‘ã‚¿ãƒ¼ãƒ³â†’64å¦å¤‰æ›</li>
                    <li>âœ… Safe Mode OS: é˜²å¾¡ãƒ‘ã‚¿ãƒ¼ãƒ³â†’64å¦å¤‰æ›</li>
                    <li>âœ… 3ã¤ã®OSã®ç‹¬ç«‹æ€§ç¢ºèª</li>
                    <li>âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèª</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ¯ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</div>
            <button onclick="runComprehensiveTest()">ğŸ“Š åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button onclick="runMultipleAnalysis()">ğŸ”„ è¤‡æ•°å›åˆ†æãƒ†ã‚¹ãƒˆ</button>
            <button onclick="runEdgeCaseTest()">âš ï¸ ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ çµæœã‚¯ãƒªã‚¢</button>
            
            <div id="progress-container" style="display: none;">
                <div class="progress">
                    <div class="progress-bar" id="progress-bar" style="width: 0%;"></div>
                </div>
                <p id="progress-text">ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...</p>
            </div>
        </div>

        <div id="results-container"></div>
    </div>

    <script>
        // Test framework
        let testResults = [];
        
        function log(message, type = 'info') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = message;
            
            let container = document.getElementById('results-container');
            if (\!container) {
                container = document.createElement('div');
                container.id = 'results-container';
                document.querySelector('.test-container').appendChild(container);
            }
            container.appendChild(resultDiv);
        }

        function updateProgress(percentage, text) {
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            
            if (progressContainer) {
                progressContainer.style.display = percentage > 0 ? 'block' : 'none';
                if (progressBar) progressBar.style.width = percentage + '%';
                if (progressText) progressText.textContent = text;
            }
        }

        function clearResults() {
            const container = document.getElementById('results-container');
            if (container) {
                container.innerHTML = '';
            }
            testResults = [];
            updateProgress(0, '');
        }

        // Generate test answers
        function generateTestAnswers(pattern = 'balanced') {
            const answers = {};
            
            switch (pattern) {
                case 'creative':
                    // å‰µé€ æ€§é‡è¦–ãƒ‘ã‚¿ãƒ¼ãƒ³
                    for (let i = 1; i <= 30; i++) {
                        if (i <= 3) answers[`q${i}`] = '5';      // å‰µé€ æ€§é«˜
                        else if (i <= 6) answers[`q${i}`] = '4'; // è¡Œå‹•æ€§ä¸­é«˜
                        else if (i <= 24) answers[`q${i}`] = '3'; // ãã®ä»–ãƒãƒ©ãƒ³ã‚¹
                        else answers[`q${i}`] = String(Math.floor(Math.random() * 3) + 3); // ç¤¾ä¼šçš„ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ©ãƒ³ãƒ€ãƒ 
                    }
                    break;
                case 'stable':
                    // å®‰å®šæ€§é‡è¦–ãƒ‘ã‚¿ãƒ¼ãƒ³
                    for (let i = 1; i <= 30; i++) {
                        if (i >= 10 && i <= 12) answers[`q${i}`] = '5';  // å®‰å®šæ€§é«˜
                        else if (i >= 13 && i <= 15) answers[`q${i}`] = '4'; // å—å®¹æ€§ä¸­é«˜
                        else if (i <= 24) answers[`q${i}`] = '3';
                        else answers[`q${i}`] = String(Math.floor(Math.random() * 3) + 2);
                    }
                    break;
                case 'social':
                    // ç¤¾ä¼šæ€§é‡è¦–ãƒ‘ã‚¿ãƒ¼ãƒ³
                    for (let i = 1; i <= 30; i++) {
                        if (i <= 24) answers[`q${i}`] = '3';
                        else answers[`q${i}`] = String(Math.floor(Math.random() * 2) + 4); // ç¤¾ä¼šçš„ãƒ‘ã‚¿ãƒ¼ãƒ³é«˜
                    }
                    break;
                case 'defensive':
                    // é˜²å¾¡çš„ãƒ‘ã‚¿ãƒ¼ãƒ³
                    for (let i = 1; i <= 30; i++) {
                        answers[`q${i}`] = String(Math.floor(Math.random() * 2) + 1); // ä½ã‚¹ã‚³ã‚¢ä¸­å¿ƒ
                    }
                    break;
                default:
                    // ãƒãƒ©ãƒ³ã‚¹å‹
                    for (let i = 1; i <= 30; i++) {
                        answers[`q${i}`] = String(Math.floor(Math.random() * 5) + 1);
                    }
            }
            
            return answers;
        }

        // Main comprehensive test
        async function runComprehensiveTest() {
            clearResults();
            updateProgress(5, 'ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            log('<h2>ğŸ§ª åŒ…æ‹¬çš„æ¤œè¨¼ãƒ†ã‚¹ãƒˆé–‹å§‹</h2>', 'info');
            
            try {
                updateProgress(10, 'UltraAnalysisEngine ã®ç¢ºèªä¸­...');
                
                // 1. Class existence check
                if (typeof UltraAnalysisEngine === 'undefined') {
                    log('âŒ UltraAnalysisEngine ã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'fail');
                    return;
                } else {
                    log('âœ… UltraAnalysisEngine ã‚¯ãƒ©ã‚¹ãŒæ­£å¸¸ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™', 'pass');
                }
                
                updateProgress(20, 'ã‚¨ãƒ³ã‚¸ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆä¸­...');
                
                // 2. Create instance
                const engine = new UltraAnalysisEngine();
                log('âœ… UltraAnalysisEngine ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸ', 'pass');
                
                updateProgress(30, '64å¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ¤œè¨¼ä¸­...');
                
                // 3. Check hexagram database
                if (engine.H64_HEXAGRAMS && engine.H64_HEXAGRAMS.length === 64) {
                    log(`âœ… 64å¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ (${engine.H64_HEXAGRAMS.length}å¦)`, 'pass');
                } else {
                    log(`âš ï¸ 64å¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å•é¡ŒãŒã‚ã‚Šã¾ã™ (${engine.H64_HEXAGRAMS ? engine.H64_HEXAGRAMS.length : 0}å¦)`, 'fail');
                }
                
                updateProgress(40, 'ä¸‰çˆ»ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¤œè¨¼ä¸­...');
                
                // 4. Check trigram table
                if (engine.trigramTable && Object.keys(engine.trigramTable).length === 8) {
                    log('âœ… ä¸‰çˆ»å¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ­£å¸¸ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™', 'pass');
                } else {
                    log('âŒ ä¸‰çˆ»å¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«ã«å•é¡ŒãŒã‚ã‚Šã¾ã™', 'fail');
                }
                
                updateProgress(50, 'ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§åˆ†æå®Ÿè¡Œä¸­...');
                
                // 5. Test analysis with various patterns
                const testPatterns = ['balanced', 'creative', 'stable', 'social', 'defensive'];
                let successCount = 0;
                
                for (let i = 0; i < testPatterns.length; i++) {
                    const pattern = testPatterns[i];
                    updateProgress(50 + (i * 8), `${pattern} ãƒ‘ã‚¿ãƒ¼ãƒ³ã§åˆ†æä¸­...`);
                    
                    try {
                        const testAnswers = generateTestAnswers(pattern);
                        const results = engine.analyzeTripleOS(testAnswers);
                        
                        if (results && results.engineOS && results.interfaceOS && results.safeModeOS) {
                            successCount++;
                            
                            // Validate hexagram IDs are within 1-64 range
                            const engineValid = results.engineOS.hexagramId >= 1 && results.engineOS.hexagramId <= 64;
                            const interfaceValid = results.interfaceOS.hexagramId >= 1 && results.interfaceOS.hexagramId <= 64;
                            const safeModeValid = results.safeModeOS.hexagramId >= 1 && results.safeModeOS.hexagramId <= 64;
                            
                            if (engineValid && interfaceValid && safeModeValid) {
                                log(`<div class="hexagram-result">
                                    <strong>âœ… ${pattern} ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†ææˆåŠŸ</strong><br>
                                    <span class="hexagram-name">Engine OS:</span> <span class="hexagram-id">${results.engineOS.hexagramId}. ${results.engineOS.name}</span><br>
                                    <span class="hexagram-name">Interface OS:</span> <span class="hexagram-id">${results.interfaceOS.hexagramId}. ${results.interfaceOS.name}</span><br>
                                    <span class="hexagram-name">Safe Mode OS:</span> <span class="hexagram-id">${results.safeModeOS.hexagramId}. ${results.safeModeOS.name}</span>
                                </div>`, 'pass');
                            } else {
                                log(`âŒ ${pattern} ãƒ‘ã‚¿ãƒ¼ãƒ³: å¦ç•ªå·ãŒç¯„å›²å¤–ã§ã™ (E:${results.engineOS.hexagramId}, I:${results.interfaceOS.hexagramId}, S:${results.safeModeOS.hexagramId})`, 'fail');
                            }
                            
                        } else {
                            log(`âŒ ${pattern} ãƒ‘ã‚¿ãƒ¼ãƒ³ã§åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ`, 'fail');
                        }
                        
                    } catch (error) {
                        log(`âŒ ${pattern} ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ: ${error.message}`, 'fail');
                    }
                }
                
                updateProgress(90, 'çµæœã‚’è©•ä¾¡ä¸­...');
                
                // 6. Overall assessment
                const successRate = (successCount / testPatterns.length) * 100;
                if (successRate >= 80) {
                    log(`<h3>ğŸ‰ ç·åˆè©•ä¾¡: å„ªç§€ (${successCount}/${testPatterns.length} ãƒ‘ã‚¿ãƒ¼ãƒ³æˆåŠŸ, ${successRate}%)</h3>`, 'pass');
                } else if (successRate >= 60) {
                    log(`<h3>âš ï¸ ç·åˆè©•ä¾¡: è‰¯å¥½ (${successCount}/${testPatterns.length} ãƒ‘ã‚¿ãƒ¼ãƒ³æˆåŠŸ, ${successRate}%)</h3>`, 'info');
                } else {
                    log(`<h3>âŒ ç·åˆè©•ä¾¡: è¦æ”¹å–„ (${successCount}/${testPatterns.length} ãƒ‘ã‚¿ãƒ¼ãƒ³æˆåŠŸ, ${successRate}%)</h3>`, 'fail');
                }
                
                updateProgress(100, 'ãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                log(`âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ã«é‡å¤§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
                console.error('Test error:', error);
            }
        }

        // Multiple analysis test for consistency
        async function runMultipleAnalysis() {
            clearResults();
            log('<h2>ğŸ”„ è¤‡æ•°å›åˆ†æä¸€è²«æ€§ãƒ†ã‚¹ãƒˆ</h2>', 'info');
            
            try {
                const engine = new UltraAnalysisEngine();
                const testAnswers = generateTestAnswers('balanced');
                const results = [];
                
                updateProgress(10, 'åŒä¸€ãƒ‡ãƒ¼ã‚¿ã§è¤‡æ•°å›åˆ†æä¸­...');
                
                // Run same analysis 5 times
                for (let i = 0; i < 5; i++) {
                    const result = engine.analyzeTripleOS(testAnswers);
                    results.push(result);
                    updateProgress(20 + (i * 15), `åˆ†æ ${i + 1}/5 å®Œäº†`);
                }
                
                // Check consistency
                const firstResult = results[0];
                let consistent = true;
                
                for (let i = 1; i < results.length; i++) {
                    if (results[i].engineOS.hexagramId \!== firstResult.engineOS.hexagramId ||
                        results[i].interfaceOS.hexagramId \!== firstResult.interfaceOS.hexagramId ||
                        results[i].safeModeOS.hexagramId \!== firstResult.safeModeOS.hexagramId) {
                        consistent = false;
                        break;
                    }
                }
                
                updateProgress(100, 'ãƒ†ã‚¹ãƒˆå®Œäº†');
                
                if (consistent) {
                    log(`âœ… ä¸€è²«æ€§ãƒ†ã‚¹ãƒˆæˆåŠŸ: åŒä¸€å…¥åŠ›ã§åŒä¸€çµæœã‚’å‡ºåŠ›`, 'pass');
                    log(`<div class="hexagram-result">
                        <strong>å®‰å®šã—ãŸçµæœ:</strong><br>
                        Engine OS: ${firstResult.engineOS.hexagramId}. ${firstResult.engineOS.name}<br>
                        Interface OS: ${firstResult.interfaceOS.hexagramId}. ${firstResult.interfaceOS.name}<br>
                        Safe Mode OS: ${firstResult.safeModeOS.hexagramId}. ${firstResult.safeModeOS.name}
                    </div>`, 'pass');
                } else {
                    log('âŒ ä¸€è²«æ€§ãƒ†ã‚¹ãƒˆå¤±æ•—: åŒä¸€å…¥åŠ›ã§ç•°ãªã‚‹çµæœãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸ', 'fail');
                }
                
            } catch (error) {
                log(`âŒ è¤‡æ•°å›åˆ†æãƒ†ã‚¹ãƒˆã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
            }
        }

        // Edge case testing
        async function runEdgeCaseTest() {
            clearResults();
            log('<h2>âš ï¸ ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ</h2>', 'info');
            
            try {
                const engine = new UltraAnalysisEngine();
                
                updateProgress(10, 'ç©ºãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆä¸­...');
                
                // Test with empty answers
                try {
                    const result1 = engine.analyzeTripleOS({});
                    log('âœ… ç©ºãƒ‡ãƒ¼ã‚¿ã§ã‚‚ã‚¨ãƒ©ãƒ¼ãªãå‡¦ç†ã•ã‚Œã¾ã—ãŸ', 'pass');
                } catch (error) {
                    log(`âš ï¸ ç©ºãƒ‡ãƒ¼ã‚¿ã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
                }
                
                updateProgress(30, 'æœ€å°å€¤ãƒ†ã‚¹ãƒˆä¸­...');
                
                // Test with all minimum values
                const minAnswers = {};
                for (let i = 1; i <= 30; i++) {
                    minAnswers[`q${i}`] = '1';
                }
                
                try {
                    const result2 = engine.analyzeTripleOS(minAnswers);
                    if (result2.engineOS.hexagramId >= 1 && result2.engineOS.hexagramId <= 64) {
                        log('âœ… æœ€å°å€¤ãƒ‡ãƒ¼ã‚¿ã§æ­£å¸¸ãª64å¦ã‚’å‡ºåŠ›', 'pass');
                    } else {
                        log(`âŒ æœ€å°å€¤ãƒ‡ãƒ¼ã‚¿ã§ç„¡åŠ¹ãªå¦ç•ªå·: ${result2.engineOS.hexagramId}`, 'fail');
                    }
                } catch (error) {
                    log(`âŒ æœ€å°å€¤ãƒ‡ãƒ¼ã‚¿ã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
                }
                
                updateProgress(60, 'æœ€å¤§å€¤ãƒ†ã‚¹ãƒˆä¸­...');
                
                // Test with all maximum values
                const maxAnswers = {};
                for (let i = 1; i <= 30; i++) {
                    maxAnswers[`q${i}`] = '5';
                }
                
                try {
                    const result3 = engine.analyzeTripleOS(maxAnswers);
                    if (result3.engineOS.hexagramId >= 1 && result3.engineOS.hexagramId <= 64) {
                        log('âœ… æœ€å¤§å€¤ãƒ‡ãƒ¼ã‚¿ã§æ­£å¸¸ãª64å¦ã‚’å‡ºåŠ›', 'pass');
                    } else {
                        log(`âŒ æœ€å¤§å€¤ãƒ‡ãƒ¼ã‚¿ã§ç„¡åŠ¹ãªå¦ç•ªå·: ${result3.engineOS.hexagramId}`, 'fail');
                    }
                } catch (error) {
                    log(`âŒ æœ€å¤§å€¤ãƒ‡ãƒ¼ã‚¿ã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
                }
                
                updateProgress(90, 'ç„¡åŠ¹ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆä¸­...');
                
                // Test with invalid values
                const invalidAnswers = {};
                for (let i = 1; i <= 30; i++) {
                    invalidAnswers[`q${i}`] = 'invalid';
                }
                
                try {
                    const result4 = engine.analyzeTripleOS(invalidAnswers);
                    log('âœ… ç„¡åŠ¹ãƒ‡ãƒ¼ã‚¿ã§ã‚‚ã‚¨ãƒ©ãƒ¼ãªãå‡¦ç†ã•ã‚Œã¾ã—ãŸ', 'pass');
                } catch (error) {
                    log(`âš ï¸ ç„¡åŠ¹ãƒ‡ãƒ¼ã‚¿ã§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'info');
                }
                
                updateProgress(100, 'ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                log(`âŒ ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆã§é‡å¤§ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
            }
        }

        // Auto-load emergency_haqei.html script content
        window.onload = function() {
            log('ğŸš€ Triple OS Analysis Engine æ¤œè¨¼ãƒ„ãƒ¼ãƒ«æº–å‚™å®Œäº†', 'info');
            log('emergency_haqei.html ã‹ã‚‰ UltraAnalysisEngine ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„', 'info');
        };
    </script>
</body>
</html>
EOF < /dev/null