<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>完全検証システム - 全262,144パターン</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #0a0a0a; 
            color: #fff; 
            line-height: 1.6;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #333;
            border-radius: 10px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
        }
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            padding: 15px;
            border: 1px solid #444;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4ade80;
            display: block;
        }
        .control-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #555;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
        }
        .progress-container {
            margin: 20px 0;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            width: 0%;
            transition: width 0.3s ease;
        }
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: white;
            font-size: 12px;
        }
        button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
        }
        button:hover { 
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
        }
        button.start {
            background: linear-gradient(135deg, #059669, #10b981);
        }
        button.start:hover {
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        .results-section {
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
        }
        .warning {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid #f59e0b;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            color: #fbbf24;
        }
        .success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            color: #10b981;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🎯 完全検証システム</h1>
        <p>Triple OS 全262,144通り（64×64×64）の包括的検証</p>
        <p style="color: #fbbf24;">⚠️ 本格的な全パターン検証 - 処理時間数分〜数十分</p>
    </div>

    <div class="stats-container">
        <div class="stat-card">
            <span class="stat-number" id="total-combinations">262,144</span>
            <div>総組み合わせ数</div>
        </div>
        <div class="stat-card">
            <span class="stat-number" id="validated-count">0</span>
            <div>検証済み</div>
        </div>
        <div class="stat-card">
            <span class="stat-number" id="valid-count">0</span>
            <div>正常</div>
        </div>
        <div class="stat-card">
            <span class="stat-number" id="problematic-count">0</span>
            <div>問題</div>
        </div>
        <div class="stat-card">
            <span class="stat-number" id="success-rate">0.0%</span>
            <div>成功率</div>
        </div>
    </div>

    <div class="control-section">
        <h3>🚀 検証実行制御</h3>
        <button class="start" onclick="startCompleteValidation()">📊 全262,144パターン完全検証開始</button>
        <button onclick="pauseValidation()">⏸️ 一時停止</button>
        <button onclick="resumeValidation()">▶️ 再開</button>
        <button onclick="stopValidation()">⏹️ 停止</button>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
                <div class="progress-text" id="progress-text">0.0%</div>
            </div>
        </div>
        
        <div id="current-status">待機中...</div>
    </div>

    <div class="warning">
        <h4>⚠️ 重要な注意事項</h4>
        <ul>
            <li>この検証は <strong>262,144通り</strong> すべてを処理します</li>
            <li>完了まで <strong>数分〜数十分</strong> かかる可能性があります</li>
            <li>処理中はブラウザが重くなる場合があります</li>
            <li>途中でタブを閉じると進捗が失われます</li>
        </ul>
    </div>

    <div class="results-section">
        <h3>📈 リアルタイム結果</h3>
        <div id="results-output">検証開始をお待ちください...</div>
    </div>

    <script src="./public/assets/H384H64database.js"></script>
    <script src="./public/js/core/TripleOSInteractionAnalyzer.js"></script>
    <script src="./complete-validation-system.js"></script>
    <script>
        let completeValidator = null;
        let validationRunning = false;
        let validationPaused = false;
        
        function updateStats(stats) {
            document.getElementById('validated-count').textContent = stats.validatedCount.toLocaleString();
            document.getElementById('valid-count').textContent = stats.validCount.toLocaleString();
            document.getElementById('problematic-count').textContent = stats.problematicCount.toLocaleString();
            document.getElementById('success-rate').textContent = stats.successRate + '%';
            
            const progress = (stats.validatedCount / 262144 * 100);
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-text').textContent = progress.toFixed(2) + '%';
        }
        
        function updateStatus(message) {
            document.getElementById('current-status').innerHTML = message;
        }
        
        function addResult(message) {
            const output = document.getElementById('results-output');
            output.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        async function startCompleteValidation() {
            if (validationRunning) {
                alert('既に検証が実行中です');
                return;
            }
            
            if (!confirm('本当に全262,144パターンの検証を開始しますか？\n完了まで数分〜数十分かかる可能性があります。')) {
                return;
            }
            
            validationRunning = true;
            validationPaused = false;
            
            updateStatus('🚀 完全検証システム初期化中...');
            addResult('完全検証開始');
            
            completeValidator = new CompleteValidationSystem();
            
            // オリジナルのbatchProcessorをオーバーライドして進捗更新
            const originalValidateBatch = completeValidator.validateBatch;
            completeValidator.validateBatch = async function(startIndex, endIndex) {
                const result = await originalValidateBatch.call(this, startIndex, endIndex);
                
                // UI更新
                updateStats({
                    validatedCount: this.validatedCount + this.problematicCount,
                    validCount: this.validatedCount,
                    problematicCount: this.problematicCount,
                    successRate: (this.validatedCount / (this.validatedCount + this.problematicCount) * 100).toFixed(1)
                });
                
                updateStatus(`バッチ ${this.currentBatch}/${Math.ceil(262144/1000)} 完了`);
                addResult(`バッチ${this.currentBatch}: 正常${this.validatedCount}, 問題${this.problematicCount}`);
                
                return result;
            };
            
            try {
                const results = await completeValidator.validateAllCombinations();
                
                updateStatus('🎉 完全検証完了！');
                addResult(`<strong>検証完了: 正常${results.validatedCount}/${results.totalCombinations}</strong>`);
                
                if (results.problematicCount === 0) {
                    document.getElementById('results-output').innerHTML += 
                        '<div class="success"><h4>🎊 完璧な結果！</h4><p>全262,144通りのパターンが正常に動作しています！</p></div>';
                }
                
            } catch (error) {
                updateStatus('❌ 検証エラー');
                addResult(`エラー: ${error.message}`);
                console.error('検証エラー:', error);
            } finally {
                validationRunning = false;
            }
        }
        
        function pauseValidation() {
            validationPaused = true;
            updateStatus('⏸️ 一時停止中...');
        }
        
        function resumeValidation() {
            validationPaused = false;
            updateStatus('▶️ 検証再開');
        }
        
        function stopValidation() {
            if (confirm('検証を停止しますか？進捗は失われます。')) {
                validationRunning = false;
                validationPaused = false;
                updateStatus('⏹️ 検証停止');
                addResult('ユーザーによる検証停止');
            }
        }
    </script>
</body>
</html>