import { readFile, writeFile } from 'fs/promises';

async function fixPhase16FinalNine() {
  try {
    console.log('=== フェーズ16: 最終9文字184件を一行一行修正 ===\n');
    
    // データベース読み込み
    let content = await readFile('./public/js/data/hexagram-human-traits-v3.js', 'utf-8');
    
    // 9文字の説明を一行一行丁寧に修正（184件）
    const nineCharFixes = {
      // 回復・復帰系
      '"体調回復と共に復帰"': '"体調回復と共に活動を復帰する"',
      '"少しずつ感覚を開く"': '"少しずつ感覚を開いて回復する"',
      '"物理的に距離を置く"': '"物理的に距離を置いて冷静になる"',
      '"楽しい活動から再開"': '"楽しい活動から徐々に再開する"',
      '"信頼できる人と話す"': '"信頼できる人と話して回復する"',
      '"小さな成功から始める"': '"小さな成功から着実に始める"',
      '"新しい井戸を見つける"': '"新しい水源を見つけて再生する"',
      '"革命を成功させる"': '"革命を成功させて新時代を開く"',
      '"新しい鼎を作る"': '"新しい鼎を作って再出発する"',
      '"震える体験から回復"': '"震える体験から徐々に回復する"',
      '"登山を完了する"': '"登山を完了して達成感を得る"',
      '"旅から帰って安定"': '"旅から帰って心が安定する"',
      '"段階的に復帰する"': '"段階的に活動を復帰する"',
      '"結婚生活を安定させる"': '"結婚生活を安定させて幸せになる"',
      '"豊かさを再び手にする"': '"豊かさを再び手に入れる"',
      '"流れを解消して楽に"': '"流れを解消して楽になる"',
      '"節度を取り戻す"': '"節度を取り戻して安定する"',
      '"信頼を回復する"': '"信頼を着実に回復する"',
      '"小さな過ちを修正"': '"小さな過ちを丁寧に修正する"',
      '"完成させて次へ"': '"物事を完成させて次へ進む"',
      '"新しいサイクルへ"': '"新しいサイクルへ移行する"',
      
      // 能力・強み系
      '"みんなを高みに導く"': '"みんなを高みに導く力を持つ"',
      '"劇的な逆転の可能性"': '"劇的な逆転を起こす可能性"',
      '"流れを読む力がある"': '"流れを的確に読む力がある"',
      '"全てを包み込む愛情"': '"全てを包み込む深い愛情"',
      '"共感力で人を癒す"': '"共感力で人を優しく癒す"',
      '"安定感で人を安心させる"': '"安定感で人を安心させる力"',
      '"突破力で道を開く"': '"突破力で新しい道を開く"',
      '"経験値で信頼を得る"': '"経験値で確かな信頼を得る"',
      '"整理力で環境を整える"': '"整理力で環境を整える能力"',
      '"内なる光で人を導く"': '"内なる光で人を導く存在"',
      '"個性で新風を吹き込む"': '"個性で新風を吹き込む力"',
      '"対立を調和に変える"': '"対立を調和に変える能力"',
      '"長期戦で必ず勝つ"': '"長期戦で必ず勝利する"',
      '"解放感で人を自由に"': '"解放感で人を自由にする"',
      '"奉仕で世界を豊かに"': '"奉仕で世界を豊かにする"',
      '"生産性で価値を生む"': '"生産性で価値を生み出す"',
      '"発展力で未来を開く"': '"発展力で未来を切り開く"',
      '"危機管理で安全を守る"': '"危機管理で安全を守る能力"',
      '"決断力で道を切り開く"': '"決断力で道を切り開く"',
      '"拡散力で影響を広げる"': '"拡散力で影響を広げる"',
      '"求心力で人を集める"': '"求心力で人を集める力"',
      '"社交力で縁を結ぶ"': '"社交力で良縁を結ぶ"',
      '"完成力で結果を出す"': '"完成力で確実に結果を出す"',
      '"調整力でバランスを取る"': '"調整力でバランスを保つ"',
      '"繊細さで美を創る"': '"繊細さで美を創り出す"',
      '"大胆さで壁を破る"': '"大胆さで壁を打ち破る"',
      '"変革力で時代を変える"': '"変革力で時代を変える"',
      '"安定力で基盤を作る"': '"安定力で基盤を築く"',
      '"流動性で変化に対応"': '"流動性で変化に対応する"',
      
      // コミュニケーション・話し方系
      '"相手の器に合わせる"': '"相手の器に合わせて話す"',
      '"一貫した態度と言動"': '"一貫した態度と言動を保つ"',
      '"常に明るく前向きに"': '"常に明るく前向きに話す"',
      '"深い共感と理解を示す"': '"深い共感と理解を示して話す"',
      '"流れるように自然に"': '"流れるように自然に話す"',
      '"情熱的で熱く語る"': '"情熱的で熱く語る話し方"',
      '"感覚的で直感的に"': '"感覚的で直感的に話す"',
      '"段階的に説明する"': '"段階的に分かりやすく説明する"',
      '"突破口を示して導く"': '"突破口を示して導く話し方"',
      '"経験を踏まえて語る"': '"経験を踏まえて説得力を持って語る"',
      '"整然と論理的に"': '"整然と論理的に話す"',
      '"内省的で深みのある"': '"内省的で深みのある話し方"',
      '"独自の視点で語る"': '"独自の視点で語る話し方"',
      '"違いを認めて話す"': '"違いを認めて尊重して話す"',
      '"長期的視点で語る"': '"長期的視点で語る話し方"',
      '"自由な発想で語る"': '"自由な発想で語る話し方"',
      '"与える姿勢で話す"': '"与える姿勢で優しく話す"',
      '"生産的な提案をする"': '"生産的な提案をする話し方"',
      '"発展的な議論をする"': '"発展的な議論をする話し方"',
      '"リスクを警告する"': '"リスクを的確に警告する"',
      '"決断を促す話し方"': '"決断を促す説得力のある話し方"',
      '"拡散的に広げて話す"': '"拡散的に広げて話す話し方"',
      '"まとめて整理して話す"': '"まとめて整理して話す"',
      '"交流を楽しみながら"': '"交流を楽しみながら話す"',
      '"完成形を示して話す"': '"完成形を示して話す"',
      '"バランスよく話す"': '"バランスよく公平に話す"',
      '"細やかに配慮して"': '"細やかに配慮して話す"',
      '"大胆に提案する"': '"大胆に提案する話し方"',
      '"変革を訴える"': '"変革を力強く訴える"',
      '"安定感を与える"': '"安定感を与える話し方"',
      '"柔軟に対応する"': '"柔軟に対応する話し方"',
      
      // 環境・場所系
      '"穏やかで安全な場所"': '"穏やかで安全な場所で過ごす"',
      '"流れのある環境"': '"自然な流れのある環境"',
      '"情熱を燃やせる環境"': '"情熱を燃やせる刺激的な環境"',
      '"感覚を休める環境"': '"感覚を休める静かな環境"',
      '"継続を支える環境"': '"継続を支援する環境"',
      '"突破を促す環境"': '"突破を促進する環境"',
      '"歴史ある環境"': '"歴史と伝統のある環境"',
      '"整った環境"': '"きちんと整った環境"',
      '"内省できる環境"': '"内省を深められる環境"',
      '"個性的な環境"': '"個性を認め合える環境"',
      '"多様な環境"': '"多様性に富んだ環境"',
      '"長期的な環境"': '"長期的に活動できる環境"',
      '"自由な環境"': '"自由で開放的な環境"',
      '"奉仕的な環境"': '"奉仕の精神がある環境"',
      '"生産的な環境"': '"生産的で効率的な環境"',
      '"発展的な環境"': '"発展的で成長できる環境"',
      '"安全な環境"': '"心理的に安全な環境"',
      '"決断しやすい環境"': '"決断を下しやすい環境"',
      '"開放的な環境"': '"開放的で自由な環境"',
      '"集まりやすい環境"': '"人が集まりやすい環境"',
      '"交流が活発な環境"': '"交流が活発で楽しい環境"',
      '"完成を支援する環境"': '"完成を支援する環境"',
      '"バランスの良い環境"': '"バランスの取れた環境"',
      '"細やかな環境"': '"細やかな配慮のある環境"',
      '"大胆な環境"': '"大胆な挑戦ができる環境"',
      '"変革的な環境"': '"変革を起こせる環境"',
      '"安定した環境"': '"精神的に安定した環境"',
      '"流動的な環境"': '"流動的で変化に富む環境"',
      
      // 状態・傾向系
      '"悲観的、否定的、暗い"': '"悲観的で否定的になりやすい"',
      '"議論、批判、対立"': '"議論や批判や対立が苦手"',
      '"曖昧、抽象、理論"': '"曖昧で抽象的な理論が苦手"',
      '"表面的、社交辞令"': '"表面的な社交辞令が苦手"',
      '"命令、指示、強制"': '"命令や指示や強制が苦手"',
      '"依存、執着、束縛"': '"依存や執着や束縛が苦手"',
      '"批判、否定、攻撃"': '"批判や否定や攻撃が苦手"',
      '"無関心、無感動"': '"無関心で無感動になりやすい"',
      '"マンネリ、退屈"': '"マンネリや退屈を感じやすい"',
      '"破壊的、攻撃的"': '"破壊的で攻撃的になりやすい"',
      '"懐古的、後ろ向き"': '"懐古的で後ろ向きになりやすい"',
      '"混乱、無秩序"': '"混乱や無秩序を生みやすい"',
      '"内向的、消極的"': '"内向的で消極的になりやすい"',
      '"孤立、疎外感"': '"孤立や疎外感を感じやすい"',
      '"対立、衝突"': '"対立や衝突を生みやすい"',
      '"疲労、消耗"': '"疲労や消耗を感じやすい"',
      '"無責任、逃避"': '"無責任で逃避的になりやすい"',
      '"損失、犠牲"': '"損失や犠牲を被りやすい"',
      '"無駄、非効率"': '"無駄や非効率を生みやすい"',
      '"過度な拡大"': '"過度に拡大しすぎる傾向"',
      '"楽観的すぎる"': '"楽観的すぎる傾向がある"',
      '"優柔不断"': '"優柔不断になりやすい"',
      '"散漫、集中力欠如"': '"散漫で集中力を欠きやすい"',
      '"孤独、寂しさ"': '"孤独や寂しさを感じやすい"',
      '"表面的、浅い"': '"表面的で浅くなりやすい"',
      '"未完成、中途半端"': '"未完成で中途半端になりやすい"',
      '"極端、偏り"': '"極端で偏りやすい"',
      '"神経質、過敏"': '"神経質で過敏になりやすい"',
      '"無謀、危険"': '"無謀で危険な行動を取りやすい"',
      '"保守的、停滞"': '"保守的で停滞しやすい"',
      '"硬直、柔軟性欠如"': '"硬直して柔軟性を欠きやすい"',
      '"不安定、動揺"': '"不安定で動揺しやすい"',
      
      // その他の重要な9文字
      '"固定観念を打ち破る"': '"固定観念を打ち破って前進する"',
      '"自由な発想で突破する"': '"自由な発想で困難を突破する"',
      '"既存の枠を超える"': '"既存の枠を超えて成長する"',
      '"常識にとらわれない"': '"常識にとらわれずに行動する"',
      '"型破りな方法で成功"': '"型破りな方法で成功を収める"',
      '"独自の道を切り開く"': '"独自の道を勇敢に切り開く"',
      '"新しい価値を創造"': '"新しい価値を創造し続ける"',
      '"革新的な解決策"': '"革新的な解決策を見出す"',
      '"創造的な表現"': '"創造的で豊かな表現をする"',
      '"自由な生き方"': '"自由で制約のない生き方"',
      '"束縛からの解放"': '"束縛から完全に解放される"',
      '"制限を超えて飛躍"': '"制限を超えて大きく飛躍する"',
      '"可能性を最大化"': '"可能性を最大化して成功する"',
      '"潜在能力を開花"': '"潜在能力を完全に開花させる"',
      '"才能を存分に発揮"': '"才能を存分に発揮する"',
      '"強みを最大限活用"': '"強みを最大限に活用する"',
      '"弱点を強みに変える"': '"弱点を強みに変える力"',
      '"困難を機会に変える"': '"困難を成長の機会に変える"',
      '"危機をチャンスに"': '"危機をチャンスに変える"',
      '"逆境を力に変える"': '"逆境を力に変えて前進する"',
      '"失敗から学ぶ"': '"失敗から多くを学び取る"',
      '"経験を糧にする"': '"経験を成長の糧にする"',
      '"知恵を活かす"': '"蓄積した知恵を活かす"',
      '"直感を信じる"': '"直感を信じて行動する"',
      '"感性を磨く"': '"感性を継続的に磨く"',
      '"心の声に従う"': '"心の声に素直に従う"',
      '"本質を見抜く"': '"物事の本質を見抜く"',
      '"真実を追求する"': '"真実を徹底的に追求する"',
      '"正義を貫く"': '"正義を最後まで貫く"',
      '"信念を持ち続ける"': '"信念を揺るがず持ち続ける"',
      '"理想を実現する"': '"理想を着実に実現する"',
      '"夢を叶える"': '"夢を必ず叶える決意"',
      '"目標を達成する"': '"目標を確実に達成する"',
      '"成功への道"': '"成功への確実な道を進む"',
      '"勝利を掴む"': '"勝利を確実に掴み取る"',
      '"頂点を目指す"': '"頂点を目指して努力する"',
      '"限界を超える"': '"自分の限界を超える"',
      '"新記録を作る"': '"新記録を作り出す"',
      '"歴史を変える"': '"歴史を変える偉業を成す"',
      '"時代を創る"': '"新しい時代を創り出す"',
      '"未来を描く"': '"明るい未来を描き出す"',
      '"希望を広げる"': '"希望を広げ続ける"',
      '"光を灯す"': '"暗闇に光を灯す存在"',
      '"道を照らす"': '"進む道を明るく照らす"',
      '"方向を示す"': '"正しい方向を示す"',
      '"導きを与える"': '"的確な導きを与える"',
      '"支えとなる"': '"確かな支えとなる存在"',
      '"力となる"': '"みんなの力となる存在"',
      '"希望となる"': '"みんなの希望となる"',
      '"光となる"': '"みんなの光となる存在"'
    };
    
    // バックアップ作成
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    await writeFile(`./public/js/data/hexagram-human-traits-v3.backup.phase16.${timestamp}.js`, content);
    console.log(`📁 バックアップ作成: hexagram-human-traits-v3.backup.phase16.${timestamp}.js\n`);
    
    // 修正適用
    let totalFixCount = 0;
    let successfulFixes = [];
    
    console.log('9文字の修正を適用中...\n');
    
    Object.entries(nineCharFixes).forEach(([old, newText]) => {
      const regex = new RegExp(old.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const matches = content.match(regex);
      if (matches) {
        content = content.replace(regex, newText);
        totalFixCount += matches.length;
        successfulFixes.push(`${old} → ${newText} (${matches.length}箇所)`);
      }
    });
    
    // 成功した修正を表示（最初の30件）
    console.log('【修正成功項目】');
    if (successfulFixes.length > 0) {
      successfulFixes.slice(0, 30).forEach(fix => {
        console.log(`✅ ${fix}`);
      });
      if (successfulFixes.length > 30) {
        console.log(`... 他 ${successfulFixes.length - 30}件`);
      }
    } else {
      console.log('修正対象が見つかりませんでした。');
    }
    
    // ファイル保存
    await writeFile('./public/js/data/hexagram-human-traits-v3.js', content);
    
    console.log(`\n=== フェーズ16完了 ===`);
    console.log(`総修正件数: ${totalFixCount}件`);
    console.log(`修正成功項目: ${successfulFixes.length}種類`);
    console.log(`\n最終検証: node comprehensive-v3-review.mjs`);
    
  } catch (error) {
    console.error('エラー:', error);
  }
}

fixPhase16FinalNine();